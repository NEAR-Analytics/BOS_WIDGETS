{"tx_hash": "36SWosXPao7W2uCmzouynMoGR7CH6EoA5j1NLgKpA8wT", "action_id_social": "97YCs3tfozhq1zASJoQKg6aJUjarL7LwXU2iazjf3pEJ-0-widget", "block_id": 112324435, "block_timestamp": "2024-02-07T18:09:03.605Z", "signer_id": "baam25.near", "widget_name": "storeActivities", "source_code": "const contractId = props.contractId;\nconst cursomStyle = props.cursomStyle || \"\";\nconst perPage = props.perPage || 50; // need to be less than 50\nconst color = props.color || \"#000000\";\n\nif (!contractId) return \"pass a contractId\";\n\nconst nearLogo =\n  \"https://ipfs.near.social/ipfs/bafkreib2cfbayerbbnoya6z4qcywnizqrbkzt5lbqe32whm2lubw3sywr4\";\nconst [page, setPage] = useState(0);\n\nconst _address = (address, _limit) => {\n  const limit = _limit || 20;\n  if (address.length > limit) return address.slice(0, 10) + \"...\";\n  else return address;\n};\nconst YoctoToNear = (amountYocto) => {\n  return new Big(amountYocto || 0).div(new Big(10).pow(24)).toString();\n};\nconst utcDate2 = new Date();\n\n// Get the current date in the local time zone\nconst currentDate = new Date();\n\n// Calculate the time zone offset in milliseconds\nlet localTimeZoneOffsetMinutes = currentDate.getTimezoneOffset();\nlocalTimeZoneOffsetMinutes = localTimeZoneOffsetMinutes * 60 * 1000;\n\nconst currentTimestamp = new Date().getTime();\nconst getTimePassed = (date) => {\n  // Get the current timestamp in milliseconds\n  const timestamp = new Date(date).getTime();\n\n  // Calculate the difference in milliseconds\n  const timePassed = currentTimestamp + localTimeZoneOffsetMinutes - timestamp;\n\n  // Convert milliseconds to seconds, minutes, hours, etc.\n  const secondsPassed = Math.floor(timePassed / 1000);\n  const minutesPassed = Math.floor(secondsPassed / 60);\n  const hoursPassed = Math.floor(minutesPassed / 60);\n  const daysPassed = Math.floor(hoursPassed / 24);\n\n  let time = 0;\n\n  // Display the time passed conditionally\n  if (daysPassed > 0) {\n    time = `${daysPassed} days`;\n  } else if (hoursPassed > 0) {\n    time = `${hoursPassed} hours`;\n  } else if (minutesPassed > 0) {\n    time = `${minutesPassed} minutes`;\n  } else {\n    time = `${secondsPassed} seconds`;\n  }\n  return time;\n};\n\nconst data = fetch(\"https://graph.mintbase.xyz\", {\n  method: \"POST\",\n  headers: {\n    \"mb-api-key\": \"anon\",\n    \"Content-Type\": \"application/json\",\n  },\n  body: JSON.stringify({\n    query: `query MyQuery {\n      mb_views_nft_activities(\n        where: {nft_contract_id: {_eq:\"${contractId}\"}}\n        order_by: {timestamp: desc}\n      ) {\n        action_receiver\n        action_sender\n        price\n        receipt_id\n        title\n        timestamp\n        media\n        kind\n        metadata_id\n        tx_sender\n        token_id\n      }\n    }\n  `,\n  }),\n});\nconst nft_activities = data?.body?.data?.mb_views_nft_activities;\nif (!nft_activities) return \"Loading ...\";\n\nconst Container = styled.div`\n  --primary-color: ${color};\n  display: flex;\n  flex-direction: column;\n  overflow-x: scroll;\n  .header {\n    display: grid;\n    grid-template-columns: repeat(6, minmax(0, 1fr));\n    align-items: center;\n    justify-content: space-between;\n    padding: 1rem 0;\n    gap: 1rem;\n    background: var(--primary-color);\n    color: white;\n    margin-bottom: 1rem;\n    div {\n      text-align: center;\n    }\n    ${cursomStyle}\n  }\n  .trx-row {\n    display: grid;\n    grid-template-columns: repeat(6, minmax(0, 1fr));\n    width: 100%;\n    justify-content: space-between;\n    gap: 1rem;\n    padding: 1rem 0;\n    border-bottom: 1px solid ${color}5a;\n    &:last-of-type {\n      border-bottom-color: transparent;\n    }\n    div,\n    a,\n    span {\n      text-align: center;\n      margin: auto;\n    }\n    .address {\n      color: ${color};\n      height: 40px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      padding: 10px;\n      border-radius: 2px;\n      transition: all 200ms;\n      :hover {\n        background: ${color};\n        color: white;\n      }\n    }\n    .title {\n      display: flex;\n      align-items: center;\n      text-decoration: none;\n      gap: 10px;\n      div {\n        white-space: nowrap;\n        color: ${color};\n        height: 40px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        padding: 10px;\n        border-radius: 2px;\n        transition: all 200ms;\n        :hover {\n          background: ${color};\n          color: white;\n        }\n      }\n      img {\n        object-fit: cover;\n        width: 40px;\n        height: 40px;\n      }\n    }\n    .kind {\n      width: fit-content;\n      height: fit-content;\n      font-size: 12px;\n      font-weight: bold;\n      letter-spacing: 0.9;\n      padding: 4px;\n      border-radius: 2px;\n      text-transform: uppercase;\n    }\n    .price {\n      display: flex;\n      gap: 4px;\n      align-items: center;\n      font-weight: 600;\n      img {\n        width: 14px;\n      }\n    }\n    .time {\n      display: flex;\n      align-items: center;\n      gap: 1rem;\n      svg {\n        box-sizing: content-box;\n        height: 14px;\n        cursor: pointer;\n        padding: 10px;\n        border-radius: 2px;\n        transition: all 200ms ease 0s;\n        :hover {\n          fill: white;\n          background: ${color};\n        }\n      }\n    }\n  }\n`;\nconst Trx = styled.div``;\nconst kindColor = {\n  list: \"#8c4fe5\",\n  unlist: \"#8c4fe5\",\n  sale: \"#0a7d6c\",\n  transfer: \"#4f58a3\",\n  make_offer: \"#4f58a3\",\n  mint: \"#000000\",\n};\n// const hanldeRoute = (receipt) => {\n//   asyncFetch(\"https://api.nearblocks.io/v1/search?keyword=\" + receipt).then(\n//     (data) => {\n//       const txnHash =\n//         \"https://nearblocks.io/txns/\" +\n//         data.body.receipts[0]?.originated_from_transaction_hash;\n//       console.log(txnHash);\n//       clipboard.writeText(txnHash);\n//     }\n//   );\n// };\nreturn (\n  <Container>\n    <div className=\"header\">\n      <div>Event</div>\n      <div>NFT</div>\n      <div>From</div>\n      <div>To</div>\n      <div> Price</div>\n      <div>date</div>\n    </div>\n    <div>\n      {nft_activities\n        .slice(page * perPage, (page + 1) * perPage)\n        .map((activity) => {\n          const hashData = fetch(\n            \"https://api.nearblocks.io/v1/search?keyword=\" + activity.receipt_id\n          );\n          return (\n            <div className=\"trx-row\" key={activity.receipt_id}>\n              <div\n                style={{\n                  background: kindColor[activity.kind] + \"40\",\n                  color: kindColor[activity.kind],\n                }}\n                className=\"kind\"\n              >\n                {activity.kind}\n              </div>\n              <a\n                href={`https://mintbase.xyz/meta/${activity.metadata_id.replace(\n                  \":\",\n                  \"%3A\"\n                )}`}\n                target=\"_blank\"\n                className=\"title\"\n              >\n                {\" \"}\n                <img\n                  src={\n                    \"https://image-cache-service-z3w7d7dnea-ew.a.run.app/media?url=\" +\n                    activity.media\n                  }\n                  alt={activity.token_id}\n                />\n                <div>{activity.token_id}</div>\n              </a>\n              <Widget\n                src=\"near/widget/AccountProfileOverlay\"\n                props={{\n                  accountId: activity.action_sender,\n                  children: (\n                    <a\n                      href={\n                        \"https://near.org/near/widget/ProfilePage?accountId=\" +\n                        activity.action_sender\n                      }\n                      className=\"address\"\n                      target=\"_blank\"\n                    >\n                      {_address(activity.action_sender)}{\" \"}\n                    </a>\n                  ),\n                }}\n              />\n              <Widget\n                src=\"near/widget/AccountProfileOverlay\"\n                props={{\n                  accountId: activity.action_receiver,\n                  children: (\n                    <a\n                      href={\n                        \"https://near.org/near/widget/ProfilePage?accountId=\" +\n                        activity.action_receiver\n                      }\n                      className=\"address\"\n                      target=\"_blank\"\n                    >\n                      {_address(activity.action_receiver)}{\" \"}\n                    </a>\n                  ),\n                }}\n              />\n\n              <div>\n                {\" \"}\n                {activity.price ? (\n                  <div className=\"price\">\n                    {YoctoToNear(activity.price)}\n                    <img src={nearLogo} alt=\"NEAR\" />\n                  </div>\n                ) : (\n                  \"-\"\n                )}{\" \"}\n              </div>\n              <div className=\"time\">\n                {\" \"}\n                {getTimePassed(activity.timestamp)} ago{\" \"}\n                {hashData.body.receipts[0]\n                  ?.originated_from_transaction_hash && (\n                  <a\n                    href={\n                      \"https://nearblocks.io/txns/\" +\n                      hashData.body.receipts[0]\n                        ?.originated_from_transaction_hash\n                    }\n                    target=\"_blank\"\n                  >\n                    <svg\n                      viewBox=\"0 0 512 512\"\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                    >\n                      <path d=\"m432 320h-32a16 16 0 0 0 -16 16v112h-320v-320h144a16 16 0 0 0 16-16v-32a16 16 0 0 0 -16-16h-160a48 48 0 0 0 -48 48v352a48 48 0 0 0 48 48h352a48 48 0 0 0 48-48v-128a16 16 0 0 0 -16-16zm56-320h-128c-21.37 0-32.05 25.91-17 41l35.73 35.73-243.73 243.64a24 24 0 0 0 0 34l22.67 22.63a24 24 0 0 0 34 0l243.61-243.68 35.72 35.68c15 15 41 4.5 41-17v-128a24 24 0 0 0 -24-24z\" />\n                    </svg>\n                  </a>\n                )}\n              </div>\n            </div>\n          );\n        })}\n    </div>\n    <Widget\n      src=\"baam25.near/widget/pagination\"\n      props={{\n        onClick: (page) => {\n          setPage(page);\n        },\n        data: nft_activities,\n        page: page,\n        perPage: perPage,\n        bgColor: color,\n      }}\n    />\n  </Container>\n);\n", "metadata": {"platform": "jutsu.ai"}, "branch": {"draft": null}, "widget_modules_used": null, "widget_url": "https://near.social/#/baam25.near/widget/storeActivities", "fact_widget_deployments_id": "e62194cca481eed08dc32ab5edc4027e", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 1}