{"tx_hash": "2ZabHzyhD88eunYNKSkYUSAFYR9WM19eg5M1o4K45Ar2", "action_id_social": "74FkaN7oSaxyoQaznq1SHZY2jSnTNrgne9iMFVy7ih7S-0-widget", "block_id": 100967700, "block_timestamp": "2023-09-12T15:23:30.239Z", "signer_id": "marior.near", "widget_name": "NDCElections", "source_code": "const nominationsContractId = \"nominations.ndc-gwg.near\";\nconst electionsContractId = \"elections.ndc-gwg.near\";\nconst cardWidget = \"marior.near/widget/NDCElectionsCard\";\nconst loadingWidget = \"chess-game.near/widget/ChessGameLoading\";\nconst githubIcon = \"chess-game.near/widget/GithubIcon\";\n\nState.init({\n  selected: state.selected ?? \"hom\",\n  selectedCandidate: null,\n});\n\nconst candidates = fetch(\n  \"https://ndc-elections-api.shrm.workers.dev/candidates\"\n).body;\nconst ftMetas = fetch(\n  \"https://ndc-elections-api.shrm.workers.dev/ftmetas\"\n).body;\nconst nftMetas = fetch(\n  \"https://ndc-elections-api.shrm.workers.dev/nftmetas\"\n).body;\n\nif (!candidates || !ftMetas || !nftMetas) {\n  return (\n    <Widget\n      src={loadingWidget}\n      props={{\n        content: <div>Loading data via Pikespeak, Nearblocks & Pagoda API</div>,\n      }}\n    />\n  );\n}\n\nconst Wrapper = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  align-items: stretch;\n  max-width: 50rem;\n  margin: 0 auto 2rem;\n\n  &::before {    \n    content: \"\";\n    background-image: url(\"https://arweave.net/qOfmpZZNqQ0bHBJ4UTgPC_pjvs1oYOjTAVwfxD8fd2o\");\n    background-attachment: fixed;\n    background-size: contain;\n    position: absolute;\n    top: 0px;\n    right: 0px;\n    bottom: 0px;\n    left: 0px;\n    opacity: 0.6;\n    z-index: -1;\n  }\n`;\n\nconst Disclaimer = styled.div`\n  font-style: italic;\n  font-size: 1.1rem;\n  margin: 0 1rem;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n\n  a {\n    font-weight: 600;\n    font-style: normal;\n    text-decoration: none;\n    color: unset;\n    border-radius: 0.5rem;\n    border: 1px solid black;\n    padding: 0.3rem;\n  }\n`;\n\nconst Header = styled.h1`\n  margin-bottom: 1rem;\n  text-align: center;\n  padding: 3rem;\n  font-weight: 600;\n`;\n\nconst Content = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 1.5rem;\n  align-items: stretch;\n`;\n\nconst House = styled.h2`\n  font-weight: 600;\n  margin: 3rem 1rem 0;\n`;\n\nconst selectCandidate = (candidateId) => {\n  if (candidateId === state.selectedCandidate) return;\n  State.update({\n    selectedCandidate: candidateId,\n  });\n};\n\nconst selectHouse = (event) => {\n  State.update({\n    selected: event.target.value,\n    selectedCandidate: null,\n  });\n};\n\nconst renderCandidates = (title, candidates, threshold) => (\n  <>\n    <House>{title}</House>\n    {candidates.map((candidate, index) => {\n      const selected = candidate.nominee === state.selectedCandidate;\n      const isWinning = index < threshold;\n      return (\n        <Widget\n          src={cardWidget}\n          props={{\n            candidate,\n            selected,\n            isWinning,\n            selectCandidate,\n            ftMetas,\n            nftMetas,\n          }}\n        />\n      );\n    })}\n  </>\n);\n\nreturn (\n  <Wrapper>\n    <Header>NDC Elections Stats</Header>\n    <Disclaimer>\n      <span>\n        Data is aggregated via Pikespeak, Nearblocks & Pagoda API and might be\n        outdated or not yet properly initialized.\n      </span>\n      <a href=\"https://github.com/Protocol-Pawns\" target=\"_blank\">\n        <Widget src={githubIcon} props={{ height: \"2rem\" }} />\n        <span>Github</span>\n      </a>\n    </Disclaimer>\n    <select onChange={selectHouse}>\n      <option value=\"hom\" selected={state.selected === \"hom\"}>\n        House Of Merit\n      </option>\n      <option value=\"coa\" selected={state.selected === \"coa\"}>\n        Council Of Advisors\n      </option>\n      <option value=\"tc\" selected={state.selected === \"tc\"}>\n        Transparency Commission\n      </option>\n    </select>\n    {state.selected === \"hom\" && (\n      <Content>\n        {renderCandidates(\n          \"House Of Merit\",\n          candidates\n            .filter(({ house }) => house === \"HouseOfMerit\")\n            .sort((a, b) => (b.voters?.length ?? 0) - (a.voters?.length ?? 0)),\n          15\n        )}\n      </Content>\n    )}\n    {state.selected === \"coa\" && (\n      <Content>\n        {renderCandidates(\n          \"Council Of Advisors\",\n          candidates\n            .filter(({ house }) => house === \"CouncilOfAdvisors\")\n            .sort((a, b) => (b.voters?.length ?? 0) - (a.voters?.length ?? 0)),\n          7\n        )}\n      </Content>\n    )}\n    {state.selected === \"tc\" && (\n      <Content>\n        {renderCandidates(\n          \"Transparency Commission\",\n          candidates\n            .filter(({ house }) => house === \"TransparencyCommission\")\n            .sort((a, b) => (b.voters?.length ?? 0) - (a.voters?.length ?? 0)),\n          7\n        )}\n      </Content>\n    )}\n  </Wrapper>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/marior.near/widget/NDCElections", "fact_widget_deployments_id": "fb7050952138a59d4e8bf86591cb0884", "inserted_timestamp": "2023-09-12T17:27:44.240Z", "modified_timestamp": "2023-09-12T17:27:44.240Z", "__row_index": 0}