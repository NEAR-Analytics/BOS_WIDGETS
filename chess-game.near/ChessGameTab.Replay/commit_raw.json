{"tx_hash": "A4ZjqzaUnzHygdm7TaKCxDLcrYqXPqtmuupSNB1X9taY", "action_id_social": "3998zMBGhb8KE12wvGyqyT5XgCqKtdCpdjsCrZPLJjJ8-0-widget", "block_id": 103071558, "block_timestamp": "2023-10-10T19:06:44.192Z", "signer_id": "chess-game.near", "widget_name": "ChessGameTab.Replay", "source_code": "const { accountId } = context;\nconst { isRegistered } = props;\nconst game_id =\n  props.game_id && typeof props.game_id === \"string\"\n    ? JSON.parse(props.game_id)\n    : props.game_id;\n\nconst contractId = \"app.chess-game.near\";\nconst replayWidget = \"chess-game.near/widget/ChessGameReplay\";\nconst buttonWidget = \"chess-game.near/widget/ChessGameButton\";\nconst loadingWidget = \"chess-game.near/widget/ChessGameLoading\";\n\nconst Content = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  gap: 0.4rem 0;\n`;\nconst GameSelector = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n  align-items: center;\n  justify-content: space-between;\n  gap: 1rem;\n\n  > * {\n    flex: 1 1 1000px;\n  }\n`;\n\nState.init({\n  game_id: state.game_id ?? game_id,\n  finishedGames: state.finishedGames ?? null,\n  recentFinishedGames: state.recentFinishedGames ?? null,\n});\n\nconst selectGame = (gameId) => {\n  State.update({\n    game_id: gameId,\n  });\n};\n\nif (state.game_id) {\n  return (\n    <Content>\n      <Widget\n        src={buttonWidget}\n        props={{\n          onClick: () => selectGame(null),\n          alignSelf: \"center\",\n          content: \"Close\",\n        }}\n      />\n      <Widget src={replayWidget} props={{ game_id: state.game_id }} />\n    </Content>\n  );\n}\n\nif (isRegistered && accountId) {\n  Near.asyncView(contractId, \"finished_games\", {\n    account_id: accountId,\n  }).then((finishedGames) => {\n    finishedGames.sort((a, b) => b[0] - a[0]);\n    State.update({\n      finishedGames,\n    });\n  });\n} else {\n  State.update({\n    finishedGames: [],\n  });\n}\nNear.asyncView(contractId, \"recent_finished_games\", {}).then(\n  (recentFinishedGames) => {\n    State.update({\n      recentFinishedGames,\n    });\n  }\n);\n\nif (!state.finishedGames || !state.recentFinishedGames) {\n  return <Widget src={loadingWidget} />;\n}\n\nconst renderGameIds = (gameIds, displayPlayers) =>\n  gameIds.map((gameId) => {\n    return (\n      <Widget\n        src={buttonWidget}\n        props={{\n          onClick: () => selectGame(gameId),\n          flexDirection: \"column\",\n          content: (\n            <>\n              <div>ID: {gameId[0]}</div>\n              {displayPlayers && (\n                <>\n                  <div>White: {gameId[1]}</div>\n                  {gameId[2] && <div>Black: {gameId[2]}</div>}\n                </>\n              )}\n            </>\n          ),\n        }}\n      />\n    );\n  });\n\nreturn (\n  <>\n    {state.finishedGames.length > 0 && (\n      <div>\n        <h2>Replay your finished games:</h2>\n        <GameSelector>{renderGameIds(state.finishedGames, false)}</GameSelector>\n      </div>\n    )}\n    {state.recentFinishedGames.length > 0 && (\n      <div class=\"mt-4\">\n        <h2>Replay recently finished games:</h2>\n        <GameSelector>\n          {renderGameIds(state.recentFinishedGames, true)}\n        </GameSelector>\n      </div>\n    )}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/chess-game.near/widget/ChessGameTab.Replay", "fact_widget_deployments_id": "51fc8a7b4080abad321a6cf70081bd2b", "inserted_timestamp": "2023-10-10T20:52:27.837Z", "modified_timestamp": "2023-10-10T20:52:27.837Z", "__row_index": 1}