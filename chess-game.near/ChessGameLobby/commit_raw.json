{"tx_hash": "GdCH9A2yYBYWETfywue2aWYmdMopAVZZBNGths8wAqbL", "action_id_social": "4aHCVs2gVxSPR3H9BTbQD7XRby57NCy5wVocBDNanCBG-0-widget", "block_id": 103558549, "block_timestamp": "2023-10-17T04:38:38.540Z", "signer_id": "chess-game.near", "widget_name": "ChessGameLobby", "source_code": "const { accountId } = context;\r\n\r\nconst contractId = \"app.chess-game.near\";\r\nconst buttonWidget = \"chess-game.near/widget/ChessGameButton\";\r\nconst loadingWidget = \"chess-game.near/widget/ChessGameLoading\";\r\n\r\nconst currentLink = \"#/chess-game.near/widget/ChessGameLobby\";\r\n\r\nconst LobbyView = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  max-width: 550px;\r\n  margin: 0 auto;\r\n  box-sizing: border-box;\r\n\r\n  h1 {\r\n    align-self: center;\r\n  }\r\n\r\n  > * {\r\n    margin: 1.2rem 0;\r\n  }\r\n`;\r\nconst Disclaimer = styled.div`\r\n  margin-top: 1rem;\r\n  font-style: italic;\r\n  font-size: 1.2rem;\r\n`;\r\n\r\nState.init({\r\n  tab: props.tab ?? state.tab ?? \"game\",\r\n  isRegistered: state.isRegistered,\r\n});\r\n\r\nconst updateIsRegistered = () => {\r\n  Near.asyncView(contractId, \"storage_balance_of\", {\r\n    account_id: accountId,\r\n  }).then((res) => {\r\n    State.update({\r\n      isRegistered: !!res,\r\n    });\r\n  });\r\n};\r\n\r\nif (state.isRegistered === null || state.isRegistered === undefined) {\r\n  if (!accountId) {\r\n    State.update({\r\n      isRegistered: false,\r\n    });\r\n  } else {\r\n    updateIsRegistered();\r\n  }\r\n  return <Widget src={loadingWidget} />;\r\n}\r\n\r\nconst registerAccount = () => {\r\n  Near.call(\r\n    contractId,\r\n    \"storage_deposit\",\r\n    {},\r\n    undefined,\r\n    \"50000000000000000000000\"\r\n  );\r\n  // TODO wait for tx\r\n  updateIsRegistered();\r\n};\r\n\r\nconst navigate = (tab) => {\r\n  State.update({\r\n    tab,\r\n  });\r\n};\r\n\r\nconst pages = [\r\n  {\r\n    title: \"Play\",\r\n    icon: <i className=\"bi-joystick\"></i>,\r\n    active: state.tab === \"game\",\r\n    href: currentLink + \"?tab=game\",\r\n    onClick: () => navigate(\"game\"),\r\n    widgetName: \"ChessGameTab.Default\",\r\n  },\r\n  {\r\n    title: \"Challenge\",\r\n    icon: <i className=\"bi-people-fill\"></i>,\r\n    active: state.tab === \"challenge\",\r\n    href: currentLink + \"?tab=challenge\",\r\n    onClick: () => navigate(\"challenge\"),\r\n    widgetName: \"ChessGameTab.Challenge\",\r\n  },\r\n  {\r\n    title: \"AI\",\r\n    icon: <i className=\"bi-robot\"></i>,\r\n    active: state.tab === \"ai\",\r\n    href: currentLink + \"?tab=ai\",\r\n    onClick: () => navigate(\"ai\"),\r\n    widgetName: \"ChessGameTab.AI\",\r\n  },\r\n  {\r\n    title: \"Replay\",\r\n    icon: <i className=\"bi-collection-play\"></i>,\r\n    active: state.tab === \"replay\",\r\n    href: currentLink + \"?tab=replay\",\r\n    onClick: () => navigate(\"replay\"),\r\n    widgetName: \"ChessGameTab.Replay\",\r\n  },\r\n  [\r\n    {\r\n      title: \"Links\",\r\n      icon: <i className=\"bi-link\"></i>,\r\n    },\r\n    {\r\n      title: \"BOS Profile\",\r\n      icon: <i className=\"bi-person-fill\"></i>,\r\n      href: \"#/mob.near/widget/ProfilePage?accountId=chess-game.near\",\r\n    },\r\n    {\r\n      title: \"Github\",\r\n      icon: <i className=\"bi-github\"></i>,\r\n      href: \"https://github.com/Protocol-Pawns\",\r\n    },\r\n    {\r\n      title: \"Twitter\",\r\n      icon: <i className=\"bi-twitter\"></i>,\r\n      href: \"https://twitter.com/protocolpawns\",\r\n    },\r\n    {\r\n      title: \"Discord\",\r\n      icon: <i className=\"bi-discord\"></i>,\r\n      href: \"https://discord.com/invite/wKqEnXjaVH\",\r\n    },\r\n  ],\r\n];\r\n\r\nlet activePage = null;\r\npages.find((page) => {\r\n  if (page.active) {\r\n    activePage = page;\r\n    return true;\r\n  }\r\n  return false;\r\n});\r\n\r\nconst pageContent = activePage ? (\r\n  <Widget\r\n    src={\"chess-game.near/widget/\" + activePage.widgetName}\r\n    props={{ isRegistered: state.isRegistered, game_id: props.game_id }}\r\n  />\r\n) : (\r\n  \"404\"\r\n);\r\n\r\nreturn (\r\n  <div className=\"row\">\r\n    <Widget\r\n      src=\"chess-game.near/widget/Common.Layout.Header\"\r\n      props={{\r\n        items: pages,\r\n      }}\r\n    />\r\n    <div className=\"col\">\r\n      <LobbyView>\r\n        <Disclaimer>\r\n          Play chess fully on chain powered by Near Protocol and the BOS. If you\r\n          want to learn more please visit the profile page.\r\n        </Disclaimer>\r\n        {!state.isRegistered && accountId && (\r\n          <>\r\n            <Disclaimer>\r\n              You need to pay storage deposit of 0.05N first before being\r\n              allowed to play Protocol Pawns.\r\n              <br />\r\n              If you don't get redirected after registering, please refresh the\r\n              page.\r\n            </Disclaimer>\r\n            <Widget\r\n              src={buttonWidget}\r\n              props={{\r\n                onClick: registerAccount,\r\n                fontSize: \"1.2rem\",\r\n                content: \"Register Account\",\r\n              }}\r\n            />\r\n          </>\r\n        )}\r\n        {pageContent}\r\n        <Disclaimer>\r\n          If you won or lost a game it will no longer be displayed. You can\r\n          check the most recent transactions status on{\" \"}\r\n          <a\r\n            target=\"_blank\"\r\n            href=\"https://nearblocks.io/address/app.chess-game.near\"\r\n          >\r\n            Nearblocks\r\n          </a>\r\n          .\r\n        </Disclaimer>\r\n      </LobbyView>\r\n    </div>\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/chess-game.near/widget/ChessGameLobby", "fact_widget_deployments_id": "28d0c53a9b4c519d68ee10515d11d7f0", "inserted_timestamp": "2023-10-17T06:40:12.262Z", "modified_timestamp": "2023-10-17T06:40:12.262Z", "__row_index": 46}