{"tx_hash": "6BmB8WKbYUm1XkheFUL2XkgddMWqt6n8LZvp2Xnjss48", "action_id_social": "5iAF3qVrEbGSdb93WfELqsop82WvwwbLGnp2SQ4zCNCa-0-widget", "block_id": 105676549, "block_timestamp": "2023-11-14T09:10:40.703Z", "signer_id": "chess-game.near", "widget_name": "ChessGameLobby", "source_code": "const { accountId } = context;\n\nconst src = \"chess-game.near/widget/ChessGameLobby\";\nconst contractId = \"app.chess-game.near\";\nconst buttonWidget = \"chess-game.near/widget/ChessGameButton\";\nconst loadingWidget = \"chess-game.near/widget/ChessGameLoading\";\n\nconst currentLink = \"#/chess-game.near/widget/ChessGameLobby\";\n\nconst LobbyView = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  max-width: 550px;\n  margin: 0 auto;\n  box-sizing: border-box;\n\n  h1 {\n    align-self: center;\n  }\n\n  > * {\n    margin: 1.2rem 0;\n  }\n`;\nconst Disclaimer = styled.div`\n  margin-top: 1rem;\n  font-style: italic;\n  font-size: 1.2rem;\n`;\nconst Button = styled.button`\n  display: inline-flex;\n  align-items: center;\n  gap: 8px;\n  padding: 0.6rem 0.8rem;\n  border-radius: 50px;\n  font-weight: 600;\n  font-size: 1.2rem;\n  line-height: 15px;\n  text-align: center;\n  cursor: pointer;\n\n  &:hover,\n  &:focus {\n    text-decoration: none;\n    outline: none;\n  }\n\n  i {\n    color: #7E868C;\n  }\n\n  .bi-16 {\n    font-size: 16px;\n  }\n  color: ${(p) => (p.primary ? \"#09342E\" : \"#11181C\")} !important;\n  background: ${(p) => (p.primary ? \"#59E692\" : \"#FBFCFD\")};\n  border: ${(p) => (p.primary ? \"none\" : \"1px solid #D7DBDF\")};\n\n  &:hover,\n  &:focus {\n    background: ${(p) => (p.primary ? \"rgb(112 242 164)\" : \"#ECEDEE\")};\n  }\n`;\n\nState.init({\n  tab: props.tab ?? state.tab ?? \"game\",\n  isRegistered: state.isRegistered,\n  apps: [],\n});\n\nconst updateIsRegistered = () => {\n  Near.asyncView(contractId, \"storage_balance_of\", {\n    account_id: accountId,\n  }).then((res) => {\n    State.update({\n      isRegistered: !!res,\n    });\n  });\n};\n\nif (state.isRegistered === null || state.isRegistered === undefined) {\n  if (!accountId) {\n    State.update({\n      isRegistered: false,\n    });\n  } else {\n    updateIsRegistered();\n  }\n  return <Widget src={loadingWidget} />;\n}\n\nlet isHuman = false;\nif (showHumanBadge) {\n  const userSBTs = Near.view(\"registry.i-am-human.near\", \"is_human\", {\n    account: accountId,\n  });\n  isHuman = userSBTs.length > 0;\n}\n\nconst registerAccount = () => {\n  Near.call(\n    contractId,\n    \"storage_deposit\",\n    {},\n    undefined,\n    \"50000000000000000000000\"\n  );\n  // TODO wait for tx\n  updateIsRegistered();\n};\n\nconst navigate = (tab) => {\n  State.update({\n    tab,\n  });\n};\n\nconst pages = [\n  {\n    title: \"Play\",\n    icon: <i className=\"bi-joystick\"></i>,\n    active: state.tab === \"game\",\n    href: currentLink + \"?tab=game\",\n    onClick: () => navigate(\"game\"),\n    widgetName: \"ChessGameTab.Default\",\n  },\n  {\n    title: \"Challenge\",\n    icon: <i className=\"bi-people-fill\"></i>,\n    active: state.tab === \"challenge\",\n    href: currentLink + \"?tab=challenge\",\n    onClick: () => navigate(\"challenge\"),\n    widgetName: \"ChessGameTab.Challenge\",\n  },\n  {\n    title: \"AI\",\n    icon: <i className=\"bi-robot\"></i>,\n    active: state.tab === \"ai\",\n    href: currentLink + \"?tab=ai\",\n    onClick: () => navigate(\"ai\"),\n    widgetName: \"ChessGameTab.AI\",\n  },\n  {\n    title: \"Replay\",\n    icon: <i className=\"bi-collection-play\"></i>,\n    active: state.tab === \"replay\",\n    href: currentLink + \"?tab=replay\",\n    onClick: () => navigate(\"replay\"),\n    widgetName: \"ChessGameTab.Replay\",\n  },\n  [\n    {\n      title: \"Links\",\n      icon: <i className=\"bi-link\"></i>,\n    },\n    {\n      title: \"BOS Profile\",\n      icon: <i className=\"bi-person-fill\"></i>,\n      href: \"#/mob.near/widget/ProfilePage?accountId=chess-game.near\",\n    },\n    {\n      title: \"Github\",\n      icon: <i className=\"bi-github\"></i>,\n      href: \"https://github.com/Protocol-Pawns\",\n    },\n    {\n      title: \"Twitter\",\n      icon: <i className=\"bi-twitter\"></i>,\n      href: \"https://twitter.com/protocolpawns\",\n    },\n    {\n      title: \"Discord\",\n      icon: <i className=\"bi-discord\"></i>,\n      href: \"https://discord.com/invite/wKqEnXjaVH\",\n    },\n  ],\n];\n\nlet activePage = null;\npages.find((page) => {\n  if (page.active) {\n    activePage = page;\n    return true;\n  }\n  return false;\n});\n\nconst pageContent = activePage ? (\n  <Widget\n    src={\"chess-game.near/widget/\" + activePage.widgetName}\n    props={{ isRegistered: state.isRegistered, game_id: props.game_id }}\n  />\n) : (\n  \"404\"\n);\n\nreturn (\n  <div className=\"row\">\n    <Widget\n      src=\"chess-game.near/widget/Common.Layout.Header\"\n      props={{\n        items: pages,\n      }}\n    />\n    <div className=\"col\">\n      <LobbyView>\n        <Disclaimer>\n          Play chess fully on chain powered by Near Protocol and the BOS. If you\n          want to learn more please visit the profile page.\n        </Disclaimer>\n        {!state.isRegistered && accountId && (\n          <>\n            <Disclaimer>\n              You need to pay storage deposit of 0.05N first before being\n              allowed to play Protocol Pawns.\n              <br />\n              If you don't get redirected after registering, please refresh the\n              page.\n            </Disclaimer>\n            <Widget\n              src={buttonWidget}\n              props={{\n                onClick: registerAccount,\n                fontSize: \"1.2rem\",\n                content: \"Register Account\",\n              }}\n            />\n          </>\n        )}\n        {pageContent}\n        <Disclaimer>\n          If you won or lost a game it will no longer be displayed. You can\n          check the most recent transactions status on{\" \"}\n          <a\n            target=\"_blank\"\n            href=\"https://nearblocks.io/address/app.chess-game.near\"\n          >\n            Nearblocks\n          </a>\n          .\n        </Disclaimer>\n      </LobbyView>\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/chess-game.near/widget/ChessGameLobby", "fact_widget_deployments_id": "62ba21dfa5a91048bafe10a232cf3579", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 28}