{"tx_hash": "CC9GcHy83rphSqwYdFGRGRyFvEi4uTU9wceCkLZk2NT3", "action_id_social": "4DSN3SK9hpm79UiPYgKx3J9sAV4XbSPNkc15u1u7PCXy-0-widget", "block_id": 120166680, "block_timestamp": "2024-05-31T23:45:45.327Z", "signer_id": "hyperbuild.near", "widget_name": "explore.every.schema", "source_code": "const accountId = props.accountId ?? \"*\" ?? context.accountId;\nconst schemaName = props.schemaName || \"schema\";\nconst tag = props.tag;\nconst metadataTemplate =\n  props.metadataTemplate || \"efiz.near/widget/every.type.metadata\";\nlet keys = `${accountId ?? \"*\"}/${schemaName}/*`;\nif (tag) {\n  const taggedWidgets = Social.keys(\n    `${accountId ?? \"*\"}/${schemaName}/*/metadata/tags/${tag}`,\n    \"final\"\n  );\n  if (taggedWidgets === null) {\n    return render(\"Loading tags\");\n  }\n  keys = Object.entries(taggedWidgets)\n    .map((kv) =>\n      Object.keys(kv[1][schemaName]).map((w) => `${kv[0]}/${schemaName}/${w}`)\n    )\n    .flat();\n  if (!keys.length) {\n    return render(`No schemas found by tag #${tag}`);\n  }\n}\nconst data = Social.keys(keys, \"final\", {\n  return_schema: \"BlockHeight\",\n  limit: 1,\n});\nif (data === null) {\n  return <p>\"Loading\"</p>;\n}\nconst processData = (data) => {\n  const accounts = Object.entries(data);\n  const allItems = accounts\n    .map((account) => {\n      const accountId = account[0];\n      return Object.entries(account[1][schemaName]).map((kv) => ({\n        accountId,\n        schemaName: kv[0],\n        blockHeight: kv[1],\n      }));\n    })\n    .flat();\n  allItems.sort((a, b) => b.blockHeight - a.blockHeight);\n  return allItems;\n};\nconst renderItem = (a) => {\n  return (\n    <div className=\"mb-3\" key={JSON.stringify(a)} style={{ minHeight: \"10em\" }}>\n      <Widget\n        src=\"efiz.near/widget/every.type.metadata\"\n        props={{\n          accountId: a.accountId,\n          widgetName: a.schemaName,\n          blockHeight: a.blockHeight,\n        }}\n      />\n    </div>\n  );\n};\nif (JSON.stringify(data) !== JSON.stringify(state.data || {})) {\n  State.update({\n    data,\n    allItems: processData(data),\n  });\n}\nreturn (\n  <div className=\"px-2 mx-auto\">\n    {(accountId || tag) && (\n      <div className=\"mb-2\">\n        Filter:\n        {accountId && (\n          <a className=\"btn btn-outline-primary\">\n            <Widget\n              src=\"mob.near/widget/ProfileLine\"\n              props={{ accountId, link: false }}\n            />\n            <i className=\"bi bi-x-square\"></i>\n          </a>\n        )}\n        {tag && (\n          <a className=\"btn btn-outline-primary\">\n            <span className=\"badge text-bg-secondary\">#{tag}</span>\n            <i className=\"bi bi-x-square\"></i>\n          </a>\n        )}\n      </div>\n    )}\n    <Widget\n      src=\"efiz.near/widget/ItemFeed\"\n      props={{ items: state.allItems || [], renderItem }}\n    />\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hyperbuild.near/widget/explore.every.schema", "fact_widget_deployments_id": "b4a3422f9acfb6873c23c39f5bf113c5", "inserted_timestamp": "2024-06-01T02:00:15.259Z", "modified_timestamp": "2024-06-01T02:00:15.259Z", "__row_index": 0}