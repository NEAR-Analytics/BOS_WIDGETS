{"tx_hash": "CC9GcHy83rphSqwYdFGRGRyFvEi4uTU9wceCkLZk2NT3", "action_id_social": "4DSN3SK9hpm79UiPYgKx3J9sAV4XbSPNkc15u1u7PCXy-0-widget", "block_id": 120166680, "block_timestamp": "2024-05-31T23:45:45.327Z", "signer_id": "hyperbuild.near", "widget_name": "profile.cleanup", "source_code": "const accountId = context.accountId;\nif (!accountId) {\n  return \"Please sign in with NEAR wallet\";\n}\nState.init({\n  selectedKeys: {},\n  nonce: 0,\n});\nconst value = Social.getr(accountId, undefined, {\n  nonce: state.nonce,\n});\nconst extractKeys = (data, prefix) =>\n  Object.entries(data)\n    .map((kv) =>\n      typeof kv[1] === \"string\"\n        ? { key: `${prefix}${kv[0]}`, value: kv[1] }\n        : extractKeys(kv[1], `${prefix}${kv[0]}/`)\n    )\n    .flat();\nconst kvs = extractKeys(value || {}, \"\");\nkvs.sort((a, b) => (a.key < b.key ? -1 : a.key > b.key));\nconst hasKey = (key) => {\n  let t = state.selectedKeys;\n  key.split(\"/\").forEach((k) => {\n    t = t[k];\n  });\n  return t === null;\n};\nconst onSelect = (key) => {\n  const val = hasKey(key) ? undefined : null;\n  let t = state.selectedKeys;\n  const path = key.split(\"/\");\n  path.slice(0, -1).forEach((k) => {\n    t[k] = t[k] || {};\n    t = t[k];\n  });\n  t[path[path.length - 1]] = val;\n  State.update();\n};\nreturn (\n  <div>\n    <h4>Select keys to delete</h4>\n    <table className=\"table table-striped\">\n      <thead>\n        <tr>\n          <th>X</th>\n          <th>Key</th>\n          <th>Value</th>\n        </tr>\n      </thead>\n      <tbody>\n        {kvs.map((kv) => {\n          return (\n            <tr>\n              <td>\n                <input\n                  className=\"form-check-input\"\n                  type=\"checkbox\"\n                  checked={hasKey(kv.key)}\n                  onChange={() => onSelect(kv.key)}\n                />\n              </td>\n              <td className=\"text-truncate font-monospace\">{kv.key}</td>\n              <td className=\"text-truncate font-monospace\">{kv.value}</td>\n            </tr>\n          );\n        })}\n      </tbody>\n    </table>\n    <div>\n      <CommitButton\n        data={state.selectedKeys}\n        disabled={Object.keys(state.selectedKeys).length === 0}\n        onCommit={() =>\n          State.update({ selectedKeys: {}, nonce: state.nonce + 1 })\n        }\n      >\n        Delete selected keys\n      </CommitButton>\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hyperbuild.near/widget/profile.cleanup", "fact_widget_deployments_id": "ebfb4fbbd99ad187500651913cc3f63e", "inserted_timestamp": "2024-06-01T02:00:15.259Z", "modified_timestamp": "2024-06-01T02:00:15.259Z", "__row_index": 0}