{"tx_hash": "CC9GcHy83rphSqwYdFGRGRyFvEi4uTU9wceCkLZk2NT3", "action_id_social": "4DSN3SK9hpm79UiPYgKx3J9sAV4XbSPNkc15u1u7PCXy-0-widget", "block_id": 120166680, "block_timestamp": "2024-05-31T23:45:45.327Z", "signer_id": "hyperbuild.near", "widget_name": "tools.files.module.crypto", "source_code": "// Uint8Array -> Array\nconst array2buf = (array) => Array.from(array);\n// Uint8Array -> str\nconst arr2str = (array) => {\n  var result = \"\";\n  for (var i = 0; i < array.length; i++) {\n    result += String.fromCharCode(array[i]);\n  }\n  return result;\n};\n// str -> Uint8Array\nconst str2array = (str) => {\n  return new Uint8Array(Array.from(str).map((letter) => letter.charCodeAt(0)));\n};\n// accountId: str, password: str\nconst newSecretKey = (accountId, password) => {\n  const hashed_id = nacl.hash(str2array(accountId));\n  const hashed_pw = nacl.hash(str2array(password));\n  const sk = new Uint8Array(nacl.secretbox.keyLength);\n  for (var i = 0; i < hashed_id.length; i++) {\n    const sk_i = i % sk.length;\n    if (i >= sk.length) {\n      sk[sk_i] = sk[sk_i] + (hashed_id[i] + hashed_pw[i]);\n    } else {\n      sk[sk_i] = hashed_id[i] + hashed_pw[i];\n    }\n  }\n  return sk;\n};\nconst newNonce = (message) => {\n  const hash = nacl.hash(message);\n  const nonce = new Uint8Array(nacl.secretbox.nonceLength);\n  for (var i = 0; i < hash.length; i++) {\n    const n_i = i % nonce.length;\n    if (i >= nonce.length) {\n      nonce[n_i] += hash[i];\n    } else {\n      nonce[n_i] = i & hash[i];\n    }\n  }\n  return nonce;\n};\n// message: Uint8Array\nconst encrypt = (message, storageSk) => {\n  const nonce = newNonce(message);\n  const ciphertext = nacl.secretbox(message, nonce, storageSk);\n  return {\n    nonce: Array.from(nonce),\n    ciphertext: Array.from(ciphertext),\n  };\n};\n// message: str\nconst encryptStr = (text, storageSk) => {\n  return encrypt(str2array(text), storageSk);\n};\n// message: JS Object\nconst encryptObject = (obj, storageSk) => {\n  return encrypt(str2array(JSON.stringify(obj)), storageSk);\n};\n// nonce: Uint8Array\n// ciphertext: Uint8Array\n// storageSk: Uint8Array\nconst decrypt = (nonce, ciphertext, storageSk) => {\n  return nacl.secretbox.open(ciphertext, nonce, storageSk);\n};\n// message: JS Object\nconst decryptObject = (nonce, ciphertext, storageSk) => {\n  return JSON.parse(arr2str(decrypt(nonce, ciphertext, storageSk)));\n};\nreturn {\n  encrypt,\n  encryptStr,\n  encryptObject,\n  decrypt,\n  decryptObject,\n  newSecretKey,\n};\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hyperbuild.near/widget/tools.files.module.crypto", "fact_widget_deployments_id": "8c106bc5e223822c119ac91ef54cc739", "inserted_timestamp": "2024-06-01T02:00:15.259Z", "modified_timestamp": "2024-06-01T02:00:15.259Z", "__row_index": 0}