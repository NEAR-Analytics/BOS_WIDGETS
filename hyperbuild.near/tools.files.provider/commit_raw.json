{"tx_hash": "CC9GcHy83rphSqwYdFGRGRyFvEi4uTU9wceCkLZk2NT3", "action_id_social": "4DSN3SK9hpm79UiPYgKx3J9sAV4XbSPNkc15u1u7PCXy-0-widget", "block_id": 120166680, "block_timestamp": "2024-05-31T23:45:45.327Z", "signer_id": "hyperbuild.near", "widget_name": "tools.files.provider", "source_code": "const path = props.path || context.accountId;\nif (!path) return <p>Please login.</p>;\nconst getSecretKey = () => {\n  const accountId = context.accountId;\n  if (!accountId) {\n    return null;\n  }\n  const registeredPublicKey = Social.get(\n    `${accountId}/private_message/public_key`\n  );\n  const savedSecretKeyBase64 = Storage.privateGet(\"secretKey\");\n\n  if (savedSecretKeyBase64 === null || registeredPublicKey === null) {\n    return null;\n  }\n\n  return savedSecretKeyBase64;\n};\n\nconst savedSecretKeyBase64 = getSecretKey();\nif (!savedSecretKeyBase64) {\n  return \"Enter a Secret Key or Password to unlock your files.\";\n}\nState.init({\n  layout: \"LIST\",\n  path,\n  history: [path],\n  currentHistoryIndex: 0,\n  showPreview: false,\n  selectedPath: \"\",\n  filesSource: \"BOS_IPFS\",\n  decryptSk: new Uint8Array(Buffer.from(savedSecretKeyBase64, \"base64\")), // Convert base64 to Uint8Array\n});\nfunction isNearAccount(str) {\n  return typeof str === \"string\" && str.endsWith(\".near\");\n}\nfunction setPath(v) {\n  const updatedHistory = state.history\n    .slice(0, state.currentHistoryIndex + 1)\n    .concat(v);\n  const parts = v.split(\"/\");\n  const lastPart = parts[parts.length - 1];\n  if (isNearAccount(lastPart)) {\n    v = lastPart;\n  }\n  State.update({\n    path: v,\n    history: updatedHistory,\n    currentHistoryIndex: updatedHistory.length - 1,\n  });\n}\nfunction setFilesSource(source) {\n  State.update({\n    filesSource: source,\n  });\n  console.log(\"File source set to:\", state.filesSource);\n}\nfunction goBack() {\n  // Check if we can go back\n  if (state.currentHistoryIndex > 0) {\n    const newIndex = state.currentHistoryIndex - 1;\n    State.update({\n      currentHistoryIndex: newIndex,\n      path: state.history[newIndex],\n    });\n  }\n}\nfunction goForward() {\n  // Check if we can go forward\n  if (state.currentHistoryIndex < state.history.length - 1) {\n    const newIndex = state.currentHistoryIndex + 1;\n    State.update({\n      currentHistoryIndex: newIndex,\n      path: state.history[newIndex],\n    });\n  }\n}\nfunction setSelectedPath(v) {\n  State.update({ selectedPath: v });\n}\nfunction setHistory(v) {\n  State.update({ history: v });\n}\nfunction setLayout(v) {\n  State.update({ layout: v });\n}\nfunction togglePreview() {\n  State.update({ showPreview: !state.showPreview });\n}\nconst Children = props.Children;\nreturn (\n  <Children\n    setPath={setPath}\n    setFilesSource={setFilesSource}\n    setHistory={setHistory}\n    setLayout={setLayout}\n    showPreview={state.showPreview}\n    togglePreview={togglePreview}\n    selectedPath={state.selectedPath}\n    setSelectedPath={setSelectedPath}\n    path={state.path}\n    layout={state.layout}\n    goBack={goBack}\n    goForward={goForward}\n    decryptSk={state.decryptSk} // Ensure decryptSk is passed here\n  />\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hyperbuild.near/widget/tools.files.provider", "fact_widget_deployments_id": "ba0e0801e443c62b8f1b70b35f9c9bb6", "inserted_timestamp": "2024-06-01T02:00:15.259Z", "modified_timestamp": "2024-06-01T02:00:15.259Z", "__row_index": 0}