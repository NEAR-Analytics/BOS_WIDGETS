{"tx_hash": "CC9GcHy83rphSqwYdFGRGRyFvEi4uTU9wceCkLZk2NT3", "action_id_social": "4DSN3SK9hpm79UiPYgKx3J9sAV4XbSPNkc15u1u7PCXy-0-widget", "block_id": 120166680, "block_timestamp": "2024-05-31T23:45:45.327Z", "signer_id": "hyperbuild.near", "widget_name": "tools.nearfs.imageUpload", "source_code": "// fork_Of: \"vlad.near/widget/NEARFSImageUpload\"\ninitState({\n  img: null,\n});\n\nconst networkId = \"mainnet\";\nconst domain = {\n  testnet: \"testnet.page\",\n  mainnet: \"near.page\",\n}[networkId];\n\n// Code mostly taken from https://github.com/NearSocial/viewer/pull/97\n\nconst ipfsUrl = (cid) => `https://ipfs.web4.${domain}/ipfs/${cid}`;\n\nconst filesOnChange = (files) => {\n  if (files?.length > 0) {\n    State.update({\n      img: {\n        uploading: true,\n        cid: null,\n      },\n    });\n    const body = files[0];\n\n    Near.call(\n      \"social.near\",\n      \"fs_store\",\n      Uint8Array.from(body.arrayBuffer())\n    ).then((res) => {\n      // TODO: hash\n      //   const cid = res.body.cid;\n      //   State.update({\n      //     img: {\n      //       cid,\n      //     },\n      //   });\n    });\n  } else {\n    State.update({\n      img: null,\n    });\n  }\n};\n\nreturn (\n  <div className=\"d-inline-block\">\n    {state.img?.cid && (\n      <div\n        className=\"d-inline-block me-2 overflow-hidden align-middle\"\n        style={{ width: \"2.5em\", height: \"2.5em\" }}\n      >\n        <img\n          className=\"rounded w-100 h-100\"\n          style={{ objectFit: \"cover\" }}\n          src={ipfsUrl(state.img?.cid)}\n          alt=\"upload preview\"\n        />\n      </div>\n    )}\n    <Files\n      multiple={false}\n      accepts={[\"image/*\"]}\n      minFileSize={1}\n      clickable\n      className=\"btn btn-outline-primary\"\n      onChange={filesOnChange}\n    >\n      {state.img?.uploading ? (\n        <>{Loading} Uploading</>\n      ) : state.img?.cid ? (\n        \"Replace\"\n      ) : (\n        \"Upload an Image\"\n      )}\n    </Files>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hyperbuild.near/widget/tools.nearfs.imageUpload", "fact_widget_deployments_id": "8b0d9d654f3fe1a09d7c89475c64aea6", "inserted_timestamp": "2024-06-01T02:00:15.259Z", "modified_timestamp": "2024-06-01T02:00:15.259Z", "__row_index": 0}