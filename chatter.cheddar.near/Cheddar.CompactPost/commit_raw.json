{"tx_hash": "C5Zw7oKSXTy2so5VhfS27bzweiQVpnL7MXzsK91MbCDE", "action_id_social": "8iCiE2ntyD8rF1LDbU2gpLwGr9T7G8srEF7dUpPvHCAM-0-widget", "block_id": 121379831, "block_timestamp": "2024-06-17T18:03:28.914Z", "signer_id": "chatter.cheddar.near", "widget_name": "Cheddar.CompactPost", "source_code": "// Cheddar.CompactPost\n\nconst {\n    widgets,\n    article,\n    kanbanColumns,\n    handleOpenArticle,\n    handleFilterArticles,\n    handleShareButton,\n    colLabel,\n    baseActions,\n} = props\n\nState.init({\n    showModal: false,\n})\n\nfunction compactPostStateUpdate(obj) {\n    State.update(obj)\n}\n\nfunction onCommit() {\n    State.update({ showModal: false })\n}\n\nfunction onCancel() {\n    State.update({ showModal: false })\n}\n\nfunction moveArticleListener() {\n    //TODO add createArticle function\n}\n\nfunction getArticleData() {\n    let newTags = article.value.articleData.tags.filter((tag) => {\n        let lowerCaseTag = tag.toLowerCase().replace(` `, '-')\n\n        const lowercaseLabels = []\n        kanbanColumns.forEach((col) =>\n            lowercaseLabels.push(col.toLowerCase().replace(` `, '-'))\n        )\n\n        return !lowercaseLabels.includes(lowerCaseTag)\n    })\n\n    newTags.push(state.newLabel.toLowerCase().replace(` `, '-'))\n\n    let newArticleData = article\n    newArticleData.tags = newTags\n\n    return newArticleData\n}\n\nconst Spinner = () => {\n    return (\n        <SpinnerContainer\n            className=\"spinner-border text-secondary\"\n            role=\"status\"\n        >\n            <span className=\"sr-only\" title=\"Loading...\"></span>\n        </SpinnerContainer>\n    )\n}\n\nconst ModalContainer = styled.div`\n    position: fixed;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    top: 0;\n    left: 0;\n    height: 100%;\n    width: 100%;\n    backdrop-filter: blur(10px);\n    z-index: 1;\n`\n\nconst ChangeLabelMainContainer = styled.div`\n    display: flex;\n    flex-direction: column;\n    background: white;\n    padding: 1rem;\n    border-radius: 12px;\n    border: 1px solid black;\n`\n\nconst ClosePopUpContainer = styled.div`\n    display: flex;\n    flex-direction: row-reverse;\n`\n\nconst CloseIcon = styled.div`\n    cursor: pointer;\n`\n\nfunction handleLabelSelection(selectedLabel) {\n    State.update({\n        newLabel: selectedLabel.replace(` `, '-'),\n    })\n}\n\nfunction closeModal() {\n    State.update({ showModal: false })\n}\n\nconst modal = (\n    <ModalContainer>\n        <ChangeLabelMainContainer>\n            <ClosePopUpContainer>\n                <CloseIcon className=\"bi bi-x\" onClick={closeModal}></CloseIcon>\n            </ClosePopUpContainer>\n            <Widget\n                src={\n                    widgets.views.standardWidgets.newStyledComponents.Input\n                        .Select\n                }\n                props={{\n                    label: 'Select new label',\n                    placeholder: kanbanColumns[0],\n                    value: state.newLabel ?? colLabel,\n                    options: kanbanColumns.map((label) => {\n                        return { title: label, value: col }\n                    }),\n                    onChange: handleLabelSelection,\n                }}\n            />\n            <Widget\n                src={\n                    widgets.views.standardWidgets.newStyledComponents.Input\n                        .Button\n                }\n                props={{\n                    className: 'primary my-3',\n                    onClick: moveArticleListener,\n                    disabled: !state.newLabel,\n                    children: (\n                        <div className=\"d-flex justify-conten-center align-items-center\">\n                            {state.saving ? (\n                                <Spinner />\n                            ) : (\n                                <>\n                                    <span>Move</span>\n                                    <i className=\"bi bi-check2\"></i>\n                                </>\n                            )}\n                        </div>\n                    ),\n                }}\n            />\n        </ChangeLabelMainContainer>\n    </ModalContainer>\n)\n\nconst header = (\n    <div className=\"card-header\">\n        <small className=\"text-muted\">\n            <div className=\"row justify-content-between\">\n                <div className=\"w-75 text-truncate\">\n                    <a\n                        href={`#/mob.near/widget/ProfilePage?accountId=${article.value.metadata.author}`}\n                        target=\"_blank\"\n                        className=\"link-dark text-truncate w-100\"\n                    >\n                        <Widget\n                            src={widgets.views.standardWidgets.profileImage}\n                            props={{\n                                metadata,\n                                accountId: article.value.metadata.author,\n                                widgetName,\n                                style: {\n                                    height: '1.5em',\n                                    width: '1.5em',\n                                    minWidth: '1.5em',\n                                },\n                            }}\n                        />\n                        <span className=\"text-muted\">\n                            @{article.value.metadata.author}\n                        </span>\n                    </a>\n                </div>\n                <div className=\"w-25\">\n                    <div className=\"d-flex justify-content-end\">\n                        <Widget\n                            src={\n                                widgets.views.standardWidgets\n                                    .newStyledComponents.Input.Button\n                            }\n                            props={{\n                                size: 'sm',\n                                className: 'primary outline icon',\n                                children: <i className=\"bi bi-share\"></i>,\n                                onClick: () =>\n                                    handleShareButton(true, {\n                                        key: 'sb',\n                                        type: 'sharedBlockheight',\n                                        value: article.value.metadata\n                                            .blockHeight,\n                                    }),\n                            }}\n                        />\n                    </div>\n                </div>\n            </div>\n        </small>\n    </div>\n)\n\nconst borders = {\n    Idea: 'border-secondary',\n    Comment: 'border-secondary',\n    Submission: 'border-secondary',\n    Attestation: 'border-secondary',\n    Sponsorship: 'border-secondary',\n}\n\nconst CursorPointer = styled.p`\n    cursor: pointer;\n`\n\nfunction toggleShowModal() {\n    State.update({ showModal: !state.showModal })\n}\n\nconst articleTags = article.value.articleData.tags ? (\n    <div className=\"card-title\">\n        {article.value.articleData.tags.map((tag) => {\n            const filter = { filterBy: 'tag', value: tag }\n            return (\n                <CursorPointer onClick={() => handleFilterArticles(filter)}>\n                    <Widget\n                        src={\n                            widgets.views.standardWidgets.newStyledComponents\n                                .Element.Badge\n                        }\n                        props={{\n                            children: tag,\n                            variant: 'round primary',\n                            size: 'sm',\n                        }}\n                    />\n                </CursorPointer>\n            )\n        })}\n    </div>\n) : null\n\nconst articleTitle = (\n    <div className=\"card-text\">\n        <div className=\"row justify-content-between\">\n            <h6 className=\"col-9\">{article.value.articleData.title}</h6>\n        </div>\n    </div>\n)\n\nconst footerActionButtons = (\n    <div className=\"d-flex justify-content-start w-100\">\n        <Widget\n            src={widgets.views.standardWidgets.newStyledComponents.Input.Button}\n            props={{\n                children: (\n                    <div className=\"d-flex align-items-center justify-content-center\">\n                        <span className=\"mx-1\">Move</span>\n                        <i className=\"bi bi-arrows\"></i>\n                    </div>\n                ),\n                disabled:\n                    context.accountId !== article.value.articleData.author,\n                size: 'sm',\n                className: 'primary outline w-25',\n                onClick: toggleShowModal,\n            }}\n        />\n        <Widget\n            src={widgets.views.standardWidgets.newStyledComponents.Input.Button}\n            props={{\n                children: (\n                    <div className=\"d-flex align-items-center justify-content-center\">\n                        <span className=\"mx-1\">View</span>\n                        <i className=\"bi bi-eye fs-6\"></i>\n                    </div>\n                ),\n                size: 'sm',\n                className: 'primary mx-1 w-25',\n                onClick: () => {\n                    handleOpenArticle(article)\n                },\n            }}\n        />\n    </div>\n)\n\nconst CallLibrary = styled.div`\n    display: block;\n`\n\nconst Card = styled.div`\n    user-select: none;\n    &:hover {\n        box-shadow: rgba(3, 102, 214, 0.3) 0px 0px 0px 3px;\n    }\n`\n\nconst LimitedMarkdown = styled.div`\n    max-height: 6em;\n`\n\n// Should make sure the posts under the currently top viewed post are limited in size.\nconst descriptionArea = (\n    <LimitedMarkdown className=\"overflow-auto\">\n        <Markdown\n            className=\"card-text\"\n            text={article.value.articleData.body}\n        ></Markdown>\n    </LimitedMarkdown>\n)\n\nreturn (\n    <>\n        {state.showModal && modal}\n        <Card className={`card my-2 ${borders['Submission']}`}>\n            {header}\n            <div className=\"card-body\">\n                {articleTitle}\n                {descriptionArea}\n                {articleTags}\n                {footerActionButtons}\n            </div>\n        </Card>\n    </>\n)\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/chatter.cheddar.near/widget/Cheddar.CompactPost", "fact_widget_deployments_id": "515dd855f5d0f62af3c308061d17717b", "inserted_timestamp": "2024-06-17T19:54:47.895Z", "modified_timestamp": "2024-06-17T19:54:47.895Z", "__row_index": 0}