{"tx_hash": "7gkiALJXKt7JmYFG7628MFDWrwfMuBjBtuQheLNFPgFN", "action_id_social": "39XZERouuDKe5K7bM7LATjVoZFWcCiBXZ3kirV13jpEr-0-widget", "block_id": 113359361, "block_timestamp": "2024-02-22T14:29:26.972Z", "signer_id": "dropcast.near", "widget_name": "import_bot", "source_code": "const accountId = context.accountId;\nconst Owner = \"dropcast.near\";\nconst TOKEN = props.TOKEN || \"\";\nconst CLIENT_ID = \"1206878767633534976\";\nconst API_URL = props.API_URL || \"http://localhost:3000\";\nconst data = props.data || {};\nconst onClose = props.onClose || (() => {});\nconst changePage = props.changePage || ((page) => {});\n\n//Styles\nconst Wrapper = styled.div`\n    top: 0px;\n    display: flex;\n    width: 100%;\n    height: 100%;\n    padding: 64px;\n    position: absolute;\n    align-items: center;\n    flex-direction: column;\n    color: rgb(229 229 229);\n    justify-content: center;\n    background: rgba(23,23,23, 0.7);\n    @media (max-width: 620px) {\n      padding: 25px;\n    }  \n`;\n\nconst Card = styled.div`\n    gap: 10px;\n    display: flex;\n    padding: 35px;\n    max-width: 430px;\n    border-radius: 8px;\n    position: relative;\n    text-align: center;\n    align-items: center;\n    flex-direction: column;\n    justify-content: center;\n    background: rgb(38, 38, 38);\n    @media (max-width: 620px) {\n      padding: 15px;\n      height: 100%;\n      .menu {\n        width: 74vw;\n      }\n    }  \n`;\n\nconst StepButton = styled.button`\n    color: #FFF;\n    padding: 12px 40px;\n    border-radius: 6px;\n    background-image: linear-gradient(to right, rgb(147, 51, 234), rgb(99, 102, 241));\n`;\n\nconst StepButtonLink = styled.a`\n    color: #FFF;\n    padding: 12px 40px;\n    border-radius: 6px;\n    background-image: linear-gradient(to right, rgb(147, 51, 234), rgb(99, 102, 241));\n`;\n\nconst CloseButton = styled.button`\n    top: 10px;\n    padding: 0;\n    z-index: 1;\n    width: 29px;\n    right: 10px;\n    height: 29px;\n    color: white;\n    border: 1px solid;  \n    position: absolute;\n    align-items: center;\n    border-radius: 50px;  \n    justify-content: center;\n`;\n\nState.init({\n  roles: data.type === \"edit\" ? JSON.parse(data.roles) : [],\n  discord: data.type === \"edit\",\n  submitted: false,\n  error: \"\",\n});\n\nconst convertObject = (params) => {\n  return Object.keys(params)\n    .map((param) => `${param}=${params[param]}`)\n    .join(\"&\");\n};\n\nconst handleImportBot = () => {\n  let promise = asyncFetch(\n    `${API_URL}/api/project/roles?guild_id=${data.project_id}`,\n    {\n      headers: {\n        \"Content-Type\": \"application/x-www-form-urlencoded\",\n        \"x-auth-token\": TOKEN,\n      },\n      method: \"GET\",\n    }\n  );\n\n  promise.then((data) => {\n    if (data.status === 200) {\n      State.update({\n        discord: true,\n        roles: data.body,\n      });\n    } else {\n      State.update({\n        error: data.body,\n      });\n    }\n  });\n};\n\nconst handleSubmit = () => {\n  let promise = asyncFetch(`${API_URL}/api/project`, {\n    headers: {\n      \"Content-Type\": \"application/x-www-form-urlencoded\",\n      \"x-auth-token\": TOKEN,\n    },\n    method: \"POST\",\n    body: convertObject({\n      ...data,\n      roles: JSON.stringify(state.roles),\n    }),\n  });\n\n  promise.then((data) => {\n    if (data.status === 200) {\n      State.update({\n        submitted: true,\n      });\n    } else {\n      State.update({\n        error: data.body,\n      });\n    }\n  });\n};\n\nconst onChange = (value, key) => {\n  const changed = state.roles.map((role) => ({\n    ...role,\n    selected: role.id === key ? value : role.selected,\n  }));\n  State.update({\n    ...state,\n    roles: changed,\n  });\n};\n\nreturn (\n  <Wrapper>\n    <Card>\n      <CloseButton className=\"btn\" onClick={onClose}>\n        <svg\n          xmlns=\"http://www.w3.org/2000/svg\"\n          width=\"1em\"\n          height=\"1em\"\n          viewBox=\"0 0 24 24\"\n        >\n          <path\n            fill=\"currentColor\"\n            d=\"M13.46 12L19 17.54V19h-1.46L12 13.46L6.46 19H5v-1.46L10.54 12L5 6.46V5h1.46L12 10.54L17.54 5H19v1.46z\"\n          />\n        </svg>\n      </CloseButton>\n      {!state.discord && (\n        <>\n          <h4>Import Discrod BOT</h4>\n          <p>\n            {`Please Import bot into discord and place it above all the Allowlist\n        roles in Settings -> Roles`}\n          </p>\n          <StepButtonLink\n            href={`https://discord.com/api/oauth2/authorize?client_id=${CLIENT_ID}&permissions=268435457&scope=bot&guild_id=${data.project_id}&disable_guild_select=true`}\n            target=\"_blank\"\n            className=\"btn\"\n            onClick={handleImportBot}\n          >\n            Import Bot Into Discord\n          </StepButtonLink>\n        </>\n      )}\n      {state.discord && !state.submitted && (\n        <>\n          <h4>{`Choose Allowlist Role(s)`}</h4>\n          <p>\n            {`Please choose allowlist roles (if any). You can update these at anytime `}\n          </p>\n          <div\n            className=\"d-flex flex-column w-100\"\n            style={{ maxHeight: 300, overflow: \"auto\", paddingLeft: \"15%\" }}\n          >\n            {state.roles.map((role) => (\n              <Widget\n                key={role.id}\n                props={{\n                  value: role.id,\n                  label: role.name,\n                  checked: role.selected,\n                  onChange: (value) => {\n                    onChange(value, role.id);\n                  },\n                }}\n                src={`frichard5.near/widget/NDC-checkbox`}\n              />\n            ))}\n          </div>\n          <StepButton\n            className=\"btn\"\n            disabled={!state.roles.length}\n            onClick={handleSubmit}\n          >\n            Submit\n          </StepButton>\n        </>\n      )}\n      {state.submitted && (\n        <>\n          <h4>{`Listed Successfully`}</h4>\n          <p>\n            {`You can manage your project information and use admin functions from the Manager tab.`}\n          </p>\n          <StepButton className=\"btn\" onClick={() => changePage(\"dashboard\")}>\n            Goto Dashboard\n          </StepButton>\n        </>\n      )}\n    </Card>\n  </Wrapper>\n);\n", "metadata": {"fork_of": "dropcast.near/widget/import_bot@113358667"}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/dropcast.near/widget/import_bot", "fact_widget_deployments_id": "98f552150a7567f17d38e01edca17a7b", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 31}