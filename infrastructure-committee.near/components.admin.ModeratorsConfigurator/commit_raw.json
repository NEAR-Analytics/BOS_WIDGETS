{"tx_hash": "4Q7yr7KcLx9Lo5dYuoRNksVBuKn1VBMVXBJ5js3AuFgs", "action_id_social": "4Uh472Ftkv8JVat6ucETB7n9vzWyX9pJXmYximN4dFYq-0-widget", "block_id": 120709548, "block_timestamp": "2024-06-08T12:38:26.705Z", "signer_id": "infrastructure-committee.near", "widget_name": "components.admin.ModeratorsConfigurator", "source_code": "/*\nLicense: MIT\nAuthor: devhub.near\nHomepage: https://github.com/NEAR-DevHub/near-prpsls-bos#readme\n*/\n/* INCLUDE: \"includes/common.jsx\" */\nconst REPL_DEVHUB = \"devhub.near\";\nconst REPL_INFRASTRUCTURE_COMMITTEE = \"infrastructure-committee.near\";\nconst REPL_INFRASTRUCTURE_COMMITTEE_CONTRACT =\n  \"infrastructure-committee.near\";\nconst REPL_RPC_URL = \"https://rpc.mainnet.near.org\";\nconst REPL_NEAR = \"near\";\nconst RFP_IMAGE =\n  \"https://ipfs.near.social/ipfs/bafkreicbygt4kajytlxij24jj6tkg2ppc2dw3dlqhkermkjjfgdfnlizzy\";\n\nconst RFP_FEED_INDEXER_QUERY_NAME =\n  \"polyprogrammist_near_devhub_ic_v1_rfps_with_latest_snapshot\";\n\nconst RFP_INDEXER_QUERY_NAME =\n  \"polyprogrammist_near_devhub_ic_v1_rfp_snapshots\";\n\nconst PROPOSAL_FEED_INDEXER_QUERY_NAME =\n  \"polyprogrammist_near_devhub_ic_v1_proposals_with_latest_snapshot\";\n\nconst PROPOSAL_QUERY_NAME =\n  \"polyprogrammist_near_devhub_ic_v1_proposal_snapshots\";\nconst RFP_TIMELINE_STATUS = {\n  ACCEPTING_SUBMISSIONS: \"ACCEPTING_SUBMISSIONS\",\n  EVALUATION: \"EVALUATION\",\n  PROPOSAL_SELECTED: \"PROPOSAL_SELECTED\",\n  CANCELLED: \"CANCELLED\",\n};\n\nconst PROPOSAL_TIMELINE_STATUS = {\n  DRAFT: \"DRAFT\",\n  REVIEW: \"REVIEW\",\n  APPROVED: \"APPROVED\",\n  REJECTED: \"REJECTED\",\n  CANCELED: \"CANCELLED\",\n  APPROVED_CONDITIONALLY: \"APPROVED_CONDITIONALLY\",\n  PAYMENT_PROCESSING: \"PAYMENT_PROCESSING\",\n  FUNDED: \"FUNDED\",\n};\n\nconst QUERYAPI_ENDPOINT = `https://near-queryapi.api.pagoda.co/v1/graphql`;\n\nasync function fetchGraphQL(operationsDoc, operationName, variables) {\n  return asyncFetch(QUERYAPI_ENDPOINT, {\n    method: \"POST\",\n    headers: { \"x-hasura-role\": `polyprogrammist_near` },\n    body: JSON.stringify({\n      query: operationsDoc,\n      variables: variables,\n      operationName: operationName,\n    }),\n  });\n}\n\nconst CANCEL_RFP_OPTIONS = {\n  CANCEL_PROPOSALS: \"CANCEL_PROPOSALS\",\n  UNLINK_PROPOSALS: \"UNLINK_PROPOSALSS\",\n  NONE: \"NONE\",\n};\n\nfunction parseJSON(json) {\n  if (typeof json === \"string\") {\n    try {\n      return JSON.parse(json);\n    } catch (error) {\n      return json;\n    }\n  } else {\n    return json;\n  }\n}\n\nfunction isNumber(value) {\n  return typeof value === \"number\";\n}\n\nconst PROPOSALS_APPROVED_STATUS_ARRAY = [\n  PROPOSAL_TIMELINE_STATUS.APPROVED,\n  PROPOSAL_TIMELINE_STATUS.APPROVED_CONDITIONALLY,\n  PROPOSAL_TIMELINE_STATUS.PAYMENT_PROCESSING,\n  PROPOSAL_TIMELINE_STATUS.FUNDED,\n];\n\nfunction getLinkUsingCurrentGateway(url) {\n  const data = fetch(`https://httpbin.org/headers`);\n  const gatewayURL = data?.body?.headers?.Origin ?? \"\";\n  return `https://${\n    gatewayURL.includes(\"near.org\") ? \"dev.near.org\" : \"near.social\"\n  }/${url}`;\n}\n/* END_INCLUDE: \"includes/common.jsx\" */\n\nconst { Tile } = VM.require(\n  `${REPL_DEVHUB}/widget/devhub.components.molecule.Tile`\n) || { Tile: () => <></> };\n\nconst { accessControlInfo, createEditTeam } = props;\n\nconst [editModerators, setEditModerators] = useState(false);\nconst [moderators, setModerators] = useState(\n  accessControlInfo.members_list[\"team:moderators\"].children || []\n);\n\nconst handleEditModerators = () => {\n  createEditTeam({\n    teamName: \"moderators\",\n    description:\n      \"The moderator group has permissions to create and edit RFPs, edit and manage proposals, and manage admins.\",\n    members: moderators,\n    contractCall: \"edit_member\",\n  });\n};\n\nconst handleCancelModerators = () => {\n  setEditModerators(false);\n  setModerators(accessControlInfo.members_list[\"team:moderators\"].children);\n};\n\nreturn (\n  <>\n    <h3>Moderators</h3>\n    <div className=\"card-body\">\n      <h6>\n        The moderator group has permissions to create and edit RFPs, edit and\n        manage proposals, and manage admins.\n      </h6>\n      <Widget\n        src={`${REPL_DEVHUB}/widget/devhub.components.molecule.PostControls`}\n        props={{\n          icon: \"bi bi-gear-wide-connected\",\n          className: \"mb-3\",\n\n          title: \"Edit members\",\n          onClick: () => setEditModerators(!editModerators),\n          testId: \"edit-members\",\n        }}\n      />\n    </div>\n    <Tile className=\"p-3\" style={{ background: \"white\" }}>\n      {editModerators ? (\n        <>\n          <Widget\n            src={`${REPL_INFRASTRUCTURE_COMMITTEE}/widget/components.admin.AccountsEditor`}\n            props={{\n              data: {\n                maxLength: 100,\n                placeholder: \"member.near\",\n                list: moderators,\n              },\n              setList: setModerators,\n              // Could add a check to see if it is an valid account id.\n              validate: (newItem) => true,\n              invalidate: () => null,\n            }}\n          />\n          <div\n            className={\n              \"d-flex align-items-center justify-content-end gap-3 mt-4\"\n            }\n          >\n            <Widget\n              src={`${REPL_DEVHUB}/widget/devhub.components.molecule.Button`}\n              props={{\n                classNames: {\n                  root: \"btn-outline-danger shadow-none border-0\",\n                },\n                label: \"Cancel\",\n                onClick: handleCancelModerators,\n              }}\n            />\n            <Widget\n              src={`${REPL_DEVHUB}/widget/devhub.components.molecule.Button`}\n              props={{\n                classNames: { root: \"btn-success\" },\n                icon: {\n                  type: \"bootstrap_icon\",\n                  variant: \"bi-check-circle-fill\",\n                },\n                label: \"Submit\",\n                onClick: handleEditModerators,\n              }}\n            />\n          </div>\n        </>\n      ) : (\n        <>\n          <div class=\"pt-4\">Members</div>\n          {moderators && (\n            <div class=\"vstack\">\n              {moderators.length ? (\n                moderators.map((child) => (\n                  <Tile className=\"w-25 p-3 m-1\" minHeight={10}>\n                    <Widget\n                      src={`${REPL_DEVHUB}/widget/devhub.components.molecule.ProfileLine`}\n                      props={{ accountId: child }}\n                    />\n                  </Tile>\n                ))\n              ) : (\n                <div>No moderators</div>\n              )}\n            </div>\n          )}\n        </>\n      )}\n    </Tile>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/infrastructure-committee.near/widget/components.admin.ModeratorsConfigurator", "fact_widget_deployments_id": "3ec9e0a013109ef8707ed6ad4d97a57f", "inserted_timestamp": "2024-06-08T14:04:05.979Z", "modified_timestamp": "2024-06-08T14:04:05.979Z", "__row_index": 2}