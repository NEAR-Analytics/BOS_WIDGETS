{"tx_hash": "Dnb4EUHfNTUAkajnLXEvUYfdwhPtB1t7uHDvVXUJe75D", "action_id_social": "ABfmMEgUVhC1KVeYxakAysUxbAMPeXjUf4ZdYLRKDX6x-0-widget", "block_id": 120367764, "block_timestamp": "2024-06-03T19:21:26.515Z", "signer_id": "infrastructure-committee.near", "widget_name": "near-prpsls-bos.components.molecule.Compose", "source_code": "/*\nLicense: MIT\nAuthor: devhub.near\nHomepage: https://github.com/NEAR-DevHub/near-prpsls-bos#readme\n*/\n/* INCLUDE: \"includes/common.jsx\" */\nconst REPL_DEVHUB = \"devhub.near\";\nconst REPL_INFRASTRUCTURE_COMMITTEE = \"infrastructure-committee.near\";\nconst REPL_INFRASTRUCTURE_COMMITTEE_CONTRACT =\n  \"infrastructure-committee.near\";\nconst REPL_RPC_URL = \"https://rpc.mainnet.near.org\";\nconst REPL_NEAR = \"near\";\nconst RFP_IMAGE =\n  \"https://ipfs.near.social/ipfs/bafkreicbygt4kajytlxij24jj6tkg2ppc2dw3dlqhkermkjjfgdfnlizzy\";\n\nconst RFP_FEED_INDEXER_QUERY_NAME =\n  \"polyprogrammist_near_devhub_ic_v1_rfps_with_latest_snapshot\";\n\nconst RFP_INDEXER_QUERY_NAME =\n  \"polyprogrammist_near_devhub_ic_v1_rfp_snapshots\";\n\nconst PROPOSAL_FEED_INDEXER_QUERY_NAME =\n  \"polyprogrammist_near_devhub_ic_v1_proposals_with_latest_snapshot\";\n\nconst PROPOSAL_QUERY_NAME =\n  \"polyprogrammist_near_devhub_ic_v1_proposal_snapshots\";\nconst RFP_TIMELINE_STATUS = {\n  ACCEPTING_SUBMISSIONS: \"ACCEPTING_SUBMISSIONS\",\n  EVALUATION: \"EVALUATION\",\n  PROPOSAL_SELECTED: \"PROPOSAL_SELECTED\",\n  CANCELLED: \"CANCELLED\",\n};\n\nconst PROPOSAL_TIMELINE_STATUS = {\n  DRAFT: \"DRAFT\",\n  REVIEW: \"REVIEW\",\n  APPROVED: \"APPROVED\",\n  REJECTED: \"REJECTED\",\n  CANCELED: \"CANCELLED\",\n  APPROVED_CONDITIONALLY: \"APPROVED_CONDITIONALLY\",\n  PAYMENT_PROCESSING: \"PAYMENT_PROCESSING\",\n  FUNDED: \"FUNDED\",\n};\n\nconst QUERYAPI_ENDPOINT = `https://near-queryapi.api.pagoda.co/v1/graphql`;\n\nasync function fetchGraphQL(operationsDoc, operationName, variables) {\n  return asyncFetch(QUERYAPI_ENDPOINT, {\n    method: \"POST\",\n    headers: { \"x-hasura-role\": `polyprogrammist_near` },\n    body: JSON.stringify({\n      query: operationsDoc,\n      variables: variables,\n      operationName: operationName,\n    }),\n  });\n}\n\nconst CANCEL_RFP_OPTIONS = {\n  CANCEL_PROPOSALS: \"CANCEL_PROPOSALS\",\n  UNLINK_PROPOSALS: \"UNLINK_PROPOSALSS\",\n  NONE: \"NONE\",\n};\n\nfunction parseJSON(json) {\n  if (typeof json === \"string\") {\n    try {\n      return JSON.parse(json);\n    } catch (error) {\n      return json;\n    }\n  } else {\n    return json;\n  }\n}\n\nfunction isNumber(value) {\n  return typeof value === \"number\";\n}\n\nconst PROPOSALS_APPROVED_STATUS_ARRAY = [\n  PROPOSAL_TIMELINE_STATUS.APPROVED,\n  PROPOSAL_TIMELINE_STATUS.APPROVED_CONDITIONALLY,\n  PROPOSAL_TIMELINE_STATUS.PAYMENT_PROCESSING,\n  PROPOSAL_TIMELINE_STATUS.FUNDED,\n];\n/* END_INCLUDE: \"includes/common.jsx\" */\n\nconst EmbeddCSS = `\n  .CodeMirror {\n   margin-inline:10px;\n   border-radius:5px;\n  }\n\n  .editor-toolbar {\n    border: none !important;\n  }\n`;\n\nconst Wrapper = styled.div`\n  .nav-link {\n    color: inherit !important;\n  }\n\n  .card-header {\n    padding-bottom: 0px !important;\n  }\n`;\n\nconst Compose = ({\n  data,\n  onChange,\n  autocompleteEnabled,\n  placeholder,\n  height,\n  embeddCSS,\n  showProposalIdAutoComplete,\n  onChangeKeyup,\n  handler,\n}) => {\n  State.init({\n    data: data,\n    selectedTab: \"editor\",\n    autoFocus: false,\n  });\n\n  useEffect(() => {\n    if (typeof onChange === \"function\") {\n      onChange(state.data);\n    }\n  }, [state.data]);\n\n  useEffect(() => {\n    // for clearing editor after txn approval/ showing draft state\n    if (data !== state.data || handler !== state.handler) {\n      State.update({ data: data, handler: handler });\n    }\n  }, [data, handler]);\n\n  return (\n    <Wrapper>\n      <div className=\"card\">\n        <div className=\"card-header\" style={{ position: \"relative\" }}>\n          <div>\n            <ul class=\"nav nav-tabs\">\n              <li class=\"nav-item\">\n                <button\n                  class={`nav-link ${\n                    state.selectedTab === \"editor\" ? \"active\" : \"\"\n                  }`}\n                  onClick={() =>\n                    State.update({ selectedTab: \"editor\", autoFocus: true })\n                  }\n                >\n                  Write\n                </button>\n              </li>\n              <li class=\"nav-item\">\n                <button\n                  class={`nav-link ${\n                    state.selectedTab === \"preview\" ? \"active\" : \"\"\n                  }`}\n                  onClick={() => State.update({ selectedTab: \"preview\" })}\n                >\n                  Preview\n                </button>\n              </li>\n            </ul>\n          </div>\n        </div>\n\n        {state.selectedTab === \"editor\" ? (\n          <>\n            <Widget\n              src={`${REPL_INFRASTRUCTURE_COMMITTEE}/widget/near-prpsls-bos.components.molecule.SimpleMDE`}\n              props={{\n                data: { handler: state.handler, content: state.data },\n                onChange: (content) => {\n                  State.update({ data: content, handler: \"update\" });\n                },\n                placeholder: placeholder,\n                height,\n                embeddCSS: embeddCSS || EmbeddCSS,\n                showAutoComplete: autocompleteEnabled,\n                showProposalIdAutoComplete: showProposalIdAutoComplete,\n                autoFocus: state.autoFocus,\n                onChangeKeyup: onChangeKeyup,\n              }}\n            />\n          </>\n        ) : (\n          <div className=\"card-body\">\n            <Widget\n              src={`${REPL_DEVHUB}/widget/devhub.components.molecule.MarkdownViewer`}\n              props={{\n                text: state.data,\n              }}\n            />\n          </div>\n        )}\n      </div>\n    </Wrapper>\n  );\n};\n\nreturn Compose(props);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/infrastructure-committee.near/widget/near-prpsls-bos.components.molecule.Compose", "fact_widget_deployments_id": "e067ce9f0d7b4f6ebd90294efd249106", "inserted_timestamp": "2024-06-03T20:42:29.468Z", "modified_timestamp": "2024-06-03T20:42:29.468Z", "__row_index": 3}