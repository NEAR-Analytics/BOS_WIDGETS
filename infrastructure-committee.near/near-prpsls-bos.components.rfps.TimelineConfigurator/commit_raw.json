{"tx_hash": "Dnb4EUHfNTUAkajnLXEvUYfdwhPtB1t7uHDvVXUJe75D", "action_id_social": "ABfmMEgUVhC1KVeYxakAysUxbAMPeXjUf4ZdYLRKDX6x-0-widget", "block_id": 120367764, "block_timestamp": "2024-06-03T19:21:26.515Z", "signer_id": "infrastructure-committee.near", "widget_name": "near-prpsls-bos.components.rfps.TimelineConfigurator", "source_code": "/*\nLicense: MIT\nAuthor: devhub.near\nHomepage: https://github.com/NEAR-DevHub/near-prpsls-bos#readme\n*/\n/* INCLUDE: \"includes/common.jsx\" */\nconst REPL_DEVHUB = \"devhub.near\";\nconst REPL_INFRASTRUCTURE_COMMITTEE = \"infrastructure-committee.near\";\nconst REPL_INFRASTRUCTURE_COMMITTEE_CONTRACT =\n  \"infrastructure-committee.near\";\nconst REPL_RPC_URL = \"https://rpc.mainnet.near.org\";\nconst REPL_NEAR = \"near\";\nconst RFP_IMAGE =\n  \"https://ipfs.near.social/ipfs/bafkreicbygt4kajytlxij24jj6tkg2ppc2dw3dlqhkermkjjfgdfnlizzy\";\n\nconst RFP_FEED_INDEXER_QUERY_NAME =\n  \"polyprogrammist_near_devhub_ic_v1_rfps_with_latest_snapshot\";\n\nconst RFP_INDEXER_QUERY_NAME =\n  \"polyprogrammist_near_devhub_ic_v1_rfp_snapshots\";\n\nconst PROPOSAL_FEED_INDEXER_QUERY_NAME =\n  \"polyprogrammist_near_devhub_ic_v1_proposals_with_latest_snapshot\";\n\nconst PROPOSAL_QUERY_NAME =\n  \"polyprogrammist_near_devhub_ic_v1_proposal_snapshots\";\nconst RFP_TIMELINE_STATUS = {\n  ACCEPTING_SUBMISSIONS: \"ACCEPTING_SUBMISSIONS\",\n  EVALUATION: \"EVALUATION\",\n  PROPOSAL_SELECTED: \"PROPOSAL_SELECTED\",\n  CANCELLED: \"CANCELLED\",\n};\n\nconst PROPOSAL_TIMELINE_STATUS = {\n  DRAFT: \"DRAFT\",\n  REVIEW: \"REVIEW\",\n  APPROVED: \"APPROVED\",\n  REJECTED: \"REJECTED\",\n  CANCELED: \"CANCELLED\",\n  APPROVED_CONDITIONALLY: \"APPROVED_CONDITIONALLY\",\n  PAYMENT_PROCESSING: \"PAYMENT_PROCESSING\",\n  FUNDED: \"FUNDED\",\n};\n\nconst QUERYAPI_ENDPOINT = `https://near-queryapi.api.pagoda.co/v1/graphql`;\n\nasync function fetchGraphQL(operationsDoc, operationName, variables) {\n  return asyncFetch(QUERYAPI_ENDPOINT, {\n    method: \"POST\",\n    headers: { \"x-hasura-role\": `polyprogrammist_near` },\n    body: JSON.stringify({\n      query: operationsDoc,\n      variables: variables,\n      operationName: operationName,\n    }),\n  });\n}\n\nconst CANCEL_RFP_OPTIONS = {\n  CANCEL_PROPOSALS: \"CANCEL_PROPOSALS\",\n  UNLINK_PROPOSALS: \"UNLINK_PROPOSALSS\",\n  NONE: \"NONE\",\n};\n\nfunction parseJSON(json) {\n  if (typeof json === \"string\") {\n    try {\n      return JSON.parse(json);\n    } catch (error) {\n      return json;\n    }\n  } else {\n    return json;\n  }\n}\n\nfunction isNumber(value) {\n  return typeof value === \"number\";\n}\n\nconst PROPOSALS_APPROVED_STATUS_ARRAY = [\n  PROPOSAL_TIMELINE_STATUS.APPROVED,\n  PROPOSAL_TIMELINE_STATUS.APPROVED_CONDITIONALLY,\n  PROPOSAL_TIMELINE_STATUS.PAYMENT_PROCESSING,\n  PROPOSAL_TIMELINE_STATUS.FUNDED,\n];\n/* END_INCLUDE: \"includes/common.jsx\" */\n\nconst stepsArray = [1, 2, 3];\nconst timeline = props.timeline;\nconst disabled = props.disabled;\nconst setTimeline = props.setTimeline ?? (() => {});\n\nconst TimelineStatusOptions = [\n  {\n    label: \"Accepting Submissions\",\n    value: { status: RFP_TIMELINE_STATUS.ACCEPTING_SUBMISSIONS },\n  },\n  {\n    label: \"Evaluation\",\n    value: {\n      status: RFP_TIMELINE_STATUS.EVALUATION,\n    },\n  },\n  {\n    label: \"Proposal Selected\",\n    value: {\n      status: RFP_TIMELINE_STATUS.PROPOSAL_SELECTED,\n    },\n  },\n  {\n    label: \"Cancelled\",\n    value: {\n      status: RFP_TIMELINE_STATUS.CANCELLED,\n    },\n  },\n];\n\nconst Container = styled.div`\n  .circle-lg {\n    width: 15px;\n    height: 15px;\n    border-radius: 50%;\n    border: 1px solid grey;\n  }\n\n  .green-fill {\n    background-color: rgb(4, 164, 110) !important;\n    border-color: rgb(4, 164, 110) !important;\n    color: white !important;\n  }\n\n  .yellow-fill {\n    border-color: #ff7a00 !important;\n  }\n\n  .vertical-line {\n    width: 2px;\n    height: 85px;\n    background-color: lightgrey;\n  }\n\n  @media screen and (max-width: 970px) {\n    .vertical-line {\n      height: 70px !important;\n    }\n  }\n\n  @media screen and (max-width: 570px) {\n    .vertical-line {\n      height: 65px !important;\n    }\n  }\n`;\nconst selectedTimelineStatusIndex = useMemo(\n  () =>\n    TimelineStatusOptions.findIndex((i) => i.value.status === timeline.status),\n  [timeline]\n);\n\nconst TimelineItems = ({ title, children, value, values }) => {\n  const indexOfCurrentItem = TimelineStatusOptions.findIndex((i) =>\n    Array.isArray(values)\n      ? values.includes(i.value.status)\n      : value === i.value.status\n  );\n  let color = \"transparent\";\n  let statusIndex = selectedTimelineStatusIndex;\n  // index 2,3 is of decision\n  if (selectedTimelineStatusIndex === 3) {\n    statusIndex = 2;\n  }\n  if (statusIndex === indexOfCurrentItem) {\n    color = \"#FEF6EE\";\n  }\n  if (statusIndex > indexOfCurrentItem) {\n    color = \"#EEFEF0\";\n  }\n  // cancelled\n  if (\n    statusIndex === 2 &&\n    (values ?? []).includes(RFP_TIMELINE_STATUS.CANCELLED) &&\n    timeline.status === RFP_TIMELINE_STATUS.CANCELLED\n  ) {\n    color = \"#F4F4F4\";\n  }\n\n  return (\n    <div\n      className=\"p-2 rounded-3\"\n      style={{\n        backgroundColor: color,\n      }}\n    >\n      <div className=\"h6 text-black\"> {title}</div>\n      <div className=\"text-sm\">{children}</div>\n    </div>\n  );\n};\n\nreturn (\n  <Container className=\"d-flex flex-column gap-2\">\n    {!disabled && (\n      <div className=\"d-flex flex-column gap-2\">\n        <h6 className=\"mb-0\">Status</h6>\n        <Widget\n          src={`${REPL_INFRASTRUCTURE_COMMITTEE}/widget/near-prpsls-bos.components.molecule.DropDown`}\n          props={{\n            options: TimelineStatusOptions,\n            selectedValue: TimelineStatusOptions.find(\n              (i) => i.value.status === timeline.status\n            ),\n            onUpdate: (v) => {\n              setTimeline({ status: v.value.status });\n            },\n          }}\n        />\n      </div>\n    )}\n    <div className=\"d-flex gap-3 mt-2\">\n      <div className=\"d-flex flex-column mt-4\">\n        {stepsArray.map((_, index) => {\n          const indexOfCurrentItem = index;\n          let color = \"\";\n          let statusIndex = selectedTimelineStatusIndex;\n          // index 2,3 is of decision\n          if (selectedTimelineStatusIndex === 3) {\n            statusIndex = 2;\n          }\n          const current = statusIndex === indexOfCurrentItem;\n          const completed =\n            statusIndex > indexOfCurrentItem ||\n            timeline.status === RFP_TIMELINE_STATUS.PROPOSAL_SELECTED ||\n            timeline.status === RFP_TIMELINE_STATUS.CANCELLED;\n          return (\n            <div className=\"d-flex flex-column align-items-center gap-1\">\n              <div\n                className={\n                  \"circle-lg \" +\n                  (completed && \" green-fill \") +\n                  (current && !completed && \" yellow-fill \")\n                }\n              >\n                {completed && (\n                  <div\n                    className=\"d-flex justify-content-center align-items-center\"\n                    style={{ height: \"120%\" }}\n                  >\n                    <i className=\"bi bi-check\"></i>\n                  </div>\n                )}\n              </div>\n              {index !== stepsArray.length - 1 && (\n                <div\n                  className={\n                    \"vertical-line \" +\n                    (completed && \" green-fill \") +\n                    (current && \" yellow-fill \")\n                  }\n                ></div>\n              )}\n            </div>\n          );\n        })}\n      </div>\n      <div className=\"d-flex flex-column gap-3\">\n        <TimelineItems\n          title=\"1) Accepting Submissions\"\n          value={RFP_TIMELINE_STATUS.ACCEPTING_SUBMISSIONS}\n        >\n          <div>During this stage, the RFP is still open for submissions.</div>\n        </TimelineItems>\n        <TimelineItems\n          title=\"2) Evaluation\"\n          value={RFP_TIMELINE_STATUS.EVALUATION}\n        >\n          <div>\n            This RFP is closed for submissions. All submitted proposals are\n            under review.\n          </div>\n        </TimelineItems>\n        <TimelineItems\n          title=\"3) Decision\"\n          values={[\n            RFP_TIMELINE_STATUS.PROPOSAL_SELECTED,\n            RFP_TIMELINE_STATUS.CANCELLED,\n          ]}\n        >\n          <div className=\"d-flex flex-column gap-2\">\n            <div>Sponsor makes a final decision:</div>\n            <Widget\n              src={`${REPL_INFRASTRUCTURE_COMMITTEE}/widget/near-prpsls-bos.components.molecule.RadioButton`}\n              props={{\n                value: \"\",\n                label: <div className=\"fw-bold\">Proposal Selected</div>,\n                disabled: disabled,\n                isChecked:\n                  timeline.status === RFP_TIMELINE_STATUS.PROPOSAL_SELECTED,\n                onClick: (v) => {\n                  if (v) {\n                    setTimeline({\n                      status: RFP_TIMELINE_STATUS.PROPOSAL_SELECTED,\n                    });\n                  }\n                },\n              }}\n            />\n            <Widget\n              src={`${REPL_INFRASTRUCTURE_COMMITTEE}/widget/near-prpsls-bos.components.molecule.RadioButton`}\n              props={{\n                value: \"\",\n                disabled: disabled,\n                label: <div className=\"fw-bold\">RFP Cancelled</div>,\n                isChecked: timeline.status === RFP_TIMELINE_STATUS.CANCELLED,\n                onClick: (v) => {\n                  if (v) {\n                    setTimeline({\n                      status: RFP_TIMELINE_STATUS.CANCELLED,\n                    });\n                  }\n                },\n              }}\n            />\n          </div>\n        </TimelineItems>\n      </div>\n    </div>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/infrastructure-committee.near/widget/near-prpsls-bos.components.rfps.TimelineConfigurator", "fact_widget_deployments_id": "f16024ef4c947c0d9cae9e996077e132", "inserted_timestamp": "2024-06-03T20:42:29.468Z", "modified_timestamp": "2024-06-03T20:42:29.468Z", "__row_index": 3}