{"tx_hash": "35z9LtzfBrAiQ6iDfgvtBKh1bPiUscPPa5AXQAYYKQRG", "action_id_social": "ANjkgn7ZSes3FpwhNsfDvUk4R435MDQhsY4giPcCLYyx-0-widget", "block_id": 122101511, "block_timestamp": "2024-06-27T11:08:48.849Z", "signer_id": "infrastructure-committee.near", "widget_name": "components.pages.admin", "source_code": "/*\nLicense: MIT\nAuthor: devhub.near\nHomepage: https://github.com/NEAR-DevHub/near-prpsls-bos#readme\n*/\n/* INCLUDE: \"includes/common.jsx\" */\nconst REPL_DEVHUB = \"devhub.near\";\nconst REPL_INFRASTRUCTURE_COMMITTEE = \"infrastructure-committee.near\";\nconst REPL_INFRASTRUCTURE_COMMITTEE_CONTRACT =\n  \"infrastructure-committee.near\";\nconst REPL_RPC_URL = \"https://rpc.mainnet.near.org\";\nconst REPL_NEAR = \"near\";\nconst RFP_IMAGE =\n  \"https://ipfs.near.social/ipfs/bafkreicbygt4kajytlxij24jj6tkg2ppc2dw3dlqhkermkjjfgdfnlizzy\";\n\nconst RFP_FEED_INDEXER_QUERY_NAME =\n  \"polyprogrammist_near_devhub_ic_v1_rfps_with_latest_snapshot\";\n\nconst RFP_INDEXER_QUERY_NAME =\n  \"polyprogrammist_near_devhub_ic_v1_rfp_snapshots\";\n\nconst PROPOSAL_FEED_INDEXER_QUERY_NAME =\n  \"polyprogrammist_near_devhub_ic_v1_proposals_with_latest_snapshot\";\n\nconst PROPOSAL_QUERY_NAME =\n  \"polyprogrammist_near_devhub_ic_v1_proposal_snapshots\";\nconst RFP_TIMELINE_STATUS = {\n  ACCEPTING_SUBMISSIONS: \"ACCEPTING_SUBMISSIONS\",\n  EVALUATION: \"EVALUATION\",\n  PROPOSAL_SELECTED: \"PROPOSAL_SELECTED\",\n  CANCELLED: \"CANCELLED\",\n};\n\nconst PROPOSAL_TIMELINE_STATUS = {\n  DRAFT: \"DRAFT\",\n  REVIEW: \"REVIEW\",\n  APPROVED: \"APPROVED\",\n  REJECTED: \"REJECTED\",\n  CANCELED: \"CANCELLED\",\n  APPROVED_CONDITIONALLY: \"APPROVED_CONDITIONALLY\",\n  PAYMENT_PROCESSING: \"PAYMENT_PROCESSING\",\n  FUNDED: \"FUNDED\",\n};\n\nconst QUERYAPI_ENDPOINT = `https://near-queryapi.api.pagoda.co/v1/graphql`;\n\nasync function fetchGraphQL(operationsDoc, operationName, variables) {\n  return asyncFetch(QUERYAPI_ENDPOINT, {\n    method: \"POST\",\n    headers: { \"x-hasura-role\": `polyprogrammist_near` },\n    body: JSON.stringify({\n      query: operationsDoc,\n      variables: variables,\n      operationName: operationName,\n    }),\n  });\n}\n\nconst CANCEL_RFP_OPTIONS = {\n  CANCEL_PROPOSALS: \"CANCEL_PROPOSALS\",\n  UNLINK_PROPOSALS: \"UNLINK_PROPOSALSS\",\n  NONE: \"NONE\",\n};\n\nfunction parseJSON(json) {\n  if (typeof json === \"string\") {\n    try {\n      return JSON.parse(json);\n    } catch (error) {\n      return json;\n    }\n  } else {\n    return json;\n  }\n}\n\nfunction isNumber(value) {\n  return typeof value === \"number\";\n}\n\nconst PROPOSALS_APPROVED_STATUS_ARRAY = [\n  PROPOSAL_TIMELINE_STATUS.APPROVED,\n  PROPOSAL_TIMELINE_STATUS.APPROVED_CONDITIONALLY,\n  PROPOSAL_TIMELINE_STATUS.PAYMENT_PROCESSING,\n  PROPOSAL_TIMELINE_STATUS.FUNDED,\n];\n\nfunction getLinkUsingCurrentGateway(url) {\n  const data = fetch(`https://httpbin.org/headers`);\n  const gatewayURL = data?.body?.headers?.Origin ?? \"\";\n  return `https://${\n    gatewayURL.includes(\"near.org\") ? \"dev.near.org\" : \"near.social\"\n  }/${url}`;\n}\n/* END_INCLUDE: \"includes/common.jsx\" */\n\nconst accessControlInfo =\n  Near.view(\n    REPL_INFRASTRUCTURE_COMMITTEE_CONTRACT,\n    \"get_access_control_info\"\n  ) ?? null;\n\nif (!accessControlInfo.members_list) {\n  return (\n    <Widget src={`${REPL_DEVHUB}/widget/devhub.components.molecule.Spinner`} />\n  );\n}\n\nconst rootMembers =\n  Near.view(REPL_INFRASTRUCTURE_COMMITTEE_CONTRACT, \"get_root_members\") ?? null;\nconst teamNames = Object.keys(rootMembers || {});\n\nconst isModerator = Near.view(\n  REPL_INFRASTRUCTURE_COMMITTEE_CONTRACT,\n  \"is_allowed_to_write_rfps\",\n  {\n    editor: context.accountId,\n  }\n);\n\nconst noPermissionBanner = (\n  <div className=\"d-flex flex-column justify-content-center align-items-center\">\n    <h2 className=\"alert alert-danger p-3 h6\">\n      Your account does not have administration permissions.\n    </h2>\n  </div>\n);\n\nif (!isModerator) {\n  return noPermissionBanner;\n}\n\nfunction createEditTeam({\n  teamName,\n  members,\n  description,\n  contractCall, // typescript edit_member || add_member\n}) {\n  let txn = [];\n\n  const membersAndTeams = Object.keys(accessControlInfo.members_list);\n  members.forEach((member) => {\n    // if Contract panic member does not exist in the members_list\n    if (!membersAndTeams.includes(member)) {\n      // Add member\n      txn.push({\n        contractName: REPL_INFRASTRUCTURE_COMMITTEE_CONTRACT,\n        methodName: \"add_member\",\n        args: {\n          member: member,\n          metadata: {\n            member_metadata_version: \"V0\",\n            description: description,\n            permissions: {\n              \"*\": [\"use-labels\", \"edit-post\"],\n            },\n            children: [],\n            parents: [],\n          },\n        },\n        gas: Big(10).pow(14),\n      });\n    }\n  });\n\n  // Check edit team\n  Near.call([\n    ...txn,\n    {\n      contractName: REPL_INFRASTRUCTURE_COMMITTEE_CONTRACT,\n      methodName: contractCall, // add_member || edit_member\n      args: {\n        member: `team:${teamName}`,\n        metadata: {\n          member_metadata_version: \"V0\",\n          description: description,\n          permissions: {\n            \"*\": [\"use-labels\", \"edit-post\"],\n          },\n          children: members,\n          parents: [],\n        },\n      },\n      gas: Big(10).pow(14),\n    },\n  ]);\n}\n\nconst Container = styled.div`\n  width: 100%;\n  margin: 0 auto;\n  padding: 20px;\n  text-align: left;\n`;\n\nconst Tab = styled.button`\n  color: rgb(0, 236, 151);\n  &:hover {\n    color: rgba(0, 236, 151, 0.5);\n  }\n`;\n\nreturn (\n  <Container>\n    <div className=\"d-flex flex-column gap-4 p-4\">\n      <ul class=\"nav nav-tabs\" id=\"myTab\" role=\"tablist\">\n        <li class=\"nav-item\" role=\"presentation\">\n          <Tab\n            className=\"nav-link active\"\n            id=\"profile-tab\"\n            data-bs-toggle=\"tab\"\n            data-bs-target=\"#profile\"\n            type=\"button\"\n            role=\"tab\"\n            aria-controls=\"profile\"\n            aria-selected=\"false\"\n          >\n            Moderators\n          </Tab>\n        </li>\n        <li class=\"nav-item\" role=\"presentation\">\n          <Tab\n            className=\"nav-link\"\n            id=\"about-tab\"\n            data-bs-toggle=\"tab\"\n            data-bs-target=\"#about\"\n            type=\"button\"\n            role=\"tab\"\n            aria-controls=\"about\"\n            aria-selected=\"false\"\n          >\n            About\n          </Tab>\n        </li>\n      </ul>\n      <div class=\"tab-content\" id=\"myTabContent\">\n        <div\n          class=\"tab-pane fade show active\"\n          id=\"profile\"\n          role=\"tabpanel\"\n          aria-labelledby=\"profile-tab\"\n        >\n          <Widget\n            src={`${REPL_INFRASTRUCTURE_COMMITTEE}/widget/components.admin.ModeratorsConfigurator`}\n            props={{\n              accessControlInfo,\n              createEditTeam,\n            }}\n          />\n        </div>\n        <div\n          class=\"tab-pane fade\"\n          id=\"about\"\n          role=\"tabpanel\"\n          aria-labelledby=\"about-tab\"\n        >\n          <Widget\n            src={`${REPL_INFRASTRUCTURE_COMMITTEE}/widget/components.admin.AboutConfigurator`}\n            props={{\n              accessControlInfo,\n              createEditTeam,\n            }}\n          />\n        </div>\n      </div>\n    </div>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/infrastructure-committee.near/widget/components.pages.admin", "fact_widget_deployments_id": "23545015eabc859845f13484a425636f", "inserted_timestamp": "2024-06-27T11:55:17.042Z", "modified_timestamp": "2024-06-27T11:55:17.042Z", "__row_index": 3}