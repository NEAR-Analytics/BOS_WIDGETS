{"tx_hash": "BuRMwpRDHf3eGJZef2n5wzJupYnLFm7hvJTndMGnJtR9", "action_id_social": "DrxpTqo9qtsz9bEFNooFzboZ6qfXNYYEpSjhKNhwhfFJ-0-widget", "block_id": 106790586, "block_timestamp": "2023-11-29T07:00:31.264Z", "signer_id": "kurodenjiro.near", "widget_name": "trendinghub", "source_code": "const findHashtags = (str) => {\r\n  const regexp = /\\B\\#\\w\\w+\\b/g;\r\n  let match;\r\n  let tags = [];\r\n  while ((match = regexp.exec(str)) !== null) {\r\n    tags.push(match[0]);\r\n  }\r\n  return tags;\r\n};\r\nconst respBlock = fetch(\"https://api.nearblocks.io/v1/stats\");\r\n\r\nconst newBlock = Math.round(\r\n  parseInt(respBlock.body.stats[0].block) -\r\n    (30 * 24 * 3600) / parseInt(respBlock.body.stats[0].avg_block_time)\r\n);\r\nconst newBlock1Days = Math.round(\r\n  parseInt(respBlock.body.stats[0].block) -\r\n    (1 * 24 * 3600) / parseInt(respBlock.body.stats[0].avg_block_time)\r\n);\r\nconst newBlock3Days = Math.round(\r\n  parseInt(respBlock.body.stats[0].block) -\r\n    (3 * 24 * 3600) / parseInt(respBlock.body.stats[0].avg_block_time)\r\n);\r\nconst newBlock7Days = Math.round(\r\n  parseInt(respBlock.body.stats[0].block) -\r\n    (7 * 24 * 3600) / parseInt(respBlock.body.stats[0].avg_block_time)\r\n);\r\nconst allPost = Social.get(\"*/post/main/\", \"final\");\r\n\r\nconst tagCountAll = {};\r\nconst tagCount1Days = {};\r\nconst tagCount3Days = {};\r\nconst tagCount7Days = {};\r\nObject.keys(allPost).forEach((item) => {\r\n  const tags = findHashtags(JSON.parse(allPost[item].post.main).text);\r\n  if (tags.length > 0) {\r\n    tags.forEach((tag) => {\r\n      tagCountAll[tag] = 0;\r\n      tagCount1Days[tag] = 0;\r\n      tagCount3Days[tag] = 0;\r\n      tagCount7Days[tag] = 0;\r\n    });\r\n  }\r\n});\r\nObject.keys(tagCountAll).forEach((tag) => {\r\n  const countAllPost = Social.index(\"hashtag\", tag.replace(\"#\", \"\"), {\r\n    from: newBlock,\r\n    limit: 999,\r\n    order: \"asc\",\r\n  });\r\n  const count1DaysPost = Social.index(\"hashtag\", tag.replace(\"#\", \"\"), {\r\n    from: newBlock1Days,\r\n    limit: 999,\r\n    order: \"asc\",\r\n  });\r\n  const count3DaysPost = Social.index(\"hashtag\", tag.replace(\"#\", \"\"), {\r\n    from: newBlock3Days,\r\n    limit: 999,\r\n    order: \"asc\",\r\n  });\r\n  const count7DaysPost = Social.index(\"hashtag\", tag.replace(\"#\", \"\"), {\r\n    from: newBlock7Days,\r\n    limit: 999,\r\n    order: \"asc\",\r\n  });\r\n  tagCountAll[tag] = countAllPost.length || 0;\r\n  tagCount1Days[tag] = count1DaysPost.length || 0;\r\n  tagCount3Days[tag] = count3DaysPost.length || 0;\r\n  tagCount7Days[tag] = count7DaysPost.length || 0;\r\n});\r\n\r\nlet entriesALL = Object.entries(tagCountAll);\r\nlet allPostSorted = entriesALL.sort((b, a) => a[1] - b[1]);\r\n\r\nlet entries1 = Object.entries(tagCount1Days);\r\nlet day1PostSorted = entries1.sort((b, a) => a[1] - b[1]);\r\n\r\nlet entries3 = Object.entries(tagCount3Days);\r\nlet day3PostSorted = entries3.sort((b, a) => a[1] - b[1]);\r\n\r\nlet entries7 = Object.entries(tagCount7Days);\r\nlet day7PostSorted = entries7.sort((b, a) => a[1] - b[1]);\r\n\r\nreturn (\r\n  <>\r\n    <div>\r\n      ALL POST\r\n      {allPostSorted &&\r\n        allPostSorted\r\n          .filter((item, index) => index <= 10)\r\n          .map((item) => (\r\n            <p>\r\n              {item[0]}-{item[1]}\r\n            </p>\r\n          ))}\r\n    </div>\r\n    <a>----------------------------------</a>\r\n    <div>\r\n      Trend Now\r\n      {day1PostSorted &&\r\n        day1PostSorted\r\n          .filter((item, index) => index <= 10)\r\n          .map((item) => (\r\n            <p>\r\n              {item[0]}-{item[1]}\r\n            </p>\r\n          ))}\r\n    </div>\r\n    <a>----------------------------------</a>\r\n    <div>\r\n      Trend in 3 Day\r\n      {day3PostSorted &&\r\n        day3PostSorted\r\n          .filter((item, index) => index <= 10)\r\n          .map((item) => (\r\n            <p>\r\n              {item[0]}-{item[1]}\r\n            </p>\r\n          ))}\r\n    </div>\r\n    <a>----------------------------------</a>\r\n    <div>\r\n      Trend in 7 Day\r\n      {day7PostSorted &&\r\n        day7PostSorted\r\n          .filter((item, index) => index <= 10)\r\n          .map((item) => (\r\n            <p>\r\n              {item[0]}-{item[1]}\r\n            </p>\r\n          ))}\r\n    </div>\r\n  </>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/kurodenjiro.near/widget/trendinghub", "fact_widget_deployments_id": "eabe817895388e78102bcf43d2f041a9", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}