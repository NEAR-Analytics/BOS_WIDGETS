{"tx_hash": "6oayCXnU1eJM2iiwgevhRpjqKA4jtJnU2BMyqLgUk92R", "action_id_social": "ENKdBWb3MqzF9vRBJ3UL1WxtbE2CWkKF1hPAUqfgSE4X-0-widget", "block_id": 106760207, "block_timestamp": "2023-11-28T21:12:43.497Z", "signer_id": "kurodenjiro.near", "widget_name": "trending", "source_code": "State.init({ hastag });\r\nconst findHashtags = (str) => {\r\n  const regexp = /\\B\\#\\w\\w+\\b/g;\r\n  let match;\r\n  let tags = [];\r\n  while ((match = regexp.exec(str)) !== null) {\r\n    tags.push(match[0]);\r\n  }\r\n  return tags;\r\n};\r\nconst respBlock = fetch(\"https://api.nearblocks.io/v1/stats\");\r\n\r\nconst newBlock = Math.round(\r\n  parseInt(respBlock.body.stats[0].block) -\r\n    (30 * 24 * 3600) / parseInt(respBlock.body.stats[0].avg_block_time)\r\n);\r\nconst newBlock1Days = Math.round(\r\n  parseInt(respBlock.body.stats[0].block) -\r\n    (1 * 24 * 3600) / parseInt(respBlock.body.stats[0].avg_block_time)\r\n);\r\nconst newBlock3Days = Math.round(\r\n  parseInt(respBlock.body.stats[0].block) -\r\n    (3 * 24 * 3600) / parseInt(respBlock.body.stats[0].avg_block_time)\r\n);\r\nconst newBlock7Days = Math.round(\r\n  parseInt(respBlock.body.stats[0].block) -\r\n    (7 * 24 * 3600) / parseInt(respBlock.body.stats[0].avg_block_time)\r\n);\r\n\r\nlet allPost = Social.get(\"*/post/main/\", \"final\");\r\n\r\nlet tagCountAll = {};\r\nlet tagCount1Days = {};\r\nObject.keys(allPost).forEach((item) => {\r\n  const tags = findHashtags(JSON.parse(allPost[item].post.main).text);\r\n  if (tags.length > 0) {\r\n    tags.forEach((tag) => {\r\n      tagCountAll[tag] = 0;\r\n      tagCount1Days[tag] = 0;\r\n    });\r\n  }\r\n});\r\n\r\nObject.keys(tagCountAll).forEach((tag) => {\r\n  const count1DaysPost = Social.index(\"hashtag\", tag.replace(\"#\", \"\"), {\r\n    from: newBlock,\r\n    limit: 999,\r\n    order: \"asc\",\r\n  });\r\n\r\n  tagCountAll[tag] = countAllPost.length || 0;\r\n  tagCount1Days[tag] = count1DaysPost.length || 0;\r\n  console.log(tag.replace(\"#\", \"\"));\r\n  State.update({ hastag: tagCount1Days });\r\n});\r\n\r\nreturn (\r\n  <>\r\n    <div>\r\n      {Object.keys(state.hastag) &&\r\n        Object.keys(state.hastag)\r\n          .filter((item, index) => state.hastag[item] !== 0)\r\n          .map((item) => (\r\n            <a\r\n              style={{\r\n                fontSize:\r\n                  state.hastag[item] < 10\r\n                    ? state.hastag[item] + 10 + \"px\"\r\n                    : state.hastag[item] + \"px\" || state.hastag[item] > 60\r\n                    ? \"60px\"\r\n                    : state.hastag[item] + \"px\",\r\n              }}\r\n              href={`https://near.social/?hashtag=${item.replace(\"#\", \"\")}`}\r\n            >\r\n              {item}\r\n            </a>\r\n          ))}\r\n    </div>\r\n  </>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/kurodenjiro.near/widget/trending", "fact_widget_deployments_id": "c8f6be8e7b3ec96dab670c16ce06e21e", "inserted_timestamp": "2023-11-28T23:20:07.511Z", "modified_timestamp": "2023-11-28T23:20:07.511Z", "__row_index": 1}