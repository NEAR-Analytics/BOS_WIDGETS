{"tx_hash": "AUwGMyJyeBwyj7i2WpTDVBnVbUsWwkFNYZn6ujBfdh1U", "action_id_social": "FMx1RndvjC4z1YN7Qw6qcei2JyVXcj16cTf8iqkHyYBx-0-widget", "block_id": 100074386, "block_timestamp": "2023-08-31T11:02:00.538Z", "signer_id": "mv3n0m.near", "widget_name": "Home", "source_code": "const contract = 'ece61a112fbb05b5ff96fd4d63cb259c4bae966477829666d46ddc4e5121d801';\nconst accountId = context.accountId\n\nState.init({\n  msg: \"\"\n})\n\nconst messages = Near.view(contract, 'get_messages', { limit: 12 }, null, true);\n\nconst sendMessage = () => {\n  if (state.msg.length != 0) {\n    let text = state.msg\n    if (state.img?.cid) {\n      text = `${text}_img_${state.img.cid}`\n    }\n    Near.call(contract, 'send', { text })\n  }\n}\n\nconst handleUpload = body => {\n  asyncFetch(\"https://ipfs.near.social/add\", {\n    method: \"POST\",\n    headers: { Accept: \"application/json\" },\n    body,\n  }).then((res) => {\n    const cid = res.body.cid;\n    State.update({ img: { cid } });\n  });\n};\n\nconst selectFile = files => {\n  if (files) {\n    State.update({ img: { uploading: true, cid: null } });\n    handleUpload(files[0]);\n  }\n}\n\nconst Bg = styled.div`\n  background-color: #393e46;\n  height: 80vh;\n  border-radius: 30px;\n  padding: 2em 10em;\n`\n\nconst Messages = styled.div`\n  ::-webkit-scrollbar {\n    width: 0.5em;\n  }\n\n  ::-webkit-scrollbar-thumb {\n    display: none;\n  }\n  ::-webkit-scrollbar-track {\n    display: none;\n  }\n\n  overflow: auto; /* Show the scrollbar outside of WebKit browsers */\n  scrollbar-width: none; /* Hide the scrollbar for Firefox */\n  -ms-overflow-style: none; /* Hide the scrollbar for IE/Edge */\n  height: 92%;\n  margin-top: 20px;\n`\n\nconst messageStyle = isAuthor => ({\n  display: \"flex\",\n  flexDirection: isAuthor ? \"row-reverse\" : \"row\",\n  alignItems: \"center\",\n  float: isAuthor ? \"right\" : \"left\",\n  gap: \"1.2em\",\n  width: \"60%\",\n  justifyContent: \"space-between\",\n  backgroundColor: isAuthor ? \"black\" : \"white\",\n  color: isAuthor ? \"white\" : \"#121212\",\n  borderRadius: \"30px\",\n  padding: \"5px 10px\",\n  marginBottom: \"1.5em\",\n  boxShadow: \"0px 3px 5px #121212\",\n  position: \"relative\",\n  overflow: \"hidden\",\n  textOverflow: \"ellipsis\"\n})\n\nconst Send = styled.div`\n  width: 100%;\n  border-radius: 50px;\n  border: 2px solid grey;\n  display: flex;\n  background-color: black;\n  box-shadow: 0px 5px 10px black;\n  gap: 2px;\n`;\n\n\nreturn (\n  <Bg>\n    <Send>\n      <div\n        style={{ backgroundColor: \"white\", border: 0, borderRadius: \"50%\", padding: \"12px\" }}\n      >\n        <Files\n          multiple={false}\n          accepts={[\"image/*\"]}\n          minFileSize={1}\n          clickable\n          onChange={selectFile}\n        >\n          <img src=\"https://icons.veryicon.com/png/o/media/media-and-control/image-add-fill-3.png\" height={25}/>\n        </Files>\n      </div>\n      <input\n        type=\"text\"\n        onInput={(e) => State.update({ msg: e.target.value })}\n        value={state.msg}\n        placeholder=\"Enter your message...\"\n        style={{ color: \"white\", backgroundColor: \"black\", border: 0, outlineWidth: 0 }}\n      />\n      <button\n        style={{ backgroundColor: \"white\", border: 0, borderRadius: \"50%\", padding: \"12px\" }}\n        onClick={() => {\n          sendMessage();\n        }}\n      >\n        <img src=\"https://icons.veryicon.com/png/o/business/imi-project/send-message-11.png\" height={25} width={25}/>\n      </button>\n    </Send>\n    <Messages>\n    {\n      messages.map((message) => {\n        const [ msg, media ] = message.text?.split(\"_img_\")\n        const isAuthor = message.author === accountId\n\n        return (\n          <>\n            {\n              media ? (\n                <img\n                  style={{ float: isAuthor ? \"right\" : \"left\", objectFit: \"cover\", width: \"54%\", marginLeft: \"3%\", marginRight: \"3%\", border: `4px solid ${ isAuthor ? \"black\" : \"white\" }`, borderTopLeftRadius: \"10px\", borderTopRightRadius: \"10px\" }}\n                  src={`https://ipfs.near.social/ipfs/${media}`}\n                  alt=\"message media\"\n                />\n              ) : <></>\n            }\n            <div style={messageStyle(isAuthor)}>\n              {\n                isAuthor ? <></> : (\n                  <Widget\n                    src=\"calebjacob.near/widget/AccountProfile\"\n                    props={{\n                      accountId: message.author,\n                    }}\n                  />\n                )\n              }\n              <div style={{ textAlign: \"right\", flexGrow: 1, paddingRight: \"10px\", maxWidth: isAuthor ? \"100%\" : \"70%\" }}>\n                <p style={{ fontWeight: \"bold\"  }}>{msg}</p>\n                <div style={{ position: \"absolute\", bottom: 0, right: \"20px\" }}>\n                  <Widget\n                    src=\"andyh.near/widget/TimeAgo\"\n                    props={{\n                      blockHeight: message.block_height\n                    }}\n                    />ago\n                </div>\n              </div>\n            </div>\n          </>\n        )\n      })\n    }\n    </Messages>\n  </Bg>\n);", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/mv3n0m.near/widget/Home", "fact_widget_deployments_id": "e10998d5a6bb00915383a191d293190c", "inserted_timestamp": "2023-08-31T12:50:25.764Z", "modified_timestamp": "2023-08-31T12:50:25.764Z", "__row_index": 28}