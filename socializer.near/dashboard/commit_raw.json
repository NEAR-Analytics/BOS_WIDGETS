{"tx_hash": "C7QgCYtjam2cPEfP6251wcuJA6QYHdu4WAThETo38djt", "action_id_social": "Fre9c4ez7fLFuP3hdR4GnVA6KvNRJSmo6rs8aep7Q8M8-0-widget", "block_id": 116058755, "block_timestamp": "2024-04-03T16:34:59.451Z", "signer_id": "socializer.near", "widget_name": "Dashboard", "source_code": "const Owner = \"socializer.near\";\nconst accountId = context.accountId;\n\nconst API_URL = props?.API_URL || \"https://e2e.nearverselabs.com/\";\n\nconst changePage = props?.changePage || (() => {});\nconst page = props?.page || \"\";\n\nconst options = [\n  {\n    text: \"Live Campaigns\",\n    value: \"live\",\n  },\n  {\n    text: \"Expired\",\n    value: \"expired\",\n  },\n];\n\nconst showDetail = (data) => {\n  if (data.accountId !== accountId)\n    State.update({ show_detail: true, selected: data });\n};\n\nconst viewWins = (data) => {\n  // if (data.accountId !== accountId)\n  State.update({ view_win: true, selected: data });\n};\n\nconst onClose = (notification) => {\n  State.update({ show_detail: false, view_win: false, notification });\n};\n\nconst handleSearch = (event) => {\n  const value = event.target.value;\n  const searchResult = state.campaigns.filter((row) => {\n    if (!value) return true;\n    const profile = Social.getr(`${row.poster}/profile`);\n    const name = profile.name || row.poster || \"\";\n    return name.toLocaleLowerCase().includes(value.toLocaleLowerCase() ?? \"\");\n  });\n  console.log(\"searchResult\", searchResult);\n  State.update({ searchValue: value, rowList: searchResult });\n};\n\nconst selectMenu = (data) => {\n  State.update({ menu: data, campaigns: [], timer_load: false, loaded: false });\n};\n\nState.init({\n  campaigns: [],\n  rowList: [],\n  error: \"\",\n  show_detail: false,\n  view_win: false,\n  selected: {},\n  searchValue: \"\",\n  menu: { value: \"live\" },\n  columns: {\n    live: [\n      {\n        title: \"Campaign Id\",\n        key: \"id\",\n        description: \"Campaign Id\",\n        width: 16,\n      },\n      {\n        title: \"Project/User\",\n        key: \"poster\",\n        description: \"Project/User\",\n        width: 16,\n        project: true,\n      },\n      {\n        title: \"Participants\",\n        key: \"participants\",\n        description: \"Participants\",\n        width: 14,\n        align: \"center\",\n      },\n      {\n        title: \"Ends In\",\n        key: \"endsin\",\n        description: \"Ends In\",\n        width: 15,\n        align: \"center\",\n      },\n      {\n        title: \"Reward Per Winner\",\n        key: \"reward\",\n        description: \"Reward\",\n        width: 8,\n        align: \"center\",\n      },\n      {\n        title: \"Winners\",\n        key: \"winners\",\n        description: \"Winners\",\n        width: 10,\n        align: \"center\",\n        click: () => {},\n      },\n      {\n        title: \"Total Rewards\",\n        key: \"total_reward\",\n        description: \"Total Rewards\",\n        width: 10,\n        align: \"center\",\n      },\n      {\n        title: \"Engage Link\",\n        key: \"result\",\n        description: \"Engage Link\",\n        width: 10,\n        align: \"center\",\n        link: true,\n        click: showDetail,\n      },\n    ],\n    expired: [\n      {\n        title: \"Campaign Id\",\n        key: \"id\",\n        description: \"Campaign Id\",\n        width: 16,\n      },\n      {\n        title: \"Project/User\",\n        key: \"poster\",\n        description: \"Project/User\",\n        width: 20,\n        project: true,\n      },\n      {\n        title: \"Participants\",\n        key: \"participants\",\n        description: \"Participants\",\n        width: 15,\n        align: \"center\",\n      },\n      {\n        title: \"Reward\",\n        key: \"reward\",\n        description: \"Reward\",\n        width: 8,\n        align: \"center\",\n      },\n      {\n        title: \"Total Rewards\",\n        key: \"total_reward\",\n        description: \"Total Rewards\",\n        width: 10,\n        align: \"center\",\n      },\n      {\n        title: \"Claim Type\",\n        key: \"claim\",\n        description: \"Claim Type\",\n        width: 10,\n        align: \"center\",\n        value: \"Raffle\",\n      },\n      {\n        title: \"Winners\",\n        key: \"winner\",\n        description: \"Winners\",\n        width: 10,\n        align: \"center\",\n        button: true,\n        value: \"View Winners\",\n        click: viewWins,\n      },\n      {\n        title: \"Your Result \",\n        key: \"result\",\n        description: \"Your Result\",\n        width: 10,\n        align: \"center\",\n        link: true,\n        click: () => {},\n      },\n    ],\n  },\n  title: {\n    live: {\n      tl: \"Live Campaigns\",\n      subtl: \"The list of Near Social Posts are offering rewards\",\n    },\n    expired: {\n      tl: \"Expired\",\n      subtl: \"These Engage-To-Earn campaigns have ended\",\n    },\n  },\n  timer_load: false,\n  loaded: false,\n  notification: \"\",\n});\n\nconst MainComponent = styled.div`\n  display: flex;\n  width: 100%;\n  height: 100%;\n  position: relative;\n  background: #FAFAFA;\n  flex-direction: column;\n`;\n\nconst TableComponent = styled.div`\n    display: flex;\n    width: 100%;\n    flex-direction: column;\n    padding: 5px 24px 13px;\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    @media (max-width: 620px) {\n        padding: 0;\n    }\n`;\n\nconst HeadComponent = styled.div`\n    width: 100%;\n    padding: 32px;\n    padding-bottom: 0px;\n    display: flex;\n    flex-direction: column;\n    @media (max-width: 620px) {\n        padding: 46px 1px 2px;\n    }\n`;\n\nconst TitleComponent = styled.div`\n  display: flex;\n  width: 100%;\n  flex-direction: column;\n  gap: 32px;\n`;\nconst TitleStatusText = styled.div`\n  display: flex;\n  justify-content: space-between;\n  flex-direction: row;\n  @media (max-width: 620px) {\n        flex-direction: column;\n    }\n`;\n\nconst FilterContent = styled.div`\n    gap: 7px;\n    width: 100%;\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n    @media (max-width: 620px) {\n        flex-direction: column;\n    }\n`;\n\nconst SelectContent = styled.div`\n    gap: 21px;\n    display: flex;\n    align-items: center;\n    \n    @media (max-width: 620px) {\n        gap: 10px;\n        justify-content: flex-end;\n    }\n`;\n\nconst TitleContent = styled.div`\n  display: flex;\n  width: 100%;\n  flex-direction: column;\n  gap:14px;\n`;\n\nconst SearchInput = styled.input`\n  width: 100%;\n  font-size: 14px;\n  font-weight: 400;\n  font-style: normal;\n  border-radius: 10px;\n  line-height: normal;\n  letter-spacing: -0.12px;\n  padding: 12px 48px 12px 28px;\n`;\n\nconst Button = styled.button`\n  gap: 10px;\n  height: 100%;\n  display: flex;\n  font-size: 12px;\n  font-weight: 600;\n  padding: 12px 24px;\n  border-radius: 6px;\n  text-align: center;\n  align-items: center;\n  line-height: normal;\n  text-transform: capitalize;\n  color: var(--light_95, #F3F3F3);\n  background: var(--Dark, #121212); \n`;\n\nconst SearchIcon = () => (\n  <svg\n    width=\"20\"\n    height=\"20\"\n    viewBox=\"0 0 20 20\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    style={{ position: \"absolute\", right: 28 }}\n  >\n    <g clip-path=\"url(#clip0_1_3884)\">\n      <path\n        d=\"M9.58329 17.5C13.9555 17.5 17.5 13.9556 17.5 9.58334C17.5 5.21108 13.9555 1.66667 9.58329 1.66667C5.21104 1.66667 1.66663 5.21108 1.66663 9.58334C1.66663 13.9556 5.21104 17.5 9.58329 17.5Z\"\n        stroke=\"#595959\"\n        strokeWidth=\"1.5\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n      <path\n        d=\"M18.3333 18.3333L16.6666 16.6667\"\n        stroke=\"#595959\"\n        strokeWidth=\"1.5\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n    </g>\n    <defs>\n      <clipPath id=\"clip0_1_3884\">\n        <rect width=\"20\" height=\"20\" fill=\"white\" />\n      </clipPath>\n    </defs>\n  </svg>\n);\n\nconst getCampaignData = (type) => {\n  return asyncFetch(\n    API_URL + `/api/campaign?accountId=${accountId}&type=${type}`\n  ).then((res) => {\n    if (res.ok) {\n      const { error, data } = res.body;\n      if (error) State.update({ loaded: true, error });\n      State.update({\n        loaded: true,\n        campaigns: data,\n        rowList: data,\n      });\n    } else {\n      State.update({ loaded: true, error: res.error });\n    }\n  });\n};\n\nif (!state.loaded) getCampaignData(state.menu.value);\n\nif (!state.loaded) return <Widget src={`${Owner}/widget/preload`} />;\n\nreturn (\n  <MainComponent>\n    <HeadComponent>\n      <TitleComponent>\n        <FilterContent>\n          <div\n            style={{\n              position: \"relative\",\n              display: \"flex\",\n              alignItems: \"center\",\n            }}\n          >\n            <SearchInput\n              placeholder=\"Search\"\n              value={state.searchValue}\n              onChange={handleSearch}\n            />\n            <SearchIcon />\n          </div>\n          <SelectContent>\n            <Widget\n              props={{\n                API_URL,\n                noLabel: true,\n                options,\n                value: state.menu,\n                onChange: selectMenu,\n              }}\n              src={`${Owner}/widget/Select`}\n            />\n            <Button\n              className=\"btn btn-secondary\"\n              onClick={() => {\n                if (accountId) {\n                  changePage(\"new_campaigns\");\n                }\n              }}\n            >\n              {\"+ Create New Campaigns\"}\n            </Button>\n          </SelectContent>\n        </FilterContent>\n        <TitleContent>\n          <h4 style={{ margin: 0 }}>{state.title[state.menu.value].tl}</h4>\n          <TitleStatusText>\n            <p style={{ fontSize: 14, margin: 0 }}>\n              {state.title[state.menu.value].subtl}\n            </p>\n            {state.error && (\n              <p style={{ fontSize: 14, margin: 0, color: \"red\" }}>\n                {state.error}\n              </p>\n            )}\n            {state.campaigns.length !== 0 && (\n              <Widget\n                props={{\n                  API_URL,\n                  menu: state.menu,\n                  length: state.campaigns.length,\n                }}\n                src={`${Owner}/widget/Status`}\n              />\n            )}\n          </TitleStatusText>\n        </TitleContent>\n      </TitleComponent>\n    </HeadComponent>\n    {state.campaigns.length !== 0 && (\n      <>\n        <TableComponent>\n          <Widget\n            src={`${Owner}/widget/table-pagination`}\n            props={{\n              API_URL,\n              themeColor: { table_pagination: themeColor.table_pagination },\n              data: state.rowList,\n              columns: state.columns[state.menu.value],\n              rowsCount: 5,\n              searchValue: state.searchValue,\n              timer: state.menu.value === \"live\" ? true : false,\n              timer_load: state.timer_load,\n            }}\n          />\n        </TableComponent>\n      </>\n    )}\n\n    {state.show_detail && state.selected && (\n      <Widget\n        props={{\n          API_URL,\n          onClose,\n          data: state.selected,\n        }}\n        src={`${Owner}/widget/CampaignModal`}\n      />\n    )}\n    {state.view_win && state.selected && (\n      <Widget\n        props={{\n          API_URL,\n          onClose,\n          data: state.selected,\n        }}\n        src={`${Owner}/widget/WinnersModal`}\n      />\n    )}\n    {state.notification && (\n      <div\n        className=\"d-flex justify-content-end position-absolute\"\n        style={{ right: 10 }}\n      >\n        <Widget\n          props={{\n            text: state.notification,\n          }}\n          src={`${Owner}/widget/Alert`}\n        />\n      </div>\n    )}\n  </MainComponent>\n);\n", "metadata": {"fork_of": "socializer.near/widget/Dashboard@116058503"}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/socializer.near/widget/Dashboard", "fact_widget_deployments_id": "5432de7450474c68d3cb4764ad55abac", "inserted_timestamp": "2024-04-03T17:40:04.451Z", "modified_timestamp": "2024-04-03T18:42:02.623Z", "__row_index": 27}