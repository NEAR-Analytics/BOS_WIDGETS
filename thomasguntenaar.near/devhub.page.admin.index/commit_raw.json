{"tx_hash": "EXpZ4bgNC4P76o18LpAg8thutA4vhSKSBLx9YppUWFbB", "action_id_social": "2YjC7G8zSRadhzgjT3a92UR9yNRhaJHH17LEDMpDcv5k-0-widget", "block_id": 118960039, "block_timestamp": "2024-05-15T08:41:05.120Z", "signer_id": "thomasguntenaar.near", "widget_name": "devhub.page.admin.index", "source_code": "const { hasModerator, getRootMembers, getAccessControlInfo } = VM.require(\n  \"thomasguntenaar.near/widget/core.adapter.devhub-contract\"\n);\n\nif (!hasModerator || !getRootMembers || !getAccessControlInfo) {\n  return <p>Loading modules...</p>;\n}\n\nconst accessControlInfo = getAccessControlInfo();\n\nif (!accessControlInfo.members_list) {\n  return <p>Loading members list...</p>;\n}\n\nconst rootMembers = getRootMembers();\nconst teamNames = Object.keys(rootMembers || {});\n\nconst isDevHubModerator = hasModerator({\n  account_id: context.accountId,\n});\n\nconst noPermissionBanner = (\n  <div\n    className=\"d-flex flex-column justify-content-center align-items-center\"\n    style={{ height: 384 }}\n  >\n    <h2 className=\"alert alert-danger\">\n      Your account does not have administration permissions.\n    </h2>\n  </div>\n);\n\nif (!isDevHubModerator) {\n  return noPermissionBanner;\n}\n\nfunction createEditTeam({\n  teamName,\n  label,\n  editPost,\n  useLabels,\n  members,\n  contractCall, // typescript edit_member || add_member\n}) {\n  let txn = [];\n  console.log(\"\ud83d\ude80 ~ file: index.jsx:48 ~ teamNames:\", teamNames);\n  if (teamNames.includes(`team:${teamName}`) && contractCall === \"add_member\") {\n    return setAlertMessage(\"This team name already exists\");\n  }\n  const allLabels = Object.keys(accessControlInfo.rules_list);\n  if (allLabels.includes(label) && contractCall === \"add_member\") {\n    return setAlertMessage(\"This label is already restricted by another team\");\n  }\n\n  const membersAndTeams = Object.keys(accessControlInfo.members_list);\n  members.forEach((member) => {\n    // if Contract panic member does not exist in the members_list\n    if (!membersAndTeams.includes(member)) {\n      // Add member\n      txn.push({\n        contractName: \"devhub.near\",\n        methodName: \"add_member\",\n        args: {\n          member: member,\n          metadata: {\n            member_metadata_version: \"V0\",\n            description: \"\",\n            permissions: {},\n            children: [],\n            parents: [],\n          },\n        },\n        gas: Big(10).pow(14),\n      });\n    }\n  });\n\n  // Check edit team\n  Near.call([\n    ...txn,\n    {\n      contractName: \"devhub.near\",\n      methodName: contractCall, // add_member || edit_member\n      args: {\n        member: `team:${teamName}`,\n        metadata: {\n          member_metadata_version: \"V0\",\n          description: \"\",\n          permissions: {\n            [label]: [\n              ...(editPost ? [\"edit-post\"] : []),\n              ...(useLabels ? [\"use-labels\"] : []),\n            ],\n          },\n          children: members,\n          parents: [],\n        },\n      },\n      gas: Big(10).pow(14),\n    },\n  ]);\n}\n\nconst Container = styled.div`\n  width: 100%;\n  margin: 0 auto;\n  padding: 20px;\n  text-align: left;\n`;\n\nconst Tab = styled.button`\n  color: rgb(0, 236, 151);\n  &:hover {\n    color: rgba(0, 236, 151, 0.5);\n  }\n`;\n\nreturn (\n  <Container>\n    <div className=\"d-flex flex-column gap-4 p-4\">\n      <ul class=\"nav nav-tabs\" id=\"myTab\" role=\"tablist\">\n        <li class=\"nav-item\" role=\"presentation\">\n          <Tab\n            className=\"nav-link active\"\n            id=\"home-tab\"\n            data-bs-toggle=\"tab\"\n            data-bs-target=\"#home\"\n            type=\"button\"\n            role=\"tab\"\n            aria-controls=\"home\"\n            aria-selected=\"true\"\n          >\n            Home page settings\n          </Tab>\n        </li>\n        <li class=\"nav-item\" role=\"presentation\">\n          <Tab\n            className=\"nav-link\"\n            id=\"profile-tab\"\n            data-bs-toggle=\"tab\"\n            data-bs-target=\"#profile\"\n            type=\"button\"\n            role=\"tab\"\n            aria-controls=\"profile\"\n            aria-selected=\"false\"\n          >\n            Moderators\n          </Tab>\n        </li>\n        <li class=\"nav-item\" role=\"presentation\">\n          <Tab\n            className=\"nav-link\"\n            id=\"contact-tab\"\n            data-bs-toggle=\"tab\"\n            data-bs-target=\"#contact\"\n            type=\"button\"\n            role=\"tab\"\n            aria-controls=\"contact\"\n            aria-selected=\"false\"\n          >\n            Restricted labels\n          </Tab>\n        </li>\n      </ul>\n      <div class=\"tab-content\" id=\"myTabContent\">\n        <div\n          class=\"tab-pane fade show active\"\n          id=\"home\"\n          role=\"tabpanel\"\n          aria-labelledby=\"home-tab\"\n        >\n          <Widget src=\"thomasguntenaar.near/widget/devhub.page.admin.homepageTab\" />\n        </div>\n        <div\n          class=\"tab-pane fade\"\n          id=\"profile\"\n          role=\"tabpanel\"\n          aria-labelledby=\"profile-tab\"\n        >\n          <Widget\n            src=\"thomasguntenaar.near/widget/devhub.page.admin.moderatorsTab\"\n            props={{\n              accessControlInfo,\n              createEditTeam,\n            }}\n          />\n        </div>\n        <div\n          class=\"tab-pane fade\"\n          id=\"contact\"\n          role=\"tabpanel\"\n          aria-labelledby=\"contact-tab\"\n        >\n          <Widget\n            src=\"thomasguntenaar.near/widget/devhub.page.admin.restrictedLabelsTab\"\n            props={{\n              accessControlInfo,\n              createEditTeam,\n              teamNames,\n            }}\n          />\n        </div>\n      </div>\n    </div>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/thomasguntenaar.near/widget/devhub.page.admin.index", "fact_widget_deployments_id": "9bcc0c58b438b7cf695197f24221bfe0", "inserted_timestamp": "2024-05-15T10:50:02.030Z", "modified_timestamp": "2024-05-15T10:50:02.030Z", "__row_index": 11}