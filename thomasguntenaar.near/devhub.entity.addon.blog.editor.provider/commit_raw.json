{"tx_hash": "DPcSVoFhaCQ9tPY3rPRzCKDRbFwSVrEYz3PJ4yG6VMzC", "action_id_social": "2jfWSkTuR5nJu59YUfdPb3nSV8W4u2JeXP4B5uLcyJVe-0-widget", "block_id": 112397332, "block_timestamp": "2024-02-08T16:32:54.664Z", "signer_id": "thomasguntenaar.near", "widget_name": "devhub.entity.addon.blog.editor.provider", "source_code": "const { getPost } = VM.require(\n  \"thomasguntenaar.near/widget/core.adapter.devhub-contract\"\n) || { getPost: () => {} };\n\nconst { Layout, handle } = props;\n\nconst QUERYAPI_ENDPOINT = `https://near-queryapi.api.pagoda.co/v1/graphql/`;\n\nconst fetchGraphQL = (operationsDoc, operationName, variables) => {\n  return fetch(QUERYAPI_ENDPOINT, {\n    method: \"POST\",\n    headers: { \"x-hasura-role\": `bo_near` },\n    body: JSON.stringify({\n      query: operationsDoc,\n      variables: variables,\n      operationName: operationName,\n    }),\n  });\n};\n\nconst queryName =\n  props.queryName ?? `bo_near_devhub_v17_posts_with_latest_snapshot`;\n\nconst query = `query DevhubPostsQuery($limit: Int = 100, $offset: Int = 0, $where: ${queryName}_bool_exp = {}) {\n    ${queryName}(\n      limit: $limit\n      offset: $offset\n      order_by: {block_height: desc}\n      where: $where\n    ) {\n      post_id\n    }\n  }\n`;\n\nconst includeLabels = [\"blog\", handle];\n\nconst buildWhereClause = () => {\n  let where = {};\n  if (props.author) {\n    where = { author_id: { _eq: props.author }, ...where };\n  }\n  if (props.term) {\n    where = { description: { _ilike: `%${props.term}%` }, ...where };\n  }\n  if (includeLabels && Array.isArray(includeLabels)) {\n    const labelConditions = includeLabels.map((label) => ({\n      labels: { _contains: label },\n    }));\n\n    where = { _and: [...labelConditions, where] };\n  }\n  if (props.excludeLabels && Array.isArray(props.excludeLabels)) {\n    const labelConditions = props.excludeLabels.map((label) => ({\n      labels: { _nin: label },\n    }));\n\n    where = { _and: [...labelConditions, where] };\n  }\n  if (!props.recency) {\n    where = { parent_id: { _is_null: true }, ...where };\n  }\n  return where;\n};\n\nconst variables = { limit: DISPLAY_COUNT, offset, where: buildWhereClause() };\n\nconst posts = fetch(QUERYAPI_ENDPOINT, {\n  method: \"POST\",\n  headers: { \"x-hasura-role\": `bo_near` },\n  body: JSON.stringify({\n    query: query,\n    variables: variables,\n    operationName: \"DevhubPostsQuery\",\n  }),\n});\n\nconst handleOnChange = (v) => {\n  console.log(\"onChange\", v);\n};\n\nconst handleGetData = (v) => {\n  const postId = parseInt(v);\n  return Near.asyncView(\"devgovgigs.near\", \"get_post\", {\n    post_id: postId,\n  }).then((post) => {\n    const description = JSON.parse(post.snapshot.description || \"null\") || {};\n    return {\n      id: postId,\n      ...description,\n    };\n  });\n};\n\nconst handleOnSubmit = (v, isEdit) => {\n  if (isEdit) {\n    Near.call({\n      contractName: \"devgovgigs.near\",\n      methodName: \"edit_post\",\n      args: {\n        id: parseInt(v.id),\n        labels: [\"blog\", handle],\n        body: {\n          post_type: \"Comment\",\n          description: JSON.stringify(v),\n          comment_version: \"V2\",\n        },\n      },\n      gas: Big(10).pow(14),\n    });\n  } else {\n    Near.call({\n      contractName: \"devgovgigs.near\",\n      methodName: \"add_post\",\n      args: {\n        labels: [\"blog\", handle],\n        body: {\n          post_type: \"Comment\",\n          description: JSON.stringify(v),\n          comment_version: \"V2\",\n        },\n      },\n      gas: Big(10).pow(14),\n    });\n  }\n};\n\nconst handleOnCancel = (v) => {\n  console.log(\"onCancel\", v);\n};\n\nreturn (\n  <Layout\n    data={posts.body.data.bo_near_devhub_v17_posts_with_latest_snapshot || []}\n    getData={handleGetData}\n    onChange={handleOnChange}\n    onSubmit={handleOnSubmit}\n    onCancel={handleOnCancel}\n  />\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/thomasguntenaar.near/widget/devhub.entity.addon.blog.editor.provider", "fact_widget_deployments_id": "6622ebcbf12603ff3d5be37b4dd9a4c6", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 32}