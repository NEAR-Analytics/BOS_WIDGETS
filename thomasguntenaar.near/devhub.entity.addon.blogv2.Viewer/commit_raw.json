{"tx_hash": "5hzmW4ZATf9Js6rmZF8oN4a5et9kqBtPvMf9HnKYJp2o", "action_id_social": "8a14y2pmheLRBpEageX3itMJvxKmqARsLc45uP8tg48b-0-widget", "block_id": 119364800, "block_timestamp": "2024-05-20T19:22:22.302Z", "signer_id": "thomasguntenaar.near", "widget_name": "devhub.entity.addon.blogv2.Viewer", "source_code": "const { Card } =\n  VM.require(\"thomasguntenaar.near/widget/devhub.entity.addon.blogv2.Card\") ||\n  (() => <></>);\n\nif (!Card) {\n  return <p>Loading modules...</p>;\n}\n\nconst { href } = VM.require(\"thomasguntenaar.near/widget/core.lib.url\") || (() => {});\n\nconst {\n  data,\n  handle,\n  hideTitle,\n  communityAddonId,\n  setAddonView,\n  transactionHashes,\n} = props;\n\nconst Grid = styled.div`\n  display: grid;\n  grid-template-columns: repeat(3, minmax(0, 1fr));\n  gap: 1rem;\n\n  @media screen and (max-width: 768px) {\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n  }\n`;\n\nconst Heading = styled.h3`\n  color: #151515;\n  font-size: 2rem;\n  font-style: normal;\n  font-weight: 700;\n  line-height: 120%; /* 48px */\n  margin-bottom: 2rem;\n\n  @media screen and (max-width: 768px) {\n    font-size: 1.5rem;\n  }\n`;\n\nconst CardContainer = styled.div`\n  transition: all 300ms;\n  border-radius: 1rem;\n  height: 100%;\n\n  &:hover {\n    box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1),\n      0 4px 6px -4px rgb(0 0 0 / 0.1);\n  }\n`;\n\nif (!handle) {\n  return <div>Missing handle</div>;\n}\n\nlet blogData =\n  Social.get([`${handle}.community.devhub.near/blog/**`], \"final\") || {};\n\nfunction flattenBlogObject(blogsObject) {\n  return (\n    Object.keys(blogsObject)\n      .map((key) => {\n        return {\n          ...blogsObject[key].metadata,\n          id: key,\n          content: blogsObject[key][\"\"],\n        };\n      })\n      // Show only published blogs\n      .filter((blog) => blog.status === \"PUBLISH\")\n      // Every instance of the blog tab has its own blogs\n      .filter((blog) => blog.communityAddonId === communityAddonId)\n  );\n}\n\nif (transactionHashes) {\n  // Fetch new blog data\n  const subscribeToBlogForNextFifteenSec = (tries) => {\n    console.log(\"Trying to fetch new blog data\");\n    let newBlogData = Social.get(\n      [`${handle}.community.devhub.near/blog/**`],\n      \"final\"\n    );\n    if (tries >= 5) {\n      // If we have tried 5 times, just use the data we have for example onBlogUpdate\n      blogData = newBlogData;\n      return;\n    }\n    // Check the number of blogs in this instance with a different status\n    if (\n      flattenBlogObject(newBlogData).length !==\n      flattenBlogObject(blogData).length\n    ) {\n      blogData = newBlogData;\n    } else {\n      setTimeout(() => {\n        subscribeToBlogForNextFifteenSec(tries + 1);\n      }, 3000);\n    }\n  };\n  // After a second subscribe to the blog data\n  setTimeout(() => {\n    subscribeToBlogForNextFifteenSec(0);\n  }, 1000);\n}\n\nconst processedData = flattenBlogObject(blogData)\n  // Sort by published date\n  .sort((blog1, blog2) => {\n    return new Date(blog2.publishedAt) - new Date(blog1.publishedAt);\n  });\n\nfunction BlogCardWithLink(flattenedBlog) {\n  return (\n    <Link\n      style={{ textDecoration: \"none\" }}\n      to={href({\n        widgetSrc: \"thomasguntenaar.near/widget/app\",\n        params: {\n          page: \"blogv2\",\n          id: flattenedBlog.id,\n          community: handle,\n          communityAddonId, // Passed in addon.jsx\n        },\n      })}\n    >\n      {BlogCard(flattenedBlog)}\n    </Link>\n  );\n}\n\nfunction NoBlogCard() {\n  return (\n    <div onClick={() => setAddonView(\"configure\")} className=\"min-vh-100\">\n      <div>\n        {BlogCard({\n          category: \"\",\n          title: \"No blogs yet\",\n          description: \"Click here to add your first blog!\",\n          publishedAt: new Date().toISOString(),\n          id: \"new\",\n        })}\n      </div>\n    </div>\n  );\n}\n\nfunction BlogCard(flattenedBlog) {\n  return (\n    <CardContainer>\n      <Card data={flattenedBlog} />\n    </CardContainer>\n  );\n}\n\nreturn (\n  <div class=\"w-100\">\n    {!hideTitle && <Heading> Latest Blog Posts</Heading>}\n    <Grid>\n      {processedData && processedData.length > 0\n        ? processedData.map((flattenedBlog) => BlogCardWithLink(flattenedBlog))\n        : NoBlogCard()}\n    </Grid>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/thomasguntenaar.near/widget/devhub.entity.addon.blogv2.Viewer", "fact_widget_deployments_id": "9b301e1733258c53d01005973f0aba06", "inserted_timestamp": "2024-05-20T20:52:52.215Z", "modified_timestamp": "2024-05-20T20:52:52.215Z", "__row_index": 1}