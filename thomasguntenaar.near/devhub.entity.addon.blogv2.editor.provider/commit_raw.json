{"tx_hash": "AtoNQcA2heYgMpyHWrVnefK5nPBbG7rzJNHMDdZgEAnP", "action_id_social": "DF2etUiqwdDaQnjbKVhA9SGEsixFsqs5nUctge5GJAWi-0-widget", "block_id": 117611045, "block_timestamp": "2024-04-25T18:51:51.771Z", "signer_id": "thomasguntenaar.near", "widget_name": "devhub.entity.addon.blogv2.editor.provider", "source_code": "const { getPost, setCommunitySocialDB } = VM.require(\n  \"thomasguntenaar.near/widget/core.adapter.devhub-contract\"\n);\n\nconst { Layout, handle, communityAddonId } = props;\n\nsetCommunitySocialDB = setCommunitySocialDB || (() => <></>);\ngetPost = getPost || (() => <></>);\n\nconst handleOnChange = (v) => {\n  console.log(\"onChange\", v);\n};\n\nconst handleGetData = (v) => {\n  const id = transformString(v.title);\n  return blogData[id] || {};\n};\n\n// TODO Test when their is data in the communitySocialDB\nconst blogData =\n  Social.get(\n    [\n      // `${handle}.community.devhub.near/blog/**`,\n      \"thomasguntenaar.near/blog/**\",\n    ],\n    \"final\"\n  ) || {};\n\nfunction transformString(str) {\n  // Convert the string to lowercase\n  const lowerCaseStr = str.toLowerCase();\n\n  // Replace spaces with hyphens\n  const transformedStr = lowerCaseStr.replace(/ /g, \"-\");\n\n  // Return the transformed string\n  return transformedStr;\n}\n\nconst handleOnSubmit = (v, isEdit) => {\n  console.log(\"isEdit\", isEdit);\n  // TODO only difference is the created at or not\n  // ! use v.createdAt || new Date().toISOString()\n  if (isEdit) {\n    // TODO setCommunitySocialDB\n    Social.set({\n      blog: {\n        [v.id]: {\n          \"\": v.content,\n          metadata: {\n            title: v.title,\n            publishedAt: new Date(v.date).toISOString().slice(0, 10),\n            status: v.status,\n            subtitle: v.subtitle,\n            description: v.description,\n            author: v.author,\n          },\n        },\n      },\n    });\n    console.log(\"handle edit blog\", v);\n  } else {\n    console.log(\"handle add blog\", v);\n    // !setCommunitySocialDB({\n    // !  handle,\n    // !  data: {},\n    // ! });\n    Social.set({\n      blog: {\n        [`${transformString(v.title)}-${generateRandom6CharUUID()}`]: {\n          \"\": v.content,\n          metadata: {\n            title: v.title,\n            createdAt: new Date().toISOString().slice(0, 10),\n            updatedAt: new Date().toISOString().slice(0, 10),\n            publishedAt: v.date,\n            status: v.status,\n            subtitle: v.subtitle,\n            description: v.description,\n            author: v.author,\n            communityAddonId: communityAddonId,\n          },\n        },\n      },\n    });\n  }\n};\n\nfunction generateRandom6CharUUID() {\n  const chars = \"0123456789abcdefghijklmnopqrstuvwxyz\";\n  let result = \"\";\n\n  for (let i = 0; i < 6; i++) {\n    const randomIndex = Math.floor(Math.random() * chars.length);\n    result += chars[randomIndex];\n  }\n\n  return result;\n}\n\nconst handleOnCancel = (v) => {\n  console.log(\"onCancel\", v);\n};\n\nconst handleOnDelete = (id) => {\n  console.log(\"onDelete\", v);\n  // TODO setCommunitySocialDB\n  Social.set({\n    blog: {\n      [id]: {\n        \"\": null,\n        metadata: {\n          title: null,\n          createdAt: null,\n          updatedAt: null,\n          publishedAt: null,\n          status: null,\n          subtitle: null,\n          description: null,\n          author: null,\n          id: null,\n        },\n      },\n    },\n  });\n};\n\nconst handleSettingsPage = () => {\n  // TODO 599\n  // Pass this via editor.index to the layout\n};\n\nreturn (\n  <Layout\n    data={blogData || []}\n    getData={handleGetData}\n    onChange={handleOnChange}\n    onSubmit={handleOnSubmit}\n    onCancel={handleOnCancel}\n    onDelete={handleOnDelete}\n  />\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/thomasguntenaar.near/widget/devhub.entity.addon.blogv2.editor.provider", "fact_widget_deployments_id": "5dc3d9e3716f6ee5478f686a4a4a17ff", "inserted_timestamp": "2024-04-25T20:39:41.964Z", "modified_timestamp": "2024-04-25T20:39:41.964Z", "__row_index": 0}