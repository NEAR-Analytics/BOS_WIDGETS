{"tx_hash": "Gk93cghWo9EMzWnDbWs8FwM4D3Dz9nXX7viJc6XvXsn6", "action_id_social": "87e32gicCEJyhEh4YSyMs5dJ5jkosYEQjbuUYgMfDudv-0-widget", "block_id": 120007517, "block_timestamp": "2024-05-29T17:10:42.942Z", "signer_id": "thomasguntenaar.near", "widget_name": "devhub.entity.addon.blogv2.editor.BlogPostSettings", "source_code": "const { normalize } = VM.require(\"thomasguntenaar.near/widget/core.lib.stringUtils\");\nnormalize || (normalize = () => {});\n\nconst { data, onHideSettings, onSubmit } = props;\n\n// console.log(\"addonParametersJSON\", addonParametersJSON);\n\nconst [title, setTitle] = useState(data.title || \"\");\nconst [subtitle, setSubtitle] = useState(data.subtitle || \"\");\nconst [authorEnabled, setAuthorEnabled] = useState(\n  data.authorEnabled || \"disabled\"\n);\nconst [searchEnabled, setSearchEnabled] = useState(\n  data.searchEnabled || \"disabled\" // 'enabled', 'disabled'\n);\nconst [orderBy, setOrderBy] = useState(data.orderBy || \"timedesc\"); // timedesc, timeasc, alpha\n// TODO\nconst [postPerPage, setPostPerPage] = useState(data.postPerPage || 10);\n\n// TODO\nconst [categoriesEnabled, setCategoriesEnabled] = useState(\n  data.categoriesEnabled || \"disabled\" // 'enabled', 'disabled'\n);\n// TODO\nconst [labels, setLabels] = useState(data.categories || []);\nconst [categories, setCategories] = useState(\n  (data.categories || []).map((o) => o.category)\n);\n// TODO\nconst [categoryRequired, setCategoryRequired] = useState(\n  data.categoryRequired || \"not_required\" // required | not_required\n);\n\nconst InputContainer = ({ heading, description, children }) => {\n  return (\n    <div className=\"d-flex flex-column gap-1 gap-sm-2 w-2/3\">\n      <b className=\"h6 mb-0\">{heading}</b>\n      {description && (\n        <div className=\"text-muted w-100 text-sm\">{description}</div>\n      )}\n      {children}\n    </div>\n  );\n};\n\nconst TitleComponent = useMemo(() => {\n  return (\n    <Widget\n      src=\"thomasguntenaar.near/widget/devhub.components.molecule.Input\"\n      props={{\n        className: \"flex-grow-1\",\n        value: title,\n        placeholder: \"Title\",\n        onChange: (e) => setTitle(e.target.value),\n        skipPaddingGap: true,\n        inputProps: {\n          max: 40,\n          required: true,\n          name: \"title\",\n          className:\n            \"block w-full rounded-md border-0 px-1 py-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6\",\n        },\n      }}\n    />\n  );\n}, []);\n\nconst SubtitleComponent = useMemo(() => {\n  return (\n    <Widget\n      src=\"thomasguntenaar.near/widget/devhub.components.molecule.Input\"\n      props={{\n        className: \"flex-grow-1\",\n        value: subtitle,\n        placeholder: \"Subtitle\",\n        onChange: (e) => setSubtitle(e.target.value),\n        skipPaddingGap: true,\n        inputProps: {\n          required: false,\n          max: 80,\n          name: \"subtitle\",\n          className:\n            \"block w-full rounded-md border-0 px-1 py-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6\",\n        },\n      }}\n    />\n  );\n}, []);\n\nconst AuthorEnabledSwitchComponent = useMemo(() => {\n  return (\n    <Widget\n      src=\"thomasguntenaar.near/widget/devhub.components.molecule.Switch\"\n      props={{\n        currentValue: authorEnabled,\n        key: \"authorEnabled\",\n        onChange: (e) => setAuthorEnabled(e.target.value),\n        options: [\n          { label: \"Enabled\", value: \"enabled\" },\n          { label: \"Disabled\", value: \"disabled\" },\n        ],\n        title: \"Author Enabled\",\n      }}\n    />\n  );\n}, [authorEnabled]);\n\nconst SearchSwitchComponent = useMemo(() => {\n  return (\n    <Widget\n      src=\"thomasguntenaar.near/widget/devhub.components.molecule.Switch\"\n      props={{\n        currentValue: searchEnabled,\n        key: \"search\",\n        onChange: (e) => setSearchEnabled(e.target.value),\n        options: [\n          { label: \"Enabled\", value: \"enabled\" },\n          { label: \"Disabled\", value: \"disabled\" },\n        ],\n        title: \"Search\",\n      }}\n    />\n  );\n}, [searchEnabled]);\n\nconst OrderBySwitchComponent = useMemo(() => {\n  return (\n    <Widget\n      src=\"thomasguntenaar.near/widget/devhub.components.molecule.Switch\"\n      props={{\n        currentValue: orderBy,\n        key: \"orderBy\",\n        onChange: (e) => setOrderBy(e.target.value),\n        options: [\n          { label: \"Newest to oldest\", value: \"timedesc\" },\n          { label: \"Oldest to newest\", value: \"timeasc\" },\n          { label: \"Alphabetical\", value: \"alpha\" },\n        ],\n        title: \"Order by\",\n      }}\n    />\n  );\n}, [orderBy]);\n\nconst PostsPerPageComponent = (\n  <div className=\"col-lg-6 mb-2\">\n    <input\n      className=\"block w-full rounded-md border-0 px-1 py-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6\"\n      data-testid=\"post-per-page-input\"\n      type=\"number\"\n      value={parseInt(postPerPage) > 0 ? postPerPage : \"\"}\n      min={0}\n      onChange={(event) => {\n        console.log(\"onChange\", event.target.value.toString());\n        setPostPerPage(event.target.value.toString().replace(/[a-zA-Z]/g, \"\"));\n      }}\n    />\n  </div>\n);\n\nconst CategoriesEnabledComponent = useMemo(() => {\n  return (\n    <Widget\n      src=\"thomasguntenaar.near/widget/devhub.components.molecule.Switch\"\n      props={{\n        currentValue: categoriesEnabled,\n        key: \"categories\",\n        onChange: (e) => setCategoriesEnabled(e.target.value),\n        options: [\n          { label: \"Enabled\", value: \"enabled\" },\n          { label: \"Disabled\", value: \"disabled\" },\n        ],\n\n        title: \"Categories\",\n      }}\n    />\n  );\n}, [categoriesEnabled]);\n\nconst CategoryRequiredSwitchComponent = useMemo(() => {\n  return (\n    <Widget\n      src=\"thomasguntenaar.near/widget/devhub.components.molecule.Switch\"\n      props={{\n        currentValue: categoryRequired,\n        key: \"categoryRequired\",\n        onChange: (e) => setCategoryRequired(e.target.value),\n        options: [\n          { label: \"Required\", value: \"required\" },\n          { label: \"Not Required\", value: \"not_required\" },\n        ],\n        title: \"Category Required\",\n      }}\n    />\n  );\n}, [categoryRequired]);\n\nconst checkCategory = (category) => {\n  console.log(\"checkCategory\", category);\n};\n\nconst onChangeCategories = (_labels) => {\n  _labels = _labels.map((o) => ({\n    category: o.category, // labelKey == category\n    value: normalize(o.category),\n  }));\n  let categoriesArray = [];\n  categoriesArray = _labels.map((o) => o.category);\n  setCategories(categoriesArray);\n  setLabels(_labels);\n};\n\nconst CategoriesEditor = useMemo(() => {\n  const examples = [\"News\", \"Guide\", \"Reference\"];\n  const options = examples\n    .map((category) => {\n      return { category };\n    })\n    .filter((o) => !categories.includes(o.category));\n\n  return (\n    <Typeahead\n      multiple\n      labelKey=\"category\"\n      onInputChange={checkCategory}\n      onChange={onChangeCategories}\n      options={options}\n      placeholder=\"News, Guide, Reference, etc.\"\n      selected={labels}\n      positionFixed\n      caseSensitive={true}\n      allowNew={(results, props) => {\n        // Don't allow more than 10 categories\n        return props.selected.length < 10;\n      }}\n    />\n  );\n}, [categories, labels]);\n\nconst FormContainer = styled.div`\n  & > *:not(:last-child) {\n    margin-bottom: 2rem;\n  }\n`;\n\nuseEffect(() => {\n  console.log(categories);\n}, [categories]);\n\n/**\n * If the settings are empty we use default values for blog settings\n * These default values should reflect in the configurator / viewer and settings page\n */\nconst handleOnSubmit = () => {\n  if (categoriesEnabled === \"enabled\" && categories.length === 0) {\n    return;\n  }\n\n  const cEnabled = categoriesEnabled || \"disabled\";\n  // If categories are enabled there must be at least 1 category\n  const cats =\n    cEnabled == \"enabled\" && categories && categories.length > 0\n      ? categories\n      : [];\n  // If categories are empty they can not be required\n  const req = cats.length ? categoryRequired : \"not_required\";\n\n  onSubmit({\n    title: title || \"\",\n    subtitle: subtitle || \"\",\n    authorEnabled: authorEnabled || \"disabled\", // 'enabled', 'disabled'\n    searchEnabled: searchEnabled || \"disabled\", // 'enabled', 'disabled'\n    orderBy: orderBy || \"timedesc\", // timedesc, timeasc, alpha\n    categoriesEnabled: cEnabled, // 'enabled', 'disabled'\n    categories: cats,\n    categoryRequired: req,\n    // minimum of 5 posts per page\n    postPerPage: postPerPage < 5 ? 5 : postPerPage,\n  });\n};\n\nconst categoriesIsInvalid = () =>\n  categoriesEnabled === \"enabled\" && categories.length === 0;\n\nconst submitDisabled = () => {\n  return categoriesIsInvalid() || !title || !subtitle;\n};\n\nreturn (\n  <div>\n    <FormContainer>\n      <div>\n        <div className=\"d-flex justify-content-between\">\n          <div>\n            <h2 className=\"text-xl font-bold leading-7 text-gray-900\">\n              Blog List Page\n            </h2>\n            <p className=\"mt-1 text-sm leading-6 text-gray-500\">\n              This information will be displayed publicly.\n            </p>\n          </div>\n          <div className=\"d-flex gap-1 align-items-center justify-content-end\">\n            <Widget\n              src={`thomasguntenaar.near/widget/devhub.components.molecule.Button`}\n              props={{\n                classNames: {\n                  root: \"d-flex text-muted fw-bold btn-outline shadow-none border-0 btn-sm\",\n                },\n                label: \"Cancel\",\n                onClick: onHideSettings,\n              }}\n            />\n            <Widget\n              src={\n                \"thomasguntenaar.near/widget/devhub.components.molecule.BlogControl\"\n              }\n              props={{\n                title: \"Save Settings\",\n                onClick: handleOnSubmit,\n                testId: \"save-settings-button\",\n                disabled: submitDisabled(),\n                icon: \"bi-plus-circle-fill\",\n              }}\n            />\n          </div>\n        </div>\n        <div className=\"w-100 border-b\"></div>\n      </div>\n\n      <InputContainer\n        heading=\"Title\"\n        description=\"Highlight the essence of your blog in a few words. This will appear on the top of your blog page.\"\n      >\n        {TitleComponent}\n      </InputContainer>\n      <InputContainer\n        heading=\"Subtitle\"\n        description=\"Provide a brief subtitle for the blog\"\n      >\n        {SubtitleComponent}\n      </InputContainer>\n      <InputContainer\n        heading=\"Author visible\"\n        description=\"Show the author of the blog post.\"\n      >\n        {AuthorEnabledSwitchComponent}\n      </InputContainer>\n      <InputContainer\n        heading=\"Search\"\n        description=\"Enable or disable the user to search for blog posts\"\n      >\n        {SearchSwitchComponent}\n      </InputContainer>\n      <InputContainer\n        heading=\"Order by\"\n        description=\"Blog post sorting order (e.g. Newest to oldest, Oldest to newest,\n          Alphabetical). Note: Time sorting is based on the visible publish date.\"\n      >\n        {OrderBySwitchComponent}\n      </InputContainer>\n      <InputContainer\n        heading=\"Number of blogs per page (Numbers Only)\"\n        description=\"Number of visible blog cards displayed per blog tab\"\n      >\n        {PostsPerPageComponent}\n      </InputContainer>\n      <div>\n        <h2 className=\"text-xl font-bold leading-7 text-gray-900\">\n          Blog Post Fields\n        </h2>\n        <p className=\"mt-1 text-sm leading-6 text-gray-500\">\n          The blog and preview card, both display the category when it is\n          enabled.\n        </p>\n        <div className=\"w-100 border-b\"></div>\n      </div>\n      <InputContainer\n        heading=\"Enable categories\"\n        description=\"Enable or disable categories on blogs. You must have 1 category to enable this field.\"\n      >\n        {CategoriesEnabledComponent}\n      </InputContainer>\n      <InputContainer\n        heading=\"Manage categories\"\n        description=\"Add/edit/delete up to 10 custom category options\"\n      >\n        {CategoriesEditor}\n      </InputContainer>\n      <InputContainer\n        heading=\"Category Required\"\n        description=\"Decide if to make this field required for every blog post. You must have 1 category to require this field.\"\n      >\n        {CategoryRequiredSwitchComponent}\n      </InputContainer>\n    </FormContainer>\n\n    <div className=\"d-flex gap-1 align-items-center justify-content-end mt-3\">\n      <Widget\n        src={`thomasguntenaar.near/widget/devhub.components.molecule.Button`}\n        props={{\n          classNames: {\n            root: \"d-flex text-muted fw-bold btn-outline shadow-none border-0 btn-sm\",\n          },\n          label: \"Cancel\",\n          onClick: onHideSettings,\n        }}\n      />\n      <Widget\n        src={\"thomasguntenaar.near/widget/devhub.components.molecule.BlogControl\"}\n        props={{\n          title: \"Save Settings\",\n          onClick: handleOnSubmit,\n          testId: \"save-settings-button\",\n          disabled: submitDisabled(),\n          icon: \"bi-plus-circle-fill\",\n        }}\n      />\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/thomasguntenaar.near/widget/devhub.entity.addon.blogv2.editor.BlogPostSettings", "fact_widget_deployments_id": "973588fcfaaece5709ab5fa2b685b976", "inserted_timestamp": "2024-05-29T19:43:20.222Z", "modified_timestamp": "2024-05-29T19:43:20.222Z", "__row_index": 4}