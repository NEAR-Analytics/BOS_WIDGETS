{"tx_hash": "GNu6LiEB6uGE73H9c7uCQSNT6Jitykv5AMmYgSiDe1K4", "action_id_social": "9k7vL6aeVVeb13HJJva35yHtDhHFj2GcTJpLS5jFBhSq-0-widget", "block_id": 112189316, "block_timestamp": "2024-02-05T22:33:29.643Z", "signer_id": "thomasguntenaar.near", "widget_name": "devhub.entity.community.Discussions", "source_code": "const { handle } = props;\nconst { getCommunity, setCommunitySocialDB } = VM.require(\n  \"${REPL_DEVHUB}/widget/core.adapter.devhub-contract\"\n);\n\ngetCommunity = getCommunity || (() => <></>);\nsetCommunitySocialDB = setCommunitySocialDB || (() => <></>);\n\nconst communityData = getCommunity({ handle });\n\nconst MainContent = styled.div`\n  padding-left: 2rem;\n  flex: 3;\n  @media screen and (max-width: 960px) {\n    padding-left: 0rem;\n  }\n  .post:hover {\n    background-color: inherit !important;\n  }\n`;\n\nconst SidebarContainer = styled.div`\n  flex: 1;\n`;\n\nconst Heading = styled.div`\n  font-size: 19px;\n  font-weight: 600;\n`;\n\nconst SubHeading = styled.div`\n  font-size: 15px;\n  font-weight: 600;\n`;\n\nconst Container = styled.div`\n  flex-wrap: no-wrap;\n  max-width: 100%;\n\n  .max-width-100 {\n    max-width: 100%;\n  }\n  @media screen and (max-width: 960px) {\n    flex-wrap: wrap;\n  }\n\n  .card {\n    border-radius: 1rem !important;\n  }\n`;\n\nconst Tag = styled.div`\n  border-top-right-radius: 50px;\n  border-bottom-right-radius: 50px;\n  border-top-left-radius: 50px;\n  border-bottom-left-radius: 50px;\n  padding-inline: 0.8rem;\n  padding-block: 0.3rem;\n  display: flex;\n  gap: 0.5rem;\n  border-width: 1px;\n  border-style: solid;\n  font-size: 14px;\n  color: rgba(0, 236, 151, 1);\n  font-weight: 800;\n`;\n\nconst [sort, setSort] = useState(\"timedesc\");\n\nlet test = Social.get(`${context.accountId}/post/main`, {\n  options: { with_block_height: true },\n});\nconsole.log(\"test\", test);\n\nreturn (\n  <div className=\"w-100\" style={{ maxWidth: \"100%\" }}>\n    <Container className=\"d-flex gap-3 m-3 pl-2\">\n      <MainContent className=\"max-width-100\">\n        <div className=\"d-flex flex-column gap-4\">\n          {context.accountId && (\n            <div className=\"card p-4\">\n              <Widget\n                src={\"${REPL_DEVHUB}/widget/devhub.entity.community.Compose\"}\n                props={{\n                  onSubmit: (v) => {\n                    Social.set(`${context.accountId}/post/main`, v, {\n                      onCommit: (data) => {\n                        console.log(\"onCommit\");\n                        console.log(\"data\", data);\n\n                        const Social = {\n                          get: (...args) => {\n                            if (args.length < 1) {\n                              throw new Error(\n                                \"Missing argument 'keys' for Social.get\"\n                              );\n                            }\n                            return cachedSocialGet(\n                              args[0],\n                              false,\n                              args[1],\n                              args[2],\n                              args[3]\n                            );\n                          },\n                        };\n\n                        function cachedSocialGet(\n                          keys,\n                          recursive,\n                          blockId,\n                          options,\n                          cacheOptions\n                        ) {\n                          keys = Array.isArray(keys) ? keys : [keys];\n                          return cachedPromise(\n                            (invalidate) =>\n                              this.cache.socialGet(\n                                this.near,\n                                keys,\n                                recursive,\n                                blockId,\n                                options,\n                                invalidate,\n                                cacheOptions\n                              ),\n                            options?.subscribe\n                          );\n                        }\n\n                        function socialGet(\n                          near,\n                          keys,\n                          recursive,\n                          blockId,\n                          options,\n                          invalidate,\n                          cacheOptions\n                        ) {\n                          if (!near) {\n                            return null;\n                          }\n                          keys = Array.isArray(keys) ? keys : [keys];\n                          keys = keys.map((key) =>\n                            recursive ? `${key}/**` : `${key}`\n                          );\n                          const args = {\n                            keys,\n                            options,\n                          };\n                          let data = this.cachedViewCall(\n                            near,\n                            near.config.contractName,\n                            \"get\",\n                            args,\n                            blockId,\n                            invalidate,\n                            cacheOptions\n                          );\n                          if (data === null) {\n                            return null;\n                          }\n\n                          if (keys.length === 1) {\n                            const parts = keys[0].split(\"/\");\n                            for (let i = 0; i < parts.length; i++) {\n                              const part = parts[i];\n                              if (part === \"*\" || part === \"**\") {\n                                break;\n                              }\n                              data = data?.[part];\n                            }\n                          }\n\n                          return data;\n                        }\n\n                        console.log(\"test\", test);\n                        // Near.get(\n                        //   \"${REPL_DEVHUB_CONTRACT}\",\n                        //   \"get_block_height\",\n                        //   {\n                        //     onReturn: (blockHeight) => {\n                        //       Near.call(\n                        //         \"${REPL_DEVHUB_CONTRACT}\",\n                        //         \"create_discussion\",\n                        //         {\n                        //           community_handle: \"...\",\n                        //           near_social_post_block_height: blockHeight,\n                        //         }\n                        //       );\n                        //     },\n                        //   }\n                        // );\n                      },\n                    });\n                  },\n                }}\n              />\n            </div>\n          )}\n          <div className=\"d-flex flex-wrap justify-content-between\">\n            <Heading>Announcements</Heading>\n            <div className=\"d-flex align-items-center gap-2\">\n              <select\n                name=\"sort\"\n                id=\"sort\"\n                class=\"form-select\"\n                value={sort}\n                onChange={(e) => {\n                  setSort(e.target.value);\n                }}\n              >\n                <option selected value=\"timedesc\">\n                  Latest\n                </option>\n                <option value=\"recentcommentdesc\">Last Commented</option>\n              </select>\n            </div>\n          </div>\n\n          <Widget\n            src=\"${REPL_DEVHUB}/widget/devhub.components.organism.Feed\"\n            props={{\n              showFlagAccountFeature: true,\n              action: \"repost\",\n              filteredAccountIds: [\n                `discussions.${handle}.community.${REPL_DEVHUB_CONTRACT}`,\n              ],\n              sort: sort,\n            }}\n          />\n        </div>\n      </MainContent>\n      <SidebarContainer>\n        <div className=\"d-flex flex-column gap-3\">\n          <div className=\"card p-4\">\n            <div className=\"mb-2\">{communityData?.description}</div>\n            <div className=\"d-flex gap-2 flex-wrap\">\n              <Tag>{communityData?.tag} </Tag>\n            </div>\n          </div>\n          <div className=\"card p-4 d-flex flex-column gap-2\">\n            <SubHeading>Community Admins</SubHeading>\n            {(communityData?.admins ?? []).map((accountId) => (\n              <div\n                key={accountId}\n                className=\"d-flex\"\n                style={{ fontWeight: 500 }}\n              >\n                <Widget\n                  src=\"${REPL_DEVHUB}/widget/devhub.components.molecule.ProfileCard\"\n                  props={{ accountId }}\n                />\n              </div>\n            ))}\n          </div>\n        </div>\n      </SidebarContainer>\n    </Container>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/thomasguntenaar.near/widget/devhub.entity.community.Discussions", "fact_widget_deployments_id": "1394f9564489fdc4f628ec7606d72f69", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 10}