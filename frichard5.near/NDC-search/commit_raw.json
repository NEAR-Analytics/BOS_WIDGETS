{"tx_hash": "7z4d2Q3NvBhgWcAZfY3K3NtYffWuSZMMe7d1yTJSTgiw", "action_id_social": "HbJWHcCgYteSpFbw9aVPmzwtjBY7V2z5DXX3gaV33HUC-0-widget", "block_id": 96216593, "block_timestamp": "2023-07-11T10:46:20.593Z", "signer_id": "frichard5.near", "widget_name": "NDC-search", "source_code": "const { account, widgetProvider, proposal_id, ftList, parent } = props;\nconst apiProposalUrl = `https://api.pikespeak.ai/daos/proposal/${account}`;\nconst apiPolicyUrl = `https://api.pikespeak.ai/daos/policy`;\nconst publicApiKey = \"36f2b87a-7ee6-40d8-80b9-5e68e587a5b5\";\n\nState.init({\n  input: \"\",\n  ftList: ftList,\n  proposal_id: proposal_id,\n});\n\n// Fetch\nif (!ftList) {\n  const fetchedFtList = fetch(refUrl);\n  State.update({ ftList: fetchedFtList.body });\n}\n\nconst Input = (\n  <Widget\n    src={`${widgetProvider}/widget/NDC-input`}\n    props={{\n      buttonLabel: \"Search\",\n      placeholder: \"Enter a proposal id\",\n      sendInput: (i) => {\n        if (!isNaN(i)) {\n          State.update({ proposal_id: i, fetchingProposal: true });\n        }\n      },\n    }}\n  />\n);\n\nconst getVoters = () => {\n    let proposalType = state.proposal.proposal_type.toLowerCase();\n    proposalType = proposalType==='functioncall'?'call':proposalType;\n    return state.policy.state.policy.roles.reduce((acc,val) => {\n        const isGroupAllowed = val.permissions.some((p) => {\n            const parsedP = p.toLowerCase().replaceAll('_','');\n            return parsedP.includes(`${proposalType}:voteapprove`)||parsedP.includes(`*:voteapprove`)\n        });\n        if(isGroupAllowed) {\n            acc.push(...val.kind);\n        }\n        return acc\n    }, [])\n}\n\nconst ProposalCard = (\n  <Widget\n    src={`${widgetProvider}/widget/NDC-proposal-card`}\n    props={{\n      proposal: state.proposal,\n      widgetProvider,\n      ftList: state.ftList,\n      council: state.policy && state.proposal && getVoters(),\n      voteExpired: state.policy && state.policy.state.policy.proposal_period,\n      parent,\n    }}\n  />\n);\n\nconst fetchProposal = (id) => {\n  const proposal = fetch(apiProposalUrl + `?id=${id}`, {\n    mode: \"cors\",\n    headers: {\n      \"x-api-key\": publicApiKey,\n    },\n  });\n  proposal.body &&\n    State.update({\n      proposal: proposal.body.length ? proposal.body[0] : false,\n      error: !proposal.body.length\n        ? `Proposal ${state.proposal_id} not found`\n        : false,\n      fetchingProposal: false,\n    });\n};\n\nconst fetchPolicy = (daos) => {\n  const policy = asyncFetch(apiPolicyUrl + `?daos=${daos}`, {\n    mode: \"cors\",\n    headers: {\n      \"x-api-key\": publicApiKey,\n    },\n  }).then(({ err, body, ok }) => {\n    if (ok) {\n      State.update({\n        policy: body,\n      });\n    }\n  });\n};\n\n!state.policy && fetchPolicy([account]);\n\nfetchProposal(state.proposal_id);\n\nconst Error = styled.div`\n  text-align: center;\n  margin-top: 40px;\n`;\n\nconst InputWrapper = styled.div`\n  position: relative;\n  left: 50%;\n  transform: translateX(-50%);\n  width: fit-content;\n  margin-top: 40px;\n`;\n\nreturn (\n  <>\n    <InputWrapper>{Input}</InputWrapper>\n    {!state.fetchingProposal && state.proposal && state.policy && ProposalCard}\n    {state.error && <Error>{state.error}</Error>}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/frichard5.near/widget/NDC-search", "fact_widget_deployments_id": "8ba6da39285dd88f1bbf645637a45fbb", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}