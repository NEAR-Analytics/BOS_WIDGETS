{"tx_hash": "3J2fiaSm14MCDHdjBGvkLKjDqbRsubSv1ADLYknCiFPQ", "action_id_social": "FthqyiafkfbXNqr8xp2THbEtTmjKHi5Zh5UxdKWMAGkd-0-widget", "block_id": 104480095, "block_timestamp": "2023-10-29T18:20:05.185Z", "signer_id": "aaron.near", "widget_name": "VitalPointAI.Notifications.Settings", "source_code": null, "metadata": null, "branch": {"draft": {"": "let {\n  isLocalStorageSupported,\n  isNotificationSupported,\n  isPermisionGranted,\n  isPushManagerSupported,\n  handleTurnOn,\n  handleOnCancel,\n  getNotificationLocalStorage,\n  handleOnCancelBanner,\n  accountId,\n  handlePushManagerUnsubscribe,\n  iOSDevice,\n  loading,\n  disabled,\n} = props;\n\nconst notificationSupported = isNotificationSupported();\n\nconst Wrapper = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n  padding-bottom: 48px;\n  padding-top: 48px;\n  max-width: 592px;\n  margin: 0 auto;\n`;\n\nconst Text = styled.div`\n  font: var(--text-s);\n  color: var(--sand11);\n  font-weight: 450;\n`;\n\nconst TextLink = styled.a`\n  font-weight: 600;\n`;\n\nconst IosNotification = () => (\n  <Text>\n    <i className=\"ph-bold ph-info\" />\n    In order to enable Mobile Browser notifications on iOS, you will also need\n    to add near.org as a icon to your home screen. Click on the share icon, and\n    then tap on <b>\"Add to Home Screen\"</b>\n  </Text>\n);\n\nconst SettingHeaderContent = () => {\n  return (\n    <>\n      {iOSDevice && <IosNotification />}\n      <Text>\n        Learn more about notifications\n        <TextLink href=\"https://near.org/blog/announcing-web-push-notifications-on-b-o-s\">\n          here\n        </TextLink>\n      </Text>\n    </>\n  );\n};\n\n// TODO: solution to pass data to this component\n// at this moment we don't have a simple solution to pass data to this component\n// we are not able to detect if notifications are supported,\n// and we are not able to handle Turn On button\n\nconst permission = getNotificationLocalStorage()?.permission;\n\nState.init({\n  showTurnOn: !isPermisionGranted() || (isPermisionGranted() && !permission),\n  showTurnOff: isPermisionGranted() && !!permission,\n});\n\nconst checkShow = () => {\n  const permission = getNotificationLocalStorage()?.permission;\n  State.update({\n    showTurnOn: !isPermisionGranted() || (isPermisionGranted() && !permission),\n    showTurnOff: isPermisionGranted() && !!permission,\n  });\n};\n\nreturn (\n  <Wrapper className=\"container-xl\">\n    <Widget\n      src=\"near/widget/NearOrg.Notifications.SettingsHeader\"\n      props={{\n        title: \"Notification Settings\",\n        text: \"Configure your notifications for activity on near.org\",\n        content: <SettingHeaderContent />,\n      }}\n    />\n\n    {state.showTurnOn && (\n      <Widget\n        src=\"near/widget/NearOrg.Notifications.SettingsListItem\"\n        props={{\n          handleOnClick: () => {\n            handleTurnOn(accountId, checkShow);\n          },\n          label: \"Turn On\",\n          loading,\n          disabled,\n        }}\n      />\n    )}\n    {state.showTurnOff && (\n      <Widget\n        src=\"near/widget/NearOrg.Notifications.SettingsListItem\"\n        props={{\n          handleOnClick: () => {\n            handlePushManagerUnsubscribe(checkShow);\n          },\n          label: \"Turn Off\",\n          loading,\n          disabled,\n        }}\n      />\n    )}\n    {!notificationSupported && (\n      <Widget\n        src=\"near/widget/NearOrg.Notifications.SettingsTurnOn\"\n        props={{\n          iOSDevice,\n        }}\n      />\n    )}\n  </Wrapper>\n);\n"}}, "widget_modules_used": null, "widget_url": "https://near.social/#/aaron.near/widget/VitalPointAI.Notifications.Settings", "fact_widget_deployments_id": "f53b7bf1d999acb2a2b29848a9fdbcd6", "inserted_timestamp": "2023-10-29T20:23:04.658Z", "modified_timestamp": "2023-10-29T20:23:04.658Z", "__row_index": 1}