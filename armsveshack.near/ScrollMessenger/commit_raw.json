{"tx_hash": "DcPEDCb4GEXMWeeUpiitmDmNKf4tdQstzNKPcvwerfap", "action_id_social": "81sENzU8vZvoGxueKe4VR4yGg8vLhgTbrzWixNvoTnyJ-0-widget", "block_id": 106032352, "block_timestamp": "2023-11-19T05:23:45.681Z", "signer_id": "armsveshack.near", "widget_name": "ScrollMessenger", "source_code": "const cssFont = fetch(\n  \"https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap\"\n).body;\nconst css = fetch(\n  \"https://gist.githubusercontent.com/armsves/128e3df2b069e2339ede8ba1aee1ac8f/raw/c30e36a5bccbb5b61d3a1357ed9a48ad8baca146/gistfile1.txt\"\n).body;\n\nif (!cssFont || !css) return \"\";\n\nif (!state.theme) {\n  State.update({\n    theme: styled.div`\n    font-family: Manrope, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif;\n    ${cssFont}\n    ${css}\n`,\n  });\n}\nconst Theme = state.theme;\n\nconst receiver = Ethers.send(\"eth_requestAccounts\", [])[0];\nif (!receiver) {\n  return <Web3Connect />;\n}\n\nif (state.sender === undefined) {\n  const accounts = Ethers.send(\"eth_requestAccounts\", []);\n  if (accounts.length) {\n    State.update({ sender: accounts[0] });\n    //console.log(\"set sender\", accounts[0]);\n  }\n}\n\nconst contractAddress = \"0x526922E0426d0705eCa8ace5dF50399654657bE0\";\nconst sender = Ethers.send(\"eth_requestAccounts\", [])[0];\nconst abi = fetch(\n  \"https://api-sepolia.scrollscan.com/api?module=contract&action=getabi&address=0x526922E0426d0705eCa8ace5dF50399654657bE0\"\n);\nif (!abi.ok) {\n  return \"Abi not found\";\n}\n\nconst messages = [\n  {\n    sender: \"0x9567D433240681653fb4DD3E05e08D60fe54210d\",\n    receiver: \"0x00f02f3a111D452C0DFbF576f09A4003b2F18284\",\n    timestamp: 1700351240,\n    message: \"testing\",\n  },\n  {\n    sender: \"0x00f02f3a111D452C0DFbF576f09A4003b2F18284\",\n    receiver: \"0x9567D433240681653fb4DD3E05e08D60fe54210d\",\n    timestamp: 1700351277,\n    message: \"testing2\",\n  },\n  {\n    sender: \"0x9567D433240681653fb4DD3E05e08D60fe54210d\",\n    receiver: \"0x00f02f3a111D452C0DFbF576f09A4003b2F18284\",\n    timestamp: 1700351289,\n    message: \"testing3\",\n  },\n  {\n    sender: \"0x00f02f3a111D452C0DFbF576f09A4003b2F18284\",\n    receiver: \"0x9567D433240681653fb4DD3E05e08D60fe54210d\",\n    timestamp: 1700354758,\n    message: \"hello fren\",\n  },\n];\n\nState.init({\n  tmess: [],\n});\n\nconst tmess2 = [];\n\nconst wEthContract = new ethers.Contract(\n  contractAddress,\n  abi.body.result,\n  Ethers.provider().getSigner()\n);\nwEthContract.readMessages(sender).then((transactionHash) => {\n  transactionHash.map(\n    (item, index) => (\n      //console.log('mensaje: '+ item[3])\n      tmess2.push([\"sender\", item[0]]),\n      tmess2.push([\"receiver\", item[1]]),\n      tmess2.push([\"timestamp\", item[2]]),\n      tmess2.push([\"message\", item[3]]),\n      //activities.push(['Study',2]);\n      //tmess[index][receiver].push(item[1])\n      //tmess[index][timestamp].push(item[2])\n      //tmess[index][message].push(item[3])\n      //State.update({ tmess: item[0] }) //este funciona\n      //State.update({ tmess: item[0] })\n      //State.update({ tmess[index][sender]: item[0] })\n      console.log(tmess2)\n      //State.update({ tmess: tmess2 })\n    )\n  );\n});\n\n//console.log('tmess '+state.tmess);\n\nconst handleSend = () => {\n  wEthContract\n    .sendMessage(\"0x00f02f3a111D452C0DFbF576f09A4003b2F18284\", state.text)\n    .then((transactionHash) => {\n      console.log(transactionHash);\n    });\n};\n\nconst updateText = (e) => {\n  State.update({ text: e.target.value });\n};\n\nconst getSender = () => {\n  return !state.sender\n    ? \"\"\n    : state.sender.substring(0, 6) +\n        \"...\" +\n        state.sender.substring(state.sender.length - 4, state.sender.length);\n};\n\nconst prettyAddress = (address) => {\n  const string =\n    address.substring(0, 2) +\n    \"...\" +\n    address.substring(address.length - 4, address.length);\n  return string;\n};\n\nconst hour = (unix_timestamp) => {\n  var date = new Date(unix_timestamp * 1000);\n  var hours = date.getHours();\n  var minutes = \"0\" + date.getMinutes();\n  var formattedTime = hours + \":\" + minutes.substr(-2);\n  return formattedTime;\n};\n\nreturn (\n  <Theme>\n    <div class=\"background-green\"></div>\n    <div class=\"main-container\">\n      <div class=\"left-container\">\n        <div class=\"header\">\n          <div class=\"nav-icons\">\n            {state.sender ? <li> {prettyAddress(state.sender)}</li> : \"\"}\n            <li>\n              <Web3Connect disconnectLabel=\"Disconnect\" />\n            </li>\n          </div>\n        </div>\n        <div class=\"search-container\">\n          <div class=\"input\">\n            <i class=\"fa-solid fa-magnifying-glass\"></i>\n            <input type=\"text\" placeholder=\"Search or start new chat   \" />\n          </div>\n          <i class=\"fa-sharp fa-solid fa-bars-filter\"></i>\n        </div>\n        <div class=\"chat-list\">\n          <div class=\"chat-box active\">\n            <div class=\"chat-details\">\n              <div class=\"text-head\">\n                <h4>\n                  {state.sender.toLowerCase() ===\n                  messages[0].sender.toLowerCase()\n                    ? prettyAddress(messages[0].receiver)\n                    : prettyAddress(messages[0].sender)}\n                </h4>\n                <p class=\"time\">07:49</p>\n              </div>\n              <div class=\"text-message\">\n                <p>{messages[messages.length - 1].message}</p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class=\"right-container\">\n        <div class=\"header\">\n          <div class=\"img-text\">\n            <h4>\n              {state.sender.toLowerCase() === messages[0].sender.toLowerCase()\n                ? prettyAddress(messages[0].receiver)\n                : prettyAddress(messages[0].sender)}\n              <br />\n              <span>Online</span>\n            </h4>\n          </div>\n          <div class=\"nav-icons\">\n            <li>\n              <i class=\"fa-solid fa-magnifying-glass\"></i>\n            </li>\n            <li>\n              <i class=\"fa-solid fa-ellipsis-vertical\"></i>\n            </li>\n          </div>\n        </div>\n        <div class=\"chat-container\">\n          {messages.map((item, index) => {\n            //console.log('sender '+sender.toLowerCase())\n            //console.log('item.sender '+item.sender.toLowerCase())\n            if (\n              state.sender.toLowerCase().toString() ==\n              item.sender.toLowerCase().toString()\n            ) {\n              return (\n                <div class=\"message-box my-message\">\n                  <p>\n                    {item.message}\n                    <br />\n                    <span>{hour(item.timestamp)}</span>\n                  </p>\n                </div>\n              );\n            } else if (state.sender.toString === item.receiver.toString) {\n              return (\n                <div class=\"message-box friend-message\">\n                  <p>\n                    {item.message}\n                    <br />\n                    <span>{hour(item.timestamp)}</span>\n                  </p>\n                </div>\n              );\n            }\n            return null;\n          })}\n        </div>\n        <div class=\"chatbox-input\" style={{ padding: \"10px\" }}>\n          <input\n            type=\"text\"\n            onChange={updateText}\n            placeholder=\"Type a message\"\n          />\n          <button onClick={handleSend}>Send</button>\n        </div>\n      </div>\n    </div>\n  </Theme>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/armsveshack.near/widget/ScrollMessenger", "fact_widget_deployments_id": "28a2ab706b4c72bce72354ab5927673e", "inserted_timestamp": "2023-11-19T07:29:22.198Z", "modified_timestamp": "2023-11-19T07:29:22.198Z", "__row_index": 1}