{"tx_hash": "3i2jqwYWroRTtrV4YTDtdRGvVB8XFCSMLKReK7fzq64g", "action_id_social": "D4AydQcgkxkRNUziJScT9Kq2p1MV3EU1WAASqizJvdty-0-widget", "block_id": 107483048, "block_timestamp": "2023-12-09T02:30:46.228Z", "signer_id": "hack.near", "widget_name": "every.tag", "source_code": "const accountId = props.accountId || context.accountId;\nif (!accountId) {\n  return \"Please connect your NEAR account :)\";\n}\n\nconst tag = props.tag ?? \"*\";\nconst creatorId = props.creatorId ?? \"*\";\nconst namespace = props.namespace ?? \"*\";\nconst thingId = props.thingId ?? \"*\";\n\nconst path = props.path || `*/*/*`;\n\nconst pattern = `*/graph/context/${creatorId}/${namespace}/${thingId}/tags/${tag}`;\nconst tagsObject = Social.get(pattern, \"final\");\n\nif (!tagsObject) {\n  return \"Loading...\";\n}\n\nState.init({\n  showEditor: false,\n  tags: tagsObject,\n});\n\nconst tagClass = \"bg-success\";\nconst badgeBtnClass = \"text-white btn p-0 lh-1 m-1\";\n\nconst tagsCount = {};\n\nconst processTagsObject = (obj) => {\n  Object.entries(obj).forEach((kv) => {\n    if (kv[1] === null) {\n      const tag = kv[0];\n      tagsCount[tag] = (tagsCount[tag] || 0) - 1;\n    } else if (typeof kv[1] === \"object\") {\n      processTagsObject(kv[1]);\n    } else {\n      const tag = kv[0];\n      tagsCount[tag] = (tagsCount[tag] || 0) + 1;\n    }\n  });\n};\n\nconst getTags = () => {\n  processTagsObject(tagsObject);\n  const tags = Object.entries(tagsCount);\n  tags.sort((a, b) => b[1] - a[1]);\n  return tags.map((t) => {\n    return {\n      name: t[0],\n      count: t[1],\n      title: t[1] + (t[1] > 1 ? \" times\" : \" time\"),\n    };\n  });\n};\n\nconst publicTags = getTags();\nconst data = Social.keys(\n  `*/graph/context/${creatorId}/${namespace}/${thingId}/tags/${tag}`,\n  \"final\"\n);\n\nconst pageUrl = props.url ?? \"/hack.near/widget/every.context\";\n\nreturn (\n  <>\n    {publicTags &&\n      publicTags.map((tag) => (\n        <a\n          href={`${pageUrl}/?tag=${tag.name}`}\n          className={badgeBtnClass}\n          key={tag.name}\n        >\n          <span\n            className={`badge ${tagClass} position-relative`}\n            title={tag.title}\n            style={\n              tag.count > 1\n                ? {\n                    marginRight: \"0.9em\",\n                    paddingRight: \"0.85em\",\n                  }\n                : { marginRight: \"0.25em\" }\n            }\n          >\n            #{tag.name}\n            {tag.count > 1 && (\n              <span\n                className={`badge translate-middle rounded-pill bg-danger position-absolute top-50 start-100`}\n              >\n                {tag.count}\n              </span>\n            )}\n          </span>\n        </a>\n      ))}{\" \"}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hack.near/widget/every.tag", "fact_widget_deployments_id": "81f58ed8422806e5077be524943bc6eb", "inserted_timestamp": "2023-12-09T04:24:07.089Z", "modified_timestamp": "2023-12-20T03:22:11.422Z", "__row_index": 6}