{"tx_hash": "F3QoeAmQ5zTX8D3onQaXDVYfanfDDAYikHkYR6hSiW9D", "action_id_social": "3hyTQYU6cCtwrnVumGGtuDqG3VzRxzuJUxYn8F7GD9wD-0-widget", "block_id": 100891360, "block_timestamp": "2023-09-11T15:00:20.697Z", "signer_id": "hack.near", "widget_name": "group.edit", "source_code": "const { handleClose } = props;\n\nconst creatorId = props.creatorId ?? context.accountId;\n\nif (!creatorId) {\n  return \"Please connect your NEAR account :)\";\n}\n\nconst groupId = props.groupId ?? \"f8ad9d1a76259lmdpjnd74e69162a0a014\";\n\nconst group =\n  props.group ?? Social.get(`*/thing/${groupId}/metadata/**`, \"final\");\n\nif (!group) {\n  return \"group not found\";\n}\n\nconst groupKey = Object.keys(group)[0];\n\nconst initMembers =\n  props.members ?? Social.get(`${groupKey}/graph/${groupId}/**`, \"final\");\n\nif (!initMembers) {\n  return \"group members not found\";\n}\n\nState.init({\n  group,\n  members: initMembers,\n  newMember: \"\",\n  isDao: false,\n});\n\nfunction addMember(newMember) {\n  State.update({\n    members: { ...state.members, [newMember]: \"\" },\n  });\n}\n\nfunction removeMember(memberKey) {\n  const updatedMembers = { ...state.members };\n  delete updatedMembers[memberKey];\n\n  State.update({\n    members: updatedMembers,\n  });\n}\n\nfunction isNearAddress(address) {\n  if (typeof address !== \"string\") {\n    return false;\n  }\n  if (!address.endsWith(\".near\")) {\n    return false;\n  }\n  const parts = address.split(\".\");\n  if (parts.length !== 2) {\n    return false;\n  }\n  if (parts[0].length < 2 || parts[0].length > 32) {\n    return false;\n  }\n  if (!/^[a-z0-9_-]+$/i.test(parts[0])) {\n    return false;\n  }\n  return true;\n}\n\nconst memberId = props.memberId ?? state.newMember;\n\nconst isValid = isNearAddress(memberId);\n\nconst handleSave = () => {\n  Social.set({\n    thing: {\n      [groupId]: {\n        \"\": JSON.stringify(state.group),\n        metadata: {\n          ...state.group,\n          type: {\n            group: {\n              src: \"every.near/type/group\",\n              blockHeight: \"final\",\n            },\n          },\n        },\n      },\n    },\n\n    graph: {\n      [groupId]: {\n        ...state.members,\n      },\n    },\n    index: {\n      thing: {\n        key: groupId,\n        value: {\n          type: \"group\",\n        },\n      },\n      every: {\n        key: \"group\",\n        value: {\n          id: groupId,\n        },\n      },\n      graph: JSON.stringify(\n        Object.keys(state.members).map((account) => ({\n          key: groupId,\n          value: {\n            type: \"add\",\n            accountId: account,\n          },\n        }))\n      ),\n      notify: JSON.stringify(\n        Object.keys(state.members).map((account) => ({\n          key: account,\n          value: {\n            type: \"add\",\n            message: \"added to group\",\n          },\n        }))\n      ),\n    },\n  });\n};\n\nreturn (\n  <>\n    {\" \"}\n    {group && (\n      <div className=\"row\">\n        <div className=\"col-lg-6\">\n          <h5 className=\"mb-3\">Details</h5>\n          <Widget\n            src=\"hack.near/widget/group.card\"\n            props={{ groupId, canJoin: false }}\n          />\n          <div className=\"mb-2 mt-3\">\n            <Widget\n              src=\"near/widget/MetadataEditor\"\n              props={{\n                initialMetadata: group,\n                onChange: (group) => State.update({ group }),\n                options: {\n                  name: {\n                    label: \"Name\",\n                    placeholder: `${group[groupKey].thing[groupId].metadata.name}`,\n                  },\n                  image: { label: \"Logo\" },\n                  description: { label: \"About\" },\n                  tags: {\n                    label: \"Tags\",\n                    tagsPattern: `*/${groupId}/tags/*`,\n                    placeholder: \"art, gov, edu, dev, com, nft, ai, social\",\n                  },\n                  linktree: {\n                    links: [\n                      {\n                        label: \"Twitter\",\n                        prefix: \"https://twitter.com/\",\n                        name: \"twitter\",\n                      },\n                      {\n                        label: \"Github\",\n                        prefix: \"https://github.com/\",\n                        name: \"github\",\n                      },\n                      {\n                        label: \"Telegram\",\n                        prefix: \"https://t.me/\",\n                        name: \"telegram\",\n                      },\n                      {\n                        label: \"Website\",\n                        prefix: \"https://\",\n                        name: \"website\",\n                      },\n                    ],\n                  },\n                },\n              }}\n            />\n          </div>\n        </div>\n        <div className=\"col-lg-6\">\n          <h5 className=\"mb-3\">Members</h5>\n          <div>\n            Account ID\n            <input\n              label=\"input each member's account ID here, then click `add` below\"\n              placeholder=\"<example>.near\"\n              onChange={(e) => State.update({ newMember: e.target.value })}\n            />\n            <div className=\"d-flex align-items-center mt-2\">\n              <button\n                className=\"btn btn-primary m-2\"\n                onClick={() => addMember(state.newMember)}\n              >\n                add\n              </button>\n              <button className=\"btn btn-success m-2\" onClick={handleSave}>\n                save\n              </button>\n            </div>\n          </div>\n          <div>\n            {Object.keys(state.members).map((a) => {\n              return (\n                <div className=\"d-flex m-2 p-2 justify-content-between align-items-center\">\n                  <div className=\"d-flex align-items-center\">\n                    <Widget\n                      src=\"mob.near/widget/Profile\"\n                      props={{ accountId: a }}\n                    />\n                  </div>\n                  <button\n                    className=\"btn btn-danger m-1\"\n                    onClick={() => removeMember(a)}\n                  >\n                    remove\n                  </button>\n                </div>\n              );\n            })}\n          </div>\n        </div>\n      </div>\n    )}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hack.near/widget/group.edit", "fact_widget_deployments_id": "1b506a2c6fcf27e150910f43823a1f28", "inserted_timestamp": "2023-09-11T16:49:37.833Z", "modified_timestamp": "2023-09-11T16:49:37.833Z", "__row_index": 1}