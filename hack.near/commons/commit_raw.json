{"tx_hash": "EwUJzmuLBWgY1fs6uPUxeMNMGAkzLvcgYT2HcQwNr4Ud", "action_id_social": "83uER3ogg6523Tp68tDrne6rCNomtXjLzf9qrJfAAVWa-0-widget", "block_id": 117843262, "block_timestamp": "2024-04-28T23:36:23.378Z", "signer_id": "hack.near", "widget_name": "commons", "source_code": "const accountId = props.accountId ?? context.accountId ?? \"every.near\";\n\nconst attestations = Social.keys(`*/graph/commons/*`, \"final\", {\n  values_only: true,\n});\n\nif (!attestations) {\n  return \"\";\n}\n\nconst [matrix, setMatrix] = useState([]);\nconst [attestors, setAttestors] = useState([]);\nconst [builders, setBuilders] = useState([]);\n\nuseEffect(() => {\n  const attestorSet = new Set();\n  const builderSet = new Set();\n\n  Object.entries(attestations).forEach(([attestor, data]) => {\n    attestorSet.add(attestor);\n    Object.keys(data.graph.commons).forEach((builder) => {\n      builderSet.add(builder);\n    });\n  });\n\n  setAttestors(Array.from(attestorSet));\n  setBuilders(Array.from(builderSet));\n\n  const newMatrix = Array.from(builderSet).map((builder) =>\n    Array.from(attestorSet).map((attestor) => ({\n      attestorId: attestor,\n      builderId: builder,\n    }))\n  );\n\n  setMatrix(newMatrix);\n}, []);\n\nreturn (\n  <div className=\"m-2 p-1\">\n    <div className=\"m-1\">\n      <Widget src=\"hack.near/widget/commons.add\" />\n    </div>\n    <table style={{ width: \"100%\" }}>\n      <thead>\n        <tr>\n          <th style={{ padding: \"8px\" }}>\n            {context.accountId && (\n              <Widget\n                src=\"hack.near/widget/commons.join\"\n                props={{\n                  accountId: \"*\",\n                  attestorId: accountId,\n                }}\n              />\n            )}\n          </th>\n          {attestors.map((attestor, index) => (\n            <th key={index} style={{ padding: \"8px\" }}>\n              {attestor}\n            </th>\n          ))}\n        </tr>\n      </thead>\n      <tbody>\n        {matrix.map((row, rowIndex) => (\n          <tr key={rowIndex}>\n            <td style={{ padding: \"8px\" }}>\n              <b>{builders[rowIndex]}</b>\n            </td>\n            {row.map((cell, cellIndex) => (\n              <td style={{ padding: \"8px\" }} key={cellIndex}>\n                {accountId !== cell.attestorId ? (\n                  <Widget\n                    src=\"hack.near/widget/BuilderBadge\"\n                    props={{\n                      accountId: cell.builderId,\n                      attestorId: cell.attestorId,\n                    }}\n                  />\n                ) : (\n                  <Widget\n                    src=\"hack.near/widget/attest\"\n                    props={{\n                      accountId: cell.builderId,\n                      attestorId: cell.attestorId,\n                    }}\n                  />\n                )}\n              </td>\n            ))}\n          </tr>\n        ))}\n      </tbody>\n    </table>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hack.near/widget/commons", "fact_widget_deployments_id": "ed24350de963e8bccd58365055240b98", "inserted_timestamp": "2024-04-29T01:59:33.769Z", "modified_timestamp": "2024-04-29T01:59:33.769Z", "__row_index": 13}