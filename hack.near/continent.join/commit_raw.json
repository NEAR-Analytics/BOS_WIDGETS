{"tx_hash": "4eF6VWWns74h7fN4iWEb6LhuWXhFJfLv9peDS4xN223F", "action_id_social": "4PuHP6CSgdgeQtZYDQ3d83sECegRyvV3oKU4eThM6Qdt-0-widget", "block_id": 96076262, "block_timestamp": "2023-07-09T14:55:29.398Z", "signer_id": "hack.near", "widget_name": "continent.join", "source_code": "const accountId = context.accountId;\nconst memberId = props.memberId ?? context.accountId;\nconst roleId = props.roleId ?? \"voter\";\nconst daoId = props.daoId ?? \"rc-dao.sputnik-dao.near\";\n\nif (!accountId) {\n  return \"\";\n}\n\nconst policy = Near.view(daoId, \"get_policy\");\n\nif (policy === null) {\n  return \"\";\n}\n\nconst deposit = policy.proposal_bond;\nconst group = policy.roles\n  .filter((role) => role.name === roleId)\n  .map((role) => role.kind.Group);\n\nState.init({\n  isMember: false,\n});\n\nconst proposals = Near.view(daoId, \"get_proposals\", {\n  from_index: 0,\n  limit: 888,\n});\n\nconst af_proposals = Near.view(\n  \"africa-community.sputnik-dao.near\",\n  \"get_proposals\",\n  { from_index: 0, limit: 888 }\n);\nconst as_proposals = Near.view(\"asia.sputnik-dao.near\", \"get_proposals\", {\n  from_index: 0,\n  limit: 888,\n});\nconst au_proposals = Near.view(\"australia.sputnik-dao.near\", \"get_proposals\", {\n  from_index: 0,\n  limit: 888,\n});\nconst eu_proposals = Near.view(\"europe.sputnik-dao.near\", \"get_proposals\", {\n  from_index: 0,\n  limit: 888,\n});\nconst na_proposals = Near.view(\n  \"north-america.sputnik-dao.near\",\n  \"get_proposals\",\n  { from_index: 0, limit: 888 }\n);\nconst sa_proposals = Near.view(\n  \"south-america.sputnik-dao.near\",\n  \"get_proposals\",\n  { from_index: 0, limit: 888 }\n);\n\nif (\n  proposals === null ||\n  af_proposals === null ||\n  as_proposals === null ||\n  au_proposals === null ||\n  eu_proposals === null ||\n  na_proposals === null ||\n  sa_proposals === null\n) {\n  return \"\";\n}\n\nconsole.log(proposals);\n\nconst checkProposals = (proposals) => {\n  for (let i = 0; i < proposals.length; i++) {\n    if (proposals[i].proposer === memberId) {\n      return false;\n    }\n  }\n  return true;\n};\n\nlet canJoin = checkProposals(proposals);\nlet canJoinContinent =\n  checkProposals(af_proposals) &&\n  checkProposals(as_proposals) &&\n  checkProposals(au_proposals) &&\n  checkProposals(eu_proposals) &&\n  checkProposals(na_proposals) &&\n  checkProposals(sa_proposals);\n\nconsole.log(canJoin);\nconsole.log(canJoinContinent);\n\nconst handleProposal = () => {\n  Near.call([\n    {\n      contractName: daoId,\n      methodName: \"add_proposal\",\n      args: {\n        proposal: {\n          description: \"add member to DAO\",\n          kind: {\n            AddMemberToRole: {\n              member_id: memberId,\n              role: roleId,\n            },\n          },\n        },\n      },\n      gas: 300000000000000,\n      deposit: deposit,\n    },\n  ]);\n};\n\nconst groupMembers = group.join(\", \");\n\nconst checkMembership = (groupMembers) => {\n  if (groupMembers.indexOf(memberId) !== -1) {\n    return State.update({ isMember: true });\n  }\n};\n\nconst validMember = checkMembership(groupMembers);\n\n// IAH Verification\nlet human = false;\nconst userSBTs = Near.view(\"registry.i-am-human.near\", \"sbt_tokens_by_owner\", {\n  account: memberId,\n});\n\nfor (let i = 0; i < userSBTs.length; i++) {\n  if (\"fractal.i-am-human.near\" == userSBTs[i][0]) {\n    human = true;\n  }\n}\n\nconst ButtonContainer = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px;\n  justify-content: center;\n  margin-top: 20px;\n  max-width: 555px;\n`;\n\nreturn (\n  <div>\n    <ButtonContainer>\n      {!validMember && canJoin && (\n        <button\n          disabled={!human}\n          className=\"btn btn-success m-1\"\n          onClick={handleProposal}\n        >\n          Join DAO\n        </button>\n      )}\n      {!validMember && !canJoin && (\n        <button disabled={!canJoin} className=\"btn btn-success m-1\">\n          Pending\n        </button>\n      )}\n      {validMember && !canJoin && (\n        <button disabled={validMember} className=\"btn btn-success m-1\">\n          Joined\n        </button>\n      )}\n      <a\n        className=\"btn btn-outline-success m-1\"\n        href=\"#/hack.near/widget/verified.members\"\n      >\n        Members\n      </a>\n    </ButtonContainer>\n    {!canJoinContinent && (\n      <ButtonContainer>\n        <h5 className=\"text-muted\">Continental Group Selected</h5>\n      </ButtonContainer>\n    )}\n    {validMember && canJoinContinent && (\n      <ButtonContainer>\n        <h5>Select Your Home Continent:</h5>\n        <div style={{ display: \"flex\", justifyContent: \"center\" }}>\n          <Widget\n            src=\"hack.near/widget/communities.regional\"\n            props={{\n              daoId: \"africa-community.sputnik-dao.near\",\n              name: \"Africa\",\n              memberId: accountId,\n              roleId,\n            }}\n          />\n          <Widget\n            src=\"hack.near/widget/communities.regional\"\n            props={{\n              daoId: \"asia.sputnik-dao.near\",\n              name: \"Asia\",\n              memberId: accountId,\n              roleId,\n            }}\n          />\n          <Widget\n            src=\"hack.near/widget/communities.regional\"\n            props={{\n              daoId: \"australia.sputnik-dao.near\",\n              name: \"Australia\",\n              memberId: accountId,\n              roleId,\n            }}\n          />\n          <Widget\n            src=\"hack.near/widget/communities.regional\"\n            props={{\n              daoId: \"europe.sputnik-dao.near\",\n              name: \"Europe\",\n              memberId: accountId,\n              roleId,\n            }}\n          />\n        </div>\n        <div style={{ display: \"flex\", justifyContent: \"center\" }}>\n          <Widget\n            src=\"hack.near/widget/communities.regional\"\n            props={{\n              daoId: \"north-america.sputnik-dao.near\",\n              name: \"North America\",\n              memberId: accountId,\n              roleId,\n            }}\n          />\n          <Widget\n            src=\"hack.near/widget/communities.regional\"\n            props={{\n              daoId: \"south-america.sputnik-dao.near\",\n              name: \"South America\",\n              memberId: accountId,\n              roleId,\n            }}\n          />\n        </div>\n      </ButtonContainer>\n    )}\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hack.near/widget/continent.join", "fact_widget_deployments_id": "cb1163178c1057a54418941877be1cfa", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}