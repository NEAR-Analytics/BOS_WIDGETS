{"tx_hash": "Hvtj9gkRHXcSkcpC3hq79WXfZBKFrhxtb5USYK36Y1NN", "action_id_social": "BVArtD1FDA9Yh9SGy24GELPSGaaHDcGiLCtHFUoEZgM5-0-widget", "block_id": 95697883, "block_timestamp": "2023-07-04T17:15:11.925Z", "signer_id": "hack.near", "widget_name": "all.stars", "source_code": "const accountId = props.accountId ?? \"hack.near\";\nconst data = Social.keys(\"*/index/star\", \"final\");\n\nconsole.log(\"Data:\", data);\n\nif (!data) {\n  return \"Loading...\";\n}\n\nconst parsedData = JSON.parse(data);\nconst accounts = Object.entries(parsedData || {});\n\nconst allStars = Social.get(`${accountId}/index/star`);\nconsole.log(\"All Stars:\", allStars);\n\nlet starredWidgets;\ntry {\n  starredWidgets = JSON.parse(allStars);\n} catch (error) {\n  console.error(\"PARSING ERROR\", error);\n  starredWidgets = [];\n}\n\nconsole.log(\"Stars:\", starredWidgets);\n\nconst allStarred = {};\n\nfor (let i = 0; i < accounts.length; ++i) {\n  const accountId = accounts[i][0];\n  const userStars = Social.get(`${accountId}/index/star`, \"final\");\n\n  console.log(`Fetching stars for accountId: ${accountId}`);\n  console.log(\"User Stars:\", userStars);\n\n  if (!userStars) {\n    console.error(`No stars found for accountId: ${accountId}`);\n    continue; // Skip this iteration if no stars were found for this account\n  }\n\n  for (let userStar of userStars) {\n    if (starredWidgets.includes(userStar[0])) {\n      if (allStarred.hasOwnProperty(userStar[0])) {\n        allStarred[userStar[0]].stars++;\n      } else {\n        allStarred[userStar[0]] = {\n          accountId: accountId,\n          name: userStar[0],\n          stars: 1,\n        };\n      }\n    }\n  }\n}\n\nconst sortedStarred = Object.values(allStarred).sort(\n  (a, b) => b.stars - a.stars\n);\nconsole.log(\"All Starred:\", sortedStarred);\n\nreturn (\n  <div>\n    {sortedStarred.map((widget, index) => (\n      <div key={index}>\n        <div>Widget: {widget.name}</div>\n        <div>Total Stars: {widget.stars}</div>\n      </div>\n    ))}\n  </div>\n);\n", "metadata": null, "branch": {"draft": null}, "widget_modules_used": null, "widget_url": "https://near.social/#/hack.near/widget/all.stars", "fact_widget_deployments_id": "4cd4f3ba17279483b282bc020f4d9b86", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}