{"tx_hash": "95tHzyebueSXZx4jBpvM1N7GkUdU3a2wmXq8ojBdyhtj", "action_id_social": "7ooMSaYDxJaYugNhciGNcCKR9FpkTg8i1Zsc9B1A4UzN-0-widget", "block_id": 100888646, "block_timestamp": "2023-09-11T14:06:59.079Z", "signer_id": "hack.near", "widget_name": "group.join", "source_code": "const accountId = props.accountId ?? \"james.near\";\nconst groupId = props.groupId ?? \"f8ad9d1a76259lmdpjnd74e69162a0a014\";\nconst creatorId = props.creatorId ?? \"hack.near\";\n\nif (!props.accountId && !context.accountId) {\n  return \"\";\n}\n\nconst joinEdge = Social.keys(\n  `${context.accountId}/graph/${groupId}/${context.accountId}`,\n  undefined,\n  {\n    values_only: true,\n  }\n);\n\nconst memberEdge = Social.keys(\n  `${creatorId}/graph/${groupId}/${context.accountId}`,\n  undefined,\n  {\n    values_only: true,\n  }\n);\n\nconst loading = joinEdge === null || memberEdge === null;\nconst join = joinEdge && Object.keys(joinEdge).length;\nconst inverse = memberEdge && Object.keys(memberEdge).length;\n\nconst type = join ? \"leave\" : \"join\";\n\nconst handleJoin = () => {\n  Social.set({\n    graph: { [groupId]: { [accountId]: \"\" } },\n    index: {\n      graph: JSON.stringify({\n        key: groupId,\n        value: {\n          type,\n          accountId,\n        },\n      }),\n      notify: JSON.stringify([\n        {\n          key: creatorId,\n          value: {\n            type,\n            accountId,\n            message: \"requested to join\",\n          },\n        },\n        {\n          key: accountId,\n          value: {\n            type,\n            groupId,\n            message: \"request submitted\",\n          },\n        },\n      ]),\n    },\n  });\n};\n\nreturn (\n  <>\n    <button\n      disabled={loading}\n      className={`btn ${loading || join ? \"btn-outline-dark\" : \"btn-primary\"}`}\n      onClick={handleJoin}\n    >\n      {loading ? \"loading\" : join ? \"joined\" : inverse ? \"accept\" : \"join\"}\n    </button>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hack.near/widget/group.join", "fact_widget_deployments_id": "ad346bf5df0d4793a73d5ae0acfd8858", "inserted_timestamp": "2023-09-11T16:17:48.204Z", "modified_timestamp": "2023-09-11T16:17:48.204Z", "__row_index": 1}