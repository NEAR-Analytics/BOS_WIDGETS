{"tx_hash": "ExvoEB4dV2fqohdhrAbsdXNiSShxhxD24p793PXM6Ufg", "action_id_social": "5fjf6cKXDhhQbyGP5Tag1QDBMoKsd1zPzFWNfAQgkH8J-0-widget", "block_id": 114839015, "block_timestamp": "2024-03-16T17:31:54.941Z", "signer_id": "hack.near", "widget_name": "Agreement", "source_code": "const ownerId = \"hack.near\";\n\nState.init({\n  signature: true,\n  isFetched: false,\n  agreement: true,\n  showModal: false,\n});\n\nif (context.accountId && !state.isFetched) {\n  Near.asyncView(\n    \"social.near\",\n    \"get\",\n    {\n      keys: [\n        `${context.accountId}/profile/builder`,\n        `${context.accountId}/index/agreement`,\n      ],\n    },\n    \"final\",\n    false\n  ).then((data) =>\n    State.update({\n      signature: data[context.accountId]?.profile?.builder === \"true\",\n      agreement:\n        data[context.accountId]?.index?.agreement &&\n        data[context.accountId]?.index?.agreement.length > 0,\n      isFetched: true,\n    })\n  );\n}\n\nconst handleAccept = () => {\n  State.update({ showModal: true });\n};\n\nconst showAgreement = !state.signature && !state.agreement;\n\nconst AcceptButton = styled(\"Tooltip.Trigger\")`\n  a {\n    font-size: 0.9em;\n    font-style: normal;\n    font-weight: 400;\n    line-height: 1em;\n    color: #000000;\n    text-decoration: none;\n\n    &:hover,\n    &:visited {\n      color: #000000;\n      text-decoration: none;\n    }\n  }\n\n  color: #000;\n  position: fixed;\n  bottom: 0;\n  right: 0;\n  padding: 0.5em 0.5em;\n  margin: 2em;\n  background: #00ec97;\n  border-radius: 18px;\n  border: none;\n  box-shadow:\n    hsl(206 22% 7% / 35%) 0px 10px 38px -10px,\n    hsl(206 22% 7% / 20%) 0px 10px 20px -15px;\n  z-index: 10;\n`;\n\nconst daoId = props.daoId ?? \"build.sputnik-dao.near\";\nconst policy = Near.view(daoId, \"get_policy\");\n\nif (!policy) {\n  return \"\";\n}\n\nconst groupId = props.groupId ?? \"community\";\n\nconst groups = policy.roles\n  .filter((role) => role.name === groupId)\n  .map((role) => {\n    const group = role.kind.Group;\n\n    return group;\n  });\n\nconst communityMember = groups.map((group) => {\n  return !group\n    ? false\n    : group.filter((address) => address === context.accountId).length > 0;\n})?.[0];\n\nreturn (\n  <>\n    {communityMember && (\n      <Tooltip.Provider>\n        <Tooltip.Root>\n          <AcceptButton>\n            <button className=\"btn btn-white\" onClick={handleAccept}>\n              <b>Accept</b> <i class=\"bi bi-check\"></i>\n            </button>\n          </AcceptButton>\n        </Tooltip.Root>\n      </Tooltip.Provider>\n    )}\n    {state.showModal && (\n      <Widget\n        src={`${ownerId}/widget/AgreementModal`}\n        props={{\n          open: true,\n          accept: () =>\n            Social.set(\n              { profile: { builder: true } },\n              {\n                onCommit: () => {\n                  State.update({ signature: true, showModal: false });\n                },\n              }\n            ),\n        }}\n      />\n    )}\n    <Widget src={`${ownerId}/widget/AgreementPage`} />\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hack.near/widget/Agreement", "fact_widget_deployments_id": "ac73bffbc03fa5766021add49b77e314", "inserted_timestamp": "2024-03-16T18:26:48.390Z", "modified_timestamp": "2024-03-16T19:24:19.393Z", "__row_index": 2}