{"tx_hash": "AwS8SwnmY1niP82n5uPBCmAh5A7ukXHWjo2NNHMtMDcP", "action_id_social": "ta6rWLqwWjLXgGmMh3Qnn21uHPpiN5ZzsxJ8NUnZd2N-0-widget", "block_id": 104147604, "block_timestamp": "2023-10-25T03:06:55.619Z", "signer_id": "hack.near", "widget_name": "Favorites", "source_code": "// adapted from these widgets by mob.near\n//\n// - `StarredApps`\n// - `WidgetMetadata`\n// - `StarButton`\n\nconst accountId = props.accountId ?? context.accountId;\n\nconst votes = Social.getr(`${accountId}/graph/vote`, \"final\", {\n  withBlockHeight: true,\n});\n\nconst StorageKey = \"order\";\nconst order = Storage.privateGet(StorageKey);\nconst apps = useMemo(() => {\n  if (votes === null || order === null) {\n    return [];\n  }\n  const upvotedApps = new Map();\n  const path = [];\n\n  const buildSrc = (node) => {\n    if (node.hasOwnProperty(\"\")) {\n      upvotedApps.set(path.join(\"/\"), node[\":block\"]);\n    }\n    Object.entries(node).forEach(([key, value]) => {\n      if (typeof value === \"object\") {\n        path.push(key);\n        buildSrc(value);\n        path.pop();\n      }\n    });\n  };\n\n  buildSrc(votes ?? {}, [], upvotedApps);\n  let apps = [...upvotedApps.entries()];\n  apps.sort((a, b) => b[1] - a[1]);\n  apps = apps.map((a) => a[0]);\n  apps.sort((a, b) => (order?.[a] || 0) - (order?.[b] || 0));\n  Storage.privateSet(\n    StorageKey,\n    Object.fromEntries(apps.map((a, i) => [a, i + 1]))\n  );\n  return apps;\n}, [votes, order]);\n\nconst renderItem = (src) => {\n  const [accountId, _, name] = src.split(\"/\");\n  return (\n    <Widget\n      src=\"hack.near/widget/WidgetCard\"\n      props={{\n        tooltip: true,\n        accountId,\n        widgetName: name,\n        widgetSrc: src,\n      }}\n    />\n  );\n};\n\nreturn apps.length > 0 ? (\n  <>{apps.slice(0, props.limit ? parseInt(props.limit) : 10).map(renderItem)}</>\n) : (\n  \"\"\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hack.near/widget/Favorites", "fact_widget_deployments_id": "3b7c5cf7d8ddcdc0cfd33cc9d8fca840", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}