{"tx_hash": "GxJHpaU8KNaSw9kke15vtQuXm2gXbKg75JzveqMiRXXr", "action_id_social": "DWi6ytqJt6HtoqK3FrGCp9WDLVHcmHH21wo7CfxmB1YA-0-widget", "block_id": 114906358, "block_timestamp": "2024-03-17T18:45:15.380Z", "signer_id": "hack.near", "widget_name": "city.form", "source_code": "const creatorId = props.creatorId ?? \"hack.near\";\nconst appId = props.appId ?? \"city.app\";\nconst citiesPattern = props.citiesPattern ?? \"*/profile/cities/*\";\n\nconst [cities, setCities] = useState({});\nconst [allCities, setAllCities] = useState([]);\n\nconst getCities = (citiesObject) => {\n  let citiesCount = {};\n  processCitiesObject(citiesObject, citiesCount);\n  return Object.entries(citiesCount)\n    .sort((a, b) => b[1] - a[1])\n    .map(([name, count]) => ({ name, count }));\n};\n\nconst normalizeCity = (city) =>\n  city\n    .replaceAll(/[- \\.]/g, \"_\")\n    .replaceAll(/[^\\w]+/g, \"\")\n    .replaceAll(/_+/g, \"-\")\n    .replace(/^-+/, \"\")\n    .replace(/-+$/, \"\")\n    .toLowerCase()\n    .trim(\"-\");\n\nconst citiesCount = {};\n\nconst processCitiesObject = (obj) => {\n  Object.entries(obj).forEach((kv) => {\n    if (typeof kv[1] === \"object\") {\n      processCitiesObject(kv[1]);\n    } else {\n      const city = normalizeCity(kv[0]);\n      citiesCount[city] = (citiesCount[city] || 0) + 1;\n    }\n  });\n};\n\nconst handleCitySelection = (selected) => {\n  const updatedCities = selected\n    .map((city) => ({\n      [normalizeCity(city.name)]: \"\",\n    }))\n    .reduce((acc, city) => ({ ...acc, ...city }), {});\n\n  setCities(updatedCities);\n};\n\nuseEffect(() => {\n  const citiesObject = Social.keys(citiesPattern, \"final\");\n  if (citiesObject) {\n    const processedCities = getCities(citiesObject);\n    setAllCities(processedCities);\n  }\n}, [citiesPattern]);\n\nconst composeData = () => {\n  const data = {\n    profile: {\n      cities: cities,\n    },\n  };\n  return data;\n};\n\nconst Footer = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: space-between;\n  width: 100%;\n  padding: 23px;\n`;\n\nreturn (\n  <>\n    <div className=\"m-2\">\n      <div className=\"m-2\">\n        <h3 className=\"m-2 mb-3\">Let's build!</h3>\n        <div className=\"m-2\">\n          <h5>Add Your City / Cities</h5>\n          <Typeahead\n            id={`city-selector-${Date.now()}`}\n            multiple\n            labelKey=\"name\"\n            onChange={handleCitySelection}\n            options={allCities}\n            placeholder={placeholder}\n            selected={Object.keys(cities).map((name) => ({ name }))}\n            positionFixed\n            allowNew\n          />\n        </div>\n      </div>\n    </div>\n    <Footer>\n      <a\n        className=\"m-2 btn btn-secondary\"\n        href={`/${creatorId}/widget/${appId}`}\n      >\n        Exit\n      </a>\n      <CommitButton force data={composeData()}>\n        Save\n      </CommitButton>\n    </Footer>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hack.near/widget/city.form", "fact_widget_deployments_id": "5fb7d999a256795a63fdb794a6d3cf9a", "inserted_timestamp": "2024-03-17T20:25:16.955Z", "modified_timestamp": "2024-03-17T20:25:16.955Z", "__row_index": 0}