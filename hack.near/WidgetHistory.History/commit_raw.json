{"tx_hash": "GJ3SK9uU3iCd3n5VVRnk37Nm6igWSw4316miZVtWykJa", "action_id_social": "2UMnqHBuPN8ofWuNasRDARRqnjhUbKeCR9jXAu2ZUQRD-0-widget", "block_id": 118786800, "block_timestamp": "2024-05-12T18:04:58.835Z", "signer_id": "hack.near", "widget_name": "WidgetHistory.History", "source_code": "/*\r\n---props---\r\n\r\nwidgetPath: string,\r\ncount(count: number)?: function,\r\n\r\n*/\r\n\r\nif (typeof props.widgetPath !== \"string\")\r\n  return \"send {widgetPath} as string in props\";\r\n\r\nState.init({\r\n  selectedTab: \"render\",\r\n  selectedBlockHeight: null,\r\n});\r\n\r\nconst historyBlocksRequest = Social.keys(`${props.widgetPath}`, \"final\", {\r\n  return_type: \"History\",\r\n});\r\n\r\nif (historyBlocksRequest === null) return \"loading...\";\r\n\r\nconst [widgetAccountId, _, widgetName] = props.widgetPath.split(\"/\");\r\n\r\nlet blocksChanges =\r\n  historyBlocksRequest[widgetAccountId]?.[\"widget\"]?.[widgetName];\r\n\r\nif (props.count) props.count(blocksChanges.length);\r\n\r\nif (blocksChanges) blocksChanges = blocksChanges?.sort((a, b) => b - a);\r\n\r\nif (!state.selectedBlockHeight) state.selectedBlockHeight = blocksChanges[0];\r\n\r\nfunction getDatastringFromBlockHeight(blockHeight) {\r\n  const block = Near.block(blockHeight);\r\n  const date = new Date(block.header.timestamp_nanosec / 1e6);\r\n  return date.toDateString() + \" \" + date.toLocaleTimeString();\r\n}\r\n\r\nconst renderBlockChangesLink = (blockHeight) => {\r\n  return (\r\n    <div>\r\n      <button\r\n        className={`list-group-item list-group-item-action ${\r\n          state.selectedBlockHeight != blockHeight ? \"\" : \"list-group-item-info\"\r\n        }`}\r\n        onClick={() => {\r\n          State.update({ selectedBlockHeight: blockHeight });\r\n        }}\r\n      >\r\n        #{blockHeight} * {getDatastringFromBlockHeight(blockHeight)}\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nfunction blockHeightToWidgetCode(blockHeight) {\r\n  const index = blocksChanges.findIndex((el) => el == blockHeight);\r\n  return (\r\n    <div class=\"mb-3\">\r\n      <Widget\r\n        key={blockHeight}\r\n        src={`bozon.near/widget/WidgetHistory.CodeHistoryCard`}\r\n        props={{\r\n          pathToWidget: props.widgetPath,\r\n          currentBlockHeight: blockHeight,\r\n          prevBlockHeight: blocksChanges[index + 1],\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction blockHeightToWidgetRender(blockHeight) {\r\n  const index = blocksChanges.findIndex((el) => el == blockHeight);\r\n  return (\r\n    <Widget\r\n      style={{ minHeight: \"200px\" }}\r\n      key={blockHeight}\r\n      src={`bozon.near/widget/WidgetHistory.RenderCode`}\r\n      props={{\r\n        pathToWidget: props.widgetPath,\r\n        currentBlockHeight: blockHeight,\r\n        prevBlockHeight: blocksChanges[index + 1],\r\n      }}\r\n    />\r\n  );\r\n}\r\n\r\n//styles forked from calebjacob.near/widget/Activity\r\nconst Tabs = styled.div`\r\n  display: flex;\r\n  padding: 0 12px;\r\n  height: 48px;\r\n  border-bottom: 1px solid #ECEEF0;\r\n`;\r\n\r\nconst TabsButton = styled.button`\r\n  font-weight: 400;\r\n  font-size: 14px;\r\n  line-height: 17px;\r\n  padding: 0 12px;\r\n  position: relative;\r\n  color: ${(p) => (p.selected ? \"#11181C\" : \"#687076\")};\r\n  background: none;\r\n  border: none;\r\n  outline: none;\r\n\r\n  &:hover {\r\n    color: #11181C;\r\n  }\r\n\r\n  &::after {\r\n    content: '';\r\n    display: ${(p) => (p.selected ? \"block\" : \"none\")};\r\n    position: absolute;\r\n    bottom: 0;\r\n    left: 12px;\r\n    right: 12px;\r\n    height: 3px;\r\n    background: #0091FF;\r\n  }\r\n`;\r\n\r\nreturn (\r\n  <div>\r\n    {!blocksChanges ? (\r\n      <div>incorrent widget path</div>\r\n    ) : (\r\n      <div>\r\n        <Tabs>\r\n          <TabsButton\r\n            type=\"button\"\r\n            onClick={() =>\r\n              State.update({\r\n                selectedTab: \"code\",\r\n              })\r\n            }\r\n            selected={state.selectedTab == \"code\"}\r\n          >\r\n            Code\r\n          </TabsButton>\r\n\r\n          <TabsButton\r\n            type=\"button\"\r\n            onClick={() =>\r\n              State.update({\r\n                selectedTab: \"render\",\r\n              })\r\n            }\r\n            selected={state.selectedTab == \"render\"}\r\n          >\r\n            Render\r\n          </TabsButton>\r\n        </Tabs>\r\n\r\n        {state.selectedTab == \"code\" && (\r\n          <div>{blockHeightToWidgetCode(state.selectedBlockHeight)}</div>\r\n        )}\r\n\r\n        {state.selectedTab == \"render\" && (\r\n          <div>{blockHeightToWidgetRender(state.selectedBlockHeight)}</div>\r\n        )}\r\n      </div>\r\n    )}\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hack.near/widget/WidgetHistory.History", "fact_widget_deployments_id": "77aaf8d4b400b9d69cbb3ea24f5a4771", "inserted_timestamp": "2024-05-12T19:39:39.317Z", "modified_timestamp": "2024-05-12T19:39:39.317Z", "__row_index": 4}