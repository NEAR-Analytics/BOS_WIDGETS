{"tx_hash": "8mPgxeXXPrjiD7SN4SjjkB9FKxemaTztSpYdDjieFq4D", "action_id_social": "GiFXZpnQNNcRYDXXXhpSJyXHi2A64s75xth7aKSsMoQG-0-widget", "block_id": 106682157, "block_timestamp": "2023-11-27T20:50:56.264Z", "signer_id": "hack.near", "widget_name": "AttestButton", "source_code": "const item = props.item;\n\nif (!item) {\n  return \"\";\n}\n\nuseEffect(() => {\n  State.update({ attested: null });\n}, [item]);\n\nconst attestations = Social.index(\"attestation\", item);\n\nconst dataLoading = attestations === null;\n\nconst attestationsByUsers = {};\n\n(attestations || []).forEach((attestation) => {\n  if (attestation.value.type === \"attestation\") {\n    attestationsByUsers[attestation.accountId] = attestation;\n  } else if (attestation.value.type === \"undo\") {\n    delete attestationsByUsers[attestation.accountId];\n  }\n});\n\nif (state.attested === true) {\n  attestationsByUsers[context.accountId] = {\n    accountId: context.accountId,\n  };\n} else if (state.attested === false) {\n  delete attestationsByUsers[context.accountId];\n}\n\nconst accountsWithStars = Object.keys(attestationsByUsers);\nconst attestationCount = accountsWithStars.length;\nconst attested = context.accountId && !!attestationsByUsers[context.accountId];\n\nconst attestClick = () => {\n  if (state.loading || dataLoading || !context.accountId) {\n    return;\n  }\n  State.update({\n    loading: true,\n  });\n  const data = {\n    index: {\n      attestation: JSON.stringify({\n        key: item,\n        value: {\n          type: attested ? \"undo\" : \"attest\",\n        },\n      }),\n    },\n  };\n\n  if (!hasLike && props.notifyAccountId) {\n    data.index.notify = JSON.stringify({\n      key: props.notifyAccountId,\n      value: {\n        type: \"attest\",\n        item,\n      },\n    });\n  }\n  Social.set(data, {\n    onCommit: () => State.update({ loading: false, attested: !attested }),\n    onCancel: () => State.update({ loading: false }),\n  });\n};\n\nconst [hovered, setHovered] = useState(false);\n\nreturn (\n  <div className=\"d-inline-flex align-items-center\">\n    <button\n      disabled={state.loading || dataLoading || !context.accountId}\n      className=\"btn btn-outline-secondary\"\n      onClick={attestClick}\n      onMouseEnter={() => setHovered(true)}\n      onMouseLeave={() => setHovered(false)}\n    >\n      <i\n        className={`bi ${\n          hovered && !attested ? \"bi-check-square-fill\" : \"bi-square\"\n        }`}\n      />\n      <span style={{ marginLeft: \"0.2rem\" }}>\n        {attested ? \"undo\" : \"attest\"}\n      </span>\n    </button>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hack.near/widget/AttestButton", "fact_widget_deployments_id": "6a85aa2dc845c5e3ef3dae24921b6250", "inserted_timestamp": "2023-11-27T22:43:17.258Z", "modified_timestamp": "2023-11-27T22:43:17.258Z", "__row_index": 1}