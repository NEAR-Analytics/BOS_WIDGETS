{"tx_hash": "9MS39wshGR8cEWXBgoXN6jPNGgx82AEYpUHJo595fcXm", "action_id_social": "12UMzJrQ3i99TZfcTQ1cXgSCJyQsudk8ZWGxH8ZYAVc4-0-widget", "block_id": 99193558, "block_timestamp": "2023-08-19T21:32:24.505Z", "signer_id": "hack.near", "widget_name": "NDC.WG.Create", "source_code": "State.init({\n  elements: {},\n  inputVal: \"\",\n});\n\nfunction addElement(newElement) {\n  State.update({\n    elements: { ...state.elements, [newElement]: \"\" },\n  });\n}\n\nfunction removeElement(elementKey) {\n  const updatedElements = { ...state.elements };\n  delete updatedElements[elementKey];\n\n  State.update({\n    elements: updatedElements,\n  });\n}\n\nconst daoId = props.daoId ?? \"build.sputnik-dao.near\";\n\nconst policy = Near.view(daoId, \"get_policy\");\n\nif (policy === null) {\n  return \"Loading...\";\n}\n\nconst deposit = policy.proposal_bond;\n\nfunction generateUID() {\n  return (\n    Math.random().toString(16).slice(2) +\n    Date.now().toString(36) +\n    Math.random().toString(16).slice(2)\n  );\n}\n\nconst groupId = props.groupId ?? generateUID();\n\nconst group_args = JSON.stringify({\n  data: {\n    [daoId]: {\n      graph: {\n        [groupId]: state.elements,\n      },\n      index: {\n        post: JSON.stringify({\n          key: \"group\",\n          value: {\n            type: \"work\",\n          },\n        }),\n      },\n    },\n  },\n});\n\nconst proposal_args = Buffer.from(group_args, \"utf-8\").toString(\"base64\");\n\nconst handleProposal = () => {\n  Near.call([\n    {\n      contractName: daoId,\n      methodName: \"add_proposal\",\n      args: {\n        proposal: {\n          description: \"create DAO group on NEAR Social\",\n          kind: {\n            FunctionCall: {\n              receiver_id: \"social.near\",\n              actions: [\n                {\n                  method_name: \"set\",\n                  args: proposal_args,\n                  deposit: \"100000000000000000000000\",\n                  gas: \"219000000000000\",\n                },\n              ],\n            },\n          },\n        },\n      },\n      deposit: deposit,\n      gas: \"219000000000000\",\n    },\n  ]);\n};\n\nconst { handleClose } = props;\n\nlet SocialContract = \"social.near\";\n\nconst widgets = {\n  styledComponents: \"nomination.ndctools.near/widget/NDC.StyledComponents\",\n};\n\nState.init({\n  groupImage: {\n    uploading: \"false\",\n    url: RealProfileImageAsURL,\n    name: RealProfileImageAsURL ? \"Uploaded from NEAR Social Profile\" : \"\",\n  },\n  groupName: groupInfo.name ? groupInfo.name : \"\",\n  groupAccount: props.groupAccount ? \"@\" + context.accountId : \"\",\n  agreement: \"false\",\n  error_msg: \"\",\n});\n\nconst CardStyled = styled.div`\n  width: 100%;\n  height: 100%;\n  background: #f8f8f9;\n  gap: 10px;\n  padding: 25px;\n  margin: 0 auto;\n  border-radius: 10px;\n  overflow-y: scroll;\n`;\n\nconst CardForm = styled.div`\n  display: flex;\n  flex-direction: column;\n  width: 100%;\n  height: auto;\n`;\n\nconst H1 = styled.h1`\n  margin-bottom: 10px;\n  font-style: normal;\n  font-weight: 500;\n  font-size: 16px;\n`;\n\nconst Submitcontainer = styled.div`\n  display: flex;\n  justify-content: flex-end;\n  align-items: center;\n  gap: 8px;\n  margin-bottom: 16px;\n  @media only screen and (max-width: 480px) {\n    margin-top: 10px;\n  }\n`;\n\nconst HiddeableWidget = styled.div`\n  display: none;\n  @media (max-width: 480px) {\n    display: block;\n  }\n`;\n\nconst Modal = styled.div`\n  position: fixed;\n  z-index: 1;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  background: rgba(0, 0, 0, 0.7);\n`;\n\nconst ComponentWrapper = styled.div`\n  display: flex;\n  width: 80%;\n  height: 80%;\n  flex-direction: column;\n  align-items: flex-start;\n  border-radius: 10px;\n  background: #fff;\n  border: 1px solid transparent;\n  margin: 140px auto auto auto;\n  @media only screen and (max-width: 480px) {\n    width: 90%;\n  }\n`;\n\nconst ErrorBlock = styled.div`\n  color: #c23f38;\n  font-size: 14px;\n  margin: 10px 0;\n`;\n\nconst Hr = styled.div`\n  height: 1px;\n  margin: 15px 0;\n  width: 100%;\n  background: rgba(208, 214, 217, 0.4);\n`;\n\nconst Section = styled.div`\n  margin: 12px 0;\n`;\n\nconst validatedInputs = () => {\n  const { img, groupAccount, groupName, members, agreement } = state;\n\n  const isEmpty = (str) => str.trim() === \"\";\n  const isFalse = (check) => check === \"false\";\n  let isValid = true;\n  let error_msg;\n\n  if (img.cid === null) isValid = false;\n  if (isEmpty(groupAccount)) isValid = false;\n  if (isEmpty(groupName)) isValid = false;\n  if (isEmpty(members)) isValid = false;\n  if (isFalse(agreement)) isValid = false;\n  else {\n    isValid = false;\n  }\n\n  State.update({\n    error_msg: isValid\n      ? null\n      : error_msg || \"* Please complete all required fields.\",\n  });\n\n  return isValid;\n};\n\nconst uploadFileUpdateState = (body) => {\n  asyncFetch(\"https://ipfs.near.social/add\", {\n    method: \"POST\",\n    headers: { Accept: \"application/json\" },\n    body,\n  }).then(async (res) => {\n    const _cid = res.body.cid;\n    const _name = body.name;\n    State.update({ img: { uploading: \"true\", cid: _cid, name: _name } });\n  });\n};\n\nconst filesOnChange = (files) => {\n  if (files) {\n    State.update({ error_msg: null });\n    uploadFileUpdateState(files[0]);\n  }\n};\n\nconst handleName = (item) => State.update({ groupName: item, error_msg: null });\n\nconst handleProfile = (item) =>\n  State.update({ groupAccount: item, error_msg: null });\n\nconst addMember = () => {\n  var temp = state.members;\n  let object = {\n    memberId: \"\",\n    role: \"\",\n  };\n\n  if (temp.length === 6) return;\n\n  temp.push(object);\n  State.update({ members: temp, error_msg: null });\n};\n\nconst removeMember = (index) => {\n  State.update({\n    members: state.members.splice(index, 1),\n    error_msg: null,\n  });\n};\n\nconst validate = (key, item, limit) =>\n  State.update({ [key]: item.substring(0, limit ?? 2000), error_msg: null });\n\nconst validateMembers = (params, key, limit) => {\n  let data = state.members;\n\n  data[params.index][key] = params.event.target.value.substring(0, limit);\n  State.update({ members: data, error_msg: null });\n};\n\nconst handleDeclaration = (agreement) => {\n  State.update({ agreement: agreement.toString, error_msg: null });\n};\n\nconst handleCreate = () => {\n  if (!validatedInputs()) return;\n\n  let newstate = Object.assign({}, state);\n  newstate.members = JSON.stringify(newstate.af);\n  const stateAsString = JSON.stringify(newstate);\n  const data = ` {\"data\":{ \"${context.accountId}\": {\"groups\":${stateAsString}} }}`;\n  const SocialArgs = JSON.parse(data);\n\n  // let CreateGroup_Payload = {\n  //   contractName: daoId,\n  //   methodName: \"add_proposal\",\n  //   args: {},\n  //   gas: 300000000000000,\n  //   deposit: 100000000000000000000000,\n  // };\n\n  let Social_Payload = {\n    contractName: SocialContract,\n    methodName: \"set\",\n    args: SocialArgs,\n    gas: 300000000000000,\n    deposit: 100000000000000000000000,\n  };\n\n  Near.call([Social_Payload, CreatGroup_Payload]).then(() => handleClose());\n};\n\nreturn (\n  <Modal>\n    <ComponentWrapper>\n      <CardStyled name=\"compose\">\n        <div className=\"d-flex flex-column \">\n          <CardForm>\n            <H1>Create Work Group</H1>\n            <Hr />\n            <Widget\n              src={widgets.groupInfo}\n              props={{\n                inputs: [\n                  {\n                    label: \"What is the NEAR account of your work group? *\",\n                    placeholder: \"Profile ID\",\n                    value: state.groupId,\n                    handleChange: (e) => validate(\"groupId\", e.target.value),\n                    inputType: \"text\",\n                  },\n                  {\n                    label: \"Additional Information\",\n                    placeholder: \"Elaborate on this work group. *\",\n                    value: state.details,\n                    handleChange: (e) => validate(\"details\", e.target.value),\n                  },\n                ],\n              }}\n            />\n\n            {state.error_msg && (\n              <ErrorBlock>\n                <label className=\"text-danger\">{state.error_msg}</label>\n              </ErrorBlock>\n            )}\n\n            <div className=\"col-sm-12 px-4 w-100\">\n              <Submitcontainer>\n                <Widget\n                  src={widgets.styledComponents}\n                  props={{\n                    Button: {\n                      className: \"danger \",\n                      text: \"Cancel\",\n                      onClick: handleClose,\n                    },\n                  }}\n                />\n                <Widget\n                  src={widgets.styledComponents}\n                  props={{\n                    Button: {\n                      text: \"Submit\",\n                      onClick: () => handleCreate(),\n                    },\n                  }}\n                />\n              </Submitcontainer>\n            </div>\n          </CardForm>\n        </div>\n      </CardStyled>\n    </ComponentWrapper>\n  </Modal>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hack.near/widget/NDC.WG.Create", "fact_widget_deployments_id": "242084cb1dd95870334c99d916da0410", "inserted_timestamp": "2023-08-19T23:26:08.637Z", "modified_timestamp": "2023-08-19T23:26:08.637Z", "__row_index": 18}