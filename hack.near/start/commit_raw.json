{"tx_hash": "BtRjr9ydFabppckNLxo5hN4MAe92G1bcGzzcKsVkfYjg", "action_id_social": "rv9tV7aAGG5oEGCL3BEfgh8uYG1gntfK1aggzcau69u-0-widget", "block_id": 107230124, "block_timestamp": "2023-12-05T20:36:25.253Z", "signer_id": "hack.near", "widget_name": "start", "source_code": "const [isMember, setIsMember] = useState(false);\n\nif (!context.accountId) {\n  return \"Please connect your NEAR account :)\";\n}\n\nconst JoinButton = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 23px;\n  align-self: stretch;\n\n  h3 {\n    color: var(--white-50, rgba(255, 255, 255, 0.7));\n    text-align: center;\n\n    /* H3/Small */\n    font-size: 20px;\n    font-style: normal;\n    font-weight: 500;\n    line-height: 140%; /* 28px */\n  }\n\n  a,\n  button {\n    all: unset;\n    display: flex;\n    padding: 10px 20px;\n    justify-content: center;\n    align-items: center;\n    gap: 4px;\n\n    &:hover {\n      text-decoration: none;\n      color: #000 !important;\n      cursor: pointer;\n      background: #00E494;\n    }\n\n    border-radius: 8px;\n    background: #00ec97;\n\n    color: var(--black-100, #000);\n\n    /* Other/Button_text */\n    font-size: 14px;\n    font-style: normal;\n    font-weight: 500;\n    line-height: normal;\n  }\n\n  span.pending {\n    display: flex;\n    padding: 4px 12px;\n    justify-content: center;\n    align-items: center;\n    gap: 4px;\n\n    border-radius: 8px;\n    border: 1px solid rgba(81, 182, 255, 0.2);\n    background: rgba(81, 182, 255, 0.2);\n\n    color: var(--Blue, #51b6ff);\n\n    /* Other/Button_text */\n    font-size: 14px;\n    font-style: normal;\n    font-weight: 500;\n    line-height: normal;\n  }\n\n  span.joined {\n    display: flex;\n    padding: 4px 12px;\n    justify-content: center;\n    align-items: center;\n    gap: 4px;\n\n    border-radius: 8px;\n    border: 1px solid rgba(81, 255, 234, 0.2);\n    background: rgba(81, 255, 234, 0.2);\n\n    color: var(--Sea-Blue, #51ffea);\n\n    /* Other/Button_text */\n    font-size: 14px;\n    font-style: normal;\n    font-weight: 500;\n    line-height: normal;\n  }\n`;\n\nconst userWidgets = Social.keys(`${context.accountId}/widget/**`) || [];\n\nconst daoId = \"build.sputnik-dao.near\";\nconst accountId = context.accountId;\n\n// get DAO policy, deposit, and group\nconst policy = Near.view(daoId, \"get_policy\");\n\nif (policy === null) {\n  return \"\";\n}\n\nconst deposit = policy.proposal_bond;\nconst roleId = \"community\";\nconst group = policy.roles\n  .filter((role) => role.name === roleId)\n  .map((role) => role.kind.Group);\n\n// get data from last proposal\nconst proposalId = Near.view(daoId, \"get_last_proposal_id\") - 1;\nconst proposal = Near.view(daoId, \"get_proposal\", {\n  id: proposalId,\n});\n\nif (proposal === null) {\n  return \"\";\n}\n\n// check if the potential member submitted last proposal\nconst canJoin = accountId && accountId !== proposal.proposer;\n\nconst groupMembers = group.join(\", \");\n\nconst checkMembership = (groupMembers) => {\n  if (groupMembers.indexOf(accountId) !== -1) {\n    return setIsMember(true);\n  }\n};\n\nconst data = {\n  [accountId]: {\n    graph: { connect: { [daoId]: \"\" } },\n    index: {\n      graph: JSON.stringify({\n        key: \"connect\",\n        value: {\n          accountId,\n        },\n      }),\n    },\n  },\n};\n\nconst validMember = checkMembership(groupMembers);\nconst handleJoin = () => {\n  const transactions = [\n    {\n      contractName: \"social.near\",\n      methodName: \"set\",\n      deposit,\n      args: { data },\n    },\n    {\n      contractName: daoId,\n      methodName: \"add_proposal\",\n      args: {\n        proposal: {\n          description: `add ${accountId} to the ${roleId} group`,\n          kind: {\n            AddMemberToRole: {\n              member_id: accountId,\n              role: roleId,\n            },\n          },\n        },\n      },\n      gas: 219000000000000,\n      deposit: deposit,\n    },\n  ];\n  Near.call(transactions);\n};\n\nconst CreateSomethingView = (props) => {\n  return (\n    <JoinButton>\n      {userWidgets.length === 0 ? (\n        <>\n          <a href=\"/edit\">\n            Create Something\n            <svg\n              xmlns=\"http://www.w3.org/2000/svg\"\n              width=\"16\"\n              height=\"17\"\n              viewBox=\"0 0 16 17\"\n              fill=\"none\"\n            >\n              <path\n                d=\"M10.7809 7.83327L7.2049 4.25726L8.1477 3.31445L13.3332 8.49993L8.1477 13.6853L7.2049 12.7425L10.7809 9.1666H2.6665V7.83327H10.7809Z\"\n                fill=\"black\"\n              />\n            </svg>\n          </a>\n        </>\n      ) : (\n        <>\n          {canJoin ? (\n            <button onClick={handleJoin}>Join Build DAO</button>\n          ) : (\n            <>\n              <span className={!validMember ? \"pending\" : \"joined\"}>\n                {!validMember ? \"Pending...\" : \"Joined\"}\n              </span>\n            </>\n          )}\n        </>\n      )}{\" \"}\n    </JoinButton>\n  );\n};\n\nreturn <CreateSomethingView {...props} />;\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hack.near/widget/start", "fact_widget_deployments_id": "7c24d80bb3e5b4395cc76983aa5b193d", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}