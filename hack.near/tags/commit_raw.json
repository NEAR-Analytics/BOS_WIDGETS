{"tx_hash": "AFv9aG5jXKirpA1VTHWo5PZ9GW7RUYKFq8eoKyzYTBuC", "action_id_social": "Dh3rZpWJfpVFB2yX2J9XsK9HBVYh4P4yKSCMhr78qVdn-0-widget", "block_id": 107489400, "block_timestamp": "2023-12-09T04:26:38.478Z", "signer_id": "hack.near", "widget_name": "tags", "source_code": "const accountId = props.accountId || context.accountId;\nconst path = props.path || \"hack.near/widget/Academy\";\nconst [creatorId, namespace, thingId] = path.split(\"/\");\n\nconst pattern = `*/graph/context/${path}/tags/**`;\nconst tagsObject = Social.get(pattern, \"final\");\n\nif (!tagsObject) {\n  return \"Loading...\";\n}\n\nState.init({\n  showEditor: false,\n  tags: tagsObject,\n});\n\nconst tagClass = \"bg-success\";\nconst badgeBtnClass = \"text-white btn p-0 lh-1 m-1\";\n\nconst tagsCount = {};\n\nconst processTagsObject = (obj) => {\n  Object.entries(obj).forEach((kv) => {\n    if (kv[1] === null) {\n      const tag = kv[0];\n      tagsCount[tag] = (tagsCount[tag] || 0) - 1;\n    } else if (typeof kv[1] === \"object\") {\n      processTagsObject(kv[1]);\n    } else {\n      const tag = kv[0];\n      tagsCount[tag] = (tagsCount[tag] || 0) + 1;\n    }\n  });\n};\n\nconst getTags = () => {\n  processTagsObject(tagsObject);\n  const tags = Object.entries(tagsCount);\n  tags.sort((a, b) => b[1] - a[1]);\n  return tags.map((t) => {\n    return {\n      name: t[0],\n      count: t[1],\n      title: t[1] + (t[1] > 1 ? \" times\" : \" time\"),\n    };\n  });\n};\n\nconst publicTags = getTags();\n\nconst pageUrl = props.url ?? \"/hack.near/widget/every.context\";\n\nreturn (\n  <>\n    <div className=\"m-1\">\n      {publicTags &&\n        publicTags.map((tag) => (\n          <a\n            href={`${pageUrl}?tag=${tag.name}`}\n            className={badgeBtnClass}\n            key={tag.name}\n          >\n            <span\n              className={`badge ${tagClass} position-relative`}\n              title={tag.title}\n              style={\n                tag.count > 1\n                  ? {\n                      marginRight: \"0.9em\",\n                      paddingRight: \"0.85em\",\n                    }\n                  : { marginRight: \"0.25em\" }\n              }\n            >\n              #{tag.name}\n              {tag.count > 1 && (\n                <span\n                  className={`badge translate-middle rounded-pill bg-danger position-absolute top-50 start-100`}\n                >\n                  {tag.count}\n                </span>\n              )}\n            </span>\n          </a>\n        ))}\n    </div>\n    <div className=\"m-2\">\n      {!state.showEditor ? (\n        <button\n          onClick={() => State.update({ showEditor: true })}\n          className={badgeBtnClass}\n        >\n          <div className={`me-1 mt-3 badge bg-primary`}>+ Tags</div>\n        </button>\n      ) : (\n        <div className=\"mb-2\">\n          <button\n            onClick={() => State.update({ showEditor: false })}\n            className=\"text-white btn p-0 lh-1 m-1\"\n          >\n            <div className={`me-1 mt-3 badge bg-secondary`}>x Close</div>\n          </button>\n        </div>\n      )}\n      {state.showEditor && (\n        <div className=\"row\">\n          <div className=\"m-1 col-8\">\n            <Widget\n              src=\"mob.near/widget/TagsEditor\"\n              props={{\n                initialTagsObject: tags,\n                tagsPattern,\n                placeholder: \"dev, art, gov, edu, social, near\",\n                setTagsObject: (tags) => {\n                  state.tags = tags;\n                  State.update();\n                },\n              }}\n            />\n          </div>\n          <div className=\"m-1 col-3\">\n            <CommitButton\n              disabled={tags === null}\n              data={{\n                graph: {\n                  context: {\n                    [creatorId]: {\n                      [namespace]: {\n                        [thingId]: {\n                          tags: state.tags,\n                        },\n                      },\n                    },\n                  },\n                },\n              }}\n            >\n              Save\n            </CommitButton>\n          </div>\n        </div>\n      )}\n    </div>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hack.near/widget/tags", "fact_widget_deployments_id": "d67d517f90898df39dcde989422a2b16", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 5}