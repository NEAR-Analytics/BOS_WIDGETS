{"tx_hash": "J5ZZEDW12dZSqyYCZvuS6iQ8fNmyUMzB4L3Ldag1fAh2", "action_id_social": "ES9Rn4vN6K3mXFZPqwXPXcH9nTGdCAzGAjYcLEpEvAWp-0-widget", "block_id": 96496743, "block_timestamp": "2023-07-15T02:07:20.838Z", "signer_id": "hack.near", "widget_name": "widget.card", "source_code": "const accountId = props.accountId ?? context.accountId;\nconst daoId = props.daoId ?? \"build.sputnik-dao.near\";\nconst code = props.code;\n\nconst policy = Near.view(daoId, \"get_policy\");\n\nconst deposit = policy.proposal_bond;\n\nconst widgetName = props.widgetName ?? \"Academy\";\nconst widgetPath = `${accountId}/widget/${widgetName}`;\nconst blockHeight = props.blockHeight;\nconst metadata = props.metadata ?? Social.getr(`${widgetPath}/metadata`);\nconst renderTag = props.renderTag;\n\nconst name = metadata.name ?? widgetName;\nconst description = metadata.description;\nconst image = metadata.image;\nconst tags = Object.keys(metadata.tags ?? {});\nconst expanded = !!props.expanded;\n\nconst linktree = Object.entries(metadata.linktree ?? {});\nconst linktreeElements = {\n  website: {\n    prefix: \"https://\",\n    icon: \"bi-globe2\",\n  },\n};\n\nconst linktreeObjects = linktree.map((o, i) => {\n  const key = o[0];\n  let value = o[1];\n  if (!value) {\n    return null;\n  }\n  const e = linktreeElements[key];\n  if (e.prefix) {\n    value = value && value.replace(e.prefix, \"\");\n  }\n  const icon = e.icon ? (\n    <i className={`bi ${e.icon ?? \"\"} text-secondary me-1`}></i>\n  ) : (\n    \"\"\n  );\n  return e.prefix ? (\n    <div key={i} className=\"text-truncate\">\n      <a href={`${e.prefix}${value}`}>\n        {icon}\n        {value}\n      </a>\n    </div>\n  ) : (\n    <div key={i} className=\"text-truncate\">\n      {key}: {icon}\n      {value}\n    </div>\n  );\n});\n\nconst descriptionKey = `${widgetPath}-description`.replaceAll(/[._\\/-]/g, \"--\");\n\nconst item = {\n  type: \"dev\",\n  path: widgetPath,\n  blockHeight,\n};\n\nconst widget_args = JSON.stringify({\n  data: {\n    [daoId]: {\n      widget: {\n        [`${widgetName}`]: {\n          \"\": `${code}`,\n        },\n      },\n    },\n  },\n});\n\nconst proposal_args = Buffer.from(widget_args, \"utf-8\").toString(\"base64\");\n\nconst handleProposal = () => {\n  Near.call([\n    {\n      contractName: daoId,\n      methodName: \"add_proposal\",\n      args: {\n        proposal: {\n          description: \"update widget\",\n          kind: {\n            FunctionCall: {\n              receiver_id: \"social.near\",\n              actions: [\n                {\n                  method_name: \"set\",\n                  args: proposal_args,\n                  deposit: \"50000000000000000000000\",\n                  gas: \"30000000000000\",\n                },\n              ],\n            },\n          },\n        },\n      },\n      deposit: deposit,\n      gas: \"219000000000000\",\n    },\n  ]);\n};\n\nconst handleCreate = () =>\n  Social.set({\n    widget: {\n      [`${widgetName}`]: {\n        \"\": `${code}`,\n        metadata: {\n          tags: {\n            build: \"\",\n          },\n        },\n      },\n    },\n  });\n\nreturn (\n  <div className=\"card\" style={{ borderRadius: \"12px\" }}>\n    <div className=\"row py-3 g-1\">\n      <div className=\"m-auto text-center\" style={{ maxWidth: \"12em\" }}>\n        <div\n          className=\"d-inline-block\"\n          style={{ width: \"10em\", height: \"10em\" }}\n        >\n          <Widget\n            src=\"mob.near/widget/Image\"\n            props={{\n              image,\n              className: \"w-100 h-100 shadow\",\n              style: { objectFit: \"cover\", borderRadius: \"2em\" },\n              thumbnail: false,\n              fallbackUrl:\n                \"https://ipfs.near.social/ipfs/bafkreido7gsk4dlb63z3s5yirkkgrjs2nmyar5bxyet66chakt2h5jve6e\",\n              alt: widgetName,\n            }}\n          />\n        </div>\n      </div>\n      <div className=\"col-6 px-2\">\n        <div className=\"position-relative\">\n          <h5 className=\"card-title\">\n            <a href={`#/${widgetPath}`}>\n              <i className=\"bi bi-box-arrow-up-right text-secondary me-1\" />\n              {name}\n            </a>\n          </h5>\n        </div>\n        <div className=\"card-text\">\n          {tags.length > 0 && (\n            <div>\n              {tags.map((tag, i) => {\n                const tagBadge = (\n                  <span key={i} className=\"me-1 mb-1 badge bg-secondary\">\n                    #{tag}\n                  </span>\n                );\n                return renderTag ? renderTag(tag, tagBadge) : tagBadge;\n              })}\n            </div>\n          )}\n          {!expanded && (description || linktreeObjects.length > 0) && (\n            <button\n              className=\"btn btn-sm btn-outline-secondary border-0\"\n              data-bs-toggle=\"collapse\"\n              data-bs-target={`#${descriptionKey}`}\n              aria-expanded=\"false\"\n              aria-controls={descriptionKey}\n            >\n              <i className=\"bi bi-arrows-angle-expand me-1\"></i>about\n            </button>\n          )}\n          <a\n            href={`#/mob.near/widget/WidgetSource?src=${widgetPath}`}\n            className=\"btn btn-sm btn-outline-secondary border-0\"\n            target=\"_blank\"\n          >\n            <i className=\"bi bi-code me-1\"></i>source\n          </a>\n          <a\n            href={`#/bozon.near/widget/WidgetHistory?widgetPath=${widgetPath}`}\n            className=\"btn btn-sm btn-outline-secondary border-0\"\n            target=\"_blank\"\n          >\n            <i className=\"bi bi-clock-history me-1\"></i>history\n          </a>\n        </div>\n        <div className=\"m-2\">\n          {accountId !== context.accountId && (\n            <button className=\"btn btn-primary border-0\" onClick={handleCreate}>\n              <i className=\"bi bi-bezier2 me-1\"></i>\n              {accountId === context.accountId ? \"edit\" : \"clone\"}\n            </button>\n          )}\n          <a\n            className=\"btn btn-success border-0 m-1\"\n            href={`#/edit/${widgetPath}`}\n          >\n            <i className=\"bi bi-diagram-2 me-1\"></i>\n            {accountId === context.accountId ? \"edit\" : \"fork\"}\n          </a>\n          {accountId === daoId && (\n            <button\n              className=\"btn btn-secondary mt-1 border-0\"\n              onClick={handleProposal}\n            >\n              <i className=\"bi bi-git me-1\"></i>\n              {accountId === context.accountId ? \"update\" : \"propose changes\"}\n            </button>\n          )}\n        </div>\n      </div>\n      <div className=\"col-2 mt-2\">\n        <Widget\n          src=\"hack.near/widget/star.button\"\n          props={{ widgetPath, accountId }}\n        />\n      </div>\n    </div>\n    <div\n      className={`card-text p-2 pt-0 ${expanded ? \"\" : \"collapse\"}`}\n      id={descriptionKey}\n    >\n      <Markdown text={description} />\n      {linktreeObjects}\n    </div>\n    <div\n      className=\"card-footer\"\n      style={{ borderBottomLeftRadius: \"2em\", borderBottomRightRadius: \"2em\" }}\n    >\n      <div className=\"d-flex justify-content-start\">\n        <div className=\"flex-grow-1 m-2 text-truncate\">\n          <Widget\n            src=\"mob.near/widget/ProfileLine\"\n            props={{ accountId, link: props.profileLink }}\n          />\n        </div>\n        <div>\n          <small className=\"ps-1 text-nowrap text-muted ms-auto m-2\">\n            <i className=\"bi bi-clock me-1\"></i>\n            <Widget\n              src=\"mob.near/widget/TimeAgo\"\n              props={{ keyPath: widgetPath, now: props.metadata, blockHeight }}\n            />\n          </small>\n        </div>\n      </div>\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hack.near/widget/widget.card", "fact_widget_deployments_id": "e7348f12feed7c3615d1e978605138e4", "inserted_timestamp": "2000-01-01T00:00:00.000Z", "modified_timestamp": "2000-01-01T00:00:00.000Z", "__row_index": 3}