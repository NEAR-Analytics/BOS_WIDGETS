{"tx_hash": "6QhZUS43aWfZKkLw2kmAqzXY6KXTYzdpZ5oaKcCpAz9L", "action_id_social": "JDcfyxphhnqnAdUZVXHuEpbafTfF6oGpCCEhmS7tXwUi-0-widget", "block_id": 118786019, "block_timestamp": "2024-05-12T17:47:31.929Z", "signer_id": "hack.near", "widget_name": "explore.history", "source_code": "if (typeof props.path !== \"string\") return \"send {path} as string in props\";\r\n\r\nState.init({\r\n  selectedBlockHeight: null,\r\n});\r\n\r\nconst historyBlocksRequest = Social.keys(`${props.path}`, \"final\", {\r\n  return_type: \"History\",\r\n});\r\n\r\nif (historyBlocksRequest === null) return \"loading...\";\r\n\r\nconst [accountId, typeId, thingId] = props.path.split(\"/\");\r\n\r\nlet blocksChanges = historyBlocksRequest[accountId]?.[typeId]?.[thingId];\r\n\r\nif (props.count) props.count(blocksChanges.length);\r\n\r\nif (blocksChanges) blocksChanges = blocksChanges?.sort((a, b) => b - a);\r\n\r\nif (!state.selectedBlockHeight) state.selectedBlockHeight = blocksChanges[0];\r\n\r\nfunction getDatastringFromBlockHeight(blockHeight) {\r\n  const block = Near.block(blockHeight);\r\n  const date = new Date(block.header.timestamp_nanosec / 1e6);\r\n  return date.toDateString() + \" \" + date.toLocaleTimeString();\r\n}\r\n\r\nfunction blockHeightToWidgetRender(blockHeight) {\r\n  const index = blocksChanges.findIndex((el) => el == blockHeight);\r\n  return (\r\n    <Widget\r\n      style={{ minHeight: \"200px\" }}\r\n      key={blockHeight}\r\n      src={`bozon.near/widget/WidgetHistory.RenderCode`}\r\n      props={{\r\n        pathToWidget: props.path,\r\n        currentBlockHeight: blockHeight,\r\n        prevBlockHeight: blocksChanges[index + 1],\r\n      }}\r\n    />\r\n  );\r\n}\r\n\r\nreturn (\r\n  <div>\r\n    {!blocksChanges ? (\r\n      <div>invalid path</div>\r\n    ) : (\r\n      <div>{blockHeightToWidgetRender(state.selectedBlockHeight)}</div>\r\n    )}\r\n  </div>\r\n);\r\n", "metadata": {"fork_of": "bozon.near/widget/WidgetHistory.History@86234702"}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hack.near/widget/explore.history", "fact_widget_deployments_id": "ed1f21c11831c69027fa85b1d1fab2fa", "inserted_timestamp": "2024-05-12T19:39:39.317Z", "modified_timestamp": "2024-05-12T19:39:39.317Z", "__row_index": 0}