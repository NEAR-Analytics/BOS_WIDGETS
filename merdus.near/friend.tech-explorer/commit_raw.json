{"tx_hash": "6TzCxEhMf41qYhPhy2iAXJVyU1Fvpo3iR59sd2A3Qxw5", "action_id_social": "5PMEQCzcM1jQGjQULwWPpNnYZ2Nuprp6aGbHe8zMpMyz-0-widget", "block_id": 103449070, "block_timestamp": "2023-10-15T17:40:00.379Z", "signer_id": "merdus.near", "widget_name": "friend.tech-explorer", "source_code": "const decimals = 18;\n\nfunction formatHex0(value, tokenDecimals) {\n  const formattedValue = Big(value.toString())\n    .div(Big(10).pow(tokenDecimals))\n    .toFixed(0)\n    .replace(/\\d(?=(\\d{3})+\\.)/g, \"$&,\");\n\n  return formattedValue;\n}\n\nfunction formatHex(value, tokenDecimals) {\n  const formattedValue = Big(value.toString())\n    .div(Big(10).pow(tokenDecimals))\n    .toFixed(6)\n    .replace(/\\d(?=(\\d{3})+\\.)/g, \"$&,\");\n\n  return formattedValue;\n}\n\nState.init({\n  strEther: 0,\n  gasPrice: 0,\n});\n\n// connect to Base to show UI\nif (\n  state.chainId === undefined &&\n  ethers !== undefined &&\n  Ethers.send(\"eth_requestAccounts\", [])[0]\n) {\n  Ethers.provider()\n    .getNetwork()\n    .then((chainIdData) => {\n      if (chainIdData?.chainId) {\n        State.update({ chainId: chainIdData.chainId });\n      }\n    });\n}\n\nif (state.chainId !== undefined && state.chainId !== 8453) {\n  return <p>Switch to Base Mainnet</p>;\n}\n\n// FETCH ABI\n\nconst contractAddress = \"0xCF205808Ed36593aa40a44F10c7f7C2F67d4A4d4\";\nconst tokenDecimals = 18;\n\nconst contractAbi = fetch(\n  \"https://raw.githubusercontent.com/aeither/bos-gateway/main/abi/FriendtechSharesV1.json\"\n);\nif (!contractAbi.ok) {\n  return \"Loading\";\n}\n\nconst iface = new ethers.utils.Interface(contractAbi.body);\n\n// HELPER\n\nfunction getGasPrice() {\n  return Ethers.provider().getGasPrice();\n}\n\n// DETECT SENDER\n\nif (state.sender === undefined) {\n  const accounts = Ethers.send(\"eth_requestAccounts\", []);\n  if (accounts.length) {\n    State.update({ sender: accounts[0] });\n    console.log(\"set sender\", accounts[0]);\n  }\n}\n\n// FETCH SENDER BALANCE\n\nif (state.balance === undefined && state.sender) {\n  Ethers.provider()\n    .getBalance(state.sender)\n    .then((balance) => {\n      State.update({ balance: Big(balance).div(Big(10).pow(18)).toFixed(2) });\n    });\n}\n\nconst appContainer = styled.div`\n  background-color: #000;\n  color: #fff;\n  border: 1px solid #ccc;\n  padding: 20px;\n  border-radius: 10px;\n  max-width: 600px;\n  margin: 0 auto;\n`;\n\n// UI\n\nconst getSender = () => {\n  return !state.sender\n    ? \"\"\n    : state.sender.substring(0, 6) +\n        \"...\" +\n        state.sender.substring(state.sender.length - 4, state.sender.length);\n};\n\nreturn (\n  <appContainer>\n    <div class=\"border-bottom\">\n      <div class=\"container px-1 py-2\">\n        <div class=\"row\">\n          <div class=\"col\">\n            <div className=\"d-flex justify-content-between align-items-right\">\n              <h1>friend.tech</h1>\n              <Web3Connect connectLabel=\"Wallet\" />\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <Widget\n      src=\"scottie.near/widget/Prices\"\n      //props={{\n      //blockHeight: message.block_height,\n      //}}\n    />\n\n    {!!state.sender && (\n      <div class=\"container centered-text\">\n        <div class=\"row\">\n          <div class=\"col\">\n            <div class=\"border rounded py-2 my-2 text-center\">\n              {state.balance} ETH - {getSender()}\n            </div>\n          </div>\n        </div>\n      </div>\n    )}\n\n    <div class=\"container centered-text mt-5\">\n      <h5>The friend.tech Account Explorer \ud83d\udd0d</h5>\n      <div class=\"row\">\n        <div class=\"col py-2\">\n          <div class=\"input-group\">\n            <input\n              disabled={!state.sender}\n              value={state.targetAddress}\n              onChange={(e) => State.update({ targetAddress: e.target.value })}\n              placeholder=\"Search by Address\"\n            />\n            <button\n              onClick={() => {\n                const friendTechContract = new ethers.Contract(\n                  contractAddress,\n                  contractAbi.body,\n                  Ethers.provider().getSigner()\n                );\n\n                // Total supply\n                friendTechContract\n                  .sharesSupply(state.targetAddress)\n                  .then((data) => {\n                    console.log(formatHex(data, 0));\n                    State.update({ sharesSupply: formatHex0(data, 0) });\n                  });\n\n                // Sell Price\n                friendTechContract\n                  .getSellPrice(state.targetAddress, 1)\n                  .then((data) => {\n                    console.log(formatHex(data, decimals));\n                    State.update({ sellPrice: formatHex(data, decimals) });\n                  });\n\n                // Sell Price After Fee\n                friendTechContract\n                  .getSellPriceAfterFee(state.targetAddress, 1)\n                  .then((data) => {\n                    console.log(formatHex(data, decimals));\n                    State.update({\n                      sellPriceAfterFee: formatHex(data, decimals),\n                    });\n                  });\n\n                // Buy Price\n                friendTechContract\n                  .getBuyPrice(state.targetAddress, 1)\n                  .then((data) => {\n                    console.log(formatHex(data, decimals));\n                    State.update({ buyPrice: formatHex(data, decimals) });\n                  });\n\n                // Buy Price After Fee\n                friendTechContract\n                  .getBuyPriceAfterFee(state.targetAddress, 1)\n                  .then((data) => {\n                    console.log(formatHex(data, decimals));\n                    State.update({\n                      buyPriceAfterFee: formatHex(data, decimals),\n                    });\n                  });\n\n                // target user balance\n                Ethers.provider()\n                  .getBalance(state.targetAddress)\n                  .then((balance) => {\n                    console.log(\"balance\", formatHex(balance, decimals));\n                    State.update({\n                      targetBalance: formatHex(balance, decimals),\n                    });\n                  });\n              }}\n              className=\"btn btn-primary\"\n            >\n              Search\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    {state.targetAddress && state.sharesSupply && (\n      <>\n        <div class=\"container centered-text\">\n          <div class=\"row \">\n            <div class=\"col \">\n              <div class=\"border rounded py-2 my-2\">\n                <div class=\"px-2\">Supply: {state.sharesSupply}</div>\n                <div class=\"px-2\">Buy Price: {state.buyPrice}</div>\n                <div class=\"px-2\">\n                  Buy Price (including fees): {state.buyPriceAfterFee}{\" \"}\n                </div>\n                <div class=\"px-2\">Sell Price: {state.sellPrice}</div>\n                <div class=\"px-2\">\n                  Sell Price (including fees): {state.sellPriceAfterFee}\n                </div>\n                <div class=\"px-2\">Address Balance: {state.targetBalance}</div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </>\n    )}\n\n    <div class=\"container centered-text\">\n      <h5>Top 3 accounts</h5>\n      <div class=\"row\">\n        <div class=\"col m-2\">1. Racer - 0xfd72...325a9</div>\n        <div class=\"col\">\n          <button\n            onClick={() => {\n              clipboard.writeText(\"0xfd7232e66a69e1ae01e1e0ea8fab4776e2d325a9\");\n            }}\n          >\n            Copy\n          </button>\n        </div>\n      </div>\n      <div class=\"row\">\n        <div class=\"col m-2\">2. Hsaka - 0xef42...7a226</div>\n        <div class=\"col\">\n          <button\n            onClick={() => {\n              clipboard.writeText(\"0xef42b587e4a3d33f88fa499be1d80c676ff7a226\");\n            }}\n          >\n            Copy\n          </button>\n        </div>\n      </div>\n      <div class=\"row\">\n        <div class=\"col m-2\">3. Cobie - 0x4e5f...676e1</div>\n        <div class=\"col\">\n          <button\n            onClick={() => {\n              clipboard.writeText(\"\t0x4e5f7e4a774bd30b9bdca7eb84ce3681a71676e1\");\n            }}\n          >\n            Copy\n          </button>\n        </div>\n      </div>\n    </div>\n  </appContainer>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/merdus.near/widget/friend.tech-explorer", "fact_widget_deployments_id": "62cf6ef8a2b3b0c47739249aea9385be", "inserted_timestamp": "2023-10-15T19:35:12.382Z", "modified_timestamp": "2023-10-15T19:35:12.382Z", "__row_index": 0}