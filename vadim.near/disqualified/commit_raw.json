{"tx_hash": "kYiZ9MjvVXjahSyUjwznzqgEJg8XoLq9E1Ra3HxUYha", "action_id_social": "Gw4bfRAZ2ApeScgPQosY228uMTc8yDKZqNgTAoid1vpt-0-widget", "block_id": 102812284, "block_timestamp": "2023-10-07T08:21:24.110Z", "signer_id": "vadim.near", "widget_name": "disqualified", "source_code": "const disqualified = fetch(\n  \"https://gist.githubusercontent.com/zavodil/75b2f326efc220da8176233dbb309748/raw/9081ec8b917144872b530b8f5085a5c5d0af442a/gistfile1.txt\"\n);\nif (disqualified.ok) {\n  State.update({ disqualified: disqualified.body.split(\"\\n\") });\n} else return \"Loading\";\n\nconst data = fetch(\n  \"https://raw.githubusercontent.com/zavodil/near-nft-owners-list/main/output_election_votes.txt\"\n);\n\nif (data.ok) {\n  let voters = {};\n  Object.values(\n    data.body\n      .split(\"\\n\")\n      .map((line) => line.split(\"|\"))\n      .filter((data) => data.length === 5)\n  ).map((item) => {\n    const account_id = item[0];\n    if (voters[account_id] == undefined) {\n      voters[account_id] = {};\n    }\n    voters[account_id][item[3]] = item[4].toLowerCase();\n  });\n\n  State.update({ voters });\n} else return \"Loading\";\n\nlet affectedCandidates = {};\nlet totalDisaqualifiedVotes = 0;\nstate.disqualified.map((accountId) => {\n  Object.keys(state.voters[accountId]).map((house) => {\n    JSON.parse(state.voters[accountId][house]).map(\n      (candidateId) =>\n        (affectedCandidates[candidateId] =\n          (affectedCandidates[candidateId] ?? 0) + 1)\n    );\n    totalDisaqualifiedVotes += JSON.parse(\n      state.voters[accountId][house]\n    ).length;\n  });\n});\nconst affectedCandidatesSorted = Object.keys(affectedCandidates).sort(\n  (a, b) => affectedCandidates[b] - affectedCandidates[a]\n);\n\nconst containsSearchBy = (account_id) => {\n  return !account_id || !state.searchBy || account_id.includes(state.searchBy);\n};\n\nreturn (\n  <div>\n    <h4>\n      EIC{\" \"}\n      <a\n        href=\"https://near-ndc.notion.site/0de8e7789e3a476584ca56a4399f10ac?v=4e99173f37b74bec8af740160a8f8bd9\"\n        target=\"_blank\"\n      >\n        nullified\n      </a>{\" \"}\n      the votes of 157 voters\n    </h4>\n    <h1>The candidates affected:</h1>\n\n    <div class=\"input-group mb-1\">\n      <input\n        type=\"text\"\n        class=\"form-control\"\n        placeholder=\"Search by NEAR Account ID\"\n        onChange={(e) =>\n          State.update({\n            searchBy: e.target.value,\n          })\n        }\n        value={state.searchBy}\n      />\n\n      <button\n        class=\"btn btn-outline-secondary\"\n        type=\"button\"\n        onClick={() => State.update({ searchBy: \"\" })}\n        title=\"Reset Search\"\n      >\n        X\n      </button>\n    </div>\n\n    <div class=\"row align-items-start border-bottom\">\n      <div class=\"col fw-bold\">Candidate</div>\n      <div class=\"col fw-bold\">Votes nullified</div>\n    </div>\n\n    {affectedCandidatesSorted\n      .filter((account_id) => containsSearchBy(account_id))\n      .map((candidateId) => {\n        return (\n          <div class=\"row border-bottom align-items-start\">\n            <div class=\"col\" title={candidateId}>\n              <Widget\n                src=\"mob.near/widget/N.ProfileLine\"\n                props={{\n                  accountId: candidateId,\n                  link: true,\n                  hideAccountId: true,\n                  hideImage: false,\n                }}\n              />\n            </div>\n            <div class=\"col align-items-start\">\n              {affectedCandidates[candidateId]}\n            </div>\n          </div>\n        );\n      })}\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/vadim.near/widget/disqualified", "fact_widget_deployments_id": "f6989187358e2c54a3957901d28fb559", "inserted_timestamp": "2023-10-07T10:25:01.541Z", "modified_timestamp": "2023-10-07T10:25:01.541Z", "__row_index": 1}