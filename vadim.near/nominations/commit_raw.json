{"tx_hash": "2NTD6qcTywGa685nrZL3PMKtz5Y5KUWdcNWqe84NBByU", "action_id_social": "EjZaR8uhA4hyY8wQfjzhwfg9NPPGU5wy5yERMvULPki6-0-widget", "block_id": 100801178, "block_timestamp": "2023-09-10T09:51:56.690Z", "signer_id": "vadim.near", "widget_name": "nominations", "source_code": "State.init({ candidate: props.accountId ?? \"vadim.near\" });\nconst houses = [\"HouseOfMerit\", \"CouncilOfAdvisors\", \"TransparencyCommission\"];\nconst selectedHouse = \"\";\nhouses.map((house) => {\n  if (state[house] == undefined) {\n    const nominations = Near.view(\"nominations.ndc-gwg.near\", \"nominations\", {\n      house,\n    });\n\n    if (nominations) {\n      State.update({\n        [house]: Object.values(\n          nominations.sort((a, b) => {\n            if (a[1] < b[1]) return 1;\n            if (a[1] > b[1]) return -1;\n            return 0;\n          })\n        ).map((item) => item[0]),\n      });\n    }\n  } else {\n    if (state[house].includes(state.candidate)) {\n      selectedHouse = house;\n    }\n  }\n});\n\nconst data = fetch(\n  \"https://raw.githubusercontent.com/zavodil/near-nft-owners-list/main/output_votes_all.txt\"\n);\n\nif (data.ok) {\n  let candidates = {};\n  Object.values(\n    data.body\n      .split(\"\\n\")\n      .map((line) => line.split(\"|\"))\n      .filter((data) => data.length === 3)\n      .sort((a, b) => {\n        if (Date.parse(a[2]) < Date.parse(b[2])) return 1;\n        if (Date.parse(a[2]) > Date.parse(b[2])) return -1;\n        return 0;\n      })\n  ).map((item) => {\n    if (candidates[item[1]] == undefined) {\n      candidates[item[1]] = [];\n    }\n    candidates[item[1]].push({ [item[0]]: item[2] });\n  });\n\n  State.update({ candidates });\n} else return \"Loading\";\n\nconst votes = (state?.candidates[state.candidate] ?? []).map((record) =>\n  Object.entries(record).map((item) => (\n    <div class=\"row align-items-start\">\n      <div\n        class=\"col col-md-8 overflow-hidden ps-0 pb-1\"\n        style={{ minWidth: \"100px\" }}\n      >\n        <Widget\n          src=\"mob.near/widget/Profile.ShortInlineBlock\"\n          props={{ accountId: item[0], tooltip: false }}\n        />\n      </div>\n      <div\n        class=\"col col-md-4\"\n        style={{ whiteSpace: \"nowrap\", minWidth: \"35px\" }}\n      >\n        <small>{item[1].substr(5, 11).replace(\"-\", \"/\")}</small>\n      </div>\n    </div>\n  ))\n);\n\nconst getCandidates = (house) => {\n  return (state[house] ?? []).map((candidate) => (\n    <div class=\"row align-items-start\">\n      <div\n        class=\"col ps-0 overflow-hidden\"\n        style={{\n          backgroundColor:\n            candidate !== state.candidate ? \"white\" : \"lightblue\",\n        }}\n      >\n        <a\n          onClick={() => {\n            State.update({ candidate });\n            return false;\n          }}\n          style={{ cursor: \"pointer\" }}\n        >\n          <Widget\n            src=\"mob.near/widget/N.ProfileLine\"\n            props={{\n              accountId: candidate,\n              link: false,\n              hideAccountId: true,\n              hideImage: false,\n            }}\n          />\n        </a>\n      </div>\n    </div>\n  ));\n};\n\nconst link = `https://near.social/vadim.near/widget/nominations?accountId=${state.candidate}`;\n\nreturn (\n  <>\n    <h1 class=\"text-center\">All upvotes for NDC Nominations</h1>\n    <div class=\"container\">\n      <div class=\"row\">\n        {houses.map((house) => (\n          <div class=\"col col-3 align-self-start\">\n            <strong>{house.match(/[A-Z][a-z]+|[0-9]+/g).join(\" \")}</strong>\n            <div class=\"container\">{getCandidates(house)}</div>\n          </div>\n        ))}\n\n        <div class=\"col col-3 align-self-start\">\n          <strong>\n            Votes for {state.candidate}:{\" \"}\n            {state.candidates[state.candidate].length}\n          </strong>\n          <div class=\"pb-2\">\n            <a\n              href={`/nomination.ndctools.near/widget/NDC.Nomination.Candidate.Page?house=${selectedHouse}&accountId=${state.candidate}`}\n              class=\"btn btn-primary mt-2\"\n              target=\"_blank\"\n            >\n              Upvote!\n            </a>\n          </div>\n          <div class=\"container\">{votes}</div>\n        </div>\n      </div>\n    </div>\n\n    {state.candidate && (\n      <div class=\"sp-3\">\n        <span>Link to this page for selected candidate:</span>\n        <a href={link}>{link}</a>\n      </div>\n    )}\n\n    <hr />\n    <p>\n      <small>\n        Data is retrieved automatically from the\n        <a\n          href=\"https://github.com/zavodil/near-nft-owners-list/blob/main/.github/workflows/indexed.yml\"\n          target=\"_blank\"\n        >\n          NEAR Public indexer\n        </a>{\" \"}\n        with a slight delay.\n      </small>\n    </p>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/vadim.near/widget/nominations", "fact_widget_deployments_id": "85a40fdbdf39022a63e3e8e8847e0e8e", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}