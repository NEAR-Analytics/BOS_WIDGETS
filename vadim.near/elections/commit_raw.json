{"tx_hash": "6Lew9UM4Ev1USmyMAafu7SLkXASoRJwWsBUVc6uSAn5Q", "action_id_social": "4h6gogdHKXHs8Ma6rBrZNYoZy3z3pa943kaSzJHadKAV-0-widget", "block_id": 100671310, "block_timestamp": "2023-09-08T15:46:04.390Z", "signer_id": "vadim.near", "widget_name": "elections", "source_code": "State.init({ accountId: props.accountId });\n\nconst data = fetch(\n  \"https://raw.githubusercontent.com/zavodil/near-nft-owners-list/main/output_election_votes.txt\"\n);\n\nif (data.ok) {\n  let voters = {};\n  Object.values(\n    data.body\n      .split(\"\\n\")\n      .map((line) => line.split(\"|\"))\n      .filter((data) => data.length === 5)\n    /*.sort((a, b) => {\n        if (a[0] < b[0]) return -1;\n        if (a[0] > b[0]) return 1;\n        return 0;\n      })*/\n  ).map((item) => {\n    const account_id = item[0];\n    if (voters[account_id] == undefined) {\n      voters[account_id] = {};\n    }\n    voters[account_id][item[3]] = item[4];\n  });\n\n  State.update({ voters });\n} else return \"Loading\";\n\nconst countKeysRecursive = (obj) => {\n  return Object.keys(obj).reduce((count, key) => {\n    const value = obj[key];\n\n    return count + JSON.parse(value).length;\n  }, 0);\n};\n\nconst accounts = Object.keys(state.voters ?? []).map((account_id) => {\n  return (\n    <div class=\"row align-items-start\">\n      <div\n        class=\"col ps-0 overflow-hidden\"\n        style={{\n          backgroundColor:\n            account_id !== state.accountId ? \"white\" : \"lightblue\",\n        }}\n      >\n        <a\n          onClick={() => {\n            State.update({ accountId: account_id });\n            return false;\n          }}\n          style={{ cursor: \"pointer\" }}\n        >\n          <Widget\n            src=\"mob.near/widget/N.ProfileLine\"\n            props={{\n              accountId: account_id,\n              link: false,\n              hideAccountId: true,\n              hideImage: false,\n            }}\n          />{\" \"}\n          ({countKeysRecursive(state.voters[account_id])})\n        </a>\n      </div>\n    </div>\n  );\n});\n\nconst getVotes = (house) => {\n  return (JSON.parse(state.voters[state.accountId][house]) ?? []).map(\n    (account_id) => {\n      return (\n        <div class=\"row align-items-start\">\n          <div class=\"col ps-2 overflow-hidden\">\n            <Widget\n              src=\"mob.near/widget/N.ProfileLine\"\n              props={{\n                accountId: account_id,\n                link: false,\n                hideAccountId: true,\n                hideImage: false,\n              }}\n            />\n          </div>\n        </div>\n      );\n    }\n  );\n};\nconst titles = [\n  \"House of Merit\",\n  \"Council Of Advisors\",\n  \"Transparency Commission\",\n];\nconst votes = Object.keys(state.voters[state.accountId] ?? []).map((house) => {\n  return (\n    <div class=\"col col-4 overflow-hidden\">\n      <h5>{titles[house - 1]}</h5>\n      {getVotes(house)}\n    </div>\n  );\n});\n\nreturn (\n  <div class=\"container\">\n    <div class=\"row\">\n      <div\n        class=\"col col-3 align-self-start overflow-auto\"\n        style={{ height: \"calc(100vh - 7rem)\" }}\n      >\n        <h4>Users ({Object.keys(state.voters).length})</h4>\n        {accounts}\n      </div>\n      <div class=\"col col-9 align-self-start text-center\">\n        {state.accountId && <h4>Votes of {state.accountId}</h4>}\n        <div class=\"row text-start\">{votes}</div>\n      </div>\n    </div>\n\n    <hr />\n    <p>\n      <small>\n        Data is retrieved automatically from the NEAR Indexer with a slight\n        delay.\n      </small>\n    </p>\n  </div>\n);\n", "metadata": {"image": {"ipfs_cid": "bafkreiedpl5gnqflw2vcncf2dn7qwvnvsp3aegpwqi464mqrqgalbc3haq"}, "name": "NDC Election Votes", "tags": {"app": ""}}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/vadim.near/widget/elections", "fact_widget_deployments_id": "1689041249e4fc9308c28962a08f4dc5", "inserted_timestamp": "2023-09-08T17:42:30.875Z", "modified_timestamp": "2023-09-08T17:42:30.875Z", "__row_index": 8}