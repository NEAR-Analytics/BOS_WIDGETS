{"tx_hash": "7F9DxPG4M8i5zpVJUvR4pPEFPWHWZid2Bux9fQm7Jeo2", "action_id_social": "B4vq6tgH2DJw7BPLWBVyT7vWtV3syA7wB8JncEiiCKky-0-widget", "block_id": 110909384, "block_timestamp": "2024-01-20T22:23:44.506Z", "signer_id": "abnakore.near", "widget_name": "VoteChain", "source_code": "// Get accountId\nconst accountId = context.accountId;\n\n// All the votes\nconst [allVotes, setAllVotes] = useState([]);\n\n// Tabs\nconst [tab, setTab] = useState(props.tab ? props.tab : \"all\");\n\n// The user's watchlist\nconst [watchlist, setWatchlist] = useState([]);\n\n// Votes to be rendered on the screen\nconst [votesToRender, setVotesToRender] = useState(allVotes);\n\nuseEffect(() => {\n  // Get the only votes the user created\n  if (tab === \"my_votes\") {\n    setVotesToRender(allVotes.filter((vote) => vote.creator === accountId));\n  } else if (tab === \"watchlist\") {\n    setVotesToRender(allVotes.filter((vote) => watchlist.includes(vote.id)));\n  } else {\n    setVotesToRender(allVotes);\n  }\n}, [allVotes, tab, watchlist]);\n\n// Get all the votes\nconst votesData = Social.get(`abnakore.near/votes`);\n\nuseEffect(() => {\n  //   console.log(votesData);\n  if (votesData === undefined) {\n    // Set the candidate to an empty list if there is no candidate\n    setAllVotes([]);\n  } else {\n    setAllVotes(JSON.parse(votesData));\n  }\n  setVotesToRender(allVotes);\n  //   console.log(votesData, \"\");\n}, [votesData === null]);\n\n// Get The watchlist of the user\nconst watchlistData = Social.get(`${accountId}/voteChain_watchlist`);\n\nuseEffect(() => {\n  if (watchlistData === undefined) {\n    // Set the watchlist to an empty array\n    setWatchlist([]);\n  } else {\n    setWatchlist(JSON.parse(watchlistData));\n  }\n}, [watchlistData === null]);\n\n// Pages that can be reached via the aside tab\nconst [pages, setPage] = useState([\n  {\n    name: \"All Votes\",\n    link: \"https://near.org/abnakore.near/widget/VoteChain\",\n  },\n  {\n    name: \"My Votes\",\n    link: \"https://near.org/abnakore.near/widget/VoteChain?tab=my_votes\",\n  },\n  {\n    name: \"Watchlist\",\n    link: \"https://near.org/abnakore.near/widget/VoteChain?tab=watchlist\",\n  },\n  {\n    name: \"Create New Vote\",\n    type: \"button\",\n    link: \"https://near.org/abnakore.near/widget/CreateVote\",\n  },\n]);\n\n//  Format the date and time (January 7, 2024 at 5:57 PM)\nfunction formatDateTime(dateTimeString) {\n  // Assuming you have a date-time input with the format \"YYYY-MM-DDTHH:mm\" as a string\n  const dateTime = new Date(dateTimeString);\n\n  // Formatting the date and time in 12-hour format\n  const formattedDateTime = dateTime.toLocaleString(\"en-US\", {\n    year: \"numeric\",\n    month: \"long\",\n    day: \"numeric\",\n    hour: \"numeric\",\n    minute: \"numeric\",\n    hour12: true, // Set to true for 12-hour format\n  });\n\n  return formattedDateTime;\n}\n\nconst List = styled.div`\nwidth: calc(100vw - 20px);\nheight: 100%;\npadding: 20px 10px;\n\n@media screen and (min-width: 1200px) {\n  width: calc(100vw - 20%);\n}\n`;\nreturn (\n  <>\n    {accountId ? (\n      <Widget\n        src=\"abnakore.near/widget/Wrapper\"\n        props={{\n          body: (\n            <div className=\"main-body\">\n              <div className=\"body-contents\">\n                <div className=\"two-sides\">\n                  <Widget\n                    src=\"abnakore.near/widget/Aside\"\n                    props={{ objs: pages, active: \"/admin/manage_candidates\" }}\n                  />\n                  {votesToRender.length > 0 ? (\n                    <List>\n                      {votesToRender.map((vote) => (\n                        <a\n                          href={`https://near.org/abnakore.near/widget/App.jsx?vote=${vote.id}`}\n                        >\n                          <Widget\n                            src=\"abnakore.near/widget/VoteCard\"\n                            props={{\n                              name: vote.name,\n                              desc: vote.desc,\n                              open: formatDateTime(vote.openTime),\n                              close: formatDateTime(vote.closeTime),\n                              voted: vote.voters.includes(accountId),\n                              locked: vote.passcode && true,\n                              no_of_candidates: vote.candidates.length,\n                              style: {},\n                            }}\n                          />\n                        </a>\n                      ))}\n                    </List>\n                  ) : (\n                    <div className=\"body-contents\">\n                      <h1>No Votes</h1>\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n          ),\n        }}\n      />\n    ) : (\n      <Widget src=\"abnakore.near/widget/SignIn.jsx\" props={props} />\n    )}\n  </>\n);\n\n// // Get accountId\n// const accountId = context.accountId;\n\n// // Pages that can be reached via the aside tab\n// const [pages, setPage] = useState([\n//   {\n//     name: \"Home\",\n//     link: \"https://near.org/sandbox#/abnakore.near/widget/AdminHome\",\n//   },\n//   {\n//     name: \"Manage Candidates\",\n//     link: \"https://near.org/sandbox#/abnakore.near/widget/ManageCandidates\",\n//   },\n//   {\n//     name: \"Mange Parties\",\n//     link: \"https://near.org/sandbox#/abnakore.near/widget/ManageParties\",\n//   },\n// ]);\n// return (\n//   <>\n//     {accountId ? (\n//       <Widget\n//         src=\"abnakore.near/widget/Wrapper\"\n//         props={{\n//           body: (\n//             <div className=\"main-body\">\n//               <div className=\"body-contents\">\n//                 <div className=\"two-sides\"></div>\n//                 <Widget\n//                   src=\"abnakore.near/widget/Aside\"\n//                   props={{ objs: pages, active: \"/admin/manage_candidates\" }}\n//                 />\n//                 <div className=\"body-contents\">\n//                   <h1>...</h1>\n//                 </div>\n//               </div>\n//             </div>\n//           ),\n//         }}\n//       />\n//     ) : (\n//       <Widget src=\"abnakore.near/widget/SignIn.jsx\" props={props} />\n//     )}\n//   </>\n// );\n\n//\n// <Widget\n//   src=\"abnakore.near/widget/VoteCard\"\n//   props={{\n//     name: \"Name\",\n//     desc: \"Lorem ipsum dolor sit amet consectetur adipisicing elit. Impedit obcaecati iure rem nulla deleniti accusamus, qui, aut recusandae ut fugiat molestiae dicta asperiores, est aspernatur. Aliquid porro sed neque molestiae!\",\n//     open: \"27-03-2024 2:30PM\",\n//     close: \"27-03-2024 2:30PM\",\n//     no_of_candidates: 10,\n//     voted: true,\n//     locked: false,\n//   }}\n// />\n// <Widget\n//   src=\"abnakore.near/widget/VoteCard\"\n//   props={{\n//     name: \"Name\",\n//     desc: \"You can use the slice method along with the spread operator (...) to create a new array containing the first two items.\",\n//     open: \"27-03-2024 2:30PM\",\n//     close: \"27-03-2024 2:30PM\",\n//     no_of_candidates: 10,\n//     voted: false,\n//     locked: true,\n//   }}\n// />\n", "metadata": {"fork_of": "abnakore.near/widget/VoteChain@110908927"}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/abnakore.near/widget/VoteChain", "fact_widget_deployments_id": "8c3613337dd9db07125e4c13c5a68c26", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 26}