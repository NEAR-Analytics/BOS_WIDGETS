{"tx_hash": "8u1ms9J9mBFsumHBiQaMYRnXbkMCnBCxMLGF5hRcDdJN", "action_id_social": "2htq4jpCgEE1qKkL57bv3ctDbZXenThVKDpWzH1VfDSK-0-widget", "block_id": 100364009, "block_timestamp": "2023-09-04T08:56:43.203Z", "signer_id": "communityvoice.ndctools.near", "widget_name": "pages.feed.comments", "source_code": "const { community, postAuthor, postBlockHeight, onClose, Config, Post } = props;\n\nconst Container = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  display: grid;\n  place-items: center;\n  overflow-y: auto;\n  z-index: 1000;\n  width: 100vw;\n  height: 100vh;\n`;\nconst Overlay = styled.span`\n  position: absolute;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.7);\n  backdrop-filter: blur(6px);\n`;\n\nconst Content = styled.div`\n  position: relative;\n  z-index: 1;\n  width: 599px;\n  max-width: 90vw;\n  margin-top: 20px;\n  margin-bottom: 20px;\n  outline: none !important;\n  max-height: 90vh;\n  overflow: auto;\n\n  & .ndc-card {\n    box-shadow: none !important;\n  }\n\n  & hr {\n    opacity: 0.1;\n  }\n`;\n\nconst index = [\n  {\n    action: Config.commentDataKey,\n    key: {\n      type: \"social\",\n      path: `${postAuthor}/${Config.postDataKey}/main`,\n      blockHeight: postBlockHeight,\n    },\n    options: {\n      limit: 10,\n      order: \"desc\",\n    },\n    cacheOptions: {\n      ignoreCache: true,\n    },\n  },\n];\n\nconst handleCreateComment = (body) => {\n  Post.comment(\n    {\n      body: body,\n      type: \"md\",\n      community: community.id,\n      tags: [],\n    },\n    postAuthor,\n    postBlockHeight,\n    () => console.log(\"commented successfully\"),\n    () => console.log(\"user canceled\"),\n    (e) => console.log(\"error\", e),\n  );\n};\n\n// -- Gating based on Community Rules\nlet canComment = true;\n\nif (Array.isArray(community.rules.commenting.SBTs)) {\n  // user should have the SBTs\n  community.rules.commenting.SBTs.forEach((SBT) => {\n    const allSBTs = Near.view(Config.SBTRegistry, \"sbt_tokens_by_owner\", {\n      account: context.accountId,\n    });\n\n    if (allSBTs === null) return \"\";\n    const hasSBT = (allSBTs || []).find((s) => s[0] === SBT)[1].length > 0;\n    canComment = canComment && hasSBT;\n  });\n}\n// -- End\n\nreturn (\n  <Container>\n    <Overlay onClick={onClose} />\n    <Content className=\"rounded-4 bg-white ndc-card\">\n      <div className=\"d-flex justify-content-between p-3 w-100\">\n        <h5>Comments</h5>\n        <i\n          className=\"bi bi-x-lg h4 text-danger\"\n          role=\"button\"\n          onClick={onClose}\n        />\n      </div>\n      <Widget\n        src=\"nearui.near/widget/Social.PostCompose\"\n        props={{\n          buttonText: \"Comment\",\n          initialBody: \"\",\n          onPost: handleCreateComment,\n          disabled: !canComment,\n        }}\n      />\n      <hr />\n      <Widget\n        src=\"mob.near/widget/MergedIndexFeed\"\n        props={{\n          index,\n          renderItem: (p) => {\n            return (\n              <Widget\n                src=\"communityvoice.ndctools.near/widget/pages.feed.comment\"\n                props={{\n                  ...p,\n                  Config,\n                  Post,\n                  community,\n                }}\n              />\n            );\n          },\n        }}\n      />\n    </Content>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/communityvoice.ndctools.near/widget/pages.feed.comments", "fact_widget_deployments_id": "a1fa70835b961516f30ab11389812fed", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}