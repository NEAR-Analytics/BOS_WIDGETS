{"tx_hash": "4JQj3B6UewM4XCDXavGhCMGqTGGmcxdofkwvoPgy2xCE", "action_id_social": "2FSg7M8f5qGLPRbGA6Mnb4mybzd8xAwmXiKKCxwZryBk-0-widget", "block_id": 115691983, "block_timestamp": "2024-03-29T03:21:41.354Z", "signer_id": "communityvoice.ndctools.near", "widget_name": "NDC.UpVoteButton", "source_code": "//NDC.UpVoteButton\nconst { createUpVote, deleteUpVote } = VM.require(\"communityvoice.ndctools.near/widget/lib.upVotes\")\nconst { getConfig } = VM.require(\"communityvoice.ndctools.near/widget/config.CommunityVoice\")\n\nconst {\n  isTest,\n  authorForWidget,\n  reactedElementData,\n  widgets,\n  disabled,\n  upVotes: articleUpVotes,\n  baseActions,\n  loadUpVotes,\n  loadingUpVotes,\n  setLoadingUpVotes,\n  setUpVotes,\n} = props;\n\nconst data = reactedElementData;\n\nlet userVote = articleUpVotes? articleUpVotes.find((vote) => vote.accountId === context.accountId) : undefined;\n\nfunction getUpVoteButtonClass() {\n  if (userVote) {\n    return \"info\";\n  } else {\n    return \"info outline\";\n  }\n}\n\nfunction onCommitUpVotes() {\n  setLoadingUpVotes(true)\n  setUpVotes([])\n  setTimeout(() => {\n    loadUpVotes()\n  }, 3000);\n}\n\nfunction onCancelUpVotes() {\n  setLoadingUpVotes(false)\n}\n\nfunction handleUpVote() {\n  userVote?\n    deleteUpVote(\n      getConfig(isTest),\n      userVote.value.metadata.articleId,\n      userVote.value.metadata.id,\n      onCommitUpVotes,\n      onCancelUpVotes\n    )\n  :\n    createUpVote(\n      getConfig(isTest),\n      data.value.metadata.id,\n      data.value.metadata.author,\n      onCommitUpVotes,\n      onCancelUpVotes\n    )\n}\n\nconst IconContainer = styled.div`\n    transform: rotate(-90deg);\n  `;\n\nconst Icon = styled.i`\n    margin: 0px !important;\n  `;\n\nconst CallLibrary = styled.div`\n    display: none;\n  `;\n\n\nconst SpinnerContainer = styled.div`\n    height: 1.3rem;\n    width: 1.3rem;\n    marginTop: 2px;\n  `;  \n\nreturn (\n  <>\n    <div title={(disabled || !canLoggedUserVote) && \"You can't vote since you don't have any SBT\"}>\n      {loadingUpVotes ? \n        <Widget\n          src={widgets.views.standardWidgets.newStyledComponents.Input.Button}\n          props={{\n            children: \n              <div className=\"d-flex\">\n                <SpinnerContainer className=\"spinner-border text-secondary\" role=\"status\">\n                  <span className=\"sr-only\" title=\"Loading...\"></span>\n                </SpinnerContainer>\n              </div>,\n            size: \"sm\",\n          }}\n        />\n      :\n        <Widget\n          src={widgets.views.standardWidgets.newStyledComponents.Input.Button}\n          props={{\n            children: (\n              <div className=\"d-flex\">\n                <span>{`+${articleUpVotes.length}`}</span>\n                <IconContainer>\n                  <Icon\n                    className={`bi bi-fast-forward-fill ${\n                      (!disabled) && \"text-success\"\n                    }`}\n                  ></Icon>\n                </IconContainer>\n              </div>\n            ),\n            disabled: disabled,\n            className: `${getUpVoteButtonClass()}`,\n            size: \"sm\",\n            onClick: handleUpVote,\n          }}\n        />\n      }\n    </div>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/communityvoice.ndctools.near/widget/NDC.UpVoteButton", "fact_widget_deployments_id": "6bf110d192ba1ce36622b6c52057da5f", "inserted_timestamp": "2024-03-29T04:30:46.452Z", "modified_timestamp": "2024-03-29T04:30:46.452Z", "__row_index": 3}