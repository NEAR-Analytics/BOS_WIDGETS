{"tx_hash": "2zDCDA2w3MQa1MrRna5vZtWJwpWgu6wJxuBA1JDjXB3v", "action_id_social": "DNnsShX2KtYo849v8E6GmVLtnYXAAotNcT3SQnjF9sjJ-0-widget", "block_id": 115691901, "block_timestamp": "2024-03-29T03:19:57.070Z", "signer_id": "communityvoice.ndctools.near", "widget_name": "NDC.Forum.AllArticlesList", "source_code": "// NDC.Forum.AllArticlesList\nconst { arrayIncludesIgnoreCase } = VM.require(\"communityvoice.ndctools.near/widget/lib.strings\")\n\n//===============================================INITIALIZATION=====================================================\n\nlet {\n  isTest,\n  stateUpdate,\n  articlesToRender,\n  tabs,\n  widgets,\n  addressForArticles,\n  handleFilterArticles,\n  handleOpenArticle,\n  authorForWidget,\n  initialCreateState,\n  editArticleData,\n  handleEditArticle,\n  showCreateArticle,\n  handleShareButton,\n  handleShareSearch,\n  loggedUserHaveSbt,\n  filterBy,\n  baseActions,\n  handleOnCommitArticle,\n  sharedSearchInputValue,\n  category,\n  sharedData,\n} = props;\n\nif(!articlesToRender) return <></>\n\nconst [searchInputValue, setSearchInputValue] = useState(\n  sharedSearchInputValue ?? \"\"\n);\n\nfunction filterArticlesBySearch(articles, searchInputValue) {\n  if(!searchInputValue || searchInputValue === \"\") return articles\n  return articles.filter((article) => {\n    const { title, body } = article.value.articleData\n    const { author } = article.value.metadata\n    const arr = [ title, body, author ]\n    if (arr.some((item) => item === undefined)) return false\n    \n    return arrayIncludesIgnoreCase(arr, searchInputValue)        \n  });\n}\n\nconst articlesFilteredBySearch = filterArticlesBySearch(articlesToRender, searchInputValue);\n\nconst fiveDaysTimeLapse = 5 * 24 * 60 * 60 * 1000;\nconst newestArticlesWithUpVotes = articlesFilteredBySearch\n  .filter((article) => article.value.metadata.lastEditTimestamp > Date.now() - fiveDaysTimeLapse)\n  // .sort((a, b) => b.timeLastEdit - a.timeLastEdit);\n\nconst olderArticlesWithUpVotes = articlesFilteredBySearch\n  .filter((article) => article.value.metadata.lastEditTimestamp < Date.now() - fiveDaysTimeLapse)\n  // .sort((a, b) => b.upVotes.length - a.upVotes.length);\n\nconst sortedArticlesToRender = [\n  ...newestArticlesWithUpVotes,\n  ...olderArticlesWithUpVotes,\n];\n\n//=============================================END INITIALIZATION===================================================\n\n//===================================================CONSTS=========================================================\n\nconst AcordionContainer = styled.div`\n  --bs-accordion-border-width: 0px !important;\n`;\n\nconst NoMargin = styled.div`\n  margin: 0 0.75rem;\n`;\n\nconst AccordionBody = styled.div`\n  padding: 0;\n`;\n\nconst ArticlesListContainer = styled.div`\n  background-color: rgb(248, 248, 249);\n  margin: 0;\n`;\n\nconst CallLibrary = styled.div`\n  display: none;\n`;\n\nconst IconCursorPointer = styled.i`\n  cursor: pointer;\n`;\n\nconst ShareSearchRow = styled.div`\n  display: flex;\n  justify-content: flex-start;\n  align-content: center;\n  margin-bottom: 1rem;\n  margin-top: 1rem;\n`;\n\nconst ShareSearchText = styled.h6`\n  margin-bottom: 0;\n  margin-left: 1rem;\n  margin-right: 1rem;\n`;\n\nconst SearchResult = styled.span`\n  margin-left: 0.5rem;\n  font-size: small;\n`;\n\n//=================================================END CONSTS=======================================================\n\n//==================================================FUNCTIONS=======================================================\n\nfunction getDateLastEdit(timestamp) {\n  const date = new Date(Number(timestamp));\n  const dateString = {\n    date: date.toLocaleDateString(),\n    time: date.toLocaleTimeString(),\n  };\n  return dateString;\n}\n\nfunction handleSearch(e) {\n  setSearchInputValue(e.target.value);\n}\n\n//================================================END FUNCTIONS=====================================================\nreturn (\n  <>\n    {loggedUserHaveSbt ? (\n      <>\n        <AcordionContainer className=\"accordion\" id=\"accordionExample\">\n          <NoMargin className=\"accordion-item\">\n            <h2 className=\"accordion-header\" id=\"headingOne\">\n              <button\n                className=\"accordion-button collapsed border border-2\"\n                type=\"button\"\n                data-bs-toggle=\"collapse\"\n                data-bs-target=\"#collapseOne\"\n                aria-expanded=\"true\"\n                aria-controls=\"collapseOne\"\n              >\n                <h6 className=\"m-0\">+ Create post</h6>\n              </button>\n            </h2>\n            <div\n              id=\"collapseOne\"\n              className=\"accordion-collapse collapse\"\n              aria-labelledby=\"headingOne\"\n              data-bs-parent=\"#accordionExample\"\n            >\n              <AccordionBody className=\"accordion-body\">\n                <Widget\n                  src={widgets.views.editableWidgets.create}\n                  props={{\n                    isTest,\n                    addressForArticles,\n                    authorForWidget,\n                    stateUpdate,\n                    widgets,\n                    initialCreateState,\n                    editArticleData,\n                    handleFilterArticles,\n                    handleEditArticle,\n                    initialBody: \"\",\n                    canLoggedUserCreateArticles: loggedUserHaveSbt,\n                    baseActions,\n                    handleOnCommitArticle,\n                    category\n                  }}\n                />\n              </AccordionBody>\n            </div>\n          </NoMargin>\n        </AcordionContainer>\n      </>\n    ) : (\n      <h6>You can't post since you don't own any SBT</h6>\n    )}\n    <Widget\n      src={widgets.views.standardWidgets.styledComponents}\n      props={{\n        Input: {\n          label: \"Search\",\n          value: searchInputValue,\n          type: \"text\",\n          placeholder: \"You can search by title, content or author\",\n          handleChange: handleSearch,\n        },\n      }}\n    />\n    {searchInputValue &&\n      searchInputValue !== \"\" &&\n      sortedArticlesToRender.length > 0 && (\n        <SearchResult className=\"text-secondary\">\n          {`Found ${sortedArticlesToRender.length} articles searching for \"${searchInputValue}\"`}\n        </SearchResult>\n      )}\n    <ShareSearchRow>\n      <ShareSearchText>Share search</ShareSearchText>\n      <Widget\n        src={widgets.views.standardWidgets.newStyledComponents.Input.Button}\n        props={{\n          size: \"sm\",\n          className: \"info outline icon\",\n          children: <i className=\"bi bi-share\"></i>,\n          onClick: () => handleShareSearch(true, searchInputValue),\n        }}\n      />\n    </ShareSearchRow>\n    <h5>Previous articles will be loaded in the following days</h5>\n    <NoMargin>\n      {filterBy.parameterName === \"tag\" && (\n        <div className=\"mt-3\">\n          <h6>Filter by tag:</h6>\n          <div className=\"d-flex align-items-center \">\n            <Widget\n              src={\n                widgets.views.standardWidgets.newStyledComponents.Element.Badge\n              }\n              props={{\n                children: filterBy.parameterValue,\n                variant: \"round info\",\n                size: \"lg\",\n              }}\n            />\n            <IconCursorPointer\n              className=\"bi bi-x\"\n              onClick={() => handleFilterArticles({ filterBy: \"\", value: \"\" })}\n            ></IconCursorPointer>\n          </div>\n        </div>\n      )}\n      <ArticlesListContainer className=\"row card-group py-3\">\n        {sortedArticlesToRender.length > 0 ? (\n          sortedArticlesToRender.map((article, i) => {\n            const authorProfileCall = Social.getr(\n              `${article.value.metadata.author}/profile`\n            );\n\n            if (authorProfileCall) {\n              article.authorProfile = authorProfileCall;\n            }\n\n            // If some widget posts data different than an array it will be ignored\n            if (!Array.isArray(article.value.articleData.tags))\n              article.value.articleData.tags = [];\n            return (\n              <div key={article.value.metadata.id}>\n                <Widget\n                  src={widgets.views.editableWidgets.generalCard}\n                  props={{\n                    widgets,\n                    isTest,\n                    data: article,\n                    displayOverlay: true,\n                    renderReactions: true,\n                    addressForArticles,\n                    handleOpenArticle,\n                    handleFilterArticles,\n                    authorForWidget,\n                    handleShareButton,\n                    handleEditArticle,\n                    baseActions,\n                    loggedUserHaveSbt\n                  }}\n                />\n              </div>\n            );\n          })\n        ) : (\n          <h5>{`No articles ${\n            searchInputValue !== \"\"\n              ? `have been found searching for ${searchInputValue}`\n              : \"uploaded yet\"\n          }`}</h5>\n        )}\n      </ArticlesListContainer>\n    </NoMargin>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/communityvoice.ndctools.near/widget/NDC.Forum.AllArticlesList", "fact_widget_deployments_id": "faaed82c3d5e42fb8743a024a70cb65a", "inserted_timestamp": "2024-03-29T04:30:46.452Z", "modified_timestamp": "2024-03-29T04:30:46.452Z", "__row_index": 2}