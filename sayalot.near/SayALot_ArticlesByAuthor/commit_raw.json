{"tx_hash": "A8bXP5UxYSCHHNHhKEJ3KNe1wUwJikgkJU871kt7rSYC", "action_id_social": "87hZJu3fpbcWXbTLCAens593Z9o4UbogwLTxD3DVu8BP-0-widget", "block_id": 96415746, "block_timestamp": "2023-07-14T00:59:30.194Z", "signer_id": "sayalot.near", "widget_name": "SayALot_ArticlesByAuthor", "source_code": "const addressForArticles = \"sayALotArticle\";\r\nconst authorForWidget = \"sayalot.near\";\r\nconst tagSelected = props.tag;\r\nconst accountId = props.accountId ?? context.accountId;\r\nif (!accountId) {\r\n  return \"No account ID\";\r\n}\r\nconst profile = props.profile ?? Social.getr(`${accountId}/profile`);\r\nif (profile === null) {\r\n  return \"Loading\";\r\n}\r\n\r\nconst getDateLastEdit = (timestamp) => {\r\n  const date = new Date(Number(timestamp));\r\n  const dateString = `${date.toLocaleDateString()} / ${date.toLocaleTimeString()}`;\r\n  return dateString;\r\n};\r\n\r\nconst articleBlackList = [\r\n  91092435, 91092174, 91051228, 91092223, 91051203, 96414482, 96402919,\r\n  96402330, 96401880, 96412953, 96412953, 95766840, 95413943,\r\n];\r\n\r\n// ========== GET INDEX ARRAY FOR ARTICLES ==========\r\nconst postsIndex = Social.index(addressForArticles, \"main\", {\r\n  order: \"desc\",\r\n  accountId: undefined,\r\n});\r\n// ========== GET ALL ARTICLES ==========\r\nconst resultArticles =\r\n  postsIndex &&\r\n  postsIndex\r\n    .reduce((acc, { accountId, blockHeight }) => {\r\n      const postData = Social.get(\r\n        `${accountId}/${addressForArticles}/main`,\r\n        blockHeight\r\n      );\r\n      const postDataWithBlockHeight = { ...JSON.parse(postData), blockHeight };\r\n      return [...acc, postDataWithBlockHeight];\r\n    }, [])\r\n    .filter((article) => !articleBlackList.includes(article.blockHeight));\r\n// ========== FILTER DUBLICATES ==========\r\nconst filteredArticles =\r\n  resultArticles.length &&\r\n  resultArticles.reduce((acc, article) => {\r\n    if (!acc.some(({ articleId }) => articleId === article.articleId)) {\r\n      return [...acc, article];\r\n    } else {\r\n      return acc;\r\n    }\r\n  }, []);\r\n\r\nconst filteredArticlesByTag =\r\n  filteredArticles.length &&\r\n  filteredArticles.reduce((acc, article) => {\r\n    if (article.tags && article.tags.includes(tagSelected)) {\r\n      console.log(article);\r\n      return [...acc, article];\r\n    } else {\r\n      return acc;\r\n    }\r\n  }, []);\r\n\r\nreturn (\r\n  <>\r\n    <Widget\r\n      src={`${authorForWidget}/widget/SayALot_MainNavigation`}\r\n      props={{ currentNavPill: \"articles\" }}\r\n    />\r\n    <div>\r\n      Tag:\r\n      {tagSelected}\r\n    </div>\r\n    <ol>\r\n      {filteredArticlesByTag &&\r\n        filteredArticlesByTag.map((article, index) => (\r\n          <li key={article.articleId}>\r\n            <a\r\n              href={`#/${authorForWidget}/widget/SayALot_OneArticle?articleId=${article.articleId}&blockHeight=${article.blockHeight}&lastEditor=${article.lastEditor}\r\n            `}\r\n            >\r\n              {article.articleId}{\" \"}\r\n              <small>\r\n                (last edited:\r\n                {getDateLastEdit(article.timeLastEdit)})\r\n              </small>\r\n            </a>\r\n            <Widget\r\n              src={`${authorForWidget}/widget/SayALot_TagList`}\r\n              props={{ tags: article.tags }}\r\n            />\r\n          </li>\r\n        ))}\r\n    </ol>\r\n  </>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/sayalot.near/widget/SayALot_ArticlesByAuthor", "fact_widget_deployments_id": "fb8891c05838405c6489733312e7a753", "inserted_timestamp": "2000-01-01T00:00:00.000Z", "modified_timestamp": "2000-01-01T00:00:00.000Z", "__row_index": 7}