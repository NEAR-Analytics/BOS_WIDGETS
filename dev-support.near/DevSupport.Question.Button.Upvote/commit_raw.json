{"tx_hash": "DGHTv7Wgrzz9PRhTmmnZBpnJr2w4jCzrHPFMLrZAz2N7", "action_id_social": "G5DuTjMN1N37WZvhEzRFEMZmYVQqak2tqywhS9cZWTbX-0-widget", "block_id": 90199792, "block_timestamp": "2023-04-22T21:40:47.113Z", "signer_id": "dev-support.near", "widget_name": "DevSupport.Question.Button.Upvote", "source_code": "const accountId = props.accountId;\nconst blockHeight = props.blockHeight;\n\nif (accountId === undefined || blockHeight === undefined) {\n  return;\n}\n\nconst item = {\n  accountId,\n  blockHeight,\n};\n\nconst likes = Social.index(\"upvote\", item, { subscribe: true });\n\nconst dataLoading = likes === null;\n\nlet upvotes = 0;\nlet downvotes = 0;\n\n(likes || []).forEach((like) => {\n  if (like.value.type === \"upvote\") {\n    upvotes += 1;\n  }\n  if (like.value.type === \"downvote\") {\n    downvotes += 1;\n  }\n});\n\n// state.hasLike === true\n\n// const hasLike = context.accountId && !!likesByUsers[context.accountId];\n\nconst likeClick = () => {\n  if (state.loading) {\n    return;\n  }\n  State.update({\n    loading: true,\n  });\n  const data = {\n    index: {\n      upvote: JSON.stringify({\n        key: item,\n        value: {\n          type: hasLike ? \"downvote\" : \"upvote\",\n        },\n      }),\n    },\n  };\n\n  if (!hasLike && props.notifyAccountId) {\n    data.index.notify = JSON.stringify({\n      key: props.notifyAccountId,\n      value: {\n        type: \"upvote\",\n        item,\n      },\n    });\n  }\n  Social.set(data, {\n    onCommit: () => State.update({ loading: false, hasLike: !hasLike }),\n    onCancel: () => State.update({ loading: false }),\n  });\n};\n\nconst Button = styled.button`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  background: transparent;\n  border: 1px solid #DFE3E6;\n  border-radius: 50px;\n  color: #687076;\n  padding: 8px 12px 12px;\n  transition: all .15s ease;\n\n  &:hover {\n    color: #30A46C;\n    border-color: #30A46C;\n  }\n`;\n\nreturn (\n  <div className=\"d-inline-flex\">\n    <Button\n      disabled={state.loading || dataLoading || !context.accountId}\n      onClick={likeClick}\n    >\n      {state.loading || dataLoading ? (\n        <span\n          class=\"spinner-grow spinner-grow-sm p-2\"\n          role=\"status\"\n          aria-hidden=\"true\"\n        />\n      ) : (\n        <i class=\"bi bi-caret-up-fill\" />\n      )}\n      {upvotes}\n    </Button>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/dev-support.near/widget/DevSupport.Question.Button.Upvote", "fact_widget_deployments_id": "69faa4353fa77306c07f6f31d21dbb6b", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 9}