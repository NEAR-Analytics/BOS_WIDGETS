{"tx_hash": "FJUwhQT5sc37HgiHP9wBfsLmYbb5PCq8TtG7oW59X9cV", "action_id_social": "FAU1p37moYaLyBkoehwUg67Qet57WYDc1uLPrwjwLiQk-0-widget", "block_id": 114609305, "block_timestamp": "2024-03-13T05:28:40.623Z", "signer_id": "nearblocks.near", "widget_name": "bos-components.components.Comments.Feed", "source_code": "/**\n * Component: CommentsFeed\n * Author: Nearblocks Pte Ltd\n * License: Business Source License 1.1\n * Description: The component enables users to view and interact with comments.\n * @interface Props\n * @param {string} [network] - The network data to show, either mainnet or testnet\n * @param {string} [path] - The path identifier passed as a string.\n * @param {number} [limit] - The maximum number of comments to display.\n */\n\n/* INCLUDE: \"includes/libs.jsx\" */\nfunction getConfig(network) {\n  switch (network) {\n    case 'mainnet':\n      return {\n        ownerId: 'nearblocks.near',\n        nodeUrl: 'https://rpc.mainnet.near.org',\n        backendUrl: 'https://api3.nearblocks.io/v1/',\n        rpcUrl: 'https://archival-rpc.mainnet.near.org',\n        appUrl: 'https://nearblocks.io/',\n      };\n    case 'testnet':\n      return {\n        ownerId: 'nearblocks.testnet',\n        nodeUrl: 'https://rpc.testnet.near.org',\n        backendUrl: 'https://api3-testnet.nearblocks.io/v1/',\n        rpcUrl: 'https://archival-rpc.testnet.near.org',\n        appUrl: 'https://testnet.nearblocks.io/',\n      };\n    default:\n      return {};\n  }\n}\n\nfunction debounce(\n  delay,\n  func,\n) {\n  let timer;\n  let active = true;\n  const debounced = (arg) => {\n    if (active) {\n      clearTimeout(timer);\n      timer = setTimeout(() => {\n        active && func(arg);\n        timer = undefined;\n      }, delay);\n    } else {\n      func(arg);\n    }\n  };\n\n  debounced.isPending = () => {\n    return timer !== undefined;\n  };\n\n  debounced.cancel = () => {\n    active = false;\n  };\n\n  debounced.flush = (arg) => func(arg);\n\n  return debounced;\n}\n\nfunction timeAgo(unixTimestamp) {\n  const currentTimestamp = Math.floor(Date.now() / 1000);\n  const secondsAgo = currentTimestamp - unixTimestamp;\n\n  if (secondsAgo < 5) {\n    return 'Just now';\n  } else if (secondsAgo < 60) {\n    return `${secondsAgo} seconds ago`;\n  } else if (secondsAgo < 3600) {\n    const minutesAgo = Math.floor(secondsAgo / 60);\n    return `${minutesAgo} minute${minutesAgo > 1 ? 's' : ''} ago`;\n  } else if (secondsAgo < 86400) {\n    const hoursAgo = Math.floor(secondsAgo / 3600);\n    return `${hoursAgo} hour${hoursAgo > 1 ? 's' : ''} ago`;\n  } else {\n    const daysAgo = Math.floor(secondsAgo / 86400);\n    return `${daysAgo} day${daysAgo > 1 ? 's' : ''} ago`;\n  }\n}\n\nfunction shortenAddress(address) {\n  const string = String(address);\n\n  if (string.length <= 20) return string;\n\n  return `${string.substr(0, 10)}...${string.substr(-7)}`;\n}\n\nfunction urlHostName(url) {\n  try {\n    const domain = new URL(url);\n    return domain?.hostname ?? null;\n  } catch (e) {\n    return null;\n  }\n}\n\nfunction holderPercentage(supply, quantity) {\n  return Math.min(Big(quantity).div(Big(supply)).mul(Big(100)).toFixed(2), 100);\n}\n\nfunction isAction(type) {\n  const actions = [\n    'DEPLOY_CONTRACT',\n    'TRANSFER',\n    'STAKE',\n    'ADD_KEY',\n    'DELETE_KEY',\n    'DELETE_ACCOUNT',\n  ];\n\n  return actions.includes(type.toUpperCase());\n}\n\nfunction isJson(string) {\n  const str = string.replace(/\\\\/g, '');\n\n  try {\n    JSON.parse(str);\n    return false;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction uniqueId() {\n  return Math.floor(Math.random() * 1000);\n}\nfunction handleRateLimit(\n  data,\n  reFetch,\n  Loading,\n) {\n  if (data.status === 429 || data.status === undefined) {\n    const retryCount = 4;\n    const delay = Math.pow(2, retryCount) * 1000;\n    setTimeout(() => {\n      reFetch();\n    }, delay);\n  } else {\n    if (Loading) {\n      Loading();\n    }\n  }\n}\nfunction localFormat(number) {\n  const bigNumber = Big(number);\n  const formattedNumber = bigNumber\n    .toFixed(5)\n    .replace(/(\\d)(?=(\\d{3})+\\.)/g, '$1,'); // Add commas before the decimal point\n  return formattedNumber.replace(/\\.?0*$/, ''); // Remove trailing zeros and the dot\n}\nfunction formatWithCommas(number) {\n  return number.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n}\n/* END_INCLUDE: \"includes/libs.jsx\" */\n\n\n\n\n\n\n\nfunction MainComponent(props) {\n  const [content, setContent] = useState('');\n  const config = getConfig(props.network);\n  const path = props.path;\n  const index = {\n    action: 'post',\n    key: path,\n    options: {\n      limit: props.limit ?? 3,\n      order: 'desc',\n      subscribe: true,\n      accountId: context.accountId,\n    },\n  };\n  const composeData = () => {\n    const data = {\n      index: {\n        post: JSON.stringify({\n          key: path,\n          value: {\n            type: 'md',\n            post: content,\n          },\n        }),\n      },\n    };\n\n    return data;\n  };\n  const onChange = (newContent\n\n) => {\n    setContent(newContent.content);\n  };\n\n  const renderItem = (item\n\n\n\n) =>\n    item.value.type === 'md' && (\n      <div key={JSON.stringify(item)} className=\"\">\n        <Widget\n          src={`${config.ownerId}/widget/bos-components.components.Comments.Comment`}\n          props={{\n            accountId: item.accountId,\n            blockHeight: item.blockHeight,\n            ownerId: config.ownerId,\n            post: item.value.post,\n          }}\n        />\n      </div>\n    );\n\n  return (\n    <>\n      <div className=\"border-b\">\n        {\n          <Widget\n            src={`${config.ownerId}/widget/bos-components.components.Comments.InputField`}\n            props={{\n              onChange: onChange,\n              composeButton: (onCompose) => (\n                <CommitButton\n                  disabled={!content}\n                  force\n                  className=\"btn-primary rounded-5\"\n                  data={composeData}\n                  onCommit={() => {\n                    onCompose();\n                  }}\n                >\n                  <Tooltip.Provider>\n                    <Tooltip.Root>\n                      <Tooltip.Trigger asChild>\n                        <button\n                          type=\"submit\"\n                          disabled={!content}\n                          className=\"inline-flex justify-center p-2 text-green-500  rounded-full cursor-pointer hover:bg-neargray-800\"\n                        >\n                          <svg\n                            className=\"w-5 h-5 rotate-90 rtl:-rotate-90\"\n                            aria-hidden=\"true\"\n                            xmlns=\"http://www.w3.org/2000/svg\"\n                            fill=\"currentColor\"\n                            viewBox=\"0 0 18 20\"\n                          >\n                            <path d=\"m17.914 18.594-8-18a1 1 0 0 0-1.828 0l-8 18a1 1 0 0 0 1.157 1.376L8 18.281V9a1 1 0 0 1 2 0v9.281l6.758 1.689a1 1 0 0 0 1.156-1.376Z\" />\n                          </svg>\n                        </button>\n                      </Tooltip.Trigger>\n                      {!context.accountId && (\n                        <Tooltip.Content\n                          className=\" h-auto max-w-xs bg-black bg-opacity-90 z-10 text-xs text-white px-3 py-2 \"\n                          align=\"start\"\n                          side=\"bottom\"\n                        >\n                          {'Please LogIn'}\n                        </Tooltip.Content>\n                      )}\n                    </Tooltip.Root>\n                  </Tooltip.Provider>\n                </CommitButton>\n              ),\n            }}\n          />\n        }\n      </div>\n      <ScrollArea.Root className=\"w-full rounded overflow-hidden bg-white\">\n        <ScrollArea.Viewport className=\"w-full max-h-screen rounded\">\n          <div className=\"px-3 pb-2\">\n            {\n              <Widget\n                src={`${config.ownerId}/widget/bos-components.components.Comments.List`}\n                props={{\n                  index,\n                  renderItem,\n                  nextLimit: 10,\n                  loadMoreText: 'Show earlier comments...',\n                }}\n              />\n            }\n          </div>\n        </ScrollArea.Viewport>\n        <ScrollArea.Scrollbar\n          className=\"flex select-none touch-none p-0.5 bg-neargray-25 transition-colors duration-[160ms] ease-out hover:bg-neargray-25 data-[orientation=vertical]:w-2.5 data-[orientation=horizontal]:flex-col data-[orientation=horizontal]:h-2.5\"\n          orientation=\"vertical\"\n        >\n          <ScrollArea.Thumb className=\"flex-1 bg-neargray-50 rounded-[10px] relative before:content-[''] before:absolute before:top-1/2 before:left-1/2 before:-translate-x-1/2 before:-translate-y-1/2 before:w-full before:h-full before:min-w-[44px] before:min-h-[44px]\" />\n        </ScrollArea.Scrollbar>\n        <ScrollArea.Scrollbar\n          className=\"flex select-none touch-none p-0.5 bg-neargray-25 transition-colors duration-[160ms] ease-out hover:bg-neargray-25 data-[orientation=vertical]:w-2.5 data-[orientation=horizontal]:flex-col data-[orientation=horizontal]:h-2.5\"\n          orientation=\"horizontal\"\n        >\n          <ScrollArea.Thumb className=\"flex-1 bg-neargray-50 rounded-[10px] relative before:content-[''] before:absolute before:top-1/2 before:left-1/2 before:-translate-x-1/2 before:-translate-y-1/2 before:w-full before:h-full before:min-w-[44px] before:min-h-[44px]\" />\n        </ScrollArea.Scrollbar>\n        <ScrollArea.Corner className=\"bg-neargray-50\" />\n      </ScrollArea.Root>\n    </>\n  );\n}\n\nreturn MainComponent(props, context);", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/nearblocks.near/widget/bos-components.components.Comments.Feed", "fact_widget_deployments_id": "22ea49877a8827fb6ec7823365a120de", "inserted_timestamp": "2024-03-13T06:27:24.035Z", "modified_timestamp": "2024-03-13T07:26:06.246Z", "__row_index": 0}