{"tx_hash": "J7oXwivE5Dk2p7w7ubRqGid8La7be6Hsi29PEv5H2Mfj", "action_id_social": "6sNFgdyKjxFEmumQ8V1noB9rGwcRFh33R4zdSpV7qsv8-0-widget", "block_id": 98305043, "block_timestamp": "2023-08-07T23:07:35.800Z", "signer_id": "kudos.ndctools.near", "widget_name": "NDC.Kudos.Kudo.Page", "source_code": "const { kudoId, accountId } = props;\n\nconst kudosContract = \"kudos.ndctools.near\";\nconst registryContract = \"registry.i-am-human.near\";\n\nconst widgets = {\n  header: \"kudos.ndctools.near/widget/NDC.Kudos.Header\",\n  navigation: \"kudos.ndctools.near/widget/NDC.Kudos.Navigation\",\n  card: \"kudos.ndctools.near/widget/NDC.Kudos.Card\",\n  commentCard: \"kudos.ndctools.near/widget/NDC.Kudos.CommentCard\",\n  styledComponents: \"nomination.ndctools.near/widget/NDC.StyledComponents\",\n  addKudo: \"kudos.ndctools.near/widget/NDC.Kudos.AddKudo\",\n  back: \"#/kudos.ndctools.near/widget/NDC.Kudos.Main\",\n};\n\nState.init({\n  kudo: null,\n  isIAmHuman: false,\n  isOpen: false,\n  kind: \"\",\n});\n\nlet kudo = Social.getr(`${kudosContract}/kudos/${accountId}/${kudoId}`);\n\nkudo = {\n  created_at: kudo.created_at,\n  icon: kudo.icon,\n  kind: kudo.kind,\n  message: kudo.message,\n  sender_id: kudo.sender_id,\n  receiver_id: accountId,\n  tags: kudo.tags,\n  id: kudoId,\n  comments: kudo.comments ? Object.entries(kudo.comments) : [],\n  upvotes: kudo.upvotes ? Object.keys(kudo.upvotes).length : 0,\n};\n\nconsole.log(\"kudo\", kudo);\n\nconst isHuman = Near.view(registryContract, \"is_human\", {\n  account: context.accountId,\n});\n\nState.update({ isIAmHuman: isHuman[0][1].length > 0 });\n\nconst BackLink = styled.a`\n  color: black;\n  font-weight: 600;\n\n  &:hover {\n    text-decoration: none;\n    color: black;\n  }\n`;\n\nconst Container = styled.div`\n  margin: 20px 0;\n`;\n\nconst CenterSection = styled.div`\n  padding: 0;\n  @media (max-width: 768px) {\n    margin: 20px 0;\n  }\n`;\n\nconst Section = styled.div`\n  padding: 20px;\n  background: #f8f8f9;\n  border-radius: 10px;\n`;\n\nconst H5 = styled.h5`\n  margin-bottom: 20px;\n`;\n\nconst FilterButtonContainer = styled.div`\n  width: 340px;\n\n  @media only screen and (max-width: 1061px) {\n    width: 100%;\n  }\n`;\n\nconst Filter = styled.div`\n  margin-top: 20px;\n  padding: 16px;\n  background: #f8f8f9;\n  border-radius: 8px;\n\n  @media only screen and (max-width: 1061px) {\n    flex-direction: column;\n  }\n`;\n\nconst ComponentWrapper = styled.div`\n  position: absolute;\n  width: 100%;\n  z-index: 100;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n`;\n\nconst KudoTitle = styled.h5`\n  padding-bottom: 10px;\n\n  @media (max-width: 768px) {\n    display: none;\n  }\n`;\n\nconst CommentTitle = styled.h5`\n  padding-bottom: 10px;\n`;\n\nconst base64decode = (encodedValue) => {\n  let buff = Buffer.from(encodedValue, \"base64\");\n  return JSON.parse(buff.toString(\"utf-8\"));\n};\n\nreturn (\n  <div>\n    <Widget src={widgets.header} props={{ isIAmHuman: state.isIAmHuman }} />\n    {state.isIAmHuman && (\n      <Filter className=\"d-flex justify-content-end gap-2\">\n        <FilterButtonContainer className=\"d-flex gap-2\">\n          <Widget\n            src={widgets.styledComponents}\n            disabled={!state.isIAmHuman}\n            props={{\n              Button: {\n                text: \"Give a Kudo\",\n                className: \"primary justify-content-center w-100\",\n                image: {\n                  url: \"https://bafkreieynbjyuycbo7naqp5dtiajcsmpiwyt7n2mk35746463nkcjte2yy.ipfs.nftstorage.link/\",\n                },\n                onClick: () => State.update({ isOpen: true, kind: \"k\" }),\n              },\n            }}\n          />\n          <Widget\n            src={widgets.styledComponents}\n            disabled={!state.isIAmHuman}\n            props={{\n              Button: {\n                text: \"Give a Ding\",\n                className: \"justify-content-center w-100 primary danger\",\n                image: {\n                  url: \"https://bafkreigkzvete56d25gwabrb3msxegxley4t6csppqdik4mh45amimjubq.ipfs.nftstorage.link/\",\n                },\n                onClick: () => State.update({ isOpen: true, kind: \"d\" }),\n              },\n            }}\n          />\n        </FilterButtonContainer>\n\n        {state.isOpen && (\n          <Widget\n            src={widgets.addKudo}\n            props={{\n              onHide: () => State.update({ isOpen: false }),\n              kind: state.kind,\n            }}\n          />\n        )}\n      </Filter>\n    )}\n    <Container className=\"d-flex row\">\n      <CenterSection className=\"w-100\">\n        <BackLink href={widgets.back}>\n          <i className=\"bi bi-chevron-left mr-2\" />\n          <span>Back</span>\n        </BackLink>\n        <div className=\"d-flex flex-wrap mt-4 gap-2\">\n          <Section className=\"col p-3\">\n            <KudoTitle>Kudo</KudoTitle>\n            <Widget\n              src={widgets.card}\n              props={{\n                isIAmHuman: state.isIAmHuman,\n                kudosContract,\n                kudo,\n                hideMintBtn: true,\n                inverseColor: true,\n              }}\n            />\n          </Section>\n          <Section className=\"col p-3\">\n            <CommentTitle>Comments ({kudo.comments.length})</CommentTitle>\n            <div className=\"d-flex flex-column gap-3\">\n              {kudo.comments.map(([id, comment]) => (\n                <>\n                  {console.log(base64decode(comment).m.replace(/\\/\\/n/, \"\\n\"))}\n                  <Widget\n                    src={widgets.commentCard}\n                    props={{\n                      isIAmHuman: state.isIAmHuman,\n                      kudosContract,\n                      kudo: {\n                        id: kudoId,\n                        receiver_id: accountId,\n                      },\n                      comment: {\n                        id,\n                        parent_comment: kudo.comments.find(\n                          ([id, _comment]) => id === base64decode(comment).p\n                        )[1],\n                        owner_id: base64decode(comment).s,\n                        created_at: base64decode(comment).t,\n                        message: base64decode(comment).m,\n                      },\n                    }}\n                  />\n                </>\n              ))}\n            </div>\n          </Section>\n        </div>\n      </CenterSection>\n    </Container>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/kudos.ndctools.near/widget/NDC.Kudos.Kudo.Page", "fact_widget_deployments_id": "f483caeafa506309679d2bf4fdb2f747", "inserted_timestamp": "2023-08-08T00:25:19.287Z", "modified_timestamp": "2023-08-08T00:25:19.287Z", "__row_index": 8}