{"tx_hash": "GrDYoi9PFF9aoGPYFBhF89QQ7A4cFhVb2DfgBYTjgWfF", "action_id_social": "EfeKxBjtbS1K6i3hg9xHJAikqFJWQMSuNWn5dqJnZVJg-0-widget", "block_id": 105285535, "block_timestamp": "2023-11-09T09:44:27.251Z", "signer_id": "syi216.near", "widget_name": "PoR-MainScreen", "source_code": "//Validaciones lado front\nconst nftContract = \"proof-of-reputation.near\";\nState.init({\n  metaComplete: null,\n  ndcComplete: null,\n  nftsUser: null,\n  completedQuests: [],\n  questClaimed: [],\n});\n\nconst questList = [\n  {\n    id: 0,\n    img: \"QmSt8ngyrTE6JG5gwPRNsHK3VkVMv5MZf4z2d8usGoCgNg\",\n    title: \"I'm Human\",\n    description: \"Identify yourself as a human in the I am human app.\",\n    points: 40,\n    task: \"https://i-am-human.app/\",\n  },\n  {\n    id: 1,\n    img: \"bafkreicy5xyuftll33aoxx2nn2whbaapttc2ank6okosri52qjc3tiktvm\",\n    title: \"I've stNEAR\",\n    description: \"Stake NEAR in metapool to get stNEAR.\",\n    points: 15,\n    task: \"https://www.metapool.app/stake?token=near\",\n  },\n  {\n    id: 2,\n    img: \"bafkreihmvm6leueepchub6fx7yfntubm42otfodilbosnevsd4q32dgu5i\",\n    title: \"I've META\",\n    description: \"Get META token in your account.\",\n    points: 15,\n    task: \"https://www.metapool.app/stake?token=near\",\n  },\n  {\n    id: 3,\n    img: \"QmZ17TnjJZEGDn1ZpjTr7cMivdxBAPWFuJhpTsm1sZr3LE\",\n    title: \"I've power\",\n    description: \"Get voting power on the metapool page.\",\n    points: 30,\n    task: \"https://www.metapool.app/myvotes\",\n  },\n];\n\nconst claimedCard = (data) => (\n  <div\n    class=\"bg-secondary bg-opacity-50 rounded-4 shadow p-3 \"\n    style={{ width: \"260px\" }}\n  >\n    <img\n      src={`https://ipfs.near.social/ipfs/${data.img}`}\n      style={{ height: \"200px\", width: \"100%\", \"object-fit\": \"cover\" }}\n      class=\"rounded-2 mx-auto\"\n    />\n    <div class=\"pt-3 fw-bold\">{data.title}</div>\n    <div class=\"fw-light\" style={{ \"font-size\": \"14px\", height: \"50px\" }}>\n      {data.description}\n    </div>\n    <div class=\" pt-4 d-flex justify-content-between\">\n      <p class=\"fw-semibold my-auto\">{data.points} Points</p>\n      <button disabled class=\"btn btn btn-secondary\">\n        Claimed\n      </button>\n    </div>\n  </div>\n);\n\nconst unclaimedCard = (data) => (\n  <div\n    class=\"bg-secondary bg-opacity-25 rounded-4 shadow p-3\"\n    style={{ width: \"260px\" }}\n  >\n    <img\n      src={`https://ipfs.near.social/ipfs/${data.img}`}\n      style={{\n        height: \"200px\",\n        width: \"100%\",\n        \"object-fit\": \"cover\",\n        filter: \"grayscale(90%)\",\n      }}\n      class=\"rounded-2 mx-auto\"\n    />\n    <div class=\"pt-3 fw-bold\">{data.title}</div>\n    <div class=\"fw-light\" style={{ \"font-size\": \"14px\", height: \"50px\" }}>\n      {data.description}\n    </div>\n    <div class=\" pt-4 d-flex justify-content-between\">\n      <p class=\"fw-semibold my-auto\">{data.points} Points</p>\n      <button\n        onClick={() => {\n          mintQuest(data.id);\n        }}\n      >\n        Claim\n      </button>\n    </div>\n  </div>\n);\n\nconst incompleteCard = (data) => (\n  <div\n    class=\"bg-secondary bg-opacity-25 rounded-4 shadow p-3\"\n    style={{ width: \"260px\" }}\n  >\n    <img\n      src={`https://ipfs.near.social/ipfs/${data.img}`}\n      style={{\n        height: \"200px\",\n        width: \"100%\",\n        \"object-fit\": \"cover\",\n        filter: \"grayscale(90%)\",\n      }}\n      class=\"rounded-2\"\n    />\n    <div class=\"pt-3 fw-bold\">{data.title}</div>\n    <div class=\"fw-light\" style={{ \"font-size\": \"14px\", height: \"50px\" }}>\n      {data.description}\n    </div>\n    <div class=\" pt-4 d-flex justify-content-between\">\n      <p class=\"fw-semibold my-auto\">{data.points} Points</p>\n      <OverlayTrigger\n        key={placement}\n        placement={\"top\"}\n        overlay={<Tooltip id={`tooltip-top`}>Go to do the quest</Tooltip>}\n      >\n        <a class=\"btn btn-outline-primary\" href={data.task}>\n          Incomplete\n        </a>\n      </OverlayTrigger>\n    </div>\n  </div>\n);\n\n//I'm human\nconst verifyNDC = () => {\n  const registryContract = \"registry.i-am-human.near\";\n  const isHuman = Near.view(registryContract, \"is_human\", {\n    account: context.accountId,\n  });\n  let string = \"\";\n  if (isHuman[0][1].length > 0) {\n    string = string + \"0,\";\n    State.update({\n      ndcComplete: string,\n      profile: Social.getr(`${context.accountId}/profile`),\n    });\n  }\n};\n\n//Verificar metapool\nconst verifyMetapool = () => {\n  const stNearContract = \"meta-pool.near\";\n  const metaContract = \"meta-token.near\";\n  const metaVoteContract = \"meta-vote.near\";\n  const sTNearBalance = Near.view(stNearContract, \"ft_balance_of\", {\n    account_id: context.accountId,\n  });\n  const metaBalance = Near.view(metaContract, \"ft_balance_of\", {\n    account_id: context.accountId,\n  });\n  const votingBalance = Near.view(metaVoteContract, \"get_locked_balance\", {\n    voter_id: context.accountId,\n  });\n\n  let strings = \"\";\n  if (sTNearBalance > 0) {\n    strings = strings + \"1,\";\n  }\n  if (metaBalance > 0) {\n    strings = strings + \"2,\";\n  }\n  if (votingBalance > 0) {\n    strings = strings + \"3,\";\n  }\n  State.update({\n    metaComplete: strings,\n  });\n};\n\nconst getClaimedQuest = () => {\n  let data = Near.view(nftContract, \"nft_tokens_for_owner\", {\n    account_id: context.accountId,\n    from_index: \"0\",\n    limit: 50,\n  });\n  State.update({ nftsUser: data });\n};\n\nconst mintQuest = (quest) => {\n  Near.call([\n    {\n      contractName: nftContract,\n      methodName: \"nft_mint_quest\",\n      args: {\n        quest_number: quest,\n      },\n      gas: 300000000000000,\n      deposit: 100000000000000000000000,\n    },\n  ]);\n};\n\nif (context.accountId) {\n  verifyMetapool();\n  verifyNDC();\n  getClaimedQuest();\n}\nconsole.log(state);\nif (\n  state.ndcComplete != null &&\n  state.metaComplete != null &&\n  state.nftsUser != null\n) {\n  let data = state.ndcComplete + state.metaComplete;\n  if (data.length > 0) {\n    data = data.substring(0, data.length - 1);\n    let arr = data.split(\",\");\n    State.update({ completedQuests: arr, loadedCompleted: true });\n  } else {\n    State.update({ completedQuests: [] });\n  }\n  let json = state.nftsUser.find(\n    (quest) => quest.metadata.title == \"Proof Of Reputation NFT\"\n  ).metadata.extra;\n  if (json) {\n    json = json.split(\",\")[0].split(\":\")[1];\n  }\n  let titleArr = [\"I'm Human\", \"stNEAR\", \"Meta Token\", \"Voting Power\"];\n  let claimedID = [];\n  titleArr.map((title) => {\n    let data = state.nftsUser.find((info) => info.metadata.title == title);\n    if (data) {\n      switch (title) {\n        case \"I'm Human\":\n          claimedID.push(\"0\");\n          break;\n        case \"stNEAR\":\n          claimedID.push(\"1\");\n          break;\n        case \"Meta Token\":\n          claimedID.push(\"2\");\n          break;\n        case \"Voting Power\":\n          claimedID.push(\"3\");\n          break;\n      }\n    }\n  });\n  console.log(\"claimed\", claimedID);\n  State.update({ claimedQuests: claimedID, userScore: json });\n}\n\nreturn (\n  <div class=\"m-10\">\n    {context.accountId ? (\n      <>\n        <div class=\"d-flex justify-content-between\">\n          <div class=\"d-flex flex-row gap-4 px-2\">\n            <img\n              src={`https://ipfs.near.social/ipfs/bafkreib23axs6i6qwtxmc3qrbcvbe4uegf2rhjx6qpvz7swe4mrc466q4m`}\n              style={{ height: \"50px\", width: \"50px\", \"object-fit\": \"cover\" }}\n              class=\"my-auto\"\n            />\n            <a\n              class=\"btn bg-info bg-gradient my-auto fw-semibold shadow bg-opacity-50\"\n              href=\"#/syi216.near/widget/PoR-Loan\"\n            >\n              Apply for loan\n            </a>\n          </div>\n          <div class=\"d-flex flex-row bg-secondary bg-opacity-25 rounded-4 py-2 px-3 shadow-sm gap-2\">\n            <img\n              src={`https://ipfs.near.social/ipfs/${state.profile.image.ipfs_cid}`}\n              style={{ height: \"40px\", width: \"40px\", \"object-fit\": \"cover\" }}\n              class=\"rounded-circle my-auto\"\n            />\n            <div class=\"d-flex flex-row gap-3\">\n              <div class=\"my-auto fw-bold\">{context.accountId}</div>\n              <div class=\"my-auto\">\n                <div class=\"fw-semibold\">Score</div>\n                <div>{state.userScore ? state.userScore : 0}</div>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class=\"px-2 my-4\">\n          <p class=\"h2 fw-semibold pb-2\">Proof of Reputation Quests</p>\n          <div class=\"d-flex flex-row bg-secondary bg-opacity-10 rounded-2 shadow-sm p-4 gap-4 flex-wrap justify-content-around\">\n            {state.loadedCompleted &&\n              questList.map((quest) =>\n                state.claimedQuests.some((data) => data == quest.id.toString())\n                  ? claimedCard(quest)\n                  : state.completedQuests.some(\n                      (data) => data == quest.id.toString()\n                    )\n                  ? unclaimedCard(quest)\n                  : incompleteCard(quest)\n              )}\n          </div>\n        </div>\n      </>\n    ) : (\n      <h1>Log in with your NEAR account</h1>\n    )}\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/syi216.near/widget/PoR-MainScreen", "fact_widget_deployments_id": "6a84caa4d5df33f1d468a4a26e8b297f", "inserted_timestamp": "2023-11-09T11:39:46.133Z", "modified_timestamp": "2023-11-09T11:39:46.133Z", "__row_index": 3}