{"tx_hash": "7NrYj92ncd59vPt1qVxsaZnbVYyvQpTYwpQJQCnLWZSn", "action_id_social": "EeUpXBkSKMNr9AvdjpDf4mKF8fiNuX85V5jEoihg5DHT-0-widget", "block_id": 114207972, "block_timestamp": "2024-03-06T14:15:38.723Z", "signer_id": "mpmain.near", "widget_name": "ComponentHistoryBWE", "source_code": "/*\n---props---\nwidgetPath: string,\n*/\n\nconst COMMIT_DISPLAY_LIMIT = 5;\n\nState.init({\n  showAllCommits: false,\n  selectedTab: \"code\",\n  blockHeight: props.blockHeight ? parseInt(props.blockHeight) : null,\n});\n\nconst currentCode = Social.get(props.widgetPath, state.blockHeight);\n\nconst historyBlocksRequest = Social.keys(`${props.widgetPath}`, \"final\", {\n  return_type: \"History\",\n});\n\nif (historyBlocksRequest === null || currentCode === null) return \"Loading...\";\n\nconst [widgetAccountId, _, widgetName] = props.widgetPath.split(\"/\");\nlet blocksChanges =\n  historyBlocksRequest[widgetAccountId]?.[\"component_alpha\"]?.[widgetName];\nif (blocksChanges) blocksChanges = blocksChanges?.sort((a, b) => b - a);\nif (!state.blockHeight) State.update({ blockHeight: blocksChanges[0] });\nconst index = blocksChanges.findIndex((el) => el == state.blockHeight);\n\nfunction getTimestampFromBlockHeight(blockHeight) {\n  const block = Near.block(blockHeight);\n  const date = new Date(block.header.timestamp_nanosec / 1e6);\n  return date.toLocaleString();\n}\n\nconst Wrapper = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 30px;\n`;\n\nconst Layout = styled.div`\n  display: flex;\n  gap: 30px;\n\n  @media (max-width: 980px) {\n    flex-direction: column;\n  }\n`;\n\nconst CommitHeader = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n  align-items: center;\n  gap: 20px;\n  min-height: 30px;\n  margin-bottom: 30px;\n`;\n\nconst Sidebar = styled.div`\n  width: 170px;\n  flex-shrink: 0;\n\n  @media (max-width: 980px) {\n    width: 100%;\n  }\n`;\n\nconst Commits = styled.div`\n  background: var(--sand2);\n  border-radius: 6px;\n  overflow: hidden;\n  margin-bottom: 16px;\n\n  button {\n    all: unset;\n    box-sizing: border-box;\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    border-bottom: 1px solid var(--sand5) !important;\n    cursor: pointer;\n    padding: 10px 16px;\n    background: none;\n\n    &:hover,\n    &:active,\n    &:focus {\n      box-shadow: none !important;\n      outline: none !important;\n      background: var(--sand3) !important;\n    }\n\n    &:focus {\n      span:first-child {\n        text-decoration: underline;\n      }\n    }\n\n    &[data-selected=\"true\"] {\n      background: var(--violet2) !important;\n      border-color: var(--violet5) !important;\n      span:first-child {\n        color: var(--violet10) !important;\n      }\n    }\n\n    &:last-child {\n      border-bottom: none !important;\n    }\n\n    @media (max-width: 980px) {\n      flex-direction: row;\n      justify-content: space-between;\n    }\n  }\n`;\n\nconst Main = styled.div`\n  width: 100%;\n  min-width: 0;\n\n  pre > div {\n    margin-top: 0 !important;\n  }\n`;\n\nconst Text = styled.p`\n  font: var(--${(p) => p.size ?? \"text-base\"});\n  font-weight: ${(p) => p.weight};\n  color: var(--${(p) => p.color ?? \"sand10\"});\n  margin: 0;\n\n  ${(p) =>\n    p.flex &&\n    `\n    display: flex;\n    align-items: center;\n    gap: 16px;\n  `}\n`;\n\nconst PillSelect = styled.div`\n  display: inline-flex;\n  align-items: center;\n\n  @media (max-width: 600px) {\n    width: 100%;\n\n    button {\n      flex: 1;\n    }\n  }\n`;\n\nconst PillSelectButton = styled.button`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n  position: relative;\n  border: 1px solid #e6e8eb;\n  border-right: none;\n  padding: 3px 24px;\n  border-radius: 0;\n  font-size: 12px;\n  line-height: 18px;\n  color: ${(p) => (p.selected ? \"#fff\" : \"#687076\")};\n  background: ${(p) => (p.selected ? \"var(--violet10) !important\" : \"#FBFCFD\")};\n  font-weight: 600;\n  transition: all 200ms;\n\n  &:hover {\n    background: #ecedee;\n    text-decoration: none;\n  }\n\n  &:focus {\n    outline: none;\n    border-color: var(--violet10) !important;\n    box-shadow: 0 0 0 1px var(--violet10);\n    z-index: 5;\n  }\n\n  &:first-child {\n    border-radius: 6px 0 0 6px;\n  }\n  &:last-child {\n    border-radius: 0 6px 6px 0;\n    border-right: 1px solid #e6e8eb;\n  }\n`;\n\nconst Badges = styled.div`\n  display: flex;\n  gap: 6px;\n`;\n\nconst Badge = styled.span`\n  display: inline-block;\n  font: var(--text-xs);\n  font-weight: 500;\n  min-width: 2em;\n  text-align: center;\n  padding: 2px 4px;\n  background: var(--${(p) => p.backgroundColor ?? \"sand2\"});\n  color: var(--${(p) => p.textColor ?? \"sand12\"});\n  border-radius: 5px;\n  vertical-align: middle;\n`;\n\nif (!blocksChanges) {\n  return \"Incorrect widget path\";\n}\n\nreturn (\n  <Wrapper>\n    <PillSelect>\n      <PillSelectButton\n        type=\"button\"\n        onClick={() =>\n          State.update({ selectedTab: \"code\", blockHeight: blocksChanges[0] })\n        }\n        selected={state.selectedTab === \"code\"}\n      >\n        <i className=\"ph-bold ph-code\"></i>\n        Code\n      </PillSelectButton>\n\n      <PillSelectButton\n        type=\"button\"\n        onClick={() =>\n          State.update({ selectedTab: \"render\", blockHeight: blocksChanges[0] })\n        }\n        selected={state.selectedTab === \"render\"}\n      >\n        <i className=\"ph-bold ph-eye\"></i>\n        Preview\n      </PillSelectButton>\n\n      <PillSelectButton\n        type=\"button\"\n        onClick={() => State.update({ selectedTab: \"history\" })}\n        selected={state.selectedTab === \"history\"}\n      >\n        <i className=\"ph-bold ph-clock-counter-clockwise\"></i>\n        History\n      </PillSelectButton>\n    </PillSelect>\n\n    <Layout>\n      {state.selectedTab === \"history\" && (\n        <Sidebar>\n          <CommitHeader>\n            <Text as=\"h3\" size=\"text-md\" color=\"sand12\" weight=\"400\">\n              COMMITS ({blocksChanges.length})\n            </Text>\n          </CommitHeader>\n\n          <Commits>\n            {blocksChanges\n              .slice(\n                0,\n                state.showAllCommits\n                  ? blocksChanges.length\n                  : COMMIT_DISPLAY_LIMIT\n              )\n              .map((blockHeight, key) => (\n                <button\n                  type=\"button\"\n                  data-selected={state.blockHeight == blockHeight}\n                  onClick={() => {\n                    State.update({ blockHeight });\n                  }}\n                >\n                  <Text as=\"span\" size=\"text-s\" weight=\"500\" color=\"sand12\">\n                    {key === 0 ? `#${blockHeight} (head)` : `#${blockHeight}`}\n                  </Text>\n                  <Text as=\"span\" size=\"text-xs\">\n                    {getTimestampFromBlockHeight(blockHeight)}\n                  </Text>\n                </button>\n              ))}\n          </Commits>\n\n          {!state.showAllCommits &&\n            blocksChanges.length > COMMIT_DISPLAY_LIMIT && (\n              <Widget\n                src=\"near/widget/DIG.Button\"\n                props={{\n                  fill: \"outline\",\n                  variant: \"secondary\",\n                  label: \"Show All Commits\",\n                  size: \"small\",\n                  style: { width: \"100%\" },\n                  onClick: () => {\n                    State.update({ showAllCommits: true });\n                  },\n                }}\n              />\n            )}\n        </Sidebar>\n      )}\n\n      <Main>\n        {state.selectedTab === \"history\" && (\n          <CommitHeader>\n            <Text>Changes:</Text>\n            <Badges>\n              <Badge backgroundColor=\"green4\" textColor=\"green11\">\n                +{state.lineCountInserted}\n              </Badge>\n              <Badge backgroundColor=\"red3\" textColor=\"red11\">\n                -{state.lineCountDeleted}\n              </Badge>\n            </Badges>\n\n            <Text size=\"text-s\" style={{ marginRight: \"auto\" }}>\n              {getTimestampFromBlockHeight(state.blockHeight)}\n            </Text>\n          </CommitHeader>\n        )}\n\n        {state.selectedTab === \"code\" && (\n          <Widget\n            src={`bozon.near/widget/WidgetHistory.CodeHistory`}\n            key={`code-${state.blockHeight}`}\n            props={{\n              pathToWidget: props.widgetPath,\n              currentBlockHeight: state.blockHeight,\n              prevBlockHeight: state.blockHeight,\n            }}\n          />\n        )}\n\n        {state.selectedTab === \"history\" && (\n          <Widget\n            src={`bozon.near/widget/WidgetHistory.CodeHistory`}\n            key={`history-${state.blockHeight}`}\n            props={{\n              pathToWidget: props.widgetPath,\n              currentBlockHeight: state.blockHeight,\n              prevBlockHeight: blocksChanges[index + 1],\n              findUniqueResult: (lineCountDeleted, lineCountInserted) => {\n                if (\n                  state.lineCountDeleted === undefined ||\n                  state.lineCountInserted === undefined\n                )\n                  State.update({ lineCountDeleted, lineCountInserted });\n              },\n            }}\n          />\n        )}\n\n        {state.selectedTab === \"render\" && (\n          <div>\n            <Widget\n              code={currentCode}\n              key={`preview-${state.blockHeight}`}\n              props={props}\n            />\n          </div>\n        )}\n      </Main>\n    </Layout>\n  </Wrapper>\n);\n", "metadata": {"fork_of": "near/widget/ComponentHistory@109094525"}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/mpmain.near/widget/ComponentHistoryBWE", "fact_widget_deployments_id": "452fc200577209274ba529d746afdb04", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}