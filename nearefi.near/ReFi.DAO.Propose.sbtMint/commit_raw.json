{"tx_hash": "gt77zGi8joMprktZG1vzknNFtQEDU1f9MeQEseNsPAz", "action_id_social": "D37CQGmQA6ivkg5QxnryGXFEKc49B4c9KAWBN5972GBc-0-widget", "block_id": 96833285, "block_timestamp": "2023-07-19T11:15:13.992Z", "signer_id": "nearefi.near", "widget_name": "ReFi.DAO.Propose.sbtMint", "source_code": "const accountId = props.accountId ?? context.accountId;\nconst daoId = props.daoId ?? \"refi.sputnik-dao.near\";\nconst issuer = props.issuer ?? \"issuer.regens.near\";\nconst receiver = props.receiver ?? \"daoshe.near\";\nconst showReciever = props.showReciever ?? true;\nconst showIssuer = props.showIssuer ?? true;\nconst showReference = props.showReference ?? true;\nconst showDAO = props.showDAO ?? true;\nconst showClass = props.showClass ?? true;\nconst showHeader = props.showHeader ?? true;\nconst classId = props.classId ?? 1;\nconst reference = props.reference ?? null;\nlet profile = Social.getr(`${daoId}/profile`);\n\nif (profile === null) {\n  return \"Loading...\";\n}\nState.init({\n  receiver: receiver,\n  issuer: issuer,\n  reference: reference,\n  daoId: daoId,\n  classId: classId,\n});\nconst changeReceiver = (receiver) => {\n  State.update({\n    receiver,\n  });\n  console.log(\"Receiver: \" + state.receiver);\n};\nconst changeClass = (classId) => {\n  State.update({\n    classId,\n  });\n  console.log(\"classId: \" + state.classId);\n};\nconst changeReference = (reference) => {\n  State.update({\n    reference,\n  });\n  console.log(\"Reference: \" + state.reference);\n};\nconst changeDAO = (daoId) => {\n  State.update({\n    daoId,\n  });\n  console.log(\"DAO: \" + state.daoId);\n};\nconst changeIssuer = (issuer) => {\n  State.update({\n    issuer,\n  });\n  console.log(\"DAO: \" + state.issuer);\n};\nconst post_args = JSON.stringify({\n  receiver: state.receiver,\n  metadata: {\n    class: state.classId,\n  },\n  reference: state.reference,\n});\n\nconst proposal_args = Buffer.from(post_args, \"utf-8\").toString(\"base64\");\n//   const gas = 200000000000000;\n//   const deposit = 80000000000000000000000; // 0.008 //\nconst policy = Near.view(daoId, \"get_policy\");\n\nconst deposit = policy.proposal_bond;\n// add min poliicy bond\nconst handleProposal = () => {\n  Near.call([\n    {\n      contractName: state.daoId,\n      methodName: \"add_proposal\",\n      args: {\n        proposal: {\n          description: \"create proposal to mint SBT\",\n          kind: {\n            FunctionCall: {\n              receiver_id: state.issuer,\n              actions: [\n                {\n                  method_name: \"sbt_mint\",\n                  args: proposal_args,\n                  deposit: \"80000000000000000000000\",\n                  gas: \"200000000000000\",\n                },\n              ],\n            },\n          },\n        },\n      },\n      deposit: deposit,\n      gas: \"219000000000000\",\n    },\n  ]);\n};\n\nconst Wrapper = styled.div`\n  --padding: 24px;\n  position: relative;\n\n  @media (max-width: 1200px) {\n    --padding: 12px;\n  }\n  .input-group {\n    margin: 0.5em\n  }\n`;\n\nconst Actions = styled.div`\n  display: inline-flex;\n  gap: 12px;\n  position: absolute;\n  bottom: var(--padding);\n  right: var(--padding);\n\n  .commit-post-button,\n  .preview-post-button {\n    background: #59e692;\n    color: #09342e;\n    border-radius: 40px;\n    height: 40px;\n    padding: 0 35px;\n    font-weight: 600;\n    font-size: 14px;\n    border: none;\n    cursor: pointer;\n    transition: background 200ms, opacity 200ms;\n\n    &:hover,\n    &:focus {\n      background: rgb(112 242 164);\n      outline: none;\n    }\n\n    &:disabled {\n      opacity: 0.5;\n      pointer-events: none;\n    }\n  }\n\n  .preview-post-button {\n    color: #11181c;\n    background: #f1f3f5;\n    padding: 0;\n    width: 40px;\n\n    &:hover,\n    &:focus {\n      background: #d7dbde;\n      outline: none;\n    }\n  }\n\n  .upload-image-button {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: #f1f3f5;\n    color: #11181c;\n    border-radius: 40px;\n    height: 40px;\n    min-width: 40px;\n    font-size: 0;\n    border: none;\n    cursor: pointer;\n    transition: background 200ms, opacity 200ms;\n\n    &::before {\n      font-size: 16px;\n    }\n\n    &:hover,\n    &:focus {\n      background: #d7dbde;\n      outline: none;\n    }\n\n    &:disabled {\n      opacity: 0.5;\n      pointer-events: none;\n    }\n\n    span {\n      margin-left: 12px;\n    }\n  }\n\n  .d-inline-block {\n    display: flex !important;\n    gap: 12px;\n    margin: 0 !important;\n\n    .overflow-hidden {\n      width: 40px !important;\n      height: 40px !important;\n    }\n  }\n`;\n\nconst PreviewWrapper = styled.div`\n  position: relative;\n  padding: var(--padding);\n  padding-bottom: calc(40px + (var(--padding) * 2));\n`;\n\nconst ButtonWrapper = styled.div`\n  .join-button {\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    padding: 8px 16px;\n    height: 32px;\n    border-radius: 100px;\n    font-weight: 600;\n    font-size: 12px;\n    line-height: 15px;\n    text-align: center;\n    cursor: pointer;\n    background: #FBFCFD;\n    border: 1px solid #D7DBDF;\n    color: ${props.primary ? \"#006ADC\" : \"#11181C\"} !important;\n    white-space: nowrap;\n\n    &:hover,\n    &:focus {\n      background: #ECEDEE;\n      text-decoration: none;\n      outline: none;\n    }\n\n    i {\n      display: inline-block;\n      transform: rotate(90deg);\n      color: #7E868C;\n    }\n  }\n`;\n\nfunction textareaInputHandler(value) {\n  State.update({ text: value });\n}\n\nreturn (\n  <Wrapper>\n    {showHeader && (\n      <Widget\n        src=\"ndcplug.near/widget/NDC.Common.SimpleHeader\"\n        props={{ title: \"Propose to Mint SBT to DAO\" }}\n      />\n    )}\n    {showReciever && (\n      <div className=\"input-group row\">\n        <p>SBT Receiver</p>\n        <input\n          type=\"text\"\n          className={`form-control`}\n          onChange={(e) => changeReceiver(e.target.value)}\n          placeholder={state.receiver ?? `Enter Reciever`}\n        />\n      </div>\n    )}\n    {showReference && (\n      <div className=\"input-group row\">\n        <p>Reference = link to a JSON file (eg, IPFS), [optional]</p>\n        <input\n          type=\"text\"\n          className={`form-control`}\n          onChange={(e) => changeReference(e.target.value)}\n          placeholder={state.reference ?? `Enter Reference`}\n        />\n      </div>\n    )}\n    {showDAO && (\n      <div className=\"input-group row\">\n        <p>Input DAO Contract Address</p>\n        <input\n          type=\"text\"\n          className={`form-control`}\n          onChange={(e) => changeDAO(e.target.value)}\n          placeholder={state.daoId ?? `Enter DAO Contract`}\n        />\n      </div>\n    )}\n    {showIssuer && (\n      <div className=\"input-group row\">\n        <p>Issuer Contract</p>\n        <input\n          type=\"text\"\n          className={`form-control`}\n          onChange={(e) => changeIssuer(e.target.value)}\n          placeholder={state.issuer ?? `Enter Reference`}\n        />\n      </div>\n    )}\n    {showClass && (\n      <div className=\"input-group row\">\n        <p>SBT Class</p>\n        <input\n          type=\"text\"\n          className={`form-control`}\n          onChange={(e) => changeClass(e.target.value)}\n          placeholder={state.classId ?? `Enter Class ID`}\n        />\n      </div>\n    )}\n    <ButtonWrapper>\n      <button className=\"join-button\" onClick={handleProposal}>\n        Propose to Mint SBT\n      </button>\n    </ButtonWrapper>\n  </Wrapper>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/nearefi.near/widget/ReFi.DAO.Propose.sbtMint", "fact_widget_deployments_id": "ff39c9a51cb581cef24e52920c6b1b47", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}