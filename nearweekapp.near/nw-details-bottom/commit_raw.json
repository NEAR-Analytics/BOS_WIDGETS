{"tx_hash": "6xtRd2QTHAZmA2octWSGe98zBmMc1NYDja42Rws5uxyZ", "action_id_social": "HszSjDgYNzwQZhKzCVFPjsyatmWR8kPxhtQxE5HwvhYM-0-widget", "block_id": 103199447, "block_timestamp": "2023-10-12T11:16:08.652Z", "signer_id": "nearweekapp.near", "widget_name": "nw-details-bottom", "source_code": "const rootUser = \"nearweekapp.near\";\n\nconst breakpoints = {\n  md: \"768px\",\n  lg: \"1100px\",\n  xl: \"1300px\",\n};\n\nconst issues = data.body.data;\n\nconst detailsPage = props.detailsPage;\nconst updateDetailsPage = props.updateDetailsPage;\nconst sections = detailsPage?.sections;\n\nconst Card = styled.div`\n  position: relative;\n  width: 100%;\n  border-radius: 12px;\n  background: #fff;\n  border: 1px solid #eceef0;\n  box-shadow: 0px 1px 3px rgba(16, 24, 40, 0.1),\n    0px 1px 2px rgba(16, 24, 40, 0.06);\n  overflow: hidden;\n  margin-bottom: 10px;\n`;\n\nconst CardTitle = styled.h2`\n  overflow: hidden;\n  color: #1C1F41;\n  text-overflow: ellipsis;\n  whitespace: nowrap;\n  font-family: Inter;\n  font-size: 15px;\n  font-style: normal;\n  font-weight: 500;\n  line-height: 14px;\n  cursor: pointer;\n`;\n\nconst CordDate = styled.p`\n  color: rgba(28, 31, 65, 0.45);\n  text-align: right;\n  font-family: Inter;\n  font-size: 12px;\n  font-style: normal;\n  font-weight: 500;\n  line-height: 8.5px;\n  text-align: left;\n  margin-top: 8px;\n`;\n\nconst SectionHeader = styled.div`\n  width: 100%;\n  margin-bottom: 15px;\n       @media screen and (min-width: ${breakpoints.md}) {\n        margin-top:100px;\n     }\n`;\n\nconst H2 = styled.h2`\n  color: #1C1F41;\n  font-family: Inter;\n  font-size: 24px;\n  font-style: normal;\n  font-weight: 500;\n  line-height: 15px;\n  margin-bottom: 15px;\n`;\n\nconst CardBody = styled.div`\n  padding: 12px;\n  display: flex;\n  gap: 16px;\n  > * {\n    min-width: 0;\n  }\n`;\nconst TabContentFooter = styled.div`\n      display: flex;\n      flex-direction: row;\n      justify-content: center;\n      margin-bottom:20px;\n  `;\n\nconst ButtonLink = styled.a`\n    margin-top:14px;\n    width: 180px;\n    padding: 8px;\n    height: 32px;\n    border: 1px solid #d7dbdf;\n    border-radius: 100px;\n    font-weight: 600;\n    font-size: 12px;\n    line-height: 22px;\n    letter-spacing: -0.03em;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    text-align: center;\n    cursor: pointer;\n    white-space: nowrap;\n    color: hsla(204, 22%, 9%, 1);\n    &:hover,\n    &:focus {\n      text-decoration: none;\n      outline: none;\n    }\n  `;\n\nconst CardContent = styled.div`\n      font-size: 10px;\n      font-weight: 400;\n      line-height: 13px;\n      letter-spacing: -0.02em;\n      color: hsla(0, 0%, 0%, 1);\n      width: 100%;\n    `;\nfunction BottomSection() {\n  const accountId = \"near\";\n  articles;\n  State.init({ active: 0 });\n  const nwSite = \"https://nearweek.com\";\n  let posts = [];\n\n  const indexedPosts = Social.index(\"post\", \"main\", {\n    accountId,\n    limit: 20,\n    order: \"desc\",\n  });\n\n  if (indexedPosts?.length > 0) {\n    posts = [];\n\n    indexedPosts.forEach((post) => {\n      const data = Social.get(`${post.accountId}/post/main`, post.blockHeight);\n      if (data) {\n        const json = JSON.parse(data);\n        const content = json.text.split(\"\\n\");\n        const title = content[0] || \"\";\n        const url = content[1] || content[2] || \"\";\n        const lastLine = content.pop() || \"\";\n        const hasNewsTag = lastLine.indexOf(\"#news\") > -1;\n        const isValid = hasNewsTag && url.indexOf(\"https://\") > -1;\n\n        if (isValid) {\n          const block = Near.block(post.blockHeight);\n          let createdAt = \"\";\n          if (block) {\n            const timeMs = parseFloat(block.header.timestamp_nanosec) / 1e6;\n            createdAt = new Date(timeMs).toISOString();\n          }\n          posts.push({\n            blockHeight: post.blockHeight,\n            title,\n            url,\n            thumbnail: \"https://near.org/favicon.png\",\n            createdAt,\n            categories: [\"Near ORG\", \"blog\"],\n          });\n\n          posts.sort((a, b) => b.blockHeight - a.blockHeight);\n        }\n      }\n    });\n  }\n\n  const data = fetch(\n    \"https://nearweek.com/api/editions?populate=deep&sort=createdAt:desc&pagination[pageSize]=8\",\n    {\n      method: \"GET\",\n      headers: {\n        Accept: \"*/*\",\n        Authorization:\n          \"Bearer 15699f0723aa9fe9f655b1a94e450552476c08807f67b525b5a3c8011eecc8aee6d45923443620f17815b897858be058cd7bd89ddf23a28aabaecb178e7ebc55d380293beeb51a8ce87b40e1518ce4708e4d51a06b115f27fa64ab5cbee5a3511cec785d7ae6a155ecd05ac8196aadae3e9b8e9401b8df8d8b69904f7364f925\",\n      },\n    }\n  );\n\n  const cssFont = fetch(\"https://fonts.cdnfonts.com/css/hubot-sans\").body;\n\n  if (!cssFont) return \"\";\n\n  if (!state.theme) {\n    State.update({\n      theme: styled.div`\n          font-family: 'Mona Sans', sans-serif;\n          font-style: normal;\n          ${cssFont}\n      }`,\n    });\n  }\n  const Theme = state.theme;\n\n  function formatDate(dateString) {\n    const date = new Date(dateString);\n    const day = date.getDate().toString().padStart(2, \"0\");\n    const month = (date.getMonth() + 1).toString().padStart(2, \"0\");\n    const year = date.getFullYear().toString().slice(-2);\n    return `${day}.${month}.${year}`;\n  }\n  function calculateTimeDifference(dateString) {\n    const now = new Date();\n    const creationDate = new Date(dateString);\n    const diffMillis = now - creationDate.getTime();\n    const timeUnits = [\"Month\", \"Day\", \"Hour\", \"Minute\", \"Second\"];\n    const divisors = [\n      30 * 24 * 60 * 60 * 1000,\n      24 * 60 * 60 * 1000,\n      60 * 60 * 1000,\n      60 * 1000,\n      1000,\n    ];\n\n    for (let i = 0; i < divisors.length; i++) {\n      const unitCount = Math.floor(diffMillis / divisors[i]);\n      if (unitCount >= 1) {\n        return `${unitCount} ${timeUnits[i]}${unitCount > 1 ? \"s\" : \"\"}`;\n      }\n    }\n\n    return \"Just Now\";\n  }\n\n  const issues = data.body.data;\n  return (\n    <div>\n      {issues !== null && issues.length > 0 ? (\n        issues.map((issue, index) => (\n          <div key={index}>\n            {index === 0 && (\n              <SectionHeader>\n                <H2>Previous Newsletters</H2>\n              </SectionHeader>\n            )}\n            {index > 0 && (\n              <Card>\n                <CardBody>\n                  <CardContent>\n                    <div className=\"d-flex clearfix\">\n                      <div className=\"d-flex\">\n                        <img\n                          className=\"rounded\"\n                          width=\"67\"\n                          height=\"49\"\n                          src={nwSite + issue.Thumbnail.url}\n                          alt={issue.Thumbnail.alternativeText}\n                        />\n                        <div className=\"d-flex flex-column ms-3 mt-0\">\n                          <CardTitle onClick={() => updateDetailsPage(issue)}>\n                            {\"Edition\"} {issue.Number ? issue.Number : \"\"}\n                          </CardTitle>\n                          <CordDate>\n                            {index > 0\n                              ? `${calculateTimeDifference(issue.createdAt)}`\n                              : formatDate(issue.createdAt)}\n                          </CordDate>\n                        </div>\n                      </div>\n                    </div>\n                  </CardContent>\n                </CardBody>\n              </Card>\n            )}\n          </div>\n        ))\n      ) : (\n        <div>Loading ...</div>\n      )}\n      <TabContentFooter>\n        <ButtonLink href=\"https://nearweek.com/newsletters\" target=\"_blank\">\n          Load more\n        </ButtonLink>\n      </TabContentFooter>\n      <Widget src={`${rootUser}/widget/nw-newsletter-badge`} />\n    </div>\n  );\n}\n\nreturn <BottomSection />;\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/nearweekapp.near/widget/nw-details-bottom", "fact_widget_deployments_id": "07f45eb66f4152f514aed8deaaad7320", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}