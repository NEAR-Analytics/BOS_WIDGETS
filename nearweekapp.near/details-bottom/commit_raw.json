{"tx_hash": "FmH42tUW9qAryUNxzuF6jGpbohewoNeqUMvupfzefjM4", "action_id_social": "8N8QQQtv4pgX9pNtCCYxzE7bGtVMD5aUXPGza5ujLVUa-0-widget", "block_id": 106799708, "block_timestamp": "2023-11-29T10:09:19.680Z", "signer_id": "nearweekapp.near", "widget_name": "details-bottom", "source_code": "const rootUser = \"nearweekapp.near\";\r\n\r\nconst breakpoints = {\r\n  md: \"768px\",\r\n  lg: \"1100px\",\r\n  xl: \"1300px\",\r\n};\r\n\r\nconst issues = data.body.data;\r\n\r\nconst detailsPage = props.detailsPage;\r\nconst updateDetailsPage = props.updateDetailsPage;\r\nconst sections = detailsPage?.sections;\r\n\r\nconst Card = styled.div`\r\n  position: relative;\r\n  cursor: pointer;\r\n  width: 100%;\r\n  border-radius: 12px;\r\n  background: #fff;\r\n  border: 1px solid #eceef0;\r\n  box-shadow: 0px 1px 3px rgba(16, 24, 40, 0.1),\r\n    0px 1px 2px rgba(16, 24, 40, 0.06);\r\n  overflow: hidden;\r\n  margin-bottom: 10px;\r\n`;\r\n\r\nconst CardTitle = styled.h2`\r\n  overflow: hidden;\r\n  color: #1C1F41;\r\n  text-overflow: ellipsis;\r\n  whitespace: nowrap;\r\n  font-family: Inter;\r\n  font-size: 15px;\r\n  font-style: normal;\r\n  font-weight: 500;\r\n  line-height: 14px;\r\n  cursor: pointer;\r\n  margin: 0;\r\n`;\r\n\r\nconst CordDate = styled.p`\r\n  color: rgba(28, 31, 65, 0.45);\r\n  text-align: right;\r\n  font-family: Inter;\r\n  font-size: 12px;\r\n  font-style: normal;\r\n  font-weight: 500;\r\n  line-height: 8.5px;\r\n  text-align: left;\r\n  margin: 0;\r\n`;\r\n\r\nconst SectionHeader = styled.div`\r\n  width: 100%;\r\n  margin-bottom: 15px;\r\n  padding: 0.5rem 0;\r\n`;\r\n\r\nconst H2 = styled.h2`\r\n  color: #1C1F41;\r\n  font-family: Inter;\r\n  font-size: 24px;\r\n  font-style: normal;\r\n  font-weight: 500;\r\n  line-height: 15px;\r\n  margin-bottom: 15px;\r\n`;\r\n\r\nconst CardBody = styled.div`\r\n  padding: 12px;\r\n  display: flex;\r\n  gap: 16px;\r\n  > * {\r\n    min-width: 0;\r\n  }\r\n`;\r\nconst TabContentFooter = styled.div`\r\n      display: flex;\r\n      flex-direction: row;\r\n      justify-content: center;\r\n      margin-bottom:20px;\r\n  `;\r\n\r\nconst ButtonLink = styled.button`\r\nbackground: transparent;\r\n    margin-top:14px;\r\n    width: 180px;\r\n    padding: 8px;\r\n    height: 32px;\r\n    border: 1px solid #d7dbdf;\r\n    border-radius: 100px;\r\n    font-weight: 500;\r\n    font-size: 12px;\r\n    line-height: 22px;\r\n    letter-spacing: -0.03em;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    text-align: center;\r\n    cursor: pointer;\r\n    white-space: nowrap;\r\n    color: hsla(204, 22%, 9%, 1);\r\n    &:hover,\r\n    &:focus {\r\n      text-decoration: none;\r\n      outline: none;\r\n    }\r\n  `;\r\n\r\nconst CardContent = styled.div`\r\n      font-size: 10px;\r\n      font-weight: 400;\r\n      line-height: 13px;\r\n      letter-spacing: -0.02em;\r\n      color: hsla(0, 0%, 0%, 1);\r\n      width: 100%;\r\n    `;\r\nfunction BottomSection() {\r\n  const accountId = \"near\";\r\n  articles;\r\n  State.init({ page: 1 });\r\n  const nwSite = \"https://nearweek.com\";\r\n  let posts = [];\r\n\r\n  const indexedPosts = Social.index(\"post\", \"main\", {\r\n    accountId,\r\n    limit: 20,\r\n    order: \"desc\",\r\n  });\r\n\r\n  if (indexedPosts?.length > 0) {\r\n    posts = [];\r\n\r\n    indexedPosts.forEach((post) => {\r\n      const data = Social.get(`${post.accountId}/post/main`, post.blockHeight);\r\n      if (data) {\r\n        const json = JSON.parse(data);\r\n        const content = json.text.split(\"\\n\");\r\n        const title = content[0] || \"\";\r\n        const url = content[1] || content[2] || \"\";\r\n        const lastLine = content.pop() || \"\";\r\n        const hasNewsTag = lastLine.indexOf(\"#news\") > -1;\r\n        const isValid = hasNewsTag && url.indexOf(\"https://\") > -1;\r\n\r\n        if (isValid) {\r\n          const block = Near.block(post.blockHeight);\r\n          let createdAt = \"\";\r\n          if (block) {\r\n            const timeMs = parseFloat(block.header.timestamp_nanosec) / 1e6;\r\n            createdAt = new Date(timeMs).toISOString();\r\n          }\r\n          posts.push({\r\n            blockHeight: post.blockHeight,\r\n            title,\r\n            url,\r\n            thumbnail: \"https://near.org/favicon.png\",\r\n            createdAt,\r\n            categories: [\"Near ORG\", \"blog\"],\r\n          });\r\n\r\n          posts.sort((a, b) => b.blockHeight - a.blockHeight);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  const data = fetch(\r\n    `https://nearweek.com/api/editions?populate=deep&sort=createdAt:desc&pagination[pageSize]=${\r\n      state.page * 8\r\n    }`,\r\n    {\r\n      method: \"GET\",\r\n      headers: {\r\n        Accept: \"*/*\",\r\n        Authorization:\r\n          \"Bearer 15699f0723aa9fe9f655b1a94e450552476c08807f67b525b5a3c8011eecc8aee6d45923443620f17815b897858be058cd7bd89ddf23a28aabaecb178e7ebc55d380293beeb51a8ce87b40e1518ce4708e4d51a06b115f27fa64ab5cbee5a3511cec785d7ae6a155ecd05ac8196aadae3e9b8e9401b8df8d8b69904f7364f925\",\r\n      },\r\n    }\r\n  );\r\n\r\n  const cssFont = fetch(\"https://fonts.cdnfonts.com/css/hubot-sans\").body;\r\n\r\n  if (!cssFont) return \"\";\r\n\r\n  if (!state.theme) {\r\n    State.update({\r\n      theme: styled.div`\r\n          font-family: 'Mona Sans', sans-serif;\r\n          font-style: normal;\r\n          ${cssFont}\r\n      }`,\r\n    });\r\n  }\r\n  function formatDate(dateString) {\r\n    const date = new Date(dateString);\r\n    const day = date.getDate().toString().padStart(2, \"0\");\r\n    const month = (date.getMonth() + 1).toString().padStart(2, \"0\");\r\n    const year = date.getFullYear().toString().slice(-2);\r\n    return `${day}.${month}.${year}`;\r\n  }\r\n  function calculateTimeDifference(dateString) {\r\n    const now = new Date();\r\n    const creationDate = new Date(dateString);\r\n    const diffMillis = now - creationDate.getTime();\r\n    const timeUnits = [\"Month\", \"Day\", \"Hour\", \"Minute\", \"Second\"];\r\n    const divisors = [\r\n      30 * 24 * 60 * 60 * 1000,\r\n      24 * 60 * 60 * 1000,\r\n      60 * 60 * 1000,\r\n      60 * 1000,\r\n      1000,\r\n    ];\r\n\r\n    for (let i = 0; i < divisors.length; i++) {\r\n      const unitCount = Math.floor(diffMillis / divisors[i]);\r\n      if (unitCount >= 1) {\r\n        return `${unitCount} ${timeUnits[i]}${unitCount > 1 ? \"s\" : \"\"}`;\r\n      }\r\n    }\r\n\r\n    return \"Just Now\";\r\n  }\r\n\r\n  const Container = styled.div`\r\n    border: 1px solid var(--bs-border-color);\r\n    border-radius: 20px;\r\n    padding: 20px 15px;\r\n    margin-bottom: 10px;\r\n    height: fit-content;\r\n    width: 341px;\r\n    background: white;\r\n    @media screen and (min-width: ${breakpoints.lg}) {\r\n      margin-top: 100px;\r\n    }\r\n  `;\r\n\r\n  const issues = data.body.data;\r\n  console.log(issues, \"issues1\");\r\n  return (\r\n    <Container>\r\n      {issues !== null && issues.length > 0 ? (\r\n        issues.map((issue, index) => (\r\n          <div key={index}>\r\n            {/* Section header */}\r\n            {index === 0 && (\r\n              <SectionHeader>\r\n                <H2>Previous Newsletters</H2>\r\n              </SectionHeader>\r\n            )}\r\n\r\n            {index > 0 && (\r\n              <Card onClick={() => updateDetailsPage(issue)}>\r\n                <CardBody>\r\n                  <CardContent>\r\n                    <div className=\"d-flex clearfix\">\r\n                      <div className=\"d-flex\">\r\n                        <img\r\n                          className=\"rounded\"\r\n                          width=\"67\"\r\n                          height=\"49\"\r\n                          src={nwSite + issue.Thumbnail.url}\r\n                          alt={issue.Thumbnail.alternativeText}\r\n                        />\r\n                        <div className=\"d-flex flex-column justify-content-center gap-2 ms-3\">\r\n                          <CardTitle>\r\n                            {\"Edition\"} {issue.Number ? issue.Number : \"\"}\r\n                          </CardTitle>\r\n                          <CordDate>\r\n                            {index > 0\r\n                              ? `${calculateTimeDifference(issue.createdAt)}`\r\n                              : formatDate(issue.createdAt)}\r\n                          </CordDate>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </CardContent>\r\n                </CardBody>\r\n              </Card>\r\n            )}\r\n          </div>\r\n        ))\r\n      ) : (\r\n        <div>Loading ...</div>\r\n      )}\r\n      <TabContentFooter>\r\n        <ButtonLink onClick={() => State.update({ page: state.page + 1 })}>\r\n          Load more\r\n        </ButtonLink>\r\n      </TabContentFooter>\r\n      <Widget src={`${rootUser}/widget/nw-newsletter-bage`} />\r\n    </Container>\r\n  );\r\n}\r\n\r\nreturn <BottomSection />;\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/nearweekapp.near/widget/details-bottom", "fact_widget_deployments_id": "51bd5bf0fa5d78d469b062f4c4c50829", "inserted_timestamp": "2023-11-29T12:22:21.742Z", "modified_timestamp": "2023-11-29T12:22:21.742Z", "__row_index": 0}