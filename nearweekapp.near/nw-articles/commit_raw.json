{"tx_hash": "3skSbdFX5cevYHffFmkkyRyE3uGRfbaXdf7FaXDMcQZ7", "action_id_social": "EFuRrtLjpz5YESagU7i8NwgQWzjKmdn4fpkUoawfC8L7-0-widget", "block_id": 106797574, "block_timestamp": "2023-11-29T09:21:33.875Z", "signer_id": "nearweekapp.near", "widget_name": "nw-articles", "source_code": "const breakpoints = {\n  md: \"768px\",\n  lg: \"1100px\",\n  xl: \"1300px\",\n};\n\nfunction Articles() {\n  const accountId = \"near\";\n  State.init({ page: 1 });\n  let posts = [];\n  let mediumPosts = [];\n\n  const indexedPosts = Social.index(\"post\", \"main\", {\n    accountId,\n    limit: 20,\n    order: \"desc\",\n  });\n\n  if (indexedPosts?.length > 0) {\n    posts = [];\n\n    indexedPosts.forEach((post) => {\n      const data = Social.get(`${post.accountId}/post/main`, post.blockHeight);\n      if (data) {\n        const json = JSON.parse(data);\n        const content = json.text.split(\"\\n\");\n        const title = content[0] || \"\";\n        const url = content[1] || content[2] || \"\";\n        const lastLine = content.pop() || \"\";\n        const hasNewsTag = lastLine.indexOf(\"#news\") > -1;\n        const isValid = hasNewsTag && url.indexOf(\"https://\") > -1;\n\n        if (isValid) {\n          const block = Near.block(post.blockHeight);\n          let createdAt = \"\";\n          if (block) {\n            const timeMs = parseFloat(block.header.timestamp_nanosec) / 1e6;\n            createdAt = new Date(timeMs).toISOString();\n          }\n          posts.push({\n            blockHeight: post.blockHeight,\n            title,\n            url,\n            thumbnail: \"https://near.org/favicon.png\",\n            createdAt,\n            categories: [\"Near ORG\", \"blog\"],\n          });\n\n          posts.sort((a, b) => b.blockHeight - a.blockHeight);\n        }\n      }\n    });\n  }\n\n  const Post = (props) => {\n    const { key, post } = props;\n    return (\n      <Card key={key} index={props.index} href={post.url} target=\"_blank\">\n        <CardImage src={post.thumbnail} alt=\"\" />\n        <CardContent>\n          <CardTitle>\n            <a href={post.url} target=\"_blank\">\n              {post.title}\n            </a>\n          </CardTitle>\n          <CardFooter>\n            <Badges>\n              {post.categories &&\n                post.categories.length > 0 &&\n                post.categories\n                  .slice(0, window.innerWidth < 255 ? 1 : 2)\n                  .map((category, index) => (\n                    <Badge index={index}>{category}</Badge>\n                  ))}\n            </Badges>\n            <AuthorNDate>\n              {post.author && ( // Check if author is available\n                <Author>\n                  <span>@{post.author}</span>\n                </Author>\n              )}\n              <Dot>\u00b7</Dot>\n              <CardDate>\n                {post.createdAt ? dateToDays(post.createdAt) : \"\"}\n              </CardDate>\n            </AuthorNDate>\n          </CardFooter>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  const fetchMedium = fetch(\n    \"https://api.rss2json.com/v1/api.json?rss_url=https://medium.com/feed/nearprotocol\",\n    { method: \"GET\" }\n  );\n\n  if (fetchMedium && fetchMedium?.body?.items?.length > 0) {\n    fetchMedium.body.items.forEach((item) => {\n      mediumPosts.push({\n        title: item.title,\n        url: item.link,\n        thumbnail: item.thumbnail,\n        createdAt: item.pubDate,\n        categories: item.categories,\n        author: item.author,\n      });\n    });\n  }\n\n  function dateToDays(date) {\n    const timeAgo = (diffSec) =>\n      diffSec < 60000\n        ? `${(diffSec / 1000) | 0}s`\n        : diffSec < 3600000\n        ? `${(diffSec / 60000) | 0}m`\n        : diffSec < 86400000\n        ? `${(diffSec / 3600000) | 0}h`\n        : `${(diffSec / 86400000) | 0}d`;\n\n    var d = new Date(date);\n    return timeAgo(Date.now() - d.getTime());\n  }\n\n  const articles = [...mediumPosts];\n\n  const cssFont = fetch(\n    \"https://fonts.googleapis.com/css2?family=Space+Grotesk\"\n  ).body;\n\n  if (!cssFont) return \"\";\n\n  if (!state.theme) {\n    State.update({\n      theme: styled.div`\n    font-family: sans-serif;\n    ${cssFont}\n`,\n    });\n  }\n  const Theme = state.theme;\n  const AuthorNDate = styled.div`\n    display: flex;\n    flex-direction: row;\n    align-items: baseline;\n    gap:4px;\n  `;\n  const Dot = styled.span`\n  color: rgba(28, 31, 65, 0.45);\n  text-align: right;\n  font-family: Inter;\n  font-size: 12px;\n  font-style: normal;\n  font-weight: 500;\n  line-height: 8.5px; /* 70.833% */\n  letter-spacing: 0.12px;\n    `;\n\n  const Author = styled.div`\n  & span {\n  color: rgba(28, 31, 65, 0.45);\n  text-align: right;\n  font-family: Inter;\n  font-size: 12px;\n  font-style: normal;\n  font-weight: 500;\n  line-height: 8.5px;\n  letter-spacing: 0.12px;\n  }\n  `;\n\n  const NwWidget = styled.div`\n  border-radius: 16px;\n  background: hsla(0, 0%, 100%, 1);\n  margin-bottom: 20px;\n\n  @media screen and (min-width: 1300px) {\n    display: flex;\n    gap:10px;\n    flex-wrap: wrap;\n  }\n\n`;\n\n  const Card = styled.a`\n    color: #1C1F41;\n    text-decoration: none !important;\n    display: flex;\n    flex-direction: column;\n    border-radius: 8px;\n    padding:12px;\n    margin-bottom:10px;\n    border: 1px solid #eceef0;\n    max-width:265px;\n    @media screen and (max-width: 1300px) {\n        max-width:100%;\n    }\n`;\n\n  const CardImage = styled.img`\n    width: 100%;\n    height: auto;\n    aspect-ratio: 16 / 9;\n    border-radius: 8px;\n    object-fit: cover;\n`;\n\n  const CardContent = styled.div`\n    display: flex;\n    flex: 1;\n    flex-direction: column;\n    justify-content: space-between;\n    margin-top: 0;\n`;\n\n  const CardTitle = styled.div`\n    margin-top: 5px;\n    margin-bottom: 16px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    whitespace: nowrap;\n    font-family: Inter;\n    font-size: 14px;\n    font-style: normal;\n    font-weight: 500;\n    line-height: 18px;\n    text-transform: capitalise;\n    a {\n        color: inherit;\n    }\n`;\n\n  const CardFooter = styled.div`\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom:0px;\n`;\n\n  const Badges = styled.div`\n    display: flex;\n    flex-direction: row;\n    flex-wrap: wrap;\n    gap: 6px;\n`;\n\n  const Badge = styled.span`\n    background: #F5F5F5;\n    padding: 6px 20px;  \n    border-color: hsla(214, 10%, 86%, 1);\n    border-radius: 4px;\n    color: #9C9C9C;\n    text-align: center;\n    font-family: Inter;\n    font-size: 12px;\n    font-style: normal;\n    font-weight: 500;\n    line-height: 8.5px;\n    display:   ${(props) => (props.index > 1 ? \"none\" : \"block\")}; \n`;\n\n  const CardDate = styled.div`\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    color: rgba(28, 31, 65, 0.45);\n    text-align: right;\n    font-family: Inter;\n    font-size: 12px;\n    font-style: normal;\n    font-weight: 500;\n    line-height: 8.5px;\n`;\n\n  const H2 = styled.h2`\n    color: #1C1F41;\n    font-family: Inter;\n    font-size: 24px;\n    font-style: normal;\n    font-weight: 500;\n    line-height: 15px;\n    margin-bottom: 15px;\n  `;\n\n  return (\n    <div>\n      <H2>Articles</H2>\n      <Theme>\n        <NwWidget>\n          <>\n            {articles.length > 0 ? (\n              articles.map((article, index) => (\n                <Post post={article} index={index} />\n              ))\n            ) : (\n              <div>Loading ...</div>\n            )}\n          </>\n        </NwWidget>\n      </Theme>\n    </div>\n  );\n}\n\nreturn <Articles />;\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/nearweekapp.near/widget/nw-articles", "fact_widget_deployments_id": "349f982886f574bd90b772bdbc209a93", "inserted_timestamp": "2023-11-29T11:28:31.781Z", "modified_timestamp": "2023-11-29T11:28:31.781Z", "__row_index": 0}