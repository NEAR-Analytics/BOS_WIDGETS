{"tx_hash": "5G3G5rQovducc6bWRGDpnhAZfzySpJrcTDEx8XMDfYPR", "action_id_social": "GEuug9LjCzXzdKtFNe9GSfvj44EMPfj1Q9e12w8HFkiJ-0-widget", "block_id": 103200519, "block_timestamp": "2023-10-12T11:36:51.444Z", "signer_id": "nearweekapp.near", "widget_name": "nw-newsletter-more", "source_code": "const rootUser = \"nearweekapp.near\";\nconst breakpoints = { md: \"768px\", lg: \"1100px\", xl: \"1300px\" };\n\nfunction NewsletterCard() {\n  const accountId = \"near\";\n  articles;\n  State.init({ active: 0 });\n  const nwSite = \"https://nearweek.com\";\n  let posts = [];\n  const indexedPosts = Social.index(\"post\", \"main\", {\n    accountId,\n    limit: 20,\n    order: \"desc\",\n  });\n  if (indexedPosts?.length > 0) {\n    posts = indexedPosts\n      .map((post) => {\n        const data = Social.get(\n          `${post.accountId}/post/main`,\n          post.blockHeight\n        );\n        if (!data) return;\n        const json = JSON.parse(data);\n        const content = json.text.split(\"\\n\");\n        const title = content[0] || \"\";\n        const url = content[1] || content[2] || \"\";\n        const lastLine = content.pop() || \"\";\n        const hasNewsTag = lastLine.includes(\"#news\");\n        const isValid = hasNewsTag && url.includes(\"https://\");\n        if (isValid) {\n          const block = Near.block(post.blockHeight);\n          const createdAt = block\n            ? new Date(\n                parseFloat(block.header.timestamp_nanosec) / 1e6\n              ).toISOString()\n            : \"\";\n          return {\n            blockHeight: post.blockHeight,\n            title,\n            url,\n            thumbnail: \"https://near.org/favicon.png\",\n            createdAt,\n            categories: [\"Near ORG\", \"blog\"],\n          };\n        }\n      })\n      .filter(Boolean);\n    posts.sort((a, b) => b.blockHeight - a.blockHeight);\n  }\n\n  const data = fetch(\n    \"https://nearweek.com/api/editions?populate=deep&sort=createdAt:desc&pagination[pageSize]=8\",\n    {\n      method: \"GET\",\n      headers: {\n        Accept: \"*/*\",\n        Authorization:\n          \"Bearer 15699f0723aa9fe9f655b1a94e450552476c08807f67b525b5a3c8011eecc8aee6d45923443620f17815b897858be058cd7bd89ddf23a28aabaecb178e7ebc55d380293beeb51a8ce87b40e1518ce4708e4d51a06b115f27fa64ab5cbee5a3511cec785d7ae6a155ecd05ac8196aadae3e9b8e9401b8df8d8b69904f7364f925\",\n      },\n    }\n  );\n  const cssFont = fetch(\"https://fonts.cdnfonts.com/css/hubot-sans\").body;\n  if (!cssFont) return \"\";\n  if (!state.theme) {\n    State.update({\n      theme: styled.div`\n        font-family: 'Mona Sans', sans-serif;\n        font-style: normal;\n        ${cssFont}\n      }`,\n    });\n  }\n  const Theme = state.theme;\n\n  const TopCard = styled.div`\n      position: relative;\n      width: 100%;\n      border-radius: 12px;\n      background: #fff;\n      overflow: hidden;\n      margin-bottom:10px;\n      display flex;\n      flex-direction: column;\n      gap:40px;\n    `;\n\n  const TopCardTitle = styled.h2`\n     overflow: hidden;\n      color: #1C1F41;\n      text-overflow: ellipsis;\n      whitespace: nowrap;\n      font-family: Inter;\n      font-size: 18px;\n      font-style: normal;\n      font-weight: 500;\n      display:grid;\n      gap:20px;\n      margin-bottom:27px;\n    `;\n  const TopCardBody = styled.div`\n      display: flex;\n      align-items: center;\n  \n      > * {\n        min-width: 0;\n      }\n    `;\n  const CardContent = styled.div`\n      font-size: 10px;\n      font-weight: 400;\n      line-height: 13px;\n      letter-spacing: -0.02em;\n      color: hsla(0, 0%, 0%, 1);\n      width: 100%;\n    `;\n  const CardFooter = styled.div`\n      margin-bottom:20px;\n      & p{\n          color: #1C1F41;\n          font-family: Inter;\n          font-size: 15px;\n          font-style: normal;\n          font-weight: 500;\n          line-height: 20px;\n          letter-spacing: 0.15px;\n      }\n      & a {\n        color: #3C71F7;\n        font-family: Inter;\n        font-size: 15px;\n        font-style: normal;\n        font-weight: 500;\n        line-height: 20px;\n        letter-spacing: 0.15px;\n        text-decoration-line: underline;\n      }\n    `;\n\n  const MainSection = styled.div`\n  padding: 30px 20px 20px 20px;\n  @media screen and (min-width: ${breakpoints.xl}) {\n   grid-area: 1 / 2 / 2 / 3;\n   padding: 30px 45px 20px 45px;\n   max-width:100%;\n     }\n  `;\n  const MainContainer = styled.div`\n      width:310px;\n      display:flex;\n    flex-direction:column;\n    justify-content: center; \n    justify-items: center; \n     @media screen and (min-width: ${breakpoints.xl}) {\n      width:70%;\n      display: grid;\n      grid-column-gap: 20px;\n      justify-content: end;\n     }\n    `;\n  function formatDate(dateString) {\n    const date = new Date(dateString);\n    const day = date.getDate().toString().padStart(2, \"0\");\n    const month = (date.getMonth() + 1).toString().padStart(2, \"0\");\n    const year = date.getFullYear().toString().slice(-2);\n    return `${day}.${month}.${year}`;\n  }\n  function calculateTimeDifference(dateString) {\n    const now = new Date();\n    const creationDate = new Date(dateString);\n    const diffMillis = now - creationDate.getTime();\n    const timeUnits = [\"Month\", \"Day\", \"Hour\", \"Minute\", \"Second\"];\n    const divisors = [\n      30 * 24 * 60 * 60 * 1000,\n      24 * 60 * 60 * 1000,\n      60 * 60 * 1000,\n      60 * 1000,\n      1000,\n    ];\n\n    for (let i = 0; i < divisors.length; i++) {\n      const unitCount = Math.floor(diffMillis / divisors[i]);\n      if (unitCount >= 1) {\n        return `${unitCount} ${timeUnits[i]}${unitCount > 1 ? \"s\" : \"\"}`;\n      }\n    }\n\n    return \"Just Now\";\n  }\n\n  const issues = data.body.data;\n\n  const detailsPage = props.detailsPage;\n  const updateDetailsPage = props.updateDetailsPage;\n  const sections = detailsPage?.sections;\n\n  function generateCode() {\n    const code = `\n  <html>\n  <head>\n  <script type=\"text/javascript\" src=\"https://cdnjs.cloudflare.com/ajax/libs/iframe-resizer/4.3.6/iframeResizer.contentWindow.js\"></script>\n  </head>\n  <body>\n  <div id=\"content\"></div>\n  </body>\n  <script>\n      window.addEventListener('message', function(event) {\n      }, false);\n              const handleMessage = (m) => {\n                  const { data } = m;\n                  let fullHtml = \"\";\n  \n                  data.forEach(section => fullHtml+=section.content);\n  \n                  const contentElement = document.getElementById('content');\n                  contentElement.innerHTML = fullHtml;\n              };\n      window.iFrameResizer = {\n          onMessage: handleMessage\n      }\n  </script>\n  </html>\n  `;\n    return code;\n  }\n  const ReturnButton = styled.div`\n    cursor: pointer;\n  `;\n\n  function TopSection() {\n    return (\n      <MainSection>\n        {detailsPage ? (\n          <div>\n            <TopCardTitle>\n              <ReturnButton onClick={() => updateDetailsPage(null)}>\n                <Widget src={`${rootUser}/widget/nw-details-return`} />\n              </ReturnButton>\n              {\"Edition\"} {detailsPage?.Number ? detailsPage.Number : \"\"}\n            </TopCardTitle>\n            <TopCard>\n              <TopCardBody>\n                <CardContent>\n                  <img\n                    className=\"rounded\"\n                    width=\"100%\"\n                    height=\"100%\"\n                    src={nwSite + detailsPage.Thumbnail.url}\n                    alt={detailsPage.Thumbnail.alternativeText}\n                  />\n                </CardContent>\n              </TopCardBody>\n\n              <CardFooter>\n                {sections ? (\n                  <iframe\n                    iframeResizer\n                    className=\"w-100\"\n                    srcDoc={generateCode()}\n                    message={{\n                      data: sections.map((section) => {\n                        return {\n                          ...el,\n                          content: section.content.replace(\n                            /<img([^>]*)src=\"\\/uploads\\//g,\n                            `<img width=\"100%\" $1src=\"http://nearweek.com/uploads/`\n                          ),\n                        };\n                      }),\n                    }}\n                  />\n                ) : (\n                  <div />\n                )}\n              </CardFooter>\n            </TopCard>\n          </div>\n        ) : (\n          <div>Loading ...</div>\n        )}\n      </MainSection>\n    );\n  }\n  const BottomContainer = styled.div`\n      tranform:translateY:50px !important;\n`;\n  function BottomSection() {\n    return (\n      <Widget\n        props={{\n          updateDetailsPage,\n        }}\n        src={`${rootUser}/widget/nw-details-bottom`}\n      />\n    );\n  }\n\n  return (\n    <Theme>\n      <Widget src={`${rootUser}/widget/nw-navbar`} />\n      <MainContainer>\n        <TopSection />\n        <BottomContainer>\n          <BottomSection />\n        </BottomContainer>\n      </MainContainer>\n    </Theme>\n  );\n}\n\nreturn <NewsletterCard />;\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/nearweekapp.near/widget/nw-newsletter-more", "fact_widget_deployments_id": "312cb50f804d42c17120e362b8d07e05", "inserted_timestamp": "2023-10-12T13:27:09.778Z", "modified_timestamp": "2023-10-12T13:27:09.778Z", "__row_index": 21}