{"tx_hash": "imjG2xsuhWBLvdnttvydVp8L6GDY97b57V7huUAL47A", "action_id_social": "GAgTbBAgw1Jwr4T67kNbtAoKrkFwKs3HrMxh4pvBkixg-0-widget", "block_id": 106797119, "block_timestamp": "2023-11-29T09:11:31.420Z", "signer_id": "nearweekapp.near", "widget_name": "nw-audio-more", "source_code": "const rootUser = \"nearweekapp.near\";\r\nconst breakpoints = { md: \"768px\", lg: \"1100px\", xl: \"1300px\" };\r\n\r\nfunction NewsletterCard() {\r\n  const accountId = \"near\";\r\n  articles;\r\n  State.init({ active: 0 });\r\n  const nwSite = \"https://nearweek.com\";\r\n  let posts = [];\r\n  const indexedPosts = Social.index(\"post\", \"main\", {\r\n    accountId,\r\n    limit: 20,\r\n    order: \"desc\",\r\n  });\r\n  if (indexedPosts?.length > 0) {\r\n    posts = indexedPosts\r\n      .map((post) => {\r\n        const data = Social.get(\r\n          `${post.accountId}/post/main`,\r\n          post.blockHeight\r\n        );\r\n        if (!data) return;\r\n        const json = JSON.parse(data);\r\n        const content = json.text.split(\"\\n\");\r\n        const title = content[0] || \"\";\r\n        const url = content[1] || content[2] || \"\";\r\n        const lastLine = content.pop() || \"\";\r\n        const hasNewsTag = lastLine.includes(\"#news\");\r\n        const isValid = hasNewsTag && url.includes(\"https://\");\r\n        if (isValid) {\r\n          const block = Near.block(post.blockHeight);\r\n          const createdAt = block\r\n            ? new Date(\r\n                parseFloat(block.header.timestamp_nanosec) / 1e6\r\n              ).toISOString()\r\n            : \"\";\r\n          return {\r\n            blockHeight: post.blockHeight,\r\n            title,\r\n            url,\r\n            thumbnail: \"https://near.org/favicon.png\",\r\n            createdAt,\r\n            categories: [\"Near ORG\", \"blog\"],\r\n          };\r\n        }\r\n      })\r\n      .filter(Boolean);\r\n    posts.sort((a, b) => b.blockHeight - a.blockHeight);\r\n  }\r\n\r\n  const cssFont = fetch(\"https://fonts.cdnfonts.com/css/hubot-sans\").body;\r\n  if (!cssFont) return \"\";\r\n  if (!state.theme) {\r\n    State.update({\r\n      theme: styled.div`\r\n        font-family: 'Mona Sans', sans-serif;\r\n        font-style: normal;\r\n        ${cssFont}\r\n      }`,\r\n    });\r\n  }\r\n  const Theme = state.theme;\r\n\r\n  const TopCardTitle = styled.h2`\r\n     overflow: hidden;\r\n      color: #1C1F41;\r\n      text-overflow: ellipsis;\r\n      whitespace: nowrap;\r\n      font-family: Inter;\r\n      font-size: 18px;\r\n      font-style: normal;\r\n      font-weight: 500;\r\n      display:grid;\r\n      gap:20px;\r\n      margin-bottom:27px;\r\n    `;\r\n\r\n  const MainSection = styled.div`\r\n    padding: 0;\r\n    @media screen and (min-width: ${breakpoints.lg}) {\r\n      padding: 30px 16px 20px 16px;\r\n      width: 100%;\r\n    }\r\n    `;\r\n  const MainContainer = styled.div`\r\n    display:flex;\r\n    flex-direction:column;\r\n    justify-content: center; \r\n    justify-items: center; \r\n    margin-top: 32px;\r\n      @media screen and (min-width: ${breakpoints.lg}) {\r\n        width: 100%;\r\n        display: flex;\r\n        grid-column-gap: 20px;\r\n        flex-direction: row-reverse;\r\n      }\r\n    `;\r\n\r\n  const audioDetails = props.audioDetails;\r\n  const updateAudioDetails = props.updateAudioDetails;\r\n\r\n  const ReturnButton = styled.div`\r\n    cursor: pointer;\r\n  `;\r\n  const AudioContainer = styled.div`\r\n    width: 80%;\r\n      @media screen and (max-width: ${breakpoints.lg}) {\r\n        width: 100%;\r\n      }\r\n  `;\r\n\r\n  const ContentContainer = styled.div`\r\n  `;\r\n  const AudioContent = styled.div`\r\n    display: flex;\r\n    gap: 1.5rem;\r\n  `;\r\n\r\n  const Title = styled.h2`\r\n    font-size: 1.5rem;\r\n    font-weight: 600;\r\n    margin-left: 4px;\r\n  `;\r\n  console.log(audioDetails, \"audioDetails1\");\r\n  function TopSection() {\r\n    return (\r\n      <MainSection>\r\n        {audioDetails ? (\r\n          <AudioContainer>\r\n            <TopCardTitle>\r\n              <ReturnButton onClick={() => updateAudioDetails(null)}>\r\n                <Widget src={`${rootUser}/widget/details-return`} />\r\n              </ReturnButton>\r\n              <ContentContainer>\r\n                <AudioContent>\r\n                  <img\r\n                    src={audioDetails.thumbnail}\r\n                    width=\"132\"\r\n                    height=\"132\"\r\n                    alt=\"\"\r\n                    style={{ borderRadius: \"8px\" }}\r\n                  />\r\n                  <div>\r\n                    <Title>{audioDetails.title}</Title>\r\n                    <iframe\r\n                      style={{ width: \"100%\" }}\r\n                      srcDoc={audioDetails.description}\r\n                    />\r\n                  </div>\r\n                </AudioContent>\r\n                <div className=\"raw-html-embed\">\r\n                  <iframe\r\n                    style={{ width: \"100%\" }}\r\n                    src={audioDetails.frameSrc}\r\n                  />\r\n                </div>\r\n                <Widget\r\n                  props={{\r\n                    updateAudioDetails,\r\n                    audioCardFullWidth: true,\r\n                  }}\r\n                  src={`${rootUser}/widget/nw-audio`}\r\n                />\r\n              </ContentContainer>\r\n            </TopCardTitle>\r\n          </AudioContainer>\r\n        ) : (\r\n          <div>Loading ...</div>\r\n        )}\r\n      </MainSection>\r\n    );\r\n  }\r\n  const BottomContainer = styled.div`\r\n    display: none;\r\n    transform: translateY(50px);\r\n    @media screen and (min-width: ${breakpoints.lg}) {\r\n      display: block;\r\n    }\r\n`;\r\n\r\n  function AudioCard() {\r\n    return (\r\n      <Widget\r\n        props={{\r\n          updateAudioDetails,\r\n        }}\r\n        src={`${rootUser}/widget/nw-audio`}\r\n      />\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Theme>\r\n      <Widget src={`${rootUser}/widget/nw-navbar`} />\r\n      <MainContainer>\r\n        <TopSection />\r\n        <BottomContainer>\r\n          <AudioCard />\r\n        </BottomContainer>\r\n      </MainContainer>\r\n    </Theme>\r\n  );\r\n}\r\n\r\nreturn <NewsletterCard />;\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/nearweekapp.near/widget/nw-audio-more", "fact_widget_deployments_id": "9c664a081d738bfde43954d7f72e9510", "inserted_timestamp": "2023-11-29T11:22:05.567Z", "modified_timestamp": "2023-11-29T11:22:05.567Z", "__row_index": 5}