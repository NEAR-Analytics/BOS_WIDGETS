{"tx_hash": "8KUam7wrnEvp8492ivMtFoKRFeJCZie3LVaeYm2CRLaa", "action_id_social": "79H18MDjF32DnVfMGrCaRQN1bjvvJwkY3iqcSnRmZ5HV-0-widget", "block_id": 105796736, "block_timestamp": "2023-11-16T03:21:04.473Z", "signer_id": "detextre4.near", "widget_name": "poke-fight", "source_code": "// * STYLES\nconst Wrapper = styled.div`\n  --size: 220px;\n  \n  min-height: 100vh;\n  background-image: linear-gradient(#ffffff 1.1rem, #ccc 1.2rem);\n  background-size: 100% 1.2rem;\n\n  &.finished {\n    display: grid;\n    place-content: center;\n  }\n\n  * {\n    padding: 0;\n    margin: 0;\n    box-sizing: border-box;\n    font-family: Fantasy;\n  }\n\n  h2 {\n    text-align: center;\n    margin-bottom: 14px;\n  }\n`,\n  Grid = styled.div`\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(min(100%, var(--size)), 1fr));\n  place-items: center;\n  gap: 40px;`,\n  Pokeball = styled.div`\n--primary: #f71b1b;\n--accent: #000;\n--bg: #f7f7f7;\n--br: 50%;\n\n  position: relative;\n  width: var(--size);\n  height: var(--size);\n  background: var(--bg);\n  box-shadow: 2px 2px 6px 2px rgba(0, 0, 0, .4);\n  display: grid;\n  place-items: center;\n  font-size: 25px;\n  font-weight: bold;\n  border-radius: var(--br);\n  isolation: isolate;\n  transition: all var(--animationDuration) ease;\n\n  &.deleted {\n    translate: 0 -100px;\n    opacity: 0;\n  }\n\n  &:before, &:after { pointer-events: none }\n\n  &:before {\n    position: absolute;\n    content: \"\";\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 25px;\n    font-weight: bold;\n    border: 4px solid var(--accent);\n\n    background: linear-gradient(to bottom left, var(--primary), var(--primary) 49%, var(--accent) 49%, var(--accent) 50.5%, var(--bg) 50.5%);\n    top: 0;\n    right: 0;\n    border-radius: var(--br);\n    transition: all 0.5s;\n  }\n\n  &:hover:before, &.opened:before {\n    width: 20%;\n    height: 20%;\n    border-radius: 0 var(--br) 0 100%;\n\n    background: linear-gradient(to bottom left, var(--primary), var(--primary) 72%, var(--accent) 72%, var(--accent) 70%, var(--bg) 70%);\n    transition: all 0.5s;\n  }\n\n  &:after {\n    content: \"\";\n    position: absolute;\n    inset: 0;\n    margin: auto;\n    width: 40px;\n    height: 40px;\n    background: var(--bg);\n    border: 4px solid var(--accent);\n    border-radius: 50%;\n    z-index: 1;\n    transition: all var(--animationDuration);\n  }\n  &:hover:after, &.opened:after {\n    opacity: 0;\n    translate: -70px 70px;\n    scale: .5;\n  }\n\n  * {\n    z-index: -1;\n    pointer-events: none;\n    user-select: none;\n  }\n  &:hover * { pointer-events: all }\n\n  img {\n    width: 60%;\n    object-fit: cover;\n    cursor: grab;\n  }\n\n  h5 {\n    position: absolute;\n    bottom: 10%;\n    pointer-events: none;\n  }\n\n  .health-bar {\n    position: absolute;\n    right: 10%;\n    width: 20px;\n    height: 50%;\n    background: var(--accent);\n    border-radius: 5px;\n  }\n\n  .health-bar div {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    border: 2px solid var(--accent);\n    border-radius: 5px;\n    transition: all .2s ease;\n    &.hide { height: 0% }\n\n    &.bar-1 {\n      height: 100%;\n      background: green;\n    }\n    &.bar-2 {\n      height: 65%;\n      background: blue;\n    }\n    &.bar-3 {\n      height: 45%;\n      background: yellow;\n    }\n    &.bar-4 {\n      height: 25%;\n      background: red;\n    }\n  }\n`;\n\n// * SCRIPT\nState.init({ pokemons: [], started: false, currentDrag: null });\n\nconst API = \"https://pokeapi.co/api/v2\",\n  LIMIT = props.limit,\n  OFFSET = props.offset,\n  animationDuration = 200;\n\nfunction getPokemons() {\n  if (state.started) return;\n\n  asyncFetch(`${API}/pokemon?limit=${LIMIT}&offset=${OFFSET}`)\n    .then(({ body }) => {\n      let pokemons = [];\n\n      for (const item of body.results) {\n        const { body } = fetch(item.url);\n\n        pokemons.push({\n          name: body.name,\n          image: body.sprites.other[\"official-artwork\"].front_default,\n          moves: body.moves?.map((item) => item.move.name),\n          health: [1, 2, 3, 4],\n        });\n      }\n\n      State.update({ pokemons, started: true });\n    })\n    .catch((error) => console.error(error));\n}\ngetPokemons();\n\nfunction getRandomInt(max) {\n  const min = 0;\n  max = Math.floor(max);\n\n  return Math.floor(Math.random() * (max - min + 1) + min);\n}\n\nfunction onDragStart(pokemonIndex) {\n  const pokemons = state.pokemons;\n  if (pokemons[state.currentDrag]) {\n    pokemons[state.currentDrag].opened = false;\n    pokemons[state.currentDrag].attack = null;\n  }\n\n  State.update({ pokemons, currentDrag: pokemonIndex });\n}\n\nfunction openPokeball(event, pokemonIndex) {\n  event.preventDefault();\n\n  const pokemons = state.pokemons;\n  if (pokemons[pokemonIndex].opened) return;\n\n  pokemons[pokemonIndex].opened = true;\n  State.update({ pokemons });\n}\n\nfunction closePokeball(pokemonIndex) {\n  if (state.currentDrag == pokemonIndex) return;\n\n  const pokemons = state.pokemons;\n  pokemons[pokemonIndex].opened = false;\n  pokemons[state.currentDrag].attack = null;\n  State.update({ pokemons });\n}\n\nfunction attack(pokemonIndex) {\n  if (state.currentDrag == pokemonIndex) return;\n  const pokemons = state.pokemons;\n\n  // show attack dialog\n  if (pokemons[state.currentDrag])\n    pokemons[state.currentDrag].attack =\n      pokemons[state.currentDrag].moves[\n        getRandomInt(pokemons[state.currentDrag].moves.length)\n      ];\n\n  // animation decrease helath\n  pokemons[pokemonIndex].health[0] = 0;\n  State.update({ pokemons });\n\n  // decrease helath\n  setTimeout(() => decreaseHealth(pokemons, pokemonIndex), animationDuration);\n}\n\nfunction decreaseHealth(pokemons, pokemonIndex) {\n  if (pokemons[pokemonIndex].health.length <= 1)\n    return deletePokemon(pokemons, pokemonIndex);\n\n  pokemons[pokemonIndex].health.shift();\n  State.update({ pokemons });\n}\n\nfunction deletePokemon(pokemons, pokemonIndex) {\n  pokemons[state.currentDrag].attack = null;\n\n  // animation delete pokemon\n  pokemons[pokemonIndex].deleted = true;\n  State.update({ pokemons });\n\n  // delete pokemon\n  setTimeout(() => {\n    pokemons.splice(pokemonIndex, 1);\n    State.update({ pokemons });\n  }, animationDuration);\n}\n\n// * TEMPLATE RENDER\nreturn (\n  <Wrapper className={state.pokemons.length > 1 ? \"\" : \"finished\"}>\n    <h2>\n      {state.pokemons.length > 1\n        ? \"Drag pokemons to attack\"\n        : `${state.pokemons[0].name} won !!`}\n    </h2>\n    <Grid>\n      {state.pokemons.map((pokemon, index) => (\n        <Pokeball\n          className={`${pokemon.deleted ? \"deleted\" : \"\"} ${\n            pokemon.opened ? \"opened\" : \"\"\n          }`}\n          style={{ \"--animationDuration\": `${animationDuration}ms` }}\n          onDrop={(_) => attack(index)}\n          onDragOver={(event) => openPokeball(event, index)}\n          onDragLeave={(_) => closePokeball(index)}\n          onMouseLeave={(_) => closePokeball(index)}\n        >\n          <div className=\"health-bar\">\n            {pokemon.health.map((health, i) => (\n              <div\n                className={`bar-${health} ${health != i + 1 ? \"hide\" : \"\"}`}\n                style={{ \"--n\": health }}\n              ></div>\n            ))}\n          </div>\n\n          <OverlayTrigger\n            placement=\"top\"\n            show={!!pokemon.attack}\n            overlay={<Tooltip>{pokemon.attack}</Tooltip>}\n          >\n            <img\n              src={pokemon.image}\n              alt={`${pokemon.name}'s image`}\n              onDragStart={(_) => onDragStart(index)}\n            />\n          </OverlayTrigger>\n          <h5>{pokemon.name}</h5>\n        </Pokeball>\n      ))}\n    </Grid>\n  </Wrapper>\n);\n", "metadata": {"platform": "jutsu.ai", "website": "https://near.social/detextre4.near/widget/poke-fight"}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/detextre4.near/widget/poke-fight", "fact_widget_deployments_id": "217d47e5cf19ba3d9fd0629b61ffd19a", "inserted_timestamp": "2023-11-16T05:23:11.701Z", "modified_timestamp": "2023-11-16T05:23:11.701Z", "__row_index": 3}