{"tx_hash": "5wenKy2U4BUXrbs3VjSRLDPJtc3Xw6YQwy1SYg6spiNf", "action_id_social": "FPpKEc7sboSHvaXoyR22R7tUREAPK9syUDfFzZbH7CKV-0-widget", "block_id": 104716715, "block_timestamp": "2023-11-01T21:49:33.238Z", "signer_id": "devgovgigs.petersalomonsen.near", "widget_name": "devhub.entity.addon.blog.Creator", "source_code": "const { Card } =\n  VM.require(\"${REPL_DEVHUB}/widget/devhub.entity.addon.blog.Card\") ||\n  (() => <></>);\nconst { Page } =\n  VM.require(\"${REPL_DEVHUB}/widget/devhub.entity.addon.blog.Page\") ||\n  (() => <></>);\n\nconst categories = [\n  {\n    label: \"Guide\",\n    value: \"guide\",\n  },\n  {\n    label: \"News\",\n    value: \"news\",\n  },\n];\n\nconst Banner = styled.div`\n  border-radius: var(--bs-border-radius-xl) !important;\n  height: 100%;\n\n  & > div :not(.btn) {\n    position: absolute;\n    display: none;\n    margin: 0 !important;\n    width: 0 !important;\n    height: 0 !important;\n  }\n\n  .btn {\n    padding: 0.5rem 0.75rem !important;\n    min-height: 32;\n    line-height: 1;\n\n    border: none;\n    border-radius: 50px;\n    --bs-btn-color: #ffffff;\n    --bs-btn-bg: #087990;\n    --bs-btn-border-color: #087990;\n    --bs-btn-hover-color: #ffffff;\n    --bs-btn-hover-bg: #055160;\n    --bs-btn-hover-border-color: #055160;\n    --bs-btn-focus-shadow-rgb: 49, 132, 253;\n    --bs-btn-active-color: #ffffff;\n    --bs-btn-active-bg: #055160;\n    --bs-btn-active-border-color: #055160;\n    --bs-btn-active-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);\n    opacity: 0.8;\n\n    &:hover {\n      opacity: 1;\n    }\n  }\n`;\n\nconst FormContainer = styled.div`\n  & > *:not(:last-child) {\n    margin-bottom: 1rem;\n  }\n`;\n\nconst { data, handle } = props;\n\nconst initialData = data; // TODO: Check Storage API\n\nconst [content, setContent] = useState(initialData.content || \"\");\nconst [title, setTitle] = useState(initialData.title || \"\");\nconst [subtitle, setSubtitle] = useState(initialData.subtitle || \"\");\nconst [description, setDescription] = useState(initialData.description || \"\");\nconst [author, setAuthor] = useState(initialData.author || \"\");\nconst [previewMode, setPreviewMode] = useState(\"card\"); // \"card\" or \"page\"\nconst [date, setDate] = useState(new Date().toISOString().split(\"T\")[0]);\nconst [category, setCategory] = useState(\"guide\");\n\n// Legacy State.init for IpfsUploader\nState.init({\n  image: {\n    cid: \"bafkreic4xgorjt6ha5z4s5e3hscjqrowe5ahd7hlfc5p4hb6kdfp6prgy4\",\n  },\n});\n\nconst Container = styled.div`\n  width: 100%;\n  margin: 0 auto;\n  padding: 20px;\n  text-align: left;\n`;\n\nconst cidToURL = (cid) => `https://ipfs.near.social/ipfs/${cid}`;\n\nconst hasDataChanged = () => {\n  return (\n    content !== initialData.content ||\n    title !== initialData.title ||\n    author !== initialData.author\n  );\n};\n\nconst handlePublish = () => {\n  Near.call({\n    contractName: \"${REPL_DEVHUB_CONTRACT}\",\n    methodName: \"add_post\",\n    args: {\n      labels: [\"blog\", handle],\n      body: {\n        post_type: \"Comment\",\n        description: JSON.stringify({\n          title,\n          subtitle,\n          description,\n          date,\n          content,\n          author,\n          image: state.image.cid,\n          tags: data.includeLabels,\n          community: handle,\n        }),\n        comment_version: \"V2\",\n      },\n    },\n    deposit: Big(10).pow(21).mul(2),\n    gas: Big(10).pow(12).mul(100),\n  });\n};\n\nfunction Preview() {\n  switch (previewMode) {\n    case \"card\": {\n      return (\n        <Card\n          title={title}\n          subtitle={subtitle}\n          description={description}\n          date={date}\n          content={content}\n          author={author}\n          image={state.image}\n          tags={data.includeLabels} // filter out \"blog\" and community handle?\n          community={handle}\n        />\n      );\n    }\n    case \"page\": {\n      return (\n        <Page\n          title={title}\n          subtitle={subtitle}\n          description={description}\n          date={date}\n          content={content}\n          author={author}\n          image={state.image}\n          tags={data.includeLabels} // filter out \"blog\" and community handle?\n          community={handle}\n        />\n      );\n    }\n  }\n}\n\nreturn (\n  <Container>\n    <ul className=\"nav nav-tabs\" id=\"editPreviewTabs\" role=\"tablist\">\n      <li className=\"nav-item\" role=\"presentation\">\n        <button\n          className=\"nav-link active\"\n          id=\"edit-tab\"\n          data-bs-toggle=\"tab\"\n          data-bs-target=\"#edit\"\n          type=\"button\"\n          role=\"tab\"\n          aria-controls=\"edit\"\n          aria-selected=\"true\"\n        >\n          Edit\n        </button>\n      </li>\n      <li className=\"nav-item\" role=\"presentation\">\n        <button\n          className=\"nav-link\"\n          id=\"preview-tab\"\n          data-bs-toggle=\"tab\"\n          data-bs-target=\"#preview\"\n          type=\"button\"\n          role=\"tab\"\n          aria-controls=\"preview\"\n          aria-selected=\"false\"\n        >\n          Preview\n        </button>\n      </li>\n    </ul>\n    <div className=\"tab-content\" id=\"editPreviewTabsContent\">\n      <div\n        className=\"tab-pane show active p-4\"\n        id=\"edit\"\n        role=\"tabpanel\"\n        aria-labelledby=\"edit-tab\"\n      >\n        <FormContainer>\n          <div style={{ height: 280 }}>\n            <Banner\n              alt=\"Blog background Preview\"\n              className=\"card-img-top d-flex flex-column justify-content-end align-items-end p-4\"\n              style={{\n                background: `center / cover no-repeat url(${cidToURL(\n                  state.image.cid\n                )})`,\n              }}\n            >\n              <IpfsImageUpload image={state.image} />\n            </Banner>\n          </div>\n          <div>\n            <h5>Title</h5>\n            <div className=\"flex-grow-1\">\n              <Widget\n                src=\"${REPL_DEVHUB}/widget/devhub.components.molecule.Input\"\n                props={{\n                  className: \"flex-grow-1\",\n                  onChange: (e) => setTitle(e.target.value),\n                  value: title,\n                  placeholder: \"Title\",\n                }}\n              />\n            </div>\n          </div>\n          <div>\n            <h5>Subtitle</h5>\n            <div className=\"flex-grow-1\">\n              <Widget\n                src=\"${REPL_DEVHUB}/widget/devhub.components.molecule.Input\"\n                props={{\n                  className: \"flex-grow-1\",\n                  onChange: (e) => setSubtitle(e.target.value),\n                  value: subtitle,\n                  placeholder: \"Subtitle\",\n                }}\n              />\n            </div>\n          </div>\n          <div>\n            <h5>Category</h5>\n            <div className=\"flex-grow-1\">\n              <Widget\n                src={\"${REPL_NEAR}/widget/DIG.InputSelect\"}\n                props={{\n                  groups: [\n                    {\n                      items: categories.map((it) => ({\n                        label: it.label,\n                        value: it.value,\n                      })),\n                    },\n                  ],\n                  rootProps: {\n                    value: category,\n                    placeholder: \"Select a category\",\n                    onValueChange: (v) => setCategory(v),\n                  },\n                }}\n              />\n            </div>\n          </div>\n          <div>\n            <h5>Description</h5>\n            <div className=\"flex-grow-1\">\n              <Widget\n                src=\"${REPL_DEVHUB}/widget/devhub.components.molecule.Input\"\n                props={{\n                  className: \"flex-grow-1\",\n                  onChange: (e) => setDescription(e.target.value),\n                  value: description,\n                  placeholder: \"Description\",\n                }}\n              />\n            </div>\n          </div>\n          <div>\n            <h5>Author</h5>\n            <div className=\"flex-grow-1\">\n              <Widget\n                src=\"${REPL_DEVHUB}/widget/devhub.components.molecule.Input\"\n                props={{\n                  className: \"flex-grow-1\",\n                  onChange: (e) => setAuthor(e.target.value),\n                  value: author,\n                  placeholder: \"Author\",\n                }}\n              />\n            </div>\n          </div>\n          <div>\n            <h5>Content</h5>\n            <Widget\n              src=\"${REPL_DEVHUB}/widget/devhub.components.molecule.MarkdownEditor\"\n              props={{ data: { content }, onChange: setContent }}\n            />\n          </div>\n          <div>\n            <h5>Date</h5>\n            <input\n              type=\"date\"\n              value={date}\n              onChange={(e) => setDate(e.target.value)}\n            />\n          </div>\n        </FormContainer>\n        <div\n          className={\"d-flex align-items-center justify-content-end gap-3 mt-4\"}\n        >\n          <Widget\n            src={\"${REPL_DEVHUB}/widget/devhub.components.molecule.Button\"}\n            props={{\n              classNames: { root: \"btn-success\" },\n              disabled: !hasDataChanged(),\n              icon: {\n                type: \"bootstrap_icon\",\n                variant: \"bi-check-circle-fill\",\n              },\n              label: \"Publish\",\n              onClick: handlePublish,\n            }}\n          />\n        </div>\n      </div>\n      <div\n        className=\"tab-pane\"\n        id=\"preview\"\n        role=\"tabpanel\"\n        aria-labelledby=\"preview-tab\"\n        style={{ position: \"relative\" }}\n      >\n        <div style={{ position: \"absolute\", top: 10, right: 0 }}>\n          <Widget\n            // LEGACY\n            src=\"${REPL_DEVHUB}/widget/gigs-board.components.molecule.button-switch\"\n            props={{\n              currentValue: previewMode,\n              key: \"previewMode\",\n              onChange: (e) => setPreviewMode(e.target.value),\n              options: [\n                { label: \"Card\", value: \"card\" },\n                { label: \"Page\", value: \"page\" },\n              ],\n\n              title: \"Preview mode selection\",\n            }}\n          />\n        </div>\n        <div className=\"w-100 h-100 p-4\">\n          <Preview />\n        </div>\n      </div>\n    </div>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/devgovgigs.petersalomonsen.near/widget/devhub.entity.addon.blog.Creator", "fact_widget_deployments_id": "27f96264e15e2614650f2027ce0c0c4f", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 2}