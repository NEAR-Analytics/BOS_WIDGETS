{"tx_hash": "2TPFAsf7Nu8U3G7Xb5qvrpnNZYAjeciQhKyQubopmuXM", "action_id_social": "KW639n2nu8hRtUqpuJfb2TaLaERgcsK8Upi9aQh1Xwy-0-widget", "block_id": 116701640, "block_timestamp": "2024-04-12T18:13:57.330Z", "signer_id": "devgovgigs.petersalomonsen.near", "widget_name": "devhub.entity.community.Announcements", "source_code": "const { handle } = props;\nconst { getCommunity, setCommunitySocialDB } = VM.require(\n  \"devgovgigs.petersalomonsen.near/widget/core.adapter.devhub-contract\"\n);\n\ngetCommunity = getCommunity || (() => <></>);\nsetCommunitySocialDB = setCommunitySocialDB || (() => <></>);\n\nconst communityData = getCommunity({ handle });\nconst [postsExists, setPostExists] = useState(false);\nconst [newUnseenPosts, setNewUnseenPosts] = useState([]);\nconst [lastQueryRequestTimestamp, setLastQueryRequestTimestamp] = useState(\n  new Date().getTime()\n);\nconst [submittedAnnouncementData, setSubmittedAnnouncementData] =\n  useState(null);\nconst communityAccountId = `${handle}.community.devhub.near`;\n\nlet checkIndexerInterval;\nconst onNewUnseenPosts = (newUnseenPosts) => {\n  if (newUnseenPosts.length > 0) {\n    clearInterval(checkIndexerInterval);\n  }\n};\n\nuseEffect(() => {\n  if (submittedAnnouncementData) {\n    const checkForAnnouncementInSocialDB = () => {\n      Near.asyncView(\"social.near\", \"get\", {\n        keys: [`${communityAccountId}/post/**`],\n      }).then((result) => {\n        try {\n          const submittedAnnouncementText = JSON.parse(\n            submittedAnnouncementData.post.main\n          ).text;\n          const lastAnnouncementTextFromSocialDB = JSON.parse(\n            result[communityAccountId].post.main\n          ).text;\n          if (submittedAnnouncementText === lastAnnouncementTextFromSocialDB) {\n            setSubmittedAnnouncementData(null);\n            checkIndexerInterval = setInterval(() => {\n              setLastQueryRequestTimestamp(new Date().getTime());\n            }, 500);\n            return;\n          }\n        } catch (e) {}\n        setTimeout(() => checkForAnnouncementInSocialDB(), 1000);\n      });\n    };\n    checkForAnnouncementInSocialDB();\n  }\n}, [submittedAnnouncementData]);\n\nconst MainContent = styled.div`\n  padding-left: 2rem;\n  flex: 3;\n  @media screen and (max-width: 960px) {\n    padding-left: 0rem;\n  }\n  .post:hover {\n    background-color: inherit !important;\n  }\n`;\n\nconst SidebarContainer = styled.div`\n  flex: 1;\n`;\n\nconst Heading = styled.div`\n  font-size: 19px;\n  font-weight: 600;\n`;\n\nconst SubHeading = styled.div`\n  font-size: 15px;\n  font-weight: 600;\n`;\n\nconst Container = styled.div`\n  flex-wrap: no-wrap;\n  max-width: 100%;\n\n  .max-width-100 {\n    max-width: 100%;\n  }\n  @media screen and (max-width: 960px) {\n    flex-wrap: wrap;\n  }\n\n  .card {\n    border-radius: 1rem !important;\n  }\n\n  .display-none {\n    display: none;\n  }\n`;\n\nconst Tag = styled.div`\n  border-top-right-radius: 50px;\n  border-bottom-right-radius: 50px;\n  border-top-left-radius: 50px;\n  border-bottom-left-radius: 50px;\n  padding-inline: 0.8rem;\n  padding-block: 0.3rem;\n  display: flex;\n  gap: 0.5rem;\n  border-width: 1px;\n  border-style: solid;\n  font-size: 14px;\n  color: rgba(0, 236, 151, 1);\n  font-weight: 800;\n`;\n\nconst [sort, setSort] = useState(\"desc\");\n\nreturn (\n  <div className=\"w-100\" style={{ maxWidth: \"100%\" }}>\n    <Container className=\"d-flex gap-3 m-3 pl-2\">\n      <MainContent className=\"max-width-100\">\n        <div className=\"d-flex flex-column gap-4\">\n          {context.accountId &&\n            (communityData?.admins ?? []).includes(context.accountId) && (\n              <div className=\"card p-4\">\n                <Widget\n                  src={\"devgovgigs.petersalomonsen.near/widget/devhub.entity.community.Compose\"}\n                  props={{\n                    onSubmit: (v) => {\n                      setSubmittedAnnouncementData(v);\n                      setCommunitySocialDB({ handle, data: v });\n                    },\n                    profileAccountId: `${handle}.community.devhub.near`,\n                    isFinished: () => submittedAnnouncementData === null,\n                  }}\n                />\n              </div>\n            )}\n          <div className=\"d-flex flex-wrap justify-content-between\">\n            <Heading>Announcements</Heading>\n            <div\n              className={\n                postsExists\n                  ? \"d-flex align-items-center gap-2\"\n                  : \" display-none\"\n              }\n            >\n              <select\n                name=\"sort\"\n                id=\"sort\"\n                class=\"form-select\"\n                value={sort}\n                onChange={(e) => {\n                  setSort(e.target.value);\n                }}\n              >\n                <option selected value=\"desc\">\n                  Latest\n                </option>\n                <option value=\"recentcommentdesc\">Last Commented</option>\n              </select>\n            </div>\n          </div>\n          {!postsExists && (\n            <div>\n              <h6>No announcements exists.</h6>\n            </div>\n          )}\n          <div className={postsExists && \"card p-4\"}>\n            <Widget\n              src=\"devgovgigs.petersalomonsen.near/widget/devhub.components.organism.Feed\"\n              props={{\n                filteredAccountIds: [communityAccountId],\n                sort: sort,\n                setPostExists: setPostExists,\n                showFlagAccountFeature: true,\n                lastQueryRequestTimestamp,\n                onNewUnseenPosts,\n              }}\n            />\n          </div>\n        </div>\n      </MainContent>\n      <SidebarContainer>\n        <div className=\"d-flex flex-column gap-3\">\n          <div className=\"card p-4\">\n            <div className=\"mb-2\">{communityData?.description}</div>\n            <div className=\"d-flex gap-2 flex-wrap\">\n              <Tag>{communityData?.tag} </Tag>\n            </div>\n          </div>\n          <div className=\"card p-4 d-flex flex-column gap-2\">\n            <SubHeading>Community Admins</SubHeading>\n            {(communityData?.admins ?? []).map((accountId) => (\n              <div\n                key={accountId}\n                className=\"d-flex\"\n                style={{ fontWeight: 500 }}\n              >\n                <Widget\n                  src=\"devgovgigs.petersalomonsen.near/widget/devhub.components.molecule.ProfileCard\"\n                  props={{ accountId }}\n                />\n              </div>\n            ))}\n          </div>\n        </div>\n      </SidebarContainer>\n    </Container>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/devgovgigs.petersalomonsen.near/widget/devhub.entity.community.Announcements", "fact_widget_deployments_id": "de6ebf14af9c6f3728fa340e71b06b0c", "inserted_timestamp": "2024-04-12T19:33:35.133Z", "modified_timestamp": "2024-04-12T19:33:35.133Z", "__row_index": 67}