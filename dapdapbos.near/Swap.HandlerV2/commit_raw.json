{"tx_hash": "6LqD6MoY9oezQP3W1WtrX7uFeu7F5TXr5RkVFG1DC4bJ", "action_id_social": "3e3S2aUJ9AeBgZ1UQBimWvaK8oXTArkeWMdSPCL2djHw-0-widget", "block_id": 104285073, "block_timestamp": "2023-10-27T02:15:35.339Z", "signer_id": "dapdapbos.near", "widget_name": "Swap.HandlerV2", "source_code": "const {\n  routerAddress,\n  wethAddress,\n  inputCurrencyAmount,\n  inputCurrency,\n  outputCurrencyAmount,\n  outputCurrency,\n  account,\n  onSuccess,\n  onError,\n  swapping,\n  title,\n} = props;\n\nif (!swapping) return;\n\nconst handleCamelotSwap = (type) => {\n  const RouterContract = new ethers.Contract(\n    routerAddress,\n    [\n      {\n        inputs: [\n          { internalType: \"uint256\", name: \"amountIn\", type: \"uint256\" },\n          {\n            internalType: \"uint256\",\n            name: \"amountOutMin\",\n            type: \"uint256\",\n          },\n          { internalType: \"address[]\", name: \"path\", type: \"address[]\" },\n          { internalType: \"address\", name: \"to\", type: \"address\" },\n          { internalType: \"address\", name: \"referrer\", type: \"address\" },\n          { internalType: \"uint256\", name: \"deadline\", type: \"uint256\" },\n        ],\n        name: \"swapExactTokensForTokensSupportingFeeOnTransferTokens\",\n        outputs: [],\n        stateMutability: \"nonpayable\",\n        type: \"function\",\n      },\n      {\n        inputs: [\n          {\n            internalType: \"uint256\",\n            name: \"amountOutMin\",\n            type: \"uint256\",\n          },\n          { internalType: \"address[]\", name: \"path\", type: \"address[]\" },\n          { internalType: \"address\", name: \"to\", type: \"address\" },\n          { internalType: \"address\", name: \"referrer\", type: \"address\" },\n          { internalType: \"uint256\", name: \"deadline\", type: \"uint256\" },\n        ],\n        name: \"swapExactETHForTokensSupportingFeeOnTransferTokens\",\n        outputs: [],\n        stateMutability: \"payable\",\n        type: \"function\",\n      },\n      {\n        inputs: [\n          { internalType: \"uint256\", name: \"amountIn\", type: \"uint256\" },\n          {\n            internalType: \"uint256\",\n            name: \"amountOutMin\",\n            type: \"uint256\",\n          },\n          { internalType: \"address[]\", name: \"path\", type: \"address[]\" },\n          { internalType: \"address\", name: \"to\", type: \"address\" },\n          { internalType: \"address\", name: \"referrer\", type: \"address\" },\n          { internalType: \"uint256\", name: \"deadline\", type: \"uint256\" },\n        ],\n        name: \"swapExactTokensForETHSupportingFeeOnTransferTokens\",\n        outputs: [],\n        stateMutability: \"nonpayable\",\n        type: \"function\",\n      },\n    ],\n    Ethers.provider().getSigner()\n  );\n  if (type === 0) {\n    RouterContract.swapExactTokensForTokensSupportingFeeOnTransferTokens(\n      ethers.utils.parseUnits(inputCurrencyAmount, inputCurrency.decimals),\n      ethers.utils.parseUnits(outputCurrencyAmount, outputCurrency.decimals),\n      [inputCurrency.address, outputCurrency.address],\n      account,\n      \"0x0000000000000000000000000000000000000000\",\n      Math.ceil(Date.now() / 1000) + 60,\n      { gasLimit: 5000000 }\n    )\n      .then((tx) => {\n        onSuccess(tx);\n      })\n      .catch((err) => {\n        onerror(err);\n      });\n    return;\n  }\n  if (type === 1) {\n    RouterContract.swapExactETHForTokensSupportingFeeOnTransferTokens(\n      ethers.utils.parseUnits(outputCurrencyAmount, outputCurrency.decimals),\n      [wethAddress, outputCurrency.address],\n      account,\n      \"0x0000000000000000000000000000000000000000\",\n      Math.ceil(Date.now() / 1000) + 60,\n      { gasLimit: 5000000, value: ethers.utils.parseEther(inputCurrencyAmount) }\n    )\n      .then((tx) => {\n        onSuccess(tx);\n      })\n      .catch((err) => {\n        onError();\n      });\n    return;\n  }\n  if (type === 2) {\n    RouterContract.swapExactTokensForETHSupportingFeeOnTransferTokens(\n      ethers.utils.parseUnits(inputCurrencyAmount, inputCurrency.decimals),\n      ethers.utils.parseUnits(outputCurrencyAmount, outputCurrency.decimals),\n      [inputCurrency.address, wethAddress],\n      account,\n      \"0x0000000000000000000000000000000000000000\",\n      Math.ceil(Date.now() / 1000) + 60,\n      { gasLimit: 5000000 }\n    )\n      .then((tx) => {\n        onSuccess(tx);\n      })\n      .catch((err) => {\n        console.log(err);\n        onError(tx);\n      });\n  }\n};\n\nconst type =\n  inputCurrency.address === \"native\"\n    ? 1\n    : outputCurrency.address === \"native\"\n    ? 2\n    : 0;\n\nif (title === \"Camelot\") {\n  handleCamelotSwap(type);\n  return;\n}\nconst RouterContract = new ethers.Contract(\n  routerAddress,\n  [\n    {\n      inputs: [\n        {\n          internalType: \"uint256\",\n          name: \"amountOut\",\n          type: \"uint256\",\n        },\n        {\n          internalType: \"uint256\",\n          name: \"amountInMax\",\n          type: \"uint256\",\n        },\n        {\n          internalType: \"address[]\",\n          name: \"path\",\n          type: \"address[]\",\n        },\n        {\n          internalType: \"address\",\n          name: \"to\",\n          type: \"address\",\n        },\n        {\n          internalType: \"uint256\",\n          name: \"deadline\",\n          type: \"uint256\",\n        },\n      ],\n      name: \"swapExactTokensForTokens\",\n      outputs: [\n        {\n          internalType: \"uint256[]\",\n          name: \"amounts\",\n          type: \"uint256[]\",\n        },\n      ],\n      stateMutability: \"nonpayable\",\n      type: \"function\",\n    },\n    {\n      inputs: [\n        {\n          internalType: \"uint256\",\n          name: \"amountOutMin\",\n          type: \"uint256\",\n        },\n        { internalType: \"address[]\", name: \"path\", type: \"address[]\" },\n        { internalType: \"address\", name: \"to\", type: \"address\" },\n        { internalType: \"uint256\", name: \"deadline\", type: \"uint256\" },\n      ],\n      name: \"swapExactETHForTokens\",\n      outputs: [\n        { internalType: \"uint256[]\", name: \"amounts\", type: \"uint256[]\" },\n      ],\n      stateMutability: \"payable\",\n      type: \"function\",\n    },\n    {\n      inputs: [\n        { internalType: \"uint256\", name: \"amountIn\", type: \"uint256\" },\n        {\n          internalType: \"uint256\",\n          name: \"amountOutMin\",\n          type: \"uint256\",\n        },\n        { internalType: \"address[]\", name: \"path\", type: \"address[]\" },\n        { internalType: \"address\", name: \"to\", type: \"address\" },\n        { internalType: \"uint256\", name: \"deadline\", type: \"uint256\" },\n      ],\n      name: \"swapExactTokensForETH\",\n      outputs: [\n        { internalType: \"uint256[]\", name: \"amounts\", type: \"uint256[]\" },\n      ],\n      stateMutability: \"nonpayable\",\n      type: \"function\",\n    },\n  ],\n  Ethers.provider().getSigner()\n);\nif (type === 0) {\n  RouterContract.swapExactTokensForTokens(\n    ethers.utils.parseUnits(inputCurrencyAmount, inputCurrency.decimals),\n    \"0\",\n    [inputCurrency.address, outputCurrency.address],\n    account,\n    Math.ceil(Date.now() / 1000) + 60,\n    { gasLimit: 5000000 }\n  )\n    .then((tx) => {\n      onSuccess(tx);\n    })\n    .catch((err) => {\n      onError(err);\n    });\n  return;\n}\nif (type === 1) {\n  RouterContract.swapExactETHForTokens(\n    \"0\",\n    [wethAddress, outputCurrency.address],\n    account,\n    Math.ceil(Date.now() / 1000) + 60,\n    { gasLimit: 5000000, value: ethers.utils.parseEther(inputCurrencyAmount) }\n  )\n    .then((tx) => {\n      onSuccess(tx);\n    })\n    .catch((err) => {\n      onError(err);\n    });\n  return;\n}\nif (type === 2) {\n  RouterContract.swapExactTokensForETH(\n    ethers.utils.parseUnits(inputCurrencyAmount, inputCurrency.decimals),\n    \"0\",\n    [inputCurrency.address, wethAddress],\n    account,\n    Math.ceil(Date.now() / 1000) + 60,\n    { gasLimit: 5000000 }\n  )\n    .then((tx) => {\n      onSuccess(tx);\n    })\n    .catch((err) => {\n      onError(err);\n    });\n}\n\nreturn \"\";\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/dapdapbos.near/widget/Swap.HandlerV2", "fact_widget_deployments_id": "41dbdba1c853e3cc7f440ef641569afb", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}