{"tx_hash": "6LqD6MoY9oezQP3W1WtrX7uFeu7F5TXr5RkVFG1DC4bJ", "action_id_social": "3e3S2aUJ9AeBgZ1UQBimWvaK8oXTArkeWMdSPCL2djHw-0-widget", "block_id": 104285073, "block_timestamp": "2023-10-27T02:15:35.339Z", "signer_id": "dapdapbos.near", "widget_name": "Swap.QuoterSolidly", "source_code": "const {\n  update,\n  routerAddress,\n  wethAddress,\n  inputCurrency,\n  outputCurrency,\n  inputCurrencyAmount,\n  outputCurrencyAmount,\n  tradeType,\n  onLoad,\n} = props;\nconsole.log(\"props quoter : \", props);\n\nif (!update) return;\n\nif (!inputCurrency.address || !outputCurrency.address || !inputCurrencyAmount) {\n  onLoad({});\n  return;\n}\nconst wrapType =\n  inputCurrency.address === \"native\" && outputCurrency.address === wethAddress\n    ? 1\n    : inputCurrency.address === wethAddress &&\n      outputCurrency.address === \"native\"\n    ? 2\n    : 0;\nif (wrapType) {\n  onLoad(\n    tradeType === \"in\"\n      ? {\n          outputCurrencyAmount: inputCurrencyAmount,\n          loading: false,\n          noPair: false,\n        }\n      : {\n          inputCurrencyAmount: outputCurrencyAmount,\n          loading: false,\n          noPair: false,\n        }\n  );\n  return;\n}\nconst currentCurrency = tradeType === \"in\" ? inputCurrency : outputCurrency;\n\nconst currentAmount = Big(\n  tradeType === \"in\" ? inputCurrencyAmount : outputCurrencyAmount\n).toFixed();\nconst outCurrency = tradeType === \"in\" ? outputCurrency : inputCurrency;\n\nconst RouterContract = new ethers.Contract(\n  routerAddress,\n  [\n    {\n      inputs: [\n        { internalType: \"uint256\", name: \"amountIn\", type: \"uint256\" },\n        { internalType: \"address\", name: \"tokenIn\", type: \"address\" },\n        { internalType: \"address\", name: \"tokenOut\", type: \"address\" },\n      ],\n      name: \"getAmountOut\",\n      outputs: [\n        { internalType: \"uint256\", name: \"amount\", type: \"uint256\" },\n        { internalType: \"bool\", name: \"stable\", type: \"bool\" },\n      ],\n      stateMutability: \"view\",\n      type: \"function\",\n    },\n  ],\n  Ethers.provider().getSigner()\n);\nconst path = [\n  currentCurrency.address === \"native\" ? wethAddress : currentCurrency.address,\n  outCurrency.address === \"native\" ? wethAddress : outCurrency.address,\n];\n\nconst currentAmountUnit = Big(currentAmount)\n  .times(Big(10).pow(currentCurrency.decimals))\n  .toFixed(0);\n\nRouterContract.getAmountOut(currentAmountUnit, ...path)\n  .then((res) => {\n    const amount = Big(\n      ethers.utils.formatUnits(res[0], outCurrency.decimals)\n    ).toFixed();\n\n    onLoad({\n      outputCurrencyAmount: Big(amount).gt(0.01)\n        ? amount\n        : Big(amount).toFixed(),\n      noPair: !Big(amount || \"\").gt(0),\n      stable: res[1],\n    });\n  })\n  .catch((err) => {\n    onLoad({\n      loading: false,\n      noPair: true,\n      stable: false,\n    });\n  });\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/dapdapbos.near/widget/Swap.QuoterSolidly", "fact_widget_deployments_id": "af59958e5d681712e5dfb2119cd29f12", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}