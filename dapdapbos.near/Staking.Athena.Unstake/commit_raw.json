{"tx_hash": "FgFT72jTmj1vaiz7ooe7DpxHkRk7wiUco7SzUge1m7ZL", "action_id_social": "4mkZt3TBQnn72RYR2jAfBA8ArA3GMT9RDSUMz9kpLPmR-0-widget", "block_id": 110700805, "block_timestamp": "2024-01-18T08:39:12.010Z", "signer_id": "dapdapbos.near", "widget_name": "Staking.Athena.Unstake", "source_code": "const StakePanel = styled.div`\n  width: 510px;\n  margin: 0 auto;\n  /* reset input */\n  .bos-input-number {\n    background-color: var(--dark);\n    color: var(--white);\n    border: none;\n    border-radius: 10px !important;\n  }\n  .input-group {\n    column-gap: 5px;\n  }\n  .append-token {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    position: absolute;\n    right: 12px;\n    /* top: 4px; */\n    height: 36px;\n    z-index: 5;\n  }\n\n  .avatars {\n    margin-right: 20px;\n  }\n`;\nconst AmountList = styled.div`\n  display: flex;\n  font-size: var(--fz12);\n  color: var(--purple);\n  justify-content: space-between;\n  padding: 10px 0 16px;\n  .amount-left {\n  }\n  .amount-right {\n  }\n  .amount-white {\n    color: var(--white);\n  }\n`;\n\nconst UnStakeBtnWrap = styled.div`\n  display: flex;\n  column-gap: 22px;\n  align-items: center;\n  .switch-wrap {\n    display: flex;\n    align-items: center;\n    column-gap: 8px;\n    color: var(--purple);\n  }\n`;\n\nconst ChainBtnWrap = styled.div`\n  margin-top: 16px;\n  display: flex;\n`;\n\nconst { data, chainId, account, TOKENS, CHAIN_ID, switchChain, slotLength } =\n  props;\nconst curToken = data.tokenAddress;\nconst {\n  poolType,\n  poolName,\n  totalDeposit,\n  unlocking,\n  StakingAddress,\n  stakedAmount,\n} = data;\n\nState.init({\n  // isClaimRewards: false,\n  inputValue: \"\",\n  canUnstake: false,\n  unstaking: false,\n});\n\nconst handleInputChange = (e) => {\n  State.update({\n    inputValue: e.target.value,\n  });\n};\n\nuseEffect(() => {\n  if (\n    !isNaN(Number(state.inputValue)) &&\n    Big(state.inputValue || 0).lt(stakedAmount || 0)\n  ) {\n    State.update({\n      canUnstake: true,\n    });\n  } else {\n    State.update({\n      canUnstake: false,\n    });\n  }\n}, [state.inputValue]);\n\nfunction handleUnStake() {\n  if (poolType === \"Locking\") {\n    handleUnStakeLocking();\n  }\n  if (poolType === \"MasterChief\") {\n    handleUnStakeMasterChief();\n  }\n}\n\nfunction handleUnStakeLocking() {\n  State.update({\n    unstaking: true,\n  });\n  const UnstakeContract = new ethers.Contract(\n    StakingAddress,\n    [\n      {\n        type: \"function\",\n        stateMutability: \"nonpayable\",\n        outputs: [],\n        name: \"startUnlock\",\n        inputs: [\n          {\n            type: \"uint256\",\n            name: \"strategyIndex\",\n            internalType: \"uint256\",\n          },\n          {\n            type: \"uint256\",\n            name: \"amount\",\n            internalType: \"uint256\",\n          },\n          {\n            type: \"uint256\",\n            name: \"slotIndex\",\n            internalType: \"uint256\",\n          },\n        ],\n      },\n    ],\n    Ethers.provider().getSigner()\n  );\n  UnstakeContract.startUnlock(\n    0,\n    ethers.utils.parseUnits(state.inputValue),\n    slotLength\n  )\n    .then((tx) => {\n      console.log(\"tx: \", tx);\n      tx.wait()\n        .then((res) => {\n          const { status, transactionHash } = res;\n          console.info(\"tx_res: \", res);\n          if (status === 1) {\n            toast.success?.({\n              title: \"Transaction Successful!\",\n              text: `transactionHash ${transactionHash}`,\n            });\n          } else {\n            toast.fail?.({\n              title: \"Transaction Failed!\",\n              text: `transactionHash ${transactionHash}`,\n            });\n          }\n        })\n        .finally(() => {\n          State.update({\n            unstaking: false,\n          });\n        });\n    })\n    .catch((err) => {\n      State.update({\n        unstaking: false,\n      });\n      console.log(\"getPoolTokens_error:\", err);\n    });\n}\n\nfunction handleUnStakeMasterChief() {\n  State.update({\n    unstaking: true,\n  });\n  const UnstakeContract = new ethers.Contract(\n    StakingAddress,\n    [\n      {\n        type: \"function\",\n        stateMutability: \"nonpayable\",\n        outputs: [],\n        name: \"withdraw\",\n        inputs: [\n          {\n            type: \"address\",\n            name: \"_lp\",\n            internalType: \"address\",\n          },\n          {\n            type: \"uint256\",\n            name: \"_amount\",\n            internalType: \"uint256\",\n          },\n        ],\n      },\n    ],\n    Ethers.provider().getSigner()\n  );\n  UnstakeContract.withdraw(curToken, ethers.utils.parseUnits(state.inputValue))\n    .then((tx) => {\n      console.log(\"tx: \", tx);\n      tx.wait()\n        .then((res) => {\n          const { status, transactionHash } = res;\n          console.info(\"tx_res: \", res);\n          if (status === 1) {\n            toast.success?.({\n              title: \"Transaction Successful!\",\n              text: `transactionHash ${transactionHash}`,\n            });\n          } else {\n            toast.fail?.({\n              title: \"Transaction Failed!\",\n              text: `transactionHash ${transactionHash}`,\n            });\n          }\n        })\n        .finally(() => {\n          State.update({\n            unstaking: false,\n          });\n        });\n    })\n    .catch((err) => {\n      State.update({\n        unstaking: false,\n      });\n      console.log(\"getPoolTokens_error:\", err);\n    });\n}\nconst renderExtra = () => {\n  if (chainId !== CHAIN_ID) {\n    return (\n      <ChainBtnWrap>\n        <Widget\n          src=\"dapdapbos.near/widget/UI.Button\"\n          props={{\n            text: \"Switch to Gnosis\",\n            type: \"green\",\n            style: { flex: 1 },\n            onClick: switchChain,\n          }}\n        />\n      </ChainBtnWrap>\n    );\n  }\n  return (\n    <>\n      <AmountList>\n        <span></span>\n        <span>\n          Balance: <span className=\"amount-white\">{stakedAmount}</span>\n          {/* {TOKENS[curToken].symbol} */}\n        </span>\n      </AmountList>\n      <UnStakeBtnWrap>\n        <Widget\n          src=\"dapdapbos.near/widget/UI.Button\"\n          props={{\n            text: \"Unstake\",\n            type: \"green\",\n            style: { flex: 1 },\n            loading: state.unstaking,\n            disabled: !state.canUnstake,\n            onClick: handleUnStake,\n          }}\n        />\n      </UnStakeBtnWrap>\n    </>\n  );\n};\n\nreturn (\n  <StakePanel>\n    <div className=\"input-group\">\n      <input\n        value={state.inputValue}\n        type=\"number\"\n        className=\"form-control bos-input-number\"\n        placeholder=\"0.0\"\n        onChange={handleInputChange}\n      />\n      <div className=\"append-token\">\n        <Widget\n          src=\"dapdapbos.near/widget/UI.Avatar\"\n          props={{ src: TOKENS[curToken].icon, size: 20 }}\n        />\n      </div>\n    </div>\n    {renderExtra()}\n  </StakePanel>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/dapdapbos.near/widget/Staking.Athena.Unstake", "fact_widget_deployments_id": "5008f662a186cc8b503d2de13aa40e10", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 1}