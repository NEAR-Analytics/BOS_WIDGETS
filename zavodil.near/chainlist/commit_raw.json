{"tx_hash": "CxS5xYrPEPnpmMK3TGUjbXjSNizW7FVZktS9sk8N6jZ8", "action_id_social": "2MWEtYHWrRofA6RxiXztPtUWygNX2bmpUgu8JpkbVMF1-0-widget", "block_id": 99927198, "block_timestamp": "2023-08-29T12:25:30.887Z", "signer_id": "zavodil.near", "widget_name": "chainlist", "source_code": "let appName = \"chainlist\";\n\nlet data = {\n  [appName]: {\n    chains: {\n      [state.chain_id]: {\n        coingecko_id: state.coingecko_id,\n        name: state.name,\n        icon_svg: state.icon_svg,\n        rpc_url: state.rpc_url,\n      },\n    },\n    contracts: {\n      [state.chain_id]: {\n        weth: state.weth,\n      },\n    },\n  },\n};\nconsole.log(data, state);\n\nconst getSvgImage = (svg, className, width) => {\n  if (!svg) return;\n\n  const buff = new Buffer(svg);\n  const base64data = buff.toString(\"base64\");\n\n  return (\n    <img\n      style={{ maxWidth: width ?? \"32px\" }}\n      class={`img-thumbnail ${className}`}\n      src={`data:image/svg+xml;base64,${base64data}`}\n      alt=\"\"\n    />\n  );\n};\n\nif (state.refresh) {\n  console.log(\"Refresh\");\n  State.update({\n    refresh: false,\n    coingecko_id: null,\n    rpc_url: null,\n    name: null,\n    icon_svg: null,\n    weth: null,\n  });\n\n  const chainId = state.chain_id;\n  if (!chainId) {\n    console.log(\"No chainId\");\n  }\n  const chainlistData = Social.get(\n    `zavodil.near/chainlist/*/${chainId}/**`,\n    \"final\"\n  );\n\n  State.update({\n    coingecko_id: chainlistData.chains[chainId].coingecko_id,\n    rpc_url: chainlistData.chains[chainId].rpc_url,\n    name: chainlistData.chains[chainId].name,\n    icon_svg: chainlistData.chains[chainId].icon_svg,\n    weth: chainlistData.contracts[chainId].weth,\n  });\n}\n\nlet chainlistData = [];\n\nif (!state.chainlistLoaded) {\n  const chainlist = Social.get(`zavodil.near/chainlist/chains/**`, \"final\");\n\n  if (chainlist) {\n    State.update({\n      chainlistLoaded: true,\n      chainlist,\n    });\n  }\n} else {\n  chainlistData = Object.keys(state.chainlist).map((chainId) => (\n    <div>\n      <h5>{state.chainlist[chainId].name}</h5>\n      <div>\n        chainId: {chainId}{\" \"}\n        <button\n          class=\"btn btn-secondary btn-sm\"\n          onClick={() => {\n            State.update({ chain_id: chainId, refresh: true });\n          }}\n        >\n          Load\n        </button>\n      </div>\n      {Object.keys(state.chainlist[chainId]).map((name) => (\n        <div>\n          {name}:{\" \"}\n          {name === \"icon_svg\"\n            ? getSvgImage(state.chainlist[chainId][name], \"\", \"16px\")\n            : state.chainlist[chainId][name]}\n        </div>\n      ))}\n    </div>\n  ));\n}\n\nreturn (\n  <div class=\"container\">\n    <div class=\"form-floating\">\n      <div class=\"mb-3\">\n        <label for=\"chainId\" class=\"form-label\">\n          Chain ID\n        </label>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          value={state.chain_id}\n          onChange={(e) => State.update({ chain_id: e.target.value })}\n          id=\"chainId\"\n        />\n      </div>\n      <div class=\"mb-3\">\n        <input\n          type=\"button\"\n          class=\"btn btn-secondary mw-200\"\n          onClick={() => State.update({ refresh: true })}\n          disabled={!state.chain_id}\n          value=\"Load Data by Chain ID\"\n        />\n      </div>\n      <div class=\"mb-3\">\n        <label for=\"coingeckoId\" class=\"form-label\">\n          Coingecko API ID\n        </label>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          value={state.coingecko_id}\n          onChange={(e) => State.update({ coingecko_id: e.target.value })}\n          id=\"coingeckoId\"\n        />\n      </div>\n      <div class=\"mb-3\">\n        <label for=\"rpcUrl\" class=\"form-label\">\n          RPC URL\n        </label>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          value={state.rpc_url}\n          onChange={(e) => State.update({ rpc_url: e.target.value })}\n          id=\"rpcUrl\"\n        />\n      </div>\n      <div class=\"mb-3\">\n        <label for=\"name\" class=\"form-label\">\n          Network name\n        </label>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          value={state.name}\n          onChange={(e) => State.update({ name: e.target.value })}\n          id=\"name\"\n        />\n      </div>\n\n      <div class=\"mb-3\">\n        <label for=\"icon_svg\" class=\"form-label\">\n          SVG Icon\n        </label>\n        <textarea\n          class=\"form-control\"\n          value={state.icon_svg}\n          onChange={(e) =>\n            State.update({\n              icon_svg: e.target.value\n                .replace(/\\t/g, \" \")\n                .replace(/\\n/g, \"\")\n                .replace(/\\s{2,}/g, \" \")\n                .replace(/\\> \\</g, \"><\"),\n            })\n          }\n          id=\"icon_svg\"\n        />\n        {state.icon_svg && <>{getSvgImage(state.icon_svg, \"mt-2\")}</>}\n      </div>\n\n      <div class=\"mb-3\">\n        <label for=\"weth\" class=\"form-label\">\n          Weth Contract\n        </label>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          value={state.weth}\n          onChange={(e) => State.update({ weth: e.target.value })}\n          id=\"weth\"\n        />\n      </div>\n\n      <div class=\"mb-3\">\n        <CommitButton disabled={!(state.chain_id && state.name)} data={data}>\n          Add a chain\n        </CommitButton>\n      </div>\n    </div>\n\n    <hr />\n    <h3>Existing data: </h3>\n    {chainlistData}\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/zavodil.near/widget/chainlist", "fact_widget_deployments_id": "12bb64a1bf91717cd2d79ddd85578395", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}