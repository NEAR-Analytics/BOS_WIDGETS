{"tx_hash": "D6B29Hv4LhtPXipunAwPL4MQhFzQS5o7Z9q37zyLKJjX", "action_id_social": "49or4b6dZRtJNsCwkWCK4VPK4r2uU5ZYmtRD1rFwbj1g-0-widget", "block_id": 104123547, "block_timestamp": "2023-10-24T19:17:40.087Z", "signer_id": "zavodil.near", "widget_name": "token-balances-step-1", "source_code": "// Load current sender address if it was not loaded yet\nif (state.sender == undefined && Ethers.provider()) {\n  Ethers.provider()\n    .send(\"eth_requestAccounts\", [])\n    .then((accounts) => {\n      if (accounts.length) {\n        // save sender address to the state\n        State.update({ sender: accounts[0] });\n      }\n    });\n}\n\n// Load ERC20 ABI JSON\nconst erc20Abi = fetch(\n  \"https://ipfs.near.social/ipfs/bafkreifgw34kutqcnusv4yyv7gjscshc5jhrzw7up7pdabsuoxfhlnckrq\"\n);\nif (!erc20Abi.ok) {\n  return \"Loading\";\n}\n\n// Create contract interface\nconst iface = new ethers.utils.Interface(erc20Abi.body);\n\n// set list of tokens\nconst tokens = [\n  \"0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599\", // WBTC\n  \"0x6b175474e89094c44da98b954eedeac495271d0f\", // DAI\n  \"0x1f9840a85d5aF5bf1D1762F925BDADdC4201F984\", // UNI\n];\n\n// load receiver's balance for a giver token\nconst getTokenBalance = (receiver, tokenId) => {\n  // encode `balanceOf` request\n  const encodedData = iface.encodeFunctionData(\"balanceOf\", [receiver]);\n\n  // send request to the network\n  return Ethers.provider()\n    .call({\n      to: tokenId,\n      data: encodedData,\n    })\n    .then((rawBalance) => {\n      // decode responce\n      const receiverBalanceHex = iface.decodeFunctionResult(\n        \"balanceOf\",\n        rawBalance\n      );\n\n      return Big(receiverBalanceHex).toFixed(0);\n    });\n};\n\nconst loadTokensData = () => {\n  // load balances of all tokens\n  tokens.map((tokenId) => {\n    getTokenBalance(state.sender, tokenId).then((value) => {\n      // save balance of every token to the state\n      State.update({ [tokenId]: { balance: value, ...state[tokenId] } });\n    });\n  });\n};\n\nconst renderToken = (tokenId) => (\n  <li>\n    {tokenId}: {state[tokenId].balance}\n  </li>\n);\n\nif (state.sender) {\n  loadTokensData();\n\n  return (\n    <>\n      <ul>{tokens.map((tokenId) => renderToken(tokenId))}</ul>\n      <p>Your account: {state.sender} </p>\n    </>\n  );\n} else {\n  // output connect button\n  return <Web3Connect />;\n}\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/zavodil.near/widget/token-balances-step-1", "fact_widget_deployments_id": "6b6e5a41583c41fdbf4923a032109576", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}