{"tx_hash": "FPFchV7snegQ3XiEzbnkJJoxNopwwds2ShsRYEdFNNrc", "action_id_social": "FbAn2v4BJ7gc1g8TtZtNyy6KheiB4yVFbzXRR6PZ5ri-0-widget", "block_id": 105982396, "block_timestamp": "2023-11-18T14:26:42.163Z", "signer_id": "zavodil.near", "widget_name": "subscribe", "source_code": "const price = \"96000000000000000000000000\";\nconst priceWholesale = \"84000000000000000000000000\";\nconst yearInMs = 31556926000;\n\nconst referralId = props.referralId ?? \"\";\n\nconst getEndDate = (purchasedPeriod) => {\n  const previousTimestamp = state.previousTimestamp ?? Date.now();\n  const nextTimestamp = previousTimestamp + purchasedPeriod;\n  const dateObj = new Date(nextTimestamp);\n\n  const day = dateObj.getDate();\n  const month = dateObj.toLocaleString(\"default\", { month: \"long\" });\n  const year = dateObj.getFullYear();\n\n  const nthNumber = (number) => {\n    if (number > 3 && number < 21) return \"th\";\n    switch (number % 10) {\n      case 1:\n        return \"st\";\n      case 2:\n        return \"nd\";\n      case 3:\n        return \"rd\";\n      default:\n        return \"th\";\n    }\n  };\n\n  return `${month} ${day}${nthNumber(day)}, ${year}`;\n};\n\nState.init({\n  type: \"annually\",\n  purchasedPeriod: yearInMs,\n  customAmount: 1,\n  previousTimestamp,\n  price,\n  priceWholesale,\n  buyOption: \"myself\",\n  referralUrl: `https://near.social/zavodil.near/widget/subscribe?referralId=${context.accountId}`,\n});\n\nconst isGift = () => state.buyOption == \"gift\" && state.recepientAccountId;\n\nconst previousTimestampString = Social.get(\n  `premium.social.near/badge/premium/accounts/${\n    isGift() ? state.recepientAccountId : context.accountId\n  }`,\n  \"final\"\n);\n\nconst previousTimestamp = previousTimestampString\n  ? Number(previousTimestampString)\n  : null;\n\nif (state.previousTimestamp != previousTimestamp) {\n  State.update({\n    previousTimestampExpired: previousTimestamp <= Date.now(),\n    previousTimestamp,\n  });\n}\n\nif (state.theme === undefined) {\n  const css = fetch(\n    \"https://ipfs.near.social/ipfs/bafkreigdsigbyfwdig762a2tltaaeeikfvaebb7cazsupnnszic3usnv5e\"\n  ).body;\n  if (!css) return \"\";\n\n  State.update({\n    theme: styled.div`${css}\n  `,\n  });\n}\n\nconst check = (\n  <svg viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n    <g>\n      <path d=\"M9.64 18.952l-5.55-4.861 1.317-1.504 3.951 3.459 8.459-10.948L19.4 6.32 9.64 18.952z\"></path>\n    </g>\n  </svg>\n);\n\nconst Theme = state.theme;\n\nconst customOnChange = (e) => {\n  const customAmount = isNumber(e.target.value)\n    ? parseFloat(e.target.value)\n    : \"\";\n  State.update({\n    purchasedPeriod: customAmount ? convertNearToMs(customAmount) : 0,\n    customAmount,\n  });\n};\n\nconst isNumber = (n) => {\n  return !isNaN(parseFloat(n)) && isFinite(n);\n};\n\nconst deposit = (amount) => {\n  const gas = 200000000000000;\n  const deposit = new Big(amount);\n  const args = { name: \"premium\" };\n  if (isGift()) {\n    args.receiver_id = getBuyerAccountId();\n    args.referral_id = context.accountId;\n  } else if (referralId) {\n    args.referral_id = referralId;\n  }\n  Near.call(\"premium.social.near\", \"purchase\", args, gas, deposit);\n};\n\nconst convertNearToMs = (amount) => {\n  const amountYocto = Big(10).pow(24).mul(Big(amount));\n  const priceRegular = Big(state.price);\n  const priceWholesale = Big(state.priceWholesale);\n\n  const price = amountYocto.gt(priceWholesale) ? priceWholesale : priceRegular;\n\n  const res = amountYocto.mul(Big(yearInMs)).div(price).toFixed(0);\n\n  return Number(res);\n};\n\nconst updateBuyOption = (e) => {\n  State.update({ buyOption: e.target.id });\n};\n\nconst getBuyerAccountId = () => {\n  return state.buyOption == \"gift\"\n    ? state.recepientAccountId\n    : context.accountId;\n};\n\nconst getBuyer = () => {\n  return state.buyOption == \"gift\"\n    ? state.recepientAccountId ?? \"Recepient\"\n    : \"You\";\n};\n\nconst SaveToClipboard = () => {\n  clipboard.writeText(state.referralUrl).then(() => {\n    State.update({ copied: true });\n  });\n};\n\nconst features = [\n  \"Premium blue checkmark\",\n  \"Posts featured in the default feed\",\n  <>\n    Access to the link shortener{\" \"}\n    <a href=\"https://near.fm/\" target=\"_black\">\n      near.fm\n    </a>\n  </>,\n  \"Increased referral commission\",\n  \"Transfer of premium subscription between accounts\",\n];\n\nreturn (\n  <Theme>\n    <div class=\"container\">\n      <div class=\"container-block\">\n        <div class=\"header\">\n          <div class=\"header-text\">\n            Premium subscribers will get a blue checkmark and extra features.\n          </div>\n          <div class=\"illustration\">\n            <img\n              draggable=\"false\"\n              src=\"https://ipfs.near.social/ipfs/bafkreihfjwfijsedf4r75iwn77yua5ey3ufv6swgcjupqeigh2fw4wqm4a\"\n            />\n          </div>\n        </div>\n\n        <div class=\"premium-description\">\n          <h6>Enhanced Experience</h6>\n          {features.map((item) => (\n            <div class=\"d-flex flex-row\">\n              <div class=\"flex-grow-1\">{item}</div>\n              <div>{check}</div>\n            </div>\n          ))}\n        </div>\n\n        <div class=\"radiogroup\">\n          <div class=\"selector\">\n            <div\n              class={`menu-item ${\n                state.type == \"annually\" ? \"menu-active\" : \"\"\n              }`}\n            >\n              <div\n                class=\"menu-item-text\"\n                onClick={() =>\n                  State.update({ type: \"annually\", purchasedPeriod: yearInMs })\n                }\n              >\n                Year<div class=\"sale\">SAVE 12%</div>\n              </div>\n            </div>\n            <div\n              class={`menu-item ${\n                state.type == \"monthly\" ? \"menu-active\" : \"\"\n              }`}\n              onClick={() =>\n                State.update({\n                  type: \"monthly\",\n                  purchasedPeriod: yearInMs / 12,\n                })\n              }\n            >\n              <div class=\"menu-item-text\">Month</div>\n            </div>\n            <div\n              class={`menu-item ${state.type == \"custom\" ? \"menu-active\" : \"\"}`}\n              onClick={() =>\n                State.update({ type: \"custom\", purchasedPeriod: 0 })\n              }\n            >\n              <div class=\"menu-item-text\">Custom</div>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"mx-auto\" style={{ width: \"190px\" }}>\n          <div class=\"purchase-options\">\n            <div class=\"form-check\">\n              <input\n                class=\"form-check-input\"\n                type=\"radio\"\n                name=\"buy-options\"\n                id=\"myself\"\n                checked={state.buyOption === \"myself\"}\n                onClick={updateBuyOption}\n              />\n              <label class=\"form-check-label\" for=\"myself\">\n                Purchase for myself\n              </label>\n            </div>\n            <div class=\"form-check\">\n              <input\n                class=\"form-check-input\"\n                type=\"radio\"\n                name=\"buy-options\"\n                id=\"gift\"\n                checked={state.buyOption === \"gift\"}\n                onClick={updateBuyOption}\n              />\n              <label class=\"form-check-label\" for=\"gift\">\n                Gift premium\n              </label>\n            </div>\n          </div>\n        </div>\n        {state.buyOption == \"gift\" && (\n          <div class=\"mx-auto mt-2\" style={{ width: \"300px\" }}>\n            <div class=\"mb-3\">\n              <label for=\"recepientAccountId\" class=\"form-label\">\n                Provide recipient's NEAR account:\n              </label>\n              <input\n                type=\"text\"\n                class=\"form-control\"\n                id=\"recepientAccountId\"\n                placeholder=\"name.near\"\n                value={state.recepientAccountId}\n                onChange={(e) =>\n                  State.update({ recepientAccountId: e.target.value })\n                }\n              />\n            </div>\n          </div>\n        )}\n\n        <div class={`action ${!getBuyerAccountId() ? \"disabled\" : \"\"}`}>\n          {state.type !== \"custom\" && (\n            <div class=\"subscribe\">\n              <div class=\"subscribe-text\">\n                {state.type == \"monthly\" ? (\n                  <div onClick={() => deposit(state.price / 12)}>\n                    8 NEAR / month\n                  </div>\n                ) : (\n                  <div onClick={() => deposit(state.priceWholesale)}>\n                    <span class=\"old-price\">96 NEAR</span> 84 NEAR / year\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n\n          {state.type === \"custom\" && (\n            <div class=\"subscribe-amount-block\">\n              <div class=\"subscribe-amount-text\">Enter amount:</div>\n              <input\n                type=\"text\"\n                class=\"form-control subscribe-amount\"\n                value={state.customAmount}\n                onChange={customOnChange}\n              />\n              <div class=\"subscribe\">\n                <div\n                  class={`subscribe-text ${\n                    state.customAmount >= 1 ? \"\" : \"disabled\"\n                  } `}\n                  onClick={() =>\n                    deposit(\n                      Big(state.customAmount).mul(Big(10).pow(24)).toFixed()\n                    )\n                  }\n                >\n                  {state.customAmount\n                    ? `Deposit ${state.customAmount} NEAR`\n                    : \"Min deposit: 1 NEAR\"}\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {state.purchasedPeriod > 0 && (\n          <div class=\"premium-details\">\n            {getBuyer()} will have premium until\n            {getEndDate(state.purchasedPeriod)}\n          </div>\n        )}\n        {state.purchasedPeriod == 0 && state.previousTimestamp && (\n          <div class=\"premium-details\">\n            {state.previousTimestampExpired\n              ? `Your prior premium subscription lasped on `\n              : `${getBuyer()}'ve already got premium until`}\n            {getEndDate(0)}\n          </div>\n        )}\n\n        <div class=\"card mx-auto mt-3\" style={{ width: \"75%\" }}>\n          <div class=\"card-body\">\n            <h6 class=\"card-title\">Preview</h6>\n            <Widget\n              loading={\"\"}\n              src=\"mob.near/widget/Profile.ShortInlineBlock\"\n              props={{\n                isPremium: true,\n                accountId: getBuyerAccountId(),\n              }}\n            />\n          </div>\n        </div>\n\n        {!state.showReferral && (\n          <div class=\"mt-4 text-center\">\n            <button\n              type=\"button\"\n              onClick={() => State.update({ showReferral: true })}\n              class=\"btn btn-outline-success\"\n            >\n              Premium referral program\n            </button>\n          </div>\n        )}\n\n        {state.showReferral && (\n          <div class=\"card mt-4 mx-auto\" style={{ width: \"100%\" }}>\n            <div class=\"card-header\">Join the referral program!</div>\n            <div class=\"card-body\">\n              <p>\n                Invite your friends to purchase premium and instantly receive\n                rewards in NEAR when they subscribe to premium.\n              </p>\n\n              <ul>\n                <li>\n                  Commission for referral rewards: 10% (increases to 15% if the\n                  referrer has an active premium).\n                </li>\n                <li>\n                  Referral commission will be paid on all subsequent purchases\n                  by the invited user in the future.\n                </li>\n                <li>\n                  If you gift premium to your friend, you will be automatically\n                  registered as their referrer.\n                </li>\n              </ul>\n\n              <label for=\"invite-url\" class=\"form-label\">\n                Your invite URL:\n              </label>\n              <div class=\"input-group mb-3\">\n                <input\n                  type=\"text\"\n                  class=\"form-control\"\n                  id=\"invite-url\"\n                  value={state.referralUrl}\n                  aria-describedby=\"save-to-clipboard\"\n                />\n                <OverlayTrigger\n                  placement=\"auto\"\n                  overlay={\n                    <Tooltip>\n                      {state.copied ? \"Copied!\" : \"Copy to clipboard\"}\n                    </Tooltip>\n                  }\n                >\n                  <button\n                    class=\"input-group-text\"\n                    id=\"save-to-clipboard\"\n                    onClick={SaveToClipboard}\n                  >\n                    <svg\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth=\"2\"\n                      viewBox=\"0 0 24 24\"\n                      style={{ width: \"1em\", marginTop: \"-0.2em\" }}\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                    >\n                      <rect height=\"14\" rx=\"2\" ry=\"2\" width=\"14\" x=\"8\" y=\"8\" />\n                      <path d=\"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\" />\n                    </svg>\n                  </button>\n                </OverlayTrigger>\n              </div>\n              <div>\n                A widget for tracking referral statistics will be available\n                soon.\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  </Theme>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/zavodil.near/widget/subscribe", "fact_widget_deployments_id": "240b8aa26be87ba7456f594baf9340f5", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}