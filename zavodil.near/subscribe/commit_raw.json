{"tx_hash": "4uDyJF6k5PHvEv4EuaUjzcTzWD22FP3Qc39CtGB7v1dJ", "action_id_social": "2sUrjLnbH3SL2zxtgX8o7TMaF2s4kckPKEKzRHrjS8jR-0-widget", "block_id": 99122244, "block_timestamp": "2023-08-18T23:01:46.311Z", "signer_id": "zavodil.near", "widget_name": "subscribe", "source_code": "const price = \"96000000000000000000000000\";\nconst priceWholesale = \"84000000000000000000000000\";\nconst yearInMs = 31556926000;\n\nconst getEndDate = (purchasedPeriod) => {\n  const previousTimestamp = state.previousTimestamp ?? Date.now();\n  const nextTimestamp = previousTimestamp + purchasedPeriod;\n  const dateObj = new Date(nextTimestamp);\n\n  const day = dateObj.getDate();\n  const month = dateObj.toLocaleString(\"default\", { month: \"long\" });\n  const year = dateObj.getFullYear();\n\n  const nthNumber = (number) => {\n    if (number > 3 && number < 21) return \"th\";\n    switch (number % 10) {\n      case 1:\n        return \"st\";\n      case 2:\n        return \"nd\";\n      case 3:\n        return \"rd\";\n      default:\n        return \"th\";\n    }\n  };\n\n  return `${month} ${day}${nthNumber(day)}, ${year}`;\n};\n\nState.init({\n  type: \"custom\",\n  customAmount: 1,\n  previousTimestamp,\n  purchasedPeriod: 0,\n  price,\n  priceWholesale,\n});\n\nconst previousTimestampString = Social.get(\n  `premium.social.near/badge/premium/accounts/${context.accountId}`,\n  \"final\"\n);\n\nconst previousTimestamp = previousTimestampString\n  ? Number(previousTimestampString)\n  : null;\n\nif (state.previousTimestamp != previousTimestamp) {\n  State.update({ previousTimestamp });\n}\n\nif (state.theme === undefined) {\n  const css = fetch(\n    \"https://ipfs.near.social/ipfs/bafkreickjanlocwi253a2qcqiep6dfh4pnvytiwdmi3jv4b7wylcu4nc3u\"\n  ).body;\n  if (!css) return \"\";\n\n  State.update({ theme: styled.div`${css}` });\n}\n\nconst Theme = state.theme;\n\nconst customOnChange = (e) => {\n  const customAmount = isNumber(e.target.value)\n    ? parseFloat(e.target.value)\n    : \"\";\n  State.update({\n    purchasedPeriod: customAmount ? convertNearToMs(customAmount) : 0,\n    customAmount,\n  });\n};\n\nconst isNumber = (n) => {\n  return !isNaN(parseFloat(n)) && isFinite(n);\n};\n\nconst deposit = (amount) => {\n  const gas = 200000000000000;\n  const deposit = new Big(amount);\n  Near.call(\n    \"premium.social.near\",\n    \"purchase\",\n    { name: \"premium\" },\n    gas,\n    deposit\n  );\n};\n\nconst convertNearToMs = (amount) => {\n  const amountYocto = Big(10).pow(24).mul(Big(amount));\n  const priceRegular = Big(state.price);\n  const priceWholesale = Big(state.priceWholesale);\n\n  const price = amountYocto.gt(priceWholesale) ? priceWholesale : priceRegular;\n\n  const res = amountYocto.mul(Big(yearInMs)).div(price).toFixed(0);\n\n  return Number(res);\n};\n\nreturn (\n  <Theme>\n    <div class=\"container\">\n      <div class=\"container-block\">\n        <div class=\"header\">\n          <div class=\"header-text\">\n            Premium subscribers will get a blue checkmark and extra features.\n          </div>\n          <div class=\"illustration\">\n            <img\n              draggable=\"false\"\n              src=\"https://ipfs.near.social/ipfs/bafkreihfjwfijsedf4r75iwn77yua5ey3ufv6swgcjupqeigh2fw4wqm4a\"\n            />\n          </div>\n        </div>\n\n        <div class=\"radiogroup\">\n          <div class=\"selector\">\n            <div\n              class={`menu-item ${\n                state.type == \"annually\" ? \"menu-active\" : \"\"\n              }`}\n            >\n              <div\n                class=\"menu-item-text\"\n                onClick={() =>\n                  State.update({ type: \"annually\", purchasedPeriod: yearInMs })\n                }\n              >\n                Year<div class=\"sale\">SAVE 12%</div>\n              </div>\n            </div>\n            <div\n              class={`menu-item ${\n                state.type == \"monthly\" ? \"menu-active\" : \"\"\n              }`}\n              onClick={() =>\n                State.update({\n                  type: \"monthly\",\n                  purchasedPeriod: yearInMs / 12,\n                })\n              }\n            >\n              <div class=\"menu-item-text\">Month</div>\n            </div>\n            <div\n              class={`menu-item ${state.type == \"custom\" ? \"menu-active\" : \"\"}`}\n              onClick={() =>\n                State.update({ type: \"custom\", purchasedPeriod: 0 })\n              }\n            >\n              <div class=\"menu-item-text\">Custom</div>\n            </div>\n          </div>\n        </div>\n\n        {state.type !== \"custom\" && (\n          <div class=\"action\">\n            <div class=\"subscribe\">\n              <div class=\"subscribe-text\">\n                {state.type == \"monthly\" ? (\n                  <div onClick={() => deposit(state.price / 12)}>\n                    8 NEAR / month\n                  </div>\n                ) : (\n                  <div onClick={() => deposit(state.priceWholesale)}>\n                    <span class=\"old-price\">96 NEAR</span> 84 NEAR / year\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        )}\n        {state.type === \"custom\" && (\n          <div class=\"action\">\n            <div class=\"subscribe-amount-block\">\n              <div class=\"subscribe-amount-text\">Enter amount:</div>\n              <input\n                type=\"text\"\n                class=\"subscribe-amount\"\n                value={state.customAmount}\n                onChange={customOnChange}\n              />\n              <div class=\"subscribe\">\n                <div\n                  class={`subscribe-text ${\n                    state.customAmount >= 1 ? \"\" : \"disabled\"\n                  } `}\n                  onClick={() =>\n                    deposit(\n                      Big(state.customAmount).mul(Big(10).pow(24)).toFixed()\n                    )\n                  }\n                >\n                  {state.customAmount\n                    ? `Deposit ${state.customAmount} NEAR`\n                    : \"Min deposit: 1 NEAR\"}\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n        {state.purchasedPeriod > 0 && (\n          <div class=\"premium-details\">\n            You will have premium until: {getEndDate(state.purchasedPeriod)}\n          </div>\n        )}\n        {state.purchasedPeriod == 0 && state.previousTimestamp && (\n          <div class=\"premium-details\">\n            You've already got premium until: {getEndDate(0)}\n          </div>\n        )}\n      </div>\n    </div>\n  </Theme>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/zavodil.near/widget/subscribe", "fact_widget_deployments_id": "12bc1f0f21776b028aecc930d0ad00be", "inserted_timestamp": "2023-08-19T00:46:13.420Z", "modified_timestamp": "2023-08-19T00:46:13.420Z", "__row_index": 3}