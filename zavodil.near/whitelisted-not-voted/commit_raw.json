{"tx_hash": "HwVr8YanYjD217C5LXHwWKCU5Vft2ip8fhA1WJGUEKjM", "action_id_social": "2dWNmbtAMna6uUF2j8tFimFmjSPMha1odnvYWaaHgZre-0-widget", "block_id": 101640815, "block_timestamp": "2023-09-21T17:39:09.844Z", "signer_id": "zavodil.near", "widget_name": "whitelisted-not-voted", "source_code": "const data = fetch(\n  \"https://raw.githubusercontent.com/zavodil/near-nft-owners-list/main/output_election_votes.txt\"\n);\n\nconst whitelistedData = fetch(\n  \"https://gist.githubusercontent.com/zavodil/20e4ae896e1f6053e1d66a398e1026c9/raw/0363976f86bb067c142b1d8912ad37e639b876cf/whitelisted.txt\"\n);\n\nconst [voters, setVoters] = useState(null);\nconst [whitelisted, setWhitelisted] = useState(null);\nconst [available, setAvailable] = useState([]);\n\nuseEffect(() => {\n  if (!data.ok) {\n    return;\n  }\n  const voters = {};\n  Object.values(\n    data.body\n      .split(\"\\n\")\n      .map((line) => line.split(\"|\"))\n      .filter((data) => data.length === 5)\n  ).forEach((item) => {\n    const account_id = item[0];\n    if (voters[account_id] == undefined) {\n      voters[account_id] = {};\n    }\n    voters[account_id][item[3]] = item[4].toLowerCase();\n  });\n  setVoters(voters);\n}, [data]);\n\nif (!voters) {\n  return \"Loading\";\n}\n\nuseEffect(() => {\n  if (!whitelistedData.ok) {\n    return;\n  }\n  setWhitelisted(JSON.parse(whitelistedData.body));\n}, [whitelistedData]);\n\nuseEffect(() => {\n  if (!voters || !whitelisted) {\n    return;\n  }\n\n  let availableVoters = whitelisted.filter(\n    (account_id) => !Object.keys(voters).includes(account_id)\n  );\n\n  setAvailable(availableVoters);\n}, [voters, whitelisted]);\n\nreturn (\n  <>\n    <h1>Whitelisted users available to vote</h1>\n    {available.map((accountId) => (\n      <div>\n        <Widget\n          src=\"mob.near/widget/N.ProfileLine\"\n          props={{\n            accountId,\n            link: true,\n            hideAccountId: true,\n            hideImage: false,\n          }}\n        />\n        <small class=\"ps-2 text-secondary\">[{accountId}]</small>\n      </div>\n    ))}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/zavodil.near/widget/whitelisted-not-voted", "fact_widget_deployments_id": "48ff73e3d1fd49b90da671a43ea4520e", "inserted_timestamp": "2023-09-21T19:34:59.917Z", "modified_timestamp": "2023-09-21T19:34:59.917Z", "__row_index": 0}