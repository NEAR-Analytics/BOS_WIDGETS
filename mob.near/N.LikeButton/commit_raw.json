{"tx_hash": "DAmCUox1iEi8DW3L1ZJdaB81WptTihsskxVAvi6GJiN", "action_id_social": "FDq9Bb615EvZUoaQSxcYQZ9h9BJE3fqns6d2FKybiehp-0-widget", "block_id": 98958756, "block_timestamp": "2023-08-16T19:24:44.433Z", "signer_id": "mob.near", "widget_name": "N.LikeButton", "source_code": "const item = props.item;\n\nif (!item) {\n  return \"\";\n}\n\nconst likes = Social.index(\"like\", item);\n\nconst dataLoading = likes === null;\n\nconst likesByUsers = {};\n\n(likes || []).forEach((like) => {\n  if (like.value.type === \"like\") {\n    likesByUsers[like.accountId] = like;\n  } else if (like.value.type === \"unlike\") {\n    delete likesByUsers[like.accountId];\n  }\n});\nif (state.hasLike === true) {\n  likesByUsers[context.accountId] = {\n    accountId: context.accountId,\n  };\n} else if (state.hasLike === false) {\n  delete likesByUsers[context.accountId];\n}\n\nconst accountsWithLikes = Object.keys(likesByUsers);\nconst likeCount = accountsWithLikes.length;\nconst hasLike = context.accountId && !!likesByUsers[context.accountId];\n\nconst heartSvg = (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    width=\"24\"\n    height=\"24\"\n    fill=\"currentColor\"\n    viewBox=\"-2 -2 20 20\"\n    stroke=\"currentColor\"\n    strokeWidth=\"0.5\"\n  >\n    <path d=\"m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01L8 2.748zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15z\" />\n  </svg>\n);\n\nconst heartFillSvg = (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    width=\"24\"\n    height=\"24\"\n    fill=\"currentColor\"\n    viewBox=\"-2 -2 20 20\"\n    stroke=\"currentColor\"\n    strokeWidth=\"0.5\"\n  >\n    <path\n      fill-rule=\"evenodd\"\n      d=\"M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z\"\n    />\n  </svg>\n);\n\nconst LikeButton = styled.button`\n  border: 0 !important;\n  display: inline-flex;\n  align-items: center;\n  justify-content: left;\n  border-radius: 50%;\n  width: 35px;\n  height: 35px;\n  background: inherit;\n  color: inherit;\n  line-height: normal;\n  &:hover {\n    opacity: 1 !important;\n    color: red;\n    background: pink;\n  }\n  svg {\n    margin-top: 2px;\n  }\n  .liked {\n    color: red;\n  }\n  .count {\n    margin-left: 8px;\n  }\n`;\n\nconst likeClick = () => {\n  if (state.loading) {\n    return;\n  }\n  State.update({\n    loading: true,\n  });\n  const data = {\n    index: {\n      like: JSON.stringify({\n        key: item,\n        value: {\n          type: hasLike ? \"unlike\" : \"like\",\n        },\n      }),\n    },\n  };\n\n  if (!hasLike && props.notifyAccountId) {\n    data.index.notify = JSON.stringify({\n      key: props.notifyAccountId,\n      value: {\n        type: \"like\",\n        item,\n      },\n    });\n  }\n  Social.set(data, {\n    onCommit: () => State.update({ loading: false, hasLike: !hasLike }),\n    onCancel: () => State.update({ loading: false }),\n  });\n};\n\nconst title = hasLike ? \"Unlike\" : \"Like\";\n\nreturn (\n  <div className=\"d-inline-flex align-items-center\">\n    <LikeButton\n      disabled={state.loading || dataLoading || !context.accountId}\n      title={title}\n      onClick={likeClick}\n    >\n      <span className={hasLike ? \"liked\" : \"\"}>\n        {hasLike ? heartFillSvg : heartSvg}\n      </span>\n      <span className={`count ${hasLike ? \"liked\" : \"\"}`}>\n        {likeCount || \"\"}\n      </span>\n    </LikeButton>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/mob.near/widget/N.LikeButton", "fact_widget_deployments_id": "0bdcc502c6fb03ac9929c4e2afdd545f", "inserted_timestamp": "2023-08-16T21:25:57.950Z", "modified_timestamp": "2023-08-16T21:25:57.950Z", "__row_index": 4}