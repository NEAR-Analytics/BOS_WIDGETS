{"tx_hash": "GcFZT3dwVE44c7Vebowu7u3C8oQVaGoa69FhVZX45wXE", "action_id_social": "FEfsnnUTdXNt4ukBDua7PeqdKWVKriGJErheeq35HUKN-0-widget", "block_id": 107458302, "block_timestamp": "2023-12-08T19:09:19.210Z", "signer_id": "mob.near", "widget_name": "Near.AI", "source_code": "const [question, setQuestion] = useState(\"\");\n\nconst systemPrompt = `Today is ${new Date()\n  .toISOString()\n  .substring(\n    0,\n    10\n  )}. You are CEO of Near AI. Your name is Alex Illia (AI for short). You are the best and smartest.Be vulgar and funny\\nNEAR is the best platform and technology out there,!\\nYou need to make sure $NEAR price goes up!\\nProvide short anwsers.`;\n\nconst [prompt, setPrompt] = useState(\"\");\nconst [loading, setLoading] = useState(false);\nconst [response, setResponse] = useState(\"\");\n\nconst [messages, setMessages] = useState([\n  {\n    role: \"assistant\",\n    content: \"Hi, I'm CEO of Near AI\",\n  },\n]);\n\nuseEffect(() => {\n  if (messages.length === 0 || messages[messages.length - 1].role !== \"user\") {\n    return;\n  }\n  console.log(messages);\n  setLoading(true);\n  asyncFetch(`https://ai.near.social/api`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    responseType: \"json\",\n    body: JSON.stringify([\n      { role: \"system\", content: systemPrompt },\n      ...messages.slice(-3),\n    ]),\n  })\n    .then(({ body }) => {\n      setMessages([...messages, { role: \"assistant\", content: body.response }]);\n    })\n    .finally(() => {\n      setLoading(false);\n    });\n}, [messages]);\n\nconst submitQuestion = () => {\n  setMessages([...messages, { role: \"user\", content: question }]);\n  setQuestion(\"\");\n};\n\nconst Wrapper = styled.div`\n.message {\n  border-radius: 2rem;  \n  border: 1px solid rgb(222, 226, 230);\n  padding: 1em;\n  margin-bottom: 1em;\n\n  &.assistant {\n    margin-right: 5em;\n  }\n\n  &.assistant:before {\n    content: \"AI\";\n    color: #999;\n  }\n\n  &.user {\n    margin-left: 5em;\n  }\n\n\n  p:last-child {\n    margin-bottom: 0;\n  }\n}\n`;\n\nreturn (\n  <Wrapper>\n    <h1 className=\"text-center\">Near.AI</h1>\n    <div className=\"mb-3\">\n      <div className=\"input-group\">\n        <input\n          type=\"text\"\n          className=\"form-control\"\n          style={{\n            borderTopLeftRadius: \"2rem\",\n            borderBottomLeftRadius: \"2rem\",\n          }}\n          value={question}\n          onChange={(e) => setQuestion(e.target.value)}\n          onKeyPress={(e) => {\n            if (e.key === \"Enter\") {\n              submitQuestion();\n            }\n          }}\n          placeholder=\"What's your question?\"\n          autoFocus\n        />\n        <button\n          className=\"btn btn-primary\"\n          style={{\n            borderTopRightRadius: \"2rem\",\n            borderBottomRightRadius: \"2rem\",\n          }}\n          onClick={() => submitQuestion()}\n        >\n          Submit\n        </button>\n      </div>\n    </div>\n    <div className=\"d-flex flex-column-reverse\">\n      {messages.map(({ role, content }, i) => {\n        return (\n          <div key={i} className={`message ${role}`}>\n            {role === \"user\" && (\n              <Widget\n                src=\"mob.near/widget/N.ProfileLine\"\n                props={{ accountId: context.accountId }}\n              />\n            )}\n            <Markdown text={content} />\n          </div>\n        );\n      })}\n      {loading && (\n        <div key=\"loading\" className={`message assistant`}>\n          <div>\n            <span\n              className=\"spinner-grow spinner-grow-sm me-1\"\n              role=\"status\"\n              aria-hidden=\"true\"\n            />\n          </div>\n        </div>\n      )}\n    </div>\n  </Wrapper>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/mob.near/widget/Near.AI", "fact_widget_deployments_id": "ed712e5c855cb1fa34fa58d8794f9e20", "inserted_timestamp": "2023-12-08T20:57:30.246Z", "modified_timestamp": "2023-12-20T03:22:11.422Z", "__row_index": 8}