{"tx_hash": "8chjzeKuXQZnnfCN49pUTXXAvYXadCnn6FYqpfKqbh7H", "action_id_social": "CvVZasqRstsTTPdtZa3gApfaVEvjH6wy2unwvVoYa1Ad-0-widget", "block_id": 113726219, "block_timestamp": "2024-02-28T03:25:47.457Z", "signer_id": "mob.near", "widget_name": "BerryDraw", "source_code": "const accountId = context.accountId;\n\nconst largeHeart = `\n..XX.XX..\n.X##X##X.\nX#######X\nX#######X\n.X#####X.\n..X###X..\n...X#X...\n....X....\n`\n  .trim()\n  .split(\"\\n\");\n\nconst smallHeart = `\n.X#X#X.\nX#####X\nX#####X\n.X###X.\n...#...\n`\n  .trim()\n  .split(\"\\n\");\n\nconst DefaultBalance = \"25000000000000000000\";\n\nconst avocadoCount = accountId\n  ? parseFloat(\n      Near.view(\"berryclub.ek.near\", \"get_account\", { account_id: accountId })\n        ?.avocado_balance ?? DefaultBalance\n    ) / 1e18\n  : 0;\n\nconst pixelCount = (img) => img.join(\"\").replaceAll(\".\", \"\").length;\n\nconst rgb = (r, g, b) => r * 65536 + g * 256 + b;\n\nfunction draw() {\n  const lines =\n    avocadoCount >= pixelCount(largeHeart) ? largeHeart : smallHeart;\n  const w = lines[0].length;\n  const h = lines.length;\n\n  const x = Math.floor(Math.random() * (50 - w));\n  const y = Math.floor(Math.random() * (50 - h));\n  const pixels = [];\n  for (let i = 0; i < h; ++i) {\n    for (let j = 0; j < w; ++j) {\n      const c = lines[i].charAt(j);\n      if (c == \".\") {\n        continue;\n      }\n      const color =\n        c == \"#\"\n          ? rgb(\n              Math.floor(Math.random() * 64 + 192),\n              Math.floor(Math.random() * 32),\n              Math.floor(Math.random() * 32)\n            )\n          : rgb(\n              Math.floor(Math.random() * 32),\n              Math.floor(Math.random() * 32),\n              Math.floor(Math.random() * 32)\n            );\n      pixels.push({\n        x: x + j,\n        y: y + i,\n        color,\n      });\n    }\n  }\n  Near.call(\"berryclub.ek.near\", \"draw\", { pixels }, \"100000000000000\");\n}\n\nfunction buy() {\n  Near.call(\n    \"berryclub.ek.near\",\n    \"buy_tokens\",\n    {},\n    \"30000000000000\",\n    Big(\"0.2\").mul(Big(10).pow(24)).toFixed(0)\n  );\n}\n\nreturn (\n  <div style={{ maxWidth: \"600px\", margin: \"auto\" }}>\n    <div className=\"d-flex gap-1\">\n      <button\n        disabled={avocadoCount < 25}\n        className=\"btn btn-outline-danger mb-1 flex-grow-1\"\n        onClick={() => draw()}\n      >\n        DRAW \u2764\ufe0f\n      </button>\n      <button\n        disabled={!accountId}\n        className={`btn ${\n          avocadoCount < 25 ? \"btn-success\" : \"btn-outline-success\"\n        } mb-1`}\n        onClick={() => buy()}\n      >\n        Buy 50 \ud83e\udd51\n      </button>\n    </div>\n    <Widget src=\"mob.near/widget/BerryclubBoard\" props={{}} />\n    <div>{`You have ${avocadoCount.toFixed(1)} \ud83e\udd51`}</div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/mob.near/widget/BerryDraw", "fact_widget_deployments_id": "d8cf6398df4387a5fbb31416f0c75ea8", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 4}