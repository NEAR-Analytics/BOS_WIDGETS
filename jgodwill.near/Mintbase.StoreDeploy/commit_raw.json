{"tx_hash": "77XJ6EB7FaEMNoQ5sLK2qapoACSQHXxK84QRpH4vRLC", "action_id_social": "9kMQEh2zEc1Qi95yhLcW7NjLMtWXn2sLENS6bwPGGJxm-0-widget", "block_id": 103652268, "block_timestamp": "2023-10-18T10:58:41.037Z", "signer_id": "jgodwill.near", "widget_name": "Mintbase.StoreDeploy", "source_code": "const accountId = context.accountId;\n\nconst data = Social.keys(\"*/profile\", \"final\");\n\nif (!data) {\n  return \"Loading\";\n}\n\nState.init({\n  account: accountId,\n});\nconst accounts = Object.entries(data);\n\nconst allWidgets = [];\n\nfor (let i = 0; i < accounts.length; ++i) {\n  const accountId = accounts[i][0];\n  allWidgets.push(accountId);\n}\nconst onChangeAccount = (account) => {\n  State.update({\n    account: account[0],\n  });\n  fetchData(state.account);\n};\n\nconst Card = styled.div`\npadding: 1em;\nborder: 1px solid #e5e8eb;\ngap: 2em;\nmargin: 10px auto;\nborder-radius: .7em;\n& input{\n  display: block;\n  padding:.5em;\n  width:100%;\n  border: 1px solid #e5e8eb;\n  border-radius: 10px;\n  outline: none;\n  background: #f4f5f6;\n  color: #525c76;\n  :focus{\n  box-shadow:none;\n    border:1px solid #0d99ff;\n  }\n  &::placeholder {\n    color: palevioletred;\n  }\n  }\n  .soulbound{\n    display: flex;\n    justify-content: space-between;\n    width: 100%;\n  }\n`;\n\nconst Cards = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n  width: 100%;\n  background: rgba(214, 214, 214, 0.2);\n  border-radius: 10px;\n  justify-content: center;\n  padding-top: 3em;\n  box-shadow: 0 0.05rem 0.05rem rgb(34 34 34 / 5%), 0 0.2rem 0.8rem rgb(34 34 34 / 8%);\n`;\n\nfunction fetchData(accountAddress) {\n  if (!state.account) {\n    State.update({\n      account: accountId,\n    });\n  }\n  const response = fetch(\"https://graph.mintbase.xyz/mainnet\", {\n    method: \"POST\",\n    headers: {\n      \"mb-api-key\": \"anon\",\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify({\n      query: `query MyQuery {\n  nft_contracts(where: {owner_id: {_eq: \"nate.near\"}}) {\n    id\n  }\n}\n\n`,\n    }),\n  });\n\n  State.update({\n    nftContracts: response.body.data.nft_contracts,\n  });\n  console.log(\"running\", response);\n}\n\nfetchData(state.account);\n\nconst fetchStoreFrontData = (accountAddress) => {\n  const response2 = fetch(\"https://graph.mintbase.xyz/mainnet\", {\n    method: \"POST\",\n    headers: {\n      \"mb-api-key\": \"anon\",\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify({\n      query: `query MyQuery {\n  mb_views_nft_tokens(\n    where: {owner: {_eq: \"nate.near\"}, _and: {burned_timestamp: {_is_null: true}, last_transfer_timestamp: {_is_null: false}}, nft_contract_id: {_eq: \"${accountAddress}\"}}\n    limit: 30\n    order_by: {last_transfer_timestamp: desc}\n  ) {\n    nft_contract_id\n    title\n    description\n    media\n    last_transfer_receipt_id\n  }\n}\n`,\n    }),\n  });\n\n  State.update({\n    storeContracts: response2.body.data.mb_views_nft_tokens,\n  });\n  console.log(\"running2\", state.storeContracts);\n};\n\n// console.log(\"response\", state.account);\nconst storeAddressChangeHandler = (storeAddress) => {\n  fetchStoreFrontData(storeAddress);\n  console.log(\"store address: \", storeAddress);\n  state.update({\n    storeAddress: storeAddress,\n  });\n};\nreturn (\n  <div>\n    <h2 className=\"text-center my-4\">\n      Enter a Near address to See the various Mintbase contracts under it\n    </h2>\n    <Card>\n      Near Address:\n      <Typeahead\n        id=\"async-example\"\n        className=\"type-ahead\"\n        isLoading={isLoading}\n        labelKey=\"search\"\n        minLength={1}\n        options={allWidgets}\n        onChange={(value) => onChangeAccount(value)}\n        placeholder={accountId}\n      />\n    </Card>\n    {state.nftContracts.length > 0 ? (\n      <Card>\n        <select onChange={(e) => storeAddressChangeHandler(e.target.value)}>\n          <option selected disabled>\n            Select a contract\n          </option>\n          {state.nftContracts.map((contract) => (\n            <option value={contract.id}>{contract.id}</option>\n          ))}\n        </select>\n      </Card>\n    ) : (\n      <p>No contracts found for {state.account}</p>\n    )}\n    {state.storeContracts.length > 0 ? (\n      <Cards>\n        {state.storeContracts.map((store) => (\n          <Widget\n            src=\"jgodwill.near/widget/Mintbase.StoreFront\"\n            props={{ storeInfo: store }}\n          />\n        ))}\n      </Cards>\n    ) : (\n      <p>No NFTs found for {state.storeAddress}</p>\n    )}\n  </div>\n);\n", "metadata": null, "branch": {"draft": null}, "widget_modules_used": null, "widget_url": "https://near.social/#/jgodwill.near/widget/Mintbase.StoreDeploy", "fact_widget_deployments_id": "34ff3224719ff3a87ec7d3b2acc83676", "inserted_timestamp": "2023-10-18T12:49:02.093Z", "modified_timestamp": "2023-10-18T12:49:02.093Z", "__row_index": 2}