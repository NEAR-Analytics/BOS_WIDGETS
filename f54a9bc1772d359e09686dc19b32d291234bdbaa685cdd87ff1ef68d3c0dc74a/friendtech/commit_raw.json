{"tx_hash": "8qKUT1dm51byxeGApcg5xkuZDFh2QE3Pn9oQYntHBe2X", "action_id_social": "2357tC66V4k7FCWPSq7m1afHy8kqKYXjUmXXK1mPpsLW-0-widget", "block_id": 103294156, "block_timestamp": "2023-10-13T17:20:32.397Z", "signer_id": "f54a9bc1772d359e09686dc19b32d291234bdbaa685cdd87ff1ef68d3c0dc74a", "widget_name": "friendtech", "source_code": "let greeting = `Have a great day ${props.name}.`;\nconst decimals = 18;\n\nfunction formatHex0(value, tokenDecimals) {\n  const formattedValue = Big(value.toString())\n    .div(Big(10).pow(tokenDecimals))\n    .toFixed(0)\n    .replace(/\\d(?=(\\d{3})+\\.)/g, \"$&,\");\n\n  return formattedValue;\n}\n\nfunction formatHex(value, tokenDecimals) {\n  const formattedValue = Big(value.toString())\n    .div(Big(10).pow(tokenDecimals))\n    .toFixed(6)\n    .replace(/\\d(?=(\\d{3})+\\.)/g, \"$&,\");\n\n  return formattedValue;\n}\n\nState.init({\n  strEther: 0,\n  gasPrice: 0,\n});\n\n// Force user to connect to Base to show UI\nif (\n  state.chainId === undefined &&\n  ethers !== undefined &&\n  Ethers.send(\"eth_requestAccounts\", [])[0]\n) {\n  Ethers.provider()\n    .getNetwork()\n    .then((chainIdData) => {\n      if (chainIdData?.chainId) {\n        State.update({ chainId: chainIdData.chainId });\n      }\n    });\n}\n\nif (state.chainId !== undefined && state.chainId !== 8453) {\n  return <p>Switch to Base Mainnet</p>;\n}\n\n// FETCH ABI\n\nconst contractAddress = \"0xCF205808Ed36593aa40a44F10c7f7C2F67d4A4d4\";\nconst tokenDecimals = 18;\n\nconst contractAbi = fetch(\n  \"https://raw.githubusercontent.com/aeither/bos-gateway/main/abi/FriendtechSharesV1.json\"\n);\nif (!contractAbi.ok) {\n  return \"Loading\";\n}\n\nconst iface = new ethers.utils.Interface(contractAbi.body);\n\n// HELPER FUNCTIONS\n\nfunction getGasPrice() {\n  return Ethers.provider().getGasPrice();\n}\n\n// DETECT SENDER\n\nif (state.sender === undefined) {\n  const accounts = Ethers.send(\"eth_requestAccounts\", []);\n  if (accounts.length) {\n    State.update({ sender: accounts[0] });\n    console.log(\"set sender\", accounts[0]);\n  }\n}\n\n// FETCH SENDER BALANCE\n\nif (state.balance === undefined && state.sender) {\n  Ethers.provider()\n    .getBalance(state.sender)\n    .then((balance) => {\n      State.update({ balance: Big(balance).div(Big(10).pow(18)).toFixed(2) });\n    });\n}\n\n// OUTPUT UI\n\nconst getSender = () => {\n  return !state.sender\n    ? \"\"\n    : state.sender.substring(0, 6) +\n        \"...\" +\n        state.sender.substring(state.sender.length - 4, state.sender.length);\n};\n\nreturn (\n  <>\n    <div class=\"sticky-top bg-white text-dark border-bottom\">\n      <div class=\"container px-0 py-2\">\n        <div class=\"row justify-content-between\">\n          <div class=\"col\">\n            <h2>\n              <span class=\"text-info\">friend.</span>tech\n            </h2>\n          </div>\n          <div class=\"col\">\n            <div class=\"row justify-content-between\">\n              <Web3Connect connectLabel=\"Connect\" />\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    {!!state.sender && (\n      <div class=\"container centered-text\">\n        <div class=\"row\">\n          <div class=\"col\">\n            <div class=\"border rounded py-2 my-2 text-center\">\n              \u2b28 {state.balance} ETH - {getSender()}\n            </div>\n          </div>\n        </div>\n      </div>\n    )}\n\n    <div class=\"container centered-text\">\n      <h4>Highlights</h4>\n      <div class=\"row\">\n        <div class=\"col m-2\">Herro - 0x5479...0311</div>\n        <div class=\"col\">\n          <button\n            onClick={() => {\n              clipboard.writeText(\"0x5479f127a4d594208549c86f4b4903a1175a0311\");\n            }}\n          >\n            Copy\n          </button>\n        </div>\n      </div>\n      <div class=\"row\">\n        <div class=\"col m-2\">Cobie - 0x4e5f...676e1</div>\n        <div class=\"col\">\n          <button\n            onClick={() => {\n              clipboard.writeText(\"0x4e5f7e4a774bd30b9bdca7eb84ce3681a71676e1\");\n            }}\n          >\n            Copy\n          </button>\n        </div>\n      </div>\n      <div class=\"row\">\n        <div class=\"col m-2\">Machi BB - 0xf0ea...df3d</div>\n        <div class=\"col\">\n          <button\n            onClick={() => {\n              clipboard.writeText(\"0xf0ea13334d6f74044ec7332de1c6ec194179df3d\");\n            }}\n          >\n            Copy\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"container centered-text mt-4\">\n      <h4>Explore</h4>\n      <div class=\"row\">\n        <div class=\"col py-2\">\n          <input\n            disabled={!state.sender}\n            value={state.targetAddress}\n            onChange={(e) => State.update({ targetAddress: e.target.value })}\n            placeholder=\"Address\"\n          />\n          <button\n            onClick={() => {\n              const friendTechContract = new ethers.Contract(\n                contractAddress,\n                contractAbi.body,\n                Ethers.provider().getSigner()\n              );\n\n              // Total supply\n              friendTechContract\n                .sharesSupply(state.targetAddress)\n                .then((data) => {\n                  console.log(formatHex(data, 0));\n                  State.update({ sharesSupply: formatHex0(data, 0) });\n                });\n\n              // Get Sell Price\n              friendTechContract\n                .getSellPrice(state.targetAddress, 1)\n                .then((data) => {\n                  console.log(formatHex(data, decimals));\n                  State.update({ sellPrice: formatHex(data, decimals) });\n                });\n\n              // Get Sell Price After Fee\n              friendTechContract\n                .getSellPriceAfterFee(state.targetAddress, 1)\n                .then((data) => {\n                  console.log(formatHex(data, decimals));\n                  State.update({\n                    sellPriceAfterFee: formatHex(data, decimals),\n                  });\n                });\n\n              // Get Buy Price\n              friendTechContract\n                .getBuyPrice(state.targetAddress, 1)\n                .then((data) => {\n                  console.log(formatHex(data, decimals));\n                  State.update({ buyPrice: formatHex(data, decimals) });\n                });\n\n              // Get Buy Price After Fee\n              friendTechContract\n                .getBuyPriceAfterFee(state.targetAddress, 1)\n                .then((data) => {\n                  console.log(formatHex(data, decimals));\n                  State.update({ buyPriceAfterFee: formatHex(data, decimals) });\n                });\n\n              // Get target user balance\n              Ethers.provider()\n                .getBalance(state.targetAddress)\n                .then((balance) => {\n                  console.log(\"balance\", formatHex(balance, decimals));\n                  State.update({ targetBalance: formatHex(balance, decimals) });\n                });\n            }}\n          >\n            \ud83d\udd0d Search\n          </button>\n        </div>\n      </div>\n    </div>\n\n    {state.targetAddress && state.sharesSupply && (\n      <>\n        <div class=\"container centered-text\">\n          <div class=\"row \">\n            <div class=\"col \">\n              <div class=\"border rounded py-2 my-2\">\n                <div class=\"px-2\">Supply: {state.sharesSupply}</div>\n                <div class=\"px-2\">Buy Price: {state.buyPrice}</div>\n                <div class=\"px-2\">\n                  Buy Price (including fees): {state.buyPriceAfterFee}{\" \"}\n                </div>\n                <div class=\"px-2\">Sell Price: {state.sellPrice}</div>\n                <div class=\"px-2\">\n                  Sell Price (including fees): {state.sellPriceAfterFee}\n                </div>\n                <div class=\"px-2\">Address Balance: {state.targetBalance}</div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"container centered-text\">\n          <div class=\"row\">\n            <div class=\"col\">\n              <div class=\"d-grid gap-2 d-md-block\">\n                <button\n                  onClick={() => {\n                    const friendTechContract = new ethers.Contract(\n                      contractAddress,\n                      contractAbi.body,\n                      Ethers.provider().getSigner()\n                    );\n\n                    // Buy Shares\n                    friendTechContract\n                      .buyShares(state.targetAddress, 1, {\n                        value: ethers.utils.parseEther(state.buyPriceAfterFee),\n                      })\n                      .then((data) => {\n                        console.log(data);\n                      });\n                  }}\n                >\n                  Buy\n                </button>\n              </div>\n            </div>\n            <div class=\"col\">\n              <div class=\"d-grid gap-2 d-md-block\">\n                <button\n                  class=\"btn btn-danger\"\n                  onClick={() => {\n                    const friendTechContract = new ethers.Contract(\n                      contractAddress,\n                      contractAbi.body,\n                      Ethers.provider().getSigner()\n                    );\n\n                    // Sell Shares\n                    friendTechContract\n                      .sellShares(state.targetAddress, 1, {\n                        value: ethers.utils.parseEther(state.sellPriceAfterFee),\n                      })\n                      .then((data) => {\n                        console.log(data);\n                      });\n                  }}\n                >\n                  Sell\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </>\n    )}\n  </>\n);\n", "metadata": {"platform": "jutsu.ai"}, "branch": {"draft": null}, "widget_modules_used": null, "widget_url": "https://near.social/#/f54a9bc1772d359e09686dc19b32d291234bdbaa685cdd87ff1ef68d3c0dc74a/widget/friendtech", "fact_widget_deployments_id": "9097e2b0a31b146659af7f046999e819", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}