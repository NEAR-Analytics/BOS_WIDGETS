{"tx_hash": "4RctV8EqvR8i729hEoKiqS4mvnGsdvPNvJDjEsd77eAP", "action_id_social": "Bk6kP8DWf19C16497pRw2oJFhSMzpAnZBgCmGx811zaQ-0-widget", "block_id": 101862036, "block_timestamp": "2023-09-24T17:04:07.431Z", "signer_id": "a13x.near", "widget_name": "ethglobal-nyc-rewardify-drop", "source_code": "// FETCH ABI\n\nconst myContract = \"0x32D786463A3f454904566A9b7957856A332d4c60\";\nconst tokenDecimals = 18;\n\nconst myContractAbi = fetch(\"https://rewardify.web.app/YourContract.json\");\nif (!myContractAbi.ok) {\n  return \"Loading\";\n}\n\nconst iface = new ethers.utils.Interface(myContractAbi.body);\n\n// HELPER FUNCTIONS\n\nconst getContractState = (receiver) => {\n  if (!state.sender) {\n    return;\n  }\n  const encodedData = iface.encodeFunctionData(\"getDrop\", [receiver]);\n\n  return Ethers.provider()\n    .call({\n      to: myContract,\n      data: encodedData,\n    })\n    .then((raw) => {\n      const data = iface.decodeFunctionResult(\"getDrop\", raw);\n\n      return data;\n    });\n};\n\nif (state.sender) {\n  getContractState(state.sender).then((data) => {\n    console.log(data);\n    State.update(data);\n  });\n}\n\nState.init({\n  triggerText: `#rewardify`,\n  amount: 1,\n  cooldownSeconds: 60,\n  walletAddress: \"\",\n  balance,\n});\n\nconst API_URL = \"https://us-central1-rewardify.cloudfunctions.net/helloWorld\";\n\nif (state.sender === undefined) {\n  const accounts = Ethers.send(\"eth_requestAccounts\", []);\n  if (accounts.length) {\n    State.update({ sender: accounts[0], walletAddress: accounts[0] });\n    console.log(\"set sender\", accounts[0]);\n  }\n}\n\nconst handleButtonClick = async () => {\n  const contract = new ethers.Contract(\n    myContract,\n    myContractAbi.body,\n    Ethers.provider().getSigner()\n  );\n\n  contract\n    .submit(myContract, {\n      dropId: state.walletAddress,\n      amount: state.amount,\n      cooldownSeconds: state.cooldownSeconds,\n    })\n    .then((transactionHash) => {\n      console.log(\"transactionHash is \" + transactionHash);\n    });\n};\n\nconst handleInputChange = (e) => {\n  console.log(e.target);\n  State.update({\n    [e.target.id]: e.target.value,\n  });\n};\n\nconst networks = [\"NEON EVM Dev\", \"Gnosis Chain Chiado\", \"Goerli (UMA)\", \"\"];\n\nreturn (\n  <>\n    <div class=\"card mt-5\">\n      <div class=\"card-header d-flex justify-content-between align-items-center p-3\">\n        <h2 className=\"mb-0\">Rewardify drop</h2>\n        <div className=\"d-flex flex-row align-items-center\">\n          <Web3Connect connectLabel=\"Connect wallet\" />\n        </div>\n      </div>\n\n      <div class=\"d-flex justify-content-start align-items-center p-3\">\n        <label for=\"value\">Trigger text</label>\n        <input\n          className=\"form-control ms-2\"\n          onChange={handleInputChange}\n          type=\"text\"\n          placeholder=\"\"\n          value={state.triggerText}\n          id=\"triggerText\"\n        />\n      </div>\n\n      <div class=\"d-flex justify-content-start align-items-center p-3\">\n        <label for=\"value\">Network</label>\n        <Typeahead\n          className=\"ms-2\"\n          options={networks}\n          onChange={(value) => {\n            State.update({ network: value[0] });\n          }}\n          value={[state.network]}\n        />\n      </div>\n\n      <div class=\"d-flex justify-content-start align-items-center p-3\">\n        <label for=\"value\">Amount</label>\n        <input\n          className=\"form-control ms-2\"\n          onChange={handleInputChange}\n          type=\"text\"\n          placeholder=\"\"\n          value={state.amount}\n          id=\"amount\"\n        />\n      </div>\n\n      <div class=\"d-flex justify-content-start align-items-center p-3\">\n        <label for=\"value\">Cooldown</label>\n        <input\n          className=\"form-control ms-2 me-2\"\n          onChange={handleInputChange}\n          type=\"text\"\n          placeholder=\"\"\n          value={state.cooldownSeconds}\n          id=\"cooldownSeconds\"\n        />\n        seconds\n      </div>\n\n      <div class=\"card-footer text-muted justify-content-start align-items-center p-3\">\n        <button\n          class=\"btn btn-primary\"\n          onClick={handleButtonClick}\n          disabled={\n            !state.triggerText ||\n            !state.network ||\n            !state.amount ||\n            !state.cooldownSeconds\n          }\n        >\n          Save drop\n        </button>\n        {JSON.stringify(state)}\n        <p>\n          Claim URL:{\" \"}\n          <a class=\"underline\">\n            https://near.social/a13x.near/widget/ethglobal-nyc-rewardify-drop?drop=\n            {state.walletAddress}\n          </a>\n        </p>\n      </div>\n    </div>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/a13x.near/widget/ethglobal-nyc-rewardify-drop", "fact_widget_deployments_id": "791293dd748b00c0e3a6671421113c66", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}