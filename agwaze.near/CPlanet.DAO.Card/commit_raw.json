{"tx_hash": "3UTBbmvUqn9b4Yjd58Asu3EohhLLnvPTUNbk5czTgA4b", "action_id_social": "64pQ1m2wp4BqcijeXcpvSyTZ8AXexCjP55kZENbS1qS-0-widget", "block_id": 104926057, "block_timestamp": "2023-11-04T15:29:45.306Z", "signer_id": "agwaze.near", "widget_name": "CPlanet.DAO.Card", "source_code": "const daoId = props.daoId ?? \"dao.near\";\n\nif (!daoId) {\n  return \"DAO ID not provided\";\n}\n\n// -- Pikespeak API\nconst baseApi = \"https://api.pikespeak.ai\";\nconst publicApiKey = \"36f2b87a-7ee6-40d8-80b9-5e68e587a5b5\";\n\nconst CardRoot = styled.div`\n    width: 315px;\n    height: 448px;\n    border: 1px solid #EFEFEF;\nbackground: #FFF;\nbox-shadow: 2px 2px 12px 0px rgba(0, 0, 0, 0.05);\nmargin-bottom: 20px;\ndisplay: flex;\nflex-direction: column;\n`;\nconst Top = styled.div`\n    height: 80px;\n   > img {\n      width: 100%;\n      height: 100%;\n      object-fit: cover;\n    }\n    position: relative;\n    width: 100%;\n    background: black;\n    div {\n      position: absolute;\n      top: 50px;\n      left: 10px;;\n      img {\n        width: 66px;\n        height: 66px;\n        flex-shrink: 0;\n        border-radius: 50%;\n        border 1px solid #fff;\n      }\n    }\n`;\n\nconst Bottom = styled.div`\n    h1 {\n        overflow: hidden;\n        color: #000;\n        text-overflow: ellipsis;\n        whitespace: nowrap;\n        font-family: Helvetica Neue;\n        font-size: 24px;\n        font-style: normal;\n        font-weight: 700;\n        line-height: normal;\n        text-transform: uppercase;\n    }\n`;\n\nconst ImageProfile = styled.div`\n  \n  img {\n    position: absolute;\n    width: 66px;\n    height: 66px;\n    flex-shrink: 0;\n    border: 1px solid white;\n    border-radius: 50%;\n    top: 45px;\n    object-fit: cover;\n    background: black;\n    left: 16px;\n  }\n`;\n\nconst HeaderText = styled.div`\n  margin-top: 32px;\n  height: 140px;\n  p {\n    margin-bottom: 10px;\n    overflow: hidden;\n    color: #B0B0B0;\n    text-overflow: ellipsis;\n    font-family: Helvetica Neue;\n    font-size: 16px;\n    font-style: normal;\n    font-weight: 400;\n    line-height: normal;\n  }\n`;\n\nconst CardBody = styled.div`\npadding: 0 16px;\n  h1 {\n    margin-top: 40px;\n    color: #000;\nfont-family: Helvetica Neue;\nfont-size: 20px;\nfont-style: normal;\ntext-transform: lowercase;\nfont-weight: 700;\nline-height: normal;\n  }\n  h3 {\n    overflow: hidden;\ncolor: #000;\ntext-overflow: ellipsis;\nwhitespace: nowrap;\nfont-family: Helvetica Neue;\nfont-size: 16px;\nfont-style: normal;\nfont-weight: 400;\nline-height: 148%; \n  }\n`;\n\nconst AmountSec = styled.div`\n  width: 100%;\n  display: flex;\n  flex-direction: row;\n  align-items: flex-start;\n  gap: 10px;\n  .amount {\n    font-size: 5px !important;\n  }\n  div {\n    span {\n      color: #B0B0B0;\n      font-family: Helvetica Neue;\n      font-size: 8px;\n      font-style: normal;\n      font-weight: 400;\n      line-height: normal;\n      text-transform: uppercase;\n    }\n    img {\n      width: 15px;\n      height: 15px;\n    }\n    p {\n        color: #000;\n        font-family: Helvetica Neue;\n        font-size: 16px;\n        font-style: normal;\n        font-weight: 700;\n        line-height: normal;\n        text-transform: uppercase;\n        display: flex;\n        align-items: center;\n        gap: 5px;\n        span {\n          color: #000;\n          font-family: Helvetica Neue;\n          font-size: 12px;\n          font-style: normal;\n          font-weight: 400;\n          line-height: normal;\n          text-transform: uppercase;\n        }\n    }\n  }\n`;\n\nconst Button = styled.div`\nwidth: 100%;\ndisplay: flex;\nalign-items: center;\njustify-content: center;\nmargin-top: 10px;\n\n  button {\n    border: 1px solid black;\n    border-radius: 0;\n    color: white;\n    background: black;\n    text-align: center\n    display: flex;\n    width: 296px;\n    padding: 7px 0px;\n    cursor: pointer;\n  }\n  button:disabled {\n    background: grey;\n    border: grey;\n    cursor: not-allowed;\n  }\n  button:hover, a:hover {\n    background: white;\n    color: black;\n    border-color: black;\n  }\n`;\n\nconst Tags = styled.div`\n    display:flex;\n    gap: 7px;\n    margin-left: 10px;\n    margin-top: 40px;\n    .tag {\n         color: #FFF;\n        font-family: Helvetica Neue;\n        font-size: 24px;\n        font-style: normal;\n        font-weight: 700;\n        line-height: normal;\n        border-radius: 50px;\n        background: #F8F8F8;\n        width: max-content;\n        color: #B0B0B0;\n        text-align: center;\n        font-family: Helvetica Neue;\n        font-size: 10px;\n        font-style: normal;\n        font-weight: 500;\n        line-height: 150%; /* 15px */\n        padding: 3px 10px;\n    }\n    .no-tag {\n      opacity: 0;\n    }\n`;\n\nconst Footer = styled.div`\n  height: 100px;\n  display: flex;\n  flex-direction: column;\n`;\n\nconst fetchApiConfig = {\n  mode: \"cors\",\n  headers: {\n    \"x-api-key\": publicApiKey,\n  },\n};\n\nconst constructURL = (baseURL, paramObj) => {\n  let params = \"\";\n  for (const [key, value] of Object.entries(paramObj ?? {})) {\n    params += `${key}=${value}&`;\n  }\n  params = params.slice(0, -1);\n  return `${baseURL}?${params}`;\n};\n\nconst fether = {\n  balances: (accounts) => {\n    return fetch(\n      constructURL(`${baseApi}/account/balances`, { accounts }),\n      fetchApiConfig\n    );\n  },\n  proposalsStatus: (daoId) => {\n    return fetch(\n      constructURL(`${baseApi}/daos/proposals/status/${daoId}`),\n      fetchApiConfig\n    );\n  },\n};\nconst balances = fether.balances([daoId]);\nconst proposalsStatus = fether.proposalsStatus(daoId);\n\nlet activeProposalsCount;\nlet totalProposalsCount;\nproposalsStatus.body &&\n  proposalsStatus.body?.forEach((p) => {\n    activeProposalsCount += p[\"InProgress\"] ? parseInt(p[\"InProgress\"]) : 0;\n    totalProposalsCount += p[\"Total\"] ? parseInt(p[\"Total\"]) : 0;\n  });\n// --\n\n// -- Social DB\nconst profile = Social.get(`${daoId}/profile/**`, \"final\");\n// --\n\n// -- Smart Contract\nconst policy = Near.view(daoId, \"get_policy\");\nlet members = [];\npolicy &&\n  policy.roles.forEach((role) => {\n    if (typeof role.kind.Group === \"object\") {\n      members = members.concat(role.kind.Group);\n    }\n  });\nmembers = [...new Set(members)];\n// --\n\nconst shorten = (str, len) => {\n  if (str.length <= len) {\n    return str;\n  }\n  return str.slice(0, len) + \"...\";\n};\n\nconst shortenNumber = (n) => {\n  if (n < 1e3) return n;\n  if (n >= 1e3 && n < 1e6) return (n / 1e3).toFixed(1) + \"k\";\n  if (n >= 1e6 && n < 1e9) return (n / 1e6).toFixed(1) + \"m\";\n  if (n >= 1e9 && n < 1e12) return (n / 1e9).toFixed(1) + \"b\";\n  if (n >= 1e12) return (n / 1e12).toFixed(1) + \"t\";\n};\n\nfunction makeAccountIdShorter(accountId) {\n  if (accountId.length > shortenLength) {\n    return accountId.slice(0, shortenLength) + \"...\";\n  }\n  return accountId;\n}\n\nreturn (\n  <CardRoot>\n    <Top>\n      <img\n        src={\n          profile.backgroundImage\n            ? `https://ipfs.near.social/ipfs/${profile.backgroundImage.ipfs_cid}`\n            : \"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRub7hFLkStCvZiaSeiUGznP4uzqPPcepghhg&usqp=CAU\"\n        }\n        alt=\"\"\n      />\n      <div>\n        <img\n          src={\n            profile.image\n              ? `https://ipfs.near.social/ipfs/${profile.image.ipfs_cid}`\n              : \"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRub7hFLkStCvZiaSeiUGznP4uzqPPcepghhg&usqp=CAU\"\n          }\n          alt=\"\"\n        />\n      </div>\n    </Top>\n    <Bottom>\n      <CardBody>\n        <HeaderText>\n          <h1>{daoId ? makeAccountIdShorter(daoId) : `DAO Name`}</h1>\n          <h3>\n            {shorten(profile?.description || \"\", 80)}\n            {profile !== null &&\n              (!profile?.description || profile?.description?.length < 1) &&\n              \"No description\"}\n          </h3>\n        </HeaderText>\n        <AmountSec>\n          <div>\n            <span>Total Funds</span>\n              {balances.body ? (\n                <span>\n                  <b className=\"me-1\">\n                    {shortenNumber(balances.body.totalUsd)}\n                  </b>\n                  USD\n                </span>\n              ) : (\n                <p>12.35k USD</p>\n              )}\n          </div>\n          <div>\n            <span>Members/Group</span>\n            <p>\n              {members.length ?? \"0\"}/\n              <span>{policy.roles.length ? policy.roles.length - 1 : 0}</span>\n            </p>\n          </div>\n          <div>\n            <span>Active/Total Proposal</span>\n            <p>\n              {activeProposalsCount ?? \"0\"} /\n              <span>{totalProposalsCount ?? 0}</span>\n            </p>\n          </div>\n        </AmountSec>\n      </CardBody>\n      <Footer>\n        <Tags>\n          {profile.tags ? (\n            Object.keys(profile.tags).length > 0 &&\n            Object.keys(profile.tags)\n              .slice(0, 3)\n              .map((data) => <div className=\"tag\">{data}</div>)\n          ) : (\n            <div className=\"no-tag\">man</div>\n          )}\n        </Tags>\n        <Button>\n          <a\n            href={`#/agwaze.near/widget/CPlanet.index?tab=daoProfile&daoId=${props.daoId}`}\n            onClick={() => props.onButtonClick()}\n          >\n            <button>View DAO</button>\n          </a>\n        </Button>\n      </Footer>\n    </Bottom>\n  </CardRoot>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/agwaze.near/widget/CPlanet.DAO.Card", "fact_widget_deployments_id": "c81482a3b7d786d87a8e070103120e0c", "inserted_timestamp": "2023-11-04T17:30:47.019Z", "modified_timestamp": "2023-11-04T17:30:47.019Z", "__row_index": 6}