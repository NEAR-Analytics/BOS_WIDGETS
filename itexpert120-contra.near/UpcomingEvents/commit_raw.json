{"tx_hash": "FHmEwKA3qBDtqWtZmXVoWGGdPk6DbLrkug4br4uhoKtZ", "action_id_social": "ALyUUYGjCVRViL1pFRwwHCBA5dJ5uDmCR7i9ZAof9rNy-0-widget", "block_id": 101131107, "block_timestamp": "2023-09-14T20:25:16.372Z", "signer_id": "itexpert120-contra.near", "widget_name": "UpcomingEvents", "source_code": "// helper function to fetch all events\r\nconst fetchAllEvents = () => {\r\n  const index = Social.index(\"every\", \"every.near/type/event\");\r\n\r\n  let fetchedEvents = [];\r\n\r\n  index.map((item) => {\r\n    const path = `${item.accountId}/thing/${item.value.id}`;\r\n    const blockHeight = item.blockHeight;\r\n\r\n    const eventThing = Social.getr(path, blockHeight);\r\n    fetchedEvents.push({ ...eventThing.data, path, blockHeight });\r\n  });\r\n\r\n  fetchedEvents = fetchedEvents.filter(\r\n    (ev) => ev.path !== \"itexpert120-contra.near/thing/\"\r\n  );\r\n\r\n  return fetchedEvents;\r\n};\r\n\r\n\r\nconst events = fetchAllEvents();\r\n\r\nconst upcomingEvents = events.filter((ev) => {\r\n  const today = new Date();\r\n  const eventStartDate = new Date(`${ev.start}T${ev.startTime}`);\r\n  return eventStartDate > today;\r\n});\r\n\r\nupcomingEvents.reverse();\r\n\r\nState.init({\r\n  selectedEvent: 0,\r\n  mobileEventView: false,\r\n});\r\n\r\nconst titleHeading = styled.h2`\r\n  color: #333;\r\n  font-feature-settings:\r\n    \"clig\" off,\r\n    \"liga\" off;\r\n  font-size: 24px;\r\n  font-style: normal;\r\n  font-weight: 600;\r\n  line-height: normal;\r\n  letter-spacing: -0.154px;\r\n  margin-bottom: 24px;\r\n`;\r\n\r\nconst EventCard = ({ event, index }) => {\r\n  const title = event.title || \"No-title event\";\r\n  const backgroundImage = event.background.url;\r\n  const hashtags = JSON.parse(event.hashTags);\r\n  const startDate = event.start;\r\n  const startTime = event.startTime;\r\n\r\n  const bgImage = styled.img`\r\n    height: 124px;\r\n    width: 100%;\r\n    object-fit: cover;\r\n    align-self: stretch;\r\n    border-radius: 4px;\r\n    background: ${backgroundImage\r\n      ? `url(${backgroundImage})`\r\n      : \"lightgray -5.848px -44.469px / 102.302% 147.491% no-repeat\"};\r\n\r\n    margin-bottom: 16px;\r\n  `;\r\n\r\n  const eventTitle = styled.h3`\r\n    color: #000;\r\n    font-size: 20px;\r\n    font-style: normal;\r\n    font-weight: 600;\r\n    line-height: normal;\r\n    margin-bottom: 8px;\r\n  `;\r\n\r\n  const formatStartTime = () => {\r\n    const date = new Date(`${startDate} ${startTime}`);\r\n    const options = {\r\n      hour: \"2-digit\",\r\n      minute: \"2-digit\",\r\n      timeZoneName: \"short\",\r\n    };\r\n\r\n    return date.toLocaleString(\"en-US\", options);\r\n  };\r\n\r\n  const formattedTime = formatStartTime();\r\n\r\n  const timeP = styled.p`\r\n    color: #5c5f62;\r\n    font-size: 16px;\r\n    font-style: normal;\r\n    font-weight: 500;\r\n    line-height: normal;\r\n    margin-bottom: 16px;\r\n    margin-top: 0;\r\n  `;\r\n\r\n  const tagsSpan = styled.span`\r\n    border-radius: 6px;\r\n    background: transparent;\r\n    display: flex;\r\n    padding: 4px;\r\n    flex-direction: row;\r\n    align-items: center;\r\n\r\n    color: #000;\r\n    font-size: 16px;\r\n    font-style: normal;\r\n    font-weight: 500;\r\n    line-height: normal;\r\n\r\n    @media (max-width: 550px) {\r\n      font-size: 12px;\r\n    }\r\n  `;\r\n\r\n  const hashIcon = () => {\r\n    return (\r\n      <svg\r\n        xmlns=\"http://www.w3.org/2000/svg\"\r\n        width=\"16\"\r\n        height=\"16\"\r\n        viewBox=\"0 0 16 16\"\r\n        fill=\"none\"\r\n      >\r\n        <path\r\n          d=\"M13.3332 6.00002C13.3332 5.63335 13.0332 5.33335 12.6665 5.33335H10.6665V3.33335C10.6665 2.96669 10.3665 2.66669 9.99984 2.66669C9.63317 2.66669 9.33317 2.96669 9.33317 3.33335V5.33335H6.6665V3.33335C6.6665 2.96669 6.3665 2.66669 5.99984 2.66669C5.63317 2.66669 5.33317 2.96669 5.33317 3.33335V5.33335H3.33317C2.9665 5.33335 2.6665 5.63335 2.6665 6.00002C2.6665 6.36669 2.9665 6.66669 3.33317 6.66669H5.33317V9.33335H3.33317C2.9665 9.33335 2.6665 9.63335 2.6665 10C2.6665 10.3667 2.9665 10.6667 3.33317 10.6667H5.33317V12.6667C5.33317 13.0334 5.63317 13.3334 5.99984 13.3334C6.3665 13.3334 6.6665 13.0334 6.6665 12.6667V10.6667H9.33317V12.6667C9.33317 13.0334 9.63317 13.3334 9.99984 13.3334C10.3665 13.3334 10.6665 13.0334 10.6665 12.6667V10.6667H12.6665C13.0332 10.6667 13.3332 10.3667 13.3332 10C13.3332 9.63335 13.0332 9.33335 12.6665 9.33335H10.6665V6.66669H12.6665C13.0332 6.66669 13.3332 6.36669 13.3332 6.00002ZM9.33317 9.33335H6.6665V6.66669H9.33317V9.33335Z\"\r\n          fill=\"#000\"\r\n        />\r\n      </svg>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div\r\n      style={{ marginBottom: 38, cursor: \"pointer\" }}\r\n      onClick={() =>\r\n        State.update({ selectedEvent: index, mobileEventView: true })\r\n      }\r\n    >\r\n      <bgImage\r\n        src={\r\n          backgroundImage || \"https://plainbackground.com/plain1024/abaaa5.png\"\r\n        }\r\n      />\r\n      <eventTitle>{title}</eventTitle>\r\n      <timeP>{formattedTime}</timeP>\r\n      <div className=\"d-flex gap-1 flex-wrap\">\r\n        {hashtags.map((it) => (\r\n          <tagsSpan className=\"border border-light-subtle \">\r\n            <hashIcon /> {it}\r\n          </tagsSpan>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst gridDiv = styled.div`\r\n  margin-top: 25px;\r\n  display: grid;\r\n  grid-template-columns: repeat(8, minmax(0, 1fr));\r\n`;\r\n\r\nconst leftSide = styled.div`\r\n  grid-column: span 2 / span 2;\r\n  margin-right: 72px;\r\n\r\n  @media (max-width: 1200px) {\r\n    margin-right: 50px;\r\n  }\r\n\r\n  @media (max-width: 990px) {\r\n    margin-right: 35px;\r\n  }\r\n\r\n  @media (max-width: 768px) {\r\n    grid-column: span 8 / span 8;\r\n    margin-right: 0;\r\n  }\r\n`;\r\n\r\nconst rightSide = styled.div`\r\n  grid-column: span 6 / span 6;\r\n  background: #fff;\r\n  border-radius: 10;\r\n\r\n  @media (max-width: 768px) {\r\n    display: none;\r\n  }\r\n`;\r\n\r\nconst eventsFeed = styled.div`\r\n  @media (max-width: 768px) {\r\n    ${state.mobileEventView && \"display: none;\"}\r\n  }\r\n`;\r\n\r\nconst mobileEventView = styled.div`\r\n  @media (width > 768px) {\r\n    display: none;\r\n  }\r\n`;\r\n\r\nconst backHeader = styled.p`\r\n  font-size: 18px;\r\n  font-weight: 500;\r\n  cursor: pointer;\r\n`;\r\n\r\nreturn (\r\n  <div className=\"container\">\r\n    <gridDiv>\r\n      <leftSide>\r\n        <div>\r\n          <eventsFeed>\r\n            <titleHeading>Upcoming Events</titleHeading>\r\n            <div className=\"d-flex flex-column\">\r\n              {upcomingEvents &&\r\n                upcomingEvents.map((ev, index) => (\r\n                  <EventCard event={ev} index={index} />\r\n                ))}\r\n            </div>\r\n          </eventsFeed>\r\n          {state.mobileEventView && (\r\n            <mobileEventView>\r\n              <backHeader\r\n                className=\"font-bold\"\r\n                onClick={() => State.update({ mobileEventView: false })}\r\n              >\r\n                <i className=\"bi bi-arrow-left\"></i> Back\r\n              </backHeader>\r\n              <Widget\r\n                src=\"itexpert120-contra.near/widget/EventView\"\r\n                props={{ data: upcomingEvents[state.selectedEvent] }}\r\n              />\r\n            </mobileEventView>\r\n          )}\r\n        </div>\r\n      </leftSide>\r\n      <rightSide>\r\n        <Widget\r\n          src=\"itexpert120-contra.near/widget/EventView\"\r\n          props={{ data: upcomingEvents[state.selectedEvent] }}\r\n        />\r\n      </rightSide>\r\n    </gridDiv>\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/itexpert120-contra.near/widget/UpcomingEvents", "fact_widget_deployments_id": "534da94c5aab03c8d2e290e795a2014c", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}