{"tx_hash": "EZeDWQU8AtGeKeJrEeaeuJHuq9JR616nEv2o6h4HkFyJ", "action_id_social": "FFTyz5JGTG5HLV6zwDmuHdSwbp18e5n5N5RwUVx6bici-0-widget", "block_id": 100472549, "block_timestamp": "2023-09-05T21:42:42.398Z", "signer_id": "itexpert120-contra.near", "widget_name": "CalendarTest", "source_code": "// helper function to fetch all events\r\nconst fetchAllEvents = () => {\r\n  const index = Social.index(\"every\", \"every.near/type/event\");\r\n\r\n  let fetchedEvents = [];\r\n\r\n  index.map((item) => {\r\n    const path = `${item.accountId}/thing/${item.value.id}`;\r\n    const blockHeight = item.blockHeight;\r\n\r\n    const eventThing = Social.getr(path, blockHeight);\r\n    fetchedEvents.push({ ...eventThing.data, path, blockHeight });\r\n  });\r\n\r\n  return fetchedEvents;\r\n};\r\n\r\n\r\nState.init({\r\n  hideNewEventModal: true,\r\n  hideFilterModal: true,\r\n  filterFrom: null,\r\n  filterTo: null,\r\n  filterEvents: false,\r\n  filteredEvents: null,\r\n});\r\n\r\nconst toggleFilteredEvents = () => {\r\n  State.update({\r\n    filterEvents: !state.filterEvents,\r\n  });\r\n};\r\n\r\nconst toggleNewEventModal = () => {\r\n  State.update({ hideNewEventModal: !state.hideNewEventModal });\r\n};\r\n\r\nconst toggleFilterModal = () => {\r\n  State.update({ hideFilterModal: !state.hideFilterModal });\r\n};\r\n\r\nconst fetchedEvents = fetchAllEvents();\r\n\r\nif (!fetchedEvents) {\r\n  return <div>Loading...</div>;\r\n}\r\n\r\nconst formattedEvents = fetchedEvents.map((event) => {\r\n  return {\r\n    title: event.title,\r\n    start: new Date(`${event.start} ${event.startTime}`),\r\n    end: new Date(`${event.end} ${event.endTime}`),\r\n    url: event.link,\r\n    allDay: event.isAllDay === \"true\",\r\n    editable: false,\r\n    extendedProps: {\r\n      category: event.category,\r\n    },\r\n    description: event.description,\r\n  };\r\n});\r\n\r\nconst handleEventClick = () => {\r\n  console.log(\"handleEventClick\");\r\n};\r\n\r\nconst handleAddEvent = () => {\r\n  toggleNewEventModal();\r\n};\r\n\r\nconst handleFilter = () => {\r\n  toggleFilterModal();\r\n};\r\n\r\nconst newEventModalProps = {\r\n  title: \"Create event\",\r\n  body: <Widget src=\"itexpert120-contra.near/widget/CreateEvent\" />,\r\n  confirmText: \"Create a new event\",\r\n  onConfirm: () => {\r\n    console.log(\"confirm\");\r\n  },\r\n  hidden: state.hideNewEventModal,\r\n  onClose: toggleNewEventModal,\r\n  showFooter: false,\r\n};\r\n\r\nconst filterForm = () => {\r\n  const onFilterFromUpdate = ({ target }) => {\r\n    State.update({ filterFrom: target.value });\r\n  };\r\n\r\n  const onFilterToUpdate = ({ target }) => {\r\n    State.update({ filterTo: target.value });\r\n  };\r\n\r\n  const onFilterClear = () => {\r\n    toggleFilteredEvents();\r\n    toggleFilterModal();\r\n  };\r\n\r\n  return (\r\n    <div className=\"container \">\r\n      <div className=\"row mb-3\">\r\n        <div className=\"col\">\r\n          <label htmlFor=\"date-from\">From</label>\r\n          <input\r\n            className=\"form-control\"\r\n            id=\"date-from\"\r\n            name=\"date-from\"\r\n            type=\"date\"\r\n            value={state.filterFrom}\r\n            onChange={onFilterFromUpdate}\r\n          />\r\n        </div>\r\n        <div className=\"col\">\r\n          <label htmlFor=\"date-to\">To</label>\r\n          <input\r\n            className=\"form-control\"\r\n            id=\"date-to\"\r\n            name=\"date-to\"\r\n            type=\"date\"\r\n            value={state.filterTo}\r\n            onChange={onFilterToUpdate}\r\n          />\r\n        </div>\r\n      </div>\r\n      <button onClick={onFilterClear}>Clear Filters</button>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst onFilterEvents = () => {\r\n  const filterTo = new Date(state.filterTo);\r\n  const filterFrom = new Date(state.filterFrom);\r\n\r\n  State.update({\r\n    filteredEvents: formattedEvents.filter(\r\n      (ev) => ev.start >= filterFrom && ev.end <= filterTo\r\n    ),\r\n  });\r\n\r\n  toggleFilteredEvents();\r\n\r\n  toggleFilterModal();\r\n};\r\n\r\nconst filterModalProps = {\r\n  title: \"Event filters\",\r\n  body: <filterForm />,\r\n  confirmText: \"Filter events\",\r\n  onConfirm: onFilterEvents,\r\n  hidden: state.hideFilterModal,\r\n  onClose: toggleFilterModal,\r\n  showFooter: true,\r\n};\r\n\r\nconst calendarProps = {\r\n  events: state.filterEvents ? state.filteredEvents : formattedEvents,\r\n  handleEventClick,\r\n  handleAddEvent,\r\n  handleFilter,\r\n};\r\n\r\nreturn (\r\n  <div className=\"container\">\r\n    <Widget\r\n      src=\"itexpert120-contra.near/widget/Calendar\"\r\n      props={{\r\n        ...calendarProps,\r\n      }}\r\n    />\r\n\r\n    <Widget\r\n      src=\"itexpert120-contra.near/widget/Modal\"\r\n      props={{ ...newEventModalProps }}\r\n    />\r\n    <Widget\r\n      src=\"itexpert120-contra.near/widget/Modal\"\r\n      props={{ ...filterModalProps }}\r\n    />\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/itexpert120-contra.near/widget/CalendarTest", "fact_widget_deployments_id": "76261316196f8781567f95ccd37a2147", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 1}