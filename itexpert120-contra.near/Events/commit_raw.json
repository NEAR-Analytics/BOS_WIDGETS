{"tx_hash": "FQ7giButnyzqHDb6Y1wduWmBDhWdrA8DYpQgezdH3gFt", "action_id_social": "7a2fnTv6H84yZSiTchuuB5x21ZbcWTSL84jLrJTseUbQ-0-widget", "block_id": 100459423, "block_timestamp": "2023-09-05T17:26:33.528Z", "signer_id": "itexpert120-contra.near", "widget_name": "Events", "source_code": "// helper function to fetch all events\r\nconst fetchAllEvents = () => {\r\n  const index = Social.index(\"every\", \"every.near/type/event\");\r\n\r\n  let fetchedEvents = [];\r\n\r\n  index.map((item) => {\r\n    const path = `${item.accountId}/thing/${item.value.id}`;\r\n    const blockHeight = item.blockHeight;\r\n\r\n    const eventThing = Social.getr(path, blockHeight);\r\n    fetchedEvents.push(eventThing.data);\r\n  });\r\n\r\n  return fetchedEvents;\r\n};\r\n\r\n\r\nState.init({\r\n  date: new Date(),\r\n  activeView: \"list\",\r\n  hideNewEventModal: true,\r\n  hideFilterModal: true,\r\n  filterFrom: null,\r\n  filterTo: null,\r\n  filterEvents: false,\r\n  filteredEvents: null,\r\n});\r\n\r\nconst toggleFilteredEvents = () => {\r\n  State.update({\r\n    filterEvents: !state.filterEvents,\r\n  });\r\n};\r\n\r\nconst toggleNewEventModal = () => {\r\n  State.update({ hideNewEventModal: !state.hideNewEventModal });\r\n};\r\n\r\nconst toggleFilterModal = () => {\r\n  State.update({ hideFilterModal: !state.hideFilterModal });\r\n};\r\n\r\nconst dateString = state.date.toLocaleString(\"en-us\", {\r\n  month: \"long\",\r\n  year: \"numeric\",\r\n});\r\n\r\nconst formattedDate = () => {\r\n  const dateMonth = dateString.split(\" \")[0];\r\n  const dateYear = dateString.split(\" \")[1];\r\n\r\n  const styledH2 = styled.h2`\r\n    margin: 0;\r\n  `;\r\n\r\n  const dateYearSpan = styled.span`\r\n    font-weight: 400;\r\n  `;\r\n\r\n  return (\r\n    <styledH2>\r\n      {dateMonth} <dateYearSpan>{dateYear}</dateYearSpan>\r\n    </styledH2>\r\n  );\r\n};\r\n\r\nconst iconButton = styled.button`\r\n  width: 32px;\r\n  height: 32px;\r\n  color: black;\r\n  border: none;\r\n  background-color: white;\r\n  transition: all 300ms;\r\n  border-radius: 6px;\r\n  margin: 0;\r\n\r\n  &:hover {\r\n    background-color: #03b172;\r\n    color: white;\r\n  }\r\n`;\r\n\r\nfunction addMonths(date, months) {\r\n  date.setMonth(date.getMonth() + months);\r\n\r\n  return date;\r\n}\r\n\r\nconst handleMonthChange = (months) => {\r\n  const newDate = addMonths(state.date, months);\r\n\r\n  State.update({\r\n    date: newDate,\r\n  });\r\n};\r\n\r\nconst activeButtonClass = \"active-button\";\r\n\r\nconst viewButton = styled.button`\r\n  display: flex;\r\n  width: 67px;\r\n  height: 35px;\r\n  padding: 8px;\r\n  justify-content: center;\r\n  align-items: center;\r\n  gap: 4px;\r\n\r\n  border-radius: 3px;\r\n  border: 1px solid #03b172;\r\n\r\n  color: #03b172;\r\n  font-size: 16px;\r\n  font-style: normal;\r\n  font-weight: 600;\r\n  line-height: normal;\r\n\r\n  &.${activeButtonClass} {\r\n    border-radius: 3px;\r\n    background: #03b172;\r\n    color: white;\r\n  }\r\n`;\r\n\r\nconst handleViewChange = (view) => {\r\n  State.update({\r\n    activeView: view,\r\n  });\r\n};\r\n\r\nconst fetchedEvents = fetchAllEvents();\r\nconst formattedEvents = fetchedEvents.map((event) => {\r\n  return {\r\n    title: event.title,\r\n    start: new Date(`${event.start} ${event.startTime}`),\r\n    end: new Date(`${event.end} ${event.endTime}`),\r\n    url: event.link,\r\n    allDay: event.isAllDay === \"true\",\r\n    editable: false,\r\n    extendedProps: {\r\n      category: event.category,\r\n    },\r\n    description: event.description,\r\n  };\r\n});\r\n\r\nconst filterButton = styled.button`\r\n  display: flex;\r\n  height: 35px;\r\n  padding: 8px;\r\n  justify-content: center;\r\n  align-items: center;\r\n  gap: 4px;\r\n  border-radius: 3px;\r\n  background: #eee;\r\n  color: #000;\r\n  font-size: 16px;\r\n  font-style: normal;\r\n  font-weight: 400;\r\n  line-height: normal;\r\n\r\n  border: none;\r\n\r\n  &:active {\r\n    background: #ccc;\r\n    border: none;\r\n  }\r\n`;\r\n\r\nconst addEventButton = styled.button`\r\n  display: flex;\r\n  height: 35px;\r\n  padding: 8px 16px;\r\n  justify-content: center;\r\n  align-items: center;\r\n  gap: 4px;\r\n\r\n  border-radius: 3px;\r\n  background: #03b172;\r\n\r\n  color: #fff;\r\n  font-size: 16px;\r\n  font-style: normal;\r\n  font-weight: 500;\r\n  line-height: normal;\r\n\r\n  border: none;\r\n\r\n  &:hover {\r\n    color: white;\r\n    background: #029661;\r\n  }\r\n\r\n  &:active {\r\n    background: #01734a;\r\n    color: white;\r\n    border: none;\r\n  }\r\n`;\r\n\r\nconst handleEventClick = () => {\r\n  console.log(\"handleEventClick\");\r\n};\r\n\r\nconst handleAddEvent = () => {\r\n  toggleNewEventModal();\r\n};\r\n\r\nconst handleFilter = () => {\r\n  toggleFilterModal();\r\n};\r\n\r\nconst newEventModalProps = {\r\n  title: \"Create event\",\r\n  body: <Widget src=\"itexpert120-contra.near/widget/CreateEvent\" />,\r\n  confirmText: \"Create a new event\",\r\n  onConfirm: () => {\r\n    console.log(\"confirm\");\r\n  },\r\n  hidden: state.hideNewEventModal,\r\n  onClose: toggleNewEventModal,\r\n  showFooter: false,\r\n};\r\n\r\nconst filterForm = () => {\r\n  const onFilterFromUpdate = ({ target }) => {\r\n    State.update({ filterFrom: target.value });\r\n  };\r\n\r\n  const onFilterToUpdate = ({ target }) => {\r\n    State.update({ filterTo: target.value });\r\n  };\r\n\r\n  const onFilterClear = () => {\r\n    toggleFilteredEvents();\r\n    toggleFilterModal();\r\n  };\r\n\r\n  return (\r\n    <div className=\"container \">\r\n      <div className=\"row mb-3\">\r\n        <div className=\"col\">\r\n          <label htmlFor=\"date-from\">From</label>\r\n          <input\r\n            className=\"form-control\"\r\n            id=\"date-from\"\r\n            name=\"date-from\"\r\n            type=\"date\"\r\n            value={state.filterFrom}\r\n            onChange={onFilterFromUpdate}\r\n          />\r\n        </div>\r\n        <div className=\"col\">\r\n          <label htmlFor=\"date-to\">To</label>\r\n          <input\r\n            className=\"form-control\"\r\n            id=\"date-to\"\r\n            name=\"date-to\"\r\n            type=\"date\"\r\n            value={state.filterTo}\r\n            onChange={onFilterToUpdate}\r\n          />\r\n        </div>\r\n      </div>\r\n      <button onClick={onFilterClear}>Clear Filters</button>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst onFilterEvents = () => {\r\n  const filterTo = new Date(state.filterTo);\r\n  const filterFrom = new Date(state.filterFrom);\r\n\r\n  State.update({\r\n    filteredEvents: formattedEvents.filter(\r\n      (ev) => ev.start >= filterFrom && ev.end <= filterTo\r\n    ),\r\n  });\r\n\r\n  console.log(state.filteredEvents);\r\n\r\n  toggleFilteredEvents();\r\n\r\n  toggleFilterModal();\r\n};\r\n\r\nconst filterModalProps = {\r\n  title: \"Event filters\",\r\n  body: <filterForm />,\r\n  confirmText: \"Filter events\",\r\n  onConfirm: onFilterEvents,\r\n  hidden: state.hideFilterModal,\r\n  onClose: toggleFilterModal,\r\n  showFooter: true,\r\n};\r\n\r\nconst calendarProps = {\r\n  events: state.filterEvents ? state.filteredEvents : formattedEvents,\r\n  date: state.date,\r\n  handleEventClick,\r\n  handleAddEvent,\r\n  handleFilter,\r\n};\r\n\r\nconst EventsView = () => {\r\n  if (state.activeView === \"month\") {\r\n    return (\r\n      <Widget\r\n        src=\"itexpert120-contra.near/widget/Calendar\"\r\n        props={{ ...calendarProps }}\r\n      />\r\n    );\r\n  } else {\r\n    return (\r\n      <Widget\r\n        src=\"itexpert120-contra.near/widget/EventFeed\"\r\n        props={{ events: fetchedEvents, date: state.date }}\r\n      />\r\n    );\r\n  }\r\n};\r\n\r\nreturn (\r\n  <div className=\"container\">\r\n    <Widget\r\n      src=\"itexpert120-contra.near/widget/Modal\"\r\n      props={{ ...newEventModalProps }}\r\n    />\r\n    <Widget\r\n      src=\"itexpert120-contra.near/widget/Modal\"\r\n      props={{ ...filterModalProps }}\r\n    />\r\n    <div className=\"border border-light-subtle p-3 mb-3\">\r\n      <div className=\"row\">\r\n        <div className=\"col\">\r\n          <div className=\"d-flex align-items-center\">\r\n            <formattedDate />\r\n            <div className=\"ms-2\">\r\n              <iconButton onClick={() => handleMonthChange(-1)}>\r\n                <i className=\"bi bi bi-chevron-left\"></i>\r\n              </iconButton>\r\n              <iconButton onClick={() => handleMonthChange(1)}>\r\n                <i className=\"bi bi bi-chevron-right\"></i>\r\n              </iconButton>\r\n            </div>\r\n            <div className=\"ms-2\">\r\n              <div className=\"d-flex gap-2\">\r\n                <viewButton\r\n                  className={`${\r\n                    state.activeView === \"month\" && activeButtonClass\r\n                  }`}\r\n                  onClick={() => handleViewChange(\"month\")}\r\n                >\r\n                  Month\r\n                </viewButton>\r\n                <viewButton\r\n                  className={`${\r\n                    state.activeView === \"list\" && activeButtonClass\r\n                  }`}\r\n                  onClick={() => handleViewChange(\"list\")}\r\n                >\r\n                  List\r\n                </viewButton>\r\n              </div>\r\n            </div>\r\n            <div className=\"ms-auto d-flex gap-2\">\r\n              <filterButton onClick={toggleFilterModal}>Filter by</filterButton>\r\n              <addEventButton onClick={toggleNewEventModal}>\r\n                Add Event <i className=\"bi bi-plus-circle-fill\"></i>\r\n              </addEventButton>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <EventsView />\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/itexpert120-contra.near/widget/Events", "fact_widget_deployments_id": "5453868b8455400c2133e62c665d142a", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 3}