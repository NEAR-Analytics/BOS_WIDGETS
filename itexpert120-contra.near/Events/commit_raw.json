{"tx_hash": "9RPEB1n9FgWwxzGbFizuSqGKaKvVn6QBBYcaCGS5HH6b", "action_id_social": "85jggbdMGyfJdYkB2crXmDzaT1mr9KdwNkSkkKzGSGqJ-0-widget", "block_id": 101479070, "block_timestamp": "2023-09-19T13:53:18.256Z", "signer_id": "itexpert120-contra.near", "widget_name": "Events", "source_code": "// helper function to fetch all events\r\nconst fetchAllEvents = () => {\r\n  const index = Social.index(\"every\", \"every.near/type/event\");\r\n\r\n  let fetchedEvents = [];\r\n\r\n  index.map((item) => {\r\n    const path = `${item.accountId}/thing/${item.value.id}`;\r\n    const blockHeight = item.blockHeight;\r\n\r\n    const eventThing = Social.getr(path, blockHeight);\r\n    fetchedEvents.push({ ...eventThing.data, path, blockHeight });\r\n  });\r\n\r\n  fetchedEvents = fetchedEvents.filter(\r\n    (ev) => ev.path !== \"itexpert120-contra.near/thing/\"\r\n  );\r\n\r\n  return fetchedEvents;\r\n};\r\n\r\n\r\nState.init({\r\n  date: new Date(),\r\n  activeView: \"month\",\r\n  hideNewEventModal: true,\r\n  hideFilterModal: true,\r\n  filterEvents: false,\r\n  filteredEvents: null,\r\n  filteredFeedEvents: null,\r\n  filterForm: {\r\n    filterTo: null,\r\n    filterFrom: null,\r\n    title: \"\",\r\n    location: \"\",\r\n    category: \"\",\r\n    organizer: \"\",\r\n  },\r\n});\r\n\r\nconst toggleFilteredEvents = () => {\r\n  State.update({\r\n    filterEvents: !state.filterEvents,\r\n  });\r\n};\r\n\r\nconst toggleNewEventModal = () => {\r\n  State.update({ hideNewEventModal: !state.hideNewEventModal });\r\n};\r\n\r\nconst toggleFilterModal = () => {\r\n  State.update({ hideFilterModal: !state.hideFilterModal });\r\n};\r\n\r\nconst dateString = state.date.toLocaleString(\"en-us\", {\r\n  month: \"long\",\r\n  year: \"numeric\",\r\n});\r\n\r\nconst formattedDate = () => {\r\n  const dateMonth = dateString.split(\" \")[0];\r\n  const dateYear = dateString.split(\" \")[1];\r\n\r\n  const styledH2 = styled.h2`\r\n    margin: 0;\r\n\r\n    @media (max-width: 768px) {\r\n      font-size: 20px;\r\n    }\r\n\r\n    @media (max-width: 550px) {\r\n      font-size: 14px;\r\n    }\r\n  `;\r\n\r\n  const dateYearSpan = styled.span`\r\n    font-weight: 400;\r\n  `;\r\n\r\n  return (\r\n    <styledH2>\r\n      {dateMonth} <dateYearSpan>{dateYear}</dateYearSpan>\r\n    </styledH2>\r\n  );\r\n};\r\n\r\nconst formattedMobileDate = () => {\r\n  const dateString = state.date.toLocaleString(\"en-us\", {\r\n    month: \"short\",\r\n    year: \"numeric\",\r\n  });\r\n\r\n  const dateMonth = dateString.split(\" \")[0];\r\n  const dateYear = dateString.split(\" \")[1];\r\n\r\n  const dateH2 = styled.h2`\r\n    color: #333;\r\n    font-feature-settings:\r\n      \"clig\" off,\r\n      \"liga\" off;\r\n    font-size: 16px;\r\n    font-style: normal;\r\n    font-weight: 600;\r\n    line-height: normal;\r\n    letter-spacing: -0.154px;\r\n  `;\r\n\r\n  return (\r\n    <dateH2>\r\n      {dateMonth} {dateYear}\r\n    </dateH2>\r\n  );\r\n};\r\n\r\nconst iconButton = styled.button`\r\n  width: 32px;\r\n  height: 32px;\r\n  color: black;\r\n  border: none;\r\n  background-color: white;\r\n  transition: all 300ms;\r\n  border-radius: 6px;\r\n  margin: 0;\r\n\r\n  &:hover {\r\n    background-color: #03b172;\r\n    color: white;\r\n  }\r\n`;\r\n\r\nfunction addMonths(date, months) {\r\n  date.setMonth(date.getMonth() + months);\r\n\r\n  return date;\r\n}\r\n\r\nconst handleMonthChange = (months) => {\r\n  const newDate = addMonths(state.date, months);\r\n\r\n  State.update({\r\n    date: newDate,\r\n  });\r\n};\r\n\r\nconst activeButtonClass = \"active-button\";\r\n\r\nconst viewButton = styled.button`\r\n  display: flex;\r\n  width: 67px;\r\n  height: 35px;\r\n  padding: 8px;\r\n  justify-content: center;\r\n  align-items: center;\r\n  gap: 4px;\r\n\r\n  border-radius: 3px;\r\n  border: 1px solid #03b172;\r\n\r\n  color: #03b172;\r\n  font-size: 16px;\r\n  font-style: normal;\r\n  font-weight: 600;\r\n  line-height: normal;\r\n\r\n  &.${activeButtonClass} {\r\n    border-radius: 3px;\r\n    background: #03b172;\r\n    color: white;\r\n  }\r\n`;\r\n\r\nconst handleViewChange = (view) => {\r\n  State.update({\r\n    activeView: view,\r\n  });\r\n};\r\n\r\nconst fetchedEvents = fetchAllEvents();\r\n\r\nconst formattedEvents = fetchedEvents.map((event) => {\r\n  const path = `${event.organizer}/thing/${event.id}`;\r\n  return {\r\n    title: event.title,\r\n    start: new Date(`${event.start}T${event.startTime}`),\r\n    end: new Date(`${event.end}T${event.endTime}`),\r\n    url: event.link,\r\n    allDay: event.isAllDay === \"true\",\r\n    editable: false,\r\n    extendedProps: {\r\n      category: event.category,\r\n      location: event.location,\r\n      organizer: event.organizer,\r\n      href: `https://near.social/itexpert120-contra.near/widget/EventView?path=${path}`,\r\n    },\r\n    description: event.description,\r\n  };\r\n});\r\n\r\nconst filterButton = styled.button`\r\n  display: flex;\r\n  height: 35px;\r\n  padding: 8px;\r\n  justify-content: center;\r\n  align-items: center;\r\n  gap: 4px;\r\n  border-radius: 3px;\r\n  background: #eee;\r\n  color: #000;\r\n  font-size: 16px;\r\n  font-style: normal;\r\n  font-weight: 400;\r\n  line-height: normal;\r\n\r\n  border: none;\r\n\r\n  &:active {\r\n    background: #ccc;\r\n    border: none;\r\n  }\r\n`;\r\n\r\nconst addEventButton = styled.button`\r\n  display: flex;\r\n  height: 35px;\r\n  padding: 8px 16px;\r\n  justify-content: center;\r\n  align-items: center;\r\n  gap: 4px;\r\n\r\n  border-radius: 3px;\r\n  background: #03b172;\r\n\r\n  color: #fff;\r\n  font-size: 16px;\r\n  font-style: normal;\r\n  font-weight: 500;\r\n  line-height: normal;\r\n\r\n  border: none;\r\n\r\n  &:hover {\r\n    color: white;\r\n    background: #029661;\r\n  }\r\n\r\n  &:active {\r\n    background: #01734a;\r\n    color: white;\r\n    border: none;\r\n  }\r\n`;\r\n\r\nconst handleEventClick = (data) => {\r\n  const href = data.extendedProps.href;\r\n  self.location = href;\r\n};\r\n\r\nconst handleAddEvent = () => {\r\n  toggleNewEventModal();\r\n};\r\n\r\nconst handleFilter = () => {\r\n  toggleFilterModal();\r\n};\r\n\r\nconst newEventModalProps = {\r\n  title: \"Create event\",\r\n  body: (\r\n    <Widget\r\n      src=\"itexpert120-contra.near/widget/CreateEvent\"\r\n      props={{ toggleNewEventModal }}\r\n    />\r\n  ),\r\n  confirmText: \"Create a new event\",\r\n  onConfirm: () => {\r\n    console.log(\"confirm\");\r\n  },\r\n  hidden: state.hideNewEventModal,\r\n  onClose: toggleNewEventModal,\r\n  showFooter: false,\r\n};\r\n\r\nconst onFilterEvents = () => {\r\n  const filterForm = state.filterForm;\r\n  const filterTo = filterForm.filterTo ? new Date(filterForm.filterTo) : null;\r\n  const filterFrom = filterForm.filterFrom\r\n    ? new Date(filterForm.filterFrom)\r\n    : null;\r\n  const locationFilter = filterForm.location.toLowerCase(); // Make it case-insensitive\r\n  const categoryFilter = filterForm.category.toLowerCase(); // Make it case-insensitive\r\n  const organizerFilter = filterForm.organizer.toLowerCase(); // Make it case-insensitive\r\n  const titleFilter = filterForm.title.toLowerCase();\r\n\r\n  const filteredEvents = formattedEvents.filter((ev) => {\r\n    return (\r\n      (filterFrom === null || ev.start >= filterFrom) &&\r\n      (filterTo === null || ev.end <= filterTo) &&\r\n      (titleFilter === \"\" || ev.title.toLowerCase().includes(titleFilter)) &&\r\n      (locationFilter === \"\" ||\r\n        ev.extendedProps.location.toLowerCase().includes(locationFilter)) &&\r\n      (categoryFilter === \"\" ||\r\n        ev.extendedProps.category.toLowerCase().includes(categoryFilter)) &&\r\n      (organizerFilter === \"\" ||\r\n        ev.extendedProps.organizer.toLowerCase().includes(organizerFilter))\r\n    );\r\n  });\r\n\r\n  console.log(\"fetched Events\", fetchedEvents);\r\n  const filteredFeedEvents = fetchedEvents.filter((ev) => {\r\n    return (\r\n      (filterFrom === null ||\r\n        new Date(`${ev.start}T${ev.startTime}`) >= filterFrom) &&\r\n      (filterTo === null || new Date(`${ev.end}T${ev.endTime}`) <= filterTo) &&\r\n      (titleFilter === \"\" || ev.title.toLowerCase().includes(titleFilter)) &&\r\n      (locationFilter === \"\" ||\r\n        ev.location.toLowerCase().includes(locationFilter)) &&\r\n      (categoryFilter === \"\" ||\r\n        ev.category.toLowerCase().includes(categoryFilter)) &&\r\n      (organizerFilter === \"\" ||\r\n        ev.organizer.toLowerCase().includes(organizerFilter))\r\n    );\r\n  });\r\n\r\n  console.log(filteredEvents);\r\n  console.log(filteredFeedEvents);\r\n\r\n  //   Update your state with the filtered events\r\n  State.update({\r\n    filteredFeedEvents: filteredFeedEvents,\r\n    filteredEvents: filteredEvents,\r\n  });\r\n\r\n  if (!state.filterEvents) {\r\n    toggleFilteredEvents();\r\n  }\r\n\r\n  toggleFilterModal();\r\n};\r\n\r\nconst setFilterForm = (target) => {\r\n  State.update({\r\n    filterForm: target,\r\n  });\r\n  onFilterEvents();\r\n};\r\n\r\nconst filterModalProps = {\r\n  title: \"Event filters\",\r\n  body: (\r\n    <Widget\r\n      src=\"itexpert120-contra.near/widget/FilterForm\"\r\n      props={{\r\n        setFilterForm: setFilterForm,\r\n        filterEvents: state.filterEvents,\r\n        toggleFilteredEvents,\r\n        toggleFilterModal,\r\n      }}\r\n    />\r\n  ),\r\n  confirmText: \"Filter events\",\r\n  onConfirm: onFilterEvents,\r\n  hidden: state.hideFilterModal,\r\n  onClose: toggleFilterModal,\r\n  showFooter: false,\r\n};\r\n\r\nconst calendarProps = {\r\n  events: state.filterEvents ? state.filteredEvents : formattedEvents,\r\n  date: state.date,\r\n  handleEventClick,\r\n  handleAddEvent,\r\n  handleFilter,\r\n};\r\n\r\nconst mobileCalendarProps = {\r\n  events: state.filterEvents ? state.filteredFeedEvents : fetchedEvents,\r\n  date: state.date,\r\n};\r\n\r\nconst feedProps = {\r\n  events: state.filterEvents ? state.filteredFeedEvents : fetchedEvents,\r\n  date: state.date,\r\n};\r\n\r\nconst EventsView = () => {\r\n  if (state.activeView === \"month\") {\r\n    return (\r\n      <>\r\n        <desktopCalendar>\r\n          <Widget\r\n            src=\"itexpert120-contra.near/widget/Calendar\"\r\n            props={{ ...calendarProps }}\r\n          />\r\n        </desktopCalendar>\r\n        <mobileCalendar>\r\n          <Widget\r\n            src=\"itexpert120-contra.near/widget/MobileCalendar\"\r\n            props={{ ...mobileCalendarProps }}\r\n          />\r\n        </mobileCalendar>\r\n      </>\r\n    );\r\n  } else {\r\n    return (\r\n      <Widget\r\n        src=\"itexpert120-contra.near/widget/EventFeed\"\r\n        props={{ ...feedProps }}\r\n      />\r\n    );\r\n  }\r\n};\r\n\r\nconst desktopHeader = styled.div`\r\n  @media (max-width: 768px) {\r\n    display: none;\r\n  }\r\n`;\r\n\r\nconst desktopCalendar = styled.div`\r\n  @media (width < 768px) {\r\n    display: none;\r\n  }\r\n`;\r\n\r\nconst mobileCalendar = styled.div`\r\n  @media (width > 768px) {\r\n    display: none;\r\n  }\r\n`;\r\n\r\nconst mobileHeader = styled.div`\r\n  @media (width > 768px) {\r\n    display: none;\r\n  }\r\n\r\n  h2 {\r\n    color: #333;\r\n    font-feature-settings:\r\n      \"clig\" off,\r\n      \"liga\" off;\r\n    font-size: 24px;\r\n    font-style: normal;\r\n    font-weight: 600;\r\n    line-height: normal;\r\n    letter-spacing: -0.154px;\r\n    margin: 0;\r\n  }\r\n\r\n  p {\r\n    color: #5c5f62;\r\n    font-size: 14px;\r\n    font-style: normal;\r\n    font-weight: 400;\r\n    line-height: normal;\r\n  }\r\n`;\r\n\r\nconst mobileViewContainer = styled.div`\r\n  border-radius: 3px;\r\n  border: 1px solid #03b172;\r\n`;\r\n\r\nconst mobileViewButton = styled.button`\r\n  width: 67px;\r\n  height: auto;\r\n  padding: 4px 8px;\r\n  font-size: 14px;\r\n\r\n  &:active {\r\n    border: none;\r\n  }\r\n\r\n  border: none;\r\n\r\n  &.${activeButtonClass} {\r\n    background: #03b172;\r\n    color: white;\r\n  }\r\n`;\r\n\r\nconst marginContainer = styled.div`\r\n  margin-top: 25px;\r\n`;\r\n\r\nreturn (\r\n  <marginContainer className=\"container\">\r\n    <Widget\r\n      src=\"itexpert120-contra.near/widget/Modal\"\r\n      props={{ ...newEventModalProps }}\r\n    />\r\n    <Widget\r\n      src=\"itexpert120-contra.near/widget/Modal\"\r\n      props={{ ...filterModalProps }}\r\n    />\r\n    <desktopHeader className=\"border border-light-subtle p-3 mb-3\">\r\n      <div className=\"row\">\r\n        <div className=\"col\">\r\n          <div className=\"d-flex align-items-center\">\r\n            <formattedDate />\r\n            <div className=\"ms-2 d-flex\">\r\n              <iconButton onClick={() => handleMonthChange(-1)}>\r\n                <i className=\"bi bi bi-chevron-left\"></i>\r\n              </iconButton>\r\n              <iconButton onClick={() => handleMonthChange(1)}>\r\n                <i className=\"bi bi bi-chevron-right\"></i>\r\n              </iconButton>\r\n            </div>\r\n            <div className=\"ms-2\">\r\n              <div className=\"d-flex gap-2\">\r\n                <viewButton\r\n                  className={`${\r\n                    state.activeView === \"month\" && activeButtonClass\r\n                  }`}\r\n                  onClick={() => handleViewChange(\"month\")}\r\n                >\r\n                  Month\r\n                </viewButton>\r\n                <viewButton\r\n                  className={`${\r\n                    state.activeView === \"list\" && activeButtonClass\r\n                  }`}\r\n                  onClick={() => handleViewChange(\"list\")}\r\n                >\r\n                  List\r\n                </viewButton>\r\n              </div>\r\n            </div>\r\n            <div className=\"ms-auto d-flex gap-2 align-items-center\">\r\n              <filterButton onClick={toggleFilterModal}>Filter by</filterButton>\r\n              <addEventButton onClick={toggleNewEventModal}>\r\n                Add Event <i className=\"bi bi-plus-circle-fill\"></i>\r\n              </addEventButton>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </desktopHeader>\r\n    <mobileHeader>\r\n      <div className=\"d-flex mb-2\">\r\n        <h2>Events</h2>\r\n        <div className=\"ms-auto d-flex gap-2\">\r\n          <filterButton onClick={toggleFilterModal}>Filter</filterButton>\r\n          <addEventButton onClick={toggleNewEventModal}>\r\n          Add Your Event <i className=\"bi bi-plus-circle-fill\"></i>\r\n          </addEventButton>\r\n        </div>\r\n      </div>\r\n      <div className=\"d-flex align-items-center mb-2\">\r\n        <p className=\"m-0\">View by:</p>\r\n        <mobileViewContainer className=\"ms-2 d-flex\">\r\n          <mobileViewButton\r\n            className={`${state.activeView === \"month\" && activeButtonClass}`}\r\n            onClick={() => handleViewChange(\"month\")}\r\n          >\r\n            Month\r\n          </mobileViewButton>\r\n          <mobileViewButton\r\n            className={`${state.activeView === \"list\" && activeButtonClass}`}\r\n            onClick={() => handleViewChange(\"list\")}\r\n          >\r\n            List\r\n          </mobileViewButton>\r\n        </mobileViewContainer>\r\n      </div>\r\n      <div className=\"border rounded-top border-light-subtle d-flex p-2\">\r\n        <formattedMobileDate />\r\n        <div className=\"ms-auto d-flex align-items-center\">\r\n          <iconButton onClick={() => handleMonthChange(-1)}>\r\n            <i className=\"bi bi bi-chevron-left\"></i>\r\n          </iconButton>\r\n          <iconButton onClick={() => handleMonthChange(1)}>\r\n            <i className=\"bi bi bi-chevron-right\"></i>\r\n          </iconButton>\r\n        </div>\r\n      </div>\r\n    </mobileHeader>\r\n    <EventsView />\r\n  </marginContainer>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/itexpert120-contra.near/widget/Events", "fact_widget_deployments_id": "0bb9d8cc1bec0ed38a1ee63b820bb148", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 2}