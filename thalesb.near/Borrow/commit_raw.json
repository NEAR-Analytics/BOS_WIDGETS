{"tx_hash": "GFmFitEvts2eY187G5PtedKS5QZDrVTRJAXAAxKZRvUi", "action_id_social": "Eg8Lg8VLACfkKc9wNKv3BGCxQwVERtRJ2EfMrVDCTBZ2-0-widget", "block_id": 112332032, "block_timestamp": "2024-02-07T20:34:55.962Z", "signer_id": "thalesb.near", "widget_name": "Borrow", "source_code": "/**\n * Renders the Borrow component.\n * Allows the user to borrow a specified amount from a contract.\n *\n * @returns {JSX.Element} The Borrow component.\n */\nconst { getMinimumBorrowAmount } = VM.require(\n  \"thalesb.near/widget/compound-requests\"\n);\n\nconst SectionHeader = styled.span`\n  color: #fff;\n\n  font-size: 18px;\n  font-weight: 700;\n`;\n\nconst abi = fetch(\n  \"https://docs.compound.finance/public/files/comet-interface-abi-98f438b.json\"\n);\n\nif (!abi) return \"Loading...\";\n\nuseEffect(() => {\n  if (Ethers.provider()) {\n    Ethers.provider()\n      .send(\"eth_requestAccounts\", [])\n      .then((accounts) => {\n        State.update({ address: accounts[0] });\n      });\n  }\n}, [Ethers]);\n\nuseEffect(() => {\n  getMinimumBorrowAmount({\n    cometAddress: props.selectedItem.contractInfo.address,\n    rpcUrl: props.selectedItem.contractInfo.httpRpcUrl,\n  }).then((balance) => {\n    State.update({ minimumBorrowAmount: balance });\n  });\n}, [props.selectedItem.contractInfo.address]);\n\nfunction handleBorrowError(e) {\n  if (props.addToast) {\n    props.addToast(e?.reason || e?.message, \"error\");\n  }\n\n  console.error(e);\n}\n\n/**\n * Borrow function to withdraw a specified amount from a contract.\n *\n * @param {number} amount - The amount to be borrowed.\n */\nfunction borrow(amount) {\n  const contract = new ethers.Contract(\n    props.selectedItem.contractInfo.address,\n    abi.body,\n    Ethers.provider().getSigner()\n  );\n\n  contract\n    .decimals()\n    .then((decimals) => {\n      contract\n        .withdraw(\n          props.selectedItem.address,\n          ethers.utils.parseUnits(Number(amount).toFixed(decimals), decimals)\n        )\n        .then((tx) => {\n          props.addToast(`Transaction sent ${tx.hash}`, \"success\");\n          State.update({\n            loadingBorrow: true,\n          });\n          tx.wait()\n            .then(() => {\n              props.addToast(\"Transaction confirmed\", \"success\");\n              State.update({ refetchKey: Math.random(), loadingBorrow: false });\n            })\n            .catch(handleBorrowError);\n        })\n        .catch(handleBorrowError);\n    })\n    .catch(handleBorrowError);\n}\n\nreturn (\n  <Widget\n    src=\"thalesb.near/widget/Input\"\n    props={{\n      type: \"borrow\",\n      onConfirm: (address, amount) => {\n        borrow(amount);\n      },\n      loading: state.loadingBorrow,\n      balance: Math.floor((props.borrowBalance + Number.EPSILON) * 1000) / 1000,\n      min:\n        state.minimumBorrowAmount && props.borrowedBalance < 1\n          ? state.minimumBorrowAmount\n          : 0,\n      selectedItem: props.selectedItem,\n    }}\n  />\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/thalesb.near/widget/Borrow", "fact_widget_deployments_id": "81facfcfcae3cdaefbf08fddbbc3b160", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}