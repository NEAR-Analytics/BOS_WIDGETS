{"tx_hash": "Rrr5PXEadEoAtn3dBAy6o4fMjD6rTP4XcKqKncau9TL", "action_id_social": "B4L17DAxZV8ALddYxXaTgSgaRNoaPgmyNberyj1uViAT-0-widget", "block_id": 101201556, "block_timestamp": "2023-09-15T19:37:32.288Z", "signer_id": "ndcplug.near", "widget_name": "NDC.isFlagged", "source_code": "\n/**\n * Check is human\n * \n */\nlet accountId = props.accountId ?? context.accountId;\nconst registryContract = \"registry.i-am-human.near\";\nState.init({\n  accountId: accountId,\n});\nfunction loadFlagged() {\n    console.log(\"Loading flag for this account: \" + state.accountId);\n  const flagged = Near.view(registryContract, \"account_flagged\", {\n    account: state.accountId,\n  });\n\n  State.update({\n    blacklisted: flagged === \"Blacklisted\",\n    greylisted: flagged !== \"Blacklisted\" && flagged !== \"Verified\",\n    flagged: flagged,\n  });\n  console.log(\"Is \" + state.accountId + \" flagged? \" + state.flagged)\n  return flagged;\n}\n\n\nfunction getAccountsWithProfile() {\n  const data = Social.keys(\"*/profile\", \"final\");\n\n  if (!data) {\n    return \"Loading\";\n  }\n\n  const accounts = Object.entries(data);\n\n  const allProfiles = [];\n\n  for (let i = 0; i < accounts.length; ++i) {\n    const accountId = accounts[i][0];\n    allProfiles.push(accountId);\n  }\n  return allProfiles;\n}\n\nconst onChangeRecipient = (recipient) => {\n            console.log(\"Recipient : \" + recipient ); \n\n  State.update({\n    accountId: recipient,\n  });\n  loadFlagged();\n    \n\n};\n\n\nfunction isFlagged(account) {\n            console.log(\"Starting is flagged check : \" + account ); \n\n    const view = Near.view(\"registry.i-am-human.near\", \"account_flagged\", {\n      account: `${account}`,\n    });\n        console.log(\"View: \"  + view?.[0]?.[1]?.[0]); \n\n\n}\n\n\n\nconst Main = styled.div`\n  display: grid;\n  gap: 3rem;\n  align-content: center;\n  grid-template-columns: repeat(auto-fit, minmax(270px, 1fr));\n  justify-content: center;\n  margin-top: 5px;\n  width: 100%;\n  padding: 1rem;\n  .button {\n    padding: 0.75em 2em;\n    border-radius: 0.7em;\n    border: 1px solid #0d99ff;\n    transition: all 0.3s;\n    cursor: pointer;\n    color: #fff;\n    background: #0d99ff;\n    &:hover {\n      color: #0d99ff;\n      background: #fff;\n    }\n    @media screen and (max-width: 540px) {\n      padding: 0.5em 2em;\n    }\n  }\n`;\n\n\n\nconst Card = styled.div`\n  padding: 1em;\n  border: 1px solid #e5e8eb;\n  gap: 2em;\n  margin: 10px auto;\n  border-radius: 0.7em;\n  & input {\n    display: block;\n    padding: 0.5em;\n    width: 100%;\n    border: 1px solid #e5e8eb;\n    border-radius: 10px;\n    outline: none;\n    background: #f4f5f6;\n    color: #525c76;\n    :focus {\n      box-shadow: none;\n      border: 1px solid #0d99ff;\n    }\n    &::placeholder {\n      color: palevioletred;\n    }\n  }\n`;\n\n\n\n\n\n\nreturn (\n  <>\n\n\n \n    \n\n              <Card>\n                Search NEAR Account\n                <Typeahead\n                  id=\"async-example\"\n                  className=\"type-ahead\"\n                  isLoading={isLoading}\n                  labelKey=\"search\"\n                  minLength={1}\n                  options={getAccountsWithProfile()}\n                  onChange={(value) => onChangeRecipient(value)}\n                  placeholder={state.accountId\n                  }\n                />\n              </Card>\n\n    <div>Are you flagged? {state.flagged}</div>\n\n      <Widget src=\"nearefi.near/widget/ReFi.DAO.memberCard\" props={{accountId: state.accountId}}/>\n\n  </>\n);", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/ndcplug.near/widget/NDC.isFlagged", "fact_widget_deployments_id": "8fb843333e1198578f06d8509de6a8bc", "inserted_timestamp": "2023-09-15T21:25:03.171Z", "modified_timestamp": "2023-09-15T21:25:03.171Z", "__row_index": 1}