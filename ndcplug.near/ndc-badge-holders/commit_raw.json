{"tx_hash": "HZ2NKBZm5Fxhf4Ao5X3F7pt24xRt9iJWAQ9eZivWTSnf", "action_id_social": "GR1W83sUgQrFSfp2RfjPzJQ1J28h3fdd4PfuKWvt3NaJ-0-widget", "block_id": 96467964, "block_timestamp": "2023-07-14T17:12:32.446Z", "signer_id": "ndcplug.near", "widget_name": "ndc-badge-holders", "source_code": "const issuer = props.issuer ?? \"community.i-am-human.near\";\nState.init({\n  read_index: 0,\n  tokens: [],\n  issuer: issuer,\n  sbtList: [],\n});\n// TO-DO\n// add conditional dropdown, add search, add icons on dropdown // add total holders\n// future add classes\n\n// add custom\n\n// Load badge helper functions\nfunction loadSBTs() {\n  const res = fetch(\n    \"https://raw.githubusercontent.com/codingshot/ndc-landing/main/data/sbtList.json\"\n  );\n  return res.body && JSON.parse(res.body);\n}\nconst sbtList = loadSBTs();\nState.update({ sbtList: sbtList });\nif (!state.sbtList) {\n  return \"\u29d7 Loading  SBT List...\";\n}\n\n// if (state.read_index != -1) {\n//   const tokens = Near.view(\"registry.i-am-human.near\", \"sbt_tokens\", {\n//     issuer: state.issuer,\n//     from_token: 1 + state.read_index * 100,\n//     limit: 100,\n//   });\n\n//   if (tokens) {\n//     if (!tokens.length) {\n//       State.update({ read_index: -1 });\n//     } else {\n//       State.update({\n//         read_index: state.read_index + 1,\n//         tokens: [...state.tokens, ...tokens],\n//       });\n//     }\n//   }\n// }\n// Load hodlers helper functions\nfunction renderHolders() {}\nfunction loadHolders() {\n  if (state.read_index != -1) {\n    const tokens = Near.view(\"registry.i-am-human.near\", \"sbt_tokens\", {\n      issuer: state.issuer,\n      from_token: 1 + state.read_index * 100,\n      limit: 100,\n    });\n\n    if (tokens) {\n      if (!tokens.length) {\n        State.update({ read_index: -1 });\n      } else {\n        State.update({\n          read_index: state.read_index + 1,\n          tokens: [...state.tokens, ...tokens],\n        });\n      }\n    }\n  }\n  renderHolders();\n}\nloadHolders();\nconst handleIssuerChange = (e) => {\n  State.update({ issuer: e.target.value });\n  console.log(\"Issuer Address: \" + state.issuer);\n  loadHolders();\n};\n\nconst handleSbtChange = (e) => {\n  State.update({\n    issuer: sbtList\n      .filter((sbt) => sbt.title === e.target.value)\n      .map((el) => el.address)[0],\n  });\n  console.log(\"New Issuer based on SBT change \" + state.issuer);\n  loadHolders();\n}; // need to change this around\n\nconsole.log(tokens.length); // put in progress meter\n\nconst Members = () => (\n  <>\n    {state.tokens.map((token) => (\n      <li class=\"mb-2\">\n        <Widget\n          src=\"chaotictempest.near/widget/AccountProfileCard\"\n          props={{ accountId: token.owner }}\n        />\n      </li>\n    ))}\n  </>\n);\n\nreturn (\n  <div>\n    <Widget\n      src=\"ndcplug.near/widget/NDC.Common.SimpleHeader\"\n      props={{ title: \"NDC SBT Holders\" }}\n    />\n    <Widget\n      src=\"ndcplug.near/widget/NDC.Common.ProgressMeter\"\n      props={{\n        total: \"300\",\n        users: state.tokens.length,\n        description: \"OG Holders\",\n        width: \"150\",\n        title: \"NDC OG Holders\",\n      }}\n    />\n    <h3>Total Holders: {state.tokens.length}</h3>\n    <label>Choose A NDC Community SBT \ud83d\udee1\ufe0f Badge</label>\n    <div className=\"sbt\">\n      <select\n        className=\"form-select\"\n        aria-label=\"select asset\"\n        onChange={handleSbtChange}\n      >\n        <option selected disabled>\n          {\" \"}\n          Select a badge\n        </option>\n        {sbtList &&\n          sbtList.map((sbt) => (\n            <option value={sbt.title} selected={sbt.selected}>\n              {sbt.title}\n            </option>\n          ))}\n        // add receiver logic here\n      </select>\n    </div>\n    <div className=\"balance input-group\">\n      <input\n        style={{ maxWidth: \"100%\" }}\n        type=\"string\"\n        defaultValue={state.issuer} // feel like this wrong\n        value={state.issuer}\n        placeholder={state.issuer}\n        onChange={handleIssuerChange}\n      />\n    </div>\n    <ol>\n      <Members />\n    </ol>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/ndcplug.near/widget/ndc-badge-holders", "fact_widget_deployments_id": "02671075bb05d2699d6ae9c4a160589c", "inserted_timestamp": "2000-01-01T00:00:00.000Z", "modified_timestamp": "2000-01-01T00:00:00.000Z", "__row_index": 1}