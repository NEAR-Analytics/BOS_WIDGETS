{"tx_hash": "6vTLZgFKGpYrHVHfQndhE1yjs9QAsvM5q1mK5r1Bzx82", "action_id_social": "HzqPwu2dA33hoCCgsQsrmpCqXaXYYrE9gevQ6EtBfziw-0-widget", "block_id": 113160703, "block_timestamp": "2024-02-19T15:08:18.290Z", "signer_id": "buildbox.near", "widget_name": "page.browse", "source_code": "// Feed\nconst app = props.app || \"buildbox\";\nconst type = props.type || \"project\";\n\nconst keys = Social.keys(`*/${app}/${type}/*`, \"final\", {\n  return_type: \"BlockHeight\",\n});\nconst { Avatar } = VM.require(\"buildhub.near/widget/components\");\n\nfunction flattenObject(obj, parentKey) {\n  parentKey = parentKey ?? \"\";\n  let paths = [];\n\n  Object.keys(obj).forEach((key) => {\n    const currentPath = parentKey ? `${parentKey}/${key}` : key;\n\n    if (typeof obj[key] === \"object\") {\n      paths = paths.concat(flattenObject(obj[key], currentPath));\n    } else {\n      // paths.push(`${currentPath}@${obj[key]}`); // if we want blockHeight\n      paths.push(currentPath);\n    }\n  });\n\n  return paths;\n}\n\nif (!keys) {\n  return \"Loading...\";\n}\n\nconst flattenedKeys = flattenObject(keys);\nflattenedKeys = flattenedKeys.filter((s) => !s.includes(\"/project/hackathon\"));\n\nconst data = Social.get(flattenedKeys, \"final\");\n\nif (!data) {\n  return \"Loading...\";\n}\n\nconst Container = styled.div`\n  margin: 0 auto;\n  padding: 0 20px auto 0;\n  width: 100%;\n`;\n\nconst Grid = styled.div`\n  display: grid;\n  grid-gap: 10px;\n  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));\n  padding: 10px;\n\n  @media (min-width: 576px) {\n    grid-gap: 15px;\n  }\n\n  @media (min-width: 992px) {\n    grid-gap: 20px;\n  }\n\n  > * {\n    transition: transform 0.3s ease; // Smooth transition for hover effect\n\n    &:hover {\n      transform: scale(1.03); // Subtle scale effect on hover\n    }\n  }\n\n  .card-img-top {\n    position: relative;\n  }\n\n  .card-body {\n    padding: 10px 20px 0 10px;\n    overflow: scroll;\n    text-overflow: elipsis;\n  }\n\n  .user-avatar {\n    position: absolute;\n    bottom: -20px;\n    left: 10px;\n  }\n  .card-bottom {\n    border-top: 1px solid #0005;\n    padding: 5px 10px 0 10px;\n  }\n`;\n\nconst processData = useCallback(\n  (data) => {\n    const accounts = Object.entries(data);\n\n    const allItems = accounts\n      .map((account) => {\n        const accountId = account[0];\n\n        return Object.entries(account[1][app][type]).map((kv) => {\n          return {\n            accountId,\n            type: type,\n            name: kv[0],\n            metadata: kv[1].metadata,\n          };\n        });\n      })\n      .flat();\n\n    // sort by latest\n    allItems.sort((a, b) => b.blockHeight - a.blockHeight);\n    return allItems;\n  },\n  [type]\n);\n\nconst items = processData(data);\n\nif (!items) {\n  return \"Loading data...\";\n}\n\nif (items.length === 0) {\n  return `No items of type: \"${type}\" found.`;\n}\n\nfunction Item({ accountId, name, type, metadata }) {\n  // Use metadata.name if it exists, otherwise use the passed name\n  const displayName = metadata.name || name;\n  const defaultImage =\n    \"https://ipfs.near.social/ipfs/bafkreihi3qh72njb3ejg7t2mbxuho2vk447kzkvpjtmulsb2njd6m2cfgi\";\n\n  const image = metadata.backgroundImage || defaultImage;\n\n  return (\n    <div\n      className=\"card\"\n      style={{\n        maxWidth: \"100%\",\n        height: \"200px\",\n        display: \"flex\",\n        flexDirection: \"column\",\n        justifyContent: \"space-between\",\n        overflow: \"hidden\",\n        backgroundColor: \"#17181C\",\n        color: \"#fff\",\n      }}\n    >\n      <div\n        className=\"card-img-top\"\n        style={{\n          backgroundImage: `url(${image})`,\n          height: \"80px\",\n          backgroundSize: \"cover\",\n          backgroundPosition: \"center\",\n        }}\n      >\n        <div className=\"user-avatar\">\n          <Avatar variant={\"mobile\"} accountId={accountId} />\n        </div>\n      </div>\n\n      <div className=\"card-body\">\n        <Link\n          to={`/buildbox.near/widget/app?page=view&id=${accountId}/${app}/${type}/${name}`}\n          style={{ textDecoration: \"none\" }}\n        >\n          <h5 className=\"card-title mt-3\">\n            {displayName.length > 23 ? `${displayName.slice(0, 17)}...` : displayName}\n          </h5>\n        </Link>\n        {metadata.description && (\n          <p\n            className=\"card-text\"\n            style={{ overflow: \"hidden\", textOverflow: \"ellipsis\" }}\n          >\n            {metadata.description}\n          </p>\n        )}\n      </div>\n      {context.accountId && (\n        <div\n          className=\"pb-2 card-bottom\"\n          style={{ display: \"flex\", justifyContent: \"flex-end\", gap: \"4px\" }}\n        >\n          <Widget\n            src=\"mob.near/widget/N.StarButton\"\n            props={{\n              notifyAccountId: accountId,\n              item: {\n                type: \"social\",\n                path: `${accountId}/${type}/${name}`,\n              },\n            }}\n          />\n          <Widget\n            src=\"mob.near/widget/N.LikeButton\"\n            props={{\n              notifyAccountId: accountId,\n              item: {\n                type: \"social\",\n                path: `${accountId}/${type}/${name}`,\n              },\n            }}\n          />\n        </div>\n      )}\n    </div>\n  );\n}\n\nreturn (\n  <Container>\n    <Widget\n      src=\"everycanvas.near/widget/ItemFeed\"\n      props={{\n        items: items,\n        renderItem: Item,\n        perPage: 100,\n        renderLayout: (items) => <Grid>{items}</Grid>,\n      }}\n    />\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/buildbox.near/widget/page.browse", "fact_widget_deployments_id": "fbdb46524c81ed487d01b96731ab5e7e", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 6}