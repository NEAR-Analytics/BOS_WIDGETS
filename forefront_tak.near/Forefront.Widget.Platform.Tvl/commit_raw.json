{"tx_hash": "Tz6RB1p7A5o96qXo5HNGhWtJJHJRBDksEjhsWFrEFAX", "action_id_social": "8bcm443EXou8G9Zo3uskQc4qAQE3Xif56JHMPbqHQi9a-0-widget", "block_id": 112399104, "block_timestamp": "2024-02-08T17:05:49.394Z", "signer_id": "forefront_tak.near", "widget_name": "Forefront.Widget.Platform.Tvl", "source_code": "const themeColor = props.themeColor;\r\n\r\nconst areatheme = {\r\n  height: \"110px\",\r\n  align: \"center\",\r\n  description: \"\",\r\n  brand: \"Platform\",\r\n  fontsize: \"25px\",\r\n  fontweight: \"40px\",\r\n  afterbrand: \"List (TVL)\",\r\n  afterbrandcolor: themeColor?.dynamic_header?.afterbrandcolor || \"#789efb\",\r\n  fontbrand: \" Arial, sans-serif\",\r\n  color1brand: themeColor?.dynamic_header?.color1brand || \"#000\",\r\n  color2brand: themeColor?.dynamic_header?.color2brand || \"#806ce1\",\r\n  colordescription: themeColor?.dynamic_header?.colordescription || \"#806ce1\",\r\n  fontsubtitle: \" Arial, sans-serif\",\r\n  background:\r\n    themeColor?.dynamic_header?.background ||\r\n    \"radial-gradient(circle, rgba(210,202,250,1) 0%, rgba(230,230,231,0.01) 0%, rgba(235,238,255,1) 100%, rgba(235,231,253,1) 100%, rgba(255,241,241,1) 100%, rgba(46,52,90,1) 100%);\",\r\n};\r\n\r\nconst queryHashes = [\r\n  { id: 1, hash: \"1a6802c2-e3fe-4a1a-90bd-4dc4687e5ccd\" }, // Platform  list\r\n  { id: 2, hash: \"91cc15a6-2bec-4c80-955b-6013d71581c2\" }, //  pie charts\r\n];\r\n\r\nState.init({\r\n  light: true,\r\n  data: [],\r\n  isLoading: true,\r\n  error: [],\r\n});\r\n\r\nconst getPieProps = (data, [key, value], colors, chartOption) => {\r\n  data = data || [];\r\n  colors = colors || [];\r\n  chartOption = chartOption || {};\r\n\r\n  const dataFormat = data.map((s) => [s[key], s[value]]);\r\n  const props = {\r\n    data: dataFormat,\r\n    colors: colors,\r\n    chartOption: {\r\n      title: \"chart title\",\r\n      type: \"pie\",\r\n      legend: false,\r\n      connector: false,\r\n      ...chartOption,\r\n    },\r\n    themeColor: { chart: themeColor.chart },\r\n    spinnerColors: themeColor.spinnerColors,\r\n  };\r\n  return props;\r\n};\r\n\r\nconst handleData = () => {\r\n  const data = {};\r\n  const errors = [];\r\n  queryHashes.forEach(({ hash, id }) => {\r\n    const result = fetchData(hash);\r\n    if (result.error) errors.push(`hash${id} : ${result.error}`);\r\n    data[`hash${id}`] = {\r\n      ...result,\r\n      id,\r\n    };\r\n  });\r\n\r\n  if (Object.values(data).every((d) => !d.isLoading)) {\r\n    State.update({\r\n      data: data,\r\n      error: [...state.error, ...errors],\r\n      isLoading: false,\r\n    });\r\n  }\r\n};\r\nconst convertData = (data) => {\r\n  if (typeof data !== \"string\") {\r\n    return data;\r\n  }\r\n  let converted;\r\n  try {\r\n    converted = JSON.parse(data);\r\n  } catch (er) {\r\n    converted = data;\r\n  }\r\n  return converted;\r\n};\r\n\r\nconst fetchData = (hash) => {\r\n  const data = fetch(\r\n    `https://api.flipsidecrypto.com/api/v2/queries/${hash}/data/latest`,\r\n    {\r\n      subscribe: true,\r\n      method: \"GET\",\r\n      headers: {\r\n        Accept: \"*/*\",\r\n      },\r\n    }\r\n  );\r\n  const result = {\r\n    data: (data && convertData(data.body)) || null,\r\n    error: (data && !data.ok && (data.status || data.error)) || null,\r\n    isLoading: !data && !error,\r\n  };\r\n  console.log(hash, data);\r\n  return result;\r\n};\r\n\r\nif (state.isLoading) {\r\n  handleData();\r\n}\r\n\r\nif (state.error.length > 0) {\r\n  function hide() {\r\n    const errors = state.error;\r\n    errors.shift();\r\n    if (errors.length > 0) setTimeout(hide, 2500);\r\n    State.update({ error: errors });\r\n  }\r\n  setTimeout(hide, 2500);\r\n}\r\n\r\nlet second = (\r\n  <div className=\"row w-100 py-4 g-4\">\r\n    <div className=\" col-12 col-md-6\">\r\n      <div\r\n        style={{ background: themeColor?.sbt_area?.card_bg }}\r\n        className=\"w-100 mx-auto shadow-sm rounded-4\"\r\n      >\r\n        <h6\r\n          style={{ color: themeColor?.sbt_area?.card_title_color }}\r\n          className=\"pt-4 ps-4\"\r\n        >\r\n          <i> Native Platform's TVL</i>\r\n        </h6>\r\n        <Widget\r\n          src=\"lord1.near/widget/Pie-chart\"\r\n          props={getPieProps(\r\n            state.data?.hash2?.data,\r\n            [\"NAME\", \"TVL\"],\r\n            themeColor.chartColor,\r\n            {\r\n              title: \"\",\r\n              type: \"pie\",\r\n              connector: true,\r\n              legend: true,\r\n            }\r\n          )}\r\n        />\r\n      </div>\r\n    </div>\r\n    <div className=\" col-12 col-md-6\">\r\n      <div\r\n        style={{ background: themeColor?.sbt_area?.card_bg }}\r\n        className=\"w-100 mx-auto shadow-sm rounded-4\"\r\n      >\r\n        <h6\r\n          style={{ color: themeColor?.sbt_area?.card_title_color }}\r\n          className=\"pt-4 ps-4\"\r\n        >\r\n          <i> Native Platform' TVL (category)</i>\r\n        </h6>\r\n        <Widget\r\n          src=\"lord1.near/widget/Pie-chart\"\r\n          props={getPieProps(\r\n            state.data?.hash2?.data,\r\n            [\"CATEGORY\", \"TVL\"],\r\n            themeColor.chartColor,\r\n            {\r\n              title: \"\",\r\n              type: \"pie\",\r\n              connector: true,\r\n              legend: true,\r\n            }\r\n          )}\r\n        />\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\n\r\nlet third = (\r\n  <div\r\n    className=\"my-4 shadow-sm  rounded-4\"\r\n    style={{ background: themeColor?.sbt_area?.section_bg }}\r\n  >\r\n    <Widget src=\"lord1.near/widget/header-dynamic\" props={areatheme} />\r\n    <div className=\"row w-100 pb-2 px-2 mx-0\">\r\n      <div\r\n        style={{ background: themeColor?.sbt_area?.card_bg }}\r\n        className=\"shadow-sm rounded-2 overflow-auto\"\r\n      >\r\n        <Widget\r\n          src=\"lord1.near/widget/table-pagination\"\r\n          props={{\r\n            themeColor: { table_pagination: themeColor.table_pagination },\r\n            data: state.data?.hash1?.data,\r\n            rowsCount: 10,\r\n            columns: [\r\n              {\r\n                title: \"Name\",\r\n                key: \"NAME\",\r\n                colors: \"#8b76f3\",\r\n              },\r\n              {\r\n                title: \"Category\",\r\n                key: \"CATEGORY\",\r\n              },\r\n              {\r\n                title: \"Chain\",\r\n                key: \"CHAIN\",\r\n              },\r\n              {\r\n                title: \"TVL $\",\r\n                key: \"TVL\",\r\n                round: \"yes\",\r\n              },\r\n              {\r\n                title: \"Change (1H)\",\r\n                key: \"CHANGE_1H\",\r\n              },\r\n              {\r\n                title: \"Change (1D)\",\r\n                key: \"CHANGE_1D\",\r\n              },\r\n\r\n              {\r\n                title: \"Site URL\",\r\n                key: \"URL\",\r\n                link: \"yes\",\r\n              },\r\n              {\r\n                title: \"Twitter\",\r\n                key: \"TWITTER\",\r\n                link: \"yes\",\r\n                beforehref: \"https://twitter.com/\",\r\n              },\r\n            ],\r\n          }}\r\n        />\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\nreturn (\r\n  <div className=\"container-fluid py-2\">\r\n    <div className=\"pl-2\">\r\n      {third}\r\n      {second}\r\n\r\n      <div className=\"toast-container position-fixed bottom-0 end-0 p-3\">\r\n        {state.error.length > 0 &&\r\n          state.error.map((er) => (\r\n            <div\r\n              className=\"toast show align-items-center text-bg-danger border-0\"\r\n              role=\"alert\"\r\n              aria-live=\"assertive\"\r\n              aria-atomic=\"true\"\r\n            >\r\n              <div className=\"d-flex\">\r\n                <div className=\"toast-body\">{er}</div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\n\r\n// const props = {\r\n//   themeColor: {\r\n//     dynamic_header: {\r\n//       afterbrandcolor: \"#789efb\",\r\n//       color1brand: \"#000\",\r\n//       color2brand: \"#806ce1\",\r\n//       colordescription: \"#806ce1\",\r\n//       background:\r\n//         \"radial-gradient(circle, rgba(210,202,250,1) 0%, rgba(230,230,231,0.01) 0%, rgba(235,238,255,1) 100%, rgba(235,231,253,1) 100%, rgba(255,241,241,1) 100%, rgba(46,52,90,1) 100%);\",\r\n//     },\r\n//     tab_sbt: {\r\n//       backgroundColor: \"rgb(49,62,89)\",\r\n//       textColor: \"#fff\",\r\n//       headerColor: \"#806ce1\",\r\n//       numberColor: \"#fff\",\r\n//     },\r\n//     sbt_area: {\r\n//       section_bg: \"rgba(25,33,80)\",\r\n//       card_bg: \"rgb(49, 62, 89)\",\r\n//       card_title_color: \"#806ce1\",\r\n//     },\r\n//   },\r\n// };\r\n", "metadata": {"fork_of": "lord1.near/widget/trend-election@101550560"}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/forefront_tak.near/widget/Forefront.Widget.Platform.Tvl", "fact_widget_deployments_id": "8f753106f39d5e36f409443fc70baeaf", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}