{"tx_hash": "8S9A9bpsnRAdpvhy4Rfvw8fGF28nCHsfzvittT5HjTrB", "action_id_social": "EFYhUae2EVgGzdHXBp4D3yE71ZVt73eDYsroPbDTizac-0-widget", "block_id": 97523807, "block_timestamp": "2023-07-28T10:33:33.742Z", "signer_id": "relayer.pagodaplatform.near", "widget_name": "plunderland", "source_code": null, "metadata": null, "branch": {"draft": {"": "if (\n  state.chainId === undefined &&\n  ethers !== undefined &&\n  Ethers.send(\"eth_requestAccounts\", [])[0]\n) {\n  Ethers.provider()\n    .getNetwork()\n    .then((chainIdData) => {\n      if (chainIdData?.chainId) {\n        State.update({ chainId: chainIdData.chainId });\n      }\n    });\n}\n// FETCH LIDO ABI\n\nconst lootContract = \"0x198543B8f9b83d2477F1eD897834D6890f98e6f1\";\nconst tokenDecimals = 18;\n\nconst erc20ABI = fetch(\n  \"https://gist.githubusercontent.com/veox/8800debbf56e24718f9f483e1e40c35c/raw/f853187315486225002ba56e5283c1dba0556e6f/erc20.abi.json\"\n);\nif (!erc20ABI.ok) {\n  return \"Loading\";\n}\n\nconst minABI = [\n  {\n    constant: true,\n    inputs: [{ name: \"_owner\", type: \"address\" }],\n    name: \"balanceOf\",\n    outputs: [{ name: \"balance\", type: \"uint256\" }],\n    type: \"function\",\n  },\n];\n\nconst iface = new ethers.utils.Interface(minABI);\n\n// HELPER FUNCTIONS\nconst getLootBalance = () => {\n  const encodedData = iface.encodeFunctionData(\"balanceOf\", [state.sender]);\n\n  console.log(encodedData);\n\n  return Ethers.provider()\n    .call({\n      to: lootContract,\n      data: encodedData,\n    })\n    .then((rawBalance) => {\n      const balanceHex = iface.decodeFunctionResult(\"balanceOf\", rawBalance);\n\n      return Big(balanceHex.toString())\n        .div(Big(10).pow(tokenDecimals))\n        .toFixed(2)\n        .replace(/\\d(?=(\\d{3})+\\.)/g, \"$&,\");\n    });\n};\n\nif (state.lootBalance === undefined && state.sender) {\n  getLootBalance().then((lootBalance) => {\n    State.update({ lootBalance });\n  });\n}\n\n// const submitEthers = (strEther, _referral) => {\n//   if (!strEther) {\n//     return console.log(\"Amount is missing\");\n//   }\n//   const erc20 = new ethers.Contract(\n//     lidoContract,\n//     lidoAbi.body,\n//     Ethers.provider().getSigner()\n//   );\n\n//   let amount = ethers.utils.parseUnits(strEther, tokenDecimals).toHexString();\n\n//   erc20.submit(lidoContract, { value: amount }).then((transactionHash) => {\n//     console.log(\"transactionHash is \" + transactionHash);\n//   });\n// };\n\n// DETECT SENDER\n\nif (state.sender === undefined) {\n  const accounts = Ethers.send(\"eth_requestAccounts\", []);\n  if (accounts.length) {\n    State.update({ sender: accounts[0] });\n    console.log(\"set sender\", accounts[0]);\n  }\n}\n\nconst getSenderTruncated = () => {\n  return !state.sender\n    ? \"\"\n    : state.sender.substring(0, 6) +\n        \"...\" +\n        state.sender.substring(state.sender.length - 4, state.sender.length);\n};\n\nreturn (\n  <div>\n    <div>\n      <div>Welcome to Plunderland</div>\n      <span>{getSenderTruncated()}</span>\n      <br />\n      <span>LOOT: {state.lootBalance}</span>\n    </div>\n    <div>\n      <img\n        width=\"100px\"\n        src=\"https://img.itch.zone/aW1hZ2UvOTEyNjM2LzUxODA1MTAuZ2lm/794x1000/j7G6V7.gif\"\n      />\n    </div>\n    {!!state.sender ? (\n      <button onClick={() => submitEthers(state.strEther, state.sender)}>\n        <span>Enter!</span>\n      </button>\n    ) : (\n      <Web3Connect connectLabel=\"Connect with Web3\" />\n    )}\n  </div>\n);\n"}}, "widget_modules_used": null, "widget_url": "https://near.social/#/relayer.pagodaplatform.near/widget/plunderland", "fact_widget_deployments_id": "560f35f480bbfca029ed4a2a690fc164", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}