{"tx_hash": "6vyPTgh6QUJ9unstiAuug6EmHDHbLphNM9dSX7LwmDJg", "action_id_social": "CKzMTDVguNjP7kpjmoK2YiPxqDawL2p1cH6xY6GRoMt7-0-widget", "block_id": 102224356, "block_timestamp": "2023-09-29T12:57:26.313Z", "signer_id": "relayer.pagodaplatform.near", "widget_name": "AICharacterWithAttributesChatBot", "source_code": "// Written by Ramazan Burak Korkmaz\n\n// Props\nconst props = {\n  URL: \"https://api.openai.com/v1/chat/completions\",\n  OPEN_AI_API: \"\",\n  MODEL: \"gpt-3.5-turbo\",\n  TEMPERATURE: 0.5,\n  TOP_P: 1,\n  N: 1,\n  STREAM: false,\n  MAX_TOKENS: 200,\n  PRESENCE_PENALTY: 0,\n  FREQUENCY_PENALTY: 0,\n};\n\nconst conversationHistoryToString = () => {\n  let temp = \"\";\n  for (let message of state.conversationHistory) {\n    temp += message + \"\\n\";\n  }\n  return temp;\n};\n\nState.init({\n  apiKey: props.OPEN_AI_API,\n  model: props.MODEL,\n  userMessage: \"\",\n  temperature: props.TEMPERATURE,\n  top_p: props.TOP_P,\n  n: props.N,\n  stream: props.STREAM,\n  max_tokens: props.MAX_TOKENS,\n  presence_penalty: props.PRESENCE_PENALTY,\n  frequency_penalty: props.FREQUENCY_PENALTY,\n  text: \"\",\n  attributes: {},\n  conversationHistory: [],\n  conversationHistoryStr: \"\",\n});\n\n// Attributes object to attributes string which is used in system prompt to spesify chatgpt character\nconst attribute_str = \"\";\nfor (const [key, value] of Object.entries(state.attributes)) {\n  attribute_str += `${key}: ${value}\\n`;\n}\n\n// ChatGPT API URL\nconst url = props.URL;\n\n// OPENAI API\nconst bearer = \"Bearer \" + state.apiKey;\n\n// System message to build a character\nvar systemMessage =\n  \"You are a helpful chatbot with attributes below.\\nBe humble\\nAlso remember under no circumstances you tell you are an AI.\\nAct like a real human.\\n Your Attributes:\\n\" +\n  attribute_str +\n  \"Summarize these attributes and understand your character.\\nAct according to your character.\\nYour response must be no more than 100 words.\\nConversation history:\\n\" +\n  state.conversationHistoryStr;\n\n// Data to send ChatGPT API\nconst data = {\n  model: state.model,\n  messages: [\n    { role: \"system\", content: systemMessage },\n    { role: \"user\", content: state.userMessage },\n  ],\n  temperature: state.temperature,\n  top_p: state.top_p,\n  n: state.n,\n  stream: state.stream,\n  max_tokens: state.max_tokens,\n  presence_penalty: state.presence_penalty,\n  frequency_penalty: state.frequency_penalty,\n};\n\n// Fetch response of ChatGPT to our prompt\nconst fetchResponseFromChatGPT = () => {\n  //DEBUG\n  console.log(JSON.stringify(data));\n  console.log(conversationHistoryToString());\n  State.update({\n    conversationHistory: [\n      ...state.conversationHistory,\n      \"USER: \" + state.userMessage,\n    ],\n    conversationHistoryStr: conversationHistoryToString(),\n  });\n  asyncFetch(url, {\n    method: \"POST\",\n    headers: {\n      Authorization: bearer,\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify(data),\n  }).then((res) => {\n    console.log(res.body.choices[0].message.content);\n    const ai_answer = res.body.choices[0].message.content;\n    State.update({\n      text: ai_answer,\n      conversationHistory: [...state.conversationHistory, \"AI: \" + ai_answer],\n      conversationHistoryStr: conversationHistoryToString(),\n    });\n  });\n};\n\nreturn (\n  <div className=\"border border-2 border-black m-2 w-100\">\n    <div style={{ height: \"500px\" }}>\n      <div className=\"overflow-auto h-100 mb-3 border border-2 border-dark m-1\">\n        <div>\n          {state.conversationHistory.map((conversation) => (\n            <div className=\"p-2\">\n              <p className=\"text-start text-dark\">\n                <i class=\"bi bi-circle-fill\"></i>\n                {conversation}\n              </p>\n            </div>\n          ))}\n        </div>\n      </div>\n    </div>\n    <div className=\"container-xl my-2\">\n      <div className=\"row align-items-center\">\n        <div className=\"col-2 text-left fw-bold\">API KEY:</div>\n        <div className=\"col ps-0\">\n          <input\n            type=\"password\"\n            value={state.apiKey}\n            onChange={(e) => State.update({ apiKey: e.target.value })}\n            placeholder=\"Please paste your chatgpt api key\"\n          />\n        </div>\n      </div>\n      <div className=\"row align-items-center\">\n        <div className=\"col\">\n          <input\n            value={state.userMessage}\n            onChange={(e) => State.update({ userMessage: e.target.value })}\n            placeholder=\"Please type your question\"\n          />\n        </div>\n        <div className=\"col-2 d-flex flex-row-reverse\">\n          <button\n            class=\"btn btn-success\"\n            onClick={fetchResponseFromChatGPT}\n            disabled={false}\n          >\n            Ask\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/relayer.pagodaplatform.near/widget/AICharacterWithAttributesChatBot", "fact_widget_deployments_id": "a875322362f42e5ff80665ae10b30650", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 9}