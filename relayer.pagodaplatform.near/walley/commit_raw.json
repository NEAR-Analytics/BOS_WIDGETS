{"tx_hash": "FCBVdpwRNv8ykW8Fstqah22X1jP35AmQgdxoyav48fMk", "action_id_social": "HEFLbBSNis32hvcj8xrndLasTdGMxAHoqUEeJ6CDunTA-0-widget", "block_id": 99292232, "block_timestamp": "2023-08-21T04:13:25.352Z", "signer_id": "relayer.pagodaplatform.near", "widget_name": "walley", "source_code": "const nftAddress = \"0xb7d25d9ff6bec0072ca60e4ce2cf9ce822c19635\";\nconst NFTManagerABI = JSON.parse(\n  fetch(\"https://raw.githubusercontent.com/test1883/files/main/NFTManager.json\")\n    .body\n);\nconst walleyAddress = \"0x3b218f8d01e3acfed2bd2e5ad3246d03f4375715\";\nconst WalleyABI = JSON.parse(\n  fetch(\"https://raw.githubusercontent.com/test1883/files/main/Walley.json\")\n    .body\n);\nState.init({\n  general: {\n    chainId: undefined,\n    balance: 0,\n  },\n  store: {\n    stores: [],\n    storeName: \"\",\n    storeAddress: \"\",\n    storeNames: [],\n    isStore: false,\n    storePendingTransactions: [],\n    storeImages: {},\n  },\n  user: {\n    userPendingTransactions: [],\n  },\n  view: 0,\n});\n\nconst cssFont = fetch(\n  \"https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&display=swap\"\n).body;\n\nconst Root = styled.div`\n    width: 100%;\n    display: flex;\n    font-family: Poppins, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif;\n    ${cssFont}\n    flex-direction: column;\n    padding: 0;\n    align-items: center;\n    justify-content: center;\n    box-sizing: border-box;\n`;\n\nconst WalleyTitle = styled.div`\n    text-align: left;\n    font-weight: 900;\n    width: 100%;\n    font-size: 30px;\n    margin: 0px;\n    padding: 5px;\n    color: #000D1A; \n    media screen and (max-width: 600px) {\n        font-size: 20px;\n    }\n`;\n\nconst WalleyIndexContainer = styled.div`\n    \n    box-shadow: 12px 0px 0px 5px #000D1A;\n    background: linear-gradient( to bottom, orange 0%, orange 50%, #FFF5F5 50%, #FFF5F5 100% );\n    color: #000D1A;\n    width: 100%;\n    padding: 20px;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    text-align: center;\n    justify-content: space-betweeen;\n`;\n\nconst WalleyIndexTop = styled.div`\n    margin-top: 20px;\n    color: #000D1A;\n    font-weight: 600;\n    font-size: 40px;\n    height: 100%;\n    padding-bottom: 10px;\n    @media screen and (max-width: 600px) {\n        font-size: 25px;\n        font-weight: 700;\n    }\n`;\n\nconst WalleyIndexBottom = styled.div`\n    position: relative;\n    top: 50%;\n    height: 350px;\n    background-color: white;\n    font-weight: 500;\n    width: 400px;\n    text-align: left;\n    box-shadow: 12px 0px 0px 5px #000D1A;\n    @media screen and (max-width: 600px) {\n        width: 100%;\n        box-shadow: none;\n        border: 1px solid #DBDED7;\n        border-radius: 20px;\n    }\n    &>button {\n        border: none;\n        background: orange;\n        color: white;\n    }\n`;\n\nconst WalleyHomeContainer = styled.div`\n    box-shadow: 12px 0px 0px 5px #000D1A;\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n`;\n\nconst WalleyHomeHeader = styled.div`\n    background-color: orange;\n    width: 100%;\n    height: 70px;\n    font-size: 20px;\n    font-weight: 900;\n    padding: 10px;\n    position: relative;\n    top: 0px;\n\n`;\n\nconst WalleyHomeMain = styled.div`\n    padding: 20px;\n    display: flex;\n    flex-direction: row;\n    width: 100%;\n    align-items: space-between;\n`;\n\nconst WalleyNavbar = styled.div`\n    width: 25%;\n    display: flex;\n    flex-direction: column;\n    position: relative;\n    left: 0px;\n`;\n\nconst WalleyNavbarButton = styled.button`\n    border: none;\n    border-bottom: 1px solid #000D1A;\n    text-align: center;\n    background: white;\n    color: #000D1A;\n`;\n\nconst WalleyHomeBody = styled.div`\n  width: 75%;\n`;\n\nconst WalleyBalance = styled.p`\n  font-weight: 700;\n`;\n\nconst sender = Ethers.send(\"eth_requestAccounts\", [])[0];\nconst updateBalance = (balance) => {\n  State.update({ balance });\n};\nif (!sender) {\n  return (\n    <Root>\n      <WalleyIndexContainer>\n        <WalleyTitle>Walley.</WalleyTitle>\n        <WalleyIndexTop>Go Phoneless</WalleyIndexTop>\n        <WalleyIndexBottom>\n          Get Started\n          <Web3Connect connectLabel=\"Connect Wallet\" />\n        </WalleyIndexBottom>\n      </WalleyIndexContainer>\n    </Root>\n  );\n}\nif (state.chainId === undefined && ethers !== undefined && sender) {\n  Ethers.provider()\n    .getNetwork()\n    .then((chainIdData) => {\n      if (chainIdData?.chainId) {\n        State.update({ chainId: chainIdData.chainId });\n      }\n    });\n  Ethers.provider()\n    .getBalance(sender)\n    .then((balance) => {\n      console.log(balance);\n      updateBalance(Big(balance).div(Big(10).pow(18)).toFixed(5));\n    });\n}\nif (state.chainId !== undefined && state.chainId !== 11155111) {\n  return <p>Switch to Ethereum Sepolia</p>;\n}\nconst nftIface = new ethers.utils.Interface(NFTManagerABI);\nconst nftContract = new ethers.Contract(\n  nftAddress,\n  NFTManagerABI,\n  Ethers.provider().getSigner()\n);\nconst walleyIface = new ethers.utils.Interface(WalleyABI);\nconst walleyContract = new ethers.Contract(\n  walleyAddress,\n  WalleyABI,\n  Ethers.provider().getSigner()\n);\nconsole.log(walleyContract);\n//get stores data\nif (state.store.stores.length === 0 && nftContract && sender) {\n  nftContract.getAllStores().then((stores) => {\n    const storeState = state.store;\n    storeState.stores = stores;\n    let store;\n    for (let i = 0; i < stores.length; i++) {\n      store = stores[i];\n      storeState.storeNames.push(store[0]);\n      storeState.storeImages[store[0]] = store[2];\n      if (store[1] === sender) {\n        storeState.isStore = true;\n        storeState.storeName = store[0];\n        storeState.storeAddress = store[1];\n        nftContract\n          .getStoreActiveTransactions(store[1])\n          .then(\n            (transactions) =>\n              (storeState.storePendingTransactions = transactions)\n          );\n      }\n      if (i === stores.length - 1) State.update({ store: storeState });\n    }\n    console.log(state.store);\n  });\n}\n\nif (store.user.userPendingTransactions.length === 0 && sender && nftContract) {\n  nftContract\n    .getMyActiveTransactions({ from: sender })\n    .then((transactions) =>\n      State.update({ user: { userPendingTransactions: transactions } })\n    );\n}\n\nreturn (\n  <Root>\n    <WalleyHomeContainer>\n      <WalleyHomeHeader>Walley.</WalleyHomeHeader>\n      <WalleyHomeMain>\n        <WalleyNavbar>\n          <WalleyNavbarButton onClick={() => State.update({ view: 0 })}>\n            Home\n          </WalleyNavbarButton>\n          <WalleyNavbarButton onClick={() => State.update({ view: 1 })}>\n            Your Store NFTs\n          </WalleyNavbarButton>\n          <WalleyNavbarButton onClick={() => State.update({ view: 2 })}>\n            Add a store\n          </WalleyNavbarButton>\n        </WalleyNavbar>\n        <WalleyHomeBody>\n          <WalleyBalance>\n            Your Balance - {state.balance}\n            {state.view ? 0(\"helloaaaa\") : state.view ? 1(\"helloob\") : \"hello\"}\n          </WalleyBalance>\n        </WalleyHomeBody>\n      </WalleyHomeMain>\n    </WalleyHomeContainer>\n  </Root>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/relayer.pagodaplatform.near/widget/walley", "fact_widget_deployments_id": "35f185e9c9eda3dbabe6879caaef6d69", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 112}