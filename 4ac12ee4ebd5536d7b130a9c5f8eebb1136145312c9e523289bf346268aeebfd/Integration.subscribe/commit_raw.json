{"tx_hash": "AkPxxA41HLSLYiSFkADfMAHYAW83ij1hVxZ34ARXPqnJ", "action_id_social": "C9rb9Rb5WDVVGNdG7mLXT818vHmSaQZrc9x5NH7f69Py-0-widget", "block_id": 97066585, "block_timestamp": "2023-07-22T11:55:54.778Z", "signer_id": "4ac12ee4ebd5536d7b130a9c5f8eebb1136145312c9e523289bf346268aeebfd", "widget_name": "Integration.subscribe", "source_code": "// PROPS\nif (!props.collectionAddress)\n  return (\n    <Widget\n      src={\n        \"4ac12ee4ebd5536d7b130a9c5f8eebb1136145312c9e523289bf346268aeebfd/widget/Common.error\"\n      }\n      props={{ message: \"`collectionAddress` undefined.\" }}\n    />\n  );\nconst tier = Big(props.tier ?? 0).toString();\nconst style = props.style ?? { backgroundColor: \"blue\", fontWeight: 500 };\n\n// CHECK FOR WALLET CONNECTION\nif (state.sender === undefined) {\n  const accounts = Ethers.send(\"eth_requestAccounts\", []);\n  if (accounts.length) {\n    State.update({ sender: accounts[0] });\n  } else\n    return (\n      <Widget\n        src={\n          \"4ac12ee4ebd5536d7b130a9c5f8eebb1136145312c9e523289bf346268aeebfd/widget/Common.error\"\n        }\n        props={{ message: \"`signer` undefined.\" }}\n      />\n    );\n}\n\n// CONTRACT INSTANCE\nconst collectionABI = fetch(\n  \"https://raw.githubusercontent.com/knwtechs/subscript.io-contracts/main/artifacts/contracts/SubscriptionsCollection.sol/SubscriptionsCollection.json\"\n);\nif (!collectionABI.ok) {\n  return \"Contract unavailable.\";\n}\nconst subscriptionsCollectionContract = new ethers.Contract(\n  contractAddress,\n  JSON.parse(collectionABI.body)[\"abi\"],\n  Ethers.provider().getSigner()\n);\nsubscriptionsCollectionContract\n  .getTierPrice(tier)\n  .then((price) => State.update({ price: price.toString() }));\n//}\n\nconst subscribe = () => {\n  console.log(\"To: \", state.sender);\n  console.log(\"Tier: \", tier);\n  console.log(\"Price: \", state.price);\n  try {\n    subscriptionsCollectionContract\n      .mint(state.sender, tier, { value: state.price })\n      //.sendTransaction()\n      .catch((err) => console.log(err))\n      .then((tx) => {\n        console.log(\"Waiting for confirmation: \", tx);\n        tx.wait().then(() => console.log(\"TX Confirmed\"));\n      });\n  } catch (err) {\n    console.log(err);\n  }\n};\n\nreturn (\n  <>\n    <button\n      style={style}\n      onClick={subscribe}\n      id={props.id ?? \"subscribeButton\"}\n    >\n      Subscribe\n    </button>\n  </>\n);\n", "metadata": {"platform": "nearpad"}, "branch": {"draft": null}, "widget_modules_used": null, "widget_url": "https://near.social/#/4ac12ee4ebd5536d7b130a9c5f8eebb1136145312c9e523289bf346268aeebfd/widget/Integration.subscribe", "fact_widget_deployments_id": "e7854378ba25f9730fc32ea32763cbd2", "inserted_timestamp": "2000-01-01T00:00:00.000Z", "modified_timestamp": "2000-01-01T00:00:00.000Z", "__row_index": 0}