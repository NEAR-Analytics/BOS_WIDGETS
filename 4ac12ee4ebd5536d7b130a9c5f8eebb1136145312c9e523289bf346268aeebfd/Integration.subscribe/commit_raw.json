{"tx_hash": "GrgVj317uY9UXHSbpSv7WHd46xk6CvT1MyxSKPZdK9fq", "action_id_social": "AaGpJzP6puag6RVQDbtmhyRFtttZHq2nw5sdXrw9Aux6-0-widget", "block_id": 97089657, "block_timestamp": "2023-07-22T19:16:47.968Z", "signer_id": "4ac12ee4ebd5536d7b130a9c5f8eebb1136145312c9e523289bf346268aeebfd", "widget_name": "Integration.subscribe", "source_code": "// PROPS\nif (!props.collectionAddress)\n  return (\n    <Widget\n      src={\n        \"4ac12ee4ebd5536d7b130a9c5f8eebb1136145312c9e523289bf346268aeebfd/widget/Common.error\"\n      }\n      props={{ message: \"`collectionAddress` undefined.\" }}\n    />\n  );\nconst tier = Big(props.tier ?? 0).toString();\nconst style = props.style ?? {\n  backgroundColor: \"blue\",\n  fontWeight: 500,\n  minWidth: \"10vw\",\n};\n\nState.init({\n  loading: false,\n});\n\n// CHECK FOR WALLET CONNECTION\nif (state.sender === undefined) {\n  const accounts = Ethers.send(\"eth_requestAccounts\", []);\n  if (accounts.length) {\n    State.update({ sender: accounts[0] });\n  } else {\n    return (\n      <Widget\n        src={\n          \"4ac12ee4ebd5536d7b130a9c5f8eebb1136145312c9e523289bf346268aeebfd/widget/Common.error\"\n        }\n        props={{ message: \"`signer` undefined.\" }}\n      />\n    );\n  }\n}\n\n// CONTRACT INSTANCE\nconst collectionABI = fetch(\n  \"https://raw.githubusercontent.com/knwtechs/subscript.io-contracts/main/artifacts/contracts/SubscriptionsCollection.sol/SubscriptionsCollection.json\"\n);\nif (!collectionABI.ok) {\n  return \"Contract unavailable.\";\n}\nconst subscriptionsCollectionContract = new ethers.Contract(\n  props.collectionAddress,\n  JSON.parse(collectionABI.body)[\"abi\"],\n  Ethers.provider().getSigner()\n);\nsubscriptionsCollectionContract\n  .getTierPrice(tier)\n  .then((price) => State.update({ price: price.toString() }));\n\nconst subscribe = () => {\n  console.log(\"To: \", state.sender);\n  console.log(\"Tier: \", tier);\n  console.log(\"Price: \", state.price);\n\n  try {\n    State.update({ loading: true });\n    subscriptionsCollectionContract\n      .mint(state.sender, tier, { value: state.price })\n      .catch((err) => {\n        State.update({ loading: false });\n        console.log(err);\n      })\n      .then((tx) => {\n        console.log(\"Waiting for confirmation: \", tx);\n        tx.wait().then(() => {\n          console.log(\"TX Confirmed\");\n          State.update({ loading: false });\n        });\n      });\n  } catch (err) {\n    console.log(err);\n  }\n};\n\nreturn (\n  <>\n    <button\n      style={style}\n      onClick={subscribe}\n      id={props.id ?? \"subscribeButton\"}\n    >\n      {state.loading ? (\n        <div class=\"spinner-border text-light\" role=\"status\"></div>\n      ) : (\n        \"Subscribe\"\n      )}\n    </button>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/4ac12ee4ebd5536d7b130a9c5f8eebb1136145312c9e523289bf346268aeebfd/widget/Integration.subscribe", "fact_widget_deployments_id": "d90e4c88853a8e50e09b4365213438d6", "inserted_timestamp": "2000-01-01T00:00:00.000Z", "modified_timestamp": "2000-01-01T00:00:00.000Z", "__row_index": 1}