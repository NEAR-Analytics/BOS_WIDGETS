{"tx_hash": "PEFECCFj6Xt8zBZP3KwyrX4fCwgaf4EjEYYfTPKcWN7", "action_id_social": "3pG54KygPwci39Y2GFB8PVWDBuiMX5FcEHq3i3DdfwLk-0-widget", "block_id": 97102443, "block_timestamp": "2023-07-22T23:17:05.040Z", "signer_id": "4ac12ee4ebd5536d7b130a9c5f8eebb1136145312c9e523289bf346268aeebfd", "widget_name": "Integration.renew", "source_code": "// PROPS\nif (!props.collectionAddress)\n  return (\n    <Widget\n      src={\n        \"4ac12ee4ebd5536d7b130a9c5f8eebb1136145312c9e523289bf346268aeebfd/widget/Common.error\"\n      }\n      props={{ message: \"`collectionAddress` undefined.\" }}\n    />\n  );\nconst tier = Big(props.tier ?? 0).toString();\nconst style = props.style ?? {\n  backgroundColor: \"blue\",\n  fontWeight: 500,\n  minWidth: \"10vw\",\n  textTransform: \"capitalize\",\n};\n\nState.init({\n  loading: false,\n});\n\n// CHECK FOR WALLET CONNECTION\nif (state.sender === undefined) {\n  const accounts = Ethers.send(\"eth_requestAccounts\", []);\n  if (accounts.length) {\n    State.update({ sender: accounts[0] });\n  } else {\n    return (\n      <Widget\n        src={\n          \"4ac12ee4ebd5536d7b130a9c5f8eebb1136145312c9e523289bf346268aeebfd/widget/Common.error\"\n        }\n        props={{ message: \"Please login first.\" }}\n      />\n    );\n  }\n}\n\n// CONTRACT INSTANCE\nconst collectionABI = fetch(\n  \"https://raw.githubusercontent.com/knwtechs/subscript.io-contracts/main/artifacts/contracts/SubscriptionsCollection.sol/SubscriptionsCollection.json\"\n);\nif (!collectionABI.ok) {\n  return \"Contract unavailable.\";\n}\n\nconst subscriptionsCollectionContract = new ethers.Contract(\n  props.collectionAddress,\n  JSON.parse(collectionABI.body)[\"abi\"],\n  Ethers.provider().getSigner()\n);\n\nsubscriptionsCollectionContract\n  .getTierPrice(tier)\n  .then((price) => State.update({ price: price.toString() }));\n\nconst subscribe = () => {\n  console.log({\n    to: state.sender,\n    tier,\n    price: state.price,\n  });\n\n  try {\n    State.update({ loading: true });\n    subscriptionsCollectionContract\n      .renewSubscription(tier, {\n        value: state.price,\n      })\n      .catch((err) => {\n        State.update({ loading: false });\n        console.log(err);\n      })\n      .then((tx) => {\n        console.log(\"Waiting for confirmation: \", tx);\n        tx.wait().then((receipt) => {\n          console.log(\"TX Confirmed: \", receipt);\n          State.update({ loading: false });\n        });\n      });\n  } catch (err) {\n    State.update({ loading: false });\n    console.log(err);\n  }\n};\n\nreturn (\n  <>\n    <button\n      style={style}\n      onClick={subscribe}\n      id={props.id ?? \"subscribeButton\"}\n    >\n      {state.loading ? (\n        <div class=\"spinner-border text-light\" role=\"status\"></div>\n      ) : (\n        \"renew\"\n      )}\n    </button>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/4ac12ee4ebd5536d7b130a9c5f8eebb1136145312c9e523289bf346268aeebfd/widget/Integration.renew", "fact_widget_deployments_id": "61af331d9b1ebe2a92206b814b63ee49", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}