{"tx_hash": "8EoJ7y4TJAVMEFEpxdKdR6ec6V8HENTYhX7iQS7FGZmW", "action_id_social": "AQ5vZf5oBckz4M7gG6aQFBkCw2QLB1fUspNZ5tmF66ph-0-widget", "block_id": 115283393, "block_timestamp": "2024-03-23T05:56:08.728Z", "signer_id": "slimedragon.near", "widget_name": "AreWeFlippedYet", "source_code": "const INTEL_NEAR_POOL = 4663;\nconst NVIDIA_NEAR_POOL = 4547;\n\nconst [intelMCap, setIntelMCap] = useState(undefined);\nconst [nvidiaMCap, setNvidiaMCap] = useState(undefined);\n\nfunction getNearPrice() {\n  const NEAR_USDT_POOL = 3;\n  const NEAR_DECIMALS = 24;\n  const USDT_DECIMALS = 6;\n  const NEAR_TOKEN_ID = \"wrap.near\";\n\n  return new Promise((resolve, reject) => {\n    const REF_CONTRACT_ID = \"v2.ref-finance.near\";\n    Near.asyncView(REF_CONTRACT_ID, \"get_pool\", {\n      pool_id: NEAR_USDT_POOL,\n    }).then((pool) => {\n      const nearIndex = pool.token_account_ids.indexOf(NEAR_TOKEN_ID);\n      const usdtIndex = 1 - nearIndex;\n      const nearInPool = ethers.BigNumber.from(pool.amounts[nearIndex]);\n      const usdtInPool = ethers.BigNumber.from(pool.amounts[usdtIndex]);\n      const nearHumanReadable =\n        nearInPool\n          .mul(ethers.BigNumber.from(100))\n          .div(\n            ethers.BigNumber.from(10).pow(ethers.BigNumber.from(NEAR_DECIMALS))\n          )\n          .toNumber() / 100;\n      const usdtHumanReadable =\n        usdtInPool\n          .mul(ethers.BigNumber.from(100))\n          .div(\n            ethers.BigNumber.from(10).pow(ethers.BigNumber.from(USDT_DECIMALS))\n          )\n          .toNumber() / 100;\n      resolve(usdtHumanReadable / nearHumanReadable);\n    });\n  });\n}\n\nfunction getMarketCap(tokenId, poolId) {\n  const REF_CONTRACT_ID = \"v2.ref-finance.near\";\n  const NEAR_DECIMALS = 24;\n  const BURN_ADDRESSES = [\"0\".repeat(64)];\n\n  return new Promise((resolve, reject) => {\n    const decimals = Near.view(tokenId, \"ft_metadata\", {}).decimals;\n    const totalSupply = ethers.BigNumber.from(\n      Near.view(tokenId, \"ft_total_supply\", {})\n    );\n    const burnedPromises = BURN_ADDRESSES.map((burnAddress) =>\n      Near.asyncView(tokenId, \"ft_balance_of\", { account_id: burnAddress })\n    );\n    Promise.all(burnedPromises).then((burnedAmounts) => {\n      const burned = burnedAmounts.reduce(\n        (acc, balance) => acc.add(balance),\n        ethers.BigNumber.from(0)\n      );\n      const circulatingSupply = totalSupply\n        .sub(burned)\n        .div(ethers.BigNumber.from(10).pow(ethers.BigNumber.from(decimals)));\n      Near.asyncView(REF_CONTRACT_ID, \"get_pool\", {\n        pool_id: poolId,\n      }).then((pool) => {\n        const tokenIndex = pool.token_account_ids.indexOf(tokenId);\n        const nearIndex = 1 - tokenIndex;\n        const tokenInPool = ethers.BigNumber.from(pool.amounts[tokenIndex]).div(\n          ethers.BigNumber.from(10).pow(ethers.BigNumber.from(decimals))\n        );\n        const nearInPool = ethers.BigNumber.from(pool.amounts[nearIndex]).div(\n          ethers.BigNumber.from(10).pow(ethers.BigNumber.from(NEAR_DECIMALS))\n        );\n        if (tokenId === \"ndc.tkn.near\") {\n          console.log(tokenInPool, nearInPool);\n        }\n        const tokenCapInNear = nearInPool\n          .mul(circulatingSupply)\n          .div(tokenInPool);\n        getNearPrice().then((nearPrice) => {\n          resolve(tokenCapInNear.toNumber() * nearPrice);\n        });\n      });\n    });\n  });\n}\n\nconst intelCap = getMarketCap(\"intel.tkn.near\", INTEL_NEAR_POOL);\nconst nvidiaCap = getMarketCap(\"nearnvidia.near\", NVIDIA_NEAR_POOL);\n\nPromise.all([intelCap, nvidiaCap]).then(([intel, nvidia]) => {\n  setIntelMCap(intel);\n  setNvidiaMCap(nvidia);\n});\n\nreturn intelMCap === undefined ? (\n  \"Loading ...\"\n) : (\n  <>\n    <h1>Are we flipped yet?</h1>\n    {intelMCap > nvidiaMCap ? (\n      <h3>Yes! INTEAR has flipped NEARVIDIA</h3>\n    ) : (\n      <>\n        <h3>\n          Not yet! But INTEAR has achieved{\" \"}\n          {((intelMCap / nvidiaMCap) * 100).toFixed(2)}% progress towards\n          flipping NEARVIDIA\n        </h3>\n        <p>\n          <b>$INTEAR</b> market cap: ${intelMCap.toFixed(2)}\n          <br />\n          <b>$NEARVIDIA</b> market cap: ${nvidiaMCap.toFixed(2)}\n        </p>\n      </>\n    )}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/slimedragon.near/widget/AreWeFlippedYet", "fact_widget_deployments_id": "37dacafae3354b5ea8fc780ed9102284", "inserted_timestamp": "2024-03-23T07:28:56.626Z", "modified_timestamp": "2024-03-23T07:28:56.626Z", "__row_index": 4}