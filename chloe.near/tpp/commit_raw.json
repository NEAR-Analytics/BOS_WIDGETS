{"tx_hash": "EcGWpmXNuLfMNzfkEUPT9oQuCgywjr7iHDHrsTgr7Jhh", "action_id_social": "Haf9XUN4gGv6QvHVzv18cYaYzsnB426vMmojdEhKnyGS-0-widget", "block_id": 101753231, "block_timestamp": "2023-09-23T05:44:59.903Z", "signer_id": "chloe.near", "widget_name": "tpp", "source_code": "const accountId = props.accountId || context.accountId;\n\nconst GameButton = styled.button`\n  background: palevioletred;\n  color: white;\n  font-size: 1em;\n  margin: 10px;\n  padding: 0.5em 1em;\n  border: 2px solid palevioletred;\n  border-radius: 10px;\n  &:hover {\n    background: white;\n    color: palevioletred;\n  }\n`;\n\nif (!accountId) {\n  return (\n    <div>\n      <p>Please connect your NEAR wallet or create a new one:</p>\n      <a href=\"https://near.org/signup\" target=\"_blank\" rel=\"noreferrer\">\n        <GameButton>Create NEAR Wallet</GameButton>\n      </a>\n    </div>\n  );\n}\n\n// This state variable holds the current chainId\nconst [chainId, setChainId] = useState(null);\n\n// Styling for the Wrapper\nconst Wrapper = styled.div`\n  font-family: Arial, sans-serif;\n  text-align: center;\n  margin: 20px;\n  padding: 20px;\n  border: 1px solid #ccc;\n  border-radius: 8px;\n`;\n\n// Function to fetch and set the current chainId from the network\nconst getCurrentChainId = () => {\n  Ethers.provider()\n    .getNetwork()\n    .then(({ chainId }) => {\n      setChainId(chainId);\n    })\n    .catch((error) => {\n      console.error(\"Failed to get chainId:\", error);\n    });\n};\n\n// Function to switch to zkEVM mainnet\nconst switchToMainnet = () => {\n  Ethers.send(\"wallet_switchEthereumChain\", [{ chainId: \"0x44D\" }])\n    .then(() => {\n      setChainId(1101);\n    })\n    .catch((error) => {\n      console.error(\"Failed to switch to mainnet:\", error);\n    });\n};\n\nfunction switchEthereumChain(chainId) {\n  const chainIdHex = `0x${chainId.toString(16)}`;\n  const res = Ethers.send(\"wallet_switchEthereumChain\", [\n    { chainId: chainIdHex },\n  ]);\n  // If `res` === `undefined`, it means switch chain failed, which is very weird but it works.\n  // If `res` is `null` the function is either not called or executed successfully.\n  if (res === undefined) {\n    console.log(\n      `Failed to switch chain to ${chainId}. Add the chain to wallet`\n    );\n    const config = getNetworkConfig(chainId);\n    Ethers.send(\"wallet_addEthereumChain\", [\n      {\n        chainId: chainIdHex,\n        chainName: config.chainName,\n        nativeCurrency: config.nativeCurrency,\n        rpcUrls: [config.rpcUrl],\n      },\n    ]);\n  }\n}\n\nif (\n  state.chainId === undefined &&\n  ethers !== undefined &&\n  Ethers.send(\"eth_requestAccounts\", [])[0]\n) {\n  Ethers.provider()\n    .getNetwork()\n    .then((data) => {\n      const chainId = data?.chainId;\n      const config = getNetworkConfig(chainId);\n      if (!config) {\n        console.log(`Unsupport chain, chainId: ${chainId}`);\n        State.update({ isChainSupported: false });\n        switchEthereumChain(DEFAULT_CHAIN_ID);\n      } else {\n        State.update({ chainId, isChainSupported: true });\n      }\n    });\n}\n\n// Call the function to set the current chainId\ngetCurrentChainId();\n\nreturn (\n  <Wrapper>\n    <div>\n      <h2>Welcome to The People's Place</h2>\n      <h3 style={{ whiteSpace: \"pre-line\" }}>{accountId}</h3>\n      <h1>Current Chain ID: {chainId}</h1>\n      {chainId === 1101 ? (\n        <h3>On Polygon</h3>\n      ) : (\n        <p>Please switch to Polygon zkEVM</p>\n      )}\n    </div>\n    {chainId !== 1101 && (\n      <div>\n        <button onClick={switchToMainnet}>Switch to zkEVM Mainnet</button>\n      </div>\n    )}\n  </Wrapper>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/chloe.near/widget/tpp", "fact_widget_deployments_id": "2d5814b2f1075718cb82e0491a018d47", "inserted_timestamp": "2023-09-23T07:33:27.678Z", "modified_timestamp": "2023-09-23T07:33:27.678Z", "__row_index": 0}