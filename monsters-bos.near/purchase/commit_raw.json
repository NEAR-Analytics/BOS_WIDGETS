{"tx_hash": "5ef3HRD957sYax8f7dLxeBMhSaD8D3Scirdtk765P5zL", "action_id_social": "6TGWvbetdfxbFFLcY15uhaceHExwEh7C2v4yN9c8CNYE-0-widget", "block_id": 103479075, "block_timestamp": "2023-10-16T02:51:27.079Z", "signer_id": "monsters-bos.near", "widget_name": "purchase", "source_code": "//include common\nconst widgetSrc = (component) => {\n  if (context.networkId === \"mainnet\")\n    return `monsters-bos.near/widget/${component}`;\n  else\n    return `monstersdev.testnet/widget/${component}`;\n}\nconst ftContract = (context.networkId === \"mainnet\") ? \"monsters-alpha.near\" : \"dev-1693882284306-75813657022630\";\nconst nftContract = (context.networkId === \"mainnet\") ? \"monsters-nfts.near\" : \"dev-1697387315613-37447934459971\";\nconst alphaPacksRemaining = Near.view(ftContract, \"ft_balance_of\", {account_id: ftContract});\nconst alphaPacksOwned = Near.view(ftContract, \"ft_balance_of\", {account_id: context.accountId});\nconst storageBalance = Near.view(ftContract, \"storage_balance_of\", {account_id: context.accountId});\nconst isRegistered = (storageBalance !== null);\nconst ONE_NEAR = Big(\"1e24\");\nconst openPacksLink = \"https://test.near.org/monstersdev.testnet/widget/openPack\";\nconst error = (context.accountId ? null : \"You must log in!\");\nState.init({packsToBuy: null, estimatedCost: 0, error: error});\n\nconst register = () => {\n  try {\n    // Perform smart contract call to buy packs\n    Near.call(ftContract, 'storage_deposit', {}, Big(\"300000000000000\"), ONE_NEAR/Big(100));\n  } catch (e) {\n    State.update({error:`Error from NEAR: ${e.message}`});\n  }\n}\n\nconst AlphaPurchase = ({ maxBuy, ftContract }) => {\n  const handleInputChange = (e) => {\n    let value = parseInt(e.target.value, 10);\n    if (isNaN(value)) {\n      State.update({error:null, packsToBuy: null, estimatedCost: 0});\n      return;\n    }\n    if (value <= 0) {\n      State.update({error:'Cannot buy less than 1 pack.'});\n      return;\n    }\n    if (value > maxBuy) {\n      State.update({error:'Cannot buy less than 1 pack.'});\n      return;\n    }\n    State.update({error:null, packsToBuy: value, estimatedCost: (value * 4)});\n  };\n\n  const handleSubmit = () => {\n    try {\n      // Perform smart contract call to buy packs\n      Near.call(ftContract, 'purchase', {}, Big(\"300000000000000\"), state.packsToBuy*4*ONE_NEAR+300000000000000);\n      State.update({error:null});\n    } catch (e) {\n      State.update({error:`Error from NEAR: ${e.message}`});\n    }\n  };\n\n  return (\n    <div>\n      {state.error && <p className=\"error\">{state.error}</p>}\n      <label htmlFor=\"packsToBuy\">Number of Packs: </label>\n      <input\n        id=\"packsToBuy\"\n        type=\"number\"\n        value={state.packsToBuy}\n        onChange={handleInputChange}\n      />\n      <button onClick={handleSubmit} disabled={state.error !== null}>Buy Packs</button>\n      <p>Estimated Cost: {state.estimatedCost} NEAR</p>\n    </div>\n  );\n};\n\nreturn (\n  <div className=\"App\">\n    <Widget src={widgetSrc(\"header\")}/>\n    <div class=\"container border border-info p-3\">\n      <h3 class=\"text-center\">\n        <div>\n          <span class=\"text-decoration-underline\">{alphaPacksRemaining}</span> ALPHA packs remaining\n        </div>\n        <div>\n          <span class=\"text-decoration-underline\">{alphaPacksOwned}</span> packs owned\n        </div>\n      </h3>\n      {\n        isRegistered ? (\n          <>\n            <img src=\"https://github.com/martyn/near-monsters/blob/master/logo.jpeg?raw=true\" width={256}/>\n            <AlphaPurchase maxBuy={alphaPacksRemaining} ftContract={ftContract}/>\n            <a href={openPacksLink}>Open Packs</a>\n          </>\n        ) : (\n          <>\n            <img src=\"https://github.com/martyn/near-monsters/blob/master/logo.jpeg?raw=true\" width={256}/>\n            <button onClick={register}>Register</button>\n          </>\n        )\n      }\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/monsters-bos.near/widget/purchase", "fact_widget_deployments_id": "9dd6894ece684396de8a445c383ad9b2", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}