{"tx_hash": "3iwrrFbLDkfiKg8p3omXAncwUpgJoAbdbjRsKt4U9kip", "action_id_social": "EKU8guQmX4yGJcasqKS2XJr7r1SPmxjbuTm3BEZovyHE-0-widget", "block_id": 124527003, "block_timestamp": "2024-07-29T11:21:29.681Z", "signer_id": "beatdao.near", "widget_name": "New-Draft-0", "source_code": "import React, { useState, useEffect } from \"react\";\nimport * as nearAPI from \"near-api-js\";\n\nconst CONTRACT_NAME = \"your-contract-name.testnet\"; // Replace with your actual contract name\n\nfunction App() {\n  const [nearConnection, setNearConnection] = useState(null);\n  const [currentUser, setCurrentUser] = useState(null);\n  const [guestList, setGuestList] = useState([]);\n\n  useEffect(() => {\n    initNear();\n  }, []);\n\n  async function initNear() {\n    const near = await nearAPI.connect({\n      networkId: \"testnet\",\n      nodeUrl: \"https://rpc.testnet.near.org\",\n      walletUrl: \"https://wallet.testnet.near.org\",\n      helperUrl: \"https://helper.testnet.near.org\",\n      explorerUrl: \"https://explorer.testnet.near.org\",\n    });\n\n    const wallet = new nearAPI.WalletConnection(near);\n\n    if (wallet.isSignedIn()) {\n      const user = wallet.getAccountId();\n      setCurrentUser(user);\n    }\n\n    setNearConnection({ near, wallet });\n    fetchGuestList();\n  }\n\n  async function fetchGuestList() {\n    if (!nearConnection) return;\n\n    const contract = new nearAPI.Contract(\n      await nearConnection.near.account(CONTRACT_NAME),\n      CONTRACT_NAME,\n      {\n        viewMethods: [\"get_guest_list\", \"get_total_entries\"],\n        changeMethods: [\"sign_guest_list\"],\n      }\n    );\n\n    const totalEntries = await contract.get_total_entries();\n    const entries = await contract.get_guest_list({\n      from_index: 0,\n      limit: totalEntries,\n    });\n    setGuestList(entries);\n  }\n\n  async function signGuestList() {\n    if (!nearConnection || !currentUser) return;\n\n    const contract = new nearAPI.Contract(\n      await nearConnection.near.account(currentUser),\n      CONTRACT_NAME,\n      {\n        viewMethods: [\"get_guest_list\", \"get_total_entries\"],\n        changeMethods: [\"sign_guest_list\"],\n      }\n    );\n\n    await contract.sign_guest_list(\n      {},\n      \"300000000000000\",\n      nearAPI.utils.format.parseNearAmount(\"0.05\")\n    );\n    fetchGuestList();\n  }\n\n  function handleSignIn() {\n    nearConnection.wallet.requestSignIn(CONTRACT_NAME, \"NEAR Guest List\");\n  }\n\n  function handleSignOut() {\n    nearConnection.wallet.signOut();\n    setCurrentUser(null);\n  }\n\n  return (\n    <div className=\"App\">\n      <h1>NEAR Guest List</h1>\n      {currentUser ? (\n        <>\n          <p>Welcome, {currentUser}!</p>\n          <button onClick={signGuestList}>Sign Guest List</button>\n          <button onClick={handleSignOut}>Sign Out</button>\n        </>\n      ) : (\n        <button onClick={handleSignIn}>Sign In</button>\n      )}\n      <h2>Guest List</h2>\n      <ul>\n        {guestList.map((entry, index) => (\n          <li key={index}>{entry}</li>\n        ))}\n      </ul>\n    </div>\n  );\n}\n\nexport default App;\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/beatdao.near/widget/New-Draft-0", "fact_widget_deployments_id": "567d8d1a1b45fb61837ca1238557e8ee", "inserted_timestamp": "2024-07-29T13:00:29.542Z", "modified_timestamp": "2024-07-29T13:55:58.086Z", "__row_index": 75}