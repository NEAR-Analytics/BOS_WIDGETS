{"tx_hash": "81Ge3bBBC8QWnntQDdyJ5grw3odrvqoa4NHHjh3Ckz9T", "action_id_social": "3gqjbSjynDBdGkZvDijnWky4PA5WqgP7tAuSTwEbmeFt-0-widget", "block_id": 113278791, "block_timestamp": "2024-02-21T09:35:07.992Z", "signer_id": "balaianu.near", "widget_name": "CoretoDRS_RSS_getAccountScores", "source_code": "/*\n * CoretoDRS::RSS::getAccountScores (DEMO) - Get the CoretoDRS scores for an accountId.\n *\n * The CoretoDRS scores are a user's Reputation (TRUST and PERFORMANCE) scores,\n * tracked and calculated by the Coreto Decentralized Reputation System\n * on platforms that are connected to the system.\n *\n * Access the results using the returned object, or\n * by using 'let results = Storage.get(`drs.scores.${accountId}`);'\n *\n * Params\n * - accountId: \"some-valid-account.near\"\n * - source (optional): \"a-valid-source.near\"\n *\n */\n\n// Function for getting an account's Coreto DID\nfunction getAccountDid(accountId) {\n  let response = {\n    data: null,\n    errors: null,\n  };\n\n  // Search for a Coreto DID for the account\n  const getDidResponse = useCache(\n    () =>\n      asyncFetch(\"https://drt.coreto.io/did/get_did\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ account_id: accountId }),\n      }),\n    `getDidResponse_${accountId}`,\n    { subscribe: true }\n  );\n\n  // Handle API call errors\n  if (getDidResponse.ok != true) {\n    response.errors = [\n      {\n        code: 500,\n        message: \"Cound not get a DID for this account.\",\n        body: getDidResponse.body,\n      },\n    ];\n    return response;\n  }\n\n  // Handle response data errors or missing\n  if (\n    getDidResponse.body.length == 0 ||\n    typeof getDidResponse.body !== \"string\"\n  ) {\n    response.errors = [\n      {\n        code: 404,\n        message: \"Cound not find a DID for this account.\",\n        body: getDidResponse.body,\n      },\n    ];\n\n    return response;\n  }\n\n  // Set response data\n  response.data = getDidResponse.body;\n\n  return response;\n}\n\n// Function for getting an account's CoretoDRS\n// scores based on their Coreto DID\nfunction getAccountDidScores(accountDid, source) {\n  let url = `https://rss.coreto.io/api/v1/scores/${accountDid}`;\n  let response = {\n    data: null,\n    errors: null,\n  };\n\n  if (source !== undefined) {\n    url = url + `/sources/${source}`;\n  }\n\n  // Fetch reputation data for the account\n  const getScoresResponse = useCache(\n    () => asyncFetch(url),\n    `getAccountScores_${accountDid}`,\n    { subscribe: true }\n  );\n\n  // Handle API call errors\n  if (getScoresResponse.ok != true) {\n    response.errors = [\n      {\n        code: 500,\n        message: \"Cound not get scores for this account.\",\n        body: getScoresResponse.body,\n      },\n    ];\n    return response;\n  }\n\n  // Handle response data errors or missing\n  if (\n    getScoresResponse.body.length == 0 ||\n    typeof getScoresResponse.body !== \"object\"\n  ) {\n    response.errors = [\n      {\n        code: 500,\n        message: \"Cound not find scores for this account.\",\n        body: getScoresResponse.body,\n      },\n    ];\n    return response;\n  }\n\n  // Set response data\n  response.data = getScoresResponse.body;\n\n  return response;\n}\n\n// Main function for getting an account's CoretoDRS\n// scores based on the user's accountId\nfunction getAccountScores(accountId, source) {\n  let response = {\n    account_id: accountId,\n    data: null,\n    errors: null,\n  };\n\n  // Get the account's Coreto DID\n  let did = getAccountDid(accountId);\n\n  // Handle errors\n  if (did.errors !== null) {\n    response.errors = did.errors;\n    Storage.set(`drs.scores.${accountId}`, response);\n    return response;\n  }\n\n  // Get the account's CoretoDRS scores\n  let scores = getAccountDidScores(did.data, source);\n\n  // Handle errors\n  if (scores.errors !== null) {\n    response.errors = scores.errors;\n    Storage.set(`drs.scores.${accountId}`, response);\n    return response;\n  }\n\n  // Set response data\n  response.data = scores.data;\n  Storage.set(`drs.scores.${accountId}`, response);\n  return response;\n}\n\nreturn { getAccountScores };\n", "metadata": {"image": {}}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/balaianu.near/widget/CoretoDRS_RSS_getAccountScores", "fact_widget_deployments_id": "8ac03070482604682a601dcac24567c0", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 3}