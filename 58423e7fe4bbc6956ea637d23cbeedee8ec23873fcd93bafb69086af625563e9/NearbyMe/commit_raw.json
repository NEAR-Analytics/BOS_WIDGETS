{"tx_hash": "7LuBSSRdi7cFWK5RqPaL5MWKUGJhFhFgT9edQ3q4qMqa", "action_id_social": "42Neziru56xPne7QZ69HqUAD8DXZa5zJnSUgs8XAT4Xz-0-widget", "block_id": 101823565, "block_timestamp": "2023-09-24T04:27:23.220Z", "signer_id": "58423e7fe4bbc6956ea637d23cbeedee8ec23873fcd93bafb69086af625563e9", "widget_name": "NearbyMe", "source_code": "// mocks & constants\nconst apiHost = \"https://collegium.runafter.build\";\nconst deployerAccountId =\n  \"58423e7fe4bbc6956ea637d23cbeedee8ec23873fcd93bafb69086af625563e9\";\nconst places = [\"Lobby\", \"Cafeteria\", \"ConfRoom1\", \"ConfRoom2\"];\n// Props\nconst userAccountId = props.accountId || context.accountId;\nif (!userAccountId) return \"login please...\";\n\n// States\nState.init({\n  place: props.place || 0,\n  users: [],\n  attendees: [],\n});\n// methods\nconst getProfile = (accountId) => {\n  const p = Social.getr(`${accountId}/profile`);\n  const name = p?.name;\n  const image = p?.image;\n  const imageUrl =\n    image && image.ipfs_cid\n      ? `https://ipfs.near.social/ipfs/${image?.ipfs_cid}`\n      : \"https://thewiki.io/static/media/sasha_anon.6ba19561.png\";\n\n  return {\n    name,\n    imageUrl,\n  };\n};\n\n// Sub Components\nconst Theme = styled.div`\n  ${\n    fetch(\n      \"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\"\n    ).body\n  }\n`;\n\nconst Banner = () => (\n  <div className=\"navbar bg-body-tertiary border rounded px-3 mb-3 justify-content-center\">\n    <a className=\"navbar-brand\" href=\"#\">\n      <h2>nearbyme.social</h2>\n    </a>\n  </div>\n);\n\nconst ProfileCard = ({ name, accountId, imageUrl }) => (\n  <a\n    href={`https://near.social/mob.near/widget/ProfilePage?accountId=${accountId}`}\n    style={{ textDecoration: \"none\" }}\n  >\n    <div className=\"navbar bg-body-tertiary border rounded px-3 mb-3\">\n      <div className=\"row\">\n        <div className=\"col-3 mt-4\">\n          <img\n            className=\"profileImage\"\n            src={imageUrl}\n            style={{ height: \"40px\" }}\n          />\n        </div>\n        <div className=\"col-9 pt-3\">\n          <h4>{name}</h4>\n          <p>@{accountId.slice(0, 14)}...</p>\n        </div>\n      </div>\n    </div>\n  </a>\n);\n\nconst BesideUsers = () => {\n  return (\n    <div className=\"row\">\n      {!state.users ||\n        (state.users.filter((accountId) => accountId !== userAccountId)\n          .length === 0 && (\n          <div class=\"fs-5 my-5 w-100 text-center\" style={{ color: \"gray\" }}>\n            {\" \"}\n            There is no users in place{\" \"}\n          </div>\n        ))}\n      {state.users &&\n        state.users\n          .filter((accountId) => accountId !== userAccountId)\n          .map((accountId) => {\n            const { name, imageUrl } = getProfile(accountId);\n            return (\n              <div className=\"col-6\">\n                <ProfileCard\n                  name={name}\n                  accountId={accountId}\n                  imageUrl={imageUrl}\n                />\n              </div>\n            );\n          })}\n    </div>\n  );\n};\n\nconst Attendees = () => {\n  return (\n    <div className=\"row\">\n      {state.attendees &&\n        state.attendees.map((accountId) => {\n          const { name } = getProfile(accountId);\n          return (\n            <div className=\"col-4\">\n              <a\n                href={`https://near.social/mob.near/widget/ProfilePage?accountId=${accountId}`}\n              >\n                <div className=\"navbar bg-body-tertiary border rounded px-3 mb-3 justify-content-center\">\n                  <div className=\"text-truncate\">\n                    {name ?? `0x${accountId.slice(0)}...`}\n                  </div>\n                </div>\n              </a>\n            </div>\n          );\n        })}\n    </div>\n  );\n};\n\nconst beaconAdvertise = () => {\n  asyncFetch(`${apiHost}/room/${state.place}`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Accept: \"application/json\",\n    },\n    cache: \"no-store\",\n    body: JSON.stringify({\n      accountId: userAccountId,\n    }),\n  });\n};\n\nconst BeaconSimulator = () => {\n  return (\n    <div\n      className=\"mb-3 px-1 border\"\n      style={{ borderBottom: \"solid 1px gray\" }}\n    >\n      <div className=\"row\">\n        <div className=\"fs-3\">Beacon Simulator</div>\n        <div className=\"fs-5\">You are in: {places[state.place]}</div>\n      </div>\n      <div className=\"row\">\n        {places &&\n          places.map((location, idx) => (\n            <div key={idx} className=\"col-3 mb-2\">\n              <a\n                href={`https://near.social/${deployerAccountId}/widget/NearbyMe?place=${idx}`}\n              >\n                <div className=\"btn btn-primary w-100\">{location}</div>\n              </a>\n            </div>\n          ))}\n      </div>\n    </div>\n  );\n};\n\nconst { name, imageUrl } = getProfile(userAccountId);\nconst fetchScanned = async () => {\n  asyncFetch(`${apiHost}/room/${state.place}`, {\n    cache: \"no-store\",\n  }).then((res) => {\n    State.update({ users: res.body });\n  });\n};\n\nconst fetchAttendees = async () => {\n  asyncFetch(`${apiHost}/room`, {\n    cache: \"no-store\",\n  }).then((res) => {\n    State.update({ attendees: res.body });\n  });\n};\nuseEffect(() => {\n  fetchScanned();\n  fetchAttendees();\n  setInterval(() => {\n    fetchScanned();\n    beaconAdvertise();\n  }, 3000);\n}, []);\n\nreturn (\n  <Theme>\n    <div className=\"container-fluid mt-3 pb-3\">\n      <BeaconSimulator />\n      <Banner />\n      <ProfileCard name={name} accountId={userAccountId} imageUrl={imageUrl} />\n      <p className=\"fs-3\">Builders nearby me</p>\n      <BesideUsers />\n      <p className=\"fs-3\">Collegium Contest Attendees</p>\n      <Attendees />\n    </div>\n  </Theme>\n);\n", "metadata": {"image": {}}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/58423e7fe4bbc6956ea637d23cbeedee8ec23873fcd93bafb69086af625563e9/widget/NearbyMe", "fact_widget_deployments_id": "d5b3d361aacd58f731bbb6eb9cc729f2", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}