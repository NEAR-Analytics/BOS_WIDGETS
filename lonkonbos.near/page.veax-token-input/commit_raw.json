{"tx_hash": "4WkRxavrgVCzw1Z8s8GxLJDQjMyGTVGBwkB3BMgeXhw6", "action_id_social": "EPdYG5DQWAPoq6k2xDjXe3SA6vZXxm64diYQzRJPp2eX-0-widget", "block_id": 116709364, "block_timestamp": "2024-04-12T20:47:25.079Z", "signer_id": "lonkonbos.near", "widget_name": "page.veax-token-input", "source_code": "const accountId = context.accountId;\r\n\r\nconst REF_FI_CONTRACT = \"v2.ref-finance.near\";\r\n\r\nconst ArrowDown = (\r\n  <svg\r\n    xmlns=\"http://www.w3.org/2000/svg\"\r\n    width=\"14\"\r\n    height=\"8\"\r\n    viewBox=\"0 0 14 8\"\r\n    fill=\"none\"\r\n  >\r\n    <path\r\n      fill-rule=\"evenodd\"\r\n      clip-rule=\"evenodd\"\r\n      d=\"M0.231804 0.359841C0.585368 -0.0644363 1.21593 -0.12176 1.64021 0.231804L7.00003 4.69832L12.3598 0.231804C12.7841 -0.12176 13.4147 -0.0644363 13.7682 0.359841C14.1218 0.784118 14.0645 1.41468 13.6402 1.76825L7.00003 7.30173L0.359841 1.76825C-0.0644363 1.41468 -0.12176 0.784118 0.231804 0.359841Z\"\r\n      fill=\"white\"\r\n    />\r\n  </svg>\r\n);\r\n\r\nconst TokenAmount = styled.div`\r\n  width: 430px;\r\n  @media (max-width: 736px) {\r\n    width: 100%;\r\n  }\r\nbackground:#3f3f3f;\r\nheight:100px;\r\npadding:40px 20px;\r\n  color: white;\r\n  display: flex;\r\n  align-items: center;\r\n`;\r\n\r\nconst Input = styled.input`\r\n  appearance: none;\r\n  outline: none;\r\n  width: 100%;\r\n  background: none;\r\n  border: none;\r\n  font-size: 20px;\r\n  ::placeholder {\r\n    color: #7c7f96;\r\n  }\r\n  text-align:end;\r\n  color: white;\r\n  ::-webkit-outer-spin-button,\r\n  ::-webkit-inner-spin-button {\r\n    -webkit-appearance: none;\r\n  }\r\n  -moz-appearance: textfield;\r\n`;\r\n\r\nconst TokenWrapper = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n  color: white;\r\n  cursor: pointer;\r\n  background-color:rgb(31, 31, 31);\r\n  padding: 10px 20px;\r\n  margin-left:-10px;\r\n  clip-path: polygon(0 0,100% 0,100% 8px,100% 100%,8px 100%,0 calc(100% - 8px));\r\n`;\r\nconst Icon = styled.img`\r\n  height: 26px;\r\n  width: 26px;\r\n  border-radius: 100%;\r\n`;\r\nconst BalanceWrapper = styled.div`\r\n  color: #7c7f96;\r\n  font-size: 12px;\r\n  margin-left: 8px;\r\n  padding-top: 4px;\r\n  display: flex;\r\n  justify-content: space-between;\r\n`;\r\n\r\nconst Wrapper = styled.div`\r\n  position: relative;\r\n  margin-top: 8px;\r\n\r\n`;\r\nconst Symbol = styled.span`\r\n  margin-right: 8px;\r\n  margin-left: 8px;\r\n  font-size: 18px;\r\n`;\r\n\r\n// \u65b0\u589e\u63a5\u53e3\r\nconst accountNum = JSON.parse(\r\n  fetch(\"https://indexer.ref.finance/list-token-price\").body\r\n);\r\nconst getBalanceNum = (token_id) => {\r\n  if (token_id && token_id.toLowerCase() === \"near\") {\r\n    return accountNum[\"wrap.near\"].price;\r\n  }\r\n\r\n  return accountNum[token_id].price;\r\n};\r\n\r\nconst shrinkToken = (value, decimals) => {\r\n  return new Big(value || 0).div(new Big(10).pow(decimals)).toFixed();\r\n};\r\n\r\nconst formatToken = (v) => Math.floor(v * 10_000) / 10_000;\r\n\r\nconst formatTokenBig = (v, decimals) =>\r\n  Math.floor(v * Math.pow(10, Math.min(decimals, 8))) /\r\n  Math.pow(10, Math.min(decimals, 8));\r\n\r\nconst {\r\n  amount,\r\n  setAmount,\r\n  handleSelect,\r\n  disableInput,\r\n  inputOnChange,\r\n  balance,\r\n} = props;\r\n\r\nState.init({\r\n  show: false,\r\n  balance: balance,\r\n  handleClose: () => {\r\n    State.update({\r\n      show: false,\r\n    });\r\n  },\r\n  handleOpen: () => {\r\n    State.update({\r\n      show: true,\r\n    });\r\n  },\r\n});\r\n\r\nconst SelectToken = (\r\n  <Widget\r\n    src={`lonkonbos.near/widget/page.veax-select-token`}\r\n    props={{\r\n      show: state.show || false,\r\n      handleClose: state.handleClose,\r\n      handleSelect: (metadata) => {\r\n        handleSelect(metadata);\r\n        state.handleClose();\r\n      },\r\n    }}\r\n  />\r\n);\r\n\r\nreturn (\r\n  <Wrapper>\r\n    <TokenAmount>\r\n      <TokenWrapper\r\n        onClick={() => {\r\n          state.handleOpen();\r\n        }}\r\n      >\r\n        <Icon src={props.token.icon} />\r\n        <Symbol>{props.token.symbol}</Symbol>\r\n        {ArrowDown}\r\n      </TokenWrapper>\r\n      <Input\r\n        class=\"ref-token-inut\"\r\n        placeholder=\"0.0\"\r\n        onChange={inputOnChange}\r\n        value={\r\n          !!disableInput\r\n            ? !!amount\r\n              ? formatTokenBig(amount, props.token.decimals)\r\n              : \"0\"\r\n            : amount\r\n        }\r\n        disabled={!!disableInput}\r\n      />\r\n    </TokenAmount>\r\n    <BalanceWrapper>\r\n      <div>\r\n        ~${\" \"}\r\n        {formatTokenBig(\r\n          getBalanceNum(props.token.id) * amount,\r\n          props.token.decimals\r\n        )}\r\n      </div>\r\n      <div>Balance: {accountId ? balance : \"-\"}</div>\r\n    </BalanceWrapper>\r\n\r\n    {SelectToken}\r\n  </Wrapper>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/lonkonbos.near/widget/page.veax-token-input", "fact_widget_deployments_id": "81134ceaa4dc6a3862f695b7148bb90a", "inserted_timestamp": "2024-04-12T22:36:04.253Z", "modified_timestamp": "2024-04-12T22:36:04.253Z", "__row_index": 0}