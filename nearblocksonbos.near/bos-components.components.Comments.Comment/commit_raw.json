{"tx_hash": "CnCM5XeyJ2XhbrwK6V8se1vUL28TmnGvtEejdFWnoKnW", "action_id_social": "Hjyie1oZB2HXyXYHKStukvQDR4V2xSmhwijkGrmTqdTK-0-widget", "block_id": 116961869, "block_timestamp": "2024-04-16T10:30:37.446Z", "signer_id": "nearblocksonbos.near", "widget_name": "bos-components.components.Comments.Comment", "source_code": "/**\n * Component: CommentsComment\n * Author: Nearblocks Pte Ltd\n * License: Business Source License 1.1\n * Description: The component displays a single post/comment.\n * @interface Props\n * @param {string} accountId - The identifier of the account associated with the post.\n * @param {string} blockHeight - The block height at which the post was made.\n * @param {Object} post - The content of the post including image and text.\n * @param {string} post.text - The text content of the post.\n * @param {Object} post.image - The image object associated with the post.\n * @param {string} post.image.ipfs_cid - The IPFS CID of the image.\n * @param {string} post.image.url - The URL of the image.\n * @param {string} ownerId - The identifier of the owner of the component.\n */\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction MainComponent({ accountId, blockHeight, post, ownerId }) {\n  const { timeAgo } = VM.require(`${ownerId}/widget/includes.Utils.libs`);\n\n  const BlockHeight = blockHeight === 'now' ? 'now' : parseInt(blockHeight);\n\n  const profile = Social.getr(`${accountId}/profile`);\n  const name = profile.name || 'No-name profile';\n  const title = `@${accountId}`;\n  const [time, setTime] = useState('');\n  const [imageUrl, setImageUrl] = useState('');\n  const [fallbackUrl, _setFallbackUrl] = useState(\n    'https://ipfs.near.social/ipfs/bafkreibmiy4ozblcgv3fm3gc6q62s55em33vconbavfd2ekkuliznaq3zm',\n  );\n\n  useEffect(() => {\n    async function fetchTime() {\n      setTime('Loading');\n      try {\n        asyncFetch(\n          `https://api.near.social/time?blockHeight=${BlockHeight}`,\n        ).then((res) => {\n          if (!res) {\n            return 'Loading';\n          }\n\n          if (!res.ok || res.body === 'null') {\n            return 'unknown';\n          }\n          const timeMs = parseFloat(res.body);\n          const timeInSeconds = Math.floor(timeMs / 1000);\n          return setTime(timeAgo(timeInSeconds));\n        });\n      } catch (error) {\n        console.error('Error fetching time:', error);\n        setTime('Loading');\n      }\n    }\n    fetchTime();\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [BlockHeight]);\n\n  useEffect(() => {\n    if (JSON.stringify(post.image) !== JSON.stringify(imageUrl)) {\n      setImageUrl(post.image);\n    }\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [post.image, imageUrl]);\n\n  function toUrl(image) {\n    return (\n      (image.ipfs_cid\n        ? `https://ipfs.near.social/ipfs/${image.ipfs_cid}`\n        : image.url) || fallbackUrl\n    );\n  }\n\n  const renderPath = (properties) => {\n    return (\n      <Widget\n        key={properties}\n        src={properties.path}\n        props={properties.params}\n      />\n    );\n  };\n  return (\n    <div className=\"flex py-4 border-b dark:border-black-200 px-4\">\n      <div className=\"w-max pr-2\">\n        <img\n          className=\"rounded-full w-10 h-10\"\n          src={`https://i.near.social/magic/${'large'}/https://near.social/magic/img/account/${accountId}`}\n          alt=\"\"\n        />\n      </div>\n      <div className=\"max-sm:!w-min w-fit\">\n        <div className=\"flex max-sm:!flex-col justify-start text-center\">\n          <div className=\"flex relative\">\n            <div className=\"flex justify-start ml-2\">\n              <p className=\"font-semibold dark:text-neargray-10 mr-1\">{name}</p>\n              <Tooltip.Provider>\n                <Tooltip.Root>\n                  <Tooltip.Trigger asChild>\n                    <span className=\"inline-block truncate max-w-[150px] text-gray-600 dark:text-neargray-10 font-thin\">\n                      {title}\n                    </span>\n                  </Tooltip.Trigger>\n                  {!context.accountId && (\n                    <Tooltip.Content\n                      className=\"h-auto absolute max-w-xs bg-black bg-opacity-90 z-10 text-xs text-white p-2 break-words\"\n                      align=\"start\"\n                      side=\"bottom\"\n                    >\n                      {title}\n                    </Tooltip.Content>\n                  )}\n                </Tooltip.Root>\n              </Tooltip.Provider>\n            </div>\n          </div>\n          <p className=\"text-gray-600 dark:text-neargray-10 flex align-middle\">\n            {blockHeight === 'now' ? (\n              'now'\n            ) : (\n              <span className=\"text-muted ml-2\">{time}</span>\n            )}\n          </p>\n        </div>\n\n        <div className=\"container\">\n          <div className=\"top-0 ml-2 dark:text-neargray-10\">\n            <Markdown text={post.text} onPath={renderPath} />\n          </div>\n          {post.image && (\n            <div className=\"w-full flex justify-center text-center\">\n              <img\n                className=\"rounded-lg md:max-w-lg\"\n                src={toUrl(imageUrl)}\n                loading=\"lazy\"\n                alt=\"attached image\"\n                onError={() => {\n                  if (imageUrl !== fallbackUrl) {\n                    State.update({\n                      imageUrl: fallbackUrl,\n                    });\n                  }\n                }}\n              />\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nreturn MainComponent(props, context);", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/nearblocksonbos.near/widget/bos-components.components.Comments.Comment", "fact_widget_deployments_id": "6323eeb44ee1e8be7d0b2d521f13581f", "inserted_timestamp": "2024-04-16T11:30:33.593Z", "modified_timestamp": "2024-04-16T12:40:05.144Z", "__row_index": 7}