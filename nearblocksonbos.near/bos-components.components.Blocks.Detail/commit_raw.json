{"tx_hash": "9rAHydwK2qixpVMzB5tw3J5VbKMUd7wyhZfYLCzJqN3t", "action_id_social": "51Eb2TmgeF5ZeGs8qPp9zfsXZWAihFGsStFirDfuBG2E-0-widget", "block_id": 116948892, "block_timestamp": "2024-04-16T06:11:51.963Z", "signer_id": "nearblocksonbos.near", "widget_name": "bos-components.components.Blocks.Detail", "source_code": "/**\n * Component: BlocksDetail\n * Author: Nearblocks Pte Ltd\n * License: Business Source License 1.1\n * Description: Details of specified blocks on Near Protocol.\n * @interface Props\n * @param {string} [network] - The network data to show, either mainnet or testnet\n * @param {Function} [t] - A function for internationalization (i18n) provided by the next-translate package.\n * @param {string} [hash] -  The block identifier passed as a string.\n * @param {string} ownerId - The identifier of the owner of the component.\n */\n\n\n\n\n\n\n\n\n\n\n\n/* INCLUDE COMPONENT: \"includes/Common/ErrorMessage.jsx\" */\nconst ErrorMessage = ({ icons, message, mutedText }) => {\n  return (\n    <div className=\"text-center py-24\">\n      <div className=\"mb-4 flex justify-center\">\n        <span className=\"inline-block border border-yellow-600 border-opacity-25 bg-opacity-10 bg-yellow-300 text-yellow-500 rounded-full p-4\">\n          {icons}\n        </span>\n      </div>\n      <h3 className=\"h-5 font-bold text-lg text-black\">{message}</h3>\n      <p className=\"mb-0 py-4 font-bold\">{mutedText}</p>\n    </div>\n  );\n};/* END_INCLUDE COMPONENT: \"includes/Common/ErrorMessage.jsx\" */\n/* INCLUDE COMPONENT: \"includes/Common/Skeleton.jsx\" */\n/**\n * @interface Props\n * @param {string} [className] - The CSS class name(s) for styling purposes.\n */\n\n\n\n\n\nconst Skeleton = (props) => {\n  return (\n    <div\n      className={`bg-gray-200  rounded shadow-sm animate-pulse ${props.className}`}\n    ></div>\n  );\n};/* END_INCLUDE COMPONENT: \"includes/Common/Skeleton.jsx\" */\n/* INCLUDE COMPONENT: \"includes/icons/FileSlash.jsx\" */\nconst FileSlash = () => {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      data-name=\"Layer 1\"\n      viewBox=\"0 0 24 24\"\n      height=\"24\"\n      width=\"24\"\n      stroke=\"currentColor\"\n      fill=\"currentColor\"\n      stroke-width=\"0\"\n    >\n      <path d=\"M21.71,20.29l-18-18A1,1,0,0,0,2.29,3.71L4,5.41V19a3,3,0,0,0,3,3H17a3,3,0,0,0,2.39-1.2l.9.91a1,1,0,0,0,1.42,0A1,1,0,0,0,21.71,20.29ZM17,20H7a1,1,0,0,1-1-1V7.41L17.93,19.34A1,1,0,0,1,17,20ZM8.66,4H12V7a3,3,0,0,0,3,3h3v3.34a1,1,0,1,0,2,0V9s0,0,0-.06a1.31,1.31,0,0,0-.06-.27l0-.09a1.07,1.07,0,0,0-.19-.28h0l-6-6h0a1.07,1.07,0,0,0-.28-.19l-.09,0L13.06,2H8.66a1,1,0,0,0,0,2ZM14,5.41,16.59,8H15a1,1,0,0,1-1-1Z\" />\n    </svg>\n  );\n};/* END_INCLUDE COMPONENT: \"includes/icons/FileSlash.jsx\" */\n\n\nfunction MainComponent(props) {\n  const {\n    convertToMetricPrefix,\n    convertToUTC,\n    dollarFormat,\n    gasFee,\n    getTimeAgoString,\n    localFormat,\n  } = VM.require(`${props.ownerId}/widget/includes.Utils.formats`);\n\n  const { getConfig, handleRateLimit, nanoToMilli } = VM.require(\n    `${props.ownerId}/widget/includes.Utils.libs`,\n  );\n\n  const { gasPrice } = VM.require(\n    `${props.ownerId}/widget/includes.Utils.near`,\n  );\n\n  const { network, hash, t } = props;\n  const [isLoading, setIsLoading] = useState(true);\n  const [block, setBlock] = useState(null);\n  const [price, setPrice] = useState('');\n  const [error, setError] = useState(false);\n\n  const config = getConfig ? getConfig(network) : '';\n\n  const Loader = (props) => {\n    return (\n      <div\n        className={`bg-gray-200 h-4 rounded shadow-sm animate-pulse ${props.className}`}\n      ></div>\n    );\n  };\n\n  \n\n\n\n\n  const LinkWrapper = (props) => (\n    <Link href={props.href} className=\"hover:no-underline\">\n      <a className=\"bg-green-500 bg-opacity-10 hover:bg-opacity-100 text-green-500 hover:text-white text-xs px-2 py-1 rounded-xl hover:no-underline\">\n        {props.children}\n      </a>\n    </Link>\n  );\n\n  useEffect(() => {\n    function fetchBlock() {\n      setIsLoading(true);\n      asyncFetch(`${config.backendUrl}blocks/${hash}`)\n        .then(\n          (data\n\n\n\n\n) => {\n            const resp = data?.body?.blocks?.[0];\n            if (data.status === 200) {\n              setError(false);\n              setBlock(resp);\n              setIsLoading(false);\n            } else {\n              handleRateLimit(data, fetchBlock, () => setIsLoading(false));\n            }\n          },\n        )\n        .catch((error) => {\n          if (error) setError(true);\n          setIsLoading(false);\n        });\n    }\n    if (config.backendUrl) {\n      fetchBlock();\n    }\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [config.backendUrl, hash]);\n\n  const date = useMemo(() => {\n    if (block?.block_timestamp) {\n      function fetchPriceAtDate(date) {\n        asyncFetch(`${config.backendUrl}stats/price?date=${date}`).then(\n          (data\n\n\n\n\n) => {\n            const resp = data?.body?.stats[0];\n            if (data.status === 200) {\n              setPrice(resp?.near_price);\n            } else {\n              handleRateLimit(data, () => fetchPriceAtDate(date));\n            }\n          },\n        );\n      }\n      const timestamp = new Date(nanoToMilli(block?.block_timestamp));\n\n      const currentDate = new Date();\n      const currentDay = currentDate.getUTCDate();\n      const currentMonth = currentDate.getUTCMonth() + 1;\n      const currentYear = currentDate.getUTCFullYear();\n\n      const currentDt = `${currentYear}-${\n        currentMonth < 10 ? '0' : ''\n      }${currentMonth}-${currentDay < 10 ? '0' : ''}${currentDay}`;\n\n      const day = timestamp.getUTCDate();\n      const month = timestamp.getUTCMonth() + 1;\n      const year = timestamp.getUTCFullYear();\n\n      const blockDt = `${year}-${month < 10 ? '0' : ''}${month}-${\n        day < 10 ? '0' : ''\n      }${day}`;\n\n      if (currentDt > blockDt) {\n        fetchPriceAtDate(blockDt);\n\n        return blockDt;\n      }\n    }\n    return;\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [block?.block_timestamp]);\n\n  const gasUsed = block?.chunks_agg?.gas_used ?? '';\n  const gasLimit = block?.chunks_agg?.gas_limit ?? '';\n\n  return (\n    <>\n      <div className=\"md:flex items-center justify-between\">\n        {isLoading ? (\n          <div className=\"w-80 max-w-xs px-3 py-5\">\n            <Skeleton className=\"h-7\" />\n          </div>\n        ) : (\n          <h1 className=\"text-xl text-nearblue-600 px-2 py-5\">\n            {t ? (\n              <>\n                {t('blocks:block.heading.0')}\n                <span key={1} className=\"font-semibold\">\n                  {t('blocks:block.heading.1', {\n                    block: block?.block_height\n                      ? localFormat(block?.block_height)\n                      : '',\n                  })}\n                </span>\n              </>\n            ) : (\n              <>\n                Block\n                <span key={1} className=\"font-semibold\">\n                  #{block?.block_height ? localFormat(block?.block_height) : ''}\n                </span>\n              </>\n            )}\n          </h1>\n        )}\n      </div>\n      {error || (!isLoading && !block) ? (\n        <div className=\"text-nearblue-700 text-xs px-2 mb-5\">\n          <div className=\"bg-white soft-shadow rounded-xl pb-1\">\n            <div className=\"text-sm text-nearblue-600 divide-solid divide-gray-200 divide-y\">\n              <ErrorMessage\n                icons={<FileSlash />}\n                message=\"Sorry, We are unable to locate this BlockHash\"\n                mutedText={hash}\n              />\n            </div>\n          </div>\n        </div>\n      ) : (\n        <>\n          <div className=\"bg-white text-sm text-nearblue-600 divide-solid divide-gray-200 divide-y soft-shadow rounded-xl\">\n            {network === 'testnet' && (\n              <div className=\"flex flex-wrap p-4 text-red-500\">\n                {t\n                  ? t('blocks:testnetNotice')\n                  : '[ This is a Testnet block only ]'}\n              </div>\n            )}\n            <div className=\"flex flex-wrap p-4\">\n              <div className=\"w-full md:w-1/4 mb-2 md:mb-0\">\n                {t ? t('blocks:block.height') : 'Block Height'}\n              </div>\n              {isLoading ? (\n                <div className=\"w-full md:w-3/4\">\n                  <Loader className=\"flex w-20\" />\n                </div>\n              ) : (\n                <div className=\"w-full md:w-3/4 font-semibold break-words\">\n                  {block?.block_height\n                    ? localFormat(block?.block_height)\n                    : block?.block_height ?? ''}\n                </div>\n              )}\n            </div>\n            <div className=\"flex flex-wrap p-4\">\n              <div className=\"w-full md:w-1/4 mb-2 md:mb-0\">\n                {t ? t('blocks:block.hash') : 'Hash'}\n              </div>\n              {isLoading ? (\n                <div className=\"w-full md:w-3/4\">\n                  <Loader className=\"flex w-full max-w-xl\" />\n                </div>\n              ) : (\n                <div className=\"w-full md:w-3/4 break-words\">\n                  {block?.block_hash}\n                </div>\n              )}\n            </div>\n\n            <div className=\"flex flex-wrap p-4\">\n              <div className=\"w-full md:w-1/4 mb-2 md:mb-0\">\n                {t ? t('blocks:block.timestamp') : 'Timestamp'}\n              </div>\n              {isLoading ? (\n                <div className=\"w-full md:w-3/4\">\n                  <Loader className=\"flex w-full max-w-sm\" />\n                </div>\n              ) : (\n                <div className=\"w-full md:w-3/4 break-words\">\n                  {block?.block_timestamp &&\n                    `${getTimeAgoString(\n                      nanoToMilli(block?.block_timestamp),\n                    )} (${convertToUTC(\n                      nanoToMilli(block?.block_timestamp),\n                      true,\n                    )}) +UTC`}\n                </div>\n              )}\n            </div>\n            <div className=\"flex flex-wrap p-4\">\n              <div className=\"w-full md:w-1/4 mb-2 md:mb-0\">\n                {t ? t('blocks:block.transactions.0') : 'Transactions'}\n              </div>\n              {isLoading ? (\n                <div className=\"w-full md:w-3/4\">\n                  <Loader className=\"flex w-full max-w-xs\" />\n                </div>\n              ) : (\n                block?.transactions_agg?.count && (\n                  <div className=\"w-full md:w-3/4 break-words\">\n                    {t ? (\n                      <>\n                        <LinkWrapper href={`/txns?block=${block?.block_hash}`}>\n                          {t('blocks:block.transactions.1', {\n                            txns: block?.transactions_agg?.count\n                              ? localFormat(block?.transactions_agg?.count)\n                              : block?.transactions_agg?.count ?? '',\n                          })}\n                        </LinkWrapper>\n                        &nbsp;\n                        {t('blocks:block.transactions.2', {\n                          receipts: block?.receipts_agg?.count\n                            ? localFormat(block?.receipts_agg?.count)\n                            : block?.receipts_agg?.count ?? '',\n                        })}\n                      </>\n                    ) : (\n                      <>\n                        (\n                        <LinkWrapper href={`/txns?block=${block?.block_hash}`}>\n                          {block?.transactions_agg?.count\n                            ? localFormat(block?.transactions_agg?.count)\n                            : block?.transactions_agg?.count ??\n                              '' + ' transactions'}\n                        </LinkWrapper>\n                        ) + `and $\n                        {block?.receipts_agg?.count\n                          ? localFormat(block?.receipts_agg?.count)\n                          : block?.receipts_agg?.count ?? ''}{' '}\n                        receipts`\n                      </>\n                    )}\n                  </div>\n                )\n              )}\n            </div>\n            <div className=\"flex flex-wrap p-4\">\n              <div className=\"w-full md:w-1/4 mb-2 md:mb-0\">\n                {t ? t('blocks:block.author') : 'Author'}\n              </div>\n              {isLoading ? (\n                <div className=\"w-full md:w-3/4\">\n                  <Loader className=\"flex w-full max-w-lg\" />\n                </div>\n              ) : (\n                <div className=\"w-full md:w-3/4 break-words\">\n                  <Link\n                    href={`/address/${block?.author_account_id}`}\n                    className=\"hover:no-underline\"\n                  >\n                    <a className=\"text-green-500 hover:no-underline\">\n                      {block?.author_account_id}\n                    </a>\n                  </Link>\n                </div>\n              )}\n            </div>\n            <div className=\"flex flex-wrap p-4\">\n              <div className=\"w-full md:w-1/4 mb-2 md:mb-0\">\n                {t ? t('blocks:block.gasUsed') : 'GAS Used'}\n              </div>\n              {isLoading ? (\n                <div className=\"w-full md:w-3/4\">\n                  <Loader className=\"flex w-full max-w-lg\" />\n                </div>\n              ) : (\n                <div className=\"w-full md:w-3/4 break-words\">\n                  {gasUsed ? convertToMetricPrefix(gasUsed) + 'gas' : ''}\n                </div>\n              )}\n            </div>\n            <div className=\"flex flex-wrap p-4\">\n              <div className=\"w-full md:w-1/4 mb-2 md:mb-0\">\n                {t ? t('blocks:block.gasLimit') : 'Gas Limit'}\n              </div>\n              {isLoading ? (\n                <div className=\"w-full md:w-3/4\">\n                  <Loader className=\"flex w-full max-w-lg\" />\n                </div>\n              ) : (\n                <div className=\"w-full md:w-3/4 break-words\">\n                  {gasLimit ? convertToMetricPrefix(gasLimit) + 'gas' : ''}\n                </div>\n              )}\n            </div>\n            <div className=\"flex flex-wrap p-4\">\n              <div className=\"w-full md:w-1/4 mb-2 md:mb-0\">\n                {t ? t('blocks:block.gasPrice') : 'GAS Price'}\n              </div>\n              {isLoading ? (\n                <div className=\"w-full md:w-3/4\">\n                  <Loader className=\"flex w-full max-w-lg\" />\n                </div>\n              ) : (\n                <div className=\"w-full md:w-3/4 break-words\">\n                  {block?.gas_price\n                    ? gasPrice(block?.gas_price)\n                    : block?.gas_price ?? ''}\n                </div>\n              )}\n            </div>\n            <div className=\"flex flex-wrap p-4\">\n              <div className=\"w-full md:w-1/4 mb-2 md:mb-0\">\n                {t ? t('blocks:block.gasFee') : 'Gas Fee'}\n              </div>\n              {isLoading ? (\n                <div className=\"w-full md:w-3/4\">\n                  <Loader className=\"flex w-full max-w-lg\" />\n                </div>\n              ) : (\n                <div className=\"w-full md:w-3/4 break-words\">\n                  {gasUsed && block?.gas_price\n                    ? gasFee(gasUsed, block?.gas_price) + ' \u24c3'\n                    : ''}\n                </div>\n              )}\n            </div>\n            <div className=\"flex flex-wrap p-4\">\n              <div className=\"w-full md:w-1/4 mb-2 md:mb-0\">\n                {t ? t('blocks:block.parenthash') : 'Parent Hash'}\n              </div>\n              {isLoading ? (\n                <div className=\"w-full md:w-3/4\">\n                  <Loader className=\"flex w-full max-w-lg\" />\n                </div>\n              ) : (\n                <div className=\"w-full md:w-3/4 break-words\">\n                  <Link\n                    href={`/blocks/${block?.prev_block_hash}`}\n                    className=\"hover:no-underline\"\n                  >\n                    <a className=\"text-green-500 hover:no-underline\">\n                      {block?.prev_block_hash}\n                    </a>\n                  </Link>\n                </div>\n              )}\n            </div>\n            {network === 'mainnet' && date && (\n              <div className=\"flex flex-wrap p-4\">\n                <div className=\"w-full md:w-1/4 mb-2 md:mb-0\">\n                  {t ? t('blocks:block.price') : 'Price'}\n                </div>\n                {isLoading ? (\n                  <div className=\"w-full md:w-3/4\">\n                    <Loader className=\"flex w-full max-w-lg\" />\n                  </div>\n                ) : (\n                  <div className=\"w-full md:w-3/4 break-words\">\n                    {price ? `$${dollarFormat(price)} / \u24c3` : 'N/A'}\n                  </div>\n                )}\n              </div>\n            )}\n            <div className=\"flex flex-wrap p-4\">\n              <div className=\"w-full md:w-1/4 mb-2 md:mb-0\">Shard Number</div>\n              {isLoading ? (\n                <div className=\"w-full md:w-3/4\">\n                  <Loader className=\"flex w-full max-w-lg\" />\n                </div>\n              ) : (\n                <div className=\"w-full md:w-3/4 break-words\">\n                  {localFormat(block?.chunks_agg?.shards)}\n                </div>\n              )}\n            </div>\n          </div>\n        </>\n      )}\n    </>\n  );\n}\n\nreturn MainComponent(props, context);", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/nearblocksonbos.near/widget/bos-components.components.Blocks.Detail", "fact_widget_deployments_id": "a75339ea64129e340da1d3dacdc1fdb2", "inserted_timestamp": "2024-04-16T07:34:10.586Z", "modified_timestamp": "2024-04-16T07:34:10.586Z", "__row_index": 0}