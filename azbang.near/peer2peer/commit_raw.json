{"tx_hash": "GabiEhCLDV1QeZGKn1iPwzqPeH3Xs7RinuE11PzYgQ9N", "action_id_social": "AMY6qwXhVZNEKBfpKwfx9NayFVjytxbfMUWTXnBZmuxi-0-widget", "block_id": 101831005, "block_timestamp": "2023-09-24T07:01:54.777Z", "signer_id": "azbang.near", "widget_name": "peer2peer", "source_code": "State.init({\n  amount: 10,\n});\n\nconst sender = Ethers.send(\"eth_requestAccounts\", [])[0];\nif (!sender) return \"Please login first\";\n\nconst Button = styled.button`\n  color: #fff;\n  font-size: 16px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  background-color: #255ff4;\n  padding: 16px;\n  width: 250px;\n  border-radius: 32px;\n  border: none;\n  text-align: center;\n  font-weight: bold;\n  transition: 0.2s background-color;\n  height: 64px;\n  &:hover {\n    color: #fff;\n    text-decoration: none;\n    background-color: rgb(107 148 255);\n  }\n`;\n\nconst Container = styled.div`\n    display: flex;\n    height: 600px;\n    margin: 48px auto;\n    justify-content: center;\n    flex-direction: column;\n    width: 400px;\n    gap: 16px;\n\n    button {\n      width: 100%;\n    }\n\n    input {\n      height: 56px;\n    }\n\n`;\n\nconst AmountButton = styled(Button)`\n  background-color: ${(p) => (p.selected ? \"green\" : \"#255ff4\")}\n`;\n\nconst CONTRACT = \"0x8c9e6c40d3402480ACE624730524fACC5482798c\";\nconst tokenAddress = \"0x8c9e6c40d3402480ACE624730524fACC5482798c\";\nconst erc20abi = [\"function approve(address _spender, uint _value)\"];\nconst abi = [\n  \"function createPaymentRequest(uint256 amt, bytes32 emailHash)\",\n  \"function getPaymentRequestsByIds(uint256[] memory requestIds) external view returns (PaymentRequest[] memory)\",\n];\n\nconst signer = Ethers.provider().getSigner();\nconst erc20 = new ethers.Contract(tokenAddress, erc20abi, signer);\nconst peer2peer = new ethers.Contract(CONTRACT, abi, signer);\nconst daiDecimal = 18;\n\nconst handleCreate = () => {\n  State.update({ loading: true });\n  const emailHash = ethers.utils.sha256(ethers.utils.toUtf8Bytes(state.amount));\n  const amount = ethers.utils.parseUnits(state.amount.toString(), daiDecimal);\n\n  erc20.approve(CONTRACT, 10).then((tx) => {\n    tx.wait().then(() => {\n      peer2peer.createPaymentRequest(amount, emailHash).then((tx) => {\n        tx.wait().then(() => {\n          State.update({ loading: false });\n        });\n      });\n    });\n  });\n};\n\nreturn (\n  <Container>\n    <input\n      value={state.email}\n      placeholder=\"Enter your Zelly email\"\n      onChange={(e) => State.update({ email: e.target.value })}\n    />\n\n    <div style={{ display: \"flex\", gap: 12 }}>\n      <AmountButton selected onClick={() => State.update({ amount: 10 })}>\n        $10\n      </AmountButton>\n      <AmountButton onClick={() => State.update({ amount: 50 })}>\n        $50\n      </AmountButton>\n      <AmountButton onClick={() => State.update({ amount: 100 })}>\n        $100\n      </AmountButton>\n    </div>\n\n    <Button onClick={() => handleCreate()}>\n      {state.loading ? (\n        <Widget\n          src=\"azbang.near/widget/dots-spinner\"\n          props={{\n            style: {\n              height: 32,\n              display: \"flex\",\n              alignItems: \"center\",\n              margin: \"auto\",\n            },\n          }}\n        />\n      ) : (\n        \"Sell DAI\"\n      )}\n    </Button>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/azbang.near/widget/peer2peer", "fact_widget_deployments_id": "6ef56a21d2942ddb722ea0486c8cb2a9", "inserted_timestamp": "2023-09-24T09:16:17.967Z", "modified_timestamp": "2023-09-24T09:16:17.967Z", "__row_index": 2}