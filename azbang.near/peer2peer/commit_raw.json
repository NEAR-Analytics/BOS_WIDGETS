{"tx_hash": "GaenKg2HabpLwXpoUPaqvh5SX4jpZLTH5dUukrM4gKid", "action_id_social": "5CMKRbjq4uYDb9wYxfu1FoErqvtGTFznsXYhb3fBDPV7-0-widget", "block_id": 101831792, "block_timestamp": "2023-09-24T07:18:50.158Z", "signer_id": "azbang.near", "widget_name": "peer2peer", "source_code": "State.init({\n  amount: \"0.01\",\n});\n\nconst sender = Ethers.send(\"eth_requestAccounts\", [])[0];\nif (!sender) return \"Please login first\";\n\nconst Button = styled.button`\n  color: #fff;\n  font-size: 16px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  background-color: #255ff4;\n  padding: 16px;\n  width: 250px;\n  border-radius: 32px;\n  border: none;\n  text-align: center;\n  font-weight: bold;\n  transition: 0.2s all;\n  height: 64px;\n  &:hover {\n    color: #fff;\n    text-decoration: none;\n    background-color: rgb(107 148 255);\n  }\n`;\n\nconst Container = styled.div`\n    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Nerko+One&display=swap');\n    * {\n      font-family: 'Inter', sans-serif;\n    }\n\n    display: flex;\n    height: 600px;\n    margin: 48px auto;\n    justify-content: center;\n    flex-direction: column;\n    width: 400px;\n    gap: 16px;\n\n    button {\n      width: 100%;\n    }\n\n    input {\n      height: 56px;\n    }\n`;\n\nconst AmountButton = styled(Button)`\n  box-shadow: 0 0 0 0 #fff;\n  height: 48px;\n  &.active {\n    box-shadow: 0 0 0 4px #fff;\n  }\n`;\n\nconst Info = styled.div`\n  padding: 12px;\n  border: 1px solid #ccc;\n  border-radius: 12px;\n  margin-top: -8px;\n  margin-bottom: 24px;\n\n`;\n\nconst CONTRACT = \"0x99726c79719664f68f12274A4Ef432579891C0df\";\nconst tokenAddress = \"0x8c9e6c40d3402480ACE624730524fACC5482798c\";\nconst erc20abi = [\"function approve(address _spender, uint _value)\"];\nconst abi = [\n  \"function createPaymentRequest(uint256 amt, bytes32 emailHash)\",\n  \"function getPaymentRequestsByIds(uint256[] memory requestIds) external view returns (PaymentRequest[] memory)\",\n];\n\nconst signer = Ethers.provider().getSigner();\nconst erc20 = new ethers.Contract(tokenAddress, erc20abi, signer);\nconst peer2peer = new ethers.Contract(CONTRACT, abi, signer);\nconst daiDecimal = 18;\n\nconst handleCreate = () => {\n  State.update({ loading: true });\n  const emailHash = ethers.utils.sha256(ethers.utils.toUtf8Bytes(state.amount));\n  const amount = ethers.utils.parseUnits(state.amount.toString(), daiDecimal);\n\n  erc20.approve(CONTRACT, 10).then((tx) => {\n    tx.wait().then(() => {\n      console.log(\"createPaymentRequest\");\n      peer2peer.createPaymentRequest(10, emailHash).then((tx) => {\n        tx.wait().then(() => {\n          State.update({ loading: false });\n        });\n      });\n    });\n  });\n};\n\nreturn (\n  <Container>\n    <input\n      value={state.email}\n      placeholder=\"Enter your Zelly email\"\n      onChange={(e) => State.update({ email: e.target.value })}\n    />\n\n    <Info>\n      Make sure that you indicate the email that is linked to your Zeally\n      account, at this address validators verify the payment from the buyer\n    </Info>\n\n    <div style={{ display: \"flex\", gap: 12 }}>\n      {[\"0.01\", \"50\", \"100\"].map((amount) => (\n        <AmountButton\n          className={amount == state.amount && \"active\"}\n          onClick={() => State.update({ amount })}\n        >\n          {amount} DAI\n        </AmountButton>\n      ))}\n    </div>\n\n    <Button onClick={() => handleCreate()}>\n      {state.loading ? (\n        <Widget\n          src=\"azbang.near/widget/dots-spinner\"\n          props={{\n            style: {\n              height: 32,\n              display: \"flex\",\n              alignItems: \"center\",\n              margin: \"auto\",\n            },\n          }}\n        />\n      ) : (\n        \"Sell DAI\"\n      )}\n    </Button>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/azbang.near/widget/peer2peer", "fact_widget_deployments_id": "4e0faacca04f2ff3b2429e0052eddf5b", "inserted_timestamp": "2023-09-24T09:26:40.068Z", "modified_timestamp": "2023-09-24T09:26:40.068Z", "__row_index": 5}