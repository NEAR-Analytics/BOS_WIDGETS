{"tx_hash": "DxkHxGsZCFnKo8HeP14fDn3nrFJ4ErUB3zQwss6JxRhQ", "action_id_social": "9MYFQUQGFMunRHwTz2DgHbVf9EnUR3rZjr2QaHRqX31x-0-widget", "block_id": 101791939, "block_timestamp": "2023-09-23T18:29:19.328Z", "signer_id": "azbang.near", "widget_name": "plaid", "source_code": "const PLAID_API = \"http://localhost:3000\";\nState.init({\n  origin: null,\n  selected: null,\n});\n\nconst AppContainer = styled.div`\n  width: 400px;\n  margin: auto;\n  overflow-y: auto;\n  &::-webkit-scrollbar {\n    display: none;\n  }\n`;\n\nconst Transaction = styled.div`\n  padding: 16px;\n  border-radius: 12px;\n  margin: 0 12px 12px;\n  border: 1px solid #ccc;\n  position: relative;\n  cursor: pointer;\n  transition: 0.2s box-shadow;\n  p { margin: 0; }\n\n  &:hover {\n    box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.1);\n  }\n`;\n\nconst Checkbox = styled.div`\n  position: absolute;\n  top: 16px;\n  right: 16px;\n\n  display: block;\n  transition: 0.2s background-color;\n  background-color: transparent;\n  border-radius: 50%;\n  width: 12px;\n  height: 12px;\n\n  &.active {\n    background-color: #255ff4;\n  }\n\n  &::before {\n    content: \"\";\n    display: block;\n    position: absolute;\n    border: 4px solid #255ff4;\n    border-radius: 50%;\n    width: 24px;\n    height: 24px;\n    left: -6px;\n    top: -6px;\n  }\n`;\n\nconst VerifyButton = styled.button`\n  color: #fff;\n  font-size: 16px;\n  display: flex;\n  flex-direction: center;\n  align-items: center;\n  background-color: #255ff4;\n  position: absolute;\n  bottom: 0;\n  padding: 16px;\n  width: 250px;\n  border-radius: 32px;\n  border: none;\n  left: 50%;\n  margin-left: -125px;\n  text-align: center;\n  font-weight: bold;\n  transition: 0.2s background-color;\n  &:hover {\n    color: #fff;\n    text-decoration: none;\n    background-color: rgb(107 148 255);\n  }\n`;\n\nconst accessToken = state.accessToken || Storage.privateGet(\"plaidAccessToken\");\nif (accessToken === null) {\n  return <p>Loading</p>;\n}\n\nif (accessToken) {\n  const response = fetch(`${PLAID_API}/transactions?token=${accessToken}`);\n  if (response.body == null) return <p>Loading</p>;\n\n  const handleVerify = () => {\n    const url = \"https://sandbox.plaid.com/transactions/get\";\n    const tx = response.body.added.find(\n      (t) => t.transaction_id === state.selected\n    );\n\n    console.log({\n      access_token: accessToken,\n      start_date: tx.date,\n      end_date: tx.date,\n    });\n  };\n\n  return (\n    <div>\n      <AppContainer\n        style={{ marginTop: 48, paddingBottom: 24, position: \"relative\" }}\n      >\n        <h4>Plaid x Blockhain</h4>\n        <p>Select payment to verify it on-chain:</p>\n        <AppContainer style={{ height: 500 }}>\n          {response.body.added.map((tx) => (\n            <Transaction\n              key={tx.transaction_id}\n              onClick={() => State.update({ selected: tx.transaction_id })}\n            >\n              <p style={{ fontWeight: \"bold\" }}>{tx.name}</p>\n              <p>\n                {tx.amount} {tx.iso_currency_code}\n              </p>\n              <Checkbox\n                key={tx.transaction_id}\n                onClick={() => State.update({ selected: tx.transaction_id })}\n                className={state.selected === tx.transaction_id && \"active\"}\n              />\n            </Transaction>\n          ))}\n        </AppContainer>\n        <VerifyButton onClick={() => handleVerify()}>\n          <div style={{ margin: \"auto\" }}>Verify transaction</div>\n        </VerifyButton>\n      </AppContainer>\n    </div>\n  );\n}\n\n// Connecting bank\nif (props.public_token) {\n  const response = fetch(`${PLAID_API}/exchange-public-token`, {\n    body: JSON.stringify({ public_token: props.public_token }),\n    headers: { \"Content-Type\": \"application/json\" },\n    method: \"POST\",\n  });\n\n  if (response.ok) {\n    Storage.privateSet(\"plaidAccessToken\", response.body.access_token);\n    State.update({ accessToken: response.body.access_token });\n    return null;\n  }\n}\n\nconst location = `${state.origin}/${context.widgetSrc}`;\nconst src = `\n<script>\nconst origin = document.location.ancestorOrigins[0];\nwindow.top.postMessage(origin, \"*\")\n</script>\n`;\n\nreturn (\n  <div style={{ marginTop: 48 }}>\n    <a href={`${PLAID_API}?return_url=${location}`}>\n      <VerifyButton style={{ position: \"initial\", margin: \"auto\" }}>\n        <span style={{ margin: \"auto\" }}>Connect bank</span>\n      </VerifyButton>\n    </a>\n\n    <iframe\n      style={{ display: \"none\" }}\n      onMessage={(origin) => {\n        console.log(origin);\n        State.update({ origin });\n      }}\n      srcDoc={src}\n    ></iframe>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/azbang.near/widget/plaid", "fact_widget_deployments_id": "0ec95a5efa34846bcf4e9aa9b9dafa7d", "inserted_timestamp": "2023-09-23T20:28:50.302Z", "modified_timestamp": "2023-09-23T20:28:50.302Z", "__row_index": 53}