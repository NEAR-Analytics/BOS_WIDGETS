{"tx_hash": "7isFz8UeyE6DJaxa2Nxh2QDYPfBJwVZ8E3388gVbCBEj", "action_id_social": "9z4X9H4fKXHy4oyLtp8WvtKnrg2T2ANEVzAjqCNk2Krp-0-widget", "block_id": 101785907, "block_timestamp": "2023-09-23T16:33:27.602Z", "signer_id": "azbang.near", "widget_name": "plaid", "source_code": "const PLAID_API = \"http://localhost:3000\";\nState.init({\n  origin: null,\n});\n\nconst renderApp = () => {\n  // Connected!\n  const accessToken =\n    state.accessToken || Storage.privateGet(\"plaidAccessToken\");\n  console.log({ accessToken });\n\n  if (accessToken) {\n    const response = fetch(`${PLAID_API}/transactions?token=${accessToken}`);\n    console.log(response);\n    return <p>Bank connected {accessToken}</p>;\n  }\n\n  // Connecting bank\n  if (props.public_token) {\n    const response = fetch(`${PLAID_API}/exchange-public-token`, {\n      body: JSON.stringify({ public_token: props.public_token }),\n      headers: { \"Content-Type\": \"application/json\" },\n      method: \"POST\",\n    });\n\n    if (response.ok) {\n      Storage.privateSet(\"plaidAccessToken\", response.body.access_token);\n      State.update({ accessToken: response.body.access_token });\n      return <p>Bank connecting...</p>;\n    }\n  }\n\n  const location = `${state.origin}/${context.widgetSrc}`;\n  return <a href={`${PLAID_API}?return_url=${location}`}>Connect bank</a>;\n};\n\nconst src = `\n<script>\nconst origin = document.location.ancestorOrigins[0];\nwindow.top.postMessage(origin, \"*\")\n</script>\n`;\n\nreturn (\n  <div>\n    {state.origin != null && renderApp()}\n    <iframe\n      style={{ display: \"none\" }}\n      onMessage={(origin) => {\n        console.log(origin);\n        State.update({ origin });\n      }}\n      srcDoc={src}\n    ></iframe>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/azbang.near/widget/plaid", "fact_widget_deployments_id": "45e03ad2c889d66db5f677b93a243709", "inserted_timestamp": "2023-09-23T18:32:04.694Z", "modified_timestamp": "2023-09-23T18:32:04.694Z", "__row_index": 32}