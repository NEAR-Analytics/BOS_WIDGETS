{"tx_hash": "784SHXHYUMV63XsBdR6EbEbPsPahM5qwoteEc3oMExK4", "action_id_social": "HmbqDFt2iJKZsEJhZ324baMEtKUgEdvQ6hCekxzi11Z4-0-widget", "block_id": 121157771, "block_timestamp": "2024-06-14T16:36:18.780Z", "signer_id": "builddao.near", "widget_name": "page.proposals.create.FunctionCall", "source_code": "const { Button } = VM.require(\"buildhub.near/widget/components\") || {\n  Button: () => <></>,\n};\nconst { ProposalVisibilityInfoModal } = VM.require(\n  \"builddao.near/widget/page.proposals.VisibilityInfoModal\"\n) || {\n  ProposalVisibilityInfoModal: () => <></>,\n};\nconst DaoSDK = VM.require(\"sdks.near/widget/SDKs.Sputnik.DaoSDK\") || (() => {});\nconst [contract, setContract] = useState(\"\");\nconst [method, setMethod] = useState(\"\");\nconst [args, setArgs] = useState(\"{}\");\nconst [gas, setGas] = useState(180000000000000);\nconst [deposit, setDeposit] = useState(0);\nconst [validatedAddresss, setValidatedAddress] = useState(true);\nconst [text, setText] = useState(\"\");\nconst [editorKey, setEditorKey] = useState(0);\nconst [notificationsData, setNotificationData] = useState(null);\nconst [isInfoModalActive, setInfoModalActive] = useState(false);\nconst bootstrapTheme = props.bootstrapTheme;\nuseEffect(() => {\n  if (!props.item) {\n    return;\n  }\n  const { path, blockHeight } = props.item;\n  setText(`[EMBED](${path}@${blockHeight})`);\n  setEditorKey((editorKey) => editorKey + 1);\n}, [props.item]);\nconst memoizedKey = useMemo((editorKey) => editorKey, [editorKey]);\nconst selectedDAO = props.selectedDAO;\nconst sdk = DaoSDK(selectedDAO);\nif (!sdk) {\n  return <></>;\n}\nconst regex = /.{1}\\.near$/;\nuseEffect(() => {\n  if (regex.test(contract) || contract === \"\") {\n    setValidatedAddress(true);\n  } else {\n    setValidatedAddress(false);\n  }\n}, [contract]);\nconst MarkdownEditor = `\n  html {\n    background: #23242b;\n  }\n  * {\n    border: none !important;\n  }\n  .rc-md-editor {\n    background: #4f5055;\n    border-top: 1px solid #4f5055 !important;\n    border-radius: 8px;\n  }\n  .editor-container {\n    background: #4f5055;\n  }\n  \n  .drop-wrap {\n    \n    border-radius: 0.5rem !important;\n  }\n  .header-list {\n    display: flex;\n    align-items: center;\n  }\n  textarea {\n    background: #23242b !important;\n    color: #fff !important;\n    font-family: sans-serif !important;\n    font-size: 1rem;\n    border: 1px solid #4f5055 !important;\n    border-top: 0 !important;\n    border-radius: 0 0 8px 8px;\n  }\n  .rc-md-navigation {\n    background: #23242b !important;\n    border: 1px solid #4f5055 !important;\n    border-top: 0 !important;\n    border-bottom: 0 !important;\n    border-radius: 8px 8px 0 0;\n  \n    i {\n      color: #cdd0d5;\n    }\n  }\n  .editor-container {\n    border-radius: 0 0 8px 8px;\n  }\n  .rc-md-editor .editor-container .sec-md .input {\n    overflow-y: auto;\n    padding: 8px !important;\n    line-height: normal;\n    border-radius: 0 0 8px 8px;\n  }\n`;\nconst TextareaWrapper = styled.div`\n  display: grid;\n  vertical-align: top;\n  align-items: center;\n  position: relative;\n  align-items: stretch;\n  width: 100%;\n  textarea {\n    display: flex;\n    align-items: center;\n    transition: all 0.3s ease;\n  }\n  textarea::placeholder {\n    padding-top: 4px;\n    font-size: 20px;\n  }\n  textarea:focus::placeholder {\n    font-size: inherit;\n    padding-top: 0px;\n  }\n  &::after,\n  textarea,\n  iframe {\n    width: 100%;\n    min-width: 1em;\n    height: unset;\n    min-height: 3em;\n    font: inherit;\n    margin: 0;\n    resize: none;\n    background: none;\n    appearance: none;\n    border: 0px solid #eee;\n    grid-area: 1 / 1;\n    overflow: hidden;\n    outline: none;\n  }\n  iframe {\n    padding: 0;\n  }\n  textarea:focus,\n  textarea:not(:empty) {\n    border-bottom: 1px solid #eee;\n    min-height: 5em;\n  }\n  &::after {\n    content: attr(data-value) \" \";\n    visibility: hidden;\n    white-space: pre-wrap;\n  }\n  &.markdown-editor::after {\n    padding-top: 66px;\n    font-family: monospace;\n    font-size: 14px;\n  }\n`;\nconst sdkCall = () => {\n  sdk.createFunctionCallProposal({\n    description: text,\n    receiverId: contract,\n    methodName: method,\n    args: args,\n    proposalDeposit: deposit,\n    proposalGas: gas,\n    gas: 180000000000000,\n    deposit: 200000000000000,\n    additionalCalls: notificationsData,\n  });\n};\nconst NotificationSelector = useMemo(() => {\n  return (\n    <Widget\n      loading=\"\"\n      src=\"builddao.near/widget/page.proposals.NotificationRolesSelector\"\n      props={{\n        daoId: selectedDAO,\n        onUpdate: (v) => {\n          setNotificationData(v);\n        },\n        proposalType: \"Function Call\",\n      }}\n    />\n  );\n}, [selectedDAO]);\nreturn (\n  <div className=\"d-flex flex-column\">\n    <div className=\"form-group mb-3\">\n      <label htmlFor=\"contract\">\n        Contract<span className=\"text-danger\">*</span>\n      </label>\n      <input\n        name=\"contract\"\n        id=\"contract\"\n        data-bs-theme={bootstrapTheme}\n        value={contract}\n        onChange={(e) => setContract(e.target.value)}\n        className=\"form-control\"\n      />\n      {!validatedAddresss && (\n        <span className=\"text-danger\" style={{ fontSize: 12 }}>\n          Please check if the NEAR address is valid!\n        </span>\n      )}\n    </div>\n    <div className=\"form-group mb-3\">\n      <label htmlFor=\"method\">\n        Method<span className=\"text-danger\">*</span>\n      </label>\n      <input\n        name=\"method\"\n        id=\"method\"\n        data-bs-theme={bootstrapTheme}\n        value={method}\n        onChange={(e) => setMethod(e.target.value)}\n        className=\"form-control\"\n      />\n    </div>\n    <div className=\"form-group mb-3\">\n      <label htmlFor=\"args\">Arguments (JSON)</label>\n      <textarea\n        name=\"args\"\n        id=\"args\"\n        data-bs-theme={bootstrapTheme}\n        value={args}\n        onChange={(e) => setArgs(e.target.value)}\n        className=\"form-control\"\n      />\n    </div>\n    <div className=\"form-group mb-3\">\n      <label htmlFor=\"gas\">Gas</label>\n      <input\n        name=\"gas\"\n        id=\"gas\"\n        type=\"number\"\n        data-bs-theme={bootstrapTheme}\n        value={gas}\n        onChange={(e) => setGas(e.target.value)}\n        className=\"form-control\"\n      />\n    </div>\n    <div className=\"form-group mb-3\">\n      <label htmlFor=\"deposit\">Deposit</label>\n      <input\n        name=\"deposit\"\n        id=\"deposit\"\n        type=\"number\"\n        data-bs-theme={bootstrapTheme}\n        value={deposit}\n        onChange={(e) => setDeposit(e.target.value)}\n        className=\"form-control\"\n      />\n    </div>\n    <div className=\"form-group mb-3\">\n      <label>Proposal Description</label>\n      <TextareaWrapper\n        className=\"markdown-editor mb-3\"\n        data-value={text || \"\"}\n        key={memoizedKey}\n      >\n        <Widget\n          loading=\"\"\n          src=\"mob.near/widget/MarkdownEditorIframe\"\n          props={{\n            initialText: text,\n            embedCss: props.customCSS || MarkdownEditor,\n            onChange: (v) => {\n              setText(v);\n            },\n          }}\n        />\n      </TextareaWrapper>\n    </div>\n    {NotificationSelector}\n    <div className=\"w-100 d-flex\">\n      <Button\n        disabled={!contract || !method || !validatedAddresss}\n        className=\"ms-auto\"\n        variant=\"primary\"\n        onClick={() => {\n          setInfoModalActive(true);\n        }}\n      >\n        Create\n      </Button>\n      <ProposalVisibilityInfoModal\n        open={isInfoModalActive}\n        setInfoModalActive={setInfoModalActive}\n        sdkCall={sdkCall}\n      />\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/builddao.near/widget/page.proposals.create.FunctionCall", "fact_widget_deployments_id": "fb470ab38d0f6daf4efc7b5916791ffe", "inserted_timestamp": "2024-06-14T17:55:46.860Z", "modified_timestamp": "2024-06-14T17:55:46.860Z", "__row_index": 0}