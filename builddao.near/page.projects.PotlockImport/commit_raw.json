{"tx_hash": "JMdcLJdVtWUnRX29VvhAs5mhVm3MTJyxnNQmUdpFr5z", "action_id_social": "EEwfy68AeuKHdwFF8PtLECrTjjPQzC7NxAuEgXRA1YvS-0-widget", "block_id": 121296970, "block_timestamp": "2024-06-16T15:03:23.544Z", "signer_id": "builddao.near", "widget_name": "page.projects.PotlockImport", "source_code": "const { Button } = VM.require(\"buildhub.near/widget/components\") || {\n  Button: () => <></>,\n};\nconst { getTagsFromSocialProfileData, getTeamMembersFromSocialProfileData } =\n  VM.require(\"potlock.near/widget/utils\") || {\n    getTagsFromSocialProfileData: () => [],\n    getTeamMembersFromSocialProfileData: () => [],\n  };\nconst bootstrapTheme = props.bootstrapTheme || \"dark\";\nlet ListsSDK =\n  VM.require(\"potlock.near/widget/SDK.lists\") ||\n  (() => ({\n    getRegistrations: () => {},\n  }));\nListsSDK = ListsSDK({ env: \"production\" });\nconst allRegistrations = ListsSDK.getRegistrations() || [];\nconst [searchTerm, setSearch] = useState(null);\nconst isRegisteredProject = allRegistrations.find(\n  (registration) => registration.registrant_id === accountId\n);\nconst [showCreateModalProjectId, setShowCreateModalProjectId] = useState(null);\nconst [projects, approvedProjects] = useMemo(() => {\n  allRegistrations.sort((a, b) =>\n    b.status === \"Approved\"\n      ? -1\n      : a.status === \"Approved\"\n      ? 1\n      : a.status.localeCompare(b.status)\n  );\n  allRegistrations.sort((a, b) => b.submitted_ms - a.submitted_ms);\n  const approvedProjects = allRegistrations.filter(\n    (project) => project.status === \"Approved\"\n  );\n  return [allRegistrations, approvedProjects];\n}, allRegistrations);\nconst [filteredProjects, setFilteredProjects] = useState([]);\nuseEffect(() => {\n  if (!filteredProjects.length) {\n    setFilteredProjects(approvedProjects);\n  }\n}, [approvedProjects]);\nconst searchByWords = (searchTerm) => {\n  setSearch(searchTerm);\n  searchTerm = searchTerm.toLowerCase().trim();\n  let results = [];\n  projects.forEach((project) => {\n    const { registrant_id, status } = project;\n    const data = Social.getr(`${registrant_id}/profile`);\n    if (\n      registrant_id.includes(searchTerm) ||\n      status.toLowerCase().includes(searchTerm)\n    ) {\n      results.push(project);\n    } else if (data) {\n      if (\n        data.description.toLowerCase().includes(searchTerm) ||\n        data.name.toLowerCase().includes(searchTerm) ||\n        getTagsFromSocialProfileData(data)\n          .join(\"\")\n          .toLowerCase()\n          .includes(searchTerm) ||\n        getTeamMembersFromSocialProfileData(data)\n          .join(\"\")\n          .toLowerCase()\n          .includes(searchTerm)\n      ) {\n        results.push(project);\n      }\n    }\n  });\n  setFilteredProjects(results);\n};\nconst ProjectList = styled.div`\n  display: grid;\n  gap: 2rem;\n  padding-bottom: 3rem;\n  // For mobile devices (1 column)\n  @media screen and (max-width: 739px) {\n    grid-template-columns: repeat(1, 1fr);\n  }\n  // For tablet devices (2 columns)\n  @media screen and (min-width: 740px) and (max-width: 1023px) {\n    grid-template-columns: repeat(2, 1fr);\n  }\n  // For desktop devices (3 columns)\n  @media screen and (min-width: 1024px) {\n    grid-template-columns: repeat(3, 1fr);\n  }\n`;\nconst Container = styled.div`\n  .error-bg {\n    background-color: #4d4d4d;\n    color: white;\n  }\n`;\nconst Search = useMemo(() => {\n  return (\n    <Widget\n      src={\"builddao.near/widget/page.projects.SearchBar\"}\n      props={{\n        title: sort,\n        numItems: filteredProjects.length,\n        term: searchTerm,\n        itemName: \"project\",\n        onSearch: (value) => {\n          searchByWords(value);\n        },\n      }}\n    />\n  );\n}, [projects, searchTerm]);\nfunction shuffleArray(array) {\n  return array.sort(() => Math.random() - 0.5);\n}\nconst ProjectsComponent = useMemo(() => {\n  const shuffledProjects = shuffleArray(filteredProjects || []);\n  return (\n    <ProjectList>\n      {(shuffledProjects || []).slice(0, 20).map((project) => {\n        return (\n          <Widget\n            src={\"builddao.near/widget/page.projects.PotlockProjectCard\"}\n            loading={\n              <div\n                style={{\n                  width: \"300px\",\n                  height: \"450px\",\n                  borderRadius: \"12px\",\n                  background: \"#23242b\",\n                  boxShadow: \"0px -2px 0px #dbdbdb inset\",\n                  border: \"1px solid #dbdbdb\",\n                }}\n              />\n            }\n            props={{\n              ...props,\n              projectId: project.registrant_id,\n              allowDonate: false,\n              setShowCreateModalProjectId: setShowCreateModalProjectId,\n            }}\n          />\n        );\n      })}\n    </ProjectList>\n  );\n}, [filteredProjects]);\nif (showCreateModalProjectId) {\n  return (\n    <Widget\n      src=\"builddao.near/widget/page.projects.Editor\"\n      loading=\"\"\n      props={{\n        poltlockProjectId: showCreateModalProjectId,\n      }}\n    />\n  );\n}\nreturn (\n  <Container className=\"d-flex flex-column gap-4 p-4\">\n    {Search}\n    {filteredProjects.length === 0 && (\n      <div className=\"error-bg p-3 h6 rounded-3\">\n        {searchTerm\n          ? \"No projects were found for your search query.\"\n          : \"Network issue: Couldn't fetch any projects, please try again later.\"}\n      </div>\n    )}\n    {ProjectsComponent}\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/builddao.near/widget/page.projects.PotlockImport", "fact_widget_deployments_id": "a99c13f4854350faff3ef477b03ccb91", "inserted_timestamp": "2024-06-16T16:54:00.570Z", "modified_timestamp": "2024-06-16T16:54:00.570Z", "__row_index": 0}