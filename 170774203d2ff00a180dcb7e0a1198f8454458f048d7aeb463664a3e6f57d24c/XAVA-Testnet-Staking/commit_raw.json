{"tx_hash": "EuRPL5kHFAUo2oXDeZ8T6dcf87ZB4LksB15cqhwJgheT", "action_id_social": "1c2CU5YvP1RN1en1MAz2hazeGXQfn1fHCfAYFPptiLX-0-widget", "block_id": 95838543, "block_timestamp": "2023-07-06T12:48:47.211Z", "signer_id": "170774203d2ff00a180dcb7e0a1198f8454458f048d7aeb463664a3e6f57d24c", "widget_name": "XAVA-Testnet-Staking", "source_code": "if (state.user === undefined) {\n  State.update({ user: Ethers.send(\"eth_requestAccounts\", [])[0] });\n}\n\nif (!state.user) return <Web3Connect />;\n\nconst XAVA_ADDRESS = \"0x64E7AB33C8764a9285cbd48A3b5977c51D2eE645\";\nconst XAVA_STAKING = \"0x8BeBB9907c72708442BD4195Bd354A9bAdC2a816\";\nconst XAVA_ABIS = fetch(\n  \"https://raw.githubusercontent.com/avalaunch-app/xava-protocol/master/deployments/contract-abis.json\"\n);\nif (!XAVA_ABIS.ok) {\n  return \"loading\";\n}\n\nconst xavaAllocationIface = new ethers.utils.Interface(\n  JSON.parse(XAVA_ABIS.body).fuji.AllocationStaking\n);\n\nconst ERC20_ABI = fetch(\n  \"https://gist.githubusercontent.com/veox/8800debbf56e24718f9f483e1e40c35c/raw/f853187315486225002ba56e5283c1dba0556e6f/erc20.abi.json\"\n);\nif (!ERC20_ABI.ok) {\n  a;\n  return <p>\"Loading\"</p>;\n}\n\n// GET XAVA BALANCE\nconst tokenIface = new ethers.utils.Interface(ERC20_ABI.body);\nconst getXavaBalance = () => {\n  const encodedData = tokenIface.encodeFunctionData(\"balanceOf\", [state.user]);\n\n  return Ethers.provider()\n    .call({\n      to: XAVA_ADDRESS,\n      data: encodedData,\n    })\n    .then((rawBalance) => {\n      const receiverBalanceHex = tokenIface.decodeFunctionResult(\n        \"balanceOf\",\n        rawBalance\n      );\n\n      return Big(receiverBalanceHex.toString())\n        .div(Big(10).pow(18))\n        .toFixed(2)\n        .replace(/\\d(?=(\\d{3})+\\.)/g, \"$&,\");\n    });\n};\n\n// GET STAKED BALANCE\nconst getStakedBalance = () => {\n  const encodedData = xavaAllocationIface.encodeFunctionData(\"deposited\", [\n    0,\n    state.user,\n  ]);\n\n  return Ethers.provider()\n    .call({\n      to: XAVA_STAKING,\n      data: encodedData,\n    })\n    .then((rawBalance) => {\n      const receiverBalanceHex = xavaAllocationIface.decodeFunctionResult(\n        \"deposited\",\n        rawBalance\n      );\n\n      return Big(receiverBalanceHex.toString())\n        .div(Big(10).pow(18))\n        .toFixed(2)\n        .replace(/\\d(?=(\\d{3})+\\.)/g, \"$&,\");\n    });\n};\n\nconst setXavaBalance = () => {\n  getXavaBalance().then((xavaBalance) => {\n    console.log(xavaBalance);\n    State.update({ xavaBalance });\n  });\n};\n\nif (state.xavaBalance === undefined && state.user) {\n  setXavaBalance();\n}\n\nconst setStakedXava = () => {\n  getStakedBalance().then((xavaStaked) => {\n    console.log(xavaStaked);\n    State.update({ xavaStaked });\n  });\n};\n\nif (state.xavaStaked === undefined && state.user) {\n  setStakedXava();\n}\n\nreturn (\n  <div>\n    <p>You have: {state.xavaBalance}XAVA</p>\n    <p>You have staked: {state.xavaStaked} XAVA</p>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/170774203d2ff00a180dcb7e0a1198f8454458f048d7aeb463664a3e6f57d24c/widget/XAVA-Testnet-Staking", "fact_widget_deployments_id": "b9c33b94ea392ca76b2a41085492a0d2", "inserted_timestamp": "2000-01-01T00:00:00.000Z", "modified_timestamp": "2000-01-01T00:00:00.000Z", "__row_index": 3}