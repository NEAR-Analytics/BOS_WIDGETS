{"tx_hash": "BEtwZrkFNS45Z3rPrRs6Gzzc8nnwwanWhYWFoNQcUpwB", "action_id_social": "22KVdBx9hAP1zHB9sfaF5ZwgZwxQkRwKabGMjQ5ZFfFu-0-widget", "block_id": 101580148, "block_timestamp": "2023-09-20T22:15:51.033Z", "signer_id": "harrydhillon.near", "widget_name": "NFTSwap.Order", "source_code": "const accountId = context.accountId;\n\ninitState({ allTransactions: [] });\n\nuseEffect(() => {\n  const allUserTransactionHashes = Near.view(\n    \"swap.genadrop.near\",\n    \"get_hashes_for_owner\",\n    {\n      owner_id: accountId,\n    }\n  );\n\n  const allTransactionData = [];\n\n  allUserTransactionHashes.map((item) => {\n    allTransactionData.push(\n      Near.view(\"swap.genadrop.near\", \"get_transaction_data\", {\n        hash: item,\n      })\n    );\n  });\n\n  function processNFTs(nfts) {\n    let arrayToReturn = [];\n    nfts.map(async (nft) => {\n      const nftContract = nft.contract_id;\n      const tokenId = nft.token_id;\n      const metadata = Near.view(nftContract, \"nft_metadata\", {\n        token_id: tokenId,\n      });\n      const baseUri = metadata.base_uri || \"\";\n\n      const nftMetadata = Near.view(nftContract, \"nft_token\", {\n        token_id: tokenId,\n      });\n      const media = nftMetadata.metadata.media;\n      const image =\n        media.startsWith(\"https\") || media.startsWith(\"http\")\n          ? media\n          : `${baseUri}/${media}`;\n\n      let collection = \"\";\n\n      if (nftContract === \"x.paras.near\") {\n        const response = fetch(\n          `https://api-v2-mainnet.paras.id/token?token_id=${tokenId}`\n        );\n        collection = response.data.results[0].metadata.collection_id;\n      }\n\n      arrayToReturn.push({\n        title: nftMetadata.metadata.title,\n        image: image,\n        token_id: tokenId,\n        contract_id: nftContract,\n        collection: collection ? collection : metadata.name,\n      });\n    });\n    return arrayToReturn;\n  }\n\n  State.update({ allTransactions: allTransactionData });\n\n  const nftData = [];\n  allTransactionData.map((item) => {\n    const senderNFTs = processNFTs(item.sender_nfts);\n    const receiverNFTs = processNFTs(item.receiver_nfts);\n    nftData.push({ senderNFTs, receiverNFTs });\n  });\n  State.update({ nftData });\n}, []);\n\nreturn (\n  <div\n    style={{\n      border: \"1px solid lightgray\",\n      width: \"100%\",\n      borderRadius: 5,\n      padding: 10,\n    }}\n  >\n    <p style={{ marginBottom: 0 }}>Reciever NFT</p>\n    <div\n      style={{\n        border: \"1px solid lightgray\",\n        width: \"100%\",\n        borderRadius: 5,\n        padding: 10,\n      }}\n    ></div>\n    <p style={{ marginBottom: 0, marginTop: 10 }}>Sender NFT</p>\n    <div\n      style={{\n        border: \"1px solid lightgray\",\n        width: \"100%\",\n        borderRadius: 5,\n        padding: 10,\n      }}\n    ></div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/harrydhillon.near/widget/NFTSwap.Order", "fact_widget_deployments_id": "9433ecdf4567fb83907521ed4e4dddb6", "inserted_timestamp": "2023-09-21T00:22:21.588Z", "modified_timestamp": "2023-09-21T00:22:21.588Z", "__row_index": 6}