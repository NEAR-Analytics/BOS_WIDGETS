{"tx_hash": "9ezjmcx8dfwUvYsqEPTM1mqvu2boFwiBLK8yd8ZLa13u", "action_id_social": "6Lfi4FkzDsKWCLDRsNZ4szRADUjA5aj75rpWh18f2E4X-0-widget", "block_id": 101510518, "block_timestamp": "2023-09-19T23:51:05.292Z", "signer_id": "harrydhillon.near", "widget_name": "NFT-Transfer", "source_code": "// add nft transfers here\n// NEED TO FIX SCIENTIFIC NOTION ON PRICE //  ADD ERROR CHECKING for nft contract but preview is enough\nconst amount = \"10000000000000000000000\"; // 0.01 NEAR // amount to list at, by default its for other marketplaces\nconst accountId = context.accountId; // add check for context it\nconst ownerId = \"minorityprogrammers.near\"; // attribution\n\nconst contractId = \"genadrop-contract.nftgen.near\"; // default nft contract\nconst tokenId = \"1679119560198\"; // maybe condtional check if props is eempty // default nft\nconst fewfarmarket = \"market.fewandfar.near\";\nconst tradeportmarket = \"market.tradeport.near\";\n// fewfar link // display button if listed // asking them for format and they are working on a fix // https://fewfar.com/genadrop-single-nft-near/1675689302938/\nconst tradeportLink =\n  \"https://www.tradeport.xyz/near/collection/\" + contractId + \"/\" + tokenId;\n// maybe utilize the helper funciton here\n// const fewfarlink =\nconst default_receiver = \"\"; // default reciver nft for transfers\nconst msg =\n  '{\"price\":' +\n  '\"' +\n  amount +\n  '\"' +\n  ',\"market_type\":\"sale\",\"ft_token_id\":\"near\"}';\n// need to find custom market link to work with\n\nconst nftMetadata = Near.view(contractId, \"nft_metadata\"); // get the contract name\nconst tokenInfo = Near.view(contractId, \"nft_token\", {\n  token_id: tokenId,\n});\n\ninitState({\n  receiverId: default_receiver,\n  offerAmount: 0,\n  validReceiver: true,\n  ownsNFT: false, // change this and check intially\n  transfer: false, // add checkbox for transfer that shows\n  url: image.url,\n  sendNFTS: [],\n  offerNFTS: [],\n  nft: image.nft ?? {}, // from santiago\n});\n\nconst ShadowBOX = styled.div`\n-webkit-box-shadow: -1px 0px 9px 8px rgba(0,0,0,0.03);\n-moz-box-shadow: -1px 0px 9px 8px rgba(0,0,0,0.03);\nbox-shadow: -1px 0px 9px 8px rgba(0,0,0,0.03);\n  border-radius:10px;\n  padding-left: 10px;\n  padding-right: 10px;\n  padding-top:10px;\n  padding-bottom:10px;\n`;\n\nconst ScrollContainer = styled.div`\n  -ms-overflow-style: none;\n  scrollbar-width: none;\n  ::-webkit-scrollbar { \n      display: none;\n  }\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 5px;\n  overflow-x: hidden;\n  overflow-y: scroll;\n  height: 200px;\n  border-radius:5px;\n  padding: 5px;\n  border: 1px solid lightgray;\n`;\n\n/* HELPER FUNCTION */\nfunction isNearAddress(address) {\n  if (typeof address !== \"string\" || address === \"\") {\n    return false;\n  }\n  if (context.accountId === address) {\n    return false;\n  }\n\n  return true;\n}\n\nconsole.log(state);\n\nconst returnBuffer = (data) => {\n  Buffer.from(JSON.stringify(data), \"utf-8\").toString(\"base64\");\n};\n\nconst ConfirmOffer = () => {\n  const generateOfferAndCallContract = () => {\n    const allTransactions = [];\n    if (state.offerAmount && state.offerNFTS.length === 0) {\n      allTransactions.push({\n        contractName: \"v1.havenswap.near\",\n        methodName: \"mass_transfer\",\n        args: {\n          receiver_id: state.receiverId,\n        },\n        gas: 100000000000000,\n        deposit: 1000000000000000000000000 * parseFloat(state.offerAmount),\n      });\n    }\n    if (state.offerNFTS) {\n      state.offerNFTS.map((item) => {\n        allTransactions.push({\n          contractName: \"v1.havenswap.near\",\n          methodName: \"send_offer\",\n          args: {\n            sender_id: accountId,\n            sender_near:\n              `${parseFloat(1000000000000000000000000 * parseFloat(state.offerAmount))}`,\n            sender_nfts: state.sendNFTS.map((item) => ({\n              tokenId: item.tokenId,\n              contractId: item.contractId,\n            })),\n            receiver_id: state.receiverId,\n            receiver_nfts: state.offerNFTS.map((item) => ({\n              tokenId: item.tokenId,\n              contractId: item.contractId,\n            })),\n            is_holder: false,\n          },\n          gas: 100000000000000,\n          deposit: 1000000000000000000000000 * parseFloat(state.offerAmount),\n        });\n      });\n    }\n    if (state.sendNFTS) {\n      state.sendNFTS.map((item) => {\n        allTransactions.push({\n          contractName: item.contractId,\n          methodName: \"nft_transfer\",\n          args: {\n            receiver_id: state.receiverId,\n            token_id: item.tokenId,\n          },\n          gas: 100000000000000,\n          deposit: 1,\n        });\n      });\n    }\n    Near.call(allTransactions);\n    State.update({ isOfferModalOpen: false });\n  };\n\n  return (\n    <div>\n      <div\n        style={{\n          display: \"flex\",\n          alignItems: \"center\",\n          justifyContent: \"space-between\",\n        }}\n      >\n        <h4>Confirm NFT Offer</h4>\n        <button\n          onClick={() => {\n            State.update({ isOfferModalOpen: false });\n          }}\n        >\n          X\n        </button>\n      </div>\n      <p style={{ marginBottom: 5, wordBreak: \"break-all\" }}>\n        Offering: {accountId}\n        <br />\n        near: \u24c3 {state.offerAmount}\n      </p>\n      <ScrollContainer>\n        {state.sendNFTS?.map((item) => (\n          <ShadowBOX\n            style={{\n              width: \"100%\",\n              marginBottom: 10,\n              display: \"flex\",\n              textAlign: \"center\",\n              alignItems: \"center\",\n              justifyContent: \"center\",\n            }}\n          >\n            <div>\n              <img\n                style={{ width: 60, height: 60, borderRadius: 10 }}\n                src={item.media}\n              />\n              <p style={{ marginBottom: 0 }}>Token ID : {item.tokenId}</p>\n              <p style={{ marginBottom: 0, fontSize: 10 }}>\n                NFT Contract : {item.contractId}\n              </p>\n            </div>\n          </ShadowBOX>\n        ))}\n      </ScrollContainer>\n      <p style={{ marginBottom: 5, marginTop: 10, wordBreak: \"break-all\" }}>\n        Receving: {state.receiverId}\n      </p>\n      <ScrollContainer>\n        {state.offerNFTS?.map((item) => (\n          <ShadowBOX\n            style={{\n              width: \"100%\",\n              marginBottom: 10,\n              display: \"flex\",\n              textAlign: \"center\",\n              alignItems: \"center\",\n              justifyContent: \"center\",\n            }}\n          >\n            <div>\n              <img\n                style={{ width: 60, height: 60, borderRadius: 10 }}\n                src={item.media}\n              />\n              <p style={{ marginBottom: 0, fontSize: 12 }}>\n                Token ID : {item.tokenId}\n              </p>\n              <p style={{ marginBottom: 0, fontSize: 10 }}>\n                NFT Contract : {item.contractId}\n              </p>\n            </div>\n          </ShadowBOX>\n        ))}\n      </ScrollContainer>\n      <button onClick={generateOfferAndCallContract} style={{ marginTop: 10 }}>\n        Offer\n      </button>\n    </div>\n  );\n};\n\nconst offerButtonDisabled =\n  (state.sendNFTS.length === 0 && state.offerNFTS.length === 0) ||\n  !isNearAddress(state.receiverId);\n\nconsole.log(state);\n\nreturn (\n  <div>\n    <h1> \ud83d\udecd\ufe0f Transfer NFT </h1>\n    <div style={{ display: \"flex\", gap: \"5px\" }}>\n      <div\n        className=\"p-2\"\n        style={{\n          background: \"#fdfdfd\",\n          border: \"1px solid lightgray\",\n          borderTop: 0,\n          width: \"40%\",\n          borderRadius: \"5px\",\n        }}\n      >\n        <div>\n          <p style={{ wordBreak: \"break-all\" }}>Your Wallet : {accountId} </p>\n          <div className=\"mt-2\">\n            <Widget\n              src={`harrydhillon.near/widget/nft-selector`}\n              props={{\n                selectedNFTS: state.sendNFTS,\n                onChange: (nftDetails) => {\n                  const isInList = !!state.sendNFTS.filter(\n                    ({ tokenId }) => tokenId === nftDetails.tokenId\n                  )?.[0];\n                  console.log(\n                    isInList,\n                    state.sendNFTS.filter(\n                      ({ tokenId }) => tokenId !== nftDetails.tokenId\n                    ),\n                    state.sendNFTS\n                  );\n                  if (isInList) {\n                    State.update({\n                      sendNFTS: state.sendNFTS.filter(\n                        ({ tokenId }) => tokenId !== nftDetails.tokenId\n                      ),\n                    });\n                  } else {\n                    State.update({\n                      sendNFTS: [...state.sendNFTS, nftDetails],\n                    });\n                  }\n                },\n              }}\n            />\n          </div>\n        </div>\n      </div>\n      <div\n        style={{\n          width: \"20%\",\n          padding: 10,\n          border: \"1px solid lightgray\",\n          borderRadius: 10,\n          height: \"fit-content\",\n        }}\n      >\n        <h4>Offer </h4>\n        Instructions:\n        <br />\n        1. Select the NFTs you want to trade.\n        <br />\n        2. Input the recipient's address.\n        <br />\n        3. Select the NFTs you want to receive.\n        <br />\n        4. Click on the \"Offer\" button.\n        <input\n          style={{ marginTop: 10 }}\n          type=\"number\"\n          placeholder=\"amount in near \u24c3\"\n          value={state.offerAmount}\n          onChange={(e) => {\n            State.update({ offerAmount: e.target.value });\n          }}\n        />\n        <input\n          style={{ marginTop: 10 }}\n          placeholder=\"Recipient Address\"\n          value={state.receiverId}\n          onChange={(e) => {\n            State.update({ receiverId: e.target.value });\n          }}\n        />\n        {!isNearAddress(state.receiverId) && (\n          <p style={{ color: \"red\", fontSize: 10, marginBottom: 0 }}>\n            Please enter a valid near wallet address\n          </p>\n        )}\n        <button\n          disabled={offerButtonDisabled}\n          onClick={() => {\n            State.update({ isOfferModalOpen: true });\n          }}\n          style={{ width: \"100%\", marginTop: 15 }}\n        >\n          Offer\n        </button>\n      </div>\n      <div\n        className=\"p-2\"\n        style={{\n          background: \"#fdfdfd\",\n          border: \"1px solid lightgray\",\n          borderTop: 0,\n          width: \"40%\",\n          borderRadius: \"5px\",\n        }}\n      >\n        <div>\n          <p>Recipient{`'`}s Wallet</p>\n          <div className=\"mt-2\">\n            {isNearAddress(state.receiverId) && (\n              <Widget\n                src={`harrydhillon.near/widget/nft-selector`}\n                props={{\n                  selectedNFTS: state.offerNFTS,\n                  accountId: state.receiverId,\n                  onChange: (nftDetails) => {\n                    const isInList = !!state.offerNFTS.filter(\n                      ({ tokenId }) => tokenId === nftDetails.tokenId\n                    )?.[0];\n                    console.log(\n                      isInList,\n                      state.offerNFTS.filter(\n                        ({ tokenId }) => tokenId !== nftDetails.tokenId\n                      ),\n                      state.offerNFTS\n                    );\n                    if (isInList) {\n                      State.update({\n                        offerNFTS: state.offerNFTS.filter(\n                          ({ tokenId }) => tokenId !== nftDetails.tokenId\n                        ),\n                      });\n                    } else {\n                      State.update({\n                        offerNFTS: [...state.offerNFTS, nftDetails],\n                      });\n                    }\n                  },\n                }}\n              />\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <Widget\n      src=\"harrydhillon.near/widget/Keypom.Components.Modal\"\n      props={{\n        children: ConfirmOffer(),\n        isOpen: state.isOfferModalOpen,\n        contentStyles: {\n          style: {\n            overflowX: \"hidden\",\n            width: 600,\n          },\n        },\n      }}\n    />\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/harrydhillon.near/widget/NFT-Transfer", "fact_widget_deployments_id": "7485f27f1dd47d1d81d0f9153e220b16", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 16}