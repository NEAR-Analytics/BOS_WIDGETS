{"tx_hash": "6TtxHuwr5dDRXb83SefXA41wfFUp9Uv4RV4XAT4nrrTw", "action_id_social": "BgJ4rsnqQRML5FGp36ihFx3g9WYERNS76nwgKqTuJXck-0-widget", "block_id": 105164315, "block_timestamp": "2023-11-07T18:11:21.215Z", "signer_id": "astraplusplus.ndctools.near", "widget_name": "DAO.Proposal.Create", "source_code": "const daoId = props.daoId;\nconst accountId = props.accountId ?? context.accountId;\nconst onClose = props.onClose;\n\nconst CoADaoId = props.dev\n    ? \"coa.gwg-testing.near\"\n    : \"congress-coa-v1.ndc-gwg.near\";\nconst VotingBodyDaoId = props.dev\n    ? \"voting-body-v1.gwg-testing.near\"\n    : \"voting-body-v1.ndc-gwg.near\";\nconst TCDaoId = props.dev\n    ? \"tc.gwg-testing.near\"\n    : \"congress-tc-v1.ndc-gwg.near\";\nconst HoMDaoId = props.dev\n    ? \"hom.gwg-testing.near\"\n    : \"congress-hom-v1.ndc-gwg.near\";\nconst registry = props.dev\n    ? \"registry-v1.gwg-testing.near\"\n    : \"registry.i-am-human.near\";\n\nconst isCongressDaoID =\n    props.daoId === HoMDaoId ||\n    props.daoId === CoADaoId ||\n    props.daoId === TCDaoId;\n\nlet permissions = [];\nconst isVotingBodyDao = props.daoId === VotingBodyDaoId;\nconst defaultProposalTypes = [\n    {\n        text: \"Text\",\n        value: \"Vote\"\n    },\n    {\n        text: \"Transfer\",\n        value: \"Transfer\"\n    },\n    {\n        text: \"Function Call\",\n        value: \"FunctionCall\"\n    },\n    {\n        text: \"Add Member To Role\",\n        value: \"AddMemberToRole\"\n    },\n    {\n        text: \"Remove Member From Role\",\n        value: \"RemoveMemberFromRole\"\n    }\n];\n\nconst congressProposalTypes = {\n    [HoMDaoId]: [\n        {\n            text: \"Text\",\n            value: \"Text\"\n        },\n        {\n            text: \"Function Call\",\n            value: \"FunctionCall\"\n        },\n        {\n            text: \"Budget Request\",\n            value: \"Budget\"\n        },\n        {\n            text: \"Motion Request\",\n            value: \"Motion\"\n        },\n        {\n            text: \"Funding Request (Single)\",\n            value: \"FundingRequest\"\n        },\n        {\n            text: \"Funding Request (Recurrent)\",\n            value: \"RecurrentFundingRequest\"\n        }\n    ],\n    [CoADaoId]: [\n        {\n            text: \"Text\",\n            value: \"Text\"\n        },\n        {\n            text: \"Veto House of Merit proposal\",\n            value: \"Veto\"\n        },\n        {\n            text: \"Unban previously banned member\",\n            value: \"FunctionCall\",\n            powerType: \"Unban\"\n        }\n    ],\n    [TCDaoId]: [\n        {\n            text: \"Text\",\n            value: \"Text\"\n        },\n        {\n            text: \"Dismiss member from the house\",\n            value: \"Dismiss\"\n        }\n    ],\n    [VotingBodyDaoId]: [\n        {\n            text: \"Text\",\n            value: \"Text\"\n        },\n        {\n            text: \"Dismiss\",\n            value: \"Dismiss\"\n        },\n        {\n            text: \"Approve Budget\",\n            value: \"ApproveBudget\"\n        },\n        {\n            text: \"Veto big budget item\",\n            value: \"Veto\"\n        },\n        {\n            text: \"Dissolve House\",\n            value: \"Dissolve\"\n        },\n        {\n            text: \"Function Call\",\n            value: \"FunctionCall\"\n        },\n        {\n            text: \"Update Bonds\",\n            value: \"UpdateBonds\"\n        },\n        {\n            text: \"Update Vote Duration\",\n            value: \"UpdateVoteDuration\"\n        }\n    ]\n};\n\nconst proposalTypes =\n    isCongressDaoID || isVotingBodyDao\n        ? congressProposalTypes[props.daoId]\n        : defaultProposalTypes;\n\nState.init({ members: [], proposalTypes, daoId });\n\nfunction convertCapitalLetterToSpace(inputString) {\n    var resultString = inputString.replace(/([A-Z])/g, \" $1\");\n    // Remove leading space if present\n    if (resultString.charAt(0) === \" \") {\n        resultString = resultString.slice(1);\n    }\n    return resultString;\n}\n\n// fetch proposal types for congress dao\nif (isCongressDaoID) {\n    const policy = useCache(\n        () => Near.asyncView(daoId, \"get_members\").then((members) => members),\n        daoId + \"-processed_congress_members\",\n        { subscribe: false }\n    );\n    if (policy === null) return;\n\n    State.update({\n        members: policy.members,\n        showCreateProposal: policy.members?.includes(accountId)\n    });\n}\n\nconst Wrapper = styled.div`\n    margin: 16px auto;\n    width: 100%;\n    max-width: 900px;\n    max-height: 100%;\n    display: flex;\n    flex-direction: column;\n    gap: 24px;\n    overflow-y: auto;\n\n    @media (max-width: 600px) {\n        border-radius: 0;\n    }\n\n    p {\n        line-height: 1.4;\n        font-weight: 400;\n        font-size: 15px;\n        color: #868682;\n        margin: 0;\n    }\n\n    h3 {\n        font-weight: 600;\n        font-size: 24px;\n        color: #1b1b18;\n    }\n\n    h5 {\n        font-size: 12px;\n        font-weight: 400;\n        line-height: 1.2;\n        color: #6c757d;\n    }\n`;\n\nconst CloseButton = styled.button`\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: rgb(27, 27, 24);\n    border-radius: 100px;\n    height: 40px;\n    width: 40px;\n    border: none;\n    margin: 0;\n    font-size: 26px;\n    background-color: rgb(246, 246, 245);\n\n    &:hover {\n        background-color: rgb(243, 243, 242);\n        color: rgb(0, 0, 0);\n    }\n`;\n\nreturn (\n    <Wrapper>\n        <div className=\"d-flex gap-3 flex-wrap\">\n            <div>\n                <h5>DAO</h5>\n                <Widget\n                    src=\"mob.near/widget/Profile.ShortInlineBlock\"\n                    props={{ accountId: daoId, tooltip: true }}\n                />\n            </div>\n            <div>\n                <h5>Proposer</h5>\n                <Widget\n                    src=\"mob.near/widget/Profile.ShortInlineBlock\"\n                    props={{ accountId: accountId, tooltip: true }}\n                />\n            </div>\n        </div>\n        <Widget\n            src={`sking.near/widget/Common.Inputs.Select`}\n            props={{\n                label: \"Proposal Type\",\n                noLabel: false,\n                placeholder: \"Select a Proposal Type\",\n                options: state.proposalTypes,\n                value: state.proposalType,\n                onChange: (proposalType) =>\n                    State.update({ ...state, proposalType }),\n                validate: () => {\n                    if (!state.proposalType) {\n                        throw {\n                            message: \"Please select a Proposal Type\"\n                        };\n                    }\n\n                    if (\n                        !proposalTypes.find(\n                            ({ value }) => state.proposalType.value === value\n                        )\n                    ) {\n                        throw {\n                            message: \"Please select a valid Proposal Type\"\n                        };\n                    }\n                },\n                error: undefined\n            }}\n        />\n\n        <div className=\"d-flex flex-column gap-2\">\n            {[\"Text\", \"Vote\", \"Budget\", \"Motion\"].includes(\n                state.proposalType.value\n            ) && (\n                <Widget\n                    src=\"astraplusplus.ndctools.near/widget/DAO.Proposal.Create.Text\"\n                    props={{\n                        daoId,\n                        onClose,\n                        isCongressDaoID,\n                        isVotingBodyDao,\n                        registry,\n                        dev: props.dev,\n                        powerType: state.proposalType.powerType\n                    }}\n                />\n            )}\n            {state.proposalType.value === \"Transfer\" && (\n                <Widget\n                    src=\"astraplusplus.ndctools.near/widget/DAO.Proposal.Create.Transfer\"\n                    props={{ daoId, onClose }}\n                />\n            )}\n            {state.proposalType.value === \"AddMemberToRole\" && (\n                <Widget\n                    src=\"astraplusplus.ndctools.near/widget/DAO.Proposal.Create.AddMemberToRole\"\n                    props={{ daoId, onClose }}\n                />\n            )}\n            {state.proposalType.value === \"RemoveMemberFromRole\" && (\n                <Widget\n                    src=\"astraplusplus.ndctools.near/widget/DAO.Proposal.Create.RemoveMemberFromRole\"\n                    props={{ daoId, onClose }}\n                />\n            )}\n            {state.proposalType.value === \"FunctionCall\" && (\n                <Widget\n                    src=\"astraplusplus.ndctools.near/widget/DAO.Proposal.Create.FunctionCall\"\n                    props={{\n                        daoId,\n                        onClose,\n                        isCongressDaoID,\n                        registry,\n                        isVotingBodyDao,\n                        dev: props.dev,\n                        powerType: state.proposalType.powerType\n                    }}\n                />\n            )}\n            {(state.proposalType.value === \"FundingRequest\" ||\n                state.proposalType.value === \"RecurrentFundingRequest\") && (\n                <Widget\n                    src=\"astraplusplus.ndctools.near/widget/DAO.Proposal.Create.FundingRequest\"\n                    props={{\n                        daoId,\n                        onClose,\n                        proposalType: state.proposalType.value\n                    }}\n                />\n            )}\n            {state.proposalType.value === \"Veto\" && (\n                <Widget\n                    src=\"astraplusplus.ndctools.near/widget/DAO.Proposal.Create.Veto\"\n                    props={{\n                        daoId,\n                        dev: props.dev,\n                        registry,\n                        isHookCall: props.daoId === CoADaoId\n                    }}\n                />\n            )}\n            {state.proposalType.value === \"Dismiss\" && (\n                <Widget\n                    src=\"astraplusplus.ndctools.near/widget/DAO.Proposal.Create.Dismiss\"\n                    props={{\n                        daoId,\n                        dev: props.dev,\n                        registry,\n                        isHookCall: props.daoId === TCDaoId\n                    }}\n                />\n            )}\n            {state.proposalType.value === \"Dissolve\" && (\n                <Widget\n                    src=\"astraplusplus.ndctools.near/widget/DAO.Proposal.Create.Dissolve\"\n                    props={{\n                        daoId,\n                        dev: props.dev,\n                        registry\n                    }}\n                />\n            )}\n            {state.proposalType.value === \"ApproveBudget\" && (\n                <Widget\n                    src=\"astraplusplus.ndctools.near/widget/DAO.Proposal.Create.ApproveBudget\"\n                    props={{\n                        daoId,\n                        dev: props.dev,\n                        registry\n                    }}\n                />\n            )}\n            {state.proposalType.value === \"UpdateBonds\" && (\n                <Widget\n                    src=\"astraplusplus.ndctools.near/widget/DAO.Proposal.Create.UpdateBonds\"\n                    props={{\n                        daoId,\n                        dev: props.dev,\n                        registry\n                    }}\n                />\n            )}\n            {state.proposalType.value === \"UpdateVoteDuration\" && (\n                <Widget\n                    src=\"astraplusplus.ndctools.near/widget/DAO.Proposal.Create.UpdateVoteDuration\"\n                    props={{\n                        daoId,\n                        dev: props.dev,\n                        registry\n                    }}\n                />\n            )}\n        </div>\n    </Wrapper>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/astraplusplus.ndctools.near/widget/DAO.Proposal.Create", "fact_widget_deployments_id": "5921e92ba89f18947e73a42a739fd70b", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 7}