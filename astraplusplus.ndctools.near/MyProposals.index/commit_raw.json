{"tx_hash": "7vwwDoJ3hFNPt1GYtaXR5AtujBo48975kkGMdbMxDNzg", "action_id_social": "3HxHEBksL2pvxtKLdix3ECjmahpubgmx5bZgyPCYGCKQ-0-widget", "block_id": 116624776, "block_timestamp": "2024-04-11T17:43:04.654Z", "signer_id": "astraplusplus.ndctools.near", "widget_name": "MyProposals.index", "source_code": "const baseApi = \"https://api.pikespeak.ai/daos/proposals-by-proposer\";\nconst publicApiKey = \"36f2b87a-7ee6-40d8-80b9-5e68e587a5b5\";\nconst resPerPage = 20;\nconst accountId = context.accountId;\n\nconst defaultMultiSelectMode = Storage.privateGet(\"multiSelectMode\");\nconst defaultTableView = Storage.privateGet(\"tableView\");\n\nif (defaultMultiSelectMode === null) return \"\";\nif (defaultTableView === null) return \"\";\n\nState.init({\n  page: 0,\n  multiSelectMode: defaultMultiSelectMode ?? false,\n  tableView: defaultTableView ?? false\n});\n\nconst forgeUrl = (apiUrl, params) =>\n  apiUrl +\n  Object.keys(params)\n    .sort()\n    .reduce((paramString, p) => paramString + `${p}=${params[p]}&`, \"?\");\n\nfunction fetchMyProposals() {\n  const resp = fetch(\n    forgeUrl(`${baseApi}/${context.accountId}`, {\n      offset: state.page * resPerPage,\n      limit: resPerPage,\n      proposal_types: state.filters.proposal_types,\n      status: state.filters.status,\n      time_start: state.filters.time_start,\n      time_end: state.filters.time_end\n    }),\n    {\n      mode: \"cors\",\n      headers: {\n        \"x-api-key\": publicApiKey\n      }\n    }\n  );\n\n  return resp;\n}\n\nconst update = (newState) => State.update(newState);\n\nlet res = fetchMyProposals();\n\nfunction hasNextHandler() {\n  const hasNext = false;\n  hasNext = resPerPage === res.body.length;\n  return hasNext;\n}\n\nreturn (\n  <>\n    <div\n      className=\"d-flex align-items-center gap-2 flex-wrap-reverse justify-content-end\"\n      id=\"proposals-top\"\n    >\n      <Widget\n        src=\"nearui.near/widget/Input.Text\"\n        props={{\n          placeholder: \"Search by proposal ID or name\",\n          disabled: true,\n          type,\n          size,\n          icon: (\n            <i\n              className=\"bi bi-search\"\n              style={{\n                color: \"#4F46E5\"\n              }}\n            />\n          ),\n          inputProps: {\n            title: \"Disabled because no API for searching yet\"\n          }\n        }}\n      />\n      <Widget\n        src=\"nearui.near/widget/Input.Button\"\n        props={{\n          children: state.multiSelectMode ? (\n            <>\n              Multi-Vote\n              <i class=\"bi bi-x-lg\"></i>\n            </>\n          ) : (\n            <>\n              Multi-Vote\n              <i class=\"bi bi-card-checklist\"></i>\n            </>\n          ),\n          variant: \"info outline\",\n          size: \"md\",\n          onClick: () => {\n            Storage.privateSet(\"multiSelectMode\", !state.multiSelectMode);\n            State.update({\n              ...state,\n              multiSelectMode: !state.multiSelectMode\n            });\n          }\n        }}\n      />\n      <Widget\n        src=\"nearui.near/widget/Input.Button\"\n        props={{\n          children: (\n            <>\n              Table View\n              {state.tableView ? (\n                <i className=\"bi bi-x-lg\"></i>\n              ) : (\n                <i className=\"bi bi-table\"></i>\n              )}\n            </>\n          ),\n          variant: \"info outline\",\n          size: \"md\",\n          onClick: () => {\n            Storage.privateSet(\"tableView\", !state.tableView);\n            State.update({\n              ...state,\n              tableView: !state.tableView\n            });\n          }\n        }}\n      />\n    </div>\n    {res !== null && !res.body ? (\n      <div className=\"alert alert-danger mt-2\" role=\"alert\">\n        Network issue. Please try again later.\n      </div>\n    ) : (\n      <>\n        <div>\n          {state.tableView ? (\n            <Widget\n              src=\"astraplusplus.ndctools.near/widget/DAO.Proposals.Table.index\"\n              props={{\n                state,\n                resPerPage,\n                proposals: res === null ? null : res.body\n              }}\n            />\n          ) : (\n            <Widget\n              src=\"astraplusplus.ndctools.near/widget/DAO.Proposals.CardsList\"\n              props={{\n                state,\n                resPerPage,\n                proposals: res === null ? null : res.body,\n                showNavButton: true\n              }}\n            />\n          )}\n\n          <div className=\"d-flex justify-content-center my-4\">\n            <Widget\n              src=\"nearui.near/widget/Navigation.PrevNext\"\n              props={{\n                hasPrev: state.page > 0,\n                hasNext: hasNextHandler(),\n                onPrev: () => {\n                  update({\n                    page: state.page - 1\n                  });\n                },\n                onNext: () => {\n                  update({\n                    page: state.page + 1\n                  });\n                },\n                nextHref: `#proposals-top`\n              }}\n            />\n          </div>\n        </div>\n        {state.multiSelectMode && (\n          <>\n            <div\n              style={{\n                height: 180,\n                width: \"100%\"\n              }}\n            ></div>\n            <Widget\n              src=\"astraplusplus.ndctools.near/widget/DAO.Proposals.MultiVote\"\n              props={{\n                daoId: state.daoId,\n                view: \"submit\",\n                onHideMultiSelect: () => {\n                  State.update({\n                    ...state,\n                    multiSelectMode: false\n                  });\n                  Storage.privateSet(\"multiSelectMode\", false);\n                }\n              }}\n            />\n          </>\n        )}\n      </>\n    )}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/astraplusplus.ndctools.near/widget/MyProposals.index", "fact_widget_deployments_id": "2d115c750b01460dc84433fdee4ed160", "inserted_timestamp": "2024-04-11T19:38:43.522Z", "modified_timestamp": "2024-04-11T19:38:43.522Z", "__row_index": 1}