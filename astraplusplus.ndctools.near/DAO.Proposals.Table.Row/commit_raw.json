{"tx_hash": "3Pbx8quZ11NxSrAgXhC4tqZjkD8JFaeHmzgNq95J2JxP", "action_id_social": "7fQRckBo3CMWobm5y5Lim9cZ8MAQxQnmBrFkH3aDJ8RH-0-widget", "block_id": 103147128, "block_timestamp": "2023-10-11T18:49:57.435Z", "signer_id": "astraplusplus.ndctools.near", "widget_name": "DAO.Proposals.Table.Row", "source_code": "const {\n    multiSelectMode,\n    daoId,\n    proposal,\n    proposal_type,\n    proposal_id,\n    i,\n    isAllowedTo,\n    isCongressDaoID\n} = props;\nconst accountId = context.accountId;\n\n// --- check user permissions\nconst proposalKinds = {\n    ChangeConfig: \"config\",\n    ChangePolicy: \"policy\",\n    AddMemberToRole: \"add_member_to_role\",\n    RemoveMemberFromRole: \"remove_member_from_role\",\n    FunctionCall: isCongressDaoID ? \"FunctionCall\" : \"call\",\n    UpgradeSelf: \"upgrade_self\",\n    UpgradeRemote: \"upgrade_remote\",\n    Transfer: \"transfer\",\n    SetStakingContract: \"set_vote_token\",\n    AddBounty: \"add_bounty\",\n    BountyDone: \"bounty_done\",\n    Vote: \"vote\",\n    FactoryInfoUpdate: \"factory_info_update\",\n    ChangePolicyAddOrUpdateRole: \"policy_add_or_update_role\",\n    ChangePolicyRemoveRole: \"policy_remove_role\",\n    ChangePolicyUpdateDefaultVotePolicy: \"policy_update_default_vote_policy\",\n    ChangePolicyUpdateParameters: \"policy_update_parameters\",\n    Text: \"Text\",\n    FundingRequest: \"FundingRequest\",\n    RecurrentFundingRequest: \"RecurrentFundingRequest\"\n};\n\nconst actions = {\n    AddProposal: \"AddProposal\",\n    VoteApprove: \"VoteApprove\",\n    VoteReject: \"VoteReject\",\n    VoteRemove: \"VoteRemove\"\n};\n\nconst kindName =\n    typeof proposal.kind === \"string\"\n        ? proposal.kind\n        : isCongressDaoID\n        ? Object.keys(proposal.kind)?.[0]\n        : typeof proposal.kind.typeEnum === \"string\"\n        ? proposal.kind.typeEnum\n        : Object.keys(proposal.kind)[0];\n\nconst isAllowedToVote = [\n    isAllowedTo(proposalKinds[kindName], actions.VoteApprove),\n    isAllowedTo(proposalKinds[kindName], actions.VoteReject),\n    isAllowedTo(proposalKinds[kindName], actions.VoteRemove)\n];\n\n// --- end check user permissions\n\nconst formatDate = (date) => {\n    date = new Date(Date(date));\n    return `${\n        [\n            \"January\",\n            \"February\",\n            \"March\",\n            \"April\",\n            \"May\",\n            \"June\",\n            \"July\",\n            \"August\",\n            \"September\",\n            \"October\",\n            \"November\",\n            \"December\"\n        ][date.getMonth()]\n    } ${date.getDate()}, ${date.getFullYear()}`;\n};\n\nconst voted = {\n    yes: proposal.votes[accountId || \";;;\"] === \"Approve\",\n    no: proposal.votes[accountId || \";;;\"] === \"Reject\",\n    spam: proposal.votes[accountId || \";;;\"] === \"Remove\"\n};\n\nconst alreadyVoted = voted.yes || voted.no || voted.spam;\n\nconst canVote =\n    isAllowedToVote.every((v) => v) &&\n    proposal.status === \"InProgress\" &&\n    !alreadyVoted;\n\nconst showMultiVote = multiSelectMode && canVote;\n\nfunction renderStatus(statusName) {\n    let statusicon;\n    let statustext;\n    let statusvariant;\n\n    switch (statusName) {\n        case \"Approved\":\n        case \"Vetoed\":\n        case \"Executed\":\n        case \"Accepted\":\n            statusicon = \"bi bi-check-circle\";\n            statustext = statusName;\n            statusvariant = \"success\";\n            break;\n        case \"InProgress\":\n            statusicon = \"spinner-border spinner-border-sm\";\n            statustext = \"Progress\";\n            statusvariant = \"primary\";\n            break;\n        case \"Expired\":\n            statusicon = \"bi bi-x-circle\";\n            statustext = \"Expired\";\n            statusvariant = \"black\";\n            break;\n        case \"Failed\":\n            statusicon = \"bi bi-x-circle\";\n            statustext = \"Failed\";\n            statusvariant = \"black\";\n            break;\n        case \"Rejected\":\n            statusicon = \"bi bi-x-circle\";\n            statustext = \"Rejected\";\n            statusvariant = \"danger\";\n            break;\n    }\n    return (\n        <Widget\n            src=\"nearui.near/widget/Element.Badge\"\n            props={{\n                children: (\n                    <>\n                        <i\n                            className={statusicon}\n                            style={{\n                                fontSize: \"18px\",\n                                marginRight: \"5px\",\n                                borderWidth: \"2px\",\n                                animationDuration: \"8s\"\n                            }}\n                        ></i>\n                        {statustext}\n                    </>\n                ),\n                variant: `${statusvariant} round`,\n                size: \"lg\"\n            }}\n        />\n    );\n}\n\nreturn (\n    <tr\n        style={\n            !!multiSelectMode && !canVote\n                ? {\n                      opacity: 0.6\n                  }\n                : {}\n        }\n    >\n        <th scope=\"row\">\n            <span className=\"id-value\">#{proposal_id}</span>\n        </th>\n        <td>{formatDate(proposal.submission_time)}</td>\n        <td>\n            <Widget\n                src=\"nearui.near/widget/Element.User\"\n                props={{\n                    accountId: proposal.proposer,\n                    options: {\n                        showImage: false,\n                        fontSize: 13\n                    }\n                }}\n            />\n        </td>\n        <td className=\"text-center\">{kindName}</td>\n        <td className=\"text-center\">{renderStatus(proposal.status)}</td>\n\n        {multiSelectMode && (\n            <td className=\"text-center\" style={{ width: 200 }}>\n                <Widget\n                    src=\"astraplusplus.ndctools.near/widget/DAO.Proposals.MultiVote\"\n                    props={{\n                        daoId,\n                        canVote,\n                        proposal,\n                        view: \"multiVote\",\n                        isCongressDaoID\n                    }}\n                />\n            </td>\n        )}\n        <td style={{ width: 150 }}>\n            <div className=\"d-flex justify-content-end\">\n                <Widget\n                    src=\"nearui.near/widget/Layout.Modal\"\n                    props={{\n                        toggle: (\n                            <Widget\n                                src=\"nearui.near/widget/Input.Button\"\n                                props={{\n                                    children: \"More details\",\n                                    variant:\n                                        !!multiSelectMode && !canVote\n                                            ? \"disabled\"\n                                            : \"info\",\n                                    disabled: !!multiSelectMode && !canVote\n                                }}\n                            />\n                        ),\n                        content: (\n                            <div\n                                style={{\n                                    width: 700,\n                                    maxWidth: \"100%\"\n                                }}\n                            >\n                                <Widget\n                                    src=\"astraplusplus.ndctools.near/widget/DAO.Proposals.Card.index\"\n                                    props={{\n                                        daoId: daoId,\n                                        proposalString:\n                                            JSON.stringify(proposal),\n                                        multiSelectMode: state.multiSelectMode,\n                                        isCongressDaoID\n                                    }}\n                                />\n                            </div>\n                        )\n                    }}\n                />\n            </div>\n        </td>\n    </tr>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/astraplusplus.ndctools.near/widget/DAO.Proposals.Table.Row", "fact_widget_deployments_id": "7aec445a6c4e2c5942c2088dbc9cabff", "inserted_timestamp": "2023-10-11T20:42:54.903Z", "modified_timestamp": "2023-10-11T20:42:54.903Z", "__row_index": 4}