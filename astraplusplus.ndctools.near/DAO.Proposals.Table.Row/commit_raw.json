{"tx_hash": "ByWUVnVxmKfjxdcouKAL8NaUsgbBggibhKQXnshFrkhj", "action_id_social": "GFaWRDyrDXvdojLRQP4CvqFmH6fEAAToQqoHqT6deN6E-0-widget", "block_id": 106921897, "block_timestamp": "2023-12-01T09:51:28.343Z", "signer_id": "astraplusplus.ndctools.near", "widget_name": "DAO.Proposals.Table.Row", "source_code": "const {\n    multiSelectMode,\n    daoId,\n    proposal,\n    proposal_type,\n    proposal_id,\n    i,\n    isAllowedTo,\n    isCongressDaoID,\n    daoConfig,\n    isHuman,\n    isVotingBodyDao\n} = props;\nconst accountId = context.accountId;\n\n// --- check user permissions\nconst proposalKinds = {\n    ChangeConfig: \"config\",\n    ChangePolicy: \"policy\",\n    AddMemberToRole: \"add_member_to_role\",\n    RemoveMemberFromRole: \"remove_member_from_role\",\n    FunctionCall: isCongressDaoID ? \"FunctionCall\" : \"call\",\n    UpgradeSelf: \"upgrade_self\",\n    UpgradeRemote: \"upgrade_remote\",\n    Transfer: \"transfer\",\n    SetStakingContract: \"set_vote_token\",\n    AddBounty: \"add_bounty\",\n    BountyDone: \"bounty_done\",\n    Vote: \"vote\",\n    FactoryInfoUpdate: \"factory_info_update\",\n    ChangePolicyAddOrUpdateRole: \"policy_add_or_update_role\",\n    ChangePolicyRemoveRole: \"policy_remove_role\",\n    ChangePolicyUpdateDefaultVotePolicy: \"policy_update_default_vote_policy\",\n    ChangePolicyUpdateParameters: \"policy_update_parameters\",\n    Text: \"Text\",\n    FundingRequest: \"FundingRequest\",\n    RecurrentFundingRequest: \"RecurrentFundingRequest\",\n    DismissAndBan: \"DismissAndBan\"\n};\n\nconst actions = {\n    AddProposal: \"AddProposal\",\n    VoteApprove: \"VoteApprove\",\n    VoteReject: \"VoteReject\",\n    VoteRemove: \"VoteRemove\",\n    VoteAbstain: \"VoteAbstain\"\n};\n\nconst kindName =\n    typeof proposal.kind === \"string\"\n        ? proposal.kind\n        : isCongressDaoID || isVotingBodyDao\n        ? Object.keys(proposal.kind)?.[0]\n        : typeof proposal.kind.typeEnum === \"string\"\n        ? proposal.kind.typeEnum\n        : Object.keys(proposal.kind)[0];\n\nconst isAllowedToVote = isVotingBodyDao\n    ? [isHuman, isHuman, isHuman, isHuman]\n    : [\n          isAllowedTo(proposalKinds[kindName], actions.VoteApprove),\n          isAllowedTo(proposalKinds[kindName], actions.VoteReject),\n          isCongressDaoID\n              ? isAllowedTo(proposalKinds[kindName], actions.VoteAbstain)\n              : isAllowedTo(proposalKinds[kindName], actions.VoteRemove)\n      ];\n\n// --- end check user permissions\n\nconst formatDate = (date) => {\n    date = new Date(parseInt(`${date}`.slice(0, 13)));\n    return `${\n        [\n            \"Jan\",\n            \"Feb\",\n            \"Mar\",\n            \"Apr\",\n            \"May\",\n            \"Jun\",\n            \"Jul\",\n            \"Aug\",\n            \"Sep\",\n            \"Oct\",\n            \"Nov\",\n            \"Dec\"\n        ][date.getMonth()]\n    } ${date.getDate()}, ${date.getFullYear()}`;\n};\n\nfunction checkVotesForCongressDao(value) {\n    if (isCongressDaoID) {\n        return votes[accountId]?.vote === value;\n    } else {\n        return votes[accountId || \";;;\"] === value;\n    }\n}\n\nconst voted = {\n    yes: checkVotesForCongressDao(\"Approve\"),\n    no: checkVotesForCongressDao(\"Reject\"),\n    spam: isVotingBodyDao\n        ? checkVotesForCongressDao(\"Spam\")\n        : checkVotesForCongressDao(\"Remove\"),\n    abstain: checkVotesForCongressDao(\"Abstain\")\n};\n\nconst alreadyVoted = voted.yes || voted.no || voted.spam || voted.abstain;\n\nconst canVote =\n    isAllowedToVote.every((v) => v) &&\n    proposal.status === \"InProgress\" &&\n    !alreadyVoted;\n\nconst showMultiVote = multiSelectMode && canVote;\n\nfunction renderStatus(statusName) {\n    let statusicon;\n    let statustext;\n    let statusvariant;\n\n    switch (statusName) {\n        case \"Approved\":\n        case \"Accepted\":\n            statusicon = \"bi bi-check-circle\";\n            statustext = statusName;\n            statusvariant = \"success\";\n            break;\n        case \"Executed\":\n            statusicon = \"bi bi-play-fill\";\n            statustext = statusName;\n            statusvariant = \"success\";\n            break;\n        case \"In Progress\":\n        case \"InProgress\":\n            statusicon = \"spinner-border spinner-border-sm\";\n            statustext = \"In Progress\";\n            statusvariant = \"primary\";\n            break;\n        case \"Vetoed\":\n            statusicon = \"bi bi-x-circle\";\n            statustext = \"Vetoed\";\n            statusvariant = \"black\";\n            break;\n        case \"Expired\":\n            statusicon = \"bi bi-clock\";\n            statustext = \"Expired\";\n            statusvariant = \"black\";\n            break;\n        case \"Failed\":\n            statusicon = \"bi bi-x-circle\";\n            statustext = \"Failed\";\n            statusvariant = \"black\";\n            break;\n        case \"Rejected\":\n            statusicon = \"bi bi-ban\";\n            statustext = \"Rejected\";\n            statusvariant = \"danger\";\n            break;\n        case \"PreVote\":\n        case \"Pre Vote\":\n            statusicon = \"bi bi-hourglass-split\";\n            statustext = \"Pre Vote\";\n            statusvariant = \"disabled\";\n            break;\n    }\n    return (\n        <Widget\n            src=\"nearui.near/widget/Element.Badge\"\n            props={{\n                children: (\n                    <>\n                        <i\n                            className={statusicon}\n                            style={{\n                                fontSize: \"16px\",\n                                marginRight: \"5px\",\n                                borderWidth: \"2px\",\n                                animationDuration: \"3s\"\n                            }}\n                        ></i>\n                        {statustext}\n                    </>\n                ),\n                variant: `${statusvariant} round`,\n                size: \"lg\"\n            }}\n        />\n    );\n}\n\nconst DescriptionContainer = styled.td`\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n    -webkit-line-clamp: 3;\n    width: 90%;\n`;\n\nconst execProposal = ({ daoId, proposal_id }) =>\n    Near.call(daoId, \"execute\", { id: proposal_id }, 300000000000000);\n\nreturn (\n    <tr\n        style={\n            !!multiSelectMode && !canVote\n                ? {\n                      opacity: 0.6\n                  }\n                : {}\n        }\n    >\n        <th scope=\"row\">\n            <span className=\"id-value\">#{proposal_id}</span>\n        </th>\n        <td>{formatDate(proposal.submission_time)}</td>\n        <td>\n            <Widget\n                src=\"mob.near/widget/Profile.ShortInlineBlock\"\n                props={{\n                    accountId: proposal.proposer,\n                    tooltip: true\n                }}\n            />\n        </td>\n        <td className=\"text-center\">{kindName}</td>\n        <DescriptionContainer\n            style={{\n                display: proposal.description?.length < 200 ? \"\" : \"-webkit-box\"\n            }}\n        >\n            {proposal.description}\n        </DescriptionContainer>\n        <td className=\"text-center\">\n            {isVotingBodyDao\n                ? proposal.status === \"PreVote\"\n                    ? proposal?.support ?? 0\n                    : (proposal?.approve ?? 0) +\n                      (proposal?.reject ?? 0) +\n                      (proposal?.spam ?? 0) +\n                      (proposal?.abstain ?? 0)\n                : Object.keys(proposal.votes ?? {}).length}\n        </td>\n        <td className=\"text-center\">{renderStatus(proposal.status)}</td>\n\n        {multiSelectMode && (\n            <td className=\"text-center\" style={{ width: 200 }}>\n                <Widget\n                    src=\"astraplusplus.ndctools.near/widget/DAO.Proposals.MultiVote\"\n                    props={{\n                        daoId,\n                        canVote,\n                        proposal,\n                        view: \"multiVote\",\n                        isCongressDaoID,\n                        isVotingBodyDao,\n                        dev: props.dev\n                    }}\n                />\n            </td>\n        )}\n        <td style={{ width: 150 }}>\n            <div className=\"d-flex justify-content-end gap-2\">\n                {(isCongressDaoID || isVotingBodyDao) &&\n                    proposal.status === \"Approved\" &&\n                    proposal?.submission_time +\n                        (daoConfig?.vote_duration ??\n                            daoConfig?.voting_duration) +\n                        (daoConfig?.cooldown ?? 0) < // cooldown is not available in vb\n                        Date.now() && (\n                        <Widget\n                            src=\"nearui.near/widget/Input.Button\"\n                            props={{\n                                variant: \"primary icon\",\n                                children: <i class=\"bi bi-caret-right-fill\" />,\n                                onClick: () =>\n                                    execProposal({ daoId, proposal_id })\n                            }}\n                        />\n                    )}\n                <Widget\n                    src=\"astraplusplus.ndctools.near/widget/Layout.Modal\"\n                    props={{\n                        toggle: (\n                            <Widget\n                                src=\"nearui.near/widget/Input.Button\"\n                                props={{\n                                    children: \"More details\",\n                                    variant:\n                                        !!multiSelectMode && !canVote\n                                            ? \"disabled\"\n                                            : \"info\",\n                                    disabled: !!multiSelectMode && !canVote\n                                }}\n                            />\n                        ),\n                        modalWidth: \"1000px\",\n                        content: (\n                            <div\n                                style={{\n                                    width: 1000,\n                                    maxWidth: \"100%\"\n                                }}\n                            >\n                                <Widget\n                                    src=\"astraplusplus.ndctools.near/widget/DAO.Proposals.Card.index\"\n                                    props={{\n                                        daoId: daoId,\n                                        proposalString:\n                                            JSON.stringify(proposal),\n                                        multiSelectMode: state.multiSelectMode,\n                                        isCongressDaoID,\n                                        isVotingBodyDao,\n                                        daoConfig,\n                                        dev: props.dev\n                                    }}\n                                />\n                            </div>\n                        )\n                    }}\n                />\n            </div>\n        </td>\n    </tr>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/astraplusplus.ndctools.near/widget/DAO.Proposals.Table.Row", "fact_widget_deployments_id": "34764a4ea276c10a3ebb74e14878f739", "inserted_timestamp": "2023-12-01T11:42:59.804Z", "modified_timestamp": "2023-12-20T03:02:01.702Z", "__row_index": 2}