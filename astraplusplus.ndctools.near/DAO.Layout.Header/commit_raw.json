{"tx_hash": "7fXvEQUzsiF2Euhh4o9Cc2pei2G2Jny87p2iHDuVY6tH", "action_id_social": "o224uxtHy4pWbsHdPfFVaKKPP7U85C3Sdf3bjUQRrK5-0-widget", "block_id": 112390615, "block_timestamp": "2024-02-08T14:30:47.840Z", "signer_id": "astraplusplus.ndctools.near", "widget_name": "DAO.Layout.Header", "source_code": "const daoId = props.daoId;\nconst profile = daoId ? Social.get(`${daoId}/profile/**`, \"final\") : {};\nconst currentLink = `#/astraplusplus.ndctools.near/widget/home?page=dao&daoId=${daoId}`;\nconst accountId = context.accountId;\n\nconst CoADaoId = props.dev\n  ? \"coa.gwg-testing.near\"\n  : \"congress-coa-v1.ndc-gwg.near\";\nconst VotingBodyDaoId = props.dev\n  ? \"voting-body-v1.gwg-testing.near\"\n  : \"voting-body-v1.ndc-gwg.near\";\nconst TCDaoId = props.dev\n  ? \"tc.gwg-testing.near\"\n  : \"congress-tc-v1.ndc-gwg.near\";\nconst HoMDaoId = props.dev\n  ? \"hom.gwg-testing.near\"\n  : \"congress-hom-v1.ndc-gwg.near\";\n\nconst isCongressDaoID =\n  daoId === HoMDaoId || daoId === CoADaoId || daoId === TCDaoId;\n\nconst isVotingBodyDao = daoId === VotingBodyDaoId;\nState.init({\n  joinRole: \"council\"\n});\n\n// Follower Count:\nconst following = Social.keys(`${daoId}/graph/follow/*`, \"final\", {\n  return_type: \"BlockHeight\",\n  values_only: true\n});\nconst followers = Social.keys(`*/graph/follow/${daoId}`, \"final\", {\n  return_type: \"BlockHeight\",\n  values_only: true\n});\nconst followingCount = following\n  ? Object.keys(following[daoId].graph.follow || {}).length\n  : null;\n\nconst followersCount = followers ? Object.keys(followers || {}).length : null;\n\nconst policy = useCache(\n  () =>\n    Near.asyncView(daoId, \"get_policy\").then((policy) => {\n      return {\n        policy\n      };\n    }),\n  daoId + \"-policy\",\n  { subscribe: false }\n);\n\nconst config = useCache(\n  () =>\n    Near.asyncView(daoId, \"get_config\").then((config) => ({\n      ...config,\n      metadata: config.metadata\n        ? JSON.parse(Buffer.from(config.metadata, \"base64\").toString())\n        : null\n    })),\n  daoId + \"-config\",\n  { subscribe: false }\n);\n\nif (policy === null || config === null) return \"\";\n\nprofile = {\n  ...profile,\n  name: profile?.name || config?.metadata?.displayName || daoId,\n  description: profile?.description || config?.purpose,\n  backgroundImage: profile?.backgroundImage || `${config?.metadata?.flagCover}`,\n  image: profile?.image || `${config?.metadata?.flagLogo}`\n};\n\nlet roles = [];\n\nif (policy?.policy?.roles) {\n  roles = policy?.policy?.roles\n    ?.filter((r) => r.kind && r.kind !== \"Everyone\")\n    ?.map((r) => r.name);\n}\n\nconst onAddUserProposal = (memberId, roleId) => {\n  Near.call([\n    {\n      contractName: daoId,\n      methodName: \"add_proposal\",\n      args: {\n        proposal: {\n          description: \"Potential member\",\n          kind: {\n            AddMemberToRole: {\n              member_id: memberId,\n              role: roleId ?? \"council\"\n            }\n          }\n        }\n      },\n      gas: 219000000000000,\n      deposit: policy?.policy?.proposal_bond || 100000000000000000000000\n    }\n  ]);\n};\n\nconst BG = styled.div`\n  --bs-aspect-ratio: 16%;\n  background-color: #eee;\n  background-size: cover;\n  background-position: center;\n  min-height: 120px;\n`;\n\nconst Avatar = styled.div`\n  background-color: #eee;\n  background-size: cover;\n  background-position: center;\n  min-height: 140px;\n  min-width: 140px;\n  max-height: 140px;\n  max-width: 140px;\n`;\n\nconst Root = styled.div`\n  font-size: 14px;\n\n  .short-description {\n    max-height: 100px;\n    overflow-y: auto;\n\n    p {\n      color: #999;\n    }\n  }\n\n  .profile__metadata {\n    display: flex;\n    justify-content: space-between;\n  }\n\n  @media (max-width: 768px) {\n    .profile__metadata {\n      display: flex;\n      flex-direction: column;\n    }\n    .profile__buttons {\n      grid-column: 1 / span 2;\n    }\n  }\n\n  @media (max-width: 576px) {\n    .profile__metadata {\n      grid-template-columns: 1fr;\n    }\n    .profile__buttons {\n      grid-column: 1 / span 1;\n    }\n  }\n`;\n\nconst DropdownMenu = styled(\"Popover.Content\")`\n  background: #fff;\n  border-radius: 6px;\n  box-shadow: 0 0 40px rgba(0, 0, 0, 0.15);\n  z-index: 10000;\n  padding: 0.5rem;\n  outline: none;\n\n  ul {\n    list-style: none;\n    display: block;\n    margin: 0;\n    padding: 0;\n  }\n\n  li {\n    display: block;\n  }\n\n  a {\n    display: flex;\n    gap: 0.75rem;\n    align-items: center;\n    padding: 0.5rem;\n    font: var(--text-base);\n    color: var(--sand12);\n    outline: none;\n    text-decoration: none;\n\n    &:hover,\n    &:focus {\n      text-decoration: underline;\n    }\n  }\n\n  i {\n    color: var(--violet8);\n  }\n`;\n\nconst clickbaitPrompt = `\nJoin the ${profile.name || daoId} DAO on the BOS\n\\n#NEAR #BOS #DAO\\n\nhttps://near.org/${currentLink}\n`;\n\nconst twitterUrl = new URL(\"https://twitter.com/intent/tweet\");\ntwitterUrl.searchParams.set(\"text\", clickbaitPrompt);\n\nconst mailtoUrl = new URL(\"mailto:\");\nmailtoUrl.searchParams.set(\n  \"subject\",\n  `Join the ${profile.name || daoId} DAO on the BOS`\n);\nmailtoUrl.searchParams.set(\n  \"body\",\n  `Take a look at this DAO. \\n https://near.org/${currentLink}`\n);\n\nconst daoImageMapping = {\n  \"voting-body-v1.ndc-gwg.near\": {\n    name: \"Voting Body\",\n    bg: \"https://ipfs.near.social/ipfs/bafkreie4lmqqbejuk2ajyh27oisufsbtr5okozq6qrvjqg4crorj7v5q2i\",\n    logo: \"https://ipfs.near.social/ipfs/bafkreiauj65shmnvbhtqldx6apkb6rj6kcunp5ldjwe5urd4pi2mc2vzhi\"\n  },\n  \"congress-hom-v1.ndc-gwg.near\": {\n    name: \"House of Merit\",\n    bg: \"https://ipfs.near.social/ipfs/bafkreigsbznuktrxqad3zfci6cwk5xhmdbtr6dndjuy22fsoewmxgktaky\",\n    logo: \"https://ipfs.near.social/ipfs/bafkreidbveybpm7lwd27hbi3cwwlho2khilkpqflmomq3sq75jtqtt4mfq\"\n  },\n  \"congress-coa-v1.ndc-gwg.near\": {\n    name: \"Council of Advisors\",\n    bg: \"https://ipfs.near.social/ipfs/bafkreigy6rhzup4l5cokxousukfptmwhlpffsgj3jqakal43rkagspvobq\",\n    logo: \"https://ipfs.near.social/ipfs/bafkreibhzo5hsx6v5epdrizc5v66fygas6b44xep7c3s4kvcxdu4ieovn4\"\n  },\n  \"congress-tc-v1.ndc-gwg.near\": {\n    name: \"Transparency Commission\",\n    bg: \"https://ipfs.near.social/ipfs/bafkreif2gbfyv5kt4t3q7xe2uc6aywed4k4h5ns6a6avktqlsdjzw73wu4\",\n    logo: \"https://ipfs.near.social/ipfs/bafkreia7zwjqzd4htab7be6nx3ys26q5pd3l7hww3jw6jlnbszmk74w6si\"\n  }\n};\n\nreturn (\n  <Root>\n    <BG\n      className=\"ratio rounded-4 mb-3\"\n      style={{\n        backgroundImage: profile?.backgroundImage.ipfs_cid\n          ? `url(https://ipfs.near.social/ipfs/${profile?.backgroundImage.ipfs_cid})`\n          : `url(${daoImageMapping[daoId]?.bg || profile?.backgroundImage})`\n      }}\n      aria-label=\"DAO Cover Image\"\n      role=\"img\"\n    ></BG>\n\n    <div className=\"profile__metadata gap-3 w-100\">\n      <div className=\"d-flex gap-3\">\n        <Avatar\n          className=\"avatar rounded-4 border border-2 border-white ratio ratio-1x1 position-relative z-1\"\n          style={{\n            backgroundImage: profile?.image.ipfs_cid\n              ? `url(https://ipfs.near.social/ipfs/${profile?.image.ipfs_cid})`\n              : `url(${daoImageMapping[daoId]?.logo || profile?.image})`\n          }}\n        ></Avatar>\n        <div>\n          <h2 className=\"fw-bolder mb-1\">\n            {daoImageMapping[daoId]?.name || profile.name || daoId}\n          </h2>\n          <p className=\"mb-1 text-muted\">@{daoId}</p>\n          <div className=\"short-description mb-2\">\n            <Markdown text={profile.description} />\n          </div>\n          <div className=\"d-flex gap-3 flex-wrap mb-3\">\n            <a href={`/${currentLink}&tab=following`}>\n              <b>{followingCount === null ? \"--\" : followingCount}</b>{\" \"}\n              <span className=\"text-muted\">Following</span>\n            </a>\n            <span>|</span>\n            <a href={`/${currentLink}&tab=followers`}>\n              <b>{followersCount === null ? \"--\" : followersCount}</b>{\" \"}\n              <span className=\"text-muted\">Followers</span>\n            </a>\n          </div>\n          {profile.linktree && (\n            <ul className=\"d-flex list-unstyled gap-3 flex-wrap\">\n              {profile.linktree.website && (\n                <a href={`https://${profile.linktree.website}`} target=\"_blank\">\n                  <i className=\"bi bi-globe\"></i> {profile.linktree.website}\n                </a>\n              )}\n\n              {profile.linktree.github && (\n                <a\n                  href={`https://github.com/${profile.linktree.github}`}\n                  target=\"_blank\"\n                >\n                  <i className=\"bi bi-github\"></i> {profile.linktree.github}\n                </a>\n              )}\n\n              {profile.linktree.twitter && (\n                <a\n                  href={`https://twitter.com/${profile.linktree.twitter}`}\n                  target=\"_blank\"\n                >\n                  <i className=\"bi bi-twitter\"></i> {profile.linktree.twitter}\n                </a>\n              )}\n\n              {profile.linktree.telegram && (\n                <a\n                  href={`https://t.me/${profile.linktree.telegram}`}\n                  target=\"_blank\"\n                >\n                  <i className=\"bi bi-telegram\"></i> {profile.linktree.telegram}\n                </a>\n              )}\n            </ul>\n          )}\n        </div>\n      </div>\n\n      <div className=\"d-flex align-items-start gap-2 mb-4\">\n        <Widget\n          src=\"nearui.near/widget/Social.FollowButton\"\n          props={{\n            accountId: daoId,\n            variant: \"info\",\n            className: \"w-100\"\n          }}\n        />\n        {isVotingBodyDao && (\n          <Widget\n            src=\"nearui.near/widget/Input.Button\"\n            props={{\n              children: (\n                <a\n                  href={`https://i-am-human.app/`}\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  style={{ color: \"rgb(68, 152, 224)\" }}\n                >\n                  Join by proving your humanity\n                </a>\n              ),\n              variant: \"info outline\"\n            }}\n          />\n        )}\n        {!isCongressDaoID && !isVotingBodyDao && (\n          <Widget\n            src=\"astraplusplus.ndctools.near/widget/Layout.Modal\"\n            props={{\n              toggleContainerProps: {\n                className: \"w-100\"\n              },\n              toggle: (\n                <Widget\n                  src=\"nearui.near/widget/Input.Button\"\n                  props={{\n                    variant: \"info outline\",\n                    className: \"w-100\",\n                    children: \"Ask to Join\"\n                  }}\n                />\n              ),\n              content: (\n                <div className=\"ndc-card p-4\">\n                  <Widget\n                    src=\"nearui.near/widget/Input.Select\"\n                    props={{\n                      label: \"Role you want to join as\",\n                      options: roles.map((r) => {\n                        return {\n                          title: r,\n                          value: r\n                        };\n                      }),\n                      onChange: (v) => State.update({ joinRole: v }),\n                      value: state.joinRole\n                    }}\n                  />\n                  <Widget\n                    src=\"nearui.near/widget/Input.Button\"\n                    props={{\n                      children: \"Propose to Join\",\n                      variant: [\"info\"],\n                      className: \"w-100 mt-3\",\n                      onClick: () =>\n                        onAddUserProposal(accountId, state.joinRole)\n                    }}\n                  />\n                </div>\n              )\n            }}\n          />\n        )}\n        <Popover.Root>\n          <Popover.Trigger asChild>\n            <div className=\"w-100\">\n              <Widget\n                src=\"nearui.near/widget/Input.Button\"\n                props={{\n                  variant: \"info outline\",\n                  children: <i className=\"bi bi-share\" />\n                }}\n              />\n            </div>\n          </Popover.Trigger>\n\n          <DropdownMenu sideOffset={5}>\n            <ul>\n              <li>\n                <Popover.Close asChild>\n                  <a href={mailtoUrl.toString()} target=\"_blank\">\n                    <i\n                      className=\"bi bi-envelope\"\n                      style={{ color: \"#4498E0\" }}\n                    />{\" \"}\n                    Share by email\n                  </a>\n                </Popover.Close>\n              </li>\n              <li>\n                <Popover.Close asChild>\n                  <a href={twitterUrl.toString()} target=\"_blank\">\n                    <i className=\"bi bi-twitter\" style={{ color: \"#4498E0\" }} />\n                    Share on Twitter\n                  </a>\n                </Popover.Close>\n              </li>\n            </ul>\n\n            <Popover.Arrow style={{ fill: \"#fff\" }} />\n          </DropdownMenu>\n        </Popover.Root>\n      </div>\n    </div>\n  </Root>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/astraplusplus.ndctools.near/widget/DAO.Layout.Header", "fact_widget_deployments_id": "30be108ce2006b9f4f8595e12b7567cf", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 2}