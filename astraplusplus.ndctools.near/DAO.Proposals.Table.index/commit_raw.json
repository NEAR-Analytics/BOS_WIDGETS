{"tx_hash": "2ZEWeJewZC5qwX6L3sFV6eeAFRYPwyJwHLB6W6G9q9Lm", "action_id_social": "3RHFuMa1dpU4QH22Gtm3eoukHnyfusD88JTsucvxEWFC-0-widget", "block_id": 102668003, "block_timestamp": "2023-10-05T10:45:41.022Z", "signer_id": "astraplusplus.ndctools.near", "widget_name": "DAO.Proposals.Table.index", "source_code": "const { proposals, resPerPage, state, update, isCongressDaoID } = props;\nconst { daoId, multiSelectMode } = state;\n\nconst Table = styled.div`\n    font-size: 13px;\n    font-weight: 600;\n    max-width: 100%;\n    overflow-x: auto;\n    height: 100%;\n    min-height: 100%;\n\n    td,\n    th {\n        vertical-align: middle;\n    }\n\n    tr {\n        height: 58px;\n    }\n\n    .id-value {\n        border: 1px solid #4498e0;\n        color: #4498e0;\n        padding: 4px 8px;\n        background: rgba(68, 152, 224, 0.1);\n        border-radius: 100px;\n        font-size: 12px;\n        font-weight: 500;\n    }\n`;\n\nconst roles = isCongressDaoID\n    ? Near.view(daoId, \"get_members\")\n    : Near.view(daoId, \"get_policy\");\n\nroles = roles === null ? [] : roles?.roles ?? roles;\n\n// -- Filter the user roles\nconst userRoles = [];\nif (Array.isArray(roles)) {\n    for (const role of roles) {\n        if (role.kind === \"Everyone\") {\n            userRoles.push(role);\n            continue;\n        }\n        if (!role.kind.Group) continue;\n        if (\n            accountId &&\n            role.kind.Group &&\n            role.kind.Group.includes(accountId)\n        ) {\n            userRoles.push(role);\n        }\n    }\n}\n\nif (isCongressDaoID) {\n    userRoles = [\n        {\n            name: \"all\",\n            kind: \"Everyone\",\n            permissions: roles?.permissions,\n            vote_policy: {}\n        }\n    ];\n}\nconst isAllowedTo = (kind, action) => {\n    // -- Check if the user is allowed to perform the action\n    let allowed = false;\n    userRoles\n        .filter(({ permissions }) => {\n            if (isCongressDaoID) {\n                const allowedRole =\n                    permissions.includes(`${kind.toString()}`) &&\n                    roles?.members?.includes(accountId);\n                allowed = allowed || allowedRole;\n                return allowedRole;\n            } else {\n                const allowedRole =\n                    permissions.includes(\n                        `${kind.toString()}:${action.toString()}`\n                    ) ||\n                    permissions.includes(`${kind.toString()}:*`) ||\n                    permissions.includes(`*:${action.toString()}`) ||\n                    permissions.includes(\"*:*\");\n                allowed = allowed || allowedRole;\n                return allowedRole;\n            }\n        })\n        .map((role) => role.name);\n    return allowed;\n};\n\nreturn (\n    <Table\n        class=\"table-responsive my-3\"\n        style={{\n            minHeight: 65 * (proposals?.length ?? resPerPage)\n        }}\n    >\n        {proposals === null ? (\n            <>\n                <Widget src=\"nearui.near/widget/Feedback.Spinner\" />\n            </>\n        ) : (\n            <table class=\"table\">\n                <thead>\n                    <tr>\n                        <th scope=\"col\">ID</th>\n                        <th scope=\"col\">Date</th>\n                        <th scope=\"col\">Proposer</th>\n                        <th scope=\"col\" className=\"text-center\">\n                            Type\n                        </th>\n                        <th scope=\"col\" className=\"text-center\">\n                            Status\n                        </th>\n                        <th scope=\"col\"></th>\n                        <th scope=\"col\"></th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {proposals !== null &&\n                        proposals.map(\n                            ({ proposal, proposal_type, proposal_id }, i) => {\n                                if (!isCongressDaoID) {\n                                    proposal.kind = {\n                                        [proposal_type]: {\n                                            ...proposal.kind\n                                        }\n                                    };\n                                }\n                                proposal.id = proposal_id;\n                                if (proposal.status === \"Removed\") return <></>;\n                                Object.keys(proposal.vote_counts).forEach(\n                                    (k) => {\n                                        if (\n                                            typeof proposal.vote_counts[k] ==\n                                            \"string\"\n                                        ) {\n                                            proposal.vote_counts[k] =\n                                                proposal.vote_counts[k]\n                                                    .match(/.{1,2}/g)\n                                                    .map((x) => parseInt(x));\n                                        }\n                                    }\n                                );\n                                return (\n                                    <Widget\n                                        src=\"astraplusplus.ndctools.near/widget/DAO.Proposals.Table.Row\"\n                                        props={{\n                                            proposal,\n                                            proposal_type,\n                                            proposal_id,\n                                            i,\n                                            daoId,\n                                            multiSelectMode,\n                                            isAllowedTo,\n                                            isCongressDaoID\n                                        }}\n                                    />\n                                );\n                            }\n                        )}\n                </tbody>\n            </table>\n        )}\n    </Table>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/astraplusplus.ndctools.near/widget/DAO.Proposals.Table.index", "fact_widget_deployments_id": "6352ff66f813b8256a6ce2b946e0baf7", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 2}