{"tx_hash": "DUWBr4jMLWVivhUULcwKUT9JXX1nsaZ4jf97fzssSgF3", "action_id_social": "2rdWjyM9FaB6UHoL6TJYQg2BCQhTtiAbSMc1d6Ti5Exk-0-widget", "block_id": 105142353, "block_timestamp": "2023-11-07T11:05:22.406Z", "signer_id": "astraplusplus.ndctools.near", "widget_name": "DAO.Proposals.Congress.index", "source_code": "const daoId = props.daoId;\nconst resPerPage = 5;\n\nconst constructURL = (paramObj, base) => {\n    paramObj = { ...paramObj, page: \"dao\" };\n    const baseURL = base ?? `#/${widgetOwner}/widget/home`;\n    let params = \"\";\n    for (const [key, value] of Object.entries(paramObj)) {\n        params += `${key}=${value}&`;\n    }\n    params = params.slice(0, -1);\n    return `${baseURL}?${params}`;\n};\n\nconst VotingBodyDaoId = props.dev\n    ? \"voting-body-v1.gwg-testing.near\"\n    : \"\";\n\nconst isVotingBodyDao = daoId === VotingBodyDaoId;\n\nState.init({\n    daoId,\n    daos: [daoId],\n    page: 0,\n    filters: {\n        proposal_types: [],\n        status: [],\n        time_start: \"\",\n        time_end: \"\"\n    },\n    filtersOpen: false,\n    proposals: [],\n    proposalsCount: 0,\n    daoConfig\n});\n\nconst execProposal = (proposal) =>\n    Near.call(daoId, \"execute\", { id: proposal.id }, 300000000000000);\n\nconst Wrapper = styled.div`\n    .border-bottom {\n        border-bottom: 2px solid lightgray;\n    }\n\n    .text-center {\n        text-align: center;\n    }\n\n    .text-wrap {\n        text-wrap: wrap;\n    }\n`;\n\nconst ProposalCard = styled.div`\n    .type {\n        line-height: 18px;\n    }\n\n    .created_at {\n        font-size: 11px;\n    }\n`;\n\nfunction renderHeader({ id, statusName }) {\n    statusName = statusName.replace(/([A-Z])/g, \" $1\").trim();\n    let statusicon;\n    let statustext;\n    let statusvariant;\n\n    switch (statusName) {\n        case \"Approved\":\n        case \"Accepted\":\n            statusicon = \"bi bi-check-circle\";\n            statustext = statusName;\n            statusvariant = \"success\";\n            break;\n        case \"Executed\":\n            statusicon = \"bi bi-play-fill\";\n            statustext = statusName;\n            statusvariant = \"success\";\n            break;\n        case \"In Progress\":\n        case \"InProgress\":\n            statusicon = \"spinner-border spinner-border-sm\";\n            statustext = \"In Progress\";\n            statusvariant = \"primary\";\n            break;\n        case \"Vetoed\":\n            statusicon = \"bi bi-x-circle\";\n            statustext = \"Vetoed\";\n            statusvariant = \"black\";\n            break;\n        case \"Expired\":\n            statusicon = \"bi bi-clock\";\n            statustext = \"Expired\";\n            statusvariant = \"black\";\n            break;\n        case \"Failed\":\n            statusicon = \"bi bi-x-circle\";\n            statustext = \"Failed\";\n            statusvariant = \"black\";\n            break;\n        case \"Rejected\":\n            statusicon = \"bi bi-ban\";\n            statustext = \"Rejected\";\n            statusvariant = \"danger\";\n            break;\n        case \"PreVote\":\n        case \"Pre Vote\":\n            statusicon = \"bi bi-hourglass-split\";\n            statustext = \"Pre Vote\";\n            statusvariant = \"disabled\";\n            break;\n    }\n\n    return (\n        <div className=\"d-flex flex-wrap gap-2 mb-2\">\n            <Widget\n                src=\"nearui.near/widget/Element.Badge\"\n                props={{\n                    children: `#${id}`,\n                    variant: `outline info round`,\n                    size: \"md\"\n                }}\n            />\n\n            <Widget\n                src=\"nearui.near/widget/Element.Badge\"\n                props={{\n                    children: (\n                        <>\n                            <i\n                                className={statusicon}\n                                style={{\n                                    fontSize: \"14px\",\n                                    marginRight: \"5px\",\n                                    borderWidth: \"2px\",\n                                    animationDuration: \"8s\"\n                                }}\n                            ></i>\n                            {statustext}\n                        </>\n                    ),\n                    variant: `${statusvariant} round`\n                }}\n            />\n        </div>\n    );\n}\n\nconst proposalsCount = Near.view(daoId, \"number_of_proposals\");\nconst proposals = Near.view(daoId, \"get_proposals\", {\n    from_index: proposalsCount,\n    limit: resPerPage,\n    reverse: true\n});\n\nState.update({\n    proposals: proposals ?? [],\n    proposalsCount: proposalsCount ?? 0\n});\n\nfunction getDaoConfig() {\n    const daoConfig = Near.view(daoId, \"config\", {});\n    State.update({ daoConfig });\n}\n\ngetDaoConfig();\n\nreturn (\n    <Wrapper>\n        <div>\n            {state.proposals.map((proposal) => {\n                if (!proposal.submission_time) {\n                    proposal.submission_time = proposal.start;\n                }\n                const kindName =\n                    typeof proposal.kind === \"string\"\n                        ? proposal.kind\n                        : Object.keys(proposal.kind)[0];\n\n                if (proposal.status === \"Removed\") return <></>;\n\n                return (\n                    <ProposalCard className=\"d-flex py-3 justify-content-between border-bottom align-items-center\">\n                        <div className=\"d-flex flex-column\">\n                            {renderHeader({\n                                id: proposal.id,\n                                statusName: proposal.status\n                            })}\n                            <div class=\"type\">\n                                {proposal.kind.FunctionCall ? (\n                                    <>\n                                        <b>Function Call: </b>\n                                        <span className=\"font-monospace\">\n                                            {proposal.kind.FunctionCall.actions\n                                                .map((a) => a.method_name)\n                                                .join(\",\")}\n                                        </span>\n                                    </>\n                                ) : (\n                                    <>\n                                        <b>{kindName}</b> proposal\n                                    </>\n                                )}\n                            </div>\n                            <div className=\"created_at text-secondary d-flex gap-2\">\n                                <div className=\"gap-1 d-flex\">\n                                    <i className=\"bi bi-clock\" />\n                                    <span>\n                                        {new Date(\n                                            proposal.submission_time\n                                        ).toLocaleString()}\n                                    </span>\n                                </div>\n                                <div>|</div>\n                                {isVotingBodyDao ? (\n                                    <div>\n                                        {proposal.approve +\n                                            proposal.reject +\n                                            proposal.abstain +\n                                            proposal.spam}{\" \"}\n                                        votes\n                                    </div>\n                                ) : (\n                                    <div>\n                                        {\n                                            Object.keys(proposal.votes ?? {})\n                                                .length\n                                        }{\" \"}\n                                        {Object.keys(proposal.votes ?? {})\n                                            .length === 1\n                                            ? \"vote\"\n                                            : \"votes\"}\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                        <div className=\"d-flex gap-2\">\n                            {proposal.status === \"Approved\" &&\n                                proposal?.submission_time +\n                                    state.daoConfig?.voting_duration +\n                                    (state.daoConfig?.cooldown ?? 0) < // cooldown is not available in vb\n                                    Date.now() && (\n                                    <Widget\n                                        src=\"nearui.near/widget/Input.Button\"\n                                        props={{\n                                            variant: \"primary icon\",\n                                            children: (\n                                                <i class=\"bi bi-play-fill\" />\n                                            ),\n                                            onClick: () =>\n                                                execProposal(proposal)\n                                        }}\n                                    />\n                                )}\n                            <Widget\n                                src=\"astraplusplus.ndctools.near/widget/Layout.Modal\"\n                                props={{\n                                    toggle: (\n                                        <Widget\n                                            src=\"nearui.near/widget/Input.Button\"\n                                            props={{\n                                                variant: \"info outline icon\",\n                                                children: (\n                                                    <i class=\"bi bi-eye\" />\n                                                )\n                                            }}\n                                        />\n                                    ),\n                                    content: (\n                                        <div\n                                            style={{\n                                                width: 700,\n                                                maxWidth: \"100%\"\n                                            }}\n                                        >\n                                            <Widget\n                                                src=\"astraplusplus.ndctools.near/widget/DAO.Proposals.Card.index\"\n                                                props={{\n                                                    daoId: daoId,\n                                                    proposalString:\n                                                        JSON.stringify({\n                                                            ...proposal,\n                                                            votes:\n                                                                proposal.votes ??\n                                                                {},\n                                                            vote_counts: {}\n                                                        }),\n                                                    multiSelectMode: false,\n                                                    isCongressDaoID: true,\n                                                    isVotingBodyDao,\n                                                    dev: props.dev\n                                                }}\n                                            />\n                                        </div>\n                                    )\n                                }}\n                            />\n                        </div>\n                    </ProposalCard>\n                );\n            })}\n            <div className=\"mt-4 d-flex justify-content-center\">\n                <Widget\n                    src=\"nearui.near/widget/Input.Button\"\n                    props={{\n                        variant: \"info outline\",\n                        children: (\n                            <a\n                                href={`#/astraplusplus.ndctools.near/widget/home?page=dao&daoId=${daoId}${\n                                    props.dev && \"&dev=true\"\n                                }`}\n                                target=\"_blank\"\n                                rel=\"noopener noreferrer\"\n                                style={{ color: \"rgb(68, 152, 224)\" }}\n                            >\n                                View All\n                            </a>\n                        )\n                    }}\n                />\n            </div>\n        </div>\n    </Wrapper>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/astraplusplus.ndctools.near/widget/DAO.Proposals.Congress.index", "fact_widget_deployments_id": "a66d659c38b6c4f04828438aa03e7afd", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 8}