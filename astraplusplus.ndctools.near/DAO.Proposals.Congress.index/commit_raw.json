{"tx_hash": "7pHkJba9zmZB1UrZLe5wqXsptz7QfGH6QPXBdqJj3gfN", "action_id_social": "4dUtzveZPEAavxfsNNJXPiCteydJt2UVVxDwyFCcnhAQ-0-widget", "block_id": 103124261, "block_timestamp": "2023-10-11T11:43:02.202Z", "signer_id": "astraplusplus.ndctools.near", "widget_name": "DAO.Proposals.Congress.index", "source_code": "const daoId = props.daoId;\nconst resPerPage = 5;\n\nconst constructURL = (paramObj, base) => {\n    paramObj = { ...paramObj, page: \"dao\" };\n    const baseURL = base ?? `#/${widgetOwner}/widget/home`;\n    let params = \"\";\n    for (const [key, value] of Object.entries(paramObj)) {\n        params += `${key}=${value}&`;\n    }\n    params = params.slice(0, -1);\n    return `${baseURL}?${params}`;\n};\n\nState.init({\n    daoId,\n    daos: [daoId],\n    page: 0,\n    filters: {\n        proposal_types: [],\n        status: [],\n        time_start: \"\",\n        time_end: \"\"\n    },\n    filtersOpen: false\n});\n\nconst Wrapper = styled.div`\n    .border-bottom {\n        border-bottom: 2px solid lightgray;\n    }\n\n    .text-center {\n        text-align: center;\n    }\n\n    .text-wrap {\n        text-wrap: wrap;\n    }\n`;\n\nconst ProposalCard = styled.div`\n    .type {\n        line-height: 18px;\n    }\n\n    .created_at {\n        font-size: 11px;\n    }\n`;\n\nfunction processProposals(proposals) {\n    const parsedResp = [];\n    proposals?.map((item) => {\n        parsedResp.push({\n            dao_id: daoId,\n            last_updated: \"\",\n            proposal: {\n                id: item.id,\n                kind: item.kind,\n                votes: item.votes,\n                status: item.status,\n                proposer: item?.proposer,\n                description: item.description,\n                vote_counts: {},\n                submission_time: item?.submission_time\n            },\n            proposal_type: item?.kind,\n            proposal_id: item.id,\n            proposer: item?.proposer,\n            status: item?.status,\n            submission_time: item?.submission_time,\n            transaction_id: \"\"\n        });\n    });\n    return { body: parsedResp };\n}\n\nconst update = (newState) => State.update(newState);\nconst proposalsCount = Near.view(daoId, \"number_of_proposals\");\n\nif (!proposalsCount) return;\n\nconst res = useCache(\n    () =>\n        Near.asyncView(daoId, \"get_proposals\", {\n            from_index: proposalsCount,\n            limit: resPerPage,\n            reverse: true\n        }).then((proposals) => processProposals(proposals)),\n    daoId + \"-proposals-congress\",\n    { subscribe: false }\n);\n\nif (res === null) {\n    return <></>;\n}\n\nfunction renderHeader({ id, statusName }) {\n    statusName = statusName.replace(/([A-Z])/g, \" $1\").trim();\n    let statusicon;\n    let statustext;\n    let statusvariant;\n\n    switch (statusName) {\n        case \"Approved\":\n        case \"Vetoed\":\n        case \"Executed\":\n        case \"Accepted\":\n            statusicon = \"bi bi-check-circle\";\n            statustext = statusName;\n            statusvariant = \"success\";\n            break;\n        case \"In Progress\":\n            statusicon = \"spinner-border spinner-border-sm\";\n            statustext = \"In Progress\";\n            statusvariant = \"primary\";\n            break;\n        case \"Expired\":\n            statusicon = \"bi bi-x-circle\";\n            statustext = \"Expired\";\n            statusvariant = \"black\";\n            break;\n        case \"Failed\":\n            statusicon = \"bi bi-x-circle\";\n            statustext = \"Failed\";\n            statusvariant = \"black\";\n            break;\n        case \"Rejected\":\n            statusicon = \"bi bi-x-circle\";\n            statustext = \"Rejected\";\n            statusvariant = \"danger\";\n            break;\n    }\n\n    return (\n        <div className=\"d-flex flex-wrap gap-2 mb-2\">\n            <Widget\n                src=\"nearui.near/widget/Element.Badge\"\n                props={{\n                    children: `#${id}`,\n                    variant: `outline info round`,\n                    size: \"md\"\n                }}\n            />\n\n            <Widget\n                src=\"nearui.near/widget/Element.Badge\"\n                props={{\n                    children: (\n                        <>\n                            <i\n                                className={statusicon}\n                                style={{\n                                    fontSize: \"14px\",\n                                    marginRight: \"5px\",\n                                    borderWidth: \"2px\",\n                                    animationDuration: \"8s\"\n                                }}\n                            ></i>\n                            {statustext}\n                        </>\n                    ),\n                    variant: `${statusvariant} round`\n                }}\n            />\n        </div>\n    );\n}\n\nreturn (\n    <Wrapper>\n        {res !== null && !res.body && (\n            <div className=\"alert alert-danger\" role=\"alert\">\n                Couldn't fetch proposals from API. Please try again later.\n            </div>\n        )}\n        <div>\n            {res?.body?.length > 0 &&\n                res?.body?.map((proposal) => {\n                    console.log(proposal);\n\n                    const kindName =\n                        typeof proposal.proposal_type === \"string\"\n                            ? proposal.proposal_type\n                            : Object.keys(proposal.proposal_type)[0];\n\n                    if (proposal.status === \"Removed\") return <></>;\n\n                    return (\n                        <ProposalCard className=\"d-flex py-3 justify-content-between border-bottom align-items-center\">\n                            <div className=\"d-flex flex-column\">\n                                {renderHeader({\n                                    id: proposal.proposal_id,\n                                    statusName: proposal.status\n                                })}\n                                <div class=\"type\">\n                                    {proposal.proposal.kind.FunctionCall ? (\n                                        <>\n                                            <b>Function Call: </b>\n                                            <span className=\"font-monospace\">\n                                                {proposal.proposal.kind.FunctionCall.actions\n                                                    .map((a) => a.method_name)\n                                                    .join(\",\")}\n                                            </span>\n                                        </>\n                                    ) : (\n                                        <>\n                                            <b>{kindName}</b> proposal\n                                        </>\n                                    )}\n                                </div>\n                                <div className=\"created_at text-secondary d-flex gap-2\">\n                                    <div className=\"gap-1 d-flex\">\n                                        <i className=\"bi bi-clock\" />\n                                        <span>\n                                            {new Date(\n                                                proposal.submission_time\n                                            ).toLocaleString()}\n                                        </span>\n                                    </div>\n                                    <div>|</div>\n                                    <div>\n                                        {\n                                            Object.keys(proposal.proposal.votes)\n                                                .length\n                                        }{\" \"}\n                                        {Object.keys(proposal.proposal.votes)\n                                            .length === 1\n                                            ? \"vote\"\n                                            : \"votes\"}\n                                    </div>\n                                </div>\n                            </div>\n                            <div>\n                                <Widget\n                                    src=\"nearui.near/widget/Layout.Modal\"\n                                    props={{\n                                        toggle: (\n                                            <Widget\n                                                src=\"nearui.near/widget/Input.Button\"\n                                                props={{\n                                                    variant:\n                                                        \"info outline icon\",\n                                                    children: (\n                                                        <i class=\"bi bi-eye\" />\n                                                    )\n                                                }}\n                                            />\n                                        ),\n                                        content: (\n                                            <div\n                                                style={{\n                                                    width: 700,\n                                                    maxWidth: \"100%\"\n                                                }}\n                                            >\n                                                <Widget\n                                                    src=\"astraplusplus.ndctools.near/widget/DAO.Proposals.Card.index\"\n                                                    props={{\n                                                        daoId: daoId,\n                                                        proposalString:\n                                                            JSON.stringify(\n                                                                proposal.proposal\n                                                            ),\n                                                        multiSelectMode: false,\n                                                        isCongressDaoID: true\n                                                    }}\n                                                />\n                                            </div>\n                                        )\n                                    }}\n                                />\n                            </div>\n                        </ProposalCard>\n                    );\n                })}\n            <div className=\"mt-4 d-flex justify-content-center\">\n                <Widget\n                    src=\"nearui.near/widget/Input.Button\"\n                    props={{\n                        variant: \"info outline\",\n                        children: (\n                            <a\n                                href={`#/astraplusplus.ndctools.near/widget/home?page=dao&daoId=${daoId}`}\n                                target=\"_blank\"\n                                rel=\"noopener noreferrer\"\n                                style={{ color: \"rgb(68, 152, 224)\" }}\n                            >\n                                View All\n                            </a>\n                        )\n                    }}\n                />\n            </div>\n        </div>\n    </Wrapper>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/astraplusplus.ndctools.near/widget/DAO.Proposals.Congress.index", "fact_widget_deployments_id": "fe58de196b0c912fc848fdc4bfbebb84", "inserted_timestamp": "2023-10-11T13:40:46.529Z", "modified_timestamp": "2023-10-11T13:40:46.529Z", "__row_index": 0}