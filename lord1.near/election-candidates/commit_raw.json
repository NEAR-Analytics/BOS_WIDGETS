{"tx_hash": "HgLMtNTbiM21KSg8rp3BSQRaDj35tRt9MiZeYJKAgLt7", "action_id_social": "F9PRakD6qZide8H8AVFi5aeikDqD1BQEHnr5w32JY86G-0-widget", "block_id": 101550771, "block_timestamp": "2023-09-20T12:43:59.171Z", "signer_id": "lord1.near", "widget_name": "election-candidates", "source_code": "const themeColor = props.themeColor;\r\nconst generaltheme = {\r\n  height: \"110px\",\r\n  align: \"center\",\r\n  description: \"Tracking the activity of Candidates in Election.\",\r\n  brand: \"Candidates Tracker\",\r\n  fontsize: \"100\",\r\n  fontweight: \"25px\",\r\n  afterbrand: \"\",\r\n  afterbrandcolor: themeColor?.dynamic_header?.afterbrandcolor || \"#789efb\",\r\n  fontbrand: \" Arial, sans-serif\",\r\n  color1brand: themeColor?.dynamic_header?.color1brand || \"#000\",\r\n  color2brand: themeColor?.dynamic_header?.color2brand || \"#806ce1\",\r\n  colordescription: themeColor?.dynamic_header?.colordescription || \"#806ce1\",\r\n  fontsubtitle: \" Arial, sans-serif\",\r\n  background:\r\n    themeColor?.dynamic_header?.background ||\r\n    \"radial-gradient(circle, rgba(210,202,250,1) 0%, rgba(230,230,231,0.01) 0%, rgba(235,238,255,1) 100%, rgba(235,231,253,1) 100%, rgba(255,241,241,1) 100%, rgba(46,52,90,1) 100%);\",\r\n};\r\n\r\nconst projecttheme = {\r\n  height: \"90px\",\r\n  align: \"left\",\r\n  description: \"Details of Proposal's information\",\r\n  brand: \"Proposal\",\r\n  fontsize: \"30px\",\r\n  fontweight: \"25px\",\r\n  afterbrand: \"Informations\",\r\n  afterbrandcolor: themeColor?.dynamic_header?.afterbrandcolor || \"#789efb\",\r\n  fontbrand: \" Arial, sans-serif\",\r\n  color1brand: themeColor?.dynamic_header?.color1brand || \"#000\",\r\n  color2brand: themeColor?.dynamic_header?.color2brand || \"#806ce1\",\r\n  colordescription: themeColor?.dynamic_header?.colordescription || \"#806ce1\",\r\n  fontsubtitle: \" Arial, sans-serif\",\r\n  background:\r\n    themeColor?.dynamic_header?.background ||\r\n    \"radial-gradient(circle, rgba(210,202,250,1) 0%, rgba(230,230,231,0.01) 0%, rgba(235,238,255,1) 100%, rgba(235,231,253,1) 100%, rgba(255,241,241,1) 100%, rgba(46,52,90,1) 100%);\",\r\n};\r\n\r\nconst queryHashes = [\r\n  { id: 1, hash: \"5f749570-d323-4db6-b3e9-f70c570493a4\" },\r\n  { id: 2, hash: \"90b33488-6c0f-4434-af92-12758d29db39\" },\r\n  { id: 3, hash: \"ebf3af30-d81d-4110-896a-46d538741e05\" },\r\n  { id: 4, hash: \"b3fd2f7e-ecfd-4bfa-a184-f68a7d52c5ca\" },\r\n  { id: 5, hash: \"e413b3cb-5c79-48f3-a6de-cc5cd4267dfc\" },\r\n  { id: 6, hash: \"74368607-8996-45c0-8c61-4cce414b027d\" },\r\n  { id: 7, hash: \"885e31c5-3910-46a7-a5d4-e4cb33251b53\" },\r\n  { id: 8, hash: \"13a28c3b-2cf9-4dcb-aed5-7d4fa94af36a\" },\r\n  { id: 9, hash: \"17a1eb50-5b71-47e5-b570-4c7a40678e01\" },\r\n  { id: 10, hash: \"1a3d189f-9717-4a84-ba97-f9be3a3ed0d5\" },\r\n  { id: 11, hash: \"4b1691db-4073-4d1d-84f8-caac41a66feb\" },\r\n];\r\n\r\nState.init({\r\n  light: true,\r\n  data: [],\r\n  isLoading: true,\r\n  error: [],\r\n});\r\n\r\nconst getMixProps = (data, dateKey, serieses, colors, chartOption) => {\r\n  data = data || [];\r\n  serieses = serieses || [{ key: \"\", seriesName: \"\", type: \"\", id: 1 }];\r\n  colors = colors || [];\r\n  chartOption = chartOption || {};\r\n\r\n  const dataFormat = serieses.map((series) => {\r\n    const dataFormated = data.map((d) => [d[dateKey] * 1000, d[series.key]]);\r\n    return {\r\n      data: dataFormated,\r\n      name: series.seriesName,\r\n      type: series.type,\r\n      axisId: series.id,\r\n    };\r\n  });\r\n  const props = {\r\n    series: dataFormat,\r\n    colors: colors,\r\n    chartOption: {\r\n      title: \"chart title\",\r\n      subtitle: \"chart subtitle\",\r\n      legend: true,\r\n      stacking: \"false\",\r\n      ...chartOption,\r\n    },\r\n\r\n    overrideOptions: {\r\n      plotOptions: {\r\n        column: {\r\n          stacking: \"false\",\r\n        },\r\n        series: {\r\n          dataGrouping: { enabled: false },\r\n        },\r\n      },\r\n    },\r\n    themeColor: { chart: themeColor.chart },\r\n    spinnerColors: themeColor.spinnerColors,\r\n  };\r\n  return props;\r\n};\r\n\r\nconst getPieProps = (data, [key, value], colors, chartOption) => {\r\n  data = data || [];\r\n  colors = colors || [];\r\n  chartOption = chartOption || {};\r\n\r\n  const dataFormat = data.map((s) => [s[key], s[value]]);\r\n  const props = {\r\n    data: dataFormat,\r\n    colors: colors,\r\n    chartOption: {\r\n      title: \"chart title\",\r\n      type: \"pie\",\r\n      legend: false,\r\n      connector: false,\r\n      ...chartOption,\r\n    },\r\n    themeColor: { chart: themeColor.chart },\r\n    spinnerColors: themeColor.spinnerColors,\r\n  };\r\n  return props;\r\n};\r\n\r\nconst formatNumber = (num) => {\r\n  if ((num ?? NaN) === NaN) return \"-\";\r\n  if (num >= 1000000000) {\r\n    return (num / 1000000000).toFixed(1).replace(/\\.0$/, \"\") + \"b\";\r\n  }\r\n  if (num >= 1000000) {\r\n    return (num / 1000000).toFixed(1).replace(/\\.0$/, \"\") + \"m\";\r\n  }\r\n  if (num >= 1000) {\r\n    return (num / 1000).toFixed(1).replace(/\\.0$/, \"\") + \"k\";\r\n  }\r\n  return num.toFixed(4);\r\n};\r\nconst Right = styled.div`\r\n  padding: 20px;\r\n  margin-bottom: 20px;\r\n  background: #f8f8f9;\r\n  border-radius: 8px;\r\n`;\r\nconst H5 = styled.h5`\r\n  margin-bottom: 20px;\r\n`;\r\nconst handleData = () => {\r\n  const data = {};\r\n  const errors = [];\r\n  queryHashes.forEach(({ hash, id }) => {\r\n    const result = fetchData(hash);\r\n    if (result.error) errors.push(`hash${id} : ${result.error}`);\r\n    data[`hash${id}`] = {\r\n      ...result,\r\n      id,\r\n    };\r\n  });\r\n\r\n  if (Object.values(data).every((d) => !d.isLoading)) {\r\n    State.update({\r\n      data: data,\r\n      error: [...state.error, ...errors],\r\n      isLoading: false,\r\n    });\r\n  }\r\n};\r\n\r\nconst fetchData = (hash) => {\r\n  const data = fetch(\r\n    `https://api.flipsidecrypto.com/api/v2/queries/${hash}/data/latest`,\r\n    {\r\n      subscribe: true,\r\n      method: \"GET\",\r\n      headers: {\r\n        Accept: \"*/*\",\r\n      },\r\n    }\r\n  );\r\n  const result = {\r\n    data: (data && data.body) || null,\r\n    error: (data && !data.ok && (data.status || data.error)) || null,\r\n    isLoading: !data && !error,\r\n  };\r\n  return result;\r\n};\r\n\r\nif (state.isLoading) {\r\n  handleData();\r\n}\r\n\r\nif (state.error.length > 0) {\r\n  function hide() {\r\n    const errors = state.error;\r\n    errors.shift();\r\n    if (errors.length > 0) setTimeout(hide, 2500);\r\n    State.update({ error: errors });\r\n  }\r\n  setTimeout(hide, 2500);\r\n}\r\n\r\nreturn (\r\n  <div className=\"container-fluid py-2\">\r\n    <div className=\"pl-2\">\r\n      <div\r\n        className=\"my-4 shadow-sm pb-2 rounded-4\"\r\n        style={{ background: themeColor?.sbt_area?.section_bg }}\r\n      >\r\n        <Widget src=\"lord1.near/widget/header-dynamic\" props={generaltheme} />\r\n        <div style={{ marginLeft: \"1rem\" }}>\r\n          <Widget\r\n            src=\"lord1.near/widget/tab-election-infos\"\r\n            props={{\r\n              backgroundColor: themeColor?.tab_sbt?.backgroundColor,\r\n              textColor: themeColor?.tab_sbt?.textColor,\r\n              headerColor: themeColor?.tab_sbt?.headerColor,\r\n              numberColor: themeColor?.tab_sbt?.numberColor,\r\n            }}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"row w-100 py-4 g-4\">\r\n        <div className=\" col-12 col-md-6\">\r\n          <div\r\n            style={{ background: themeColor?.sbt_area?.card_bg }}\r\n            className=\"w-100 mx-auto shadow-sm rounded-4\"\r\n          >\r\n            <h6\r\n              style={{ color: themeColor?.sbt_area?.card_title_color }}\r\n              className=\"pt-4 ps-4\"\r\n            >\r\n              <i> Bond amount distributions</i>\r\n            </h6>\r\n            <Widget\r\n              src=\"lord1.near/widget/Pie-chart\"\r\n              props={getPieProps(\r\n                state.data?.hash2?.data,\r\n                [\"bond_amount\", \"bonder\"],\r\n                themeColor.chartColor,\r\n                {\r\n                  title: \"\",\r\n                  type: \"pie\",\r\n                  connector: true,\r\n                  legend: true,\r\n                }\r\n              )}\r\n            />\r\n          </div>\r\n        </div>\r\n        <div className=\" col-12 col-md-6\">\r\n          <div\r\n            style={{ background: themeColor?.sbt_area?.card_bg }}\r\n            className=\"w-100 mx-auto shadow-sm rounded-4\"\r\n          >\r\n            <h6\r\n              style={{ color: themeColor?.sbt_area?.card_title_color }}\r\n              className=\"pt-4 ps-4\"\r\n            >\r\n              <i> Distribution of #votes among voters.</i>\r\n            </h6>\r\n            <Widget\r\n              src=\"lord1.near/widget/Pie-chart\"\r\n              props={getPieProps(\r\n                state.data?.hash3?.data,\r\n                [\"trxs\", \"voter\"],\r\n                themeColor.chartColor,\r\n                {\r\n                  title: \"\",\r\n                  type: \"pie\",\r\n                  connector: true,\r\n                  legend: true,\r\n                }\r\n              )}\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div\r\n        className=\"my-4 shadow-sm  rounded-4\"\r\n        style={{ background: themeColor?.sbt_area?.section_bg }}\r\n      >\r\n        <Widget src=\"lord1.near/widget/header-dynamic\" props={projecttheme} />\r\n        <div className=\"row g-4 w-100 pb-2 mx-0\">\r\n          <div className=\"col-12\">\r\n            <div\r\n              style={{ background: themeColor?.sbt_area?.card_bg }}\r\n              className=\"shadow-sm rounded-2 overflow-auto\"\r\n            >\r\n              <Widget\r\n                src=\"lord1.near/widget/table-pagination\"\r\n                props={{\r\n                  themeColor: { table_pagination: themeColor.table_pagination },\r\n                  data: state.data?.hash5?.data,\r\n                  columns: [\r\n                    { title: \"Timestamp\", key: \"timestamp\" },\r\n                    { title: \"Seat\", key: \"seat\" },\r\n                    { title: \"Type\", key: \"type\" },\r\n                    { title: \"Candidates\", key: \"sbt\", explain: \"yes\" },\r\n                    { title: \"Start\", key: \"start_date\" },\r\n                    { title: \"End\", key: \"end_date\" },\r\n                    { title: \"Cooldown\", key: \"cooldown\" },\r\n                    { title: \"Finish\", key: \"finish_date\" },\r\n                    { title: \"Quorum\", key: \"quorum\" },\r\n                    {\r\n                      title: \"Hash\",\r\n                      key: \"trxs\",\r\n                      link: \"yes\",\r\n                      beforehref: \"https://nearblocks.io/txns/\",\r\n                      afterhref: \"\",\r\n                    },\r\n                  ],\r\n                  rowsCount: 5,\r\n                }}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <Widget\r\n        src=\"lord1.near/widget/candidate-info-election\"\r\n        props={{ themeColor: themeColor }}\r\n      />\r\n      <Widget\r\n        src=\"lord1.near/widget/candidate-vote-info-election\"\r\n        props={{ themeColor: themeColor }}\r\n      />\r\n      <Widget\r\n        src=\"lord1.near/widget/trend-election\"\r\n        props={{ themeColor: themeColor }}\r\n      />\r\n      <div className=\"toast-container position-fixed bottom-0 end-0 p-3\">\r\n        {state.error.length > 0 &&\r\n          state.error.map((er) => (\r\n            <div\r\n              className=\"toast show align-items-center text-bg-danger border-0\"\r\n              role=\"alert\"\r\n              aria-live=\"assertive\"\r\n              aria-atomic=\"true\"\r\n            >\r\n              <div className=\"d-flex\">\r\n                <div className=\"toast-body\">{er}</div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/lord1.near/widget/election-candidates", "fact_widget_deployments_id": "fd49640995c7beb9e2d8853458f97493", "inserted_timestamp": "2023-09-20T14:38:26.217Z", "modified_timestamp": "2023-09-20T14:38:26.217Z", "__row_index": 0}