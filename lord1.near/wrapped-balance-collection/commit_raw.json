{"tx_hash": "5Yrg3b9RXaXKki9mPU6eEyPA9zncSZCCDEtPXojBP4RA", "action_id_social": "FDpKMcrrdSqumnxJVLyjmemPH8dTtBtnsXA2CZUyYGya-0-widget", "block_id": 108183916, "block_timestamp": "2023-12-17T16:54:37.609Z", "signer_id": "lord1.near", "widget_name": "wrapped-balance-collection", "source_code": "const themeColor = props.themeColor;\r\nconst explor_balance_collectibles_theme = themeColor?.explor_balance\r\n  ?.collectibles || { color: \"#000\", card_bg: \"#f0f0f0\" };\r\nconst accountId = props.accountId ?? context.accountId ?? \"\";\r\n\r\nconst operationsDoc = `\r\n  query MyQuery {\r\n    mb_views_nft_tokens(\r\n      order_by: {last_transfer_timestamp: desc}\r\n      where: {owner: {_eq: \"${state.searchedAccountId}\"}, _and: {burned_timestamp: {_is_null: true}, last_transfer_timestamp: {}}}\r\n    ) {\r\n      nft_contract_id\r\n      title\r\n      description\r\n      media\r\n      last_transfer_receipt_id\r\n      metadata_id\r\n      token_id\r\n      nft_contract_name\r\n      nft_contract_icon\r\n    }\r\n  }\r\n`;\r\n\r\nState.init({\r\n  searchedAccountId: \"\",\r\n  result: {},\r\n  isLoading: true,\r\n  error: [],\r\n});\r\n\r\nconst checkNewAccountId = () => {\r\n  if (state.searchedAccountId === accountId) {\r\n    return;\r\n  } else {\r\n    State.update({\r\n      searchedAccountId: accountId,\r\n      result: {},\r\n      isLoading: true,\r\n    });\r\n  }\r\n};\r\ncheckNewAccountId();\r\n\r\nconst handleData = () => {\r\n  const result = fetchData();\r\n  if (result.isLoading) {\r\n    State.update({\r\n      isLoading: true,\r\n      result: {\r\n        isLoading: true,\r\n        error: false,\r\n        data: null,\r\n      },\r\n    });\r\n  }\r\n  if (result.error) {\r\n    const errors = state.error;\r\n    errors.push(`${result.error}`);\r\n    State.update({\r\n      error: errors,\r\n      isLoading: false,\r\n      result: {\r\n        isLoading: false,\r\n        error: true,\r\n        data: null,\r\n      },\r\n    });\r\n  }\r\n  if (result.data) {\r\n    State.update({\r\n      isLoading: false,\r\n      result: {\r\n        isLoading: false,\r\n        error: false,\r\n        data: result.data.data.mb_views_nft_tokens,\r\n      },\r\n    });\r\n  }\r\n};\r\n\r\nconst fetchData = () => {\r\n  const data = fetch(`https://graph.mintbase.xyz/mainnet`, {\r\n    method: \"POST\",\r\n    headers: {\r\n      \"mb-api-key\": \"anon\",\r\n      \"content-type\": \"application/json\",\r\n    },\r\n    body: JSON.stringify({\r\n      query: operationsDoc,\r\n      variables: {},\r\n      operationName: \"MyQuery\",\r\n    }),\r\n  });\r\n  const result = {\r\n    data: (data && data.body) || null,\r\n    error: (data && !data.ok && (data.status || data.error)) || null,\r\n    isLoading: !data && !error,\r\n  };\r\n  return result;\r\n};\r\n\r\nif (state.isLoading) {\r\n  handleData();\r\n}\r\n\r\n// error managment #######################\r\nif (state.error.length > 0) {\r\n  function hide() {\r\n    const errors = state.error;\r\n    errors.shift();\r\n    if (errors.length > 0) setTimeout(hide, 2500);\r\n    State.update({ error: errors });\r\n  }\r\n  setTimeout(hide, 2500);\r\n}\r\n\r\n// ----------------------------------------------------\r\nconst noData = <div className=\"w-100 py-4 text-center\"> No data available</div>;\r\nconst CardIsLoading = () =>\r\n  state.isLoading && (\r\n    <div\r\n      className=\"d-flex flex-column gap-1\"\r\n      style={{\r\n        padding: \"60px 12px\",\r\n      }}\r\n    >\r\n      <Widget\r\n        src={`easypoll-v0.ndc-widgets.near/widget/Common.Spinner`}\r\n        props={{\r\n          ...spinnerColors,\r\n        }}\r\n      />\r\n      <span\r\n        style={{\r\n          fontWeight: \"bold\",\r\n          fontsize: 15,\r\n          color: \"#4f46e5\",\r\n          textAlign: \"center\",\r\n        }}\r\n      >\r\n        Loading...\r\n      </span>\r\n    </div>\r\n  );\r\nconst CardHasError = () =>\r\n  state.result.error && (\r\n    <div className=\"d-flex justify-content-center align-items-center h-100 p-4 pb-1\">\r\n      An error occurred for this section\r\n    </div>\r\n  );\r\n\r\nconst Result =\r\n  state.result.data.length > 0 ? (\r\n    <div className=\"row g-2\">\r\n      {state.result.data.map((nft) => (\r\n        <div key={nft.contract_id + nft.token_id} className=\"col-md-6 col-lg-3\">\r\n          <div\r\n            className=\"p-2 d-flex flex-column align-items-center h-100 rounded-4\"\r\n            style={{\r\n              backgroundColor:\r\n                explor_balance_collectibles_theme?.card_bg || \"#eee\",\r\n              cursor: \"pointer\",\r\n            }}\r\n          >\r\n            <img\r\n              style={{ marginBottom: \"1rem\", \"border-radius\": \"15px\" }}\r\n              height={60}\r\n              width={60}\r\n              layout=\"intrinsic\"\r\n              loading=\"lazy\"\r\n              src={\r\n                nft.media ??\r\n                \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\"\r\n              }\r\n            />\r\n            <div\r\n              style={{\r\n                fontWeight: 500,\r\n                fontSize: \"1.125rem\",\r\n                textAlign: \"center\",\r\n                color: explor_balance_collectibles_theme?.color || \"#000\",\r\n              }}\r\n            >\r\n              <div>{nft.title}</div>\r\n              <div\r\n                style={{\r\n                  overflowWrap: \"break-word\",\r\n                  wordWrap: \"break-word\",\r\n                  wordBreak: \"break-word\",\r\n                }}\r\n              >\r\n                [{nft.token_id}]\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  ) : (\r\n    noData\r\n  );\r\nreturn (\r\n  <>\r\n    <div\r\n      style={{ background: themeColor?.sbt_area?.section_bg }}\r\n      className=\"shadow-sm rounded-2 overflow-auto p-2\"\r\n    >\r\n      {CardIsLoading()}\r\n      {CardHasError()}\r\n\r\n      {state.result.data && Result}\r\n    </div>\r\n  </>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/lord1.near/widget/wrapped-balance-collection", "fact_widget_deployments_id": "c45a4753eae476dc25eba561420fe4a8", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}