{"tx_hash": "7yk95dVMRUePcit84QqHGkGcBAndSbbL2VRYnpZdYjgE", "action_id_social": "BXAFaBbP9wXgcTHcYrwNwP9TmjL2vXhq3s6859RueHHu-0-widget", "block_id": 107917844, "block_timestamp": "2023-12-14T10:48:43.857Z", "signer_id": "lord1.near", "widget_name": "wrapped-balance-collection", "source_code": "const themeColor = props.themeColor;\nconst explor_balance_collectibles_theme = themeColor?.explor_balance\n  ?.collectibles || { color: \"#000\", card_bg: \"#f0f0f0\" };\nconst accountId = props.accountId ?? context.accountId ?? \"\";\n\nconst operationsDoc = `\n  query MyQuery {\n    mb_views_nft_tokens(\n      order_by: {last_transfer_timestamp: desc}\n      where: {owner: {_eq: \"${accountId}\"}, _and: {burned_timestamp: {_is_null: true}, last_transfer_timestamp: {}}}\n    ) {\n      nft_contract_id\n      title\n      description\n      media\n      last_transfer_receipt_id\n      metadata_id\n      token_id\n      nft_contract_name\n      nft_contract_icon\n    }\n  }\n`;\n\nState.init({\n  searchedAccountId: \"\",\n  result: {},\n  isLoading: true,\n  error: [],\n});\n\nconst checkNewAccountId = () => {\n  if (state.searchedAccountId === accountId) {\n    return;\n  } else {\n    State.update({\n      searchedAccountId: accountId,\n      result: {},\n      isLoading: true,\n    });\n  }\n};\ncheckNewAccountId();\n\nconst handleData = () => {\n  const result = fetchData();\n  if (result.isLoading) {\n    State.update({\n      isLoading: true,\n      result: {\n        isLoading: true,\n        error: false,\n        data: null,\n      },\n    });\n  }\n  if (result.error) {\n    const errors = state.error;\n    errors.push(`${result.error}`);\n    State.update({\n      error: errors,\n      isLoading: false,\n      result: {\n        isLoading: false,\n        error: true,\n        data: null,\n      },\n    });\n  }\n  if (result.data) {\n    State.update({\n      isLoading: false,\n      result: {\n        isLoading: false,\n        error: false,\n        data: result.data.data.mb_views_nft_tokens,\n      },\n    });\n  }\n};\n\nconst fetchData = () => {\n  const data = fetch(`https://graph.mintbase.xyz/mainnet`, {\n    method: \"POST\",\n    headers: {\n      \"mb-api-key\": \"anon\",\n      \"content-type\": \"application/json\",\n    },\n    body: JSON.stringify({\n      query: operationsDoc,\n      variables: {},\n      operationName: \"MyQuery\",\n    }),\n  });\n  const result = {\n    data: (data && data.body) || null,\n    error: (data && !data.ok && (data.status || data.error)) || null,\n    isLoading: !data && !error,\n  };\n  return result;\n};\n\nif (state.isLoading) {\n  handleData();\n}\n\n// error managment #######################\nif (state.error.length > 0) {\n  function hide() {\n    const errors = state.error;\n    errors.shift();\n    if (errors.length > 0) setTimeout(hide, 2500);\n    State.update({ error: errors });\n  }\n  setTimeout(hide, 2500);\n}\n\n// ----------------------------------------------------\nconst noData = <div className=\"w-100 py-4 text-center\"> No data available</div>;\nconst CardIsLoading = () =>\n  state.isLoading && (\n    <div\n      className=\"d-flex flex-column gap-1\"\n      style={{\n        padding: \"60px 12px\",\n      }}\n    >\n      <Widget\n        src={`easypoll-v0.ndc-widgets.near/widget/Common.Spinner`}\n        props={{\n          ...spinnerColors,\n        }}\n      />\n      <span\n        style={{\n          fontWeight: \"bold\",\n          fontsize: 15,\n          color: \"#4f46e5\",\n          textAlign: \"center\",\n        }}\n      >\n        Loading...\n      </span>\n    </div>\n  );\nconst CardHasError = () =>\n  state.result.error && (\n    <div className=\"d-flex justify-content-center align-items-center h-100 p-4 pb-1\">\n      An error occurred for this section\n    </div>\n  );\n\nconst Result =\n  state.result.data.length > 0 ? (\n    <div className=\"row g-2\">\n      {state.result.data.map((nft) => (\n        <div key={nft.contract_id + nft.token_id} className=\"col-md-6 col-lg-4\">\n          <div\n            className=\"p-2 d-flex flex-column align-items-center h-100 rounded-4\"\n            style={{\n              backgroundColor:\n                explor_balance_collectibles_theme?.card_bg || \"#eee\",\n              cursor: \"pointer\",\n            }}\n          >\n            <img\n              style={{ marginBottom: \"1rem\" }}\n              height={60}\n              width={60}\n              layout=\"intrinsic\"\n              src={\n                nft.media ??\n                \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\"\n              }\n            />\n            <div\n              style={{\n                fontWeight: 500,\n                fontSize: \"1.125rem\",\n                textAlign: \"center\",\n                color: explor_balance_collectibles_theme?.color || \"#000\",\n              }}\n            >\n              <div>{nft.title}</div>\n              <div\n                style={{\n                  overflowWrap: \"break-word\",\n                  wordWrap: \"break-word\",\n                  wordBreak: \"break-word\",\n                }}\n              >\n                [{nft.token_id}]\n              </div>\n            </div>\n          </div>\n        </div>\n      ))}\n    </div>\n  ) : (\n    noData\n  );\nreturn (\n  <>\n    {CardIsLoading()}\n    {CardHasError()}\n\n    {state.result.data && Result}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/lord1.near/widget/wrapped-balance-collection", "fact_widget_deployments_id": "87f19cf3356e950121eda1959f9e14bb", "inserted_timestamp": "2023-12-14T12:59:40.559Z", "modified_timestamp": "2023-12-20T03:22:11.422Z", "__row_index": 1}