{"tx_hash": "FBRFBDddYxGobHH4mYHCRCTmBCD4g9hLjE1qDqRgkyLR", "action_id_social": "7v5aAZxFLudJcfznqNyb967MNdP4JKSkbYCniaCwjG2q-0-widget", "block_id": 88721192, "block_timestamp": "2023-04-03T11:56:46.812Z", "signer_id": "contribut3.near", "widget_name": "NeedForm", "source_code": "const ownerId = \"contribut3.near\";\nconst accountId = props.accountId;\nconst contributionType = props.contributionType\n  ? [{ name: props.contributionType }]\n  : [];\n\nState.init({\n  contributionType: [],\n  entityId: accountId ? [{ name: accountId }] : [],\n  description: \"\",\n  options: [],\n  fetched: false,\n});\n\nconsole.log(\"rendered this\");\n\nif (!state.fetched) {\n  Near.asyncView(ownerId, \"get_contribution_types\", {}, \"final\", false).then(\n    (types) =>\n      State.update({\n        fetched: true,\n        options: types.map((name) => ({ name })),\n      })\n  );\n}\n\nconst Label = styled.label`\n  font-weight: 600;\n  color: #344054;\n`;\n\nconst EntityInput = styled.div`\n  margin-bottom: 0.5em;\n`;\n\nconst SelectedEntity = styled.div`\n  border-radius: 4px;\n  background-color: #f2f4f7;\n  height: 5em;\n`;\n\nconst entityEditor = (\n  <EntityInput>\n    <Label htmlFor=\"enity-id\">Request for:</Label>\n    {props.accountId ? (\n      <SelectedEntity id=\"entity-id\">\n        <Widget\n          src={`${ownerId}/widget/ProfileLine`}\n          props={{\n            accountId: props.accountId,\n            imageSize: \"4em\",\n            isEntity: true,\n          }}\n        />\n      </SelectedEntity>\n    ) : (\n      <Widget\n        src={`${ownerId}/widget/AdminEntityAccountIdInput`}\n        props={{\n          update: (entityId) => {\n            State.update({ entityId });\n            Near.asyncView(\n              ownerId,\n              \"get_entity_invites\",\n              { account_id: entityId[0].name },\n              \"final\"\n            ).then((invites) =>\n              State.update({\n                forbiddenIds: new Set(Object.keys(invites)),\n              })\n            );\n          },\n          accountId: context.accountId,\n          selected: state.entityId,\n        }}\n      />\n    )}\n  </EntityInput>\n);\n\nconst InputWrapper = styled.div`\n  margin-bottom: 0.5em;\n`;\n\nconst contributionTypeInput = (\n  <InputWrapper>\n    <Widget\n      src={`${ownerId}/widget/ContributionTypeInput`}\n      props={{\n        contributionType: state.contributionType,\n        update: (contributionType) => State.update({ contributionType }),\n      }}\n    />\n  </InputWrapper>\n);\n\nconst descriptionInput = (\n  <InputWrapper>\n    <Widget\n      src={`${ownerId}/widget/DescriptionInput`}\n      props={{\n        description: state.description,\n        text: \"Details:\",\n        update: (description) => State.update({ description }),\n      }}\n    />\n  </InputWrapper>\n);\n\nconst convertType = (contributionType) => {\n  if (state.options.some(({ name }) => name === contributionType.name)) {\n    return contributionType.name;\n  }\n\n  return { Other: contributionType.name };\n};\n\nconst onSubmit = () => {\n  if (state.contributionType.length !== 1 || state.description.length === 0) {\n    return;\n  }\n\n  const args = {\n    entity_id: state.entityId[0].name,\n    description: state.description,\n    contribution_type: convertType(state.contributionType[0]),\n  };\n\n  Near.call(ownerId, \"post_contribution_need\", args);\n};\n\nconst Page = styled.div`\n  padding: 0 0.75em;\n  max-width: 100%;\n\n  h1 {\n    font-size: 2em;\n    margin-bottom: 0.75em;\n    padding-bottom: 0.75em;\n  }\n`;\n\nconst Form = styled.div`\n  display: flex;\n  flex-direction: column;\n  margin-bottom: 0.75em;\n  padding: 1em;\n  border-radius: 4px;\n  background-color: #f9fafb;\n`;\n\nconst Controls = styled.div`\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n`;\n\nconst CloseButton = styled.a`\n  background-color: white;\n  padding: 0.7em;\n  border-radius: 4px;\n  border: 0;\n  color: #344054;\n  transition: box-shadow 0.2s ease-in-out;\n\n  &:hover {\n    text-decoration: none;\n    color: unset;\n    box-shadow: 0px 1px 2px rgba(16, 24, 40, 0.05);\n  }\n`;\n\nconst ConfirmButton = styled.button`\n  padding: 0.7em;\n  border-radius: 4px;\n  border: 0;\n  box-shadow: 0px 1px 2px rgba(16, 24, 40, 0.05);\n  background-color: ${({ valid }) => (valid ? \"#7f56d9\" : \"#344054\")};\n  color: white;\n  transition: background-color 0.2s ease-in-out;\n\n  &:hover {\n    ${({ valid }) => (valid ? \"background-color: #4f56d9;\" : \"\")}\n  }\n`;\n\nreturn (\n  <Page>\n    <h1>Create new contribution request</h1>\n    <Form>\n      {entityEditor}\n      {contributionTypeInput}\n      {descriptionInput}\n    </Form>\n    <Controls>\n      <CloseButton\n        href={`/#/${ownerId}/widget/Index?tab=home`}\n        onClick={() => props.update({ tab: \"home\" })}\n      >\n        Cancel\n      </CloseButton>\n      <ConfirmButton\n        valid={\n          state.contributionType.length === 1 && state.description.length > 0\n        }\n        onClick={onSubmit}\n      >\n        Create request\n      </ConfirmButton>\n    </Controls>\n  </Page>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/contribut3.near/widget/NeedForm", "fact_widget_deployments_id": "36e583c20510c8fb108922c04a09b7bd", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 6}