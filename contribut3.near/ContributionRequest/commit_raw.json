{"tx_hash": "9ziLwkhMvBLbSWgbxm1cMdoWLovjvizzpzHaBCDZoJvr", "action_id_social": "DfDU35c5RuX3fYYLUhPgFXk5d67DtBCeMbzmAERJPXod-0-widget", "block_id": 88784657, "block_timestamp": "2023-04-04T07:43:10.679Z", "signer_id": "contribut3.near", "widget_name": "ContributionRequest", "source_code": "const ownerId = \"contribut3.near\";\nconst accountId = context.accountId;\nconst entityId = props.entityId;\nconst contributorId = props.contributorId;\n\nif (!entityId || !contributorId) {\n  return \"Cannot show contribution request without entityId or contributorId!\";\n}\n\nState.init({\n  isAuthorized: false,\n  isAuthorizedFetched: false,\n  contributionRequest: null,\n  contributionRequestFetched: false,\n  need: null,\n  needFetched: false,\n});\n\nif (!state.isAuthorizedFetched) {\n  Near.asyncView(\n    ownerId,\n    \"check_is_manager_or_higher\",\n    { entity_id: entityId, account_id: context.accountId },\n    \"final\",\n    false\n  ).then((isAuthorized) =>\n    State.update({ isAuthorized, isAuthorizedFetched: true })\n  );\n}\n\nif (!state.contributionRequestFetched) {\n  Near.asyncView(\n    ownerId,\n    \"get_contribution_request\",\n    {\n      entity_id: entityId,\n      contributor_id: contributorId,\n    },\n    \"final\",\n    false\n  ).then((contributionRequest) =>\n    State.update({ contributionRequest, contributionRequestFetched: true })\n  );\n}\n\nif (\n  !state.needFetched &&\n  state.contributionRequestFetched &&\n  !!state.contributionRequest.need\n) {\n  Near.asyncView(\n    ownerId,\n    \"get_contribution_need\",\n    { account_id: entityId, cid: state.contributionRequest.need },\n    \"final\",\n    false\n  ).then((need) => State.update({ need, needFetched: true }));\n}\n\nif (!state.contributionRequest) {\n  return \"Loading...\";\n}\n\nconst Controls = styled.div`\n  flex-direction: column;\n  justify-content: start;\n  align-items: stretch;\n  display: ${({ isAuthorized }) => (isAuthorized ? \"flex\" : \"none\")};\n`;\n\nconst AcceptButton = styled.button`\n  background-color: #12b76a;\n  border: 1px solid #12b76a;\n  border-radius: 4px;\n  padding: 0.5em 1em;\n  box-shadow: 0px 1px 2px rgba(16, 24, 40, 0.05);\n  color: white;\n  transition: background-color 0.2s ease-in-out;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: center;\n\n  &:hover {\n    background-color: #0e9f5d;\n  }\n`;\n\nconst RejectButton = styled.button`\n  background-color: white;\n  border: 1px solid #d0d5dd;\n  border-radius: 4px;\n  padding: 0.5em 1em;\n  margin-top: 0.5em;\n  color: #f04438;\n  transition-property: background-color, color;\n  transition-timing-function: ease-in-out;\n  transition-duration: 0.2s;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: center;\n\n  &:hover {\n    background-color: #f04438;\n    color: white;\n  }\n`;\n\nconst IconContainer = styled.i`\n  transform: translate(0, -1px);\n  margin-right: 0.25em;\n`;\n\nconst controls = (\n  <Controls isAuthorized={state.isAuthorized}>\n    <AcceptButton\n      onClick={() =>\n        Near.call(ownerId, \"approve_contribution\", {\n          entity_id: entityId,\n          contributor_id: contributorId,\n        })\n      }\n    >\n      <IconContainer>\n        <svg\n          width=\"20\"\n          height=\"20\"\n          viewBox=\"0 0 20 20\"\n          fill=\"none\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n        >\n          <path\n            d=\"M17.1666 5L7.99992 14.1667L3.83325 10\"\n            stroke=\"currentColor\"\n            stroke-width=\"1.66667\"\n            stroke-linecap=\"round\"\n            stroke-linejoin=\"round\"\n          />\n        </svg>\n      </IconContainer>\n      <span>Accept</span>\n    </AcceptButton>\n    <RejectButton\n      style={{ minWidth: \"7em\" }}\n      onClick={() =>\n        Near.call(ownerId, \"reject_contribution\", {\n          entity_id: entityId,\n          contributor_id: contributorId,\n        })\n      }\n    >\n      <IconContainer>\n        <svg\n          width=\"20\"\n          height=\"20\"\n          viewBox=\"0 0 20 20\"\n          fill=\"none\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n        >\n          <path\n            d=\"M15.5 5L5.5 15M5.5 5L15.5 15\"\n            stroke=\"currentColor\"\n            stroke-width=\"1.66667\"\n            stroke-linecap=\"round\"\n            stroke-linejoin=\"round\"\n          />\n        </svg>\n      </IconContainer>\n      <span>Reject</span>\n    </RejectButton>\n  </Controls>\n);\n\nconst Container = styled.div`\n  display: flex;\n  flex-direction: row;\n  justify-content: start;\n  min-height: 8em;\n  padding: 0 0.75em;\n  border-radius: 4px;\n  background-color: #f0f9ff;\n`;\n\nconst Wrapper = styled.div`\n  flex-grow: 1;\n  padding: 0.75em 0;\n`;\n\nconst DescriptionWrapper = styled.div`\n  margin-top: 0.5em;\n  padding-left: 0.5em;\n  border-left: 3px solid #b2ddff;\n`;\n\nreturn (\n  <Container id={`${entityId}-${contributorId}`}>\n    <Wrapper>\n      <Widget\n        src={`${ownerId}/widget/ProfileLine`}\n        props={{\n          accountId: contributorId,\n          imageSize: \"3em\",\n          update: props.update,\n          additionalText: (\n            <b>\n              {state.contributionRequest.need\n                ? \"sent a proposal to your request\"\n                : \"wants to contribute to your project\"}\n            </b>\n          ),\n          additionalColumn: controls,\n          additionalRow: (\n            <>\n              <Widget\n                src={`${ownerId}/widget/ProfileLine`}\n                props={{\n                  accountId: entityId,\n                  update: props.update,\n                  isEntity: true,\n                  imageSize: state.contributionRequest.need ? \"1.5em\" : \"2em\",\n                }}\n              />\n              {state.contributionRequest.need ? (\n                <b>\n                  Looking for {state.need.contribution_type}:{\" \"}\n                  {state.need.description}\n                </b>\n              ) : (\n                <></>\n              )}\n              <DescriptionWrapper>\n                <Widget\n                  src={`${ownerId}/widget/DescriptionArea`}\n                  props={{\n                    description: state.contributionRequest.description,\n                  }}\n                />\n              </DescriptionWrapper>\n            </>\n          ),\n        }}\n      />\n    </Wrapper>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/contribut3.near/widget/ContributionRequest", "fact_widget_deployments_id": "6421c5399b813bbdb1ef17c35e88e4b8", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}