{"tx_hash": "GQrXCqNiWkEvEtd4GuhYnmBCx4FQzxsbuUwUWkZCfQk5", "action_id_social": "4657UwnctVpx9XdMYa7RmTr2rinobbZAQzwxDgHvjezd-0-widget", "block_id": 100964391, "block_timestamp": "2023-09-12T14:16:02.614Z", "signer_id": "contribut3.near", "widget_name": "Inbox", "source_code": "const ownerId = \"contribut3.near\";\n\nif (!context.accountId) {\n  return (\n    <Widget\n      src={`${ownerId}/widget/InfoSegment`}\n      props={{\n        title: \"Not logged in!\",\n        description: \"You must log in to look at your notifications!\",\n      }}\n    />\n  );\n}\n\nconst Wrapper = styled.div`\n  padding-bottom: 48px;\n\n  > div {\n    > * {\n      margin-bottom: 12px;\n\n      &:last-child {\n        margin-bottom: 0;\n      }\n    }\n  }\n`;\n\nconst Header = styled.h1`\n  font-style: normal;\n  font-weight: 700;\n  font-size: 2em;\n  color: #101828;\n`;\n\nState.init({\n  projects: null,\n  projectsIsFetched: false,\n  vendors: null,\n  vendorsIsFetched: false,\n});\n\nif (!state.projectsIsFetched) {\n  Near.asyncView(\n    ownerId,\n    \"get_admin_projects\",\n    { account_id: context.accountId },\n    \"final\",\n    false,\n  ).then((projects) => State.update({ projects, projectsIsFetched: true }));\n}\n\nif (!state.vendorsIsFetched) {\n  Near.asyncView(\n    ownerId,\n    \"get_admin_vendors\",\n    { account_id: context.accountId },\n    \"final\",\n    false,\n  ).then((vendors) => State.update({ vendors, vendorsIsFetched: true }));\n}\n\nif (!state.projectsIsFetched || !state.vendorsIsFetched) {\n  return <>Loading...</>;\n}\n\nconst notifications = [\n  ...new Set([...state.projects, ...state.vendors, context.accountId]),\n]\n  .reduce((allNotifications, accountId) => {\n    const notificationsForAccount = Social.index(\"inbox\", accountId, {\n      order: \"desc\",\n      subscribe: true,\n    });\n\n    if (!notificationsForAccount) {\n      return allNotifications;\n    }\n\n    return [...allNotifications, ...notificationsForAccount];\n  }, [])\n  .sort((a, b) => b.blockHeight - a.blockHeight);\n\nconst List = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n  width: 100%;\n`;\n\nreturn (\n  <Wrapper>\n    <Header>Inbox</Header>\n    <List>\n      {notifications.map((item) => (\n        <Widget src={`${ownerId}/widget/Notification.Index`} props={item} />\n      ))}\n    </List>\n  </Wrapper>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/contribut3.near/widget/Inbox", "fact_widget_deployments_id": "39b155e949ea9cb673a11b84373a1772", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 5}