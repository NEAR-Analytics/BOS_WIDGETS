{"tx_hash": "5FUoxDbmPJCRo6g4UcyVrTa7dmW9dA5SBd6dYev8qJ3V", "action_id_social": "96cXEmfYEnYBsNk5isHC63XunCnigvV6LhJANSx8grRk-0-widget", "block_id": 116868634, "block_timestamp": "2024-04-15T02:36:24.635Z", "signer_id": "devs.near", "widget_name": "Common.Compose", "source_code": "const { User } = VM.require(\"buildhub.near/widget/components\") || {\n  User: () => <></>,\n};\nconst autocompleteEnabled = props.autocompleteEnabled ?? true;\nconst onPreview = props.onPreview;\nconst [editorKey, setEditorKey] = useState(0);\nconst memoizedEditorKey = useMemo(() => editorKey, [editorKey]);\nif (state.image === undefined) {\n  State.init({\n    image: {},\n    text: props.initialText || \"\",\n  });\n  if (props.onHelper) {\n    const extractMentions = (text) => {\n      const mentionRegex =\n        /@((?:(?:[a-z\\d]+[-_])*[a-z\\d]+\\.)*(?:[a-z\\d]+[-_])*[a-z\\d]+)/gi;\n      mentionRegex.lastIndex = 0;\n      const accountIds = new Set();\n      for (const match of text.matchAll(mentionRegex)) {\n        if (\n          !/[\\w`]/.test(match.input.charAt(match.index - 1)) &&\n          !/[/\\w`]/.test(match.input.charAt(match.index + match[0].length)) &&\n          match[1].length >= 2 &&\n          match[1].length <= 64\n        ) {\n          accountIds.add(match[1].toLowerCase());\n        }\n      }\n      return [...accountIds];\n    };\n    const extractHashtags = (text) => {\n      const hashtagRegex = /#(\\w+)/gi;\n      hashtagRegex.lastIndex = 0;\n      const hashtags = new Set();\n      for (const match of text.matchAll(hashtagRegex)) {\n        if (\n          !/[\\w`]/.test(match.input.charAt(match.index - 1)) &&\n          !/[/\\w`]/.test(match.input.charAt(match.index + match[0].length))\n        ) {\n          hashtags.add(match[1].toLowerCase());\n        }\n      }\n      return [...hashtags];\n    };\n    const extractMentionNotifications = (text, item) =>\n      extractMentions(text || \"\")\n        .filter((accountId) => accountId !== context.accountId)\n        .map((accountId) => ({\n          key: accountId,\n          value: {\n            type: \"mention\",\n            item,\n          },\n        }));\n    props.onHelper({\n      extractHashtags,\n      extractMentions,\n      extractTagNotifications: extractMentionNotifications,\n      extractMentionNotifications,\n    });\n  }\n}\nconst content = (state.text || state.image.cid || state.image.url) && {\n  type: \"md\",\n  text: state.text,\n  image: state.image.url\n    ? { url: state.image.url }\n    : state.image.cid\n    ? { ipfs_cid: state.image.cid }\n    : undefined,\n};\nif (content && props.extraContent) {\n  Object.assign(content, props.extraContent);\n}\nfunction autoCompleteAccountId(id) {\n  let text = state.text.replace(/[\\s]{0,1}@[^\\s]*$/, \"\");\n  text = `${text} @${id}`.trim() + \" \";\n  State.update({ text, showAccountAutocomplete: false });\n  setEditorKey((prev) => prev + 1);\n}\nconst onChange = (text) => {\n  const showAccountAutocomplete = /@[\\w][^\\s]*$/.test(text);\n  State.update({ text, showAccountAutocomplete });\n};\nconst jContent = JSON.stringify(content);\nif (props.onChange && jContent !== state.jContent) {\n  State.update({\n    jContent,\n  });\n  props.onChange({ content });\n}\nconst onCompose = () => {\n  State.update({\n    image: {},\n    text: \"\",\n  });\n};\nconst [gifSearch, setGifSearch] = useState(false);\nconst TextareaWrapper = styled.div`\n  display: grid;\n  vertical-align: top;\n  align-items: center;\n  position: relative;\n  align-items: stretch;\n  textarea {\n    display: flex;\n    align-items: center;\n    transition: all 0.3s ease;\n  }\n  textarea::placeholder {\n    padding-top: 4px;\n    font-size: 20px;\n  }\n  textarea:focus::placeholder {\n    font-size: inherit;\n    padding-top: 0px;\n  }\n  &::after,\n  textarea,\n  iframe {\n    width: 100%;\n    padding: 8px 0;\n    min-width: 1em;\n    height: unset;\n    min-height: 3em;\n    font: inherit;\n    margin: 0;\n    resize: none;\n    background: none;\n    appearance: none;\n    border: 0px solid #eee;\n    grid-area: 1 / 1;\n    overflow: hidden;\n    outline: none;\n  }\n  iframe {\n    padding: 0;\n  }\n  textarea:focus,\n  textarea:not(:empty) {\n    border-bottom: 1px solid #eee;\n    min-height: 5em;\n  }\n  &::after {\n    content: attr(data-value) \" \";\n    visibility: hidden;\n    white-space: pre-wrap;\n  }\n  &.markdown-editor::after {\n    padding-top: 66px;\n    font-family: monospace;\n    font-size: 14px;\n  }\n`;\nconst Wrapper = styled.div`\n  line-height: normal;\n  display: flex;\n  flex-direction: column;\n  gap: 1.5rem;\n  padding: 1.5rem;\n  .right {\n    flex-grow: 1;\n    min-width: 0;\n  }\n  .up-buttons {\n    margin-top: 12px;\n  }\n`;\nconst embedCss = `\n.rc-md-editor {\n  border: 0;\n}\n.rc-md-editor .editor-container>.section {\n  border: 0;\n}\n.rc-md-editor .editor-container .sec-md .input {\n  overflow-y: auto;\n  padding: 8px 0 !important;\n  line-height: normal;\n}\nhtml {\n  background: #23242b;\n}\n* {\n  border: none !important;\n}\n.rc-md-editor {\n  background: #4f5055;\n  border-top: 1px solid #4f5055 !important;\n  border-radius: 8px;\n}\n.editor-container {\n  background: #4f5055;\n}\n.drop-wrap {\n  \n  border-radius: 0.5rem !important;\n}\n.header-list {\n  display: flex;\n  align-items: center;\n}\ntextarea {\n  background: #23242b !important;\n  color: #fff !important;\n  font-family: sans-serif !important;\n  font-size: 1rem;\n  border: 1px solid #4f5055 !important;\n  border-top: 0 !important;\n  border-radius: 0 0 8px 8px;\n}\n.rc-md-navigation {\n  background: #23242b !important;\n  border: 1px solid #4f5055 !important;\n  border-top: 0 !important;\n  border-bottom: 0 !important;\n  border-radius: 8px 8px 0 0;\n  i {\n    color: #cdd0d5;\n  }\n}\n.editor-container {\n  border-radius: 0 0 8px 8px;\n}\n.rc-md-editor .editor-container .sec-md .input {\n  overflow-y: auto;\n  padding: 8px !important;\n  line-height: normal;\n  border-radius: 0 0 8px 8px;\n}\n`;\nconst gifSvg = (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    style={{ width: \"1em\", verticalAlign: \"-0.125em\" }}\n    fill=\"currentColor\"\n    viewBox=\"0 0 16 16\"\n  >\n    <path d=\"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z\" />\n    <text\n      x=\"8\"\n      y=\"11\"\n      text-anchor=\"middle\"\n      font-size=\"7\"\n      stroke=\"currentColor\"\n      strokeWidth=\"0.5\"\n    >\n      GIF\n    </text>\n  </svg>\n);\nconst gifSearchWidget = useMemo(\n  () =>\n    gifSearch ? (\n      <Widget\n        src=\"mob.near/widget/N.GifSearch\"\n        props={{\n          onHide: () => setGifSearch(false),\n          onSelect: (gif) => {\n            State.update({\n              image: { url: gif.url },\n            });\n            setGifSearch(false);\n          },\n        }}\n      />\n    ) : undefined,\n  [gifSearch]\n);\nconst MemoizedAvatar = useMemo(\n  () => <User accountId={context.accountId} />,\n  [context.accountId]\n);\nuseEffect(() => {\n  if (state.text === \"\") {\n    setEditorKey((prev) => prev + 1);\n  }\n}, [state.text]);\nreturn (\n  <Wrapper>\n    <div className=\"left\">{MemoizedAvatar}</div>\n    <div className=\"right\">\n      <TextareaWrapper\n        className={markdownEditor ? \"markdown-editor\" : \"\"}\n        data-value={state.text || \"\"}\n      >\n        <Widget\n          key={`markdown-editor-${markdownEditor}-${memoizedEditorKey}`}\n          src=\"mob.near/widget/MarkdownEditorIframe\"\n          props={{\n            initialText: state.text,\n            onChange,\n            embedCss,\n          }}\n        />\n        {autocompleteEnabled && state.showAccountAutocomplete && (\n          <div className=\"pt-1 w-100 overflow-hidden\">\n            <Widget\n              src=\"devs.near/widget/Common.AccountAutocomplete\"\n              props={{\n                term: state.text.split(\"@\").pop(),\n                onSelect: autoCompleteAccountId,\n                onClose: () => State.update({ showAccountAutocomplete: false }),\n              }}\n            />\n          </div>\n        )}\n      </TextareaWrapper>\n      <div className=\"up-buttons d-flex flex-row flex-wrap\">\n        <div className=\"flex-grow-1 d-flex\">\n          <IpfsImageUpload\n            image={state.image}\n            className=\"btn btn-outline-secondary border-0 rounded-5\"\n          />\n          <button\n            className=\"btn btn-outline-secondary border-0 rounded-5\"\n            onClick={() => setGifSearch(!gifSearch)}\n          >\n            {gifSvg}\n          </button>\n        </div>\n        <div className=\"d-flex align-items-center align-self-end\">\n          <div>{props.previewButton && props.previewButton()}</div>\n          <div>{props.composeButton && props.composeButton(onCompose)}</div>\n        </div>\n      </div>\n    </div>\n    {gifSearchWidget}\n  </Wrapper>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/devs.near/widget/Common.Compose", "fact_widget_deployments_id": "865bd6193bd90f85eb88590175336f12", "inserted_timestamp": "2024-04-15T04:38:44.803Z", "modified_timestamp": "2024-04-15T05:22:37.742Z", "__row_index": 61}