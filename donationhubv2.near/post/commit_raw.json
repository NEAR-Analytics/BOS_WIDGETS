{"tx_hash": "7LpmasvdMJi4mckwG4n1xvApBvgXmDD8USRA4rTizoST", "action_id_social": "8ZvmBCb3Mn4o1qyDUmsXbGMh54ru5hWSHfBfpZ5Hvfjk-0-widget", "block_id": 108263176, "block_timestamp": "2023-12-18T16:24:18.404Z", "signer_id": "donationhubv2.near", "widget_name": "post", "source_code": "const { className, title, icon, href, onClick } = props;\n\nconst { href: linkHref } = VM.require(\"devhub.near/widget/core.lib.url\");\n\nlinkHref || (linkHref = () => {});\nconst PostContainer = styled.div`\n    position: relative;\n  border: 1px solid #FFFFFF;\n  background-color: #151515;\n  padding: 16px;\n  border-radius: 15px\n  \n`;\n\nconst Button = styled.button`\n  position: absolute;\n  bottom: 16px;\n  right: 16px;\n   display: flex;\n  flex-direction: row;\n  justify-content: center;\n  align-items: center;\n  padding: 7px 15px;\n  min-width: 6.5em;\n  gap: 0.5em;\n  border: 1px solid #00ec97;\n  border-radius: 70px;\n  background: #00ec97;\n  color: #11181c;\n  font-style: normal;\n  font-weight: 750;\n  font-size: 18px;\n  text-align: center;\n  white-space: nowrap;\n  transition: all 0.4s ease-in-out;\n\n\n  &:hover,\n  &:focus,\n  &:active {\n    text-decoration: none;\n    background: #11181c;\n    border: 1px solid #11181c;\n    color: #fff;\n\n`;\n\nconst PostInfo = styled.div`\n  flex: 1;\n  padding: 10px;\n`;\n\nconst PostText = styled.p`\n  margin: 5px;\n`;\n\nconst info = props.information;\n\nState.init({\n  showVoters: false,\n  name: info.name,\n  description: String(info.description),\n  authorId: info.authorId,\n  timestamp: info.timestamp,\n  eth_address: info.eth_address,\n  bitkub_address: info.bitkub_address,\n  jfin_address: info.jfin_address,\n});\n\nlet des = state.description.split(\"~\");\n\nfunction readableDate(timestamp) {\n  var a = new Date(timestamp);\n  return a.toDateString() + \" \" + a.toLocaleTimeString();\n}\n\nconst timestamp = readableDate(\n  state.timestamp ? state.timestamp / 1000000 : Date.now()\n);\n\nconst sender = Ethers.send(\"eth_requestAccounts\", [])[0];\n\nconst erc20Abi = fetch(\n  \"https://gist.githubusercontent.com/veox/8800debbf56e24718f9f483e1e40c35c/raw/f853187315486225002ba56e5283c1dba0556e6f/erc20.abi.json\"\n);\nif (!erc20Abi.ok) {\n  return \"erc20Abi not ok\";\n}\n\nif (state.error) {\n  return (\n    <div>\n      Dear user, we regret to inform you that we have received an error callback\n      from the API. Our team is currently investigating the issue and working on\n      resolving it as soon as possible. We apologize for any inconvenience this\n      may have caused and thank you for your patience while we work to address\n      the problem.\n    </div>\n  );\n}\n\nif (!sender) return <Web3Connect connectLabel=\"Please Connect Your Wallet\" />;\n\nif (\n  state.chainId === undefined &&\n  ethers !== undefined &&\n  Ethers.send(\"eth_requestAccounts\", [])[0]\n) {\n  Ethers.provider()\n    .getNetwork()\n    .then((chainIdData) => {\n      if (chainIdData?.chainId) {\n        State.update({ chainId: chainIdData.chainId });\n      }\n    });\n}\n\nif (state.chainId === 1) {\n  State.update({\n    chainPicked: \"ETH\",\n    receiver: state.eth_address,\n  });\n} else if (state.chainId === 96) {\n  State.update({\n    chainPicked: \"KUB\",\n    receiver: state.bitkub_address,\n  });\n} else if (state.chainId === 3501) {\n  State.update({\n    chainPicked: \"JFIN\",\n    receiver: state.jfin_address,\n  });\n} else {\n  return (\n    <div>\n      <h3>\n        Wrong Network - We currently support the Ethereum, Bitkub Chain, and\n        JFIN Chain exclusively. Kindly confirm that you are connected to the\n        intended network before proceeding.\n      </h3>\n    </div>\n  );\n}\n\nconst chainChoice = (\n  <div class=\"d-flex flex-column mb-2\">\n    <div className=\"col-lg-6  mb-2\"></div>\n    Token: <b>{state.chainPicked}</b>\n    <span class=\"text-muted fw-normal\">\n      (You can change the token by changing the network)\n    </span>\n  </div>\n);\n\nconst donateAmount = (\n  <div class=\"d-flex flex-column mb-2\">\n    <div className=\"col-lg-6 mb-2\">\n      Donated amount <span class=\"text-muted fw-normal\">(Numbers Only)</span>\n      <input\n        type=\"number\"\n        step=\"0.000001\"\n        value={state.donate_amount !== null ? state.donate_amount : \"\"}\n        min={0}\n        onChange={(event) => {\n          const newValue = event.target.value;\n          // Ensure the input is a valid number\n          if (/^\\d*\\.?\\d{0,18}$/.test(newValue)) {\n            State.update({\n              donate_amount: newValue,\n            });\n          }\n        }}\n      />\n    </div>\n  </div>\n);\n\nasync function sendTokens() {\n  //   const erc20 = new ethers.Contract(\n  //     \"0x4d224452801ACEd8B2F0aebE155379bb5D594381\",\n  //     erc20Abi.body,\n  //     Ethers.provider().getSigner()\n  //   );\n  let amount = ethers.utils.parseUnits(state.donate_amount, 18);\n  //   console.log(\"hello \" + amount);\n  //   erc20.transfer(state.receiver, amount);\n  Ethers.provider()\n    .getSigner()\n    .sendTransaction({\n      to: state.receiver,\n      value: amount,\n    })\n    .then((tx) => {\n      console.log(\"tx \", tx);\n      if (state.chainId === 1) {\n        State.update({ txHash: \"https://etherscan.io/tx/\" + tx.hash });\n      } else if (state.chainId === 96) {\n        State.update({ txHash: \"https://www.bkcscan.com/tx/\" + tx.hash });\n      } else {\n        State.update({ txHash: \"https://www.exp.jfinchain.com/tx/\" + tx.hash });\n      }\n    })\n    .catch((error) => {\n      console.log(error);\n      //State.update({ error: true });\n      State.update({\n        errorText: \"Can't make the transaction. Kindly check your balance.\",\n      });\n    });\n}\n\nreturn (\n  <PostContainer>\n    <PostInfo>\n      <h2>\n        <b>{state.name}</b>\n      </h2>\n      <PostText>\n        <b>Description:</b> {des[2]}\n      </PostText>\n      <PostText>{des[0]}</PostText>\n      <PostText>{des[1]}</PostText>\n      <PostText>\n        <b>Posted By:</b> {state.authorId} \u00b7 {timestamp}\n      </PostText>\n    </PostInfo>\n    <PostInfo>\n      <h2>\n        <b>Donate</b>\n      </h2>\n      <div className=\"row\">\n        {chainChoice}\n        {donateAmount}\n      </div>\n      <div>\n        <b>{state.errorText}</b>\n      </div>\n      <button\n        style={{\n          width: \"7rem\",\n          backgroundColor: \"#0C7283\",\n          color: \"#f3f3f3\",\n        }}\n        className=\"btn btn-light mb-2 p-3\"\n        onClick={sendTokens}\n      >\n        Donate\n      </button>\n    </PostInfo>\n  </PostContainer>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/donationhubv2.near/widget/post", "fact_widget_deployments_id": "621660c014b250e839325a5e748addc3", "inserted_timestamp": "2023-12-18T18:21:17.285Z", "modified_timestamp": "2023-12-20T03:22:11.422Z", "__row_index": 9}