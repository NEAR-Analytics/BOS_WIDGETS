{"tx_hash": "C8Rr1rHA96zhbizwDzvxf6tdPwjdSdthqFLsfRrQmAQ6", "action_id_social": "2eMRrSQQxtdqYC7Pn3yTK2HbMCYRoPeJDn46xZB4upV6-0-widget", "block_id": 113425740, "block_timestamp": "2024-02-23T14:42:31.168Z", "signer_id": "potlock.near", "widget_name": "Profile.DonationsTable", "source_code": "const { ownerId, projectId, donations, nearToUsd, SUPPORTED_FTS, hrefWithParams } = props;\n\nconst nearLogo =\n  \"https://ipfs.near.social/ipfs/bafkreicdcpxua47eddhzjplmrs23mdjt63czowfsa2jnw4krkt532pa2ha\";\n\nconst { _address } = VM.require(`${ownerId}/widget/Components.DonorsUtils`);\n\nconst Container = styled.div`\n  display: flex;\n  flex-direction: column;\n  .search-bar > div {\n    background: white;\n  }\n`;\n\nconst Table = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 2rem;\n  background: white;\n  box-shadow: 0px 4px 12px -4px rgba(82, 82, 82, 0.2), 0px 2px 4px -2px rgba(82, 82, 82, 0.3);\n  border: 1px solid rgba(41, 41, 41, 0.5);\n  padding-bottom: 1rem;\n  .transaction {\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    .header {\n      background: #f6f5f3;\n      color: black;\n      font-weight: 600;\n      div {\n        width: 90px;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n      }\n      .address {\n        width: 160px;\n        text-align: center;\n      }\n    }\n    > div {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      gap: 1rem;\n      padding: 1rem;\n      margin: 8px 16px;\n    }\n    .type {\n      width: 150px;\n    }\n    @media only screen and (max-width: 992px) {\n      > div {\n        margin: 0;\n      }\n      .header .address {\n        width: 130px;\n      }\n      .header div {\n        font-size: 12px;\n      }\n    }\n    @media only screen and (max-width: 480px) {\n      > div {\n        padding: 1rem 0.5rem;\n        gap: 0.5rem;\n      }\n      .header .address {\n        width: 120px;\n      }\n      .header div {\n        width: 50px;\n        font-size: 10px;\n      }\n    }\n  }\n`;\n\nconst TrRow = styled.div`\n  > div,\n  > span {\n    width: 90px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    color: #292929;\n  }\n  .price {\n    display: flex;\n    gap: 1rem;\n    align-items: center;\n    img {\n      width: 1.5rem;\n    }\n  }\n  .address {\n    color: #292929;\n    display: flex;\n    align-items: center;\n    width: 160px;\n    justify-content: flex-start;\n    padding: 10px;\n    border-radius: 2px;\n    transition: all 200ms;\n    p {\n      text-align: center;\n      margin: 0;\n    }\n    .profile-image {\n      margin-right: 1rem;\n      width: 1.5rem;\n      height: 1.5rem;\n      margin-left: 0;\n    }\n    :hover {\n      background: #f6f5f3;\n    }\n  }\n  @media only screen and (max-width: 992px) {\n    > div,\n    > span {\n      font-size: 12px;\n    }\n    .price {\n      gap: 0.5rem;\n      img {\n        width: 1rem;\n      }\n    }\n    .address {\n      font-size: 12px;\n      width: 120px;\n      padding: 4px;\n      .profile-image {\n        width: 1.5rem;\n        height: 1.5rem;\n      }\n    }\n  }\n  @media only screen and (max-width: 480px) {\n    > div,\n    > span {\n      font-size: 10px;\n      width: 50px;\n    }\n    .address {\n      font-size: 10px;\n      .profile-image {\n        margin-right: 0.5rem;\n      }\n    }\n  }\n`;\nconst Stats = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n  align-items: center;\n  gap: 3rem;\n  padding: 1rem 0;\n  .label {\n    color: #7b7b7b;\n  }\n  .item,\n  .count {\n    display: flex;\n    gap: 8px;\n    align-items: center;\n  }\n  .amount {\n    font-weight: 600;\n  }\n  .count {\n    margin-left: auto;\n  }\n  .count .amount {\n    color: #dd3345;\n  }\n  @media only screen and (max-width: 480px) {\n    font-size: 12px;\n  }\n`;\n\nconst Filter = styled.div`\n  display: flex;\n  position: relative;\n  img {\n    height: 1rem;\n    cursor: pointer;\n  }\n`;\n\nconst Search = styled.div`\n  display: flex;\n  position: relative;\n  border-bottom: 1px solid #dbdbdb;\n  img {\n    position: absolute;\n    left: 1rem;\n    top: 50%;\n    transform: translateY(-50%);\n    pointer-events: none;\n  }\n  input {\n    padding: 1rem 0;\n    padding-left: 3rem;\n    width: 100%;\n    &:focus {\n      border: none;\n      box-shadow: none;\n    }\n  }\n`;\n\nconst APPLICATIONS_FILTERS = projectId\n  ? {\n      ALL: \"All donations\",\n      DIRECT: \"Direct donations\",\n      MATCHED_DONATIONS: \"Matched donations\",\n    }\n  : {\n      ALL: \"All donations\",\n      DIRECT: \"Direct donations\",\n      SPONSORSHIP: \"Sponsorship\",\n      MATCHED_DONATIONS: \"Matched donations\",\n    };\n\nconst [page, setPage] = useState(0);\nconst [totalDonations, setTotalDonation] = useState(donations);\nconst [filteredDonations, setFilteredDonations] = useState(donations);\nconst [search, setSearch] = useState(\"\");\nconst [sortVal, setSortVal] = useState(APPLICATIONS_FILTERS.ALL);\nconst perPage = 30; // need to be less than 50\n\nconst total = useMemo(() => {\n  let total = Big(0);\n  donations.forEach((donation) => {\n    total = total.plus(Big(donation.total_amount));\n  });\n  return total;\n}, [donations]);\n\nconst totalDonationAmount = SUPPORTED_FTS[\"NEAR\"].fromIndivisible(total.toString());\n\nconst stats = [{ label: \"Donated\", amount: (totalDonationAmount * nearToUsd).toFixed(2) }];\n\nuseEffect(() => {\n  setTotalDonation(donations);\n  setFilteredDonations(donations);\n}, [donations]);\n\nconst searchDonations = (searchTerm) => {\n  const filteredApplications = totalDonations.filter((item) => {\n    const searchIn = [\n      item.pot_name || \"\",\n      item.recipient_id || \"\",\n      item.project_id || \"\",\n      item.donor_id || \"\",\n      item.pot_id || \"\",\n    ];\n    return searchIn.some((item) => item.toLowerCase().includes(searchTerm.toLowerCase()));\n  });\n  return filteredApplications;\n};\n\nconst sortDonations = (sortVal) => {\n  const displayedDonations = searchDonations(search);\n  let filtered;\n  if (sortVal && sortVal !== APPLICATIONS_FILTERS.ALL) {\n    filtered = displayedDonations.filter((donation) => {\n      return APPLICATIONS_FILTERS[donation.type] === sortVal;\n    });\n    return filtered;\n  } else {\n    return displayedDonations;\n  }\n};\n\nconst getName = (donation) => {\n  switch (APPLICATIONS_FILTERS[donation.type]) {\n    case APPLICATIONS_FILTERS.DIRECT:\n      return _address(donation.recipient_id);\n    case APPLICATIONS_FILTERS.SPONSORSHIP:\n      return _address(donation.pot_name);\n    case APPLICATIONS_FILTERS.MATCHED_DONATIONS:\n      return (\n        <p>\n          &lt;{_address(donation.pot_name)}&gt;\n          <br /> {_address(donation.project_id)}\n        </p>\n      );\n    default:\n      return _address(donation.recipient_id);\n  }\n};\n\nreturn (\n  <Container>\n    <Stats>\n      {stats.map((stat) => (\n        <div className=\"item\">\n          <div className=\"amount\">${stat.amount}</div>\n          <div className=\"label\">{stat.label}</div>\n        </div>\n      ))}\n      <div className=\"count\">\n        <div className=\"label\">ALL DONATIONS</div>\n        <div className=\"amount\">{donations.length}</div>\n      </div>\n    </Stats>\n    <div className=\"search-bar\">\n      <Widget\n        src={`${ownerId}/widget/Project.SearchBar`}\n        props={{\n          title: sortVal,\n          tab: tab,\n          numItems: donations.length,\n          itemName: \"donation\",\n          sortList: Object.values(APPLICATIONS_FILTERS),\n          setSearchTerm: (value) => {\n            setSearch(value);\n            const filtered = searchDonations(value);\n            setFilteredDonations(filtered);\n          },\n          handleSortChange: (sortVal) => {\n            const filtered = sortDonations(sortVal);\n            setFilteredDonations(filtered);\n            setSortVal(sortVal);\n          },\n        }}\n      />\n    </div>\n    <Table>\n      <div className=\"transaction\">\n        <div className=\"header\">\n          <div className=\"address\">{projectId ? \"Donor\" : \"Project Name\"}</div>\n          <div className=\"type\">Type</div>\n          <div>Amount</div>\n          <div>Extra Fee</div>\n        </div>\n        {!filteredDonations.length && <div>No donations to display</div>}\n        {filteredDonations.map((donation) => {\n          const {\n            recipient_id,\n            donor_id,\n            total_amount,\n            pot_id,\n            base_currency,\n            ft_id,\n            referrer_fee,\n            chef_fee,\n            protocol_fee,\n            type,\n            project_id,\n          } = donation;\n\n          const isPot = !!pot_id;\n          const donationAmount =\n            SUPPORTED_FTS[(base_currency || ft_id).toUpperCase()].fromIndivisible(total_amount);\n\n          const recepientUrl = isPot\n            ? `?tab=pot&potId=${pot_id}`\n            : `?tab=project&projectId=${recipient_id}`;\n          const profileUrl = `?tab=profile&accountId=${donor_id}`;\n          const url = projectId ? profileUrl : recepientUrl;\n\n          const name = projectId ? _address(donor_id) : getName(donation);\n          const profileImg = projectId ? donor_id : project_id || recipient_id;\n\n          const fees = SUPPORTED_FTS[(base_currency || ft_id).toUpperCase()].fromIndivisible(\n            referrer_fee || 0 + chef_fee || 0 + protocol_fee || 0,\n            3\n          );\n          return (\n            <TrRow>\n              <a href={hrefWithParams(url)} className=\"address\" target=\"_blank\">\n                {type === \"SPONSORSHIP\" ? (\n                  <img\n                    className=\"profile-image\"\n                    src=\"https://ipfs.near.social/ipfs/bafkreib447lbtzgo4mbegsush6ybv5evwreeydgmlg2agn6vxlsf5gpmdq\"\n                    alt=\"pot\"\n                  />\n                ) : (\n                  <Widget\n                    src=\"mob.near/widget/ProfileImage\"\n                    props={{ accountId: profileImg, style: {} }}\n                  />\n                )}\n                {name}\n              </a>\n              <div className=\"type\">{APPLICATIONS_FILTERS[type]}</div>\n              <div className=\"price\">\n                <img src={nearLogo} alt=\"NEAR\" />\n                {donationAmount}\n              </div>\n              <div className=\"price\">\n                <img src={nearLogo} alt=\"NEAR\" />\n                {fees}\n              </div>\n            </TrRow>\n          );\n        })}\n      </div>\n      <Widget\n        src=\"baam25.near/widget/pagination\"\n        props={{\n          onClick: (page) => {\n            setPage(page);\n            setTotalDonation(donations.slice(page * perPage, (page + 1) * perPage));\n            setFilteredDonations(donations.slice(page * perPage, (page + 1) * perPage));\n          },\n          data: donations,\n          page: page,\n          perPage: perPage,\n          bgColor: \"#7B7B7B\",\n        }}\n      />\n    </Table>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/potlock.near/widget/Profile.DonationsTable", "fact_widget_deployments_id": "2b5e5613f1a9d870e1a84b02db7ffd2d", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 7}