{"tx_hash": "8du3EaEM1kgwG62DBV7UEb8Px3VxfcBZgnfEysbgWhPY", "action_id_social": "2eoCS1HzBFtXQugPB4m1mheiob8sE93ZtrisnBbAVKsb-0-widget", "block_id": 113301218, "block_timestamp": "2024-02-21T17:34:42.014Z", "signer_id": "potlock.near", "widget_name": "Profile.DonationsTable", "source_code": "const { ownerId, donations, nearToUsd, SUPPORTED_FTS, hrefWithEnv } = props;\n\nconst [page, setPage] = useState(0);\nconst [totalDonations, setTotalDonation] = useState(donations);\nconst [filteredDonations, setFilteredDonations] = useState(donations);\nconst [search, setSearch] = useState(\"\");\nconst perPage = 30; // need to be less than 50\n\nconst nearLogo =\n  \"https://ipfs.near.social/ipfs/bafkreicdcpxua47eddhzjplmrs23mdjt63czowfsa2jnw4krkt532pa2ha\";\n\nconst { _address } = VM.require(`${ownerId}/widget/Components.DonorsUtils`);\n\nconst Container = styled.div`\n  display: flex;\n  flex-direction: column;\n  .search-bar > div {\n    background: white;\n  }\n`;\n\nconst Table = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 2rem;\n  background: white;\n  box-shadow: 0px 4px 12px -4px rgba(82, 82, 82, 0.2), 0px 2px 4px -2px rgba(82, 82, 82, 0.3);\n  border: 1px solid rgba(41, 41, 41, 0.5);\n  padding-bottom: 1rem;\n  overflow-x: scroll;\n  .transcation {\n    display: grid;\n    width: 100%;\n    .header {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 1rem;\n      gap: 1rem;\n      background: #f6f5f3;\n      color: black;\n      font-weight: 600;\n      div {\n        width: 150px;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n      }\n    }\n  }\n`;\n\nconst TrRow = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  width: 100%;\n  gap: 1rem;\n  padding: 1rem;\n  > div,\n  > span {\n    width: 150px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    color: #292929;\n  }\n\n  .price {\n    display: flex;\n    gap: 1rem;\n    align-items: center;\n    img {\n      width: 1.5rem;\n    }\n  }\n  .address {\n    width: 200px;\n    color: #292929;\n    display: flex;\n    align-items: center;\n    justify-content: flex-start;\n    padding: 10px;\n    border-radius: 2px;\n    transition: all 200ms;\n    > .profile-image {\n      margin-right: 1rem;\n      margin-left: 0;\n    }\n    :hover {\n      background: #f6f5f3;\n    }\n  }\n`;\nconst Stats = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n  align-items: center;\n  gap: 3rem;\n  padding: 1rem 0;\n  .label {\n    color: #7b7b7b;\n  }\n  .item,\n  .count {\n    display: flex;\n    gap: 8px;\n    align-items: center;\n  }\n  .amount {\n    font-weight: 600;\n  }\n  .count {\n    margin-left: auto;\n  }\n  .count .amount {\n    color: #dd3345;\n  }\n`;\n\nconst Filter = styled.div`\n  display: flex;\n  position: relative;\n  img {\n    height: 1rem;\n    cursor: pointer;\n  }\n`;\n\nconst Search = styled.div`\n  display: flex;\n  position: relative;\n  border-bottom: 1px solid #dbdbdb;\n  img {\n    position: absolute;\n    left: 1rem;\n    top: 50%;\n    transform: translateY(-50%);\n    pointer-events: none;\n  }\n  input {\n    padding: 1rem 0;\n    padding-left: 3rem;\n    width: 100%;\n    &:focus {\n      border: none;\n      box-shadow: none;\n    }\n  }\n`;\n\nconst total = useMemo(() => {\n  let total = Big(0);\n  donations.forEach((donation) => {\n    total = total.plus(Big(donation.total_amount));\n  });\n  return total;\n}, [donations]);\n\nconst totalDonationAmount = SUPPORTED_FTS[\"NEAR\"].fromIndivisible(total.toString());\n\nconst stats = [{ label: \"Donated\", amount: (totalDonationAmount * nearToUsd).toFixed(2) }];\n\nuseEffect(() => {\n  setTotalDonation(donations);\n  setFilteredDonations(donations);\n}, [donations]);\n\nconst SearchBar = () => (\n  <Search>\n    <img\n      src=\"https://ipfs.near.social/ipfs/bafkreiaayazawvdxdt2f4ahyh3yy3sz622bwwxdnrj32jzkoec7k7jaxza\"\n      alt=\"search-icon\"\n    />\n    <input type=\"text\" placeholder=\"Search project\" onChange={(e) => setSearch(e.target.value)} />\n  </Search>\n);\n\nconst APPLICATIONS_FILTERS = {\n  ALL: \"All donations\",\n  DIRECT: \"Direct Donation\",\n  SPONSORSHIP: \"Sponsorship\",\n};\n\nconst searchDonations = (searchTerm) => {\n  const filteredApplications = totalDonations.filter((item) =>\n    (item.pot_name || item.recipient_id).toLowerCase().includes(searchTerm)\n  );\n  return filteredApplications;\n};\n\nconst sortDonations = (sortVal) => {\n  const displayedDonations = searchDonations(search);\n  let filtered;\n  switch (sortVal) {\n    case APPLICATIONS_FILTERS[ALL]:\n      return displayedDonations;\n\n    case APPLICATIONS_FILTERS[\"DIRECT\"]:\n      filtered = displayedDonations.filter((donation) => {\n        return !donation.pot_id;\n      });\n      return filtered;\n\n    case APPLICATIONS_FILTERS[\"SPONSORSHIP\"]:\n      filtered = displayedDonations.filter((donation) => {\n        return !!donation.pot_id;\n      });\n      return filtered;\n\n    default:\n      return displayedDonations;\n  }\n};\n\nreturn (\n  <Container>\n    <Stats>\n      {stats.map((stat) => (\n        <div className=\"item\">\n          <div className=\"amount\">${stat.amount}</div>\n          <div className=\"label\">{stat.label}</div>\n        </div>\n      ))}\n      <div className=\"count\">\n        <div className=\"label\">All DONATIONS</div>\n        <div className=\"amount\">{donations.length}</div>\n      </div>\n    </Stats>\n    {/* <SearchBar /> */}\n    <div className=\"search-bar\">\n      <Widget\n        src={`${ownerId}/widget/Project.SearchBar`}\n        props={{\n          title: \"Filter\",\n          tab: tab,\n          numItems: donations.length,\n          itemName: \"donation\",\n          sortList: Object.values(APPLICATIONS_FILTERS),\n          setSearchTerm: (value) => {\n            setSearch(value);\n            const filtered = searchDonations(value);\n            setFilteredDonations(filtered);\n          },\n          handleSortChange: (sortVal) => {\n            const filtered = sortDonations(sortVal);\n            setFilteredDonations(filtered);\n          },\n        }}\n      />\n    </div>\n    <Table>\n      <div className=\"transcation\">\n        <div className=\"header\">\n          <div style={{ width: \"200px\" }}>Project Name</div>\n          <div>Type</div>\n          <div>Amount</div>\n          <div>Extra Fee</div>\n        </div>\n        {!filteredDonations.length && <div>No donations to display</div>}\n        {filteredDonations.map((donation) => {\n          const {\n            recipient_id,\n            total_amount,\n            pot_id,\n            base_currency,\n            ft_id,\n            pot_name,\n            referrer_fee,\n            chef_fee,\n            protocol_fee,\n          } = donation;\n\n          const isPot = !!pot_id;\n          const donationAmount =\n            SUPPORTED_FTS[(base_currency || ft_id).toUpperCase()].fromIndivisible(total_amount);\n\n          const projectId = recipient_id || pot_id;\n          const url = isPot ? `?tab=pot&potId=${pot_id}` : `?tab=project&projectId=${recipient_id}`;\n          const name = isPot ? pot_name : recipient_id;\n\n          const fees = SUPPORTED_FTS[(base_currency || ft_id).toUpperCase()].fromIndivisible(\n            referrer_fee || 0 + chef_fee || 0 + protocol_fee || 0,\n            3\n          );\n          return (\n            <TrRow>\n              <a href={hrefWithEnv(url)} className=\"address\" target=\"_blank\">\n                {isPot ? (\n                  <img\n                    className=\"profile-image\"\n                    src=\"https://ipfs.near.social/ipfs/bafkreib447lbtzgo4mbegsush6ybv5evwreeydgmlg2agn6vxlsf5gpmdq\"\n                    alt=\"pot\"\n                  />\n                ) : (\n                  <Widget\n                    src=\"mob.near/widget/ProfileImage\"\n                    props={{ accountId: projectId, style: { width: \"2rem\", height: \"2rem\" } }}\n                  />\n                )}\n                {_address(name)}{\" \"}\n              </a>\n              <div>{isPot ? \"Sponsorship\" : \"Direct Donation\"}</div>\n              <div className=\"price\">\n                <img src={nearLogo} alt=\"NEAR\" />\n                {donationAmount}\n              </div>\n              <div className=\"price\">\n                <img src={nearLogo} alt=\"NEAR\" />\n                {fees}\n              </div>\n            </TrRow>\n          );\n        })}\n      </div>\n      <Widget\n        src=\"baam25.near/widget/pagination\"\n        props={{\n          onClick: (page) => {\n            setPage(page);\n            setTotalDonation(donations.slice(page * perPage, (page + 1) * perPage));\n            setFilteredDonations(donations.slice(page * perPage, (page + 1) * perPage));\n          },\n          data: donations,\n          page: page,\n          perPage: perPage,\n          bgColor: \"#7B7B7B\",\n        }}\n      />\n    </Table>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/potlock.near/widget/Profile.DonationsTable", "fact_widget_deployments_id": "cce603030d6b47182643577522d7e371", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 3}