{"tx_hash": "CXfXVKpwjbypZEimkJeMjNDLRjzHW7P2rfCoZvPoZJd9", "action_id_social": "EWQSaiwRngNVmoftc15hMremF1Q82Neob71sb9pMkPkd-0-widget", "block_id": 114343720, "block_timestamp": "2024-03-08T18:11:08.872Z", "signer_id": "potlock.near", "widget_name": "Pots.Payouts", "source_code": "// get donations\nconst { potId, potDetail } = props; // TODO: refactor to use PotsSDK\n// potDetail.cooldown_end_ms = 1709936649000; // TODO: remove this line\nconst { ownerId, SUPPORTED_FTS } = VM.require(\"potlock.near/widget/constants\") || {\n  ownerId: \"\",\n  SUPPORTED_FTS: {},\n};\nconst { calculatePayouts, yoctosToNear } = VM.require(\"potlock.near/widget/utils\") || {\n  calculatePayouts: () => {},\n  yoctosToNear: () => \"\",\n};\n\nconst PotSDK = VM.require(\"potlock.near/widget/SDK.pot\") || {\n  getPayoutsChallenges: () => {},\n};\n\nconst IPFS_BASE_URL = \"https://nftstorage.link/ipfs/\";\n// const ALERT_ICON_URL =\n//   IPFS_BASE_URL + \"bafkreicqarojxk6jhdtsk2scfsmnigqpxjfgar6om4wlhn5xmqbbu74u5i\";\n\nconst Container = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: flex-end;\n  gap: 24px;\n  width: 100%;\n  @media screen and (min-width: 375px) and (max-width: 768px) {\n    width: 99%;\n  }\n  @media screen and (max-width: 390px) {\n    width: 98%;\n  }\n`;\n\nconst OuterTextContainer = styled.div`\n  display: flex;\n  flex-direction: row;\n  gap: 10px;\n  @media screen and (max-width: 768px) {\n    padding-right: 10px;\n  }\n`;\n\nconst OuterText = styled.div`\n  color: #7b7b7b;\n  font-size: 14px;\n  font-weight: 500;\n  text-transform: uppercase;\n  line-height: 24px;\n  letter-spacing: 1.12px;\n  word-wrap: break-word;\n`;\n\nconst Count = styled.div`\n  color: #dd3345;\n  font-size: 14px;\n  font-weight: 600;\n  line-height: 24px;\n`;\n\nconst TableContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  border: 0.5px rgba(41, 41, 41, 0.5) solid;\n  box-shadow: 0px 4px 12px -4px rgba(82, 82, 82, 0.2);\n  border-radius: 6px;\n  width: 100%;\n  overflow-x: auto;\n  flex-wrap: nowrap;\n`;\n\nconst Header = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: space-between;\n  background: #f6f5f3;\n  width: 100%;\n`;\n\nconst HeaderItem = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: space-between;\n  justify-content: flex-start;\n  padding: 10px 20px;\n  width: ${100 / columns.length}%;\n`;\n\nconst HeaderItemText = styled.div`\n  color: #292929;\n  font-size: 14px;\n  font-weight: 600;\n  line-height: 24px;\n  word-wrap: break-word;\n`;\n\nconst Row = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: space-between;\n  width: 100%;\n`;\n\nconst RowItem = styled.a`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: flex-start;\n  gap: 20px;\n  padding: 20px;\n  width: ${100 / columns.length}%;\n  &:hover {\n    text-decoration: none;\n  }\n`;\n\nconst RowText = styled.div`\n  color: #292929;\n  font-size: 14px;\n  font-weight: 400;\n  line-height: 24px;\n  word-wrap: break-word;\n`;\n\nconst SearchBarContainer = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 16px;\n  width: 100%;\n  border-bottom: 1px #dbdbdb solid;\n  padding: 12px 24px;\n`;\n\nconst SearchBar = styled.input`\n  background: none;\n  width: 100%;\n  outline: none;\n  border: none;\n  color: #525252;\n  &:focus {\n    outline: none;\n    border: none;\n  }\n`;\n\nconst SearchIcon = styled.div`\n  display: flex;\n  width: 24px;\n  height: 24px;\n  align-items: center;\n  justify-content: center;\n`;\n\nconst InfoContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  width: 100%;\n  padding: 20px;\n  background: ${potDetail.all_paid_out\n    ? \"green\"\n    : potDetail.cooldown_end_ms\n    ? \"#E6B800\"\n    : \"#dd3345\"};\n  border-radius: 6px;\n  gap: 10px;\n`;\n\nconst WarningText = styled.div`\n  text-align: center;\n  color: white;\n  font-size: 16px;\n  font-weight: 600;\n  margin: 0 8px;\n\n  @media screen and (max-width: 768px) {\n    font-size: 12px;\n    margin-left: 4px;\n  }\n`;\nconst AlertSvg = styled.svg`\n  width: 24px;\n  // @media screen and (max-width: 768px) {\n  //   width: 24px;\n  // }\n`;\n\nconst DivLink = styled.div`\n  color: white;\n  font-size: 14px;\n  font-weight: 600;\n  text-decoration: underline;\n  cursor: pointer;\n`;\n\nState.init({\n  allPayouts: null,\n  filteredPayouts: null,\n});\n\nconst allDonationsForPot = Near.view(potId, \"get_public_round_donations\", {});\nif (!state.allPayout && allDonationsForPot) {\n  const calculatedPayouts = calculatePayouts(allDonationsForPot, potDetail.matching_pool_balance);\n  console.log(\"calculated payouts: \", calculatedPayouts);\n  if (potDetail.payouts.length) {\n    // handle these payouts, which don't contain all the info needed\n    // pot payouts contain id, project_id, amount & paid_at\n    // loop through potDetail payouts and synthesize the two sets of payouts, so projectId and matchingAmount are taken from potDetail payouts, and donorCount and totalAmount are taken from calculatedPayouts\n    const synthesizedPayouts = potDetail.payouts.map((payout) => {\n      const { project_id, amount } = payout;\n      const { totalAmount, matchingAmount, donorCount } = calculatedPayouts[project_id];\n      return {\n        projectId: project_id,\n        totalAmount,\n        matchingAmount: amount,\n        donorCount,\n      };\n    });\n    State.update({ allPayouts: synthesizedPayouts, filteredPayouts: synthesizedPayouts });\n  } else {\n    // calculate estimated payouts\n    const allPayouts = Object.entries(calculatedPayouts).map(\n      ([projectId, { totalAmount, matchingAmount, donorCount }]) => {\n        return {\n          projectId,\n          totalAmount,\n          matchingAmount,\n          donorCount,\n        };\n      }\n    ); // TODO: refactor to use PotsSDK (note that this is duplicated in Pots/Projects.jsx)\n    allPayouts.sort((a, b) => {\n      // sort by matching pool allocation, highest to lowest\n      return b.matchingAmount - a.matchingAmount;\n    });\n    State.update({ allPayouts, filteredPayouts: allPayouts });\n  }\n}\n\nconst payoutsChallenges = PotSDK.getPayoutsChallenges(potId);\n// console.log(\"payoutsChallenges: \", payoutsChallenges);\n\nconst columns = [\"Project\", \"Total Raised\", \"Total Unique Donors\", \"Matching Pool Allocation\"];\n\nconst { base_currency } = potDetail;\n\nconst searchPayouts = (searchTerm) => {\n  // filter payouts that match the search term (donor_id, project_id)\n  const filteredPayouts = state.allPayouts.filter((payout) => {\n    const { projectId } = payout;\n    const searchFields = [projectId];\n    return searchFields.some((field) => field.toLowerCase().includes(searchTerm.toLowerCase()));\n  });\n  filteredPayouts.sort((a, b) => {\n    // sort by matching pool allocation, highest to lowest\n    return b.matchingAmount - a.matchingAmount;\n  });\n  return filteredPayouts;\n};\n\nconst maxAccountIdLength = 20;\n\nreturn (\n  <Container>\n    <Widget\n      src={`${ownerId}/widget/Pots.NavOptionsMobile`}\n      props={{\n        ...props,\n      }}\n    />\n    <OuterTextContainer>\n      <OuterText>all payouts</OuterText>\n      <Count>{state.allPayouts.length}</Count>\n    </OuterTextContainer>\n    {!potDetail.payouts.length && (\n      <InfoContainer>\n        <Row style={{ justifyContent: \"center\" }}>\n          <AlertSvg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            fill=\"none\"\n            viewBox=\"0 0 24 24\"\n            stroke-width=\"1.5\"\n            stroke=\"white\"\n            aria-hidden=\"true\"\n            // width=\"18px\"\n          >\n            <path\n              stroke-linecap=\"round\"\n              stroke-linejoin=\"round\"\n              d=\"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z\"\n            ></path>\n          </AlertSvg>\n          <WarningText>\n            {potDetail.all_paid_out\n              ? \"All payouts have been paid out.\"\n              : potDetail.cooldown_end_ms\n              ? \"These payouts have been set on the contract but have not been paid out yet.\"\n              : \"These payouts are estimated amounts only and have not been set on the contract yet.\"}\n          </WarningText>\n        </Row>\n        {potDetail.cooldown_end_ms > Date.now() && <DivLink>Something doesn't look right?</DivLink>}\n      </InfoContainer>\n    )}\n    <TableContainer>\n      <SearchBarContainer>\n        <SearchIcon>\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n            <path\n              d=\"M15.7549 14.2549H14.9649L14.6849 13.9849C15.6649 12.8449 16.2549 11.3649 16.2549 9.75488C16.2549 6.16488 13.3449 3.25488 9.75488 3.25488C6.16488 3.25488 3.25488 6.16488 3.25488 9.75488C3.25488 13.3449 6.16488 16.2549 9.75488 16.2549C11.3649 16.2549 12.8449 15.6649 13.9849 14.6849L14.2549 14.9649V15.7549L19.2549 20.7449L20.7449 19.2549L15.7549 14.2549ZM9.75488 14.2549C7.26488 14.2549 5.25488 12.2449 5.25488 9.75488C5.25488 7.26488 7.26488 5.25488 9.75488 5.25488C12.2449 5.25488 14.2549 7.26488 14.2549 9.75488C14.2549 12.2449 12.2449 14.2549 9.75488 14.2549Z\"\n              fill=\"#C7C7C7\"\n            />\n          </svg>\n        </SearchIcon>\n        <SearchBar\n          placeholder=\"Search payouts\"\n          onChange={({ target: { value } }) => {\n            const filteredPayouts = searchPayouts(value);\n            State.update({ filteredPayouts });\n          }}\n        />\n      </SearchBarContainer>\n      <Header>\n        {/* {columns.map((column, index) => (\n          <HeaderItem>\n            <HeaderItemText key={index}>{column}</HeaderItemText>\n          </HeaderItem>\n        ))} */}\n        <HeaderItem style={{ width: \"40%\" }}>\n          <HeaderItemText>Project</HeaderItemText>\n        </HeaderItem>\n        <HeaderItem style={{ width: \"20%\" }}>\n          <HeaderItemText>Total Raised</HeaderItemText>\n        </HeaderItem>\n        <HeaderItem style={{ width: \"20%\" }}>\n          <HeaderItemText>Unique Donors</HeaderItemText>\n        </HeaderItem>\n        <HeaderItem style={{ width: \"20%\" }}>\n          <HeaderItemText>Pool Allocation</HeaderItemText>\n        </HeaderItem>\n      </Header>\n      {!state.filteredPayouts ? (\n        <div>Loading</div>\n      ) : state.filteredPayouts.length === 0 ? (\n        <Row style={{ padding: \"12px\" }}>No payouts to display</Row>\n      ) : (\n        state.filteredPayouts.map((payout, index) => {\n          const { projectId, donorCount, matchingAmount, totalAmount } = payout;\n          // const totalDonationAmount =\n          //   SUPPORTED_FTS[base_currency.toUpperCase()].fromIndivisible(total_amount);\n\n          return (\n            <Row key={index}>\n              {/* Project */}\n              <RowItem\n                href={`?tab=project&projectId=${projectId}`}\n                target={\"_blank\"}\n                style={{ width: \"40%\" }}\n              >\n                <Widget\n                  src={`${ownerId}/widget/Project.ProfileImage`}\n                  props={{\n                    ...props,\n                    accountId: projectId,\n                    style: {\n                      height: \"24px\",\n                      width: \"24px\",\n                    },\n                  }}\n                />\n                <RowText>\n                  {projectId.length > maxAccountIdLength\n                    ? projectId.slice(0, maxAccountIdLength) + \"...\"\n                    : projectId}\n                </RowText>\n              </RowItem>\n              {/* Total Raised */}\n              <RowItem style={{ width: \"20%\" }}>\n                <RowText>{yoctosToNear(totalAmount, true)}</RowText>\n              </RowItem>\n              {/* Total Unique Donors */}\n              <RowItem style={{ width: \"20%\" }}>\n                <RowText>{donorCount}</RowText>\n              </RowItem>\n              {/* Matching Pool Allocation */}\n              <RowItem style={{ width: \"20%\" }}>\n                <RowText>{yoctosToNear(matchingAmount, true)}</RowText>\n              </RowItem>\n            </Row>\n          );\n        })\n      )}\n    </TableContainer>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/potlock.near/widget/Pots.Payouts", "fact_widget_deployments_id": "c921ce9c497a54eb2108a51e098f8b97", "inserted_timestamp": "2024-03-08T19:26:13.400Z", "modified_timestamp": "2024-03-08T19:26:13.400Z", "__row_index": 7}