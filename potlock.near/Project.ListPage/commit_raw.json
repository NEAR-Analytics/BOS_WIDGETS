{"tx_hash": "4VfqZ6UtToDyFuTQCLb9Ez1sc1UqwCbe6T1r9AqGq2y3", "action_id_social": "B2E3cxoJeF3kWn62mS7sxVWvxbuJrKUixjM6zJuhTbjt-0-widget", "block_id": 104921559, "block_timestamp": "2023-11-04T14:05:08.018Z", "signer_id": "potlock.near", "widget_name": "Project.ListPage", "source_code": "const ownerId = \"potlock.near\";\nconst registryId = \"registry.potlock.near\"; // TODO: update when registry is deployed\n\nconst IPFS_BASE_URL = \"https://nftstorage.link/ipfs/\";\nconst DEFAULT_BANNER_IMAGE_URL =\n  IPFS_BASE_URL + \"bafkreih4i6kftb34wpdzcuvgafozxz6tk6u4f5kcr2gwvtvxikvwriteci\";\nconst DEFAULT_PROFILE_IMAGE_URL =\n  IPFS_BASE_URL + \"bafkreibwq2ucyui3wmkyowtzau6txgbsp6zizy4l2s5hkymsyv6tc75j3u\";\nconst HERO_BACKGROUND_IMAGE_URL =\n  IPFS_BASE_URL + \"bafkreiewg5afxbkvo6jbn6jgv7zm4mtoys22jut65fldqtt7wagar4wbga\";\n\nconst getImageUrlFromSocialImage = (image) => {\n  if (image.url) {\n    return image.url;\n  } else if (image.ipfs_cid) {\n    return IPFS_BASE_URL + image.ipfs_cid;\n  }\n};\n\nconst Container = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  width: 100%;\n  height: 100%;\n`;\n\nconst HeroOuter = styled.div`\n  padding: 136px 64px;\n`;\n\nconst HeroInner = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: space-between;\n`;\n\nconst SectionHeader = styled.div`\n  display: flex;\n  flex-direction: row;\n  width: 100%;\n  align-items: center;\n  margin-bottom: 24px;\n  padding: 96px 64px 24px 64px;\n`;\n\nconst SectionTitle = styled.div`\n  font-size: 24px;\n  font-weight: 600;\n  color: #2e2e2e;\n  font-family: Mona-Sans;\n`;\n\nconst ProjectsCount = styled.div`\n  color: #7b7b7b;\n  font-size: 24px;\n  font-weight: 400;\n  margin-left: 32px;\n`;\n\nconst ProjectsContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  // padding: 0px 64px 96px 64px;\n  // background: #fafafa;\n`;\n\nconst HeroContainer = styled.div`\n  width: 100%;\n  min-height: 700px;\n  position: relative;\n`;\n\nconst Hero = styled.img`\n  width: 100%;\n  height: 100%;\n  display: block;\n`;\n\nState.init({\n  registeredProjects: null, // TODO: change this back to null\n  // registeredProjects: sampleProjects,\n  getRegisteredProjectsError: \"\",\n});\n\nconst CATEGORY_MAPPINGS = {\n  \"social-impact\": \"Social Impact\",\n  \"non-profit\": \"NonProfit\",\n  climate: \"Climate\",\n  \"public-good\": \"Public Good\",\n  \"de-sci\": \"DeSci\",\n  \"open-source\": \"Open Source\",\n  community: \"Community\",\n  education: \"Education\",\n};\n\n// const HIDDEN_PROJECT_IDS = [\"roshaan.near\"];\n\nif (!state.registeredProjects) {\n  Near.asyncView(registryId, \"get_projects\", {})\n    .then((projects) => {\n      // get social data for each project\n      // name\n      // description\n      // bannerImage\n      // profileImage\n      // category\n      // horizon stuff, e.g. tags\n      Near.asyncView(\"social.near\", \"get\", {\n        keys: projects.map((project) => `${project.id}/profile/**`),\n      }).then((socialData) => {\n        const formattedProjects = projects.map((project) => {\n          const profileData = socialData[project.id]?.profile;\n          let profileImageUrl = DEFAULT_PROFILE_IMAGE_URL;\n          if (profileData.image) {\n            const imageUrl = getImageUrlFromSocialImage(profileData.image);\n            if (imageUrl) profileImageUrl = imageUrl;\n          }\n          // get banner image URL\n          let bannerImageUrl = DEFAULT_BANNER_IMAGE_URL;\n          if (profileData.backgroundImage) {\n            const imageUrl = getImageUrlFromSocialImage(profileData.backgroundImage);\n            if (imageUrl) bannerImageUrl = imageUrl;\n          }\n          const formatted = {\n            id: project.id,\n            name: profileData.name ?? \"\",\n            description: profileData.description ?? \"\",\n            bannerImageUrl,\n            profileImageUrl,\n            status: project.status,\n            tags: [profileData.category.text ?? CATEGORY_MAPPINGS[profileData.category] ?? \"\"], // TODO: change this to get tags from horizon/social\n          };\n          return formatted;\n        });\n        State.update({\n          registeredProjects: formattedProjects,\n        });\n      });\n    })\n    .catch((e) => {\n      console.log(\"error getting projects: \", e);\n      State.update({ getRegisteredProjectsError: e });\n    });\n}\n\nif (!state.registeredProjects) return \"\";\n\nconst userIsAdmin = props.registryAdmins && props.registryAdmins.includes(context.accountId);\n\nconst projects = userIsAdmin\n  ? state.registeredProjects\n  : state.registeredProjects.filter((project) => project.status === \"Approved\");\n\nreturn (\n  <>\n    <HeroContainer>\n      <Hero src={HERO_BACKGROUND_IMAGE_URL} alt=\"hero\" />\n      <Widget\n        src={`${ownerId}/widget/Components.Header`}\n        props={{\n          title1: \"Transforming\",\n          title2: \"Funding for Public Goods\",\n          description:\n            \"Discover impact projects, donate directly, or get automatic referral fees for raising donations\",\n          centered: true,\n          containerStyle: {\n            position: \"absolute\",\n            height: \"100%\",\n            top: 0,\n            left: 0,\n            background:\n              \"radial-gradient(80% 80% at 40.82% 50%, white 25%, rgba(255, 255, 255, 0) 100%)\",\n          },\n          buttonPrimary: (\n            <Widget\n              src={`${ownerId}/widget/Buttons.ActionButton`}\n              props={{\n                type: \"primary\",\n                text: \"Explore projects\",\n                disabled: false,\n                style: { padding: \"16px 24px\" },\n              }}\n            />\n          ),\n          buttonSecondary: (\n            <Widget\n              src={`${ownerId}/widget/Buttons.NavigationButton`}\n              props={{\n                type: \"secondary\",\n                text: \"Create project\",\n                disabled: false,\n                href: `?tab=createproject`,\n                style: { padding: \"16px 24px\" },\n              }}\n            />\n          ),\n        }}\n      />\n    </HeroContainer>\n    <ProjectsContainer>\n      <SectionHeader>\n        <SectionTitle>All projects</SectionTitle>\n        <ProjectsCount>{projects.length}</ProjectsCount>\n      </SectionHeader>\n      <Widget\n        src={`${ownerId}/widget/Project.ListSection`}\n        props={{\n          projects,\n          renderItem: (project) => (\n            <Widget\n              src={`${ownerId}/widget/Project.Card`}\n              props={{\n                project,\n                ...props,\n              }}\n            />\n          ),\n        }}\n      />\n    </ProjectsContainer>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/potlock.near/widget/Project.ListPage", "fact_widget_deployments_id": "23c1d3ecedd1ba910145587f274bf273", "inserted_timestamp": "2023-11-04T15:52:12.453Z", "modified_timestamp": "2023-11-04T15:52:12.453Z", "__row_index": 10}