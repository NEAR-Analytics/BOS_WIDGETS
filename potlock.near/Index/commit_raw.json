{"tx_hash": "5nMQuh8vNRZJwq1NzGHdYDYRMbLW7WH8NMRhNdtKJVgR", "action_id_social": "BGG2258YYR9ZZrRZRYSRy7QzKV67WJR1fdVm1Tvzf1CF-0-widget", "block_id": 104035579, "block_timestamp": "2023-10-23T13:59:05.803Z", "signer_id": "potlock.near", "widget_name": "Index", "source_code": "const ownerId = \"potlock.near\";\n\nconst CREATE_PROJECT_TAB = \"createproject\";\nconst PROJECT_DETAIL_TAB = \"project\";\n\nState.init({\n  tnc: true,\n  tncIsFetched: false,\n  tosAccept: true,\n});\n\n// if (context.accountId && !state.tncIsFetched) {\n//   Near.asyncView(\n//     \"social.near\",\n//     \"get\",\n//     {\n//       keys: [\n//         `${context.accountId}/profile/horizon_tnc`,\n//         `${context.accountId}/index/tosAccept`,\n//       ],\n//     },\n//     \"final\",\n//     false\n//   ).then((data) =>\n//     State.update({\n//       tnc: data[context.accountId]?.profile?.horizon_tnc === \"true\",\n//       tosAccept:\n//         data[context.accountId]?.index?.tosAccept &&\n//         data[context.accountId]?.index?.tosAccept.length > 0,\n//       tncIsFetched: true,\n//     })\n//   );\n// }\n\nconst tabContentWidget = {\n  // home: \"Dashboard\",\n  // inbox: \"Inbox\",\n  // manage: \"Manage\",\n  // project: \"Project.Page\",\n  // request: \"Request.Page\",\n  // vendor: \"Vendor.Page\",\n  // backer: \"Investor.Page\",\n  // contribution: \"Contribution.Page\",\n  [CREATE_PROJECT_TAB]: \"Project.Create\",\n  // createrequest: \"Request.Form\",\n  // createvendor: \"Vendor.Form\",\n  // createbacker: \"Investor.Form\",\n  // permissions: \"Inputs.SetUpPermissions\",\n  // learn: \"Learn.Page\",\n  // faq: \"FAQ.Page\",\n  // help: \"Help.Page\",\n  // legal: \"TNCPage\",\n  // admin: \"Admin.Page\",\n  projects: \"Project.ListPage\",\n  [PROJECT_DETAIL_TAB]: \"Project.Detail\",\n  // investors: \"Investor.ListPage\",\n  // backers: \"Investor.ListPage\",\n  // vendors: \"Vendor.ListPage\",\n  // contributors: \"Vendor.ListPage\",\n  // requests: \"Request.ListPage\",\n  // partners: \"Application.Page\",\n  // partner: \"Application.DetailPage\",\n  // \"my-projects\": \"Manage.Projects\",\n  // \"my-requests\": \"Manage.Requests\",\n  // \"my-contracts\": \"Manage.Contracts\",\n  // \"my-applications\": \"Manage.Applications\",\n  // events: \"Events.Page\",\n  // perks: \"Perks.Page\",\n  // profile: \"Profile.Page\",\n};\n\nconst successfulRegistration = props.tab == CREATE_PROJECT_TAB && props.transactionHashes;\n\nconst getWidget = (props) => {\n  if (successfulRegistration) {\n    // user just successfully registered their project\n    // navigate to the project page\n    // get the project ID (do this in getWidgetProps)\n    return tabContentWidget[PROJECT_DETAIL_TAB];\n  } else if (props.tab in tabContentWidget) {\n    return tabContentWidget[props.tab];\n  }\n  // backup (TODO: review)\n  return \"Project.ListPage\";\n};\n\nconst getTabWidget = (tab) => {\n  if (tab in tabContentWidget) {\n    return tabContentWidget[tab];\n  }\n\n  return \"Project.ListPage\";\n};\n\nconst getWidgetProps = () => {\n  const props = {\n    ...props,\n    urlProps: props,\n  };\n  if (successfulRegistration) {\n    props.successfulRegistration = true;\n    // get the project ID\n    // get list of all registered projects\n    // find the one that matches context.accountId\n    // pass this project in props to the project page\n  }\n  return {\n    ...props,\n    urlProps: props,\n    successfulRegistration,\n  };\n}; // TODO: IMPLEMENT\n\nconsole.log(\"Index props: \", props);\n\nconst tabContent = (\n  <Widget\n    src={`${ownerId}/widget/${\n      successfulRegistration ? tabContentWidget.projects : getTabWidget(props.tab)\n    }`}\n    props={{\n      ...props,\n      urlProps: props,\n      successfulRegistration,\n    }}\n  />\n);\n\n// const Page = styled.div`\n//   width: 100%;\n//   border-radius: 0.5rem;\n//   border: 1px solid #eaeaea;\n// `;\n\nconst Content = styled.div`\n  padding-top: 110px; // navbar height\n  width: 100%;\n  height: 100%;\n  background: #ffffff;\n  // padding: 3em;\n  border-radius: 0rem 0rem 1.5rem 1.5rem;\n  border-top: 1px solid var(--ui-elements-light, #eceef0);\n  background: var(--base-white, #fff);\n\n  &.form {\n    border: none;\n    background: #fafafa;\n  }\n`;\n\n// const showSidebar = ![\n//   \"createproject\",\n//   \"createrequest\",\n//   \"createvendor\",\n//   \"createbacker\",\n//   \"permissions\",\n//   \"legal\",\n// ].includes(props.tab);\nconst isForm = [\n  CREATE_PROJECT_TAB,\n  // \"createrequest\",\n  // \"createvendor\",\n  // \"createbacker\",\n].includes(props.tab);\n\n// const showTncDialog = !state.tnc && state.tosAccept && props.tab !== \"legal\";\n\nreturn (\n  <>\n    <Widget src={`${ownerId}/widget/Nav`} />\n    {/* <Widget\n      src={`${ownerId}/widget/Components.Header`}\n      props={{\n        title: \"Create new project\",\n        description:\n          \"Lorem ipsum dolor sit amet consectetur. Vel sit nunc in nunc. Viverra arcu eu sed consequat.\",\n      }}\n    /> */}\n    {/* <Widget src={`${ownerId}/widget/Project.Form`} /> */}\n    <Content className={isForm ? \"form\" : \"\"}>{tabContent}</Content>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/potlock.near/widget/Index", "fact_widget_deployments_id": "62affc87c1766cf25759e8ff82d3c9df", "inserted_timestamp": "2023-10-23T15:49:49.098Z", "modified_timestamp": "2023-10-23T15:49:49.098Z", "__row_index": 102}