{"tx_hash": "CZ4cNi8MpWt6tbUTw5D4u1mvGKmyRdNnjM2vVy4dH1Kq", "action_id_social": "DfDbPxXJ3LTLKotXcbmk8aSwpLtPBycCL7LSTQBgEYNK-0-widget", "block_id": 117690964, "block_timestamp": "2024-04-26T21:13:56.629Z", "signer_id": "potlock.near", "widget_name": "ModalDonation.Form", "source_code": "const { ownerId, NADABOT_HUMAN_METHOD } = VM.require(\"potlock.near/widget/constants\") || {\n  ownerId: \"\",\n  NADABOT_HUMAN_METHOD: \"\",\n};\n\nconst { AmountInput } = VM.require(`potlock.near/widget/ModalDonation.AmountInput`) || {\n  AmountInput: () => {},\n};\nconst { Checks } = VM.require(`potlock.near/widget/ModalDonation.Checks`) || {\n  Checks: () => {},\n};\nconst { VerifyInfo, Alert } = VM.require(`potlock.near/widget/ModalDonation.Banners`) || {\n  VerifyInfo: () => {},\n  Alert: () => {},\n};\n\nconst PotSDK = VM.require(\"potlock.near/widget/SDK.pot\") || {\n  getConfig: () => {},\n};\n\nconst Form = styled.div`\n  display: flex;\n  flex-direction: column;\n  padding: 1.5rem 2rem;\n  @media only screen and (max-width: 480px) {\n    padding: 1.5rem 1.125rem;\n  }\n`;\n\nconst Label = styled.div`\n  font-weight: 500;\n  margin-bottom: 0.5rem;\n  margin-top: 0.5rem;\n`;\n\nconst Button = styled.div`\n  display: flex;\n  margin-top: 4rem;\n  margin-bottom: 0.5rem;\n  button {\n    padding: 12px 16px;\n    width: 100%;\n    font-weight: 500;\n  }\n  @media only screen and (max-width: 480px) {\n    margin-top: 2rem;\n  }\n`;\n\nconst CurrentBalance = styled.div`\n  display: flex;\n  margin-top: 0.5rem;\n  gap: 0.5rem;\n  justify-content: flex-end;\n  .amount-alert {\n    color: #e54141;\n  }\n  .balance {\n    display: flex;\n    gap: 0.5rem;\n    div:last-of-type {\n      color: #7b7b7b;\n    }\n  }\n`;\n\nconst PotWrapper = styled.div`\n  display: flex;\n  flex-direction: column;\n  margin-top: 1.5rem;\n`;\n\nconst PotSelector = styled.div`\n  display: flex;\n  > div:last-of-type {\n    width: 100%;\n  }\n`;\n\nconst Pot = styled.div`\n  border-radius: 6px;\n  border: 1px solid #dbdbdb;\n  border-bottom-width: 2px;\n  background: #fff;\n  padding: 0.75rem 1rem;\n`;\n\nconst SelectPot = ({ selectedRound, activeRoundsOptions, updateState }) => (\n  <PotSelector>\n    <Widget\n      src={`${ownerId}/widget/Inputs.Dropdown`}\n      props={{\n        sortVal: activeRoundsOptions ? activeRoundsOptions[selectedRound].label : \"\",\n        showCount: false,\n        sortList: Object.values(activeRoundsOptions),\n        buttonStyle: {\n          border: \"1px solid #dbdbdb\",\n          padding: \"0.75rem 1rem\",\n          borderBottomWidth: \"2px\",\n          borderRadius: \"6px\",\n          justifyContent: \"space-between\",\n        },\n        menuStyle: {\n          top: \"120%\",\n        },\n        FilterMenuCustomStyle: `left:0; right:auto;`,\n        handleSortChange: ({ val }) => {\n          updateState({\n            selectedRound: val,\n          });\n        },\n      }}\n    />\n  </PotSelector>\n);\n\nconst FormDirect = (props) => {\n  const {\n    projectId,\n    profile,\n    amount,\n    amountError,\n    denominationOptions,\n    updateState,\n    selectedDenomination,\n    donationType,\n    ftBalance,\n    activeRounds,\n    NADABOT_CONTRACT_ID,\n    accountId,\n  } = props;\n\n  const isUserHumanVerified = Near.view(NADABOT_CONTRACT_ID, NADABOT_HUMAN_METHOD, {\n    account_id: accountId,\n  });\n\n  const needsToVerify = isUserHumanVerified === false && donationType === \"pot\";\n\n  const donationTypes = [\n    {\n      label: \"Direct donation\",\n      val: \"direct\",\n      disabled: false,\n    },\n    {\n      label: \"Quadratically matched donation\",\n      val: \"pot\",\n      disabled: !activeRounds || activeRounds.length === 0,\n      disabledText: \"(no pots available)\",\n    },\n  ];\n\n  const activeRoundsOptions = {};\n\n  (activeRounds || []).forEach((round) => {\n    activeRoundsOptions[round] = {\n      label: PotSDK.getConfig(round)?.pot_name || round,\n      val: round,\n    };\n  });\n\n  const isFtDonation = selectedDenomination.text !== \"NEAR\";\n\n  const HandleAmoutChange = (amount) => {\n    amount = amount.replace(/[^\\d.]/g, \"\"); // remove all non-numeric characters except for decimal\n    if (amount === \".\") amount = \"0.\";\n    updateState({ amount, amountError: \"\" });\n    // error if amount is greater than balance\n    if (amount > ftBalance && ftBalance !== null) {\n      updateState({ amountError: \"You don\u2019t have enough balance to complete this transaction.\" });\n    } else if (!isFtDonation && parseFloat(amount) < 0.1) {\n      updateState({ amountError: \"Minimum donation is 0.1 NEAR\" });\n    }\n  };\n\n  const isLoading =\n    donationType === \"pot\" ? isUserHumanVerified === null || activeRounds === null : false;\n\n  return projectId ? (\n    profile === null ? (\n      <Widget src={`${ownerId}/widget/Components.Loading`} />\n    ) : (\n      <Form>\n        <Label>How do you want to donate?</Label>\n        <Checks\n          options={donationTypes}\n          value={donationType}\n          onClick={(val) =>\n            updateState({\n              donationType: val,\n            })\n          }\n        />\n        {donationType === \"pot\" && (\n          <PotWrapper>\n            <Label>Select Pot</Label>\n            <SelectPot {...props} activeRoundsOptions={activeRoundsOptions} />\n          </PotWrapper>\n        )}\n        <Label\n          style={{\n            marginTop: \"1.5rem\",\n          }}\n        >\n          Amount\n        </Label>\n        <AmountInput\n          value={amount}\n          donationType={donationType}\n          HandleAmoutChange={HandleAmoutChange}\n          updateState={updateState}\n          denominationOptions={denominationOptions}\n          selectedDenomination={selectedDenomination}\n        />\n\n        {ftBalance && (\n          <CurrentBalance>\n            <div className=\"balance\">\n              <div>\n                {ftBalance} <span> {selectedDenomination.text} </span>\n              </div>\n              <div>available</div>\n            </div>\n          </CurrentBalance>\n        )}\n        {amountError && <Alert error={amountError} />}\n        {needsToVerify && <VerifyInfo />}\n\n        <Button>\n          <Widget\n            src={`${ownerId}/widget/Components.Button`}\n            props={{\n              type: \"primary\",\n              disabled: amountError || !amount,\n              text: isLoading ? \"Loading...\" : \"Proceed to donate\",\n              onClick: () => updateState({ currentPage: \"confirm\" }),\n            }}\n          />\n        </Button>\n      </Form>\n    )\n  ) : (\n    \"\"\n  );\n};\n\nreturn {\n  FormDirect,\n};\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/potlock.near/widget/ModalDonation.Form", "fact_widget_deployments_id": "04956bfd541bbae08828c9ce13402ae9", "inserted_timestamp": "2024-04-26T22:40:24.736Z", "modified_timestamp": "2024-04-26T22:40:24.736Z", "__row_index": 0}