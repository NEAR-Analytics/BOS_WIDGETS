{"tx_hash": "HKrZByHwwFc78v8m6tizrWEoipu5cLfoQqS9RX1QHWEV", "action_id_social": "77yq7hYsfBrJXN6UUVVbnUqwYcQRSmX3bCMkbkNtTGtk-0-widget", "block_id": 113097790, "block_timestamp": "2024-02-18T17:29:03.913Z", "signer_id": "potlock.near", "widget_name": "Pots.Sponsors", "source_code": "// get donations\nconst {\n  ownerId,\n  potId,\n  potDetail,\n  SUPPORTED_FTS: { NEAR },\n} = props;\n\nState.init({\n  donations: null,\n});\n\nif (!state.allDonations) {\n  Near.asyncView(potId, \"get_matching_pool_donations\", {}).then((donations) => {\n    // sort by size)\n    donations.sort(\n      (a, b) => NEAR.fromIndivisible(b.total_amount) - NEAR.fromIndivisible(a.total_amount)\n    );\n    // add % share of total to each donation\n    const total = NEAR.fromIndivisible(potDetail.matching_pool_balance);\n    donations = donations.map((donation) => {\n      return {\n        ...donation,\n        percentage_share: (NEAR.fromIndivisible(donation.net_amount) / total) * 100,\n      };\n    });\n    State.update({ donations });\n  });\n}\n\nif (!state.donations) return \"Loading...\";\n\nconst columns = [\"Rank\", \"Donor\", \"Amount\", \"Percentage Share\"];\n\nconst Container = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: flex-end;\n  gap: 24px;\n  width: 100%;\n`;\n\nconst OuterTextContainer = styled.div`\n  display: flex;\n  flex-direction: row;\n  gap: 10px;\n`;\n\nconst TableContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  border: 0.5px rgba(41, 41, 41, 0.5) solid;\n  box-shadow: 0px 4px 12px -4px rgba(82, 82, 82, 0.2);\n  border-radius: 2px;\n  width: 100%;\n`;\n\nconst Header = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: space-between;\n  background: #f6f5f3;\n  width: 100%;\n`;\n\nconst HeaderItem = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: space-between;\n  justify-content: flex-start;\n  padding: 10px 20px;\n  width: ${95 / columns.length}%;\n`;\n\nconst HeaderItemText = styled.div`\n  color: #292929;\n  font-size: 14px;\n  font-weight: 600;\n  line-height: 24px;\n  word-wrap: break-word;\n`;\n\nconst Row = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: space-between;\n  width: 100%;\n`;\n\nconst RowItem = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: flex-start;\n  gap: 20px;\n  padding: 20px;\n  width: ${95 / columns.length}%;\n`;\n\nconst RowText = styled.div`\n  color: #292929;\n  font-size: 14px;\n  font-weight: 400;\n  line-height: 24px;\n  word-wrap: break-word;\n`;\n\nconst { base_currency } = potDetail;\n\nconst maxRowItemLength = 14;\n\nreturn (\n  <Container>\n    <Widget\n      src={`${ownerId}/widget/Pots.NavOptionsMobile`}\n      props={{\n        ...props,\n      }}\n    />\n    <TableContainer>\n      <Header>\n        {columns.map((column, index) => (\n          <HeaderItem style={index === 0 ? { width: \"5%\" } : {}}>\n            <HeaderItemText key={index}>{column}</HeaderItemText>\n          </HeaderItem>\n        ))}\n      </Header>\n      {state.donations.length === 0 ? (\n        <Row style={{ padding: \"12px\" }}>No donations to display</Row>\n      ) : (\n        state.donations.map((donation, index) => {\n          const { donor_id, total_amount, donated_at, percentage_share } = donation;\n          const totalDonationAmount =\n            props.SUPPORTED_FTS[base_currency.toUpperCase()].fromIndivisible(total_amount);\n\n          return (\n            <Row key={index}>\n              <RowItem style={{ width: \"5%\" }}>\n                <RowText>#{index + 1}</RowText>\n              </RowItem>\n              <RowItem>\n                <Widget\n                  src={`${ownerId}/widget/Project.ProfileImage`}\n                  props={{\n                    ...props,\n                    accountId: donor_id,\n                    style: {\n                      height: \"24px\",\n                      width: \"24px\",\n                    },\n                  }}\n                />\n                <RowText>\n                  {donor_id.length > maxRowItemLength\n                    ? donor_id.slice(0, maxRowItemLength) + \"...\"\n                    : donor_id}\n                </RowText>\n              </RowItem>\n              <RowItem>\n                <RowText>\n                  {totalDonationAmount} {base_currency.toUpperCase()}\n                </RowText>\n              </RowItem>\n              <RowItem>\n                <RowText>{percentage_share.toFixed(0)}%</RowText>\n              </RowItem>\n            </Row>\n          );\n        })\n      )}\n    </TableContainer>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/potlock.near/widget/Pots.Sponsors", "fact_widget_deployments_id": "ee14230e1e234e5ff667e32c59323056", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 17}