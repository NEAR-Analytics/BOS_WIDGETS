{"tx_hash": "ExchXdWti5ByiXAm7CcZkFgURv1JKTZ72j2t1WFALKdB", "action_id_social": "48p2sQZ246zWoZmZ78KTUN3eVjv95a8aaJqBCcfkbQsg-0-widget", "block_id": 114024869, "block_timestamp": "2024-03-03T17:01:31.837Z", "signer_id": "potlock.near", "widget_name": "Profile.Detail", "source_code": "const {\n  SUPPORTED_FTS: { NEAR },\n} = props;\nconst { DONATION_CONTRACT_ID, ownerId } = VM.require(\"potlock.near/widget/constants\") || {\n  DONATION_CONTRACT_ID: \"\",\n  ownerId: \"\",\n};\n\nlet DonateSDK =\n  VM.require(\"potlock.near/widget/SDK.donate\") ||\n  (() => ({\n    asyncGetDonationsForDonor: () => {},\n  }));\nDonateSDK = DonateSDK({ env: props.env });\n\nlet PotFactorySDK =\n  VM.require(\"potlock.near/widget/SDK.potfactory\") ||\n  (() => ({\n    getPots: () => {},\n  }));\nPotFactorySDK = PotFactorySDK({ env: props.env });\nconst pots = PotFactorySDK.getPots();\n\nconst PotSDK = VM.require(\"potlock.near/widget/SDK.pot\") || {\n  asyncGetConfig: () => {},\n  asyncGetDonationsForDonor: () => {},\n};\n\nconst accountId = props.accountId ?? context.accountId;\n\nconst { ProfileOptions } = VM.require(`${ownerId}/widget/Profile.Options`);\n\nif (!accountId) {\n  return \"No account ID\";\n}\n\nconst [directDonations, setDirectDonations] = useState(null);\n// mapping of pot IDs to array of sponsorship (matching pool) donations to this pot for this user\nconst [sponsorshipDonations, setSponsorshipDonations] = useState({});\nconst [potDonations, setPotDonations] = useState([]);\n\nconst getSponsorshipDonations = (potId, potDetail) => {\n  return PotSDK.asyncGetDonationsForDonor(potId, accountId)\n    .then((donations) => {\n      donations = donations.filter((donations) => donations.donor_id === accountId);\n      const updatedDonations = donations.map((donation) => ({\n        ...donation,\n        base_currency: potDetail.base_currency,\n        pot_name: potDetail.pot_name,\n        pot_id: potId,\n        type: donation.project_id ? \"MATCHED_DONATIONS\" : \"SPONSORSHIP\",\n      }));\n      if (sponsorshipDonations[potId]) return \"\";\n      setSponsorshipDonations((prevSponsorshipDonations) => {\n        return { ...prevSponsorshipDonations, [potId]: updatedDonations };\n      });\n    })\n    .catch(() => {\n      if (sponsorshipDonations[potId]) return \"\";\n      setSponsorshipDonations((prevSponsorshipDonations) => {\n        return { ...prevSponsorshipDonations, [potId]: [] };\n      });\n    });\n};\n\n// Get Direct Donations\nif (!directDonations) {\n  DonateSDK.asyncGetDonationsForDonor(accountId).then((donations) => {\n    donations = donations.map((donation) => ({\n      ...donation,\n      type: \"DIRECT\",\n    }));\n    setDirectDonations(donations);\n  });\n}\n// Get Sponsorship Donations\nif (pots && !sponsorshipDonations[pots[pots.length - 1].id]) {\n  pots.forEach((pot) => {\n    PotSDK.asyncGetConfig(pot.id).then((potDetail) => {\n      getSponsorshipDonations(pot.id, potDetail);\n    });\n  });\n}\n\nconst allDonations = useMemo(() => {\n  const sponsorshipDonationsValue = Object.values(sponsorshipDonations).flat();\n  const allDonations = [...(directDonations || []), ...sponsorshipDonationsValue];\n  allDonations.sort((a, b) => b.donated_at - a.donated_at);\n  return allDonations;\n}, [sponsorshipDonations, directDonations]);\n\nconst profile = props.profile ?? Social.getr(`${accountId}/profile`);\nconst tags = Object.keys(profile.tags || {});\nif (profile === null) {\n  return \"Loading\";\n}\n\nconst Wrapper = styled.div`\n  display: flex;\n  flex-direction: column;\n`;\nreturn (\n  <Wrapper>\n    <Widget\n      src={`${ownerId}/widget/Profile.Body`}\n      props={{\n        ...props,\n        profile,\n        tags,\n        accounts: [accountId],\n        donations: allDonations, // TODO: why is this fetched here when it's not used in this component?\n        nav: props.nav ?? \"donations\",\n        navOptions: ProfileOptions(props),\n      }}\n    />\n  </Wrapper>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/potlock.near/widget/Profile.Detail", "fact_widget_deployments_id": "a2acbbe6b0cbe500b4ce67ebfbd43327", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 10}