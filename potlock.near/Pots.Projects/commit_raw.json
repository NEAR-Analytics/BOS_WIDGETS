{"tx_hash": "CZ4cNi8MpWt6tbUTw5D4u1mvGKmyRdNnjM2vVy4dH1Kq", "action_id_social": "DfDbPxXJ3LTLKotXcbmk8aSwpLtPBycCL7LSTQBgEYNK-0-widget", "block_id": 117690964, "block_timestamp": "2024-04-26T21:13:56.629Z", "signer_id": "potlock.near", "widget_name": "Pots.Projects", "source_code": "const PotSDK = VM.require(\"potlock.near/widget/SDK.pot\") || {\n  getApprovedApplications: () => {},\n  getPublicRoundDonations: () => {},\n  getFlaggedAccounts: () => {},\n};\n\n// Card Skeleton - Loading fallback\nconst loadingSkeleton = styled.keyframes`\n  0% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.4;\n  }\n  100% {\n    opacity: 1;\n  }\n`;\n\nconst CardSkeletonContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 447px;\n  width: 100%;\n  max-width: 400px;\n  border-radius: 12px;\n  background: white;\n  box-shadow: 0px -2px 0px #dbdbdb inset;\n  border: 1px solid #dbdbdb;\n  margin-left: auto;\n  margin-right: auto;\n  overflow: hidden;\n  animation-name: ${loadingSkeleton};\n  animation-duration: 1s;\n  animation-iteration-count: infinite;\n`;\n\nconst HeaderSkeleton = styled.div`\n  display: block;\n  width: 100%;\n  height: 168px;\n  background: #eee;\n`;\n\nconst ProfileImageSkeleton = styled.div`\n  background: #e0e0e0;\n  margin-left: 32px;\n  transform: translateY(148px);\n  width: 40px;\n  height: 40px;\n  position: absolute;\n  border-radius: 999px;\n`;\n\nconst TitleSkeleton = styled.div`\n  width: 120px;\n  height: 24px;\n  background: #eee;\n  margin-left: 24px;\n  margin-top: 24px;\n`;\n\nconst DescriptionSkeleton = styled.div`\n  width: 83%;\n  height: 48px;\n  background: #eee;\n  margin-left: 24px;\n  margin-top: 24px;\n`;\n\nconst TagSkeleton = styled.div`\n  background: #eee;\n  border-radius: 4px;\n  height: 34px;\n  width: 110px;\n  margin: 24px;\n`;\n\nconst FooterItemSkeleton = styled.div`\n  width: 150px;\n  height: 40px;\n  background: #eee;\n\n  @media screen and (max-width: 390px) {\n    width: 100px;\n  }\n`;\n\nconst DonationsInfoContainerSkeleton = styled.div`\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  align-items: center;\n  padding: 16px 24px;\n  width: 100%;\n  border-top: 1px #f0f0f0 solid;\n`;\n\nconst DonationsInfoItemSkeleton = styled.div`\n  display: flex;\n  flex-direction: row;\n  gap: 8px;\n  align-items: center;\n`;\n\nconst CardSkeleton = () => (\n  <CardSkeletonContainer>\n    <HeaderSkeleton />\n    <ProfileImageSkeleton />\n    <TitleSkeleton />\n    <DescriptionSkeleton />\n    <TagSkeleton />\n    <DonationsInfoContainerSkeleton>\n      <DonationsInfoItemSkeleton>\n        <FooterItemSkeleton />\n      </DonationsInfoItemSkeleton>\n      <DonationsInfoItemSkeleton>\n        <FooterItemSkeleton />\n      </DonationsInfoItemSkeleton>\n    </DonationsInfoContainerSkeleton>\n  </CardSkeletonContainer>\n);\n\nconst Container = styled.div`\n  display: flex;\n  flex-direction: column;\n`;\nconst Title = styled.div`\n  font-size: 18px;\n  display: flex;\n  align-items: center;\n  gap: 1.5rem;\n  width: fit-content;\n  margin-bottom: 1.5rem;\n  div:first-of-type {\n    font-weight: 600;\n  }\n`;\n\nconst SearchBar = styled.div`\n  display: flex;\n  position: relative;\n  width: 100%;\n  border-radius: 6px;\n  border: 0.5px solid #292929;\n  margin-bottom: 0.5rem;\n  svg {\n    position: absolute;\n    left: 1rem;\n    top: 50%;\n    transform: translateY(-50%);\n  }\n  input {\n    font-size: 14px;\n    background: transparent;\n    width: 100%;\n    height: 100%;\n    padding: 12px 16px 12px 3rem;\n    border: none;\n    outline: none;\n  }\n  @media only screen and (max-width: 768px) {\n    svg {\n      left: 1rem;\n    }\n\n    input {\n      padding: 8px 24px 8px 54px;\n    }\n  }\n`;\n\nconst [searchTerm, setSearchTerm] = useState(\"\");\nconst [filteredProjects, setFilteredProjects] = useState([]);\nconst [projects, setProjects] = useState(null);\nconst [flaggedAddresses, setFlaggedAddresses] = useState(null);\nconst [payouts, setPayouts] = useState(null);\n\n// get projects\nconst { ownerId, potId, potDetail, allDonations } = props;\nconst { calculatePayouts, getTagsFromSocialProfileData, getTeamMembersFromSocialProfileData } =\n  VM.require(\"potlock.near/widget/utils\") || {\n    calculatePayouts: () => {},\n    getFlaggedAccounts: () => {},\n    getTagsFromSocialProfileData: () => [],\n    getTeamMembersFromSocialProfileData: () => [],\n  };\n\nif (!projects) {\n  PotSDK.asyncGetApprovedApplications(potId).then((projects) => {\n    setProjects(projects);\n    setFilteredProjects(projects);\n  });\n}\n\nif (!projects) return <div class=\"spinner-border text-secondary\" role=\"status\" />;\n\nconst { public_round_start_ms, public_round_end_ms, referral_fee_public_round_basis_points } =\n  potDetail;\n\nconst now = Date.now();\nconst publicRoundOpen = now >= public_round_start_ms && now < public_round_end_ms;\n\nif (!flaggedAddresses) {\n  PotSDK.getFlaggedAccounts(potDetail, potId)\n    .then((data) => {\n      const listOfFlagged = [];\n      data.forEach((adminFlaggedAcc) => {\n        const addresses = Object.keys(adminFlaggedAcc.potFlaggedAcc);\n        listOfFlagged.push(...addresses);\n      });\n      setFlaggedAddresses(listOfFlagged);\n    })\n    .catch((err) => console.log(\"error getting the flagged accounts \", err));\n}\n\nif (!payouts) {\n  if (allDonations.length && flaggedAddresses)\n    calculatePayouts(allDonations, potDetail.matching_pool_balance, flaggedAddresses)\n      .then((payouts) => {\n        setPayouts(payouts ?? []);\n      })\n      .catch((err) => {\n        console.log(\"error while calculating payouts \", err);\n        setPayouts([]);\n      });\n}\n\nconst searchByWords = (searchTerm) => {\n  if (projects.length) {\n    searchTerm = searchTerm.toLowerCase().trim();\n    setSearchTerm(searchTerm);\n    const updatedProjects = projects.filter((project) => {\n      const profile = Social.getr(`${id}/profile`);\n      const fields = [\n        project.project_id,\n        project.status,\n        profile.description,\n        profile.name,\n        getTagsFromSocialProfileData(profile).join(\" \"),\n        getTeamMembersFromSocialProfileData(profile).join(\" \"),\n      ];\n      return fields.some((item) => (item || \"\").toLowerCase().includes(searchTerm.toLowerCase()));\n    });\n    setFilteredProjects(updatedProjects);\n  }\n};\n\nreturn (\n  <Container>\n    <Title>\n      <div>Projects</div>\n      <div>{filteredProjects?.length}</div>\n    </Title>\n\n    <SearchBar>\n      <svg\n        width=\"14\"\n        height=\"14\"\n        viewBox=\"0 0 14 14\"\n        fill=\"none\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n      >\n        <path\n          d=\"M9.81641 8.69141H9.22391L9.01391 8.48891C9.74891 7.63391 10.1914 6.52391 10.1914 5.31641C10.1914 2.62391 8.00891 0.441406 5.31641 0.441406C2.62391 0.441406 0.441406 2.62391 0.441406 5.31641C0.441406 8.00891 2.62391 10.1914 5.31641 10.1914C6.52391 10.1914 7.63391 9.74891 8.48891 9.01391L8.69141 9.22391V9.81641L12.4414 13.5589L13.5589 12.4414L9.81641 8.69141ZM5.31641 8.69141C3.44891 8.69141 1.94141 7.18391 1.94141 5.31641C1.94141 3.44891 3.44891 1.94141 5.31641 1.94141C7.18391 1.94141 8.69141 3.44891 8.69141 5.31641C8.69141 7.18391 7.18391 8.69141 5.31641 8.69141Z\"\n          fill=\"#7B7B7B\"\n        />\n      </svg>\n      <input\n        type=\"text\"\n        placeholder=\"Search projects\"\n        onChange={(e) => searchByWords(e.target.value)}\n        className=\"search-input\"\n      />\n    </SearchBar>\n    <Widget\n      src={`${ownerId}/widget/Project.ListSection`}\n      props={{\n        ...props,\n        shouldShuffle: true,\n        maxCols: 3,\n        items: filteredProjects,\n        responsive: [\n          {\n            breakpoint: 1200,\n            items: 2,\n          },\n          {\n            breakpoint: 870,\n            items: 1,\n          },\n        ],\n        renderItem: (project) => {\n          return (\n            <Widget\n              src={`${ownerId}/widget/Project.Card`}\n              loading={<CardSkeleton />}\n              props={{\n                ...props,\n                potDetail,\n                projects,\n                projectId: project.project_id,\n                allowDonate: publicRoundOpen && project.project_id !== context.accountId,\n                potRferralFeeBasisPoints: referral_fee_public_round_basis_points,\n                payoutDetails: payouts[project.project_id] || {\n                  donorCount: 0,\n                  matchingAmount: \"0\",\n                  totalAmount: \"0\",\n                },\n              }}\n            />\n          );\n        },\n      }}\n    />\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/potlock.near/widget/Pots.Projects", "fact_widget_deployments_id": "9e506c5b54dcfae77b8a5895359bbd05", "inserted_timestamp": "2024-04-26T22:40:24.736Z", "modified_timestamp": "2024-04-26T22:40:24.736Z", "__row_index": 0}