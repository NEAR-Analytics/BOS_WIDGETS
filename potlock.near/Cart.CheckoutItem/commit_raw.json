{"tx_hash": "4dveGjmcV6Ti4CsqqcDz5U9jfS7J3ikBX6DmE8CFRcR8", "action_id_social": "AKSiCjyxucfLt9NkW8M2Du2SR8YvTUQ6FLgxXFUGs4qk-0-widget", "block_id": 105754389, "block_timestamp": "2023-11-15T13:47:26.140Z", "signer_id": "potlock.near", "widget_name": "Cart.CheckoutItem", "source_code": "const ownerId = \"potlock.near\";\nconst donationContractId = \"donate.potlock.near\";\n\nconst donationContractConfig = Near.view(donationContractId, \"get_config\", {});\n\nconst IPFS_BASE_URL = \"https://nftstorage.link/ipfs/\";\nconst CHEVRON_DOWN_URL =\n  IPFS_BASE_URL + \"bafkreiabkwyfxq6pcc2db7u4ldweld5xcjesylfuhocnfz7y3n6jw7dptm\";\nconst CHEVRON_UP_URL =\n  IPFS_BASE_URL + \"bafkreibdm7w6zox4znipjqlmxr66wsjjpqq4dguswo7evvrmzlnss3c3vi\";\n\nconst ItemContainer = styled.div`\n  display: flex;\n  flex-direction: row;\n  max-width: 800px;\n  background: white;\n  // background: pink;\n  border: 1px solid #dbdbdb;\n  box-shadow: 0px -2px 0px #dbdbdb inset;\n  border-radius: 6px;\n  justify-content: flex-start;\n  align-items: flex-start;\n`;\n\nconst ItemLeft = styled.div`\n  height: 100%;\n  padding: 24px 16px;\n  // background: green;\n`;\n\nconst ItemRight = styled.div`\n  display: flex;\n  flex-direction: row;\n  padding: 24px 24px 24px 16px;\n  width: 100%;\n  // background: yellow;\n  border-left: 1px solid #dbdbdb;\n`;\n\nconst ImageContainer = styled.div`\n  display: flex;\n  flex-direction: row;\n  gap: 32px;\n`;\n\nconst DetailsContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  width: 100%;\n  overflow: hidden;\n`;\n\nconst Title = styled.a`\n  color: #2e2e2e;\n  font-size: 16px;\n  line-height: 24px;\n  font-weight: 600;\n  word-wrap: break-word;\n`;\n\nconst Description = styled.div`\n  color: #2e2e2e;\n  font-size: 16px;\n  line-height: 24px;\n  font-weight: 400;\n  word-wrap: break-word;\n  overflow-wrap: break-word;\n  margin-bottom: 24px;\n`;\n\nconst FtIcon = styled.img`\n  width: 20px;\n  height: 20px;\n`;\n\nconst BreakdownSummary = styled.div`\n  display: flex;\n  flex-direction: column;\n  // justify-content: flex-end;\n  align-items: center;\n  width: 100%;\n  margin-top: 16px;\n  cursor: pointer;\n`;\n\nconst BreakdownSummaryRight = styled.div`\n  display: flex;\n  flex-direction: row;\n  justify-content: flex-end;\n  align-items: center;\n  // background: pink;\n  width: 100%;\n`;\n\nconst BreakdownTitle = styled.div`\n  color: #2e2e2e;\n  font-size: 14px;\n  line-height: 16px;\n  font-weight: 600;\n  word-wrap: break-word;\n`;\n\nconst ChevronIcon = styled.img`\n  width: 24px;\n  height: 24px;\n  margin-left: 8px;\n`;\n\nconst BreakdownDetails = styled.div`\n  display: flex;\n  flex-direction: column;\n  width: 100%;\n  margin-top: 8px;\n  gap: 12px;\n  padding: 16px;\n  border-radius: 8px;\n  border: 1px #dbdbdb solid;\n  background: #fafafa;\n`;\n\nconst BreakdownItem = styled.div`\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  align-items: center;\n  gap: 16px;\n`;\n\nconst BreakdownItemLeft = styled.div`\n  color: #7b7b7b;\n  font-size: 14px;\n  line-height: 20px;\n  font-weight: 400;\n  word-wrap: break-word;\n`;\n\nconst BreakdownItemRight = styled.div`\n  display: flex;\n  flex-direction: row;\n  // justify-content: flex-end;\n  align-items: center;\n  gap: 8px;\n`;\n\nconst BreakdownAmount = styled.div`\n  color: #2e2e2e;\n  font-size: 14px;\n  line-height: 20px;\n  font-weight: 500;\n  word-wrap: break-word;\n`;\n\nconst { projectId, checked, handleCheckboxClick } = props;\n\nconst profile = props.profile || Social.get(`${projectId}/profile/**`, \"final\") || {};\n\nState.init({\n  showBreakdown: false,\n});\n\nconst basisPointsToPercent = (basisPoints) => {\n  return basisPoints / 100;\n};\n\nif (!donationContractConfig) return \"\";\n\nconst {\n  protocol_fee_basis_points: protocolFeeBasisPoints,\n  referral_fee_basis_points: referralFeeBasisPoints,\n  protocol_fee_recipient_account: protocolFeeRecipientAccount,\n} = donationContractConfig;\nconst TOTAL_BASIS_POINTS = 10_000;\nlet projectAllocationBasisPoints = TOTAL_BASIS_POINTS - protocolFeeBasisPoints;\nif (props.cart[projectId]?.referrerId) {\n  projectAllocationBasisPoints -= referralFeeBasisPoints;\n}\nconst projectAllocationPercent = basisPointsToPercent(projectAllocationBasisPoints);\nconst projectAllocationAmount =\n  (parseFloat(props.cart[projectId]?.amount) * projectAllocationBasisPoints) / TOTAL_BASIS_POINTS;\nconst protocolFeePercent = basisPointsToPercent(protocolFeeBasisPoints);\nconst protocolFeeAmount =\n  (parseFloat(props.cart[projectId]?.amount) * protocolFeeBasisPoints) / TOTAL_BASIS_POINTS;\nconst referrerFeePercent = basisPointsToPercent(referralFeeBasisPoints);\nconst referrerFeeAmount =\n  (parseFloat(props.cart[projectId]?.amount) * referralFeeBasisPoints) / TOTAL_BASIS_POINTS;\n\nreturn (\n  <ItemContainer>\n    <ItemLeft>\n      <Widget\n        src={`${ownerId}/widget/Inputs.Checkbox`}\n        props={{\n          id: \"selector-\" + projectId,\n          checked,\n          onClick: handleCheckboxClick,\n        }}\n      />\n    </ItemLeft>\n    <ItemRight>\n      <ImageContainer>\n        <Widget\n          src=\"mob.near/widget/ProfileImage\"\n          props={{\n            accountId: projectId,\n            style: {\n              width: \"40px\",\n              height: \"40px\",\n              border: \"none\",\n              marginRight: \"24px\",\n            },\n            className: \"mb-2\",\n            imageClassName: \"rounded-circle w-100 h-100 d-block\",\n            thumbnail: false,\n          }}\n        />\n      </ImageContainer>\n      <DetailsContainer>\n        <Title href={`?tab=project&projectId=${projectId}`}>{profile.name ?? \"\"}</Title>\n        <Description>{profile.description ?? \"\"}</Description>\n        <Widget\n          src={`${ownerId}/widget/Inputs.Text`}\n          props={{\n            label: \"Amount\",\n            placeholder: \"0\",\n            value: props.cart[projectId]?.amount,\n            onChange: (amount) => {\n              amount = amount.replace(/[^\\d.]/g, \"\"); // remove all non-numeric characters except for decimal\n              if (amount === \".\") amount = \"0.\";\n              props.updateCartItem(\n                projectId,\n                amount,\n                props.cart[projectId]?.ft,\n                props.cart[projectId]?.referrerId\n              ); // TODO: update this to use selected FT ID\n            },\n            inputStyles: {\n              textAlign: \"right\",\n              borderRadius: \"0px 4px 4px 0px\",\n            },\n            preInputChildren: (\n              <Widget\n                src={`${ownerId}/widget/Inputs.Select`}\n                props={{\n                  noLabel: true,\n                  placeholder: \"\",\n                  options: [\n                    { text: \"\", value: \"\" },\n                    { text: \"NEAR\", value: \"NEAR\" },\n                  ],\n                  value: { text: props.cart[projectId]?.ft, value: props.cart[projectId]?.ft },\n                  onChange: ({ text, value }) => {\n                    props.updateCartItem(projectId, undefined, value);\n                  },\n                  containerStyles: {\n                    width: \"auto\",\n                  },\n                  inputStyles: {\n                    border: \"none\",\n                    borderRight: \"1px #F0F0F0 solid\",\n                    boxShadow: \"none\",\n                    borderRadius: \"4px 0px 0px 4px\",\n                    width: \"auto\",\n                    padding: \"12px 16px\",\n                    boxShadow: \"0px -2px 0px rgba(93, 93, 93, 0.24) inset\",\n                  },\n                  iconLeft: <FtIcon src={props.SUPPORTED_FTS[props.cart[projectId].ft].iconUrl} />,\n                }}\n              />\n            ),\n          }}\n        />\n        <BreakdownSummary onClick={() => State.update({ showBreakdown: !state.showBreakdown })}>\n          <BreakdownSummaryRight>\n            <BreakdownTitle style={{ fontSize: \"14px\", lineHeight: \"16px\" }}>\n              {state.showBreakdown ? \"Hide\" : \"Show\"} breakdown\n            </BreakdownTitle>\n            <ChevronIcon src={state.showBreakdown ? CHEVRON_UP_URL : CHEVRON_DOWN_URL} />\n          </BreakdownSummaryRight>\n          {state.showBreakdown && (\n            <BreakdownDetails>\n              <BreakdownItem>\n                <BreakdownItemLeft>\n                  Protocol fee ({protocolFeePercent}% to {protocolFeeRecipientAccount})\n                </BreakdownItemLeft>\n                <BreakdownItemRight>\n                  <BreakdownAmount>\n                    {protocolFeeAmount ? protocolFeeAmount.toFixed(3) : \"-\"}\n                  </BreakdownAmount>\n                  <FtIcon src={props.SUPPORTED_FTS[props.cart[projectId].ft].iconUrl} />\n                </BreakdownItemRight>\n              </BreakdownItem>\n              {props.cart[projectId]?.referrerId && (\n                <BreakdownItem>\n                  <BreakdownItemLeft>\n                    Referrer fee ({referrerFeePercent}% to {props.cart[projectId]?.referrerId})\n                  </BreakdownItemLeft>\n                  <BreakdownItemRight>\n                    <BreakdownAmount>\n                      {referrerFeeAmount ? referrerFeeAmount.toFixed(3) : \"-\"}\n                    </BreakdownAmount>\n                    <FtIcon src={props.SUPPORTED_FTS[props.cart[projectId].ft].iconUrl} />\n                  </BreakdownItemRight>\n                </BreakdownItem>\n              )}\n              <BreakdownItem>\n                <BreakdownItemLeft>On-Chain Storage</BreakdownItemLeft>\n                <BreakdownItemRight>\n                  <BreakdownAmount>{\"<0.010\"}</BreakdownAmount>\n                  <FtIcon src={props.SUPPORTED_FTS[props.cart[projectId].ft].iconUrl} />\n                </BreakdownItemRight>\n              </BreakdownItem>\n              <BreakdownItem>\n                <BreakdownItemLeft>\n                  Project allocation (~{projectAllocationPercent}% to {projectId})\n                </BreakdownItemLeft>\n                <BreakdownItemRight>\n                  <BreakdownAmount>\n                    ~{projectAllocationAmount ? projectAllocationAmount.toFixed(3) : \"-\"}\n                  </BreakdownAmount>\n                  <FtIcon src={props.SUPPORTED_FTS[props.cart[projectId].ft].iconUrl} />\n                </BreakdownItemRight>\n              </BreakdownItem>\n            </BreakdownDetails>\n          )}\n        </BreakdownSummary>\n      </DetailsContainer>\n    </ItemRight>\n  </ItemContainer>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/potlock.near/widget/Cart.CheckoutItem", "fact_widget_deployments_id": "6df7a7d3f9e6fb9c8d9bbf34dfb8705a", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 18}