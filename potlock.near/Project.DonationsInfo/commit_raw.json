{"tx_hash": "ExchXdWti5ByiXAm7CcZkFgURv1JKTZ72j2t1WFALKdB", "action_id_social": "48p2sQZ246zWoZmZ78KTUN3eVjv95a8aaJqBCcfkbQsg-0-widget", "block_id": 114024869, "block_timestamp": "2024-03-03T17:01:31.837Z", "signer_id": "potlock.near", "widget_name": "Project.DonationsInfo", "source_code": "const { ownerId } = VM.require(\"potlock.near/widget/constants\") || {\n  ownerId: \"\",\n};\nconst { nearToUsd, nearToUsdWithFallback } = VM.require(\"potlock.near/widget/utils\") || {\n  nearToUsd: 1,\n  nearToUsdWithFallback: () => \"\",\n};\n\nlet DonateSDK =\n  VM.require(\"potlock.near/widget/SDK.donate\") ||\n  (() => ({\n    getDonationsForRecipient: () => {},\n  }));\nDonateSDK = DonateSDK({ env: props.env });\n\nconst loraCss = fetch(\"https://fonts.cdnfonts.com/css/lora\").body;\n\nconst Container = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: flex-start;\n  // width: 100%;\n  // background: green;\n  gap: 40px;\n\n  @media screen and (max-width: 768px) {\n    flex-direction: column;\n    gap: 24px;\n  }\n`;\n\nconst donationsForProject = DonateSDK.getDonationsForRecipient(props.projectId);\n\nconst [totalDonations, totalDonors, totalReferralFees] = useMemo(() => {\n  if (!donationsForProject) {\n    return [\"\", \"\"];\n  }\n  const donors = [];\n  let totalDonationAmount = new Big(0);\n  let totalReferralFees = new Big(0);\n  for (const donation of donationsForProject) {\n    if (!donors.includes(donation.donor_id)) {\n      donors.push(donation.donor_id);\n    }\n    const totalAmount = new Big(donation.total_amount);\n    const referralAmount = new Big(donation.referrer_fee || \"0\");\n    const protocolAmount = new Big(donation.protocol_fee || \"0\");\n    totalDonationAmount = totalDonationAmount.plus(\n      totalAmount.minus(referralAmount).minus(protocolAmount)\n    );\n    totalReferralFees = totalReferralFees.plus(referralAmount);\n  }\n  return [\n    totalDonationAmount.div(1e24).toNumber().toFixed(2),\n    donors.length,\n    totalReferralFees.div(1e24).toNumber().toFixed(2),\n  ];\n}, [donationsForProject]);\n\nreturn (\n  <Container>\n    <Widget\n      src={`${ownerId}/widget/Components.InfoCard`}\n      props={{\n        infoTextPrimary: nearToUsd\n          ? `$${(totalDonations * nearToUsd).toFixed(2)}`\n          : `${totalDonations} N`,\n        infoTextSecondary: \"Contributed\",\n      }}\n    />\n    <Widget\n      src={`${ownerId}/widget/Components.InfoCard`}\n      props={{\n        infoTextPrimary: totalReferralFees ? nearToUsdWithFallback(totalReferralFees) : \"-\",\n        infoTextSecondary: \"Referral Fees\",\n      }}\n    />\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/potlock.near/widget/Project.DonationsInfo", "fact_widget_deployments_id": "5e1521cb9b6b5331ccec49bea855543b", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 16}