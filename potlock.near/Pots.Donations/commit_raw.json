{"tx_hash": "4Z59Msk66hRH8T8NxXvhWxTzJvwHjgeEayubbS2KdMuW", "action_id_social": "AsMtvZG5k39oZ8a5oyutqHzSs1dEDs9MPqE9t6XnZjrq-0-widget", "block_id": 115588449, "block_timestamp": "2024-03-27T15:18:16.507Z", "signer_id": "potlock.near", "widget_name": "Pots.Donations", "source_code": "// get donations\nconst {\n  potId,\n  potDetail: { base_currency },\n} = props;\nconst { ownerId, SUPPORTED_FTS } = VM.require(\n  \"potlock.near/widget/constants\"\n) || {\n  ownerId: \"\",\n  SUPPORTED_FTS: {},\n};\nconst { getTimePassed, _address } = VM.require(\n  `${ownerId}/widget/Components.DonorsUtils`\n) || {\n  getTimePassed: () => \"\",\n  _address: (address) => address,\n};\nconst PotSDK = VM.require(\"potlock.near/widget/SDK.pot\") || {\n  getPublicRoundDonations: () => {},\n};\nconst publicRoundDonations = PotSDK.getPublicRoundDonations(potId);\nState.init({\n  allDonations: null,\n  filteredDonations: [],\n  currentFilter: \"date\",\n  filter: {\n    date: false, // false === ascending\n    price: false, // false === ascending\n  },\n});\nconst { allDonations, filteredDonations, currentFilter, filter } = state;\nif (publicRoundDonations && !allDonations) {\n  publicRoundDonations.reverse();\n  State.update({\n    filteredDonations: publicRoundDonations,\n    allDonations: publicRoundDonations,\n  });\n}\nif (!allDonations)\n  return <div class=\"spinner-border text-secondary\" role=\"status\" />;\n// console.log(\"donations: \", donations);\nconst Container = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  width: 100%;\n  @media screen and (min-width: 375px) and (max-width: 768px) {\n    width: 99%;\n  }\n  @media screen and (max-width: 390px) {\n    width: 98%;\n  }\n`;\nconst OuterTextContainer = styled.div`\n  display: flex;\n  flex-direction: row;\n  gap: 1.5rem;\n  align-items: center;\n  @media screen and (max-width: 768px) {\n    padding-right: 10px;\n  }\n`;\nconst OuterText = styled.div`\n  font-size: 18px;\n  font-weight: 600;\n`;\nconst DonationsCount = styled.div`\n  font-size: 16px;\n`;\nconst TableContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  border: 0.5px rgba(41, 41, 41, 0.5) solid;\n  box-shadow: 0px 4px 12px -4px rgba(82, 82, 82, 0.2);\n  border-radius: 2px;\n  width: 100%;\n  overflow-x: auto;\n  flex-wrap: nowrap;\n`;\nconst Header = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: space-between;\n  background: #f6f5f3;\n  width: 100%;\n`;\nconst HeaderItem = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: space-between;\n  justify-content: flex-start;\n  padding: 10px 20px;\n  width: ${100 / columns.length}%;\n`;\nconst HeaderItemText = styled.div`\n  color: #292929;\n  font-size: 14px;\n  font-weight: 600;\n  line-height: 24px;\n  word-wrap: break-word;\n`;\nconst Sort = styled.div`\n  display: none;\n  justify-content: space-between;\n  width: 100%;\n  margin-top: 1.5rem;\n  div {\n    display: flex;\n    align-items: center;\n    font-weight: 500;\n    cursor: pointer;\n    gap: 8px;\n    color: #7b7b7b;\n    &.active {\n      color: #292929;\n    }\n    svg {\n      transition: rotate 300ms;\n    }\n  }\n  @media screen and (max-width: 768px) {\n    display: flex;\n  }\n`;\nconst Arrow = (props) => (\n  <svg\n    {...props}\n    style={{ rotate: !props.active ? \"0deg\" : \"180deg\" }}\n    width=\"12\"\n    height=\"12\"\n    viewBox=\"0 0 12 12\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path\n      d=\"M0 6L1.0575 7.0575L5.25 2.8725V12H6.75V2.8725L10.935 7.065L12 6L6 0L0 6Z\"\n      fill=\"#7B7B7B\"\n    />\n  </svg>\n);\nconst searchDonations = (searchTerm) => {\n  // filter donations that match the search term (donor_id, project_id)\n  const filteredDonations = allDonations.filter((donation) => {\n    const { donor_id, project_id } = donation;\n    const searchFields = [donor_id, project_id];\n    return searchFields.some((field) =>\n      field.toLowerCase().includes(searchTerm.toLowerCase())\n    );\n  });\n  return filteredDonations;\n};\nconst sortDonation = (type) => {\n  const sort = !filter[type];\n  State.update({ currentFilter: type, filter: { ...filter, [type]: sort } });\n  if (type === \"price\") {\n    const sortedDonations = filteredDonations.sort((a, b) =>\n      sort ? b.total_amount - a.total_amount : a.total_amount - b.total_amount\n    );\n    State.update({ filteredDonations: sortedDonations });\n  } else if (type === \"date\") {\n    const sortedDonations = filteredDonations.sort((a, b) => {\n      return sort ? b.donated_at - a.donated_at : a.donated_at - b.donated_at;\n    });\n    State.update({ filteredDonations: sortedDonations });\n  }\n};\nconst handleSearch = ({ target: { value } }) => {\n  const filteredDonations = searchDonations(value);\n  State.update({ filteredDonations });\n};\nconst ProfileImg = (address) => (\n  <Widget\n    src={`${ownerId}/widget/Project.ProfileImage`}\n    props={{\n      ...props,\n      accountId: address,\n      style: {},\n    }}\n  />\n);\nreturn (\n  <Container>\n    <OuterTextContainer>\n      <OuterText>All donations</OuterText>\n      <DonationsCount>{allDonations.length}</DonationsCount>\n    </OuterTextContainer>\n    <Sort>\n      <div\n        className={`${currentFilter === \"date\" ? \"active\" : \"\"}`}\n        onClick={() => sortDonation(\"date\")}\n      >\n        Sort Date {currentFilter === \"date\" && <Arrow active={!filter.date} />}\n      </div>\n      <div\n        onClick={() => sortDonation(\"price\")}\n        className={`${currentFilter === \"price\" ? \"active\" : \"\"}`}\n      >\n        Sort Amount{\" \"}\n        {currentFilter === \"price\" && <Arrow active={filter.price} />}\n      </div>\n    </Sort>\n    <Widget\n      src={`${ownerId}/widget/Pots.DonationsTable`}\n      props={{\n        ...props,\n        allDonations: filteredDonations,\n        filter,\n        currentFilter,\n        handleSearch,\n        sortDonation,\n      }}\n    />\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/potlock.near/widget/Pots.Donations", "fact_widget_deployments_id": "c0a79cade2ed31923f37b5d7d7749c9e", "inserted_timestamp": "2024-03-27T16:32:19.732Z", "modified_timestamp": "2024-03-27T16:32:19.732Z", "__row_index": 20}