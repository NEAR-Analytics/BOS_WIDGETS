{"tx_hash": "Ff83yjEkCDFGFpFcyL83MyinuBmcyPwYWMFCKAE6FNyf", "action_id_social": "7xVg1zNvhn7TUecKu7cQwYtWYTVYMbBjVU6z2DiJBTQS-0-widget", "block_id": 99508757, "block_timestamp": "2023-08-23T23:51:55.295Z", "signer_id": "nearukraineguild.near", "widget_name": "votes", "source_code": "let layout = [\n  {\n    type: \"row\",\n    content: [\n      {\n        type: \"text\",\n        variants: [\"lg\"],\n        rows: 1,\n        style: {\n          width: \"50%\",\n        },\n      },\n      {\n        type: \"text\",\n        variants: [\"sm\"],\n        rows: 1,\n        style: {\n          width: \"80px\",\n          marginStart: \"auto\",\n        },\n      },\n    ],\n  },\n  {\n    type: \"row\",\n    variants: [\"me-auto\"],\n    content: [\n      {\n        type: \"avatar\",\n        variants: [\"md\", \"me-1\"],\n      },\n      {\n        type: \"text\",\n        variants: [\"md\"],\n        rows: 1,\n        style: {\n          width: \"150px\",\n        },\n      },\n    ],\n  },\n  {\n    type: \"box\",\n    variants: [\"lg\", \"mb-5\"],\n  },\n  {\n    type: \"row\",\n    variants: [\"flex-column\"],\n    content: [\n      {\n        type: \"box\",\n        variants: [\"rounded-5\"],\n        style: {\n          height: \"46px\",\n        },\n        count: 3,\n      },\n    ],\n  },\n  {\n    type: \"row\",\n    variants: [\"justify-content-start\", \"mt-4\"],\n    content: [\n      {\n        type: \"box\",\n        variants: [\"rounded-5\"],\n        count: 2,\n        style: {\n          height: \"38px\",\n          width: \"160px\",\n        },\n      },\n    ],\n  },\n];\n\nState.init({\n  wallet: \"kiskesis.near\",\n  profile: {},\n  nominations: {},\n  data: {},\n});\n\nconst wallets = [\n  \"kiskesis.near\",\n  \"evangel.near\",\n  \"haenko.near\",\n  \"yonota.near\",\n  \"johanga108.near\",\n  \"dk_51.near\",\n  \"alan777.near\",\n  \"luciotato.near\",\n  \"kemo.near\",\n  \"maxkott.near\",\n  \"planetaworld.near\",\n  \"igboze_builder.near\",\n  \"blaze.near\",\n  \"techdir.near\",\n  \"rahulgoel.near\",\n  \"tolmindev.near\",\n  \"izubair.near\",\n];\n\nconst baseApi = \"https://api.pikespeak.ai\";\n\nconst apiKey = \"36f2b87a-7ee6-40d8-80b9-5e68e587a5b5\";\nconst httpRequestOpt = {\n  headers: { \"x-api-key\": apiKey },\n};\n\nconst houseNominations = (house) =>\n  `${baseApi}/nominations/house-nominations?house=${house}&contract=nominations.ndc-gwg.near`;\n\nlet walletData = [\n  fetch(houseNominations(\"HouseOfMerit\"), httpRequestOpt).body,\n  fetch(houseNominations(\"TransparencyCommission\"), httpRequestOpt).body,\n  fetch(houseNominations(\"CouncilOfAdvisors\"), httpRequestOpt).body,\n];\n\nconst filteredWalletData = walletData.map((group) => {\n  return group.filter((entry) => wallets.includes(entry.nominee));\n});\n\nconst getData = (wallet) => {\n  let profile = Social.getr(`${wallet}/profile`);\n  let nominations = Social.getr(`${wallet}/nominations`);\n\n  console.log(\"profile\", profile);\n  console.log(\"nominations\", nominations);\n\n  const data = fetch(\n    `https://raw.githubusercontent.com/kiskesis/ndc-voters/main/${wallet}_output_votes.txt`\n  );\n\n  State.update({\n    profile,\n    nominations,\n    data,\n  });\n};\n\ngetData(state.wallet);\n\nconst handleWalletChange = (e) => {\n  const wallet = e.target.value;\n  State.update({\n    wallet,\n  });\n\n  getData(wallet);\n};\n\nconst Text = ({ props }) => {\n  return <Widget src={`nearui.near/widget/Typography.Text`} props={props} />;\n};\n\nconst Table = styled.div`\n  display: table;\n  width: 100%;\n  border-collapse: separate;\n  border-spacing: 0px;\n  font-size: 16px;\n`;\n\nconst TableHeader = styled.th`\n  line-height: 14px;\n`;\n\nconst GroupLabel = styled.option`\n  font-weight: bold;\n  background-color: #eee;\n`;\n\nconst rednerSelector = () => (\n  <select\n    class=\"form-select\"\n    style={{\n      maxWidth: \"30vw\",\n      fontSize: \"16px\",\n      backgroundColor: \"#f7f7f7\",\n      borderColor: \"#ccc\",\n      borderRadius: \"4px\",\n      padding: \"6px\",\n      cursor: \"pointer\",\n    }}\n    onChange={handleWalletChange}\n    value={state.wallet}\n  >\n    {filteredWalletData.map((houseData, index) => (\n      <>\n        <GroupLabel disabled>{houseData[0].house}</GroupLabel>\n        {houseData.map((walletItem, walletIndex) => (\n          <option key={walletIndex} value={walletItem.nominee}>\n            {walletItem.nominee}\n          </option>\n        ))}\n      </>\n    ))}\n  </select>\n);\n\nif (state.data.ok) {\n  const rows = state.data.body\n    .split(\"\\n\")\n    .map((line) => line.split(\"|\"))\n    .filter((data) => data.length === 3)\n    .map((item) => (\n      <tr>\n        <td class=\"pt-3\">\n          <Widget\n            src=\"nearui.near/widget/Element.User\"\n            props={{\n              accountId: item[0],\n              options: {\n                size: \"md\",\n                showSocialName: true,\n                showImage: true,\n                showHumanBadge: true,\n              },\n            }}\n          />\n        </td>\n        <td className=\"align-top pt-3\">\n          <small>{item[2].substr(0, 19)}</small>\n        </td>\n      </tr>\n    ));\n\n  return (\n    <>\n      <div class=\"container p-3 d-flex flex-column align-items-center\">\n        {rednerSelector()}\n      </div>\n      <Text\n        props={{\n          children: (\n            <a href=\"https://near.org/nomination.ndctools.near/widget/NDC.Nomination.Page\">\n              {state.nominations.house_intended.replace(\n                /([a-z])([A-Z])/g,\n                \"$1 $2\"\n              )}\n            </a>\n          ),\n          tag: \"h1\",\n          size: \"5\",\n          weight: \"bold\",\n          color: \"default\",\n          otherProps: {\n            id: \"my-text\",\n          },\n        }}\n      />\n      <div class=\"mt-3 mb-3\">\n        <Widget\n          src=\"nearui.near/widget/Element.User\"\n          props={{\n            accountId: state.wallet,\n            options: {\n              size: \"lg\",\n              showSocialName: true,\n              showImage: true,\n              showHumanBadge: true,\n            },\n          }}\n        />\n      </div>\n      <Widget\n        src=\"nearui.near/widget/Input.Button\"\n        props={{\n          children: `VOTE FOR ${state.profile.name.toUpperCase()}!`,\n          variant: \"success\",\n          href: `/nomination.ndctools.near/widget/NDC.Nomination.Candidate.Page?house=${state.nominations.house_intended}&accountId=${state.wallet}`,\n          size: \"lg\",\n        }}\n      />\n      <Text\n        props={{\n          children: `Fantastic users who voted for ${state.profile.name.toUpperCase()}`,\n          tag: \"h1\",\n          size: \"5\",\n          weight: \"bold\",\n          color: \"default\",\n          className: \"mt-4 mb-2\",\n          otherProps: {\n            id: \"my-text\",\n          },\n        }}\n      />\n      <Table class=\"table table-sm mt-4\">\n        <thead>\n          <tr>\n            <TableHeader scope=\"col\">User</TableHeader>\n            <TableHeader scope=\"col\">Vote date (UTC)</TableHeader>\n          </tr>\n        </thead>\n        <tbody>{rows}</tbody>\n      </Table>\n      <p class=\"mt-4\">\n        <small>\n          Data is retrieved automatically from the\n          <a\n            href=\"https://github.com/zavodil/near-nft-owners-list/blob/main/.github/workflows/indexed.yml\"\n            target=\"_blank\"\n          >\n            NEAR Public indexer\n          </a>{\" \"}\n          with a slight delay.\n        </small>\n      </p>\n    </>\n  );\n} else\n  return (\n    <Widget src=\"nearui.near/widget/Feedback.Skeleton\" props={{ layout }} />\n  );\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/nearukraineguild.near/widget/votes", "fact_widget_deployments_id": "99b49bf16500968d2e079093c58fecc9", "inserted_timestamp": "2023-08-24T07:09:10.232Z", "modified_timestamp": "2023-08-24T07:09:10.232Z", "__row_index": 14}