{"tx_hash": "ihRpUKKBSk5PK9ao49ZcGFXruLAXx5q9rewiU2L1LKC", "action_id_social": "7G5NZmEeBbjPMnx7hqMHxJvg2FTvM6zETzwFg1KSDa2i-0-widget", "block_id": 99537749, "block_timestamp": "2023-08-24T08:55:51.912Z", "signer_id": "nearukraineguild.near", "widget_name": "votes", "source_code": "let layout = [\n  {\n    type: \"row\",\n    content: [\n      {\n        type: \"text\",\n        variants: [\"lg\"],\n        rows: 1,\n        style: {\n          width: \"50%\",\n        },\n      },\n      {\n        type: \"text\",\n        variants: [\"sm\"],\n        rows: 1,\n        style: {\n          width: \"80px\",\n          marginStart: \"auto\",\n        },\n      },\n    ],\n  },\n  {\n    type: \"row\",\n    variants: [\"me-auto\"],\n    content: [\n      {\n        type: \"avatar\",\n        variants: [\"md\", \"me-1\"],\n      },\n      {\n        type: \"text\",\n        variants: [\"md\"],\n        rows: 1,\n        style: {\n          width: \"150px\",\n        },\n      },\n    ],\n  },\n  {\n    type: \"box\",\n    variants: [\"lg\", \"mb-5\"],\n  },\n  {\n    type: \"row\",\n    variants: [\"flex-column\"],\n    content: [\n      {\n        type: \"box\",\n        variants: [\"rounded-5\"],\n        style: {\n          height: \"46px\",\n        },\n        count: 3,\n      },\n    ],\n  },\n  {\n    type: \"row\",\n    variants: [\"justify-content-start\", \"mt-4\"],\n    content: [\n      {\n        type: \"box\",\n        variants: [\"rounded-5\"],\n        count: 2,\n        style: {\n          height: \"38px\",\n          width: \"160px\",\n        },\n      },\n    ],\n  },\n];\n\nconst registryContract = \"registry.i-am-human.near\";\n\nState.init({\n  wallet: \"kiskesis.near\",\n  profile: {},\n  nominations: {},\n  data: {},\n  comments: [],\n  verified: false,\n});\n\nconst wallets = [\n  \"kiskesis.near\",\n  \"evangel.near\",\n  \"haenko.near\",\n  \"yonota.near\",\n  \"johanga108.near\",\n  \"dk_51.near\",\n  \"alan777.near\",\n  \"luciotato.near\",\n  \"kemo.near\",\n  \"maxkott.near\",\n  \"planetaworld.near\",\n  \"igboze_builder.near\",\n  \"blaze.near\",\n  \"techdir.near\",\n  \"rahulgoel.near\",\n  \"tolmindev.near\",\n  \"izubair.near\",\n];\n\nconst baseApi = \"https://api.pikespeak.ai\";\n\nconst apiKey = \"36f2b87a-7ee6-40d8-80b9-5e68e587a5b5\";\nconst nominationContract = \"nominations.ndc-gwg.near\";\nconst httpRequestOpt = {\n  headers: { \"x-api-key\": apiKey },\n};\n\nconst houseNominations = (house) =>\n  `${baseApi}/nominations/house-nominations?house=${house}&contract=${nominationContract}`;\n\nlet walletData = [\n  fetch(houseNominations(\"HouseOfMerit\"), httpRequestOpt).body,\n  fetch(houseNominations(\"TransparencyCommission\"), httpRequestOpt).body,\n  fetch(houseNominations(\"CouncilOfAdvisors\"), httpRequestOpt).body,\n];\n\nconst filteredWalletData = walletData.map((group) => {\n  return group.filter((entry) => wallets.includes(entry.nominee));\n});\n\nasyncFetch(\n  `https://api.pikespeak.ai/nominations/candidates-comments-and-upvotes?candidate=${state.wallet}&contract=${nominationContract}`,\n  httpRequestOpt\n).then((res) => {\n  State.update({ comments: res.body[0] });\n});\n\nasyncFetch(\n  `https://api.pikespeak.ai/sbt/has-sbt?holder=${context.accountId}&class_id=1&issuer=fractal.i-am-human.near&with_expired=false&registry=${registryContract}`,\n  httpRequestOpt\n).then((res) => {\n  State.update({ verified: res.body });\n});\nasyncFetch(\n  `https://api.pikespeak.ai/nominations/is-upvoted-by?candidate=${state.wallet}&upvoter=${context.accountId}&contract=${nominationContract}`,\n  httpRequestOpt\n).then((res) => {\n  State.update({ voted: res.body });\n});\n\nconst getData = (wallet) => {\n  let profile = Social.getr(`${wallet}/profile`);\n  let nominations = Social.getr(`${wallet}/nominations`);\n\n  const data = fetch(\n    `https://raw.githubusercontent.com/kiskesis/ndc-voters/main/${wallet}_output_votes.txt`\n  );\n\n  State.update({\n    profile,\n    nominations,\n    data,\n  });\n};\n\ngetData(state.wallet);\n\nconst handleWalletChange = (e) => {\n  const wallet = e.target.value;\n  State.update({\n    wallet,\n  });\n\n  getData(wallet);\n};\n\nconst Text = ({ props }) => {\n  return <Widget src={`nearui.near/widget/Typography.Text`} props={props} />;\n};\n\nconst Button = ({ props }) => {\n  return <Widget src=\"nearui.near/widget/Input.Button\" props={props} />;\n};\n\nconst Table = styled.div`\n  display: table;\n  width: 100%;\n  border-collapse: separate;\n  border-spacing: 0px;\n  font-size: 16px;\n`;\n\nconst TableHeader = styled.th`\n  line-height: 14px;\n`;\n\nconst GroupLabel = styled.option`\n  font-weight: bold;\n  background-color: #eee;\n`;\n\nconst rednerSelector = () => (\n  <select\n    class=\"form-select\"\n    style={{\n      maxWidth: \"30vw\",\n      fontSize: \"16px\",\n      backgroundColor: \"#f7f7f7\",\n      borderColor: \"#ccc\",\n      borderRadius: \"4px\",\n      padding: \"6px\",\n      cursor: \"pointer\",\n    }}\n    onChange={handleWalletChange}\n    value={state.wallet}\n  >\n    {filteredWalletData.map((houseData, index) => (\n      <>\n        <GroupLabel disabled>{houseData[0].house}</GroupLabel>\n        {houseData.map((walletItem, walletIndex) => (\n          <option key={walletIndex} value={walletItem.nominee}>\n            {walletItem.nominee}\n          </option>\n        ))}\n      </>\n    ))}\n  </select>\n);\n\nfunction handleUpVote() {\n  Near.call(\n    nominationContract,\n    state.voted ? \"remove_upvote\" : \"upvote\",\n    {\n      candidate: state.wallet,\n    },\n    300000000000000,\n    state.voted ? 0 : 1000000000000000000000\n  );\n}\n\nfunction handleVoteAll() {\n  const coalitionVote = wallets.map((wallet) => {\n    return {\n      contractName: nominationContract,\n      methodName: \"upvote\",\n      args: {\n        candidate: wallet,\n      },\n      deposit: 300000000000000,\n      gas: 1000000000000000000000,\n    };\n  });\n\n  Near.call(coalitionVote);\n}\n\nconst UpvoteButtonDisabled = styled.button`\n  display: flex;\n  padding: 2px 12px;\n  align-items: center;\n  gap: 6px;\n  border-radius: 4px;\n  border: solid 1px transparent;\n  background: var(--buttons-disable, #c3cace);\n  cursor: default !important;\n`;\n\nconst UpvoteButton = styled.button`\n  display: flex;\n  padding: 2px 12px;\n  align-items: center;\n  gap: 6px;\n  border-radius: 4px;\n  border: solid 1px transparent;\n  background-image: linear-gradient(#f8f8f9, #f8f8f9),\n    radial-gradient(\n      circle at left top,\n      rgb(147, 51, 234) 0%,\n      rgb(79, 70, 229) 100%\n    );\n  background-origin: border-box;\n  background-clip: padding-box, border-box;\n`;\n\nconst UpvoteCount = styled.p`\n  font-size: 12px;\n  font-weight: 500;\n  line-height: 24px;\n  margin: 0px;\n  background: linear-gradient(90deg, #9333ea 0%, #4f46e5 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n  text-fill-color: transparent;\n`;\n\nconst RightMarginDiv = styled.div`\n  margin-right: 10px; /* Adjust the margin value as needed */\n`;\n\nif (state.data.ok) {\n  const rows = state.data.body\n    .split(\"\\n\")\n    .map((line) => line.split(\"|\"))\n    .filter((data) => data.length === 3)\n    .map((item) => (\n      <tr>\n        <td class=\"pt-3\">\n          <Widget\n            src=\"nearui.near/widget/Element.User\"\n            props={{\n              accountId: item[0],\n              options: {\n                size: \"md\",\n                showSocialName: true,\n                showImage: true,\n                showHumanBadge: true,\n              },\n            }}\n          />\n        </td>\n        <td className=\"align-top pt-3\">\n          <small>{item[2].substr(0, 19)}</small>\n        </td>\n      </tr>\n    ));\n\n  return (\n    <>\n      <div class=\"container p-3 pt-1 d-flex flex-column align-items-center\">\n        <Button\n          props={{\n            className: \"mb-4\",\n            children: `VOTE FOR COALITION!`,\n            variant: \"primary\",\n            onClick: handleVoteAll,\n            size: \"lg\",\n          }}\n        />\n        {rednerSelector()}\n      </div>\n      <Text\n        props={{\n          children: (\n            <a href=\"https://near.org/nomination.ndctools.near/widget/NDC.Nomination.Page\">\n              {state.nominations.house_intended.replace(\n                /([a-z])([A-Z])/g,\n                \"$1 $2\"\n              )}\n            </a>\n          ),\n          tag: \"h1\",\n          size: \"5\",\n          weight: \"bold\",\n          color: \"default\",\n          otherProps: {\n            id: \"my-text\",\n          },\n        }}\n      />\n      <div class=\"mt-3 mb-3\">\n        <Widget\n          src=\"nearui.near/widget/Element.User\"\n          props={{\n            accountId: state.wallet,\n            options: {\n              size: \"lg\",\n              showSocialName: true,\n              showImage: true,\n              showHumanBadge: true,\n            },\n          }}\n        />\n      </div>\n      <div class=\"d-flex\">\n        <RightMarginDiv>\n          <Button\n            props={{\n              children: `VOTE FOR ${state.profile.name.toUpperCase()}!`,\n              variant: \"success\",\n              href: `/nomination.ndctools.near/widget/NDC.Nomination.Candidate.Page?house=${state.nominations.house_intended}&accountId=${state.wallet}`,\n              size: \"lg\",\n            }}\n          />\n        </RightMarginDiv>\n\n        <RightMarginDiv>\n          <Widget\n            src=\"nomination.ndctools.near/widget/NDC.StyledComponents\"\n            props={{\n              Button: {\n                text: `+${state.comments.upvotes ?? 0}`,\n                disabled:\n                  !context.accountId ||\n                  !state.verified ||\n                  context.accountId === state.wallet,\n                className: `${\n                  context.accountId && state.voted ? \"primary\" : \"secondary\"\n                } dark`,\n                onClick: handleUpVote,\n                icon: <i className=\"bi bi-hand-thumbs-up\"></i>,\n              },\n            }}\n          />\n        </RightMarginDiv>\n      </div>\n      <Text\n        props={{\n          children: `Fantastic users who voted for ${state.profile.name.toUpperCase()}`,\n          tag: \"h1\",\n          size: \"5\",\n          weight: \"bold\",\n          color: \"default\",\n          className: \"mt-4 mb-2\",\n          otherProps: {\n            id: \"my-text\",\n          },\n        }}\n      />\n      <Table class=\"table table-sm mt-4\">\n        <thead>\n          <tr>\n            <TableHeader scope=\"col\">User</TableHeader>\n            <TableHeader scope=\"col\">Vote date (UTC)</TableHeader>\n          </tr>\n        </thead>\n        <tbody>{rows}</tbody>\n      </Table>\n      <p class=\"mt-4\">\n        <small>\n          Data is retrieved automatically from the\n          <a\n            href=\"https://github.com/zavodil/near-nft-owners-list/blob/main/.github/workflows/indexed.yml\"\n            target=\"_blank\"\n          >\n            NEAR Public indexer\n          </a>{\" \"}\n          with a slight delay.\n        </small>\n      </p>\n    </>\n  );\n} else\n  return (\n    <Widget src=\"nearui.near/widget/Feedback.Skeleton\" props={{ layout }} />\n  );\n", "metadata": null, "branch": {"draft": null}, "widget_modules_used": null, "widget_url": "https://near.social/#/nearukraineguild.near/widget/votes", "fact_widget_deployments_id": "ff9d19f3d7d0a5ae6ce5b41a3d26127c", "inserted_timestamp": "2023-08-24T13:25:19.368Z", "modified_timestamp": "2023-08-24T13:25:19.368Z", "__row_index": 26}