{"tx_hash": "5VzWUffzrHu5r6Nc6JXWq9pAMucQz8EmnHidYKnQVPka", "action_id_social": "4KTo7pzGYF3ZeAEV2MYCZMozGaHVv2D7bp5nhKy6jozS-0-widget", "block_id": 96325128, "block_timestamp": "2023-07-12T20:45:47.133Z", "signer_id": "dev-queryapi.dataplatform.near", "widget_name": "QueryApi.Examples.Feed.PostPage", "source_code": "const GRAPHQL_ENDPOINT =\n  props.GRAPHQL_ENDPOINT || \"https://near-queryapi.api.pagoda.co\";\nconst APP_OWNER = props.APP_OWNER || \"dataplatform.near\";\nconst accountId = props.accountId;\nconst commentBlockHeight = parseInt(props.commentBlockHeight);\n\nState.init({\n  parentPostLoaded: false,\n  originalPostLikes: undefined,\n  originalAuthorAccountId: undefined,\n  originalAuthorBlockHeight: undefined,\n  originalPostContent: undefined,\n});\n\nconst parentPostByComment = `query ParentPostByComment {\n  dataplatform_near_feed_indexer_comments(\n    where: {_and: {account_id: {_eq: \"${accountId}\"}, block_height: {_eq: ${commentBlockHeight}}}}\n  ) {\n    post {\n      account_id\n      accounts_liked\n      block_height\n      block_timestamp\n      content\n      id\n      receipt_id\n      comments {\n        account_id\n        block_height\n        block_timestamp\n        content\n        receipt_id\n        id\n      }\n      post_likes {\n        account_id\n        block_height\n        block_timestamp\n        receipt_id\n      }\n    }\n    receipt_id\n    id\n  }\n}`;\n\nfunction fetchGraphQL(operationsDoc, operationName, variables) {\n  return asyncFetch(\n    `${GRAPHQL_ENDPOINT}/v1/graphql`,\n    {\n      method: \"POST\",\n      headers: { \"x-hasura-role\": \"dataplatform_near\" },\n      body: JSON.stringify({\n        query: operationsDoc,\n        variables: variables,\n        operationName: operationName,\n      }),\n    }\n  );\n}\n\nif (commentBlockHeight) {\n  fetchGraphQL(parentPostByComment, \"ParentPostByComment\", {}).then(\n    (result) => {\n      if (result.status === 200) {\n        if (result.body.data) {\n          const posts = result.body.data.dataplatform_near_feed_indexer_comments;\n          if (posts.length > 0) {\n            const post = posts[0].post;\n            let content = JSON.parse(post.content);\n            const comments = post.comments;\n            State.update({\n              parentPostLoaded: true,\n              originalAuthorAccountId: post.account_id,\n              originalAuthorBlockHeight: post.block_height,\n              originalPostContent: content,\n              comments: comments,\n              originalPostLikes: post.accounts_liked,\n            });\n          }\n        }\n      }\n    }\n  );\n}\nif (state.parentPostLoaded && commentBlockHeight) {\n  return (\n    <Widget\n      src={`${APP_OWNER}/widget/QueryApi.Examples.Feed.Post`}\n      props={{\n        accountId: state.originalAuthorAccountId,\n        blockHeight: state.originalAuthorBlockHeight,\n        content: state.originalPostContent,\n        highlightComment: { accountId, blockHeight: commentBlockHeight },\n        comments: state.comments,\n        likes: state.likes,\n        GRAPHQL_ENDPOINT,\n        APP_OWNER,\n      }}\n    />\n  );\n}\n\nreturn (\n  <Widget\n    src={`${APP_OWNER}/widget/QueryApi.Examples.Feed.Post`}\n    props={{\n      ...props, commentsLimit: 30, subscribe: true, GRAPHQL_ENDPOINT,\n      APP_OWNER,\n    }}\n  />\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/dev-queryapi.dataplatform.near/widget/QueryApi.Examples.Feed.PostPage", "fact_widget_deployments_id": "fb579f48d8718effebdd7277bb9e1ddb", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 4}