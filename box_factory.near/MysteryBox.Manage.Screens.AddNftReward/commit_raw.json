{"tx_hash": "2CykLLccTYcUDVTW49NSLMv4xcsjJ1FhLRQyHxk43gnQ", "action_id_social": "ESYaA36st83dxRtzPedyRPnCYgf2N88UZzvzYYZ3BPnX-0-widget", "block_id": 112698817, "block_timestamp": "2024-02-12T19:51:32.683Z", "signer_id": "box_factory.near", "widget_name": "MysteryBox.Manage.Screens.AddNftReward", "source_code": "console.log('props', props);\n\nconst tokens = props.tokens || [];\n\nState.init({\n  active: 0,\n  rarities: tokens.map((token) => ({\n    contract: token.contract,\n    token_id: token.token.token_id,\n    value: '',\n  })),\n});\n\nconst SliderWrapper = styled.div`\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  align-items: center;\n\n  flex-basis: 70%;\n\n  width: 48%;\n\n  @media (max-width: 1024px) {\n    width: 60%;\n  }\n\n  @media (max-width: 786px) {\n    width: 75%;\n  }\n  @media (max-width: 512px) {\n    width: 90%;\n  }\n`;\n\nconst Svg = styled.svg`\n  height: 36px;\n  cursor: pointer;\n\n  ${(props) =>\n    !props.disabled\n      ? `filter: drop-shadow(0px 0px 4px rgba(43, 204, 193, 0.5));`\n      : `filter: none;`}\n`;\n\nconst RightArrow = ({ onClick, disabled }) => (\n  <Svg\n    viewBox=\"0 0 35 58\"\n    disabled={disabled}\n    onClick={onClick}\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <g xmlns=\"http://www.w3.org/2000/svg\">\n      <path\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M0.550369 4.94975L5.50011 0L29.521 24.0209L29.542 24L34.4917 28.9497L34.4708 28.9707L34.4915 28.9914L29.5417 33.9411L29.521 33.9204L5.50032 57.9411L0.550575 52.9914L24.5713 28.9707L0.550369 4.94975Z\"\n        fill={disabled ? '#818B94' : '#fff'}\n      />\n    </g>\n  </Svg>\n);\n\nconst LeftArrow = ({ onClick, disabled }) => (\n  <Svg\n    viewBox=\"0 0 35 58\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    disabled={disabled}\n    onClick={onClick}\n  >\n    <g xmlns=\"http://www.w3.org/2000/svg\" transform=\"matrix(-1 0 0 -1 35 58)\">\n      <path\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M0.550369 4.94975L5.50011 0L29.521 24.0209L29.542 24L34.4917 28.9497L34.4708 28.9707L34.4915 28.9914L29.5417 33.9411L29.521 33.9204L5.50032 57.9411L0.550575 52.9914L24.5713 28.9707L0.550369 4.94975Z\"\n        fill={disabled ? '#818B94' : '#fff'}\n      />\n    </g>\n  </Svg>\n);\n\nconst WrapperLogo = styled.div`\n  position: absolute;\n  top: 24px;\n  left: 24px;\n`;\n\nconst Logo = styled.img`\n  height: 50px;\n\n  @media (max-width: 768px) {\n    height: 42px;\n  }\n\n  @media (max-width: 512px) {\n    height: 32px;\n  }\n`;\n\nconst HomeButton = styled.button`\n  border: 0;\n  background: none;\n`;\n\nconst Title = styled.p`\n  font-family: 'Kodchasan', sans-serif;\n  font-size: 28px;\n  font-weight: 700;\n  letter-spacing: 0em;\n  text-align: center;\n  color: #ffffff;\n  text-transform: uppercase;\n  margin: 0;\n`;\n\nconst WrapperMenu = styled.div`\n  background: rgba(24, 36, 50, 1);\n  border: 0;\n  border-radius: 30px;\n\n  display: flex;\n  flex-direction: column;\n  justify-content: space-evenly;\n  align-items: center;\n\n  flex-basis: 84%;\n\n  height: 100%;\n`;\n\nconst MenuTitle = styled.p`\n  font-family: 'Kodchasan', sans-serif;\n  font-size: 28px;\n  font-weight: 700;\n  letter-spacing: 0em;\n  text-align: center;\n  color: #ffffff;\n  margin: 0;\n`;\n\nconst MenuSubtitle = styled.p`\n  font-family: 'Kodchasan', sans-serif;\n  font-size: 14px;\n  font-weight: 400;\n  letter-spacing: 0em;\n  text-align: center;\n  color: rgba(43, 204, 194, 1);\n  margin: 0;\n`;\n\nconst MenuHeader = styled.div`\n  flex-basis: 20%;\n`;\n\nconst MenuContent = styled.div`\n  display: flex;\n  width: 100%;\n  flex-basis: 55%;\n\n  justify-content: center;\n  align-items: center;\n`;\n\nconst WrapperNftPreview = styled.div`\n  width: 80%;\n  height: 100%;\n\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  flex-direction: column;\n\n  border: 0;\n  border-radius: 30px;\n\n  ${(props) => {\n    if (!props.url) return `background: #638caf;`;\n\n    return `\n    background-image: url(${props.url});\n    background-size: cover;\n    background-position: center;\n    `;\n  }}\n\n  box-shadow: 0px 40px 40px 0px #00000033;\n  padding-top: 4px;\n  padding-bottom: 4px;\n`;\n\nconst NftTokenTitle = styled.div`\n  width: 90%;\n  flex-basis: 32px;\n\n  border-radius: 30px;\n  background: #182432;\n\n  display: flex;\n  justify-content: center;\n  align-items: center;\n\n  margin: 0;\n\n  font-family: Kodchasan;\n  font-size: 16px;\n  font-weight: 500;\n  text-align: center;\n\n  color: white;\n`;\n\nconst NftCollection = styled.div`\n  width: 90%;\n  flex-basis: 32px;\n\n  display: flex;\n  justify-content: flex-start;\n  align-items: center;\n\n  margin: 0;\n\n  font-family: Kodchasan;\n  font-size: 11px;\n  font-weight: 300;\n  text-align: center;\n\n  color: white;\n`;\n\nconst NftCollectionLogo = styled.img`\n  width: 32px;\n  height: 32px;\n\n  border-radius: 50%;\n  background: #182432;\n`;\n\nconst NftCollectionTitle = styled.p`\n  font-family: Kodchasan;\n  font-size: 14px;\n  font-weight: 500;\n  text-align: center;\n\n  color: white;\n\n  margin: 0;\n  margin-left: 8px;\n`;\n\nconst MenuFooter = styled.div`\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  width: 100%;\n  flex-basis: 15%;\n`;\n\nconst RarityPicker = styled.div`\n  width: 80%;\n  height: 40px;\n\n  border: 0;\n  border-radius: 10px;\n  background: #202f3f;\n\n  display: flex;\n  justify-content: space-evenly;\n  align-items: center;\n`;\n\nconst RarityText = styled.p`\n  margin: 0;\n\n  font-family: Kodchasan;\n  font-size: 11px;\n  font-weight: 300;\n  text-align: center;\n\n  color: white;\n`;\n\nconst RarityPickerMenu = styled.div`\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n\n  flex-basis: 100px;\n`;\n\nconst rarities = state.rarities || [];\n\nconsole.log('rarities', rarities);\n\nconst previousActiveToken = () => {\n  if (state.active === 0) return;\n\n  State.update({ active: state.active - 1 });\n};\n\nconst nextActiveToken = () => {\n  if (state.active === tokens.length - 1) return;\n\n  State.update({ active: state.active + 1 });\n};\n\nconst token = tokens[state.active];\nconst rarity = rarities[state.active]?.value;\n\nconst getMediaUrlForToken = (nftToken) => {\n  const { token, metadata } = nftToken;\n\n  if (!metadata || !token) return null;\n\n  if (!token.metadata?.media) return undefined;\n\n  if (!metadata.base_uri) return token.metadata?.media;\n\n  const url = metadata.base_uri + '/' + token.metadata.media;\n\n  return url;\n};\n\nconst getTitleForToken = (nftToken) => {\n  const { token } = nftToken;\n\n  return token.metadata.title;\n};\n\nconst getCollectionTitleForToken = (nftToken) => {\n  const { metadata } = nftToken;\n\n  return metadata.name;\n};\n\nconst getCollectionIconForToken = (nftToken) => {\n  const { metadata } = nftToken;\n\n  return metadata.icon;\n};\n\nconst updateRarity = (contract, token_id, value) => {\n  State.update((previousState) => {\n    const { rarities } = previousState;\n\n    const rarity = rarities.find(\n      (rarity) => rarity.contract === contract && rarity.token_id === token_id\n    );\n\n    if (rarity === -1) return previousState;\n\n    rarity.value = value;\n\n    return {\n      ...previousState,\n      rarities,\n    };\n  });\n};\n\nconst someRarityIsChosen = rarities.some((rarity) => !!rarity.value);\n\nconst shouldSubmitButtonBeDisabled = !someRarityIsChosen;\n\nconst submitTransactionToAddNftRewards = () => {\n  console.log('submitTransactionToAddNftRewards', rarities);\n\n  if (!someRarityIsChosen) return;\n\n  const txn = rarities\n    .filter((rarity) => !!rarity.value)\n    .map((rarity) => {\n      return {\n        contractName: rarity.contract,\n        methodName: 'nft_transfer_call',\n        args: {\n          receiver_id: props.contract?.contract_id,\n          token_id: rarity.token_id,\n          msg: rarity.value,\n        },\n        gas: Big(10).pow(12).mul(50), // 50 TGas\n        deposit: 1, // 0.00064N + accounts\n      };\n    });\n\n  Near.call(txn);\n};\n\nreturn (\n  <>\n    <Title>Add NFT Reward</Title>\n    <SliderWrapper>\n      <LeftArrow disabled={state.active === 0} onClick={previousActiveToken} />\n      <WrapperMenu>\n        <MenuHeader>\n          <MenuTitle>{props.contract?.title}</MenuTitle>\n          <MenuSubtitle>{props.contract?.contract_id}</MenuSubtitle>\n        </MenuHeader>\n        <MenuContent>\n          <WrapperNftPreview url={getMediaUrlForToken(token)}>\n            <NftTokenTitle>{getTitleForToken(token)}</NftTokenTitle>\n            <NftCollection>\n              <NftCollectionLogo src={getCollectionIconForToken(token)} />\n              <NftCollectionTitle>\n                {getCollectionTitleForToken(token)}\n              </NftCollectionTitle>\n            </NftCollection>\n          </WrapperNftPreview>\n        </MenuContent>\n        <MenuFooter>\n          <RarityPicker>\n            <Svg\n              width={24}\n              height={24}\n              viewBox=\"0 0 26 26\"\n              fill=\"none\"\n              xmlns=\"http://www.w3.org/2000/svg\"\n              disabled={!rarity}\n              onClick={() => {\n                updateRarity(token.contract, token.token.token_id, '');\n              }}\n            >\n              <path\n                d=\"M22.192 3.808A12.915 12.915 0 0 0 13 0a12.915 12.915 0 0 0-9.192 3.808A12.915 12.915 0 0 0 0 13c0 3.472 1.352 6.737 3.808 9.192A12.915 12.915 0 0 0 13 26c3.472 0 6.737-1.352 9.192-3.808A12.915 12.915 0 0 0 26 13c0-3.472-1.352-6.737-3.808-9.192ZM13 24.477C6.672 24.477 1.523 19.328 1.523 13S6.672 1.523 13 1.523 24.477 6.672 24.477 13 19.328 24.477 13 24.477Z\"\n                fill=\"#8DBFEA\"\n              />\n              <path\n                d=\"M14.537 9.991h-4.72l.811-.727a.688.688 0 0 0 0-1.047.893.893 0 0 0-1.167 0l-2.22 1.991a.688.688 0 0 0 0 1.047l2.22 1.992a.873.873 0 0 0 .583.216.873.873 0 0 0 .584-.216.688.688 0 0 0 0-1.048l-.81-.727h4.72c1.55 0 2.811 1.132 2.811 2.524 0 1.39-1.261 2.523-2.812 2.523h-2.886c-.456 0-.825.332-.825.74 0 .41.369.741.825.741h2.886C16.998 18 19 16.204 19 13.996c0-2.209-2.002-4.005-4.463-4.005Z\"\n                fill=\"#8DBFEA\"\n              />\n            </Svg>\n            <RarityText>Set NFT Rarity</RarityText>\n            <RarityPickerMenu>\n              <Widget\n                src=\"box_factory.near/widget/MysteryBox.Manage.Components.RarityButton\"\n                props={{\n                  rarity: 'rare',\n                  active: rarity === 'rare',\n                  onClick: () => {\n                    updateRarity(token.contract, token.token.token_id, 'rare');\n                  },\n                  tooltip: 'Rare',\n                }}\n              />\n              <Widget\n                src=\"box_factory.near/widget/MysteryBox.Manage.Components.RarityButton\"\n                props={{\n                  rarity: 'epic',\n                  active: rarity === 'epic',\n                  onClick: () => {\n                    updateRarity(token.contract, token.token.token_id, 'epic');\n                  },\n                  tooltip: 'Epic',\n                }}\n              />\n              <Widget\n                src=\"box_factory.near/widget/MysteryBox.Manage.Components.RarityButton\"\n                props={{\n                  rarity: 'legendary',\n                  active: rarity === 'legendary',\n                  onClick: () => {\n                    updateRarity(\n                      token.contract,\n                      token.token.token_id,\n                      'legendary'\n                    );\n                  },\n                  tooltip: 'Legendary',\n                }}\n              />\n            </RarityPickerMenu>\n          </RarityPicker>\n        </MenuFooter>\n      </WrapperMenu>\n      <RightArrow\n        disabled={state.active === tokens.length - 1}\n        onClick={nextActiveToken}\n      />\n    </SliderWrapper>\n    <Widget\n      src={`box_factory.near/widget/MysteryBox.Manage.Components.SubmitButton`}\n      props={{\n        text: 'Submit',\n        disabled: shouldSubmitButtonBeDisabled,\n        onClick: submitTransactionToAddNftRewards,\n      }}\n    />\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/box_factory.near/widget/MysteryBox.Manage.Screens.AddNftReward", "fact_widget_deployments_id": "add023954b2300775bc7572a3717a1fe", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}