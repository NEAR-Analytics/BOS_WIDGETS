{"tx_hash": "5Vj9FdMSHN3LhsKyWzRgHycWfbgyW5gxSurFmYoLcKDF", "action_id_social": "C5UVyHJ1iGDJwN5UwCXLJFjgCwQ7Y6DGE2LsR9HwkN6w-0-widget", "block_id": 111039728, "block_timestamp": "2024-01-22T13:46:20.797Z", "signer_id": "root.near", "widget_name": "Multisig.AddRequestTransfer", "source_code": "const contract_id = props.contract_id;\nconst receiver_id = props.receiver_id ?? \"\";\nconst token_id = props.token_id ?? \"\";\nconst amount = props.amount ?? \"\";\n\nconst metadata =\n  token_id != null ? Near.view(token_id, \"ft_metadata\") : { decimals: 24 };\n\nif (metadata == null) return;\n\nfunction onTransfer() {\n  console.log(1, state);\n  const defaultGas = (300 * 1000000000000).toString();\n  const functionCallGas = (200 * 1000000000000).toString();\n\n  if (state.token_id === \"near\") {\n    const amount = new Big(state.amount).mul(new Big(10).pow(24)).toFixed();\n    Near.call(\n      contract_id,\n      \"add_request_and_confirm\",\n      {\n        request: {\n          receiver_id: state.token_id,\n          actions: [\n            {\n              type: \"Transfer\",\n              amount,\n            },\n          ],\n        },\n      },\n      defaultGas,\n      0\n    );\n    return;\n  }\n  const amount = new Big(state.amount)\n    .mul(new Big(10).pow(state.metadata.decimals))\n    .toFixed();\n  console.log({\n    decimals,\n    receiver_id: state.receiver_id,\n    token_id: state.token_id,\n    amount,\n  });\n  const args = { amount, receiver_id: state.receiver_id };\n  Near.call(\n    contract_id,\n    \"add_request_and_confirm\",\n    {\n      request: {\n        receiver_id: state.token_id,\n        actions: [\n          {\n            type: \"FunctionCall\",\n            method_name: \"ft_transfer\",\n            args: btoa(JSON.stringify(args)),\n            deposit: \"1\",\n            gas: functionCallGas,\n          },\n        ],\n      },\n    },\n    defaultGas,\n    0\n  );\n}\n\nState.init({\n  receiver_id,\n  token_id,\n  amount,\n  metadata,\n});\n\nconst debounce = (func, wait) => {\n  const pause = wait || 350;\n  let timeout;\n\n  return (args) => {\n    const later = () => {\n      clearTimeout(timeout);\n      func(args);\n    };\n\n    clearTimeout(timeout);\n    timeout = setTimeout(later, pause);\n  };\n};\n\nconst onReceiverChange = debounce((e) => {\n  State.update({\n    receiver_id: e.target.value,\n  });\n});\n\nconst onTokenChange = debounce((e) => {\n  State.update({\n    token_id: e.target.value,\n  });\n});\n\nconst onAmountChange = debounce((e) => {\n  State.update({\n    amount: e.target.value,\n  });\n});\n\nuseEffect(() => {\n  const metadata = Near.view(state.token_id, \"ft_metadata\", {});\n  State.update({ metadata });\n});\n\nreturn (\n  <div>\n    <div class=\"row mb-4\">\n      <div class=\"col d-flex w-100\">\n        <div class=\"form-outline mb-4 w-100\">\n          <input\n            class=\"form-control\"\n            type=\"text\"\n            id=\"transfer-receiver\"\n            placeholder=\"Receiver\"\n            onChange={onReceiverChange}\n            defaultValue={state.receiver_id}\n          />\n          <label class=\"form-label\" for=\"transfer-receiver\">\n            Enter receiver\n          </label>\n        </div>\n      </div>\n      <div class=\"col d-flex w-100\">\n        <div class=\"form-outline mb-4 w-100\">\n          <input\n            class=\"form-control\"\n            type=\"text\"\n            id=\"transfer-token\"\n            placeholder=\"Token\"\n            onChange={onTokenChange}\n            defaultValue={state.token_id}\n          />\n          <label class=\"form-label\" for=\"transfer-token\">\n            Enter token\n          </label>\n        </div>\n      </div>\n      <div class=\"col d-flex w-100\">\n        <div class=\"form-outline mb-4 w-100\">\n          <input\n            class=\"form-control\"\n            type=\"text\"\n            id=\"transfer-amount\"\n            placeholder=\"Amount\"\n            onChange={onAmountChange}\n            defaultValue={state.amount}\n          />\n          <label class=\"form-label\" for=\"transfer-amount\">\n            Amount (decimals: {state.metadata.decimals})\n          </label>\n        </div>\n      </div>\n      <div class=\"col-12 col-lg-6 text-left justify-content-left\">\n        <button type=\"button\" onClick={onTransfer}>\n          Transfer\n        </button>\n      </div>\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/root.near/widget/Multisig.AddRequestTransfer", "fact_widget_deployments_id": "24b7d78a2192c89c9e7140a991d1b6e9", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 3}