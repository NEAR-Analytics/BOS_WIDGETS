{"tx_hash": "GGoTKk3SMNBBUyfk3WDNZDkvZ3mwvzasa4EBcL95cw5N", "action_id_social": "33txCPU167XmJYxes2mhyfdduiRgmgK5yx8V1SyWa3UU-0-widget", "block_id": 108323584, "block_timestamp": "2023-12-19T10:50:21.253Z", "signer_id": "kan_k.near", "widget_name": "VideoUploadTestNet", "source_code": "const accountId = props.accountId ?? context.accountId;\nconst CONTRACT_ADDRESS =\n  props.contractAddress || \"0x5BfC487da8Da663CcCAEb6aF594F953D976cf9f3\";\nconst vdoUrl = props.vdoUrl\n  ? props.vdoUrl\n  : \"https://firebasestorage.googleapis.com/v0/b/component-dev-lab.appspot.com/o/uploads%2F1702888364122-CAMT%2020th%203%20Generations.mp4?alt=media&token=9f29b9a6-00ef-43c5-89e5-1dc2e0127bdb\";\n\nState.init({\n  id: \"\",\n  timestamp: Date.now(),\n  title: \"\",\n  description: \"\",\n  owner: accountId,\n  src: vdoUrl,\n  thumbnail: \"https://ipfs.near.social/ipfs/\",\n  tag: \"\",\n  parentVdoId: props.parentVdoId || \"\",\n  isSuccess: false,\n});\n\nconst onTimestampChange = ({ target }) => {\n  State.update({ timestamp: target.value });\n};\n\nconst onTitleChange = ({ target }) => {\n  State.update({ title: target.value });\n};\n\nconst onDescriptionChange = ({ target }) => {\n  State.update({ description: target.value });\n};\n\nconst onOwnerChange = ({ target }) => {\n  State.update({ owner: target.value });\n};\n\nconst onSrcChange = ({ target }) => {\n  State.update({ src: target.value });\n};\n\nconst onThumbnailChange = ({ target }) => {\n  State.update({ thumbnail: target.value });\n};\n\nconst onTagChange = ({ target }) => {\n  State.update({ tag: target.value });\n};\n\nfunction getSigner() {\n  return Ethers.provider().getSigner();\n}\n\nconst abi = [\n  {\n    inputs: [],\n    stateMutability: \"nonpayable\",\n    type: \"constructor\",\n  },\n  {\n    inputs: [\n      {\n        internalType: \"address\",\n        name: \"account\",\n        type: \"address\",\n      },\n    ],\n    name: \"addAdmin\",\n    outputs: [],\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      {\n        internalType: \"uint256\",\n        name: \"video_id\",\n        type: \"uint256\",\n      },\n      {\n        internalType: \"string\",\n        name: \"comment_message\",\n        type: \"string\",\n      },\n    ],\n    name: \"addComment\",\n    outputs: [],\n    stateMutability: \"payable\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      {\n        components: [\n          {\n            internalType: \"string\",\n            name: \"_title\",\n            type: \"string\",\n          },\n          {\n            internalType: \"string\",\n            name: \"_description\",\n            type: \"string\",\n          },\n          {\n            internalType: \"string\",\n            name: \"_url\",\n            type: \"string\",\n          },\n          {\n            internalType: \"string\",\n            name: \"_thumb_url\",\n            type: \"string\",\n          },\n          {\n            internalType: \"uint256\",\n            name: \"_duration\",\n            type: \"uint256\",\n          },\n          {\n            internalType: \"string[]\",\n            name: \"_keywords\",\n            type: \"string[]\",\n          },\n        ],\n        internalType: \"struct Atomic.VideoAdd\",\n        name: \"_video_add\",\n        type: \"tuple\",\n      },\n      {\n        internalType: \"uint256[]\",\n        name: \"_attributions\",\n        type: \"uint256[]\",\n      },\n      {\n        internalType: \"string\",\n        name: \"_near_id\",\n        type: \"string\",\n      },\n    ],\n    name: \"addVideo\",\n    outputs: [],\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      {\n        internalType: \"uint256\",\n        name: \"video_id\",\n        type: \"uint256\",\n      },\n    ],\n    name: \"adminDeleteVideo\",\n    outputs: [],\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      {\n        internalType: \"uint256\",\n        name: \"_video_id\",\n        type: \"uint256\",\n      },\n    ],\n    name: \"deleteVideo\",\n    outputs: [],\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      {\n        internalType: \"address\",\n        name: \"addr\",\n        type: \"address\",\n      },\n    ],\n    name: \"getAddressNearID\",\n    outputs: [\n      {\n        internalType: \"string\",\n        name: \"\",\n        type: \"string\",\n      },\n    ],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      {\n        internalType: \"uint256\",\n        name: \"video_id\",\n        type: \"uint256\",\n      },\n    ],\n    name: \"getAttributions\",\n    outputs: [\n      {\n        internalType: \"uint256[]\",\n        name: \"\",\n        type: \"uint256[]\",\n      },\n    ],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      {\n        internalType: \"uint256\",\n        name: \"video_id\",\n        type: \"uint256\",\n      },\n    ],\n    name: \"getComments\",\n    outputs: [\n      {\n        components: [\n          {\n            internalType: \"address\",\n            name: \"poster\",\n            type: \"address\",\n          },\n          {\n            internalType: \"string\",\n            name: \"message\",\n            type: \"string\",\n          },\n          {\n            internalType: \"uint256\",\n            name: \"amount\",\n            type: \"uint256\",\n          },\n          {\n            internalType: \"uint256\",\n            name: \"timestamp\",\n            type: \"uint256\",\n          },\n        ],\n        internalType: \"struct Atomic.Comment[]\",\n        name: \"\",\n        type: \"tuple[]\",\n      },\n    ],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      {\n        internalType: \"uint256\",\n        name: \"size\",\n        type: \"uint256\",\n      },\n    ],\n    name: \"getLatestVideos\",\n    outputs: [\n      {\n        components: [\n          {\n            components: [\n              {\n                internalType: \"uint256\",\n                name: \"id\",\n                type: \"uint256\",\n              },\n              {\n                internalType: \"string\",\n                name: \"title\",\n                type: \"string\",\n              },\n              {\n                internalType: \"string\",\n                name: \"description\",\n                type: \"string\",\n              },\n              {\n                internalType: \"string\",\n                name: \"url\",\n                type: \"string\",\n              },\n              {\n                internalType: \"string\",\n                name: \"thumb_url\",\n                type: \"string\",\n              },\n              {\n                internalType: \"string[]\",\n                name: \"keywords\",\n                type: \"string[]\",\n              },\n              {\n                internalType: \"uint256\",\n                name: \"duration\",\n                type: \"uint256\",\n              },\n              {\n                internalType: \"uint256\",\n                name: \"timestamp\",\n                type: \"uint256\",\n              },\n            ],\n            internalType: \"struct Atomic.Video\",\n            name: \"video\",\n            type: \"tuple\",\n          },\n          {\n            internalType: \"string\",\n            name: \"near_id\",\n            type: \"string\",\n          },\n        ],\n        internalType: \"struct Atomic.VideoWithNearID[]\",\n        name: \"\",\n        type: \"tuple[]\",\n      },\n    ],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    inputs: [],\n    name: \"getOwner\",\n    outputs: [\n      {\n        internalType: \"address\",\n        name: \"\",\n        type: \"address\",\n      },\n    ],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      {\n        internalType: \"uint256\",\n        name: \"video_id\",\n        type: \"uint256\",\n      },\n    ],\n    name: \"getVideo\",\n    outputs: [\n      {\n        components: [\n          {\n            components: [\n              {\n                internalType: \"uint256\",\n                name: \"id\",\n                type: \"uint256\",\n              },\n              {\n                internalType: \"string\",\n                name: \"title\",\n                type: \"string\",\n              },\n              {\n                internalType: \"string\",\n                name: \"description\",\n                type: \"string\",\n              },\n              {\n                internalType: \"string\",\n                name: \"url\",\n                type: \"string\",\n              },\n              {\n                internalType: \"string\",\n                name: \"thumb_url\",\n                type: \"string\",\n              },\n              {\n                internalType: \"string[]\",\n                name: \"keywords\",\n                type: \"string[]\",\n              },\n              {\n                internalType: \"uint256\",\n                name: \"duration\",\n                type: \"uint256\",\n              },\n              {\n                internalType: \"uint256\",\n                name: \"timestamp\",\n                type: \"uint256\",\n              },\n            ],\n            internalType: \"struct Atomic.Video\",\n            name: \"video\",\n            type: \"tuple\",\n          },\n          {\n            internalType: \"string\",\n            name: \"near_id\",\n            type: \"string\",\n          },\n        ],\n        internalType: \"struct Atomic.VideoWithNearID\",\n        name: \"\",\n        type: \"tuple\",\n      },\n    ],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      {\n        internalType: \"string\",\n        name: \"_near_id\",\n        type: \"string\",\n      },\n    ],\n    name: \"getVideoByNearID\",\n    outputs: [\n      {\n        components: [\n          {\n            components: [\n              {\n                internalType: \"uint256\",\n                name: \"id\",\n                type: \"uint256\",\n              },\n              {\n                internalType: \"string\",\n                name: \"title\",\n                type: \"string\",\n              },\n              {\n                internalType: \"string\",\n                name: \"description\",\n                type: \"string\",\n              },\n              {\n                internalType: \"string\",\n                name: \"url\",\n                type: \"string\",\n              },\n              {\n                internalType: \"string\",\n                name: \"thumb_url\",\n                type: \"string\",\n              },\n              {\n                internalType: \"string[]\",\n                name: \"keywords\",\n                type: \"string[]\",\n              },\n              {\n                internalType: \"uint256\",\n                name: \"duration\",\n                type: \"uint256\",\n              },\n              {\n                internalType: \"uint256\",\n                name: \"timestamp\",\n                type: \"uint256\",\n              },\n            ],\n            internalType: \"struct Atomic.Video\",\n            name: \"video\",\n            type: \"tuple\",\n          },\n          {\n            internalType: \"string\",\n            name: \"near_id\",\n            type: \"string\",\n          },\n        ],\n        internalType: \"struct Atomic.VideoWithNearID[]\",\n        name: \"\",\n        type: \"tuple[]\",\n      },\n    ],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      {\n        internalType: \"string[]\",\n        name: \"terms\",\n        type: \"string[]\",\n      },\n    ],\n    name: \"getVideosByTerm\",\n    outputs: [\n      {\n        components: [\n          {\n            components: [\n              {\n                internalType: \"uint256\",\n                name: \"id\",\n                type: \"uint256\",\n              },\n              {\n                internalType: \"string\",\n                name: \"title\",\n                type: \"string\",\n              },\n              {\n                internalType: \"string\",\n                name: \"description\",\n                type: \"string\",\n              },\n              {\n                internalType: \"string\",\n                name: \"url\",\n                type: \"string\",\n              },\n              {\n                internalType: \"string\",\n                name: \"thumb_url\",\n                type: \"string\",\n              },\n              {\n                internalType: \"string[]\",\n                name: \"keywords\",\n                type: \"string[]\",\n              },\n              {\n                internalType: \"uint256\",\n                name: \"duration\",\n                type: \"uint256\",\n              },\n              {\n                internalType: \"uint256\",\n                name: \"timestamp\",\n                type: \"uint256\",\n              },\n            ],\n            internalType: \"struct Atomic.Video\",\n            name: \"video\",\n            type: \"tuple\",\n          },\n          {\n            internalType: \"string\",\n            name: \"near_id\",\n            type: \"string\",\n          },\n        ],\n        internalType: \"struct Atomic.VideoWithNearID[]\",\n        name: \"\",\n        type: \"tuple[]\",\n      },\n    ],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      {\n        internalType: \"string\",\n        name: \"_near_id\",\n        type: \"string\",\n      },\n    ],\n    name: \"setNearID\",\n    outputs: [],\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n];\n\nconst onBtnClick = async () => {\n  const body = {\n    timestamp: Date.now(),\n    title: state.title,\n    description: state.description,\n    owner: state.owner,\n    src: vdoUrl,\n    thumbnail: `https://ipfs.near.social/ipfs/${state.thumbnail.cid}`,\n    tag: state.tag,\n    parentVdoId: state.parentVdoId,\n  };\n\n  console.log(body);\n\n  const signer = Ethers.provider().getSigner();\n  const contract = new ethers.Contract(CONTRACT_ADDRESS, abi, signer);\n  contract\n    .addVideo(\n      {\n        _title: body.title,\n        _description: body.description,\n        _url: body.src,\n        _thumb_url: body.thumbnail,\n        _duration: 12,\n        _keywords: [body.tag],\n      },\n      parentVdoId ? [parentVdoId] : [],\n      body.owner\n    )\n    .then((res) => {\n      if (res.hash) {\n        console.log(\"Success! \" + res.hash);\n        State.update({ isSuccess: true });\n      } else {\n        console.log(\"Failed!\");\n      }\n    });\n};\n\nreturn (\n  <div className=\"m-10 VStack Subtitle  w-1/3 gap-10\">\n    <div className=\"VStack justify-between h-full\">\n      <div className=\"VStack gap-4\">\n        <Widget\n          src={`kan_k.near/widget/Alert`}\n          props={{ isOpen: state.isOpen, children: \"<a href='/'>Back</a>\" }}\n        />\n      </div>\n      <div className=\"VStack gap-2\">\n        <p className=\" text-md\">Title</p>\n        <input\n          type=\"text\"\n          name=\"\"\n          id=\"\"\n          placeholder=\"title\"\n          onChange={onTitleChange}\n          className=\"p-2 rounded-md System-background-blue\"\n        />\n        <div className=\"VStack gap-2\">\n          <p className=\" text-md\">Description</p>\n          <textarea\n            name=\"\"\n            id=\"\"\n            cols={30}\n            rows={7}\n            onChange={onDescriptionChange}\n            className=\"p-2 rounded-md System-background-blue\"\n            placeholder=\"lorem10\"\n          ></textarea>\n        </div>\n\n        <p className=\" text-md\">Tag</p>\n        <input\n          type=\"text\"\n          name=\"\"\n          id=\"\"\n          onChange={onTagChange}\n          placeholder=\"tag\"\n          className=\"p-2 rounded-md System-background-blue\"\n        />\n      </div>\n\n      <div className=\"mt-2 mb-3\">\n        <p className=\" text-md\">Thumbnail</p>\n        <IpfsImageUpload\n          image={state.thumbnail}\n          className=\"Button-primary rounded-md\"\n        />\n      </div>\n    </div>\n    <div className=\"w-fullitems-end text-right mt-6\">\n      {\" \"}\n      <button className=\"p-2 Button-primary rounded-md \" onClick={onBtnClick}>\n        Publish\n      </button>\n      {isSuccess && (\n        <a href=\"/\">\n          {\" \"}\n          <button\n            className=\"p-2 Button-primary rounded-md \"\n            onClick={onBtnClick}\n          >\n            Finish\n          </button>\n        </a>\n      )}\n    </div>\n  </div>\n);\n", "metadata": {"fork_of": "kan_k.near/widget/VideoUploadTestNet@108322950"}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/kan_k.near/widget/VideoUploadTestNet", "fact_widget_deployments_id": "22caabff03c0514519640a3f705d7d49", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}