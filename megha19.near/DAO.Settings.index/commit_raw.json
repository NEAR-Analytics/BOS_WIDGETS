{"tx_hash": "4QWMmx64XRQt9wyWf1wax6Si7oYvd3EX8nHTEjGfpqak", "action_id_social": "FuCcHUF8qsfYtwZCGpbwZExaLVeyN5gfyH5uPN56pjJG-0-widget", "block_id": 111351654, "block_timestamp": "2024-01-26T10:04:45.933Z", "signer_id": "megha19.near", "widget_name": "DAO.Settings.index", "source_code": "const widgetOwner = props.widgetOwner ?? \"megha19.near\";\nconst daoId = props.daoId;\nconst Wrapper = styled.div`\n  p {\n    font-size: 13px;\n  }\n  .text-subdued {\n    color: rgba(130, 134, 136, 1);\n  }\n\n  .no-card-div {\n    .ndc-card {\n      all: unset;\n    }\n  }\n`;\nconst accountId = context.accountId;\nconst policy = Near.view(daoId, \"get_policy\");\nconst config = Near.view(daoId, \"get_config\");\n\nif (policy === null || config === null) {\n  return <Widget src=\"nearui.near/widget/Feedback.Spinner\" />;\n}\n\nconst metadata = JSON.parse(atob(config.metadata ?? \"\"));\n\nState.init({\n  tab: \"Configuration\",\n  answers: initialAnswers,\n  form: {\n    ...config,\n    policy: policy,\n    ...metadata\n  }\n});\n\nconst currentUserRoles = []; // can have mutliple roles\n\nstate.form?.policy?.roles?.map((role) => {\n  if (\n    Array.isArray(role?.kind?.Group) &&\n    role?.kind?.Group?.includes(accountId)\n  ) {\n    currentUserRoles.push(role.name);\n  }\n});\n\n// checks if user has permission to make edits to the screen\nconst hasPermission = (proposalKind) => {\n  const permissions = currentUserRoles.map((role) => {\n    const roleObj = state.form.policy.roles.find((r) => r.name === role);\n    if (roleObj) {\n      return (\n        roleObj.permissions.includes(`${proposalKind}:*`) ||\n        roleObj.permissions.includes(\"*:*\")\n      );\n    } else {\n      return false;\n    }\n  });\n  return permissions.some((element) => element === true);\n};\n\nconst tabs = {\n  Configuration: {\n    name: \"Configuration\",\n    component: (\n      <Widget\n        src={`megha19.near/widget/DAO.Settings.ConfigSettings`}\n        props={{\n          ...props,\n          formState: state.form,\n          hasPermission: hasPermission(\"config\")\n        }}\n      />\n    )\n  },\n  Policy: {\n    name: \"Policy\",\n    component: (\n      <Widget\n        src={`megha19.near/widget/DAO.Settings.PolicySettings`}\n        props={{\n          ...props,\n          formState: state.form,\n          hasPermission: hasPermission(\"policy\")\n        }}\n      />\n    )\n  },\n  Bonds: {\n    name: \"Bonds and Deadlines\",\n    component: (\n      <Widget\n        src={`megha19.near/widget/DAO.Settings.BondsSettings`}\n        props={{\n          ...props,\n          formState: state.form,\n          hasPermission: hasPermission(\"policy\")\n        }}\n      />\n    )\n  }\n};\n\nconst tabContent = tabs[state.tab].component;\n\nreturn (\n  <Wrapper>\n    <div className=\"mt-4\">\n      <div className=\"ndc-card d-flex flex-column gap-2 p-4\">\n        <h3>DAO settings</h3>\n        <div className=\"w-100 no-card-div\">\n          <Widget\n            src={`${widgetOwner}/widget/DAO.Layout.Tabs`}\n            props={{\n              tabs: tabs,\n              tab: state.tab,\n              update: (state) => State.update(state),\n              allowHref: false\n            }}\n          />\n          <div style={{ marginTop: \"-25px\" }}>{tabContent}</div>\n        </div>\n      </div>\n    </div>\n  </Wrapper>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/megha19.near/widget/DAO.Settings.index", "fact_widget_deployments_id": "e35ee75fa5df626f9d29cb8b6c4bcfe0", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 2}