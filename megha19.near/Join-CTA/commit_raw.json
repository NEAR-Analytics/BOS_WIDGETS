{"tx_hash": "6DhJ6NdDqKTxLiMcQDNLDCQQoHjWGBf6PrXMWqNq4in7", "action_id_social": "5AaerRU2Wqx1BbNCGNyh8No6v2S4BWwPcbce1qyBYdem-0-widget", "block_id": 111217855, "block_timestamp": "2024-01-24T17:32:38.701Z", "signer_id": "megha19.near", "widget_name": "Join-CTA", "source_code": "// checks if the user is already dao's community/council member or has an active proposal\nconst checkIsMemberOrPending = (accountId) => {\n  const daoId = \"build.sputnik-dao.near\";\n  if (!accountId) {\n    return false;\n  }\n  const alreadyJoinedRolesNames = [\"community\", \"council\"];\n  const searchRange = 100;\n\n  const lastProposalId = Near.view(daoId, \"get_last_proposal_id\");\n\n  const policy = Near.view(daoId, \"get_policy\");\n  const isDaoMember = false;\n  const lastProposals =\n    Near.view(daoId, \"get_proposals\", {\n      from_index: lastProposalId - searchRange,\n      limit: searchRange,\n    }) || [];\n  console.log(policy, lastProposals, lastProposalId);\n  const alreadyMadeAProposal =\n    lastProposals.filter((proposal) => {\n      return (\n        proposal.proposer === accountId && proposal.status === \"InProgress\"\n      );\n    }).length > 0;\n\n  policy.roles\n    .filter((role) => alreadyJoinedRolesNames.includes(role.name))\n    .map((role) => {\n      if (Array.isArray(role.kind.Group) && !isDaoMember) {\n        isDaoMember = role.kind.Group.includes(accountId);\n      }\n    });\n  return isDaoMember || alreadyMadeAProposal;\n};\n\nconst isMemberOrPending = checkIsMemberOrPending(context.accountId);\nconsole.log(isMemberOrPending, context.accountId, checkIsMemberOrPending);\nconst logoLink =\n  \"https://ipfs.near.social/ipfs/bafkreihbwho3qfvnu4yss3eh5jrx6uxhrlzdgtdjyzyjrpa6odro6wdxya\";\nconst gridLink =\n  \"https://ipfs.near.social/ipfs/bafkreiay3ytllrxhtyunppqxcazpistttwdzlz3jefdbsq5tosxuryauu4\";\nconst leftBlur =\n  \"https://ipfs.near.social/ipfs/bafkreig2cgzqloepedal5ypphzhzcakl5uoedxjtvbpxbxnywerjbzmfpm\";\nconst rightBlur =\n  \"https://ipfs.near.social/ipfs/bafkreierwhnzytfajagidxim5mzdphu5fopjmlrxehatywzuy6ahr5q7pe\";\n\nconst CTAContainer = styled.div`\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  gap: 2.5rem;\n\n  position: relative;\n\n  padding: 6.25rem 3rem;\n\n  @media screen and (max-width: 768px) {\n    padding: 6.25rem 1.5rem;\n  }\n`;\n\nconst LeftBlur = styled.img`\n  position: absolute;\n  left: 0;\n  top: 50%;\n  transform: translateY(-50%);\n  object-fit: cover;\n  width: 25%;\n\n  @media screen and (max-width: 768px) {\n    width: 50%;\n    opacity: 0.5;\n  }\n`;\n\nconst RightBlur = styled.img`\n  position: absolute;\n  right: 0;\n  top: 75%;\n  transform: translateY(-50%);\n  object-fit: cover;\n  width: 25%;\n\n  @media screen and (max-width: 768px) {\n    width: 50%;\n    opacity: 0.5;\n  }\n`;\n\nconst Grid = styled.img`\n  position: absolute;\n  top: 0;\n  left: 0;\n  opacity: 0.05;\n  object-fit: cover;\n  width: 100%;\n  height: 100%;\n`;\n\nconst Card = styled.div`\n  z-index: 2;\n  display: flex;\n  max-width: 37.5rem;\n  padding: 2.5rem;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  gap: 2.5rem;\n\n  border-radius: 16px;\n  border: 1px solid #51b6ff;\n  background: #000;\n  box-shadow: 4px 24px 48px 0px rgba(255, 189, 52, 0.1);\n\n  h1 {\n    color: #fff;\n    text-align: center;\n\n    /* H1/large */\n    font-size: 48px;\n    font-style: normal;\n    font-weight: 500;\n    line-height: 120%; /* 57.6px */\n    margin: 0;\n  }\n\n  a {\n    display: flex;\n    padding: 10px 20px;\n    justify-content: center;\n    align-items: center;\n    gap: 4px;\n\n    border-radius: 8px;\n    background: #ffaf51;\n\n    color: #000;\n    margin: 0;\n\n    /* Other/Button_text */\n    font-size: 14px;\n    font-style: normal;\n    font-weight: 500;\n    line-height: normal;\n\n    text-decoration: none;\n    transition: all 300ms;\n\n    &:hover {\n      background: #c98a40;\n    }\n  }\n\n  @media screen and (max-width: 768px) {\n    h1 {\n      font-size: 2rem;\n    }\n  }\n`;\n\nconst Logo = styled.img`\n  height: 2.875rem;\n  object-fit: cover;\n`;\n\nreturn (\n  <CTAContainer>\n    <Card>\n      <Logo src={logoLink} />\n      <h1>Together, we can build a better future.</h1>\n      {!isMemberOrPending && <a href=\"/join\">Join Now</a>}\n    </Card>\n    <Grid src={gridLink} />\n    <LeftBlur src={leftBlur} />\n    <RightBlur src={rightBlur} />\n  </CTAContainer>\n);\n", "metadata": {"fork_of": "megha19.near/widget/Join-CTA@111217670"}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/megha19.near/widget/Join-CTA", "fact_widget_deployments_id": "a1ad93810772025276d31b93e9cb7bc8", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 8}