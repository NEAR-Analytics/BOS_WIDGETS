{"tx_hash": "EQUTdDi4BeLMkXwhGnHbSfLwe6B1gX1WHXWSiF7JAZ6E", "action_id_social": "3jETeMhp2U1RMePdUixtVgZNQ8nvSaVNumGCevWXe2Mc-0-widget", "block_id": 120426015, "block_timestamp": "2024-06-04T14:33:54.781Z", "signer_id": "megha19.near", "widget_name": "near-prpsls-bos.components.proposals.Proposal", "source_code": "/*\nLicense: MIT\nAuthor: devhub.near\nHomepage: https://github.com/NEAR-DevHub/near-prpsls-bos#readme\n*/\n/* INCLUDE: \"includes/common.jsx\" */\nconst REPL_DEVHUB = \"devhub.near\";\nconst REPL_INFRASTRUCTURE_COMMITTEE = \"megha19.near\";\nconst REPL_INFRASTRUCTURE_COMMITTEE_CONTRACT = \"truedove38.near\";\nconst REPL_RPC_URL = \"https://rpc.mainnet.near.org\";\nconst REPL_NEAR = \"near\";\nconst RFP_IMAGE =\n  \"https://ipfs.near.social/ipfs/bafkreicbygt4kajytlxij24jj6tkg2ppc2dw3dlqhkermkjjfgdfnlizzy\";\n\nconst RFP_FEED_INDEXER_QUERY_NAME =\n  \"polyprogrammist_near_devhub_objects_s_rfps_with_latest_snapshot\";\n\nconst RFP_INDEXER_QUERY_NAME =\n  \"polyprogrammist_near_devhub_objects_s_rfp_snapshots\";\n\nconst PROPOSAL_FEED_INDEXER_QUERY_NAME =\n  \"polyprogrammist_near_devhub_objects_s_proposals_with_latest_snapshot\";\n\nconst PROPOSAL_QUERY_NAME =\n  \"polyprogrammist_near_devhub_objects_s_proposal_snapshots\";\nconst RFP_TIMELINE_STATUS = {\n  ACCEPTING_SUBMISSIONS: \"ACCEPTING_SUBMISSIONS\",\n  EVALUATION: \"EVALUATION\",\n  PROPOSAL_SELECTED: \"PROPOSAL_SELECTED\",\n  CANCELLED: \"CANCELLED\",\n};\n\nconst PROPOSAL_TIMELINE_STATUS = {\n  DRAFT: \"DRAFT\",\n  REVIEW: \"REVIEW\",\n  APPROVED: \"APPROVED\",\n  REJECTED: \"REJECTED\",\n  CANCELED: \"CANCELLED\",\n  APPROVED_CONDITIONALLY: \"APPROVED_CONDITIONALLY\",\n  PAYMENT_PROCESSING: \"PAYMENT_PROCESSING\",\n  FUNDED: \"FUNDED\",\n};\n\nconst QUERYAPI_ENDPOINT = `https://near-queryapi.api.pagoda.co/v1/graphql`;\n\nasync function fetchGraphQL(operationsDoc, operationName, variables) {\n  return asyncFetch(QUERYAPI_ENDPOINT, {\n    method: \"POST\",\n    headers: { \"x-hasura-role\": `polyprogrammist_near` },\n    body: JSON.stringify({\n      query: operationsDoc,\n      variables: variables,\n      operationName: operationName,\n    }),\n  });\n}\n\nconst CANCEL_RFP_OPTIONS = {\n  CANCEL_PROPOSALS: \"CANCEL_PROPOSALS\",\n  UNLINK_PROPOSALS: \"UNLINK_PROPOSALSS\",\n  NONE: \"NONE\",\n};\n\nfunction parseJSON(json) {\n  if (typeof json === \"string\") {\n    try {\n      return JSON.parse(json);\n    } catch (error) {\n      return json;\n    }\n  } else {\n    return json;\n  }\n}\n\nfunction isNumber(value) {\n  return typeof value === \"number\";\n}\n\nconst PROPOSALS_APPROVED_STATUS_ARRAY = [\n  PROPOSAL_TIMELINE_STATUS.APPROVED,\n  PROPOSAL_TIMELINE_STATUS.APPROVED_CONDITIONALLY,\n  PROPOSAL_TIMELINE_STATUS.PAYMENT_PROCESSING,\n  PROPOSAL_TIMELINE_STATUS.FUNDED,\n];\n\nfunction getLinkUsingCurrentGateway(url) {\n  const data = fetch(`https://httpbin.org/headers`);\n  const gatewayURL = data?.body?.headers?.Origin ?? \"\";\n  `https://${\n    gatewayURL.includes(\"near.org\") ? \"dev.near.org\" : \"near.social\"\n  }/${url}`;\n}\n/* END_INCLUDE: \"includes/common.jsx\" */\n\nconst { href } = VM.require(`${REPL_DEVHUB}/widget/core.lib.url`);\nhref || (href = () => {});\nconst { getGlobalLabels } = VM.require(\n  `${REPL_INFRASTRUCTURE_COMMITTEE}/widget/near-prpsls-bos.components.core.lib.contract`\n) || { getGlobalLabels: () => {} };\n\nconst { readableDate } = VM.require(\n  `${REPL_DEVHUB}/widget/core.lib.common`\n) || { readableDate: () => {} };\n\nconst accountId = context.accountId;\n/*\n  ---props---\n  props.id: number;\n  props.timestamp: number; optional\n  accountId: string\n  blockHeight:number\n  */\n\nconst DecisionStage = [\n  PROPOSAL_TIMELINE_STATUS.APPROVED,\n  PROPOSAL_TIMELINE_STATUS.REJECTED,\n  PROPOSAL_TIMELINE_STATUS.APPROVED_CONDITIONALLY,\n];\n\nconst Container = styled.div`\n  .full-width-div {\n    width: 100vw;\n    position: relative;\n    left: 50%;\n    right: 50%;\n    margin-left: -50vw;\n    margin-right: -50vw;\n  }\n\n  .fw-bold {\n    font-weight: 600 !important;\n  }\n\n  .card.no-border {\n    border-left: none !important;\n    border-right: none !important;\n    margin-bottom: -3.5rem;\n  }\n\n  .description-box {\n    font-size: 14px;\n  }\n\n  .draft-info-container {\n    background-color: #ecf8fb;\n  }\n\n  .review-info-container {\n    background-color: #fef6ee;\n  }\n\n  .text-sm {\n    font-size: 13px !important;\n  }\n\n  .flex-1 {\n    flex: 1;\n  }\n\n  .flex-3 {\n    flex: 3;\n  }\n\n  .circle {\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    border: 1px solid grey;\n  }\n\n  .green-fill {\n    background-color: rgb(4, 164, 110) !important;\n    border-color: rgb(4, 164, 110) !important;\n    color: white !important;\n  }\n\n  .yellow-fill {\n    border-color: #ff7a00 !important;\n  }\n\n  .vertical-line {\n    width: 2px;\n    height: 180px;\n    background-color: lightgrey;\n  }\n\n  @media screen and (max-width: 970px) {\n    .vertical-line {\n      height: 135px !important;\n    }\n\n    .vertical-line-sm {\n      height: 70px !important;\n    }\n\n    .gap-6 {\n      gap: 0.5rem !important;\n    }\n  }\n\n  @media screen and (max-width: 570px) {\n    .vertical-line {\n      height: 180px !important;\n    }\n\n    .vertical-line-sm {\n      height: 75px !important;\n    }\n\n    .gap-6 {\n      gap: 0.5rem !important;\n    }\n  }\n\n  .vertical-line-sm {\n    width: 2px;\n    height: 70px;\n    background-color: lightgrey;\n  }\n\n  .form-check-input:disabled ~ .form-check-label,\n  .form-check-input[disabled] ~ .form-check-label {\n    opacity: 1;\n  }\n\n  .form-check-input {\n    border-color: black !important;\n  }\n\n  .grey-btn {\n    background-color: #687076;\n    border: none;\n    color: white;\n  }\n\n  .form-check-input:checked {\n    background-color: #04a46e !important;\n    border-color: #04a46e !important;\n  }\n\n  .dropdown-toggle:after {\n    position: absolute;\n    top: 46%;\n    right: 5%;\n  }\n\n  .drop-btn {\n    max-width: none !important;\n  }\n\n  .dropdown-menu {\n    width: 100%;\n    border-radius: 0.375rem !important;\n  }\n\n  .green-btn {\n    background-color: #03ba16 !important;\n    border: none;\n    color: white;\n\n    &:active {\n      color: white;\n    }\n  }\n\n  .gap-6 {\n    gap: 2.5rem;\n  }\n\n  .border-vertical {\n    border-top: var(--bs-border-width) var(--bs-border-style)\n      var(--bs-border-color) !important;\n    border-bottom: var(--bs-border-width) var(--bs-border-style)\n      var(--bs-border-color) !important;\n  }\n\n  button.px-0 {\n    padding-inline: 0px !important;\n  }\n\n  red-icon i {\n    color: red;\n  }\n\n  input[type=\"radio\"] {\n    min-width: 13px;\n  }\n`;\n\nconst ProposalContainer = styled.div`\n  border: 1px solid lightgrey;\n  overflow: auto;\n`;\n\nconst Header = styled.div`\n  position: relative;\n  background-color: #f4f4f4;\n  height: 50px;\n\n  .menu {\n    position: absolute;\n    right: 10px;\n    top: 4px;\n    font-size: 30px;\n  }\n`;\n\nconst Text = styled.p`\n  display: block;\n  margin: 0;\n  font-size: 14px;\n  line-height: 20px;\n  font-weight: 400;\n  color: #687076;\n  white-space: nowrap;\n`;\n\nconst Actions = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  margin: -6px -6px 6px;\n`;\n\nconst Avatar = styled.div`\n  width: 40px;\n  height: 40px;\n  pointer-events: none;\n\n  img {\n    object-fit: cover;\n    border-radius: 40px;\n    width: 100%;\n    height: 100%;\n  }\n`;\n\nconst LinkProfile = ({ account, children }) => {\n  return (\n    <Link href={`/near/widget/ProfilePage?accountId=${account}`}>\n      {children}\n    </Link>\n  );\n};\n\nconst stepsArray = [1, 2, 3, 4, 5];\n\nconst { id, timestamp } = props;\nconst proposal = Near.view(\n  REPL_INFRASTRUCTURE_COMMITTEE_CONTRACT,\n  \"get_proposal\",\n  {\n    proposal_id: parseInt(id),\n  }\n);\n\nconst [snapshotHistory, setSnapshotHistory] = useState([]);\n\nconst queryName = PROPOSAL_QUERY_NAME;\nconst query = `query GetLatestSnapshot($offset: Int = 0, $limit: Int = 10, $where: ${queryName}_bool_exp = {}) {\n  ${queryName}(\n    offset: $offset\n    limit: $limit\n    order_by: {ts: desc}\n    where: $where\n  ) {\n    editor_id\n    name\n    summary\n    description\n    ts\n    proposal_id\n    timeline\n    labels\n    linked_proposals\n    linked_rfp\n    requested_sponsorship_usd_amount\n    requested_sponsorship_paid_in_currency\n    receiver_account\n    requested_sponsor\n    supervisor\n  }\n}`;\n\nconst fetchSnapshotHistory = () => {\n  const variables = {\n    where: { proposal_id: { _eq: id } },\n  };\n  fetchGraphQL(query, \"GetLatestSnapshot\", variables).then(async (result) => {\n    if (result.status === 200) {\n      if (result.body.data) {\n        const data = result.body.data?.[queryName];\n        const history = data.map((item) => {\n          const proposalData = {\n            ...item,\n            timestamp: item.ts,\n            timeline: parseJSON(item.timeline),\n          };\n          delete proposalData.ts;\n          return proposalData;\n        });\n        setSnapshotHistory(history);\n      }\n    }\n  });\n};\n\nuseEffect(() => {\n  fetchSnapshotHistory();\n}, [id]);\n\nif (!proposal) {\n  return (\n    <div\n      style={{ height: \"50vh\" }}\n      className=\"d-flex justify-content-center align-items-center w-100\"\n    >\n      <Widget\n        src={`${REPL_DEVHUB}/widget/devhub.components.molecule.Spinner`}\n      />\n    </div>\n  );\n}\nif (timestamp && proposal) {\n  proposal.snapshot =\n    snapshotHistory.find((item) => item.timestamp === timestamp) ??\n    proposal.snapshot;\n}\n\nconst { snapshot } = proposal;\nsnapshot.timeline = parseJSON(snapshot.timeline);\n\nconst authorId = proposal.author_id;\nconst blockHeight = parseInt(proposal.social_db_post_block_height);\nconst item = {\n  type: \"social\",\n  path: `${REPL_INFRASTRUCTURE_COMMITTEE_CONTRACT}/post/main`,\n  blockHeight,\n};\nconst proposalURL = getLinkUsingCurrentGateway(\n  `${REPL_INFRASTRUCTURE_COMMITTEE}/widget/near-prpsls-bos.components.pages.app?page=proposal&id=${proposal.id}&timestamp=${snapshot.timestamp}`\n);\n\nconst SidePanelItem = ({ title, children, hideBorder, ishidden }) => {\n  return (\n    <div\n      style={{ gap: \"8px\" }}\n      className={\n        ishidden\n          ? \"d-none\"\n          : \"d-flex flex-column pb-3 \" + (!hideBorder && \" border-bottom\")\n      }\n    >\n      <div className=\"h6 mb-0\">{title} </div>\n      <div className=\"text-muted\">{children}</div>\n    </div>\n  );\n};\n\nconst rfpLabelOptions = getGlobalLabels();\n\nconst proposalStatusOptions = [\n  {\n    label: \"Draft\",\n    value: { status: PROPOSAL_TIMELINE_STATUS.DRAFT },\n  },\n  {\n    label: \"Review\",\n    value: {\n      status: PROPOSAL_TIMELINE_STATUS.REVIEW,\n      sponsor_requested_review: false,\n      reviewer_completed_attestation: false,\n    },\n  },\n  {\n    label: \"Approved\",\n    value: {\n      status: PROPOSAL_TIMELINE_STATUS.APPROVED,\n      sponsor_requested_review: true,\n      reviewer_completed_attestation: false,\n    },\n  },\n  {\n    label: \"Approved-Conditionally\",\n    value: {\n      status: PROPOSAL_TIMELINE_STATUS.APPROVED_CONDITIONALLY,\n      sponsor_requested_review: true,\n      reviewer_completed_attestation: false,\n    },\n  },\n  {\n    label: \"Rejected\",\n    value: {\n      status: PROPOSAL_TIMELINE_STATUS.REJECTED,\n      sponsor_requested_review: true,\n      reviewer_completed_attestation: false,\n    },\n  },\n  {\n    label: \"Canceled\",\n    value: {\n      status: PROPOSAL_TIMELINE_STATUS.CANCELED,\n      sponsor_requested_review: false,\n      reviewer_completed_attestation: false,\n    },\n  },\n  {\n    label: \"Payment-processing\",\n    value: {\n      status: PROPOSAL_TIMELINE_STATUS.PAYMENT_PROCESSING,\n      kyc_verified: false,\n      test_transaction_sent: false,\n      request_for_trustees_created: false,\n      sponsor_requested_review: true,\n      reviewer_completed_attestation: false,\n    },\n  },\n  {\n    label: \"Funded\",\n    value: {\n      status: PROPOSAL_TIMELINE_STATUS.FUNDED,\n      trustees_released_payment: true,\n      kyc_verified: true,\n      test_transaction_sent: true,\n      request_for_trustees_created: true,\n      sponsor_requested_review: true,\n      reviewer_completed_attestation: false,\n    },\n  },\n];\n\nconst CheckBox = ({ value, isChecked, label, disabled, onClick }) => {\n  return (\n    <div className=\"d-flex gap-2 align-items-center\">\n      <input\n        class=\"form-check-input\"\n        type=\"checkbox\"\n        value={value}\n        checked={isChecked}\n        disabled={!isModerator || !showTimelineSetting || disabled}\n        onChange={(e) => onClick(e.target.checked)}\n      />\n      <label style={{ width: \"90%\" }} class=\"form-check-label text-black\">\n        {label}\n      </label>\n    </div>\n  );\n};\n\nconst RadioButton = ({ value, isChecked, label }) => {\n  return (\n    <div className=\"d-flex gap-2 align-items-center\">\n      <input\n        class=\"form-check-input\"\n        type=\"radio\"\n        value={value}\n        checked={isChecked}\n        disabled={true}\n      />\n      <label class=\"form-check-label text-black\">{label}</label>\n    </div>\n  );\n};\n\nconst isAllowedToEditProposal = Near.view(\n  REPL_INFRASTRUCTURE_COMMITTEE_CONTRACT,\n  \"is_allowed_to_edit_proposal\",\n  {\n    proposal_id: proposal.id,\n    editor: accountId,\n  }\n);\n\nconst isModerator = Near.view(\n  REPL_INFRASTRUCTURE_COMMITTEE_CONTRACT,\n  \"is_allowed_to_write_rfps\",\n  {\n    editor: context.accountId,\n  }\n);\n\nconst editProposal = ({ timeline }) => {\n  const body = {\n    proposal_body_version: \"V1\",\n    name: snapshot.name,\n    description: snapshot.description,\n    category: snapshot.category,\n    summary: snapshot.summary,\n    linked_proposals: snapshot.linked_proposals,\n    requested_sponsorship_usd_amount: snapshot.requested_sponsorship_usd_amount,\n    requested_sponsorship_paid_in_currency:\n      snapshot.requested_sponsorship_paid_in_currency,\n    receiver_account: snapshot.receiver_account,\n    requested_sponsor: snapshot.requested_sponsor,\n    timeline: timeline,\n    linked_rfp: snapshot.linked_rfp,\n    supervisor: supervisor ?? snapshot.supervisor,\n  };\n  const args = {\n    labels: snapshot.linked_rfp ? [] : snapshot.labels,\n    body: body,\n    id: proposal.id,\n  };\n\n  Near.call([\n    {\n      contractName: REPL_INFRASTRUCTURE_COMMITTEE_CONTRACT,\n      methodName: \"edit_proposal\",\n      args: args,\n      gas: 270000000000000,\n    },\n  ]);\n};\n\nconst editProposalStatus = ({ timeline }) => {\n  Near.call([\n    {\n      contractName: REPL_INFRASTRUCTURE_COMMITTEE_CONTRACT,\n      methodName: \"edit_proposal_timeline\",\n      args: {\n        id: proposal.id,\n        timeline: timeline,\n      },\n      gas: 270000000000000,\n    },\n  ]);\n};\n\nconst [isReviewModalOpen, setReviewModal] = useState(false);\nconst [isCancelModalOpen, setCancelModal] = useState(false);\nconst [showTimelineSetting, setShowTimelineSetting] = useState(false);\nconst proposalStatus = useCallback(\n  () =>\n    proposalStatusOptions.find(\n      (i) => i.value.status === snapshot.timeline.status\n    ),\n  [snapshot]\n);\nconst [updatedProposalStatus, setUpdatedProposalStatus] = useState({});\n\nuseEffect(() => {\n  setUpdatedProposalStatus({\n    ...proposalStatus(),\n    value: { ...proposalStatus().value, ...snapshot.timeline },\n  });\n}, [proposal]);\n\nconst [paymentHashes, setPaymentHashes] = useState([\"\"]);\nconst [supervisor, setSupervisor] = useState(snapshot.supervisor);\n\nconst selectedStatusIndex = useMemo(\n  () =>\n    proposalStatusOptions.findIndex((i) => {\n      return updatedProposalStatus.value.status === i.value.status;\n    }),\n  [updatedProposalStatus]\n);\n\nconst TimelineItems = ({ title, children, value, values }) => {\n  const indexOfCurrentItem = proposalStatusOptions.findIndex((i) =>\n    Array.isArray(values)\n      ? values.includes(i.value.status)\n      : value === i.value.status\n  );\n  let color = \"transparent\";\n  let statusIndex = selectedStatusIndex;\n\n  // index 2,3,4,5  is of decision\n  if (selectedStatusIndex === 3 || selectedStatusIndex === 2) {\n    statusIndex = 2;\n  }\n  if (statusIndex === indexOfCurrentItem) {\n    color = \"#FEF6EE\";\n  }\n  if (\n    statusIndex > indexOfCurrentItem ||\n    updatedProposalStatus.value.status === PROPOSAL_TIMELINE_STATUS.FUNDED\n  ) {\n    color = \"#EEFEF0\";\n  }\n  // reject\n  if (statusIndex === 4 && indexOfCurrentItem === 2) {\n    color = \"#FF7F7F\";\n  }\n  // cancelled\n  if (statusIndex === 5 && indexOfCurrentItem === 2) {\n    color = \"#F4F4F4\";\n  }\n\n  return (\n    <div\n      className=\"p-2 rounded-3\"\n      style={{\n        backgroundColor: color,\n      }}\n    >\n      <div className=\"h6 text-black\"> {title}</div>\n      <div className=\"text-sm\">{children}</div>\n    </div>\n  );\n};\n\nconst link = href({\n  widgetSrc: `${REPL_INFRASTRUCTURE_COMMITTEE}/widget/near-prpsls-bos.components.pages.app`,\n  params: {\n    page: \"create-proposal\",\n    id: proposal.id,\n    timestamp: timestamp,\n  },\n});\n\nconst createdDate = snapshotHistory[0]?.timestamp ?? snapshot.timestamp;\n\nreturn (\n  <Container className=\"d-flex flex-column gap-2 w-100 mt-4\">\n    <Widget\n      src={`${REPL_DEVHUB}/widget/devhub.entity.proposal.ConfirmReviewModal`}\n      props={{\n        isOpen: isReviewModalOpen,\n        onCancelClick: () => setReviewModal(false),\n        onReviewClick: () => {\n          setReviewModal(false);\n          editProposalStatus({ timeline: proposalStatusOptions[1].value });\n        },\n      }}\n    />\n    <Widget\n      src={`${REPL_DEVHUB}/widget/devhub.entity.proposal.ConfirmCancelModal`}\n      props={{\n        isOpen: isCancelModalOpen,\n        onCancelClick: () => setCancelModal(false),\n        onConfirmClick: () => {\n          setCancelModal(false);\n          editProposalStatus({ timeline: proposalStatusOptions[5].value });\n        },\n      }}\n    />\n    <div className=\"d-flex px-3 px-lg-0 justify-content-between\">\n      <div className=\"d-flex gap-2 align-items-center h3\">\n        <div>{snapshot.name}</div>\n        <div className=\"text-muted\">#{proposal.id}</div>\n      </div>\n      <div className=\"d-flex gap-2 align-items-center\">\n        <Widget\n          src={`${REPL_NEAR}/widget/ShareButton`}\n          props={{\n            postType: \"post\",\n            url: proposalURL,\n          }}\n        />\n        {((isAllowedToEditProposal &&\n          snapshot.timeline.status === PROPOSAL_TIMELINE_STATUS.DRAFT) ||\n          isModerator) && (\n          <Link to={link} style={{ textDecoration: \"none\" }}>\n            <Widget\n              src={`${REPL_DEVHUB}/widget/devhub.components.molecule.Button`}\n              props={{\n                label: \"Edit\",\n                classNames: { root: \"grey-btn btn-sm\" },\n              }}\n            />\n          </Link>\n        )}\n      </div>\n    </div>\n    <div className=\"d-flex flex-wrap flex-md-nowrap px-3 px-lg-0 gap-2 align-items-center text-sm pb-3 w-100\">\n      <Widget\n        src={`${REPL_DEVHUB}/widget/devhub.entity.proposal.StatusTag`}\n        props={{\n          timelineStatus: snapshot.timeline.status,\n          size: \"sm\",\n        }}\n      />\n      <div className=\"w-100 d-flex flex-wrap flex-md-nowrap gap-1 align-items-center\">\n        <div className=\"fw-bold text-truncate\">\n          <LinkProfile account={authorId}>{authorId}</LinkProfile>\n        </div>\n        <div>created on {readableDate(createdDate / 1000000)}</div>\n      </div>\n    </div>\n    <div className=\"card no-border rounded-0 full-width-div px-3 px-lg-0\">\n      <div className=\"container-xl py-4\">\n        {snapshot.timeline.status === PROPOSAL_TIMELINE_STATUS.DRAFT &&\n          isAllowedToEditProposal && (\n            <div className=\"draft-info-container p-3 p-sm-4 d-flex flex-wrap flex-sm-nowrap justify-content-between align-items-center gap-2 rounded-2\">\n              <div style={{ minWidth: \"300px\" }}>\n                <b>\n                  This proposal is in draft mode and open for community\n                  comments.\n                </b>\n                <p className=\"text-sm text-muted mt-2\">\n                  The author can still refine the proposal and build consensus\n                  before sharing it with sponsors. Click \u201cReady for review\u201d when\n                  you want to start the official review process. This will lock\n                  the editing function, but comments are still open.\n                </p>\n              </div>\n              <div style={{ minWidth: \"fit-content\" }}>\n                <Widget\n                  src={`${REPL_DEVHUB}/widget/devhub.components.molecule.Button`}\n                  props={{\n                    label: \"Ready for review\",\n                    classNames: { root: \"grey-btn btn-sm\" },\n                    onClick: () => setReviewModal(true),\n                  }}\n                />\n              </div>\n            </div>\n          )}\n        {snapshot.timeline.status === PROPOSAL_TIMELINE_STATUS.REVIEW &&\n          isAllowedToEditProposal && (\n            <div className=\"review-info-container p-3 p-sm-4 d-flex flex-wrap flex-sm-nowrap justify-content-between align-items-center gap-2 rounded-2\">\n              <div style={{ minWidth: \"300px\" }}>\n                <b>\n                  This proposal is in review mode and still open for community\n                  comments.\n                </b>\n                <p className=\"text-sm text-muted mt-2\">\n                  You can\u2019t edit the proposal, but comments are open. Only\n                  moderators can make changes. Click \u201cCancel Proposal\u201d to cancel\n                  your proposal. This changes the status to Canceled, signaling\n                  to sponsors that it\u2019s no longer active or relevant.\n                </p>\n              </div>\n              <div style={{ minWidth: \"fit-content\" }}>\n                <Widget\n                  src={`${REPL_DEVHUB}/widget/devhub.components.molecule.Button`}\n                  props={{\n                    label: (\n                      <div className=\"d-flex align-items-center gap-1\">\n                        <i class=\"bi bi-trash3\"></i> Cancel Proposal\n                      </div>\n                    ),\n                    classNames: { root: \"btn-outline-danger btn-sm\" },\n                    onClick: () => setCancelModal(true),\n                  }}\n                />\n              </div>\n            </div>\n          )}\n        <div className=\"my-4\">\n          <div className=\"d-flex flex-wrap gap-6\">\n            <div\n              style={{ minWidth: \"350px\" }}\n              className=\"flex-3 order-2 order-md-1\"\n            >\n              <div\n                className=\"d-flex gap-2 flex-1\"\n                style={{\n                  zIndex: 99,\n                  background: \"white\",\n                  position: \"relative\",\n                }}\n              >\n                <div className=\"d-none d-sm-flex\">\n                  <Widget\n                    src={`${REPL_DEVHUB}/widget/devhub.entity.proposal.Profile`}\n                    props={{\n                      accountId: authorId,\n                    }}\n                  />\n                </div>\n                <ProposalContainer className=\"rounded-2 flex-1\">\n                  <Header className=\"d-flex gap-1 align-items-center p-2 px-3 \">\n                    <div\n                      className=\"fw-bold text-truncate\"\n                      style={{ maxWidth: \"60%\" }}\n                    >\n                      <LinkProfile account={authorId}>{authorId}</LinkProfile>\n                    </div>\n                    <div\n                      className=\"text-muted\"\n                      style={{ minWidth: \"fit-content\" }}\n                    >\n                      \uff65{\" \"}\n                      <Widget\n                        src={`${REPL_NEAR}/widget/TimeAgo`}\n                        props={{\n                          blockHeight,\n                          blockTimestamp: createdDate,\n                        }}\n                      />\n                      {context.accountId && (\n                        <div className=\"menu\">\n                          <Widget\n                            src={`${REPL_NEAR}/widget/Posts.Menu`}\n                            props={{\n                              accountId: authorId,\n                              blockHeight: blockHeight,\n                            }}\n                          />\n                        </div>\n                      )}\n                    </div>\n                  </Header>\n                  <div className=\"d-flex flex-column gap-1 p-2 px-3 description-box\">\n                    <div className=\"text-muted h6 border-bottom pb-1 mt-3\">\n                      PROPOSAL CATEGORY\n                    </div>\n                    <div>\n                      <Widget\n                        src={`${REPL_INFRASTRUCTURE_COMMITTEE}/widget/near-prpsls-bos.components.molecule.MultiSelectCategoryDropdown`}\n                        props={{\n                          selected: snapshot.labels,\n                          disabled: true,\n                          hideDropdown: true,\n                          onChange: () => {},\n                          availableOptions: rfpLabelOptions,\n                        }}\n                      />\n                    </div>\n                    <div className=\"text-muted h6 border-bottom pb-1 mt-3\">\n                      SUMMARY\n                    </div>\n                    <div>{snapshot.summary}</div>\n                    <div className=\"text-muted h6 border-bottom pb-1 mt-3 mb-4\">\n                      DESCRIPTION\n                    </div>\n                    <Widget\n                      src={`${REPL_DEVHUB}/widget/devhub.components.molecule.MarkdownViewer`}\n                      props={{ text: snapshot.description }}\n                    />\n\n                    <div className=\"d-flex gap-2 align-items-center mt-4\">\n                      <Widget\n                        src={`${REPL_INFRASTRUCTURE_COMMITTEE}/widget/near-prpsls-bos.components.molecule.LikeButton`}\n                        props={{\n                          item,\n                          proposalId: proposal.id,\n                          notifyAccountIds: [authorId],\n                        }}\n                      />\n                      <Widget\n                        src={`${REPL_DEVHUB}/widget/devhub.entity.proposal.CommentIcon`}\n                        props={{\n                          item,\n                          showOverlay: false,\n                          onClick: () => {},\n                        }}\n                      />\n                      <Widget\n                        src={`${REPL_NEAR}/widget/CopyUrlButton`}\n                        props={{\n                          url: proposalURL,\n                        }}\n                      />\n                    </div>\n                  </div>\n                </ProposalContainer>\n              </div>\n              <div className=\"border-bottom pb-4 mt-4\">\n                <Widget\n                  src={`${REPL_INFRASTRUCTURE_COMMITTEE}/widget/near-prpsls-bos.components.proposals.CommentsAndLogs`}\n                  props={{\n                    ...props,\n                    id: proposal.id,\n                    item: item,\n                    snapshotHistory: snapshotHistory,\n                    latestSnapshot: snapshot,\n                  }}\n                />\n              </div>\n              <div\n                style={{\n                  position: \"relative\",\n                  zIndex: 99,\n                  backgroundColor: \"white\",\n                }}\n                className=\"pt-4\"\n              >\n                <Widget\n                  src={`${REPL_INFRASTRUCTURE_COMMITTEE}/widget/near-prpsls-bos.components.molecule.ComposeComment`}\n                  props={{\n                    ...props,\n                    item: item,\n                    notifyAccountIds: [authorId],\n                    proposalId: proposal.id,\n                  }}\n                />\n              </div>\n            </div>\n            <div\n              style={{ minWidth: \"350px\" }}\n              className=\"d-flex flex-column gap-4 flex-1 order-1 order-md-2\"\n            >\n              <SidePanelItem title=\"Author\">\n                <Widget\n                  src={`${REPL_NEAR}/widget/AccountProfile`}\n                  props={{\n                    accountId: authorId,\n                    noOverlay: true,\n                  }}\n                />\n              </SidePanelItem>\n              <SidePanelItem\n                title={\"Linked RFP\"}\n                ishidden={!isNumber(snapshot.linked_rfp)}\n              >\n                <Widget\n                  src={`${REPL_INFRASTRUCTURE_COMMITTEE}/widget/near-prpsls-bos.components.molecule.LinkedRfps`}\n                  props={{\n                    linkedRfpIds: [snapshot.linked_rfp],\n                  }}\n                />\n              </SidePanelItem>\n              <SidePanelItem\n                title={\n                  \"Linked Proposals \" + `(${snapshot.linked_proposals.length})`\n                }\n                ishidden={!snapshot.linked_proposals.length}\n              >\n                <Widget\n                  src={`${REPL_INFRASTRUCTURE_COMMITTEE}/widget/near-prpsls-bos.components.molecule.LinkedProposals`}\n                  props={{\n                    linkedProposalIds: snapshot.linked_proposals,\n                  }}\n                />\n              </SidePanelItem>\n              <SidePanelItem title=\"Funding Ask\">\n                <div className=\"h4 text-black\">\n                  {snapshot.requested_sponsorship_usd_amount && (\n                    <div className=\"d-flex flex-column gap-1\">\n                      <div>\n                        {parseInt(\n                          snapshot.requested_sponsorship_usd_amount\n                        ).toLocaleString()}{\" \"}\n                        USD\n                      </div>\n                      <div className=\"text-sm text-muted\">\n                        Requested in{\" \"}\n                        {snapshot.requested_sponsorship_paid_in_currency}\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </SidePanelItem>\n              <SidePanelItem title=\"Recipient Wallet Address\">\n                <Widget\n                  src={`${REPL_NEAR}/widget/AccountProfile`}\n                  props={{\n                    accountId: snapshot.receiver_account,\n                    noOverlay: true,\n                  }}\n                />\n              </SidePanelItem>\n              <SidePanelItem title=\"Recipient Verification Status\">\n                <Widget\n                  src={`${REPL_DEVHUB}/widget/devhub.entity.proposal.VerificationStatus`}\n                  props={{\n                    receiverAccount: snapshot.receiver_account,\n                    showGetVerifiedBtn:\n                      accountId === snapshot.receiver_account ||\n                      accountId === authorId,\n                  }}\n                />\n              </SidePanelItem>\n              <SidePanelItem\n                title=\"Project Coordinator\"\n                ishidden={!snapshot.supervisor}\n              >\n                <Widget\n                  src={`${REPL_NEAR}/widget/AccountProfile`}\n                  props={{\n                    accountId: snapshot.supervisor,\n                    noOverlay: true,\n                  }}\n                />\n              </SidePanelItem>\n              <SidePanelItem\n                hideBorder={true}\n                title={\n                  <div>\n                    <div className=\"d-flex justify-content-between align-content-center\">\n                      Timeline\n                      {isModerator && (\n                        <div onClick={() => setShowTimelineSetting(true)}>\n                          <i class=\"bi bi-gear\"></i>\n                        </div>\n                      )}\n                    </div>\n                    {showTimelineSetting && (\n                      <div className=\"mt-2 d-flex flex-column gap-2\">\n                        <h6 className=\"mb-0\">Proposal Status</h6>\n                        <Widget\n                          src={`${REPL_DEVHUB}/widget/devhub.components.molecule.DropDown`}\n                          props={{\n                            options: proposalStatusOptions,\n                            selectedValue: updatedProposalStatus,\n                            onUpdate: (v) => {\n                              setUpdatedProposalStatus({\n                                ...v,\n                                value: {\n                                  ...v.value,\n                                  ...updatedProposalStatus.value,\n                                  status: v.value.status,\n                                },\n                              });\n                            },\n                          }}\n                        />\n                      </div>\n                    )}\n                  </div>\n                }\n              >\n                <div className=\"d-flex flex-column gap-2\">\n                  <div className=\"d-flex gap-3 mt-2\">\n                    <div className=\"d-flex flex-column\">\n                      {stepsArray.map((_, index) => {\n                        const indexOfCurrentItem = index;\n                        let color = \"\";\n                        let statusIndex = selectedStatusIndex;\n                        // index 2,3,4 is of decision\n                        if (\n                          selectedStatusIndex === 3 ||\n                          selectedStatusIndex === 2 ||\n                          selectedStatusIndex === 4 ||\n                          selectedStatusIndex === 5\n                        ) {\n                          statusIndex = 2;\n                        }\n                        if (selectedStatusIndex === 6) {\n                          statusIndex = 3;\n                        }\n                        const current = statusIndex === indexOfCurrentItem;\n                        const completed =\n                          statusIndex > indexOfCurrentItem ||\n                          updatedProposalStatus.value.status ===\n                            PROPOSAL_TIMELINE_STATUS.FUNDED;\n                        return (\n                          <div className=\"d-flex flex-column align-items-center gap-1\">\n                            <div\n                              className={\n                                \"circle \" +\n                                (completed && \" green-fill \") +\n                                (current && \" yellow-fill \")\n                              }\n                            >\n                              {completed && (\n                                <div\n                                  className=\"d-flex justify-content-center align-items-center\"\n                                  style={{ height: \"110%\" }}\n                                >\n                                  <i class=\"bi bi-check\"></i>\n                                </div>\n                              )}\n                            </div>\n\n                            {index !== stepsArray.length - 1 && (\n                              <div\n                                className={\n                                  \"vertical-line\" +\n                                  (index === stepsArray.length - 2\n                                    ? \"-sm \"\n                                    : \" \") +\n                                  (completed && \" green-fill \") +\n                                  (current && \" yellow-fill \")\n                                }\n                              ></div>\n                            )}\n                          </div>\n                        );\n                      })}\n                    </div>\n                    <div className=\"d-flex flex-column gap-3\">\n                      <TimelineItems\n                        title=\"1) Draft\"\n                        value={PROPOSAL_TIMELINE_STATUS.DRAFT}\n                      >\n                        <div>\n                          Once an author submits a proposal, it is in draft mode\n                          and open for community comments. The author can still\n                          make changes to the proposal during this stage and\n                          submit it for official review when ready.\n                        </div>\n                      </TimelineItems>\n                      <TimelineItems\n                        title=\"2) Review\"\n                        value={PROPOSAL_TIMELINE_STATUS.REVIEW}\n                      >\n                        <div className=\"d-flex flex-column gap-2\">\n                          Sponsors who agree to consider the proposal may\n                          request attestations from work groups.\n                          <CheckBox\n                            value=\"\"\n                            disabled={selectedStatusIndex !== 1}\n                            onClick={(value) =>\n                              setUpdatedProposalStatus((prevState) => ({\n                                ...prevState,\n                                value: {\n                                  ...prevState.value,\n                                  sponsor_requested_review: value,\n                                },\n                              }))\n                            }\n                            label=\"Sponsor provides feedback or requests reviews\"\n                            isChecked={\n                              updatedProposalStatus.value\n                                .sponsor_requested_review\n                            }\n                          />\n                          <CheckBox\n                            value=\"\"\n                            disabled={selectedStatusIndex !== 1}\n                            label=\"Reviewer completes attestations (Optional)\"\n                            onClick={(value) =>\n                              setUpdatedProposalStatus((prevState) => ({\n                                ...prevState,\n                                value: {\n                                  ...prevState.value,\n                                  reviewer_completed_attestation: value,\n                                },\n                              }))\n                            }\n                            isChecked={\n                              updatedProposalStatus.value\n                                .reviewer_completed_attestation\n                            }\n                          />\n                        </div>\n                      </TimelineItems>\n                      <TimelineItems\n                        title=\"3) Decision\"\n                        values={[\n                          PROPOSAL_TIMELINE_STATUS.APPROVED,\n                          PROPOSAL_TIMELINE_STATUS.APPROVED_CONDITIONALLY,\n                          PROPOSAL_TIMELINE_STATUS.REJECTED,\n                        ]}\n                      >\n                        <div className=\"d-flex flex-column gap-2\">\n                          <div>Sponsor makes a final decision:</div>\n                          <RadioButton\n                            value=\"\"\n                            label={<div className=\"fw-bold\">Approved</div>}\n                            isChecked={\n                              updatedProposalStatus.value.status ===\n                                PROPOSAL_TIMELINE_STATUS.APPROVED ||\n                              updatedProposalStatus.value.status ===\n                                PROPOSAL_TIMELINE_STATUS.PAYMENT_PROCESSING ||\n                              updatedProposalStatus.value.status ===\n                                PROPOSAL_TIMELINE_STATUS.FUNDED\n                            }\n                          />\n                          <RadioButton\n                            value=\"\"\n                            label={\n                              <>\n                                <div className=\"fw-bold\">\n                                  Approved - Conditional{\" \"}\n                                </div>\n                                <span>\n                                  Requires follow up from recipient. Moderators\n                                  will provide further details.\n                                </span>\n                              </>\n                            }\n                            isChecked={\n                              updatedProposalStatus.value.status ===\n                              PROPOSAL_TIMELINE_STATUS.APPROVED_CONDITIONALLY\n                            }\n                          />\n                          <RadioButton\n                            value=\"Reject\"\n                            label={<div className=\"fw-bold\">Rejected</div>}\n                            isChecked={\n                              updatedProposalStatus.value.status ===\n                              PROPOSAL_TIMELINE_STATUS.REJECTED\n                            }\n                          />\n                          <RadioButton\n                            value=\"Canceled\"\n                            label={<div className=\"fw-bold\">Canceled</div>}\n                            isChecked={\n                              updatedProposalStatus.value.status ===\n                              PROPOSAL_TIMELINE_STATUS.CANCELED\n                            }\n                          />\n                        </div>\n                      </TimelineItems>\n                      <TimelineItems\n                        title=\"4) Payment Processing\"\n                        value={PROPOSAL_TIMELINE_STATUS.PAYMENT_PROCESSING}\n                      >\n                        <div className=\"d-flex flex-column gap-2\">\n                          <CheckBox\n                            value={updatedProposalStatus.value.kyc_verified}\n                            label=\"Sponsor verifies KYC/KYB\"\n                            disabled={selectedStatusIndex !== 6}\n                            onClick={(value) =>\n                              setUpdatedProposalStatus((prevState) => ({\n                                ...prevState,\n                                value: {\n                                  ...prevState.value,\n                                  kyc_verified: value,\n                                },\n                              }))\n                            }\n                            isChecked={updatedProposalStatus.value.kyc_verified}\n                          />\n                          <CheckBox\n                            value={\n                              updatedProposalStatus.value.test_transaction_sent\n                            }\n                            disabled={selectedStatusIndex !== 6}\n                            label=\"Sponsor confirmed sponsorship and shared funding steps with recipient\"\n                            onClick={(value) =>\n                              setUpdatedProposalStatus((prevState) => ({\n                                ...prevState,\n                                value: {\n                                  ...prevState.value,\n                                  test_transaction_sent: value,\n                                },\n                              }))\n                            }\n                            isChecked={\n                              updatedProposalStatus.value.test_transaction_sent\n                            }\n                          />\n                        </div>\n                      </TimelineItems>\n                      <TimelineItems\n                        title=\"5) Funded\"\n                        value={PROPOSAL_TIMELINE_STATUS.FUNDED}\n                      >\n                        <div className=\"d-flex flex-column gap-2\">\n                          {paymentHashes?.length > 1 ? (\n                            paymentHashes.slice(0, -1).map((link, index) => (\n                              <a\n                                key={index}\n                                href={link}\n                                className=\"text-decoration-underline\"\n                                target=\"_blank\"\n                                rel=\"noopener noreferrer\"\n                              >\n                                Payment Link\n                                <i className=\"bi bi-arrow-up-right\"></i>\n                              </a>\n                            ))\n                          ) : updatedProposalStatus.value.payouts.length > 0 ? (\n                            <div>\n                              {updatedProposalStatus.value.payouts.map(\n                                (link) => {\n                                  return (\n                                    <a\n                                      href={link}\n                                      className=\"text-decoration-underline\"\n                                      target=\"_blank\"\n                                      rel=\"noopener noreferrer\"\n                                    >\n                                      Payment Link\n                                      <i class=\"bi bi-arrow-up-right\"></i>\n                                    </a>\n                                  );\n                                }\n                              )}\n                            </div>\n                          ) : (\n                            \"No Payouts yet\"\n                          )}\n                        </div>\n                      </TimelineItems>\n                    </div>\n                  </div>\n                  {showTimelineSetting && (\n                    <div className=\"d-flex flex-column gap-2\">\n                      <div className=\"border-vertical py-3 my-2\">\n                        <label className=\"text-black h6\">\n                          Project Coordinator\n                        </label>\n                        <Widget\n                          src={`${REPL_DEVHUB}/widget/devhub.entity.proposal.AccountInput`}\n                          props={{\n                            value: supervisor,\n                            placeholder: \"\",\n                            onUpdate: setSupervisor,\n                          }}\n                        />\n                      </div>\n                      {updatedProposalStatus.value.status ===\n                        PROPOSAL_TIMELINE_STATUS.FUNDED && (\n                        <div className=\"border-vertical py-3 my-2\">\n                          <label className=\"text-black h6\">Payment Link</label>\n                          <div className=\"d-flex flex-column gap-2\">\n                            {paymentHashes.map((item, index) => (\n                              <div className=\"d-flex gap-2 justify-content-between align-items-center\">\n                                <Widget\n                                  src={`${REPL_DEVHUB}/widget/devhub.components.molecule.Input`}\n                                  props={{\n                                    className: \"flex-grow-1\",\n                                    value: item,\n                                    onChange: (e) => {\n                                      const updatedHashes = [...paymentHashes];\n                                      updatedHashes[index] = e.target.value;\n                                      setPaymentHashes(updatedHashes);\n                                    },\n                                    skipPaddingGap: true,\n                                    placeholder: \"Enter URL\",\n                                  }}\n                                />\n                                <div style={{ minWidth: 20 }}>\n                                  {index !== paymentHashes.length - 1 ? (\n                                    <Widget\n                                      src={`${REPL_DEVHUB}/widget/devhub.components.molecule.Button`}\n                                      props={{\n                                        classNames: {\n                                          root: \"btn-outline-danger shadow-none w-100\",\n                                        },\n                                        label: <i class=\"bi bi-trash3 h6\"></i>,\n                                        onClick: () => {\n                                          const updatedHashes = [\n                                            ...paymentHashes,\n                                          ];\n                                          updatedHashes.splice(index, 1);\n                                          setPaymentHashes(updatedHashes);\n                                        },\n                                      }}\n                                    />\n                                  ) : (\n                                    <Widget\n                                      src={`${REPL_DEVHUB}/widget/devhub.components.molecule.Button`}\n                                      props={{\n                                        classNames: {\n                                          root: \"green-btn shadow-none border-0 w-100\",\n                                        },\n                                        disabled: !item,\n                                        label: <i class=\"bi bi-plus-lg\"></i>,\n                                        onClick: () =>\n                                          setPaymentHashes([\n                                            ...paymentHashes,\n                                            \"\",\n                                          ]),\n                                      }}\n                                    />\n                                  )}\n                                </div>\n                              </div>\n                            ))}\n                          </div>\n                        </div>\n                      )}\n                      <div className=\"d-flex gap-2 align-items-center justify-content-end text-sm\">\n                        <Widget\n                          src={`${REPL_DEVHUB}/widget/devhub.components.molecule.Button`}\n                          props={{\n                            label: \"Cancel\",\n                            classNames: {\n                              root: \"btn-outline-danger border-0 shadow-none btn-sm\",\n                            },\n                            onClick: () => {\n                              setShowTimelineSetting(false);\n                              setUpdatedProposalStatus(proposalStatus);\n                            },\n                          }}\n                        />\n                        <Widget\n                          src={`${REPL_DEVHUB}/widget/devhub.components.molecule.Button`}\n                          props={{\n                            label: \"Save\",\n                            disabled:\n                              !supervisor &&\n                              DecisionStage.includes(\n                                updatedProposalStatus.value.status\n                              ),\n                            classNames: { root: \"green-btn btn-sm\" },\n                            onClick: () => {\n                              if (snapshot.supervisor !== supervisor) {\n                                editProposal({\n                                  timeline: updatedProposalStatus.value,\n                                });\n                              } else if (\n                                updatedProposalStatus.value.status ===\n                                PROPOSAL_TIMELINE_STATUS.FUNDED\n                              ) {\n                                editProposalStatus({\n                                  timeline: {\n                                    ...updatedProposalStatus.value,\n                                    payouts: !paymentHashes[0]\n                                      ? []\n                                      : paymentHashes.filter(\n                                          (item) => item !== \"\"\n                                        ),\n                                  },\n                                });\n                              } else {\n                                editProposalStatus({\n                                  timeline: updatedProposalStatus.value,\n                                });\n                              }\n                              setShowTimelineSetting(false);\n                            },\n                          }}\n                        />\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </SidePanelItem>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/megha19.near/widget/near-prpsls-bos.components.proposals.Proposal", "fact_widget_deployments_id": "f4b826dab2a1f24a9bcfa276a56d9952", "inserted_timestamp": "2024-06-04T16:09:47.769Z", "modified_timestamp": "2024-06-04T16:09:47.769Z", "__row_index": 7}