{"tx_hash": "2NaUVcJqBTYjQevANfTomJQbzABgEckcpchhokPwWFE6", "action_id_social": "iMqeijDW84MHhFToi9ab7qnNjvsAKjrSYWx6iijZd4m-0-widget", "block_id": 114968700, "block_timestamp": "2024-03-18T17:40:44.198Z", "signer_id": "megha19.near", "widget_name": "devhub.entity.proposal.Menu", "source_code": "const { accountId, blockHeight, parentFunctions } = props;\nconst contentType = props.contentType || \"post\";\nconst contentPath = props.contentPath || \"/post/main\";\nconst capitalizedContentType =\n  contentType.charAt(0).toUpperCase() + contentType.slice(1);\n\nconst confirmationMessages = {\n  savingData: {\n    header: \"Saving Data\",\n    detail: \"Storing your action.\",\n  },\n  hideItem: {\n    header: capitalizedContentType + \" Hidden\",\n    detail: `This ${contentType} will no longer be shown to you.`,\n  },\n  hideAccount: {\n    header: \"Account Muted\",\n    detail: `All content from this account will be no longer be shown to you.`,\n  },\n  reportItem: {\n    header: capitalizedContentType + \" Reported for Moderation\",\n    detail:\n      \"The item will no longer be shown to you and will be reviewed. Thanks for helping our Content Moderators.\",\n  },\n  reportAccount: {\n    header: \"Account Reported for Moderation\",\n    detail:\n      \"All content from this account will no longer be shown to you and will be reviewed. Thanks for helping our Content Moderators.\",\n  },\n};\n\nconst moderate = (account, block, messageKey, action) => {\n  const modifiedContentPath = contentPath.replace(/\\//g, \".\");\n\n  const dataValue = block\n    ? {\n        [modifiedContentPath]: {\n          [block]: action,\n        },\n      }\n    : action;\n\n  const data = {\n    moderate: {\n      [account]: dataValue,\n    },\n  };\n\n  if (action !== \"hide\") {\n    const indexValue = block\n      ? {\n          path: `${account}${contentPath}`,\n          blockHeight: block,\n          label: action,\n        }\n      : {\n          path: account,\n          label: action,\n        };\n\n    data.index = {\n      moderation: JSON.stringify({\n        key: \"reported\",\n        value: indexValue,\n      }),\n    };\n  }\n\n  if (parentFunctions.optimisticallyHideItem) {\n    parentFunctions.optimisticallyHideItem(confirmationMessages[\"savingData\"]);\n  }\n  Social.set(data, {\n    onCommit: () => {\n      parentFunctions.resolveHideItem(confirmationMessages[messageKey]);\n    },\n    onCancel: () => {\n      parentFunctions.cancelHideItem();\n    },\n  });\n};\n\nconst buildMenu = (accountId, blockHeight) => {\n  const hideSubmenu = [\n    {\n      name: \"Mute \" + accountId,\n      iconLeft: \"ph-bold ph-ear-slash\",\n      onSelect: () => moderate(accountId, null, \"hideAccount\", \"hide\"),\n    },\n  ];\n\n  const reportSubmenu = [\n    {\n      name: \"Report \" + accountId,\n      iconLeft: \"ph-bold ph-warning-octagon\",\n      onSelect: () => showReportModal(\"Account\"),\n    },\n  ];\n\n  if (blockHeight) {\n    hideSubmenu.unshift({\n      name: \"Hide this \" + capitalizedContentType,\n      iconLeft: \"ph-bold ph-eye-slash\",\n      onSelect: () => moderate(accountId, blockHeight, \"hideItem\", \"hide\"),\n    });\n    reportSubmenu.unshift({\n      name: \"Report this \" + capitalizedContentType,\n      iconLeft: \"ph-bold ph-warning-octagon\",\n      onSelect: () => showReportModal(capitalizedContentType),\n    });\n  }\n  return [\n    {\n      name: \"Copy link\",\n      iconLeft: \"bi bi-link-45deg\",\n      onSelect: parentFunctions.copyLink,\n    },\n    {\n      name: \"Hide\",\n      iconLeft: \"ph-bold ph-eye-slash\",\n      disabled: !context.accountId || context.accountId === accountId,\n      subMenuProps: {\n        items: hideSubmenu,\n      },\n    },\n    {\n      name: (\n        <>\n          <i\n            className=\"ph-bold ph-warning-octagon\"\n            style={{ color: \"#D95C4A\" }}\n          />\n          <span style={{ color: \"#D95C4A\" }}>Report</span>\n        </>\n      ),\n      disabled: !context.accountId || context.accountId === accountId,\n      subMenuProps: {\n        items: reportSubmenu,\n      },\n    },\n    // {\n    //   name: \"Edit\",\n    //   iconLeft: \"ph-bold ph-pencil me-1\",\n    //   onSelect: parentFunctions.toggleEdit,\n    //  },\n  ];\n};\n\n// when set, value is the type of content to moderate (Account, Post or Comment)\nconst [showModal, setShowModal] = useState(null);\nconst showReportModal = (type) => {\n  setShowModal(type);\n};\nconst closeModal = () => {\n  setShowModal(false);\n};\nconst submitClick = (type, event, reason) => {\n  if (type === \"Account\") {\n    moderate(accountId, null, \"reportAccount\", reason);\n  } else {\n    moderate(accountId, blockHeight, \"reportItem\", reason);\n  }\n};\n\nreturn (\n  <>\n    <Widget\n      src=\"near/widget/DIG.DropdownMenu\"\n      props={{\n        trigger: <i className=\"ph-bold ph-dots-three\" />,\n        items: buildMenu(accountId, blockHeight),\n      }}\n    />\n    <Widget\n      src=\"near/widget/Moderation.ReasonDialog\"\n      props={{\n        closeModal,\n        open: showModal,\n        submitClick: submitClick.bind(null, showModal),\n        type: showModal,\n      }}\n    />\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/megha19.near/widget/devhub.entity.proposal.Menu", "fact_widget_deployments_id": "01551ed2dcf5eac1636c0076f5f6611e", "inserted_timestamp": "2024-03-18T19:26:38.597Z", "modified_timestamp": "2024-03-18T19:26:38.597Z", "__row_index": 0}