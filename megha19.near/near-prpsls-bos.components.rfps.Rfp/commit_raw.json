{"tx_hash": "FEovgwLZynHuBj8zjmhHA5UJSVXPrZeC9SnPoCmjpQhb", "action_id_social": "3kbX8fBHzoDmeXxvBpq8V59UKxCTtFjmkhbxTN2aGoBZ-0-widget", "block_id": 118356587, "block_timestamp": "2024-05-06T09:21:36.133Z", "signer_id": "megha19.near", "widget_name": "near-prpsls-bos.components.rfps.Rfp", "source_code": "/*\nLicense: MIT\nAuthor: devhub.near\nHomepage: https://github.com/NEAR-DevHub/near-prpsls-bos#readme\n*/\n/* INCLUDE: \"includes//common.jsx\" */\nconst REPL_DEVHUB = \"devhub.near\";\nconst REPL_INFRASTRUCTURE_COMMITTEE = \"infrastructure-committee.near\";\nconst REPL_INFRASTRUCTURE_COMMITTEE_CONTRACT = \"truedove38.near\";\nconst REPL_RPC_URL = \"https://rpc.mainnet.near.org\";\nconst REPL_NEAR = \"near\";\nconst RFPImage =\n  \"https://ipfs.near.social/ipfs/bafkreicbygt4kajytlxij24jj6tkg2ppc2dw3dlqhkermkjjfgdfnlizzy\";\n\nconst TIMELINE_STATUS = {\n  ACCEPTING_SUBMISSIONS: \"ACCEPTING_SUBMISSIONS\",\n  EVALUATION: \"EVALUATION\",\n  PROPOSAL_SELECTED: \"PROPOSAL_SELECTED\",\n  CANCELLED: \"CANCELLED\",\n};\n/* END_INCLUDE: \"includes//common.jsx\" */\n\nconst { href } = VM.require(`${REPL_DEVHUB}/widget/core.lib.url`) || {\n  href: () => {},\n};\nconst { readableDate } = VM.require(\n  `${REPL_DEVHUB}/widget/core.lib.common`\n) || { readableDate: () => {} };\n\nconst accountId = context.accountId;\n/*\n  ---props---\n  props.id: number;\n  props.timestamp: number; optional\n  accountId: string\n  blockHeight:number\n  */\n\nconst { id, timestamp } = props;\n\nconst Container = styled.div`\n  .full-width-div {\n    width: 100vw;\n    position: relative;\n    left: 50%;\n    right: 50%;\n    margin-left: -50vw;\n    margin-right: -50vw;\n  }\n\n  .fw-bold {\n    font-weight: 600 !important;\n  }\n\n  .card.no-border {\n    border-left: none !important;\n    border-right: none !important;\n    margin-bottom: -3.5rem;\n  }\n\n  .description-box {\n    font-size: 14px;\n  }\n\n  .accept-submission-info-container {\n    background-color: #ecf8fb;\n  }\n\n  .text-sm {\n    font-size: 13px !important;\n  }\n\n  .flex-1 {\n    flex: 1;\n  }\n\n  .flex-3 {\n    flex: 3;\n  }\n\n  .circle {\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    border: 1px solid grey;\n  }\n\n  .green-fill {\n    background-color: rgb(4, 164, 110) !important;\n    border-color: rgb(4, 164, 110) !important;\n    color: white !important;\n  }\n\n  .yellow-fill {\n    border-color: #ff7a00 !important;\n  }\n\n  .vertical-line {\n    width: 2px;\n    height: 180px;\n    background-color: lightgrey;\n  }\n\n  @media screen and (max-width: 970px) {\n    .vertical-line {\n      height: 135px !important;\n    }\n\n    .vertical-line-sm {\n      height: 70px !important;\n    }\n\n    .gap-6 {\n      gap: 0.5rem !important;\n    }\n  }\n\n  @media screen and (max-width: 570px) {\n    .vertical-line {\n      height: 180px !important;\n    }\n\n    .vertical-line-sm {\n      height: 75px !important;\n    }\n\n    .gap-6 {\n      gap: 0.5rem !important;\n    }\n  }\n\n  .vertical-line-sm {\n    width: 2px;\n    height: 70px;\n    background-color: lightgrey;\n  }\n\n  .form-check-input:disabled ~ .form-check-label,\n  .form-check-input[disabled] ~ .form-check-label {\n    opacity: 1;\n  }\n\n  .form-check-input {\n    border-color: black !important;\n  }\n\n  .grey-btn {\n    background-color: #687076;\n    border: none;\n    color: white;\n  }\n\n  .blue-btn {\n    background-color: #3c697d;\n    border: none;\n    color: white;\n  }\n\n  .form-check-input:checked {\n    background-color: #3c697d !important;\n    border-color: #3c697d !important;\n  }\n\n  .dropdown-toggle:after {\n    position: absolute;\n    top: 46%;\n    right: 5%;\n  }\n\n  .drop-btn {\n    max-width: none !important;\n  }\n\n  .dropdown-menu {\n    width: 100%;\n    border-radius: 0.375rem !important;\n  }\n\n  .green-btn {\n    background-color: #04a46e !important;\n    border: none;\n    color: white;\n\n    &:active {\n      color: white;\n    }\n  }\n\n  .gap-6 {\n    gap: 2.5rem;\n  }\n\n  .border-vertical {\n    border-top: var(--bs-border-width) var(--bs-border-style)\n      var(--bs-border-color) !important;\n    border-bottom: var(--bs-border-width) var(--bs-border-style)\n      var(--bs-border-color) !important;\n  }\n\n  button.px-0 {\n    padding-inline: 0px !important;\n  }\n\n  red-icon i {\n    color: red;\n  }\n\n  input[type=\"radio\"] {\n    min-width: 13px;\n  }\n`;\n\nconst RfpContainer = styled.div`\n  border: 1px solid lightgrey;\n  overflow: auto;\n`;\n\nconst Header = styled.div`\n  position: relative;\n  background-color: #f4f4f4;\n  height: 50px;\n\n  .menu {\n    position: absolute;\n    right: 10px;\n    top: 4px;\n    font-size: 30px;\n  }\n`;\n\nconst Text = styled.p`\n  display: block;\n  margin: 0;\n  font-size: 14px;\n  line-height: 20px;\n  font-weight: 400;\n  color: #687076;\n  white-space: nowrap;\n`;\n\nconst Actions = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  margin: -6px -6px 6px;\n`;\n\nconst Avatar = styled.div`\n  width: 40px;\n  height: 40px;\n  pointer-events: none;\n\n  img {\n    object-fit: cover;\n    border-radius: 40px;\n    width: 100%;\n    height: 100%;\n  }\n`;\n\nconst rfpLabelOptions = Near.view(\n  REPL_INFRASTRUCTURE_COMMITTEE_CONTRACT,\n  \"get_global_labels\"\n);\n\nconst LinkProfile = ({ account, children }) => {\n  return (\n    <Link href={`/near/widget/ProfilePage?accountId=${account}`}>\n      {children}\n    </Link>\n  );\n};\n\nconst rfp = Near.view(REPL_INFRASTRUCTURE_COMMITTEE_CONTRACT, \"get_rfp\", {\n  rfp_id: parseInt(id),\n});\n\nif (!rfp) {\n  return (\n    <div\n      style={{ height: \"50vh\" }}\n      className=\"d-flex justify-content-center align-items-center w-100\"\n    >\n      <Widget\n        src={`${REPL_DEVHUB}/widget/devhub.components.molecule.Spinner`}\n      />\n    </div>\n  );\n}\nif (timestamp && rfp) {\n  rfp.snapshot =\n    rfp.snapshot_history.find((item) => item.timestamp === timestamp) ??\n    rfp.snapshot;\n}\n\nconst { snapshot } = rfp;\n\nconst authorId = rfp.author_id;\nconst blockHeight = parseInt(rfp.social_db_post_block_height);\nconst item = {\n  type: \"social\",\n  path: `${REPL_INFRASTRUCTURE_COMMITTEE_CONTRACT}/post/main`,\n  blockHeight,\n};\nconst rfpURL = `https://near.org/${REPL_INFRASTRUCTURE_COMMITTEE}/widget/near-prpsls-bos.components.pages.app?page=rfp&id=${rfp.id}&timestamp=${snapshot.timestamp}`;\n\nconst SidePanelItem = ({ title, children, hideBorder, ishidden }) => {\n  return (\n    <div\n      style={{ gap: \"8px\" }}\n      className={\n        ishidden\n          ? \"d-none\"\n          : \"d-flex flex-column pb-3 \" + (!hideBorder && \" border-bottom\")\n      }\n    >\n      <div className=\"h6 mb-0\">{title} </div>\n      <div className=\"text-muted\">{children}</div>\n    </div>\n  );\n};\n\nconst isAllowedToWriteRfp = Near.view(\n  REPL_INFRASTRUCTURE_COMMITTEE_CONTRACT,\n  \"is_allowed_to_write_rfps\",\n  {\n    editor: accountId,\n  }\n);\n\nconst link = href({\n  widgetSrc: `${REPL_INFRASTRUCTURE_COMMITTEE}/widget/near-prpsls-bos.components.pages.app`,\n  params: {\n    page: \"create-rfp\",\n    id: rfp.id,\n    timestamp: timestamp,\n  },\n});\n\nconst createdDate =\n  rfp.snapshot_history?.[rfp.snapshot_history.length - 1]?.timestamp ??\n  snapshot.timestamp;\n\nreturn (\n  <Container className=\"d-flex flex-column gap-2 w-100 mt-4\">\n    <div className=\"d-flex px-3 px-lg-0 justify-content-between\">\n      <div className=\"d-flex gap-2 align-items-center h3\">\n        <div>{snapshot.name}</div>\n        <div className=\"text-muted\">#{rfp.id}</div>\n      </div>\n      <div className=\"d-flex gap-2 align-items-center\">\n        <Widget\n          src={`${REPL_NEAR}/widget/ShareButton`}\n          props={{\n            postType: \"post\",\n            url: rfpURL,\n          }}\n        />\n        {isAllowedToWriteRfp && (\n          <Link to={link} style={{ textDecoration: \"none\" }}>\n            <Widget\n              src={`${REPL_DEVHUB}/widget/devhub.components.molecule.Button`}\n              props={{\n                label: \"Edit\",\n                classNames: { root: \"grey-btn btn-sm\" },\n              }}\n            />\n          </Link>\n        )}\n      </div>\n    </div>\n    <div className=\"d-flex flex-wrap flex-md-nowrap px-3 px-lg-0 gap-2 align-items-center text-sm pb-3 w-100\">\n      {/* TODO */}\n      <Widget\n        src={`${REPL_INFRASTRUCTURE_COMMITTEE}/widget/near-prpsls-bos.components.rfps.StatusTag`}\n        props={{\n          timelineStatus: snapshot.timeline.status,\n          size: \"sm\",\n        }}\n      />\n      <div className=\"w-100 d-flex flex-wrap flex-md-nowrap gap-1 align-items-center\">\n        <div className=\"fw-bold text-truncate\">\n          <LinkProfile account={authorId}>{authorId}</LinkProfile>\n        </div>\n        <div>created on {readableDate(createdDate / 1000000)}</div>\n      </div>\n    </div>\n    <div className=\"card no-border rounded-0 full-width-div px-3 px-lg-0\">\n      <div className=\"container-xl py-4\">\n        {snapshot.timeline.status === TIMELINE_STATUS.ACCEPTING_SUBMISSIONS && (\n          <div className=\"accept-submission-info-container p-3 p-sm-4 d-flex flex-wrap flex-sm-nowrap justify-content-between align-items-center gap-2 rounded-2\">\n            <div style={{ minWidth: \"300px\" }}>\n              <b>This RFP is accepting submissions.</b>\n              <p className=\"text-sm text-muted mt-2\">\n                Click Submit Proposal if you want to submit a proposal.\n              </p>\n            </div>\n            <div style={{ minWidth: \"fit-content\" }}>\n              <Widget\n                src={`${REPL_DEVHUB}/widget/devhub.components.molecule.Button`}\n                props={{\n                  label: (\n                    <div className=\"d-flex align-items-center gap-2\">\n                      <i class=\"bi bi-plus-circle\"></i>Submit Proposal\n                    </div>\n                  ),\n                  classNames: { root: \"blue-btn\" },\n                  onClick: () => setReviewModal(true),\n                }}\n              />\n            </div>\n          </div>\n        )}\n        <div className=\"my-4\">\n          <div className=\"d-flex flex-wrap gap-6\">\n            <div\n              style={{ minWidth: \"350px\" }}\n              className=\"flex-3 order-2 order-md-1\"\n            >\n              <div\n                className=\"d-flex gap-2 flex-1\"\n                style={{\n                  zIndex: 99,\n                  background: \"white\",\n                  position: \"relative\",\n                }}\n              >\n                <div className=\"d-none d-sm-flex\">\n                  <img src={RFPImage} height={35} width={35} />\n                </div>\n                <RfpContainer className=\"rounded-2 flex-1\">\n                  <Header className=\"d-flex gap-1 align-items-center p-2 px-3 \">\n                    <div\n                      className=\"fw-bold text-truncate\"\n                      style={{ maxWidth: \"60%\" }}\n                    >\n                      <LinkProfile account={authorId}>{authorId}</LinkProfile>\n                    </div>\n                    <div\n                      className=\"text-muted\"\n                      style={{ minWidth: \"fit-content\" }}\n                    >\n                      \uff65{\" \"}\n                      <Widget\n                        src={`${REPL_NEAR}/widget/TimeAgo`}\n                        props={{\n                          blockHeight,\n                          blockTimestamp: createdDate,\n                        }}\n                      />\n                      {context.accountId && (\n                        <div className=\"menu\">\n                          <Widget\n                            src={`${REPL_NEAR}/widget/Posts.Menu`}\n                            props={{\n                              accountId: authorId,\n                              blockHeight: blockHeight,\n                            }}\n                          />\n                        </div>\n                      )}\n                    </div>\n                  </Header>\n                  <div className=\"d-flex flex-column gap-1 p-2 px-3 description-box\">\n                    <div className=\"text-muted h6 border-bottom pb-1 mt-3\">\n                      RFP CATEGORY\n                      <div className=\"my-2\">\n                        <Widget\n                          src={`${REPL_INFRASTRUCTURE_COMMITTEE}/widget/near-prpsls-bos.components.molecule.MultiSelectCategoryDropdown`}\n                          props={{\n                            selected: snapshot.labels,\n                            disabled: true,\n                            hideDropdown: true,\n                            onChange: () => {},\n                            availableOptions: rfpLabelOptions,\n                          }}\n                        />\n                      </div>\n                    </div>\n                    <div className=\"text-muted h6 border-bottom pb-1 mt-3\">\n                      SUMMARY\n                    </div>\n                    <div>{snapshot.summary}</div>\n                    <div className=\"text-muted h6 border-bottom pb-1 mt-3 mb-4\">\n                      DESCRIPTION\n                    </div>\n                    <Widget\n                      src={`${REPL_DEVHUB}/widget/devhub.components.molecule.MarkdownViewer`}\n                      props={{ text: snapshot.description }}\n                    />\n                    {/* TODO */}\n                    <div className=\"d-flex gap-2 align-items-center mt-4\">\n                      <Widget\n                        src={`${REPL_DEVHUB}/widget/devhub.entity.proposal.LikeButton`}\n                        props={{\n                          item,\n                          proposalId: rfp.id,\n                          notifyAccountId: authorId,\n                        }}\n                      />\n                      <Widget\n                        src={`${REPL_DEVHUB}/widget/devhub.entity.proposal.CommentIcon`}\n                        props={{\n                          item,\n                          showOverlay: false,\n                          onClick: () => {},\n                        }}\n                      />\n                      <Widget\n                        src={`${REPL_NEAR}/widget/CopyUrlButton`}\n                        props={{\n                          url: rfpURL,\n                        }}\n                      />\n                    </div>\n                  </div>\n                </RfpContainer>\n              </div>\n              <div className=\"border-bottom pb-4 mt-4\">\n                <Widget\n                  src={`${REPL_INFRASTRUCTURE_COMMITTEE}/widget/near-prpsls-bos.components.rfps.CommentsAndLogs`}\n                  props={{\n                    ...props,\n                    id: rfp.id,\n                    item: item,\n                    snapshotHistory: [...rfp.snapshot_history, snapshot],\n                  }}\n                />\n              </div>\n              <div\n                style={{\n                  position: \"relative\",\n                  zIndex: 99,\n                  backgroundColor: \"white\",\n                }}\n                className=\"pt-4\"\n              >\n                <Widget\n                  src={`${REPL_DEVHUB}/widget/devhub.entity.proposal.ComposeComment`}\n                  props={{\n                    ...props,\n                    item: item,\n                    notifyAccountId: authorId,\n                    id: rfp.id,\n                  }}\n                />\n              </div>\n            </div>\n            <div\n              style={{ minWidth: \"300px\" }}\n              className=\"d-flex flex-column gap-4 flex-1 order-1 order-md-2\"\n            >\n              <SidePanelItem title=\"Submission Deadline\">\n                <h5 className=\"text-black\">\n                  {readableDate(\n                    parseFloat(snapshot.submission_deadline / 1000000)\n                  )}\n                </h5>\n              </SidePanelItem>\n              <SidePanelItem title=\"Timeline\">\n                <Widget\n                  src={`${REPL_INFRASTRUCTURE_COMMITTEE}/widget/near-prpsls-bos.components.rfps.TimelineConfigurator`}\n                  props={{\n                    timeline: snapshot.timeline,\n                    disabled: true,\n                  }}\n                />\n              </SidePanelItem>\n              <SidePanelItem\n                title=\"Selected Proposal\"\n                ishidden={true}\n              ></SidePanelItem>\n              <SidePanelItem title=\"All Proposals\"></SidePanelItem>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/megha19.near/widget/near-prpsls-bos.components.rfps.Rfp", "fact_widget_deployments_id": "4a05fdb8ca95a18ff0158247cc11a334", "inserted_timestamp": "2024-05-06T10:40:50.150Z", "modified_timestamp": "2024-05-06T10:40:50.150Z", "__row_index": 1}