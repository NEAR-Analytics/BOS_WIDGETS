{"tx_hash": "4QWMmx64XRQt9wyWf1wax6Si7oYvd3EX8nHTEjGfpqak", "action_id_social": "FuCcHUF8qsfYtwZCGpbwZExaLVeyN5gfyH5uPN56pjJG-0-widget", "block_id": 111351654, "block_timestamp": "2024-01-26T10:04:45.933Z", "signer_id": "megha19.near", "widget_name": "DAOs.Card", "source_code": "const { router } = props;\nconst daoId = props.daoId;\nconst balance = props.balance;\n\nif (!daoId) {\n  return \"DAO ID not provided\";\n}\n// -- Pikespeak API\nconst baseApi = \"https://api.pikespeak.ai\";\nconst publicApiKey = \"36f2b87a-7ee6-40d8-80b9-5e68e587a5b5\";\n\nconst fetchApiConfig = {\n  mode: \"cors\",\n  headers: {\n    \"x-api-key\": publicApiKey,\n  },\n};\n\nconst constructURL = (baseURL, paramObj) => {\n  let params = \"\";\n  for (const [key, value] of Object.entries(paramObj ?? {})) {\n    params += `${key}=${value}&`;\n  }\n  params = params.slice(0, -1);\n  return `${baseURL}?${params}`;\n};\n\nconst fether = {\n  balances: (accounts) => {\n    return fetch(\n      constructURL(`${baseApi}/account/balances`, { accounts }),\n      fetchApiConfig,\n    );\n  },\n  proposalsStatus: (daoId) => {\n    return fetch(\n      constructURL(`${baseApi}/daos/proposals/status/${daoId}`),\n      fetchApiConfig,\n    );\n  },\n};\nconst balances = fether.balances([daoId]);\nconst proposalsStatus = fether.proposalsStatus(daoId);\nlet activeProposalsCount;\nlet totalProposalsCount;\n\nproposalsStatus &&\n  proposalsStatus.body?.forEach((p) => {\n    activeProposalsCount += p[\"InProgress\"] ? parseInt(p[\"InProgress\"]) : 0;\n    totalProposalsCount += p[\"Total\"] ? parseInt(p[\"Total\"]) : 0;\n  });\n// --\n\n// -- Social DB\nconst profile = Social.get(`${daoId}/profile/**`, \"final\");\n// --\n\n// -- Smart Contract\nconst policy = Near.view(daoId, \"get_policy\");\nlet members = [];\npolicy &&\n  policy.roles.forEach((role) => {\n    if (typeof role.kind.Group === \"object\") {\n      members = members.concat(role.kind.Group);\n    }\n  });\nmembers = [...new Set(members)];\n// --\n\nconst shorten = (str, len) => {\n  if (str.length <= len) {\n    return str;\n  }\n  return str.slice(0, len) + \"...\";\n};\n\nconst shortenNumber = (n) => {\n  if (n < 1e3) return n;\n  if (n >= 1e3 && n < 1e6) return (n / 1e3).toFixed(1) + \"k\";\n  if (n >= 1e6 && n < 1e9) return (n / 1e6).toFixed(1) + \"m\";\n  if (n >= 1e9 && n < 1e12) return (n / 1e9).toFixed(1) + \"b\";\n  if (n >= 1e12) return (n / 1e12).toFixed(1) + \"t\";\n};\n\nconst daoLink = ({ daoId, tab }) => {\n  return `#/megha19.near/widget/home?page=dao&daoId=${daoId}${\n    tab && `&tab=${tab}`\n  }`;\n};\n\nconst Wrapper = styled.div`\n  border: 1px solid transparent;\n\n  &:hover {\n    border: 1px solid #4498e0;\n  }\n\n  .dao-card-stats {\n    grid-template-columns: repeat(3, 1fr);\n    grid-template-rows: repeat(2, 1fr);\n    column-gap: 0.5rem;\n    row-gap: 0.2rem;\n\n    & > p:nth-child(1),\n    & > p:nth-child(2),\n    & > p:nth-child(3) {\n      font-size: 0.8rem;\n      color: #4498e0;\n      margin: 0;\n    }\n\n    & > p:nth-child(4),\n    & > p:nth-child(5),\n    & > p:nth-child(6) {\n      font-size: 0.8rem;\n      font-weight: 600;\n      margin: 0;\n    }\n\n    p > b {\n      font-size: 1.15rem;\n      font-weight: 700;\n    }\n  }\n\n  a {\n    color: #4498e0;\n    font-size: 0.8rem;\n    font-weight: 600;\n    text-decoration: none;\n\n    &:hover {\n      color: #4498e0cc;\n  }\n`;\n\nreturn (\n  <Wrapper className=\"ndc-card p-4 d-flex flex-column gap-2 h-100\">\n    <Widget\n      src=\"nearui.near/widget/Element.User\"\n      props={{\n        accountId: daoId,\n        href: daoLink({ daoId }),\n        onClick: () => {\n          router.navigate({\n            page: \"dao\",\n            daoId,\n          });\n        },\n      }}\n    />\n    <p className=\"text-muted overflow-hidden small my-3 mx-1\">\n      {shorten(profile?.description || \"\", 80)}\n      {profile !== null &&\n        (!profile?.description || profile?.description?.length < 1) &&\n        \"No description\"}\n    </p>\n    <div className=\"d-grid justify-content-between text-center dao-card-stats mb-3 mt-auto\">\n      <p>DAO Funds</p>\n      <p>Members/Groups</p>\n      <p>Active proposals</p>\n      <p>\n        {balances && (\n          <>\n            <b className=\"me-1\">{shortenNumber(balances.body.totalUsd)}</b>USD\n          </>\n        )}\n      </p>\n      <p>\n        <b>{members.length}</b>/{policy.roles.length - 1}\n      </p>\n      <p>\n        <b>{activeProposalsCount}</b>/{totalProposalsCount}\n      </p>\n    </div>\n    <div className=\"d-flex gap-2 justify-content-around gap-3 mb-3\">\n      <a\n        href={daoLink({ daoId, tab: \"settings\" })}\n        onClick={() => {\n          router.navigate({\n            page: \"dao\",\n            daoId,\n            tab: \"settings\",\n          });\n        }}\n      >\n        <i className=\"bi me-1 bi-gear\" />\n        Settings\n      </a>\n      <a\n        href={daoLink({ daoId, tab: \"nfts\" })}\n        onClick={() => {\n          router.navigate({\n            page: \"dao\",\n            daoId,\n            tab: \"nfts\",\n          });\n        }}\n      >\n        <i className=\"bi me-1 bi-image\" />\n        NFTs\n      </a>\n      <a\n        href={daoLink({ daoId, tab: \"bounties\" })}\n        onClick={() => {\n          router.navigate({\n            page: \"dao\",\n            daoId,\n            tab: \"bounties\",\n          });\n        }}\n      >\n        <i className=\"bi me-1 bi-briefcase\" />\n        Bounties\n      </a>\n      <a\n        href={daoLink({ daoId, tab: \"proposals\" })}\n        onClick={() => {\n          router.navigate({\n            page: \"dao\",\n            daoId,\n            tab: \"proposals\",\n          });\n        }}\n      >\n        <i className=\"bi me-1 bi-question-circle\" />\n        Polls\n      </a>\n    </div>\n    <div className=\"d-flex gap-2 justify-content-between\">\n      <Widget\n        src=\"nearui.near/widget/Social.FollowButton\"\n        props={{\n          variant: \"info flex-1 w-100\",\n          size: \"lg\",\n          accountId: daoId,\n        }}\n      />\n      <Widget\n        src=\"nearui.near/widget/Input.Button\"\n        props={{\n          variant: \"info outline flex-1 w-100\",\n          size: \"lg\",\n          buttonProps: {\n            style: {\n              fontWeight: 500,\n            },\n          },\n          children: <>View Profile</>,\n          href: daoLink({ daoId }),\n          onClick: () => {\n            router.navigate({\n              page: \"dao\",\n              daoId,\n            });\n          },\n        }}\n      />\n    </div>\n  </Wrapper>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/megha19.near/widget/DAOs.Card", "fact_widget_deployments_id": "82d0d86a96053d4545ba6a232b5694d6", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}