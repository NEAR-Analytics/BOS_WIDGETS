{"tx_hash": "J5Nmahopjnayq7c8Dz8nwYxN5TxqTYDXP5t6t6divseY", "action_id_social": "E7ZVFW5zTYhmrKtX2o8z22eTYePKBQHdoSeGTWC9v5mk-0-widget", "block_id": 111218014, "block_timestamp": "2024-01-24T17:35:13.128Z", "signer_id": "megha19.near", "widget_name": "checkIsMemberOrPending", "source_code": "// checks if the user is already dao's community/council member or has an active proposal\nconst checkIsMemberOrPending = (accountId) => {\n  const daoId = \"build.sputnik-dao.near\";\n  if (!accountId) {\n    return false;\n  }\n  const alreadyJoinedRolesNames = [\"community\", \"council\"];\n  const searchRange = 100;\n\n  const lastProposalId = Near.view(daoId, \"get_last_proposal_id\");\n\n  const policy = Near.view(daoId, \"get_policy\");\n  const isDaoMember = false;\n  const lastProposals =\n    Near.view(daoId, \"get_proposals\", {\n      from_index: lastProposalId - searchRange,\n      limit: searchRange,\n    }) || [];\n  console.log(policy, lastProposalId, lastProposals);\n  const alreadyMadeAProposal =\n    lastProposals.filter((proposal) => {\n      return (\n        proposal.proposer === accountId && proposal.status === \"InProgress\"\n      );\n    }).length > 0;\n\n  policy.roles\n    .filter((role) => alreadyJoinedRolesNames.includes(role.name))\n    .map((role) => {\n      if (Array.isArray(role.kind.Group) && !isDaoMember) {\n        isDaoMember = role.kind.Group.includes(accountId);\n      }\n    });\n  return isDaoMember || alreadyMadeAProposal;\n};\n\nreturn { checkIsMemberOrPending };\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/megha19.near/widget/checkIsMemberOrPending", "fact_widget_deployments_id": "8798a707d53543b84c7254dcf6e7c59b", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 3}