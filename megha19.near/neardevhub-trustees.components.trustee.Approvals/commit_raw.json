{"tx_hash": "F1hbjPPowarKuXWb7o1fKdk9RqEf6CfABNdGriRZRBTg", "action_id_social": "3TfiAaHtv9pNk1G2oyhD2sxk8rjz94jNJ24wtYQ46NF3-0-widget", "block_id": 113234744, "block_timestamp": "2024-02-20T17:59:13.932Z", "signer_id": "megha19.near", "widget_name": "neardevhub-trustees.components.trustee.Approvals", "source_code": "/*\nLicense: MIT\nAuthor: devhub.near\nHomepage: https://github.com/NEAR-DevHub/neardevhub-treasury-dashboard.git#readme\n*/\n/* INCLUDE: \"includes//common.jsx\" */\nconst REPL_TREASURY_CONTRACT = \"treasurydevhub.near\";\nconst REPL_TREASURY = \"megha19.near\";\n// \"dashboard.treasury-devdao.near\";\nconst REPL_DEVHUB = \"devhub.near\";\n// devhub.near;\nconst REPL_PROPOSAL_CONTRACT =\n  \"713ed9aef61d14ce3dfeb3f5a55dfdf16c407280267e8de96bce0953d0e1af8c\";\nconst REPL_NEAR = \"near\";\n/* END_INCLUDE: \"includes//common.jsx\" */\n\nconst treasuryDaoID = REPL_TREASURY_CONTRACT;\nconst resPerPage = 50;\nconst [currentPage, setPage] = useState(0);\nconst [expandSummaryIndex, setExpandSummary] = useState({});\nconst proposals = Near.view(treasuryDaoID, \"get_proposals\", {\n  from_index: currentPage === 0 ? currentPage : (currentPage - 1) * resPerPage,\n  limit: resPerPage,\n});\n\nconst lastProposalID = Near.view(treasuryDaoID, \"get_last_proposal_id\", {});\nif (proposals === null || lastProposalID === null) {\n  return <></>;\n}\n\nconst onPay = (id) => {\n  Near.call({\n    contractName: treasuryDaoID,\n    methodName: \"act_proposal\",\n    args: {\n      id: id,\n      action: \"VoteApprove\",\n    },\n    gas: Big(10).pow(14),\n  });\n};\n\nconst Container = styled.div`\n  font-size: 13px;\n\n  .text-grey {\n    color: #b9b9b9 !important;\n  }\n\n  .card-custom {\n    border-radius: 5px;\n    background-color: white;\n  }\n\n  .text-size-2 {\n    font-size: 15px;\n  }\n\n  .text-dark-grey {\n    color: #687076;\n  }\n\n  .text-grey-100 {\n    background-color: #f5f5f5;\n  }\n\n  td {\n    padding: 0.5rem;\n    color: inherit;\n  }\n\n  .overflow {\n    overflow: auto;\n  }\n\n  .max-w-100 {\n    max-width: 100%;\n  }\n\n  button {\n    background-color: #04a46e;\n    color: white;\n    border: none;\n    font-weight: 600;\n    font-size: 14px;\n  }\n`;\n\n// filter transfer proposals\nconst transferProposals = proposals.filter((item) => {\n  if (item.kind) {\n    return (\n      typeof item.kind === \"object\" &&\n      Object.keys(item.kind)?.[0] === \"Transfer\" &&\n      item.status === \"InProgress\"\n    );\n  }\n  return false;\n});\n\nconst ProposalsComponent = () => {\n  return (\n    <tbody>\n      {transferProposals?.map((item, index) => {\n        const description = JSON.parse(item.description);\n        const proposal = Near.view(REPL_PROPOSAL_CONTRACT, \"get_proposal\", {\n          proposal_id: description.proposal_id,\n        });\n        const args = item.kind.Transfer;\n        const isReceiverkycbVerified = true;\n        const isNEAR = true;\n        const address = item.token;\n\n        return (\n          <tr className={expandSummaryIndex[index] ? \"text-grey-100\" : \"\"}>\n            <td>{item.id}</td>\n            <td>\n              <div className=\"d-flex flex-row gap-2\">\n                <div\n                  className=\"d-flex flex-column gap-2 flex-wrap\"\n                  style={{ maxWidth: 320 }}\n                >\n                  <div\n                    className={\n                      \"text-size-2 bold max-w-100\" +\n                      (!expandSummaryIndex[index] && \" text-truncate\")\n                    }\n                  >\n                    {proposal?.snapshot?.name}\n                  </div>\n                  {expandSummaryIndex[index] && (\n                    <div className={\"text-dark-grey max-w-100\"}>\n                      {proposal?.snapshot?.summary}\n                    </div>\n                  )}\n                </div>\n                <div className=\"cursor\">\n                  <img\n                    src={\n                      expandSummaryIndex[index]\n                        ? \"https://ipfs.near.social/ipfs/bafkreic35n4yddasdpl532oqcxjwore66jrjx2qc433hqdh5wi2ijy4ida\"\n                        : \"https://ipfs.near.social/ipfs/bafkreiaujwid7iigy6sbkrt6zkwmafz5umocvzglndugvofcz2fpw5ur3y\"\n                    }\n                    onClick={() =>\n                      setExpandSummary((prevState) => ({\n                        ...prevState,\n                        [index]: !prevState[index],\n                      }))\n                    }\n                    height={20}\n                  />\n                </div>\n              </div>\n            </td>\n            <td className=\"text-truncate bold\" style={{ maxWidth: 150 }}>\n              {treasuryDaoID}\n            </td>\n            <td className=\"text-truncate bold\" style={{ maxWidth: 150 }}>\n              {args.receiver_id}\n            </td>\n            <td>\n              {isReceiverkycbVerified ? (\n                <img\n                  src=\"https://ipfs.near.social/ipfs/bafkreidqveupkcc7e3rko2e67lztsqrfnjzw3ceoajyglqeomvv7xznusm\"\n                  height={30}\n                />\n              ) : (\n                \"Need icon\"\n              )}\n            </td>\n            <td className=\"bold\">\n              <Widget\n                src={`${REPL_TREASURY}/widget/neardevhub-trustees.components.molecule.TokenAmount`}\n                props={{\n                  amountWithoutDecimals: args.amount,\n                  address: args.token_id,\n                }}\n              />\n            </td>\n            <td className=\"text-grey\">\n              <Widget\n                src={`${REPL_NEAR}/widget/TimeAgo`}\n                props={{\n                  blockTimestamp: item.submission_time,\n                }}\n              />\n            </td>\n            <td>\n              <button onClick={() => onPay(item.id)}>Pay</button>\n            </td>\n          </tr>\n        );\n      })}\n    </tbody>\n  );\n};\n\nreturn (\n  <Container className=\"d-flex flex-column gap-4\">\n    <div className=\"d-flex flex-row gap-2 align-items-center\">\n      <div className=\"h5 bold mb-0\">Need Approvals</div>\n      <i class=\"bi bi-info-circle\"></i>\n    </div>\n    <div className=\"card-custom overflow p-3\">\n      <table className=\"table\">\n        <thead>\n          <tr className=\"text-grey\">\n            <td>ID</td>\n            <td>PROPOSAL</td>\n            <td>FROM</td>\n            <td>TO</td>\n            <td>KYC/B VERIFIED</td>\n            <td>AMOUNT</td>\n            <td>CREATED</td>\n            <td>PAY</td>\n          </tr>\n        </thead>\n        <ProposalsComponent />\n      </table>\n    </div>\n    <div className=\"d-flex align-items-center justify-content-center\">\n      <Widget\n        src={`${REPL_TREASURY}/widget/neardevhub-trustees.components.molecule.Pagination`}\n        props={{\n          totalPages: Math.round(lastProposalID / resPerPage),\n          onPageClick: (v) => setPage(v),\n        }}\n      />\n    </div>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/megha19.near/widget/neardevhub-trustees.components.trustee.Approvals", "fact_widget_deployments_id": "1a6f50c69fb5aa4d3ea5a135fbfdeb9c", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 1}