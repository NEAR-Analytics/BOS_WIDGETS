{"tx_hash": "75viVPDnSVebkPCdnb2LzNg9mMB6NmotdjZGTKqGZyuY", "action_id_social": "DBzgNpUVe1JzUkBcHeatiXs5hDcpFRk3B8oeNCojp8JL-0-widget", "block_id": 111218980, "block_timestamp": "2024-01-24T17:51:00.745Z", "signer_id": "megha19.near", "widget_name": "core.lib.checkIsMemberOrPending", "source_code": "// checks if the user is already dao's community/council member or has an active proposal\nconst checkIsMemberOrPending = (accountId) => {\n  const daoId = \"build.sputnik-dao.near\";\n  if (!accountId) {\n    return false;\n  }\n  const alreadyJoinedRolesNames = [\"community\", \"council\"];\n  const searchRange = 100;\n\n  const lastProposalId = Near.view(daoId, \"get_last_proposal_id\");\n\n  const policy = Near.view(daoId, \"get_policy\");\n  const isDaoMember = false;\n  const lastProposals =\n    Near.view(daoId, \"get_proposals\", {\n      from_index: lastProposalId - searchRange,\n      limit: searchRange,\n    }) || [];\n\n  const alreadyMadeAProposal =\n    lastProposals.filter((proposal) => {\n      return (\n        proposal.proposer === accountId && proposal.status === \"InProgress\"\n      );\n    }).length > 0;\n\n  policy.roles\n    .filter((role) => alreadyJoinedRolesNames.includes(role.name))\n    .map((role) => {\n      if (Array.isArray(role.kind.Group) && !isDaoMember) {\n        isDaoMember = role.kind.Group.includes(accountId);\n      }\n    });\n\n  return isDaoMember || alreadyMadeAProposal;\n};\n\nreturn { checkIsMemberOrPending };\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/megha19.near/widget/core.lib.checkIsMemberOrPending", "fact_widget_deployments_id": "3e8ffe2887cf184c6e58bccc982382b5", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 1}