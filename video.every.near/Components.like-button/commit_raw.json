{"tx_hash": "FdWkoikZHnaGQgBhASDC7wJ1D8uLVA691pmYNQ744ikU", "action_id_social": "DffThbutw3HBXurgtLF45ZVbma39XCqqbzPmbSxUiDg1-0-widget", "block_id": 117052998, "block_timestamp": "2024-04-17T18:16:25.287Z", "signer_id": "video.every.near", "widget_name": "Components.like-button", "source_code": "const item = props.item;\nif (!item) {\n  return \"\";\n}\nconst likes = Social.index(\"like\", item);\nconst dataLoading = likes === null;\nconst likesByUsers = {};\n(likes || []).forEach((like) => {\n  if (like.value.type === \"like\") {\n    likesByUsers[like.accountId] = like;\n  } else if (like.value.type === \"unlike\") {\n    delete likesByUsers[like.accountId];\n  }\n});\nif (state.hasLike === true) {\n  likesByUsers[context.accountId] = {\n    accountId: context.accountId,\n  };\n} else if (state.hasLike === false) {\n  delete likesByUsers[context.accountId];\n}\nconst accountsWithLikes = Object.keys(likesByUsers);\nconst hasLike = context.accountId && !!likesByUsers[context.accountId];\nconst LikeButton = styled.button`\n  border: 0 !important;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 50%;\n  width: 2.5em;\n  height: 2.5em;\n`;\nconst likeClick = () => {\n  if (state.loading) {\n    return;\n  }\n  State.update({\n    loading: true,\n  });\n  const data = {\n    index: {\n      like: JSON.stringify({\n        key: item,\n        value: {\n          type: hasLike ? \"unlike\" : \"like\",\n        },\n      }),\n    },\n  };\n  if (!hasLike && props.notifyAccountId) {\n    data.index.notify = JSON.stringify({\n      key: props.notifyAccountId,\n      value: {\n        type: \"like\",\n        item,\n      },\n    });\n  }\n  Social.set(data, {\n    onCommit: () => State.update({ loading: false, hasLike: !hasLike }),\n    onCancel: () => State.update({ loading: false }),\n  });\n};\nconst title = hasLike ? \"Unlike\" : \"Like\";\nreturn (\n  <div className=\"d-inline-flex align-items-center\">\n    <LikeButton\n      disabled={state.loading || dataLoading || !context.accountId}\n      className=\"btn me-1\"\n      title={title}\n      onClick={likeClick}\n    >\n      {state.loading || dataLoading ? (\n        <span\n          className=\"spinner-grow spinner-grow-sm p-2\"\n          role=\"status\"\n          aria-hidden=\"true\"\n        />\n      ) : (\n        <>\n          <div className=\"text-black d-flex flex-row-reverse align-items-center gap-1\">\n            {accountsWithLikes.length > 0 ? accountsWithLikes.length : 0}\n            <svg\n              xmlns=\"http://www.w3.org/2000/svg\"\n              width=\"24\"\n              height=\"24\"\n              viewBox=\"0 0 24 24\"\n              fill=\"none\"\n            >\n              <path\n                d=\"M18.77 11H14.54L16.06 6.06C16.38 5.03 15.54 4 14.38 4C13.8 4 13.24 4.24 12.86 4.65L7 11H3V21H7H8H17.43C18.49 21 19.41 20.33 19.62 19.39L20.96 13.39C21.23 12.15 20.18 11 18.77 11ZM7 20H4V12H7V20ZM19.98 13.17L18.64 19.17C18.54 19.65 18.03 20 17.43 20H8V11.39L13.6 5.33C13.79 5.12 14.08 5 14.38 5C14.64 5 14.88 5.11 15.01 5.3C15.08 5.4 15.16 5.56 15.1 5.77L13.58 10.71L13.18 12H14.53H18.76C19.17 12 19.56 12.17 19.79 12.46C19.92 12.61 20.05 12.86 19.98 13.17Z\"\n                fill=\"black\"\n              />\n            </svg>\n          </div>\n        </>\n      )}\n    </LikeButton>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/video.every.near/widget/Components.like-button", "fact_widget_deployments_id": "50e8a5c57fb84a8254b47a0b6b99aecc", "inserted_timestamp": "2024-04-17T19:42:32.678Z", "modified_timestamp": "2024-04-17T19:42:32.678Z", "__row_index": 0}