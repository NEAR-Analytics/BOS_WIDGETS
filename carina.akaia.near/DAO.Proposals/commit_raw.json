{"tx_hash": "BNBWEty8TuQih1nfTk5S6sDHQ9vxwuqAFhwNRFdDosXx", "action_id_social": "BAi9ceETSPmjsccSqhEzuwXKLFFxuCfu64JM4go41scT-0-widget", "block_id": 97242174, "block_timestamp": "2023-07-24T18:44:36.698Z", "signer_id": "carina.akaia.near", "widget_name": "DAO.Proposals", "source_code": "const WIDGET_AUTHOR = \"sking.near\";\nconst daoId = props.daoId ?? \"multi.sputnik-daos.near\";\nconst proposalsPerPage = props.proposalsPerPage ?? 10; // Number of proposals to fetch at a time\n\nState.init({\n  daoId,\n  proposals: [],\n  lastProposalId: null, // To keep track of the last loaded proposal\n  hasMore: true, // Boolean to know if there are more proposals to load\n  showCreateProposal: false,\n});\n\nconst loadProposals = () => {\n  const lastProposalId =\n    state.lastProposalId !== null\n      ? state.lastProposalId\n      : Near.view(daoId, \"get_last_proposal_id\");\n  if (lastProposalId === null) return;\n\n  // Prevents multiple calls to loadProposals() before the first call is finished\n  if (state.proposals.length > 0 && state.proposals[0].id === lastProposalId)\n    return;\n\n  const fromIndex = Math.max(0, lastProposalId - proposalsPerPage + 1); // Ensures fromIndex is never less than 0\n  const limit = fromIndex === 0 ? lastProposalId + 1 : proposalsPerPage; // Ensure we don't fetch the same proposals twice if fromIndex is 0\n\n  const newProposals = Near.view(daoId, \"get_proposals\", {\n    from_index: fromIndex,\n    limit: limit,\n  });\n  if (newProposals === null) return;\n\n  console.log(\"Saving new proposals...\");\n  State.update({\n    ...state,\n    hasMore: fromIndex > 0,\n    proposals: [...state.proposals, ...newProposals.reverse()],\n    lastProposalId: fromIndex - 1,\n    isLoading: false,\n  });\n};\n\nconst onChangeDAO = (newDaoId) => {\n  console.log(\"Changing DAOs...\");\n  State.update({\n    daoId: newDaoId,\n    proposals: [],\n    lastProposalId: null,\n    hasMore: true,\n    showCreateProposal: false,\n  });\n};\n\nconst PopupWrapper = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  z-index: 1000;\n  width: 100vw;\n  height: 100vh;\n  background: rgba(0, 0, 0, 0.7);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  backdrop-filter: blur(6px);\n  padding: 16px;\n\n  @media (max-width: 600px) {\n    padding: 0;\n    & > * {\n      width: 100%;\n      height: 100%;\n      border-radius: 0;\n    }\n  }\n`;\n\nreturn (\n  <>\n    <div>\n      <div className=\"d-flex justify-content-between flex-wrap mb-3 align-items-center gap-3 pb-3\">\n        <h3 className=\"my-auto\">Proposals</h3>\n        <Widget\n          src=\"sking.near/widget/Common.Button\"\n          props={{\n            children: (\n              <>\n                <i className=\"bi bi-16 bi-plus-lg\"></i>\n                Create Proposal\n              </>\n            ),\n            onClick: () => State.update({ ...state, showCreateProposal: true }),\n            variant: \"success\",\n          }}\n        />\n      </div>\n\n      {!props.daoId && (\n        <div className=\"mb-2\">\n          <p className=\"m-1\">Sputnik Contract ID:</p>\n          <input\n            type=\"text\"\n            placeholder=\"example.sputnik-daos.near\"\n            onChange={(e) => onChangeDAO(e.target.value)}\n          />\n        </div>\n      )}\n\n      <InfiniteScroll loadMore={loadProposals} hasMore={state.hasMore}>\n        {state.proposals.map((proposal, i) => {\n          if (proposal.status === \"Removed\") return null;\n          return (\n            <Widget\n              key={i}\n              src={WIDGET_AUTHOR + \"/widget/DAO.Proposal\"}\n              props={{ daoId: state.daoId, proposal: proposal }}\n            />\n          );\n        })}\n      </InfiniteScroll>\n    </div>\n\n    {state.showCreateProposal && (\n      <PopupWrapper\n        id=\"create-proposal-popup\"\n        onClick={(e) => {\n          if (e.target.id === \"create-proposal-popup\") {\n            State.update({ ...state, showCreateProposal: false });\n          }\n        }}\n      >\n        <Widget\n          src={WIDGET_AUTHOR + \"/widget/DAO.Proposal.Create\"}\n          props={{\n            daoId: state.daoId,\n            onClose: () =>\n              State.update({ ...state, showCreateProposal: false }),\n          }}\n        />\n      </PopupWrapper>\n    )}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/carina.akaia.near/widget/DAO.Proposals", "fact_widget_deployments_id": "a4672e81085b294de86179dfc7bcf501", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 22}