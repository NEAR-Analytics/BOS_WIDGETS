{"tx_hash": "5z3Kt8frdUn8QGNxys6zvgYVuxAGV8mequciRLa1WBok", "action_id_social": "7cZWXJ2DhEcj9w4YGje1pdYX4EEYL9PHzBnru2QaUVw1-0-widget", "block_id": 108243155, "block_timestamp": "2023-12-18T10:24:08.183Z", "signer_id": "sainy.near", "widget_name": "SupercallTokenTransfer", "source_code": "const ERC20_ABI_URL =\n  \"https://gist.githubusercontent.com/veox/8800debbf56e24718f9f483e1e40c35c/raw/f853187315486225002ba56e5283c1dba0556e6f/erc20.abi.json\";\nconst ERC20_ABI = fetch(ERC20_ABI_URL).body;\n\nfunction handleChange(key, value) {\n  State.update({ [key]: value });\n\n  if (key === \"tokenAddress\") {\n    try {\n      const contract = new ethers.Contract(\n        value,\n        ERC20_ABI,\n        Ethers.provider().getSigner()\n      );\n      contract.decimals().then((dec) => {\n        State.update({ decimals: dec });\n      });\n    } catch (e) {}\n  }\n}\n\nfunction buildCall() {\n  try {\n    const iface = new ethers.utils.Interface(ERC20_ABI);\n    const callData = iface.encodeFunctionData(\"transfer\", [\n      state.to,\n      ethers.utils.parseUnits(state.amount, state.decimals),\n    ]);\n    const callPayload = {\n      target: state.tokenAddress,\n      callData: callData,\n    };\n    Storage.set(`callPayload:${props.callId}`, callPayload);\n\n    State.update({\n      isOk: true,\n    });\n  } catch (e) {\n    State.update({\n      isOk: false,\n    });\n  }\n}\n\nState.init({\n  tokenAddress: \"\",\n  to: \"\",\n  amount: \"0\",\n  decimals: 18,\n  isOk: false,\n});\n\nbuildCall();\n\nreturn (\n  <div className=\"border border-1 rounded rounded-md p-2\">\n    <h2>Token Transfer</h2>\n    <div>\n      <p>Token</p>\n      <Widget\n        src=\"sainy.near/widget/SelectToken\"\n        props={{\n          onChange: (token) => console.log(token),\n        }}\n      />\n    </div>\n    <div>\n      <p>To</p>\n      <input onChange={(e) => handleChange(\"to\", e.target.value)} />\n    </div>\n    <div>\n      <p>Amount</p>\n      <input onChange={(e) => handleChange(\"amount\", e.target.value)} />\n    </div>\n    <Widget src=\"sainy.near/widget/SupercallBase\" props={props} />\n  </div>\n);\n", "metadata": {"fork_of": "sainy.near/widget/SupercallTokenTransfer@108166564"}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/sainy.near/widget/SupercallTokenTransfer", "fact_widget_deployments_id": "b99c63fe56c3ede03470ef19079360fb", "inserted_timestamp": "2023-12-18T12:22:31.993Z", "modified_timestamp": "2023-12-20T03:22:11.422Z", "__row_index": 6}