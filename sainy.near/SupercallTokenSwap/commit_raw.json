{"tx_hash": "3VsqWuK25Ar1PN5BzmGnVu79M6yPoCSUKVqsW1VwgYQu", "action_id_social": "G8T4bncHV9hVfrAeVMYZnN4sLg6dfbaFGRWXcaS5svHZ-0-widget", "block_id": 109097966, "block_timestamp": "2023-12-29T17:35:20.929Z", "signer_id": "sainy.near", "widget_name": "SupercallTokenSwap", "source_code": "// ======== Unchangeable area: Please scroll down to edit  ====================\nconst ABI_URLs = {};\nconst ABIs = {};\nconst calls = [];\n\nfunction addABIUrl(key, url) {\n  ABI_URLs[key] = url;\n  ABIs[key] = fetch(url).body;\n}\n\nfunction getABI(key) {\n  return ABIs[key];\n}\n\nfunction addCall(ABI, target, functionName, params) {\n  try {\n    const iface = new ethers.utils.Interface(ABI);\n    const callData = iface.encodeFunctionData(\n      functionName,\n      Object.values(params)\n    );\n    calls.push({\n      target: target,\n      callData: callData,\n    });\n  } catch (e) {}\n}\n\nconst Container = styled.div`\n  border-radius: 14px;\n  border: 1px solid #e9ebed;\n  width: 328px;\n  background-color: white;\n`;\n\nconst ContainerContent = styled.div`\n  padding: 18px 22px;\n`;\n\nconst TextHeader = styled.span`\n  color: var(--Text-Primary-Text, #262930);\n  /* p-ui-semibold */\n  font-family: Mona Sans;\n  font-size: 16px;\n  font-style: normal;\n  font-weight: 600;\n  line-height: 24px; /* 150% */\n`;\n\nconst Divider = styled.div`\n  height: 1px;\n  padding: 0;\n  background: #e5e7eb;\n`;\n\nconst StyleTextTitle = styled.span`\n  color: var(--Text-Secondary-Text, #656973);\n\n  /* body */\n  font-family: Mona Sans;\n  font-size: 14px;\n  font-style: normal;\n  font-weight: 400;\n  line-height: 20px; /* 142.857% */\n`;\n\nconst StyledBoxInput = styled.div`\n  margin-bottom: 10px;\n`;\n\nconst CallInput = (props) => (\n  <StyledBoxInput>\n    <StyleTextTitle>{props.title}</StyleTextTitle>\n    {props.children}\n  </StyledBoxInput>\n);\n\nconst MainComponent = () => (\n  <Container>\n    <ContainerContent>\n      <TextHeader>{title}</TextHeader>\n    </ContainerContent>\n    <Divider />\n    <ContainerContent>\n      {renderInputs()}\n      <Widget src=\"sainy.near/widget/SupercallBase\" props={props} />\n    </ContainerContent>\n  </Container>\n);\n\n// ====================== Start edit =======================\n\n// 1. Call Title\nconst title = \"Token swap\";\n\n// 2. Add Contract ABIs - addABIUrl(name, url)\naddABIUrl(\n  \"SWAP_ROUTER\",\n  \"https://raw.githubusercontent.com/SainyTK/contract-list/main/abis/UniswapV2Router.json\"\n);\naddABIUrl(\n  \"ERC20\",\n  \"https://raw.githubusercontent.com/SainyTK/contract-list/main/abis/ERC20.json\"\n);\n\n// 3. Add calls - addCall(ABI, target, functionName, params)\nconst approveParams = {\n  spender: state.router,\n  amount: state.amount,\n};\naddCall(getABI(\"ERC20\"), state.token0.address, \"approve\", approveParams);\n\nconst swapParams = {\n  amount: state.amount,\n  amountOutMin: 0,\n  path:\n    state.token0 && state.token1\n      ? [state.token0.address, state.token1.address]\n      : [],\n  to: Ethers.send(\"eth_requestAccounts\", [])[0],\n  deadline: Math.floor((new Date().valueOf() + 10 * 60) / 100),\n};\naddCall(\n  getABI(\"SWAP_ROUTER\"),\n  state.router,\n  \"swapExactTokensForTokens\",\n  swapParams\n);\n\n// 4. Call interface\nconst renderInputs = () => (\n  <>\n    <CallInput title=\"Router address\">\n      <input\n        placeholder=\"Router address\"\n        style={{ border: \"1px solid #E9EBED\" }}\n        onChange={(e) => State.update({ router: e.target.value })}\n      />\n    </CallInput>\n    <CallInput title=\"Input token\">\n      <Widget\n        src=\"sainy.near/widget/SelectToken\"\n        props={{\n          chainId: props.chainId,\n          onChange: (token) => State.update({ token0: token }),\n        }}\n      />\n    </CallInput>\n    <CallInput title=\"Output token\">\n      <Widget\n        src=\"sainy.near/widget/SelectToken\"\n        props={{\n          chainId: props.chainId,\n          onChange: (token) => State.update({ token1: token }),\n        }}\n      />\n    </CallInput>\n    <CallInput title=\"Amount\">\n      <input\n        placeholder=\"Amount\"\n        style={{ border: \"1px solid #E9EBED\" }}\n        onChange={(e) => State.update({ amount: e.target.value })}\n      />\n    </CallInput>\n  </>\n);\n\n// ====================== End edit =======================\n\nStorage.set(`callPayload:${props.callId}`, calls);\nreturn <MainComponent />;\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/sainy.near/widget/SupercallTokenSwap", "fact_widget_deployments_id": "078f3ad9a1c2d0e75fb1a3e435a88be0", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}