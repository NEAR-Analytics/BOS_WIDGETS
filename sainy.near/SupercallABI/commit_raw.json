{"tx_hash": "4n2ZbWAYAo91wzXySjDJFrvyNNfGMojxXSkJYAqECX9o", "action_id_social": "FTZntqUBfhKXr49spJjEstX15fhxyP24guo31XAnpow3-0-widget", "block_id": 108301321, "block_timestamp": "2023-12-19T03:47:47.599Z", "signer_id": "sainy.near", "widget_name": "SupercallABI", "source_code": "// ================ USER INPUT ==============================\nconst title = props.title;\nconst abiUrl = props.abiUrl;\nconst callId = props.callId;\n\n// ================= STYLE ================================\n\nconst Container = styled.div`\n  border-radius: 14px;\n  border: 1px solid #e9ebed;\n  width: 328px;\n  background-color: white;\n`;\n\nconst ContainerContent = styled.div`\n  padding: 18px 22px;\n`;\n\nconst TextHeader = styled.span`\n  color: var(--Text-Primary-Text, #262930);\n  /* p-ui-semibold */\n  font-family: Mona Sans;\n  font-size: 16px;\n  font-style: normal;\n  font-weight: 600;\n  line-height: 24px; /* 150% */\n`;\n\nconst Divider = styled.div`\n  height: 1px;\n  padding: 0;\n  background: #e5e7eb;\n`;\n\nconst StyleTextTitle = styled.span`\n  color: var(--Text-Secondary-Text, #656973);\n\n  /* body */\n  font-family: Mona Sans;\n  font-size: 14px;\n  font-style: normal;\n  font-weight: 400;\n  line-height: 20px; /* 142.857% */\n`;\n\nconst StyledBoxInput = styled.div`\n  margin-bottom: 10px;\n`;\n\n// ======================================================\n\nconst ABI = fetch(abiUrl).body;\n\nfunction parseFunctions(abiStr) {\n  try {\n    const abi = JSON.parse(abiStr);\n    if (Array.isArray(abi)) {\n      return abi.filter((item) => item.type === \"function\");\n    }\n    return [];\n  } catch (error) {\n    console.error(\"Error parsing JSON:\", error);\n    return [];\n  }\n}\n\nfunction getFunctionType(stateMutability) {\n  if ([\"view\", \"pure\"].includes(stateMutability)) {\n    return \"read\";\n  } else {\n    return \"write\";\n  }\n}\n\nfunction handleChange(key, value) {\n  State.update({ [key]: value });\n}\n\nfunction buildCall() {\n  try {\n    const selectedFunction = functions[state.selectedFunction];\n    const iface = new ethers.utils.Interface(ABI);\n    const callData = iface.encodeFunctionData(\n      selectedFunction.name,\n      state.params\n    );\n    const callPayload = {\n      target: state.contractAddress,\n      callData: callData,\n    };\n    Storage.set(`callPayload:${callId}`, callPayload);\n\n    State.update({\n      isOk: true,\n    });\n  } catch (e) {\n    State.update({\n      isOk: false,\n    });\n  }\n}\n\nState.init({\n  contractAddress: \"\",\n  selectedFunction: 0,\n  params: [],\n  isOk: false,\n});\n\nbuildCall();\nconst functions = parseFunctions(ABI);\nconst selectedFunction = functions[state.selectedFunction];\nconst inputs = selectedFunction ? selectedFunction.inputs : [];\n\n// ============================ RENDER =======================\n\nreturn (\n  <Container>\n    <ContainerContent>\n      <TextHeader>{title}</TextHeader>\n    </ContainerContent>\n    <Divider />\n    <ContainerContent>\n      <StyledBoxInput>\n        <StyleTextTitle>Contract address</StyleTextTitle>\n        <input\n          placeholder={\"Contract address\"}\n          style={{ border: \"1px solid #E9EBED\" }}\n          onChange={(e) => State.update({ contractAddress: e.target.value })}\n        />\n      </StyledBoxInput>\n      <StyledBoxInput>\n        <StyleTextTitle>Select function</StyleTextTitle>\n        <Widget\n          src=\"sainy.near/widget/Select\"\n          props={{\n            options: functions.map((fn) => ({\n              label: `${fn.name} (${getFunctionType(fn.stateMutability)})`,\n              value: fn.name,\n            })),\n            value: state.selectedFunction,\n            onChange: (index) => State.update({ selectedFunction: index }),\n          }}\n        />\n      </StyledBoxInput>\n      {inputs.map((input, index) => (\n        <StyledBoxInput key={index}>\n          <StyleTextTitle>\n            {input.name} ({input.type})\n          </StyleTextTitle>\n          <input\n            placeholder={`${input.name} (${input.type})`}\n            style={{ border: \"1px solid #E9EBED\" }}\n            onChange={(e) =>\n              State.update({\n                params: inputs.map((inpt, j) => {\n                  if (index === j) return e.target.value;\n                  else if ([undefined, null].includes(state.params[j]))\n                    return \"\";\n                  else return state.params[j];\n                }),\n              })\n            }\n          />\n        </StyledBoxInput>\n      ))}\n      <Widget src=\"sainy.near/widget/SupercallBase\" props={props} />\n    </ContainerContent>\n  </Container>\n);\n", "metadata": {"fork_of": "sainy.near/widget/SupercallABI@108301194"}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/sainy.near/widget/SupercallABI", "fact_widget_deployments_id": "82180192774c7233c834a4b0578a53b2", "inserted_timestamp": "2023-12-19T05:47:14.461Z", "modified_timestamp": "2023-12-20T03:22:11.422Z", "__row_index": 1}