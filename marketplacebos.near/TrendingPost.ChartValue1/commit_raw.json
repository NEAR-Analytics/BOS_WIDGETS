{"tx_hash": "HDgtp42pvkFX5h1QDjEKwxT7jUu7FFK2y8b8C3AAbFKS", "action_id_social": "9rxmDdRVA3jEuTayXd1DKhdQ91bjNmyqVDDYTRPQXumn-0-widget", "block_id": 107152605, "block_timestamp": "2023-12-04T17:59:44.876Z", "signer_id": "marketplacebos.near", "widget_name": "TrendingPost.ChartValue1", "source_code": "const findHashtags = (str) => {\n  const regexp = /\\B\\#\\w\\w+\\b/g;\n  let match;\n  let tags = [];\n  while ((match = regexp.exec(str)) !== null) {\n    tags.push(match[0]);\n  }\n  return tags;\n};\nconst respBlock = fetch(\"https://api.nearblocks.io/v1/stats\");\n\nconst newBlock30Days = Math.round(\n  parseInt(respBlock.body.stats[0].block) -\n    (30 * 24 * 3600) / parseInt(respBlock.body.stats[0].avg_block_time)\n);\n\n// 1 days\nconst newBlock1Days = Math.round(\n  parseInt(respBlock.body.stats[0].block) -\n    (1 * 24 * 3600) / parseInt(respBlock.body.stats[0].avg_block_time)\n);\n\nlet BlockHeightPost1Days = [];\nconst getBlockHeight1daysPost = Social.index(\"post\", \"main\", {\n  from: newBlock1Days,\n  limit: 99999,\n});\nif (!getBlockHeight1daysPost) {\n  return \"Loading...\";\n}\n\ngetBlockHeight1daysPost.forEach((item) => {\n  BlockHeightPost1Days.push({\n    accountId: item.accountId,\n    blockHeight: item.blockHeight,\n  });\n});\n\n\n\nlet post1days = [];\nBlockHeightPost1Days.forEach((item) => {\n  const post = Social.get(`${item.accountId}/post/main`, item.blockHeight);\n  if (post) {\n    post1days.push(JSON.parse(post).text);\n  }\n});\n\nlet tagCount1Days = {};\npost1days.forEach((item) => {\n  const tags = findHashtags(item);\n  if (tags.length > 0) {\n    tags.forEach((tag) => {\n      if (tagCount1Days[tag]) {\n        tagCount1Days[tag] = tagCount1Days[tag] + 1;\n      } else {\n        tagCount1Days[tag] = 1;\n      }\n    });\n  }\n});\nlet entries1days = Object.entries(tagCount1Days);\nlet post1daySorted = entries1days.sort((b, a) => a[1] - b[1]);\n\n\nlet totalItems1Day = 0;\n\n// Sum the values in the day1PostSorted array\nfor (let i = 0; i < post1daySorted.length; i++) {\n  totalItems1Day += post1daySorted[i][1];\n}\n\nconst labelN = \"Top 10 trending tags on NEAR Social in right now\";\n\nconst backgroundcolorP = [\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n];\n\nconst borderColorP = [\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n  \"blue\",\n];\n\n// Assuming item1 and item2 are properties of the objects in the 'sorted' array\nlet dataP = [];\nlet labelP = [];\n\nfor (let i = 0; i < 10; i++) {\n  if (post1daySorted[i]) {\n    dataP.push(post1daySorted[i][1]);\n    labelP.push(post1daySorted[i][0]);\n  }\n}\n\nconst StyledTable = styled.table`\n  width: 100%;\n  border-collapse: collapse;\n  margin-bottom: 20px;\n  border: none;\n  overflow: auto;\n  @media (max-width: 968px) {\n    font-size: 8px;\n  }\n  @media (max-width: 768px) {\n    font-size: 8px;\n  }\n`;\n\nconst StyledTh = styled.th`\n  padding: 12px;\n  text-align: left;\n  background-color: #f2f2f2;\n  border: none;\n  text-align: center;\n`;\n\nconst StyledTd = styled.td`\n  padding: 12px;\n  border: none;\n  text-align: center;\n`;\n\nconst StyledTotalContainer = styled.div`\n  border: 4px solid black;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  margin-top: 20px;\n`;\n\nconst StyledTotalLabel = styled.div`\n  font-weight: bold;\n  font-size: 18px;\n`;\n\nconst StyledTotalValue = styled.div`\n  font-weight: bold;\n  font-size: 24px;\n  margin-top: 8px;\n`;\n\nconst Table = () => {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n\n  return (\n    <>\n      {isLoading ? (\n        <p>Loading...</p>\n      ) : (\n        <>\n          <StyledTotalContainer>\n            <StyledTotalLabel>Total Posts</StyledTotalLabel>\n            <StyledTotalValue>{totalItems1Day}</StyledTotalValue>\n          </StyledTotalContainer>\n          <br />\n          <br />\n          <br />\n\n          <Widget\n            src=\"marketplacebos.near/widget/TrendingPost.ChartPost\"\n            props={{\n              dataP: dataP,\n              labelP: labelP,\n              backgroundcolorP: backgroundcolorP,\n              borderColorP: borderColorP,\n              labelN: labelN,\n            }}\n          />\n          <br />\n          <br />\n          <br />\n          <br />\n\n          <StyledTable>\n            <thead>\n              <tr>\n                <StyledTh>TAG NAME</StyledTh>\n                <StyledTh>TOTAL POST</StyledTh>\n              </tr>\n            </thead>\n            <tbody>\n              {post1daySorted &&\n                post1daySorted\n                  .filter((item, index) => index <= 10)\n                  .map((item) => (\n                    <tr>\n                      <StyledTd>\n                        <a\n                          href={`https://near.social/marketplacebos.near/widget/TrendingPost.TableValue?hashtag=${item[0].replace(\n                            \"#\",\n                            \"\"\n                          )}`}\n                        >\n                          {item[0]}\n                        </a>\n                      </StyledTd>\n                      <StyledTd>{item[1]}</StyledTd>\n                    </tr>\n                  ))}\n            </tbody>\n          </StyledTable>\n        </>\n      )}\n    </>\n  );\n};\n\nreturn (\n  <>\n    <Table />\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/marketplacebos.near/widget/TrendingPost.ChartValue1", "fact_widget_deployments_id": "a23ac8810d78d89366d05815b8f32017", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}