{"tx_hash": "D7aiAsreBxzukikZyTnxe92qE1CCi95gNVG6L2MGA233", "action_id_social": "2vF6TnfT7bcVY45nm4key66WuxtirC2vFNCiJ9fz6vH6-0-widget", "block_id": 106815873, "block_timestamp": "2023-11-29T16:26:08.137Z", "signer_id": "marketplacebos.near", "widget_name": "TrendingPost.ChartValue7", "source_code": "const findHashtags = (str) => {\r\n  const regexp = /\\B\\#\\w\\w+\\b/g;\r\n  let match;\r\n  let tags = [];\r\n  while ((match = regexp.exec(str)) !== null) {\r\n    tags.push(match[0]);\r\n  }\r\n  return tags;\r\n};\r\nconst respBlock = fetch(\"https://api.nearblocks.io/v1/stats\");\r\n\r\nconst newBlock = Math.round(\r\n  parseInt(respBlock.body.stats[0].block) -\r\n    (30 * 24 * 3600) / parseInt(respBlock.body.stats[0].avg_block_time)\r\n);\r\nconst newBlock1Days = Math.round(\r\n  parseInt(respBlock.body.stats[0].block) -\r\n    (1 * 24 * 3600) / parseInt(respBlock.body.stats[0].avg_block_time)\r\n);\r\nconst newBlock3Days = Math.round(\r\n  parseInt(respBlock.body.stats[0].block) -\r\n    (3 * 24 * 3600) / parseInt(respBlock.body.stats[0].avg_block_time)\r\n);\r\nconst newBlock7Days = Math.round(\r\n  parseInt(respBlock.body.stats[0].block) -\r\n    (7 * 24 * 3600) / parseInt(respBlock.body.stats[0].avg_block_time)\r\n);\r\nconst allPost = Social.get(\"*/post/main/\", \"final\");\r\n\r\nconst tagCountAll = {};\r\nconst tagCount1Days = {};\r\nconst tagCount3Days = {};\r\nconst tagCount7Days = {};\r\nObject.keys(allPost).forEach((item) => {\r\n  const tags = findHashtags(JSON.parse(allPost[item].post.main).text);\r\n  if (tags.length > 0) {\r\n    tags.forEach((tag) => {\r\n      tagCountAll[tag] = 0;\r\n      tagCount1Days[tag] = 0;\r\n      tagCount3Days[tag] = 0;\r\n      tagCount7Days[tag] = 0;\r\n    });\r\n  }\r\n});\r\nObject.keys(tagCountAll).forEach((tag) => {\r\n  const countAllPost = Social.index(\"hashtag\", tag.replace(\"#\", \"\"), {\r\n    from: newBlock,\r\n    limit: 999,\r\n    order: \"asc\",\r\n  });\r\n  const count1DaysPost = Social.index(\"hashtag\", tag.replace(\"#\", \"\"), {\r\n    from: newBlock1Days,\r\n    limit: 999,\r\n    order: \"asc\",\r\n  });\r\n  const count3DaysPost = Social.index(\"hashtag\", tag.replace(\"#\", \"\"), {\r\n    from: newBlock3Days,\r\n    limit: 999,\r\n    order: \"asc\",\r\n  });\r\n  const count7DaysPost = Social.index(\"hashtag\", tag.replace(\"#\", \"\"), {\r\n    from: newBlock7Days,\r\n    limit: 999,\r\n    order: \"asc\",\r\n  });\r\n  tagCountAll[tag] = countAllPost.length || 0;\r\n  tagCount1Days[tag] = count1DaysPost.length || 0;\r\n  tagCount3Days[tag] = count3DaysPost.length || 0;\r\n  tagCount7Days[tag] = count7DaysPost.length || 0;\r\n});\r\n\r\nlet entriesALL = Object.entries(tagCountAll);\r\nlet allPostSorted = entriesALL.sort((b, a) => a[1] - b[1]);\r\n\r\nlet entries1 = Object.entries(tagCount1Days);\r\nlet day1PostSorted = entries1.sort((b, a) => a[1] - b[1]);\r\n\r\nlet entries3 = Object.entries(tagCount3Days);\r\nlet day3PostSorted = entries3.sort((b, a) => a[1] - b[1]);\r\n\r\nlet entries7 = Object.entries(tagCount7Days);\r\nlet day7PostSorted = entries7.sort((b, a) => a[1] - b[1]);\r\n\r\nlet totalItems7Days = 0;\r\n\r\n// Sum the values in the day7PostSorted array\r\nfor (let i = 0; i < day7PostSorted.length; i++) {\r\n  totalItems7Days += day7PostSorted[i][1];\r\n}\r\n\r\nconst labelN = \"Top 20 trending tags on NEAR Social in 7 days\";\r\n\r\nconst backgroundcolorP = [\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n];\r\n\r\nconst borderColorP = [\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n  \"blue\",\r\n];\r\n\r\nlet dataP = [];\r\nlet labelP = [];\r\n\r\n// Assuming allPostSorted has at least 20 items\r\nfor (let i = 0; i < 10; i++) {\r\n  if (day7PostSorted[i]) {\r\n    dataP.push(day7PostSorted[i][1]); // Assuming item[1] contains the data for dataP\r\n    labelP.push(day7PostSorted[i][0]); // Assuming item[0] contains the data for labelP\r\n  }\r\n}\r\n\r\n// ... (rest of the code remains unchanged)\r\n\r\nconst StyledTable = styled.table`\r\n  width: 100%;\r\n  border-collapse: collapse;\r\n  margin-bottom: 20px;\r\n  border: none;\r\n  overflow: auto;\r\n  @media (max-width: 968px) {\r\n    font-size: 8px;\r\n  }\r\n  @media (max-width: 768px) {\r\n    font-size: 8px;\r\n  }\r\n`;\r\n\r\nconst StyledTh = styled.th`\r\n  padding: 12px;\r\n  text-align: left;\r\n  background-color: #f2f2f2;\r\n  border: none;\r\n  text-align: center;\r\n`;\r\n\r\nconst StyledTd = styled.td`\r\n  padding: 12px;\r\n  border: none;\r\n  text-align: center;\r\n`;\r\n\r\nconst StyledTotalContainer = styled.div`\r\n  border: 4px solid black;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  margin-top: 20px;\r\n`;\r\n\r\nconst StyledTotalLabel = styled.div`\r\n  font-weight: bold;\r\n  font-size: 18px;\r\n`;\r\n\r\nconst StyledTotalValue = styled.div`\r\n  font-weight: bold;\r\n  font-size: 24px;\r\n  margin-top: 8px;\r\n`;\r\n\r\nconst Table = () => {\r\n  const [searchTerm, setSearchTerm] = useState(\"\");\r\n\r\n  return (\r\n    <>\r\n      <StyledTotalContainer>\r\n        <StyledTotalLabel>Total Posts</StyledTotalLabel>\r\n        <StyledTotalValue>{totalItems7Days}</StyledTotalValue>\r\n      </StyledTotalContainer>\r\n      <br />\r\n      <br />\r\n      <br />\r\n\r\n      <Widget\r\n        src=\"marketplacebos.near/widget/TrendingPost.ChartPost\"\r\n        props={{\r\n          dataP: dataP,\r\n          labelP: labelP,\r\n          backgroundcolorP: backgroundcolorP,\r\n          borderColorP: borderColorP,\r\n          labelN: labelN,\r\n        }}\r\n      />\r\n      <br />\r\n      <br />\r\n      <br />\r\n      <br />\r\n\r\n      <StyledTable>\r\n        <thead>\r\n          <tr>\r\n            <StyledTh>TAG NAME</StyledTh>\r\n            <StyledTh>TOTAL POST</StyledTh>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {day7PostSorted &&\r\n            day7PostSorted\r\n              .filter((item, index) => index <= 10)\r\n              .map((item) => (\r\n                <tr key={item[0]}>\r\n                  <StyledTd>\r\n                    <a\r\n                      href={`https://near.social/marketplacebos.near/widget/TrendingPost.TableValue?hashtag=${item[0].replace(\r\n                        \"#\",\r\n                        \"\"\r\n                      )}`}\r\n                    >\r\n                      {item[0]}\r\n                    </a>\r\n                  </StyledTd>\r\n                  <StyledTd>{item[1]}</StyledTd>\r\n                </tr>\r\n              ))}\r\n        </tbody>\r\n      </StyledTable>\r\n    </>\r\n  );\r\n};\r\n\r\nreturn (\r\n  <>\r\n    <Table />\r\n  </>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/marketplacebos.near/widget/TrendingPost.ChartValue7", "fact_widget_deployments_id": "97f153b12cc6f8985644771c0aa5fb3a", "inserted_timestamp": "2023-11-29T18:31:41.863Z", "modified_timestamp": "2023-12-20T00:36:59.366Z", "__row_index": 17}