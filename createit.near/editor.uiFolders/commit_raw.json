{"tx_hash": "8WYo51c5HjRR1RysMFWboaWde3pATcnUuSLBWxnqNgNc", "action_id_social": "GkBRFC1FGv786Vne9mGrYNvkY8A64Xw1XD3VmCanWe4f-0-widget", "block_id": 99698855, "block_timestamp": "2023-08-26T11:33:05.772Z", "signer_id": "createit.near", "widget_name": "editor.uiFolders", "source_code": "const classNames = (classes) =>\n  classes.filter((className) => className).join(\" \");\n\nconst widget = (src, props, other) => (\n  <Widget src={src} props={props} {...other} />\n);\n\nconst Url = {\n  construct: (url, params) => {\n    let query = \"\";\n    Object.keys(params || {}).forEach((key) => {\n      if (params.hasOwnProperty(key)) {\n        query += Url.encode(key) + \"=\" + Url.encode(params[key]);\n        if (key !== Object.keys(params || {}).slice(-1)[0]) {\n          query += \"&\";\n        }\n      }\n    });\n    return url + \"?\" + query;\n  },\n  // Alternative to encodeURIComponent\n  encode: (str) => {\n    return `${str}`\n      .replace(/[!'()*]/g, (c) => {\n        return \"%\" + c.charCodeAt(0).toString(16);\n      })\n      .replace(/[^!'\\(\\)~\\*A-Za-z0-9\\-_\\.~]/g, (c) => {\n        return \"%\" + c.charCodeAt(0).toString(16);\n      });\n  },\n};\n\n\n// TODO: should be able to hide/show children elements\n\nconst { project: projectId, navigate } = props;\n\n// This should be in editor.index but let it be here for now\nconst project = props.handle[\"project\"].get(projectId) ?? {};\nconst flatFolders = props.handle[\"document\"].getAll(projectId) ?? {};\n\n// Also unflattenDocuments should be removed, it's just extra processing, the widget should be able to handle the flat structure\nconst folders = props.handle[\"utils\"].unflattenDocuments(flatFolders);\n\nconst activeDoc = props.handle[\"document\"].getSelected(projectId);\nconst { DOC_SEPARATOR } = props.handle[\"other\"];\n\nconst isActive = (path) => path.join(DOC_SEPARATOR) === activeDoc;\n\nconst handler = (action, path) => {\n  switch (action) {\n    case \"delete\":\n      props.handle[\"document\"].delete(projectId, path.join(DOC_SEPARATOR));\n      break;\n    case \"create\":\n      props.handle[\"document\"].create(projectId, path.join(DOC_SEPARATOR));\n      break;\n    case \"open\":\n      props.handle[\"document\"].open(projectId, path.join(DOC_SEPARATOR));\n      break;\n    case \"refresh\":\n      props.handle[\"project\"].init(projectId, true);\n      break;\n    case \"rename\":\n      // props.handleRenameDocument(path, \"modal not implemented\");\n      break;\n    case \"move\":\n      // props.handleMoveDocument(path, \"modal not implemented\");\n      break;\n    default:\n      break;\n  }\n};\n\nconst renderFolderHeader = (folder) => {\n  const { title, path, icon, isFile, inBuffer } = folder;\n\n  return (\n    <div\n      className={path.length > 1 ? \"folder__child__header\" : \"folder__header\"}\n      data-active={isActive(path)}\n      role=\"button\"\n      tabIndex=\"0\"\n      title=\"Open folder\"\n      onClick={(e) => {\n        if (e.target.id !== \"create-file\") handler(\"open\", path);\n      }}\n    >\n      <i\n        className={classNames([\n          \"bi\",\n          \"bi-\" + (icon ?? (!isFile ? \"folder\" : \"file-earmark\")),\n        ])}\n      ></i>\n      <span>\n        {title === undefined || title === null || title === \"\"\n          ? \"Untitled\"\n          : title}\n      </span>\n      {inBuffer && (\n        <i\n          className=\"bi bi-asterisk ms-1\"\n          title=\"unsaved changes\"\n          style={{ color: \"red\" }}\n        ></i>\n      )}\n      <i\n        className=\"button bi bi-file-earmark-plus\"\n        id=\"create-file\"\n        onClick={() => {\n          handler(\"create\", path);\n        }}\n        role=\"button\"\n        tabIndex=\"0\"\n        title=\"New file\"\n      ></i>\n    </div>\n  );\n};\n\nconst renderFolder = (folder) => {\n  const { path, value, index } = folder;\n  const {\n    children,\n    title,\n    _: { inBuffer },\n  } = value;\n\n  return (\n    <div\n      className={classNames([path.length > 1 ? \"folder__child\" : \"folder\"])}\n      key={path}\n    >\n      {widget(\"createit.near/widget/editor.uiFoldersMenu\", {\n        path,\n        handler,\n        renderTrigger: () =>\n          renderFolderHeader({\n            title: title,\n            path: path,\n            isFile: !children || Object.keys(children).length === 0,\n            inBuffer,\n          }),\n      })}\n\n      {children && !!Object.keys(children).length && (\n        <div className=\"folder__children\">\n          {Object.keys(children).map((k, i) => {\n            return renderFolder({\n              path: [...path, k],\n              value: children[k],\n              index: i,\n            });\n          })}\n        </div>\n      )}\n    </div>\n  );\n};\n\nconst Project = styled.div`\n  border: 1px solid #ccc;\n  border-radius: 10px;\n  margin-bottom: 2.4rem;\n  padding: 12px;\n\n  a {\n    text-decoration: none;\n    color: #000;\n    transition: opacity 0.2s ease-in-out;\n\n    &:hover {\n      opacity: 0.9;\n    }\n  }\n\n  img {\n    max-width: 80px;\n  }\n`;\n\nconst renderProject = (project) => {\n  const { title, logo } = project.data;\n\n  return (\n    <Project>\n      <a\n        target=\"_blank\"\n        href={Url.construct(\"#/createit.near/widget/p\", {\n          id: projectId,\n          by: context.accountId,\n        })}\n        className=\"d-flex align-items-center mb-4 justify-content-between gap-1\"\n      >\n        {logo && <img src={logo} alt={title} height={40} />}\n        <span className=\"h6 m-0 flex-fill ms-2\">{title}</span>\n        <i className=\"ms-1 bi bi-box-arrow-up-right\"></i>\n      </a>\n      <div>\n        <a\n          title=\"Open project settings\"\n          onClick={() => {\n            navigate(\"manage\", { project: projectId });\n          }}\n          href={Url.construct(\"#/createit.near/widget/home\", {\n            page: \"manage\",\n            project: projectId,\n          })}\n        >\n          <i className=\"bi bi-gear\"></i>\n          <span className=\"ms-1\">Settings</span>\n        </a>\n      </div>\n    </Project>\n  );\n};\n\nconst Folders = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  padding: 1rem 0;\n  overflow: auto;\n\n  .folder__header {\n  }\n  .folder__header,\n  .folder__child__header {\n    user-select: none;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    padding: 6px 14px;\n    min-width: calc(100% - 1.5rem);\n    font-size: 12px;\n    font-weight: 600;\n    line-height: 1;\n    border-radius: 10px;\n    cursor: pointer;\n    background-color: transparent;\n    transition: background-color 0.2s ease-in-out;\n    margin-left: -4px;\n\n    .bi {\n      font-size: 13px;\n      transform: translateX(-50%);\n    }\n\n    &[data-active=\"true\"] {\n      background-color: #00ec9730 !important;\n    }\n    &:hover,\n    &:active {\n      background-color: #00ec9710;\n    }\n\n    .button {\n      font-size: 14px;\n      font-weight: 600;\n      background-color: transparent;\n      transition: all 0.2s ease-in-out;\n      margin-left: auto;\n      padding: 3px;\n      border-radius: 6px;\n      transform: translateX(50%);\n\n      &:hover {\n        background-color: #00000010;\n      }\n    }\n  }\n  .folder__children {\n    display: flex;\n    flex-direction: column;\n    position: relative;\n    padding-left: 8px;\n    padding-top: 8px;\n    gap: 4px;\n\n    &::before {\n      content: \"\";\n      display: block;\n      width: 2px;\n      height: calc(100% - 1.5rem);\n      background-color: #ccc;\n      margin-left: 8px;\n      position: absolute;\n      top: 0;\n      left: 0;\n    }\n  }\n  .folder__child {\n    position: relative;\n    padding-left: 14px;\n\n    &::before {\n      content: \"\";\n      display: block;\n      width: 16px;\n      height: 16px;\n      border-radius: 0 0 0 50%;\n      margin-left: 2px;\n      box-shadow: -2px 2px 0 0 #ccc;\n      position: absolute;\n      left: 0;\n    }\n  }\n\n  [data-radix-popper-content-wrapper] {\n    z-index: 1 !important;\n  }\n`;\n\nconst Header = styled.div`\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding-right: 9px;\n\n  .header__right {\n    display: flex;\n    gap: 1rem;\n    align-items: center;\n    font-size: 1.15rem;\n    font-weight: 600;\n    line-height: 1;\n    cursor: pointer;\n    color: #000;\n    transition: color 0.2s ease-in-out;\n\n    &:hover {\n      color: #666;\n    }\n  }\n\n  .header__subtitle {\n    font-size: 0.9rem;\n    font-weight: 600;\n    line-height: 1;\n    color: #666;\n  }\n`;\n\nconst Wrapper = styled.div`\n  display: grid;\n  grid-template-rows: auto auto;\n`;\n\nreturn (\n  <Wrapper className=\"py-4 ps-3 pe-1\">\n    {renderProject(project)}\n\n    <div>\n      <Header>\n        <span className=\"header__subtitle\">Documents</span>\n        <div className=\"header__right\">\n          <i\n            className=\"bi bi-file-earmark-plus\"\n            role=\"button\"\n            onClick={() => {\n              handler(\"create\", []);\n            }}\n            title=\"Create new folder\"\n            tabIndex=\"0\"\n            style={{ fontSize: \"16px\" }}\n          ></i>\n        </div>\n      </Header>\n      <Folders>\n        {folders &&\n          Object.keys(folders).map((f, i) => {\n            return renderFolder({\n              path: [f],\n              value: folders[f],\n              index: i,\n            });\n          })}\n      </Folders>\n    </div>\n\n    <div>\n      {/* TODO: The markdown editor doesn't refresh even if data is fresh */}\n      <Widget\n        src=\"nearui.near/widget/Input.Button\"\n        props={{\n          children: \"Refresh\",\n          onClick: () => {\n            handler(\"refresh\");\n          },\n        }}\n      />\n    </div>\n  </Wrapper>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/createit.near/widget/editor.uiFolders", "fact_widget_deployments_id": "ac17bfcd4926178524e83b26c3994a3a", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 2}