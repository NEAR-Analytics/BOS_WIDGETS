{"tx_hash": "E4YsQi8m9omskdQdqofSQEsXSyg7phYRZDj2njVfGa4Z", "action_id_social": "9J7zQQBzGvX8DC83fdqHBi8z5FyB4N1tPArvt6hugtPS-0-widget", "block_id": 108324864, "block_timestamp": "2023-12-19T11:16:54.415Z", "signer_id": "coolmouse.near", "widget_name": "KSTNAnvil.Proposals.Index", "source_code": "// constants\n\nconst ActionEnum = {\n  1: \"Add new signer\",\n  2: \"Deploy new ERC-20 token\",\n  4: \"Remove signer\",\n  8: \"Set new ERC-20 token template\",\n  16: \"Delist token\",\n  32: \"List new token\",\n  64: \"Approve token spending\",\n  128: \"Burn token balance\",\n  256: \"Burn token balance from\",\n  512: \"Mint token to\",\n  1024: \"Renounce token ownership\",\n  2048: \"Withdraw token\",\n  4096: \"Tranfer token from\",\n  8192: \"Transfer token ownership\",\n};\nconst abi = [\n  // proposal(pos: uint256)\n  {\n    inputs: [\n      {\n        name: \"pos\",\n        type: \"uint256\",\n      },\n    ],\n    name: \"proposal\",\n    outputs: [\n      {\n        components: [\n          {\n            name: \"id\",\n            type: \"bytes32\",\n          },\n          {\n            name: \"action\",\n            type: \"uint256\",\n          },\n          {\n            name: \"amount\",\n            type: \"uint256\",\n          },\n          {\n            name: \"created_at\",\n            type: \"uint256\",\n          },\n          {\n            name: \"data\",\n            type: \"bytes\",\n          },\n          {\n            name: \"targets\",\n            type: \"address[]\",\n          },\n          {\n            name: \"approvals\",\n            type: \"address[]\",\n          },\n          {\n            name: \"expires\",\n            type: \"uint256\",\n          },\n        ],\n        name: \"\",\n        type: \"tuple\",\n      },\n    ],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  // proposal_count()\n  {\n    inputs: [],\n    name: \"proposal_count\",\n    outputs: [\n      {\n        name: \"\",\n        type: \"uint256\",\n      },\n    ],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n];\nconst keystoneAddress = \"0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512\"; // Anvil\n\n// states\n\nState.init({\n  page: [],\n  pageNum: 1,\n  pageSize: 20,\n});\n\n// lifecycle hooks\n\nuseEffect(() => {\n  if (Ethers.provider()) {\n    const iface = new ethers.utils.Interface(abi);\n    const encodedData = iface.encodeFunctionData(\"proposal_count\", []);\n    Ethers.provider()\n      .call({\n        to: keystoneAddress,\n        data: encodedData,\n      })\n      .then((rawProposalCount) => {\n        const proposalCountHex = iface.decodeFunctionResult(\n          \"proposal_count\",\n          rawProposalCount\n        );\n        let proposals = [];\n        for (let i = 0; i < parseInt(proposalCountHex.toString()); i++) {\n          const encodedData = iface.encodeFunctionData(\"proposal\", [i]);\n          Ethers.provider()\n            .call({\n              to: keystoneAddress,\n              data: encodedData,\n            })\n            .then((rawProposal) => {\n              const proposalAttrs = iface.decodeFunctionResult(\n                \"proposal\",\n                rawProposal\n              );\n              let proposal = {\n                id: proposalAttrs[0].id.toString(),\n                action: proposalAttrs[0].action.toNumber(),\n                amount: proposalAttrs[0].amount.toNumber(),\n                created_at: proposalAttrs[0].created_at.toNumber(),\n                data: proposalAttrs[0].data.toString(),\n                targets: proposalAttrs[0].targets,\n                approvals: proposalAttrs[0].approvals,\n                expires: proposalAttrs[0].expires.toNumber(),\n              };\n              proposal[\"actionEnum\"] = ActionEnum[proposal.action];\n              proposal[\"proposedBy\"] = proposal[\"approvals\"][0];\n              proposal[\"threshold\"] = 1;\n              proposals.push(proposal);\n            })\n            .catch(console.error);\n          State.update({ page: proposals });\n        }\n      })\n      .catch(console.error);\n  }\n}, []);\n\n// funcs\nlet fasttrack = (proposal) => {};\n\nconst KeystoneContent = styled.div`\n  h1, h2, h3, h4, h5 {\n    margin: 0;\n  }\n  ol, ul, menu {\n    list-style: none;\n    margin: 0;\n    padding: 0;\n  }\n  .absolute {\n    position: absolute;\n  }\n  .breadcrumbs {\n    max-width: 100%;\n    overflow-x: auto;\n    padding-top: 0.5rem;\n    padding-bottom: 0.5rem;\n  }\n  .breadcrumbs > ul, .breadcrumbs > ol {\n    display: flex;\n    align-items: center;\n    white-space: nowrap;\n    min-height: min-content;\n  }\n  .breadcrumbs > ul > li, .breadcrumbs > ol > li {\n    display: flex;\n    align-items: center;\n  }\n  .breadcrumbs > ul > li + ::before, .breadcrumbs > ol > li + ::before {\n    content: \"\";\n    margin-left: 0.5rem;\n    margin-right: 0.75rem;\n    display: block;\n    height: 0.375rem;\n    width: 0.375rem;\n    transform: matrix(0.707107, 0.707107, -0.707107, 0.707107, 0, 0);\n    opacity: 0.4;\n    border-top: 1px solid;\n    border-right: 1px solid;\n    background-color: transparent;\n  }\n  .breadcrumbs > ul > li > a, .breadcrumbs > ol > li > a {\n    display: flex;\n    cursor: pointer;\n    align-items: center;\n  }\n  .btn {\n    display: inline-flex;\n    height: 3rem;\n    min-height: 3rem;\n    flex-shrink: 0;\n    cursor: pointer;\n    user-select: none;\n    flex-wrap: wrap;\n    align-items: center;\n    justify-content: center;\n    border-radius: 0.5rem;\n    border-color: transparent;\n    border-color: currentColor;\n    padding-left: 1rem;\n    padding-right: 1rem;\n    text-align: center;\n    font-size: 0.875rem;\n    line-height: 1em;\n    gap: 0.5rem;\n    font-weight: 600;\n    text-decoration-line: none;\n    transition-duration: 200ms;\n    transition-timing-function: cubic-bezier(0, 0, 0.2, 1);\n    border-width: 1px;\n    animation: button-pop 0.25s ease-out;\n    transition-property: color, background-color, border-color, opacity, box-shadow, transform;\n    color: currentColor;\n    box-shadow: 0 0 #0000, 0 0 #0000), 0;\n    outline-color: currentColor;\n    background-color: currentColor;\n  }\n  .btn-outline {\n    border-color: currentColor;\n    background-color: transparent;\n    box-shadow: 0 0 #0000, 0 0 #0000), 0;\n  }\n  .btn-primary {\n    color: oklch(0.6569 0.196 275.75);\n    border-color: oklch(0.6569 0.196 275.75);\n  }\n  .btn-secondary {\n    color: oklch(0.748 0.26 342.55);\n    border-color: oklch(0.748 0.26 342.55);\n  }\n  .glass, .glass.btn-active {\n    border: none;\n    backdrop-filter: blur(40px);\n    background-color: transparent;\n    background-image: linear-gradient(135deg, rgb(255 255 255 / 30%) 0%, rgb(0 0 0 / 0%) 100%), linear-gradient( 100deg, rgb(255 255 255 / 10%) 25%, rgb(0 0 0 / 0%) 25% );\n    box-shadow: 0 0 0 1px rgb(255 255 255 / 10%) inset, 0 0 0 2px rgb(0 0 0 / 5%);\n    text-shadow: 0 1px rgb(0 0 0 / 5%);\n  }\n  .card {\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    border-radius: 1rem;\n  }\n  .card-body {\n    display: flex;\n    flex: 1 1 auto;\n    flex-direction: column;\n    padding: 2rem;\n    gap: 0.5rem;\n  }\n  .card-title {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    font-size: 1.25rem;\n    line-height: 1.75rem;\n    font-weight: 600;\n  }\n  .col-span-1 {\n    grid-column: span 1 / span 1;\n  }\n  .col-span-2 {\n    grid-column: span 2 / span 2;\n  }\n  .ease-in-out {\n    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n  }\n  .fill-primary {\n    fill: oklch(0.6569 0.196 275.75);\n  }\n  .fill-secondary {\n    fill: oklch(0.748 0.26 342.55);\n  }\n  .flex {\n    display: flex;\n  }\n  .float-right {\n    float: right;\n  }\n  .form-control {\n    display: flex;\n    flex-direction: column;\n  }\n  .grid {\n    display: grid;\n  }\n  .grid-flow-row-dense {\n    grid-auto-flow: row dense;\n  }\n  .h-full {\n    height: 100%;\n  }\n  .input {\n    flex-shrink: 1;\n    appearance: none;\n    height: 3rem;\n    padding-left: 1rem;\n    padding-right: 1rem;\n    font-size: 1rem;\n    line-height: 1.5rem;\n    border-radius: 0.5rem;\n    border-width: 1px;\n    border-color: transparent;\n    background-color: oklch(0.7206 0.191 231.6) / 0.2;\n  }\n  .input-info {\n    border-color: oklch(0.7206 0.191 231.6);\n  }\n  .justify-between {\n    justify-content: space-between;\n  }\n  .justify-center {\n    justify-content: center;\n  }\n  .label {\n    display: flex;\n    user-select: none;\n    align-items: center;\n    justify-content: space-between;\n    padding-left: 0.25rem;\n    padding-right: 0.25rem;\n    padding-top: 0.5rem;\n    padding-bottom: 0.5rem;\n  }\n  .label-text {\n    font-size: 0.875rem;\n    line-height: 1.25rem;\n    color: currentColor;\n  }\n  .left-12 {\n    left: 3rem;\n  }\n  .left-51 {\n    left: 11.75rem;\n  }\n  .left-100 {\n    left: 20rem;\n  }\n  .max-w-7xl {\n    max-width: 80rem;\n  }\n  .ml-4 {\n    margin-left: 1rem;\n  }\n  .mr-2 {\n    margin-right: 0.5rem;\n  }\n  .mx-auto {\n    margin-left: auto;\n    margin-right: auto;\n  }\n  .mx-20 {\n    margin-left: 5rem;\n    margin-right: 5rem;\n  }\n  .overflow-x-auto {\n    overflow-x: auto;\n  }\n  .pt-4 {\n    padding-top: 1rem;\n  }\n  .px-2 {\n    padding-left: 0.5rem;\n    padding-right: 0.5rem;\n  }\n  .py-20 {\n    padding-top: 5rem;\n    padding-bottom: 5rem;\n  }\n  .py-3 {\n    padding-top: 0.75rem;\n    padding-bottom: 0.75rem;\n  }\n  .text-lg {\n    font-size: 1.125rem;\n    line-height: 1.75rem;\n  }\n  .text-xs {\n    font-size: 0.75rem;\n    line-height: 1rem;\n  }\n  .transition {\n    transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;\n    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n    transition-duration: 150ms;\n  }\n  .w-5 {\n    width: 1.25rem;\n  }\n  .w-96 {\n    width: 24rem;\n  }\n  .w-full {\n    width: 100%;\n  }\n`;\n\nreturn (\n  <>\n    <Widget src=\"coolmouse.near/widget/KSTNAnvil.Navbar\" />\n    <KeystoneContent>\n      <div className=\"overflow-x-auto mx-20 pt-4\">\n        <div className=\"text-lg breadcrumbs\">\n          <ul>\n            <li>\n              <Link href={\"/coolmouse.near/widget/KSTNAnvil.Index\"}>\n                {\" \"}\n                Home{\" \"}\n              </Link>\n            </li>\n            <li>Proposals</li>\n          </ul>\n        </div>\n        <div className=\"py-5\">\n          <Link\n            className=\"btn btn-primary btn-outline group mr-5\"\n            href=\"coolmouse.near/widget/KSTNAnvil.Proposals.Keystone\"\n          >\n            <svg\n              className=\"fill-primary h-full w-5 mr-2\"\n              height=\"24px\"\n              version=\"1.1\"\n              viewBox=\"0 0 24 24\"\n              width=\"24px\"\n              xmlns=\"http://www.w3.org/2000/svg\"\n            >\n              <path\n                d=\"\n                  M22.3,16.7\n                  l1.4-1.4\n                  L20,11.6l-5.8,5.8\n                  c-0.5-0.3-1.1-0.4-1.7-0.4\n                  C10.6,17,9,18.6,9,20.5\n                  s1.6,3.5,3.5,3.5\n                  s3.5-1.6,3.5-3.5\n                  c0-0.6-0.2-1.2-0.4-1.7\n                  l1.9-1.9\n                  l2.3,2.3\n                  l1.4-1.4\n                  l-2.3-2.3\n                  l1.1-1.1\n                  L22.3,16.7z\n                  M12.5,22\n                  c-0.8,0-1.5-0.7-1.5-1.5\n                  s0.7-1.5,1.5-1.5\n                  s1.5,0.7,1.5,1.5\n                  S13.3,22,12.5,22z\n                \"\n              />\n              <path\n                d=\"\n                  M2,19\n                  c0-3.9,3.1-7,7-7\n                  c2,0,3.9,0.9,5.3,2.4\n                  l1.5-1.3\n                  c-0.9-1-1.9-1.8-3.1-2.3\n                  C14.1,9.7,15,7.9,15,6\n                  c0-3.3-2.7-6-6-6\n                  S3,2.7,3,6\n                  c0,1.9,0.9,3.7,2.4,4.8\n                  C2.2,12.2,0,15.3,0,19\n                  v5\n                  h8\n                  v-2\n                  H2\n                  V19z\n                  M5,6\n                  c0-2.2,1.8-4,4-4\n                  s4,1.8,4,4\n                  s-1.8,4-4,4\n                  S5,8.2,5,6z\n                \"\n              />\n            </svg>\n            New keystone action\n          </Link>\n          <Link\n            className=\"btn btn-secondary btn-outline group\"\n            href=\"coolmouse.near/widget/KSTNAnvil.Proposals.Token\"\n          >\n            <svg\n              className=\"fill-secondary h-full w-5 mr-2\"\n              clipRule=\"evenodd\"\n              fillRule=\"evenodd\"\n              height=\"16px\"\n              version=\"1.1\"\n              viewBox=\"0 0 16 16\"\n              width=\"16px\"\n              xmlns=\"http://www.w3.org/2000/svg\"\n            >\n              <path\n                d=\"\n                  M5.791 3.318\n                  L3.316 5.793\n                  a1 1 0 000 1.414\n                  l2.475 2.475\n                  a1 1 0 001.415 0\n                  L9.68 7.207\n                  a1 1 0 000-1.414\n                  L7.206 3.318\n                  a1 1 0 00-1.415 0z\n                  m.707 4.95\n                  L4.731 6.5\n                  l1.767-1.768\n                  L8.266 6.5 6.498 8.268z\n                \"\n              />\n              <path\n                d=\"\n                  M0 6.5\n                  a6.5 6.5 0 0112.346-2.845 6.5 6.5 0 11-8.691 8.691\n                  A6.5 6.5 0 010 6.5z\n                  m6.5-5\n                  a5 5 0 100 10 5 5 0 000-10z\n                  m6.5 5\n                  c0-.201-.01-.4-.027-.597\n                  a5 5 0 11-7.07 7.07\n                  A6.5 6.5 0 0013 6.5z\n                \"\n              />\n            </svg>\n            New token action\n          </Link>\n        </div>\n        <table className=\"table table-compact w-full text-center\">\n          <thead>\n            <tr>\n              <th></th>\n              <th></th>\n              <th>Proposed by</th>\n              <th>Action</th>\n              <th>Approved</th>\n              <th>Created at</th>\n              <th>Expired at</th>\n              <th>Value</th>\n              <th></th>\n            </tr>\n          </thead>\n          <tbody>\n            {state.page.map((proposal, index) => (\n              <tr\n                className=\"cursor-pointer transition duration-200 hover:scale-y-110 hover:scale-x-[0.99] hover\"\n                key={index}\n              >\n                <td className=\"px-0 font-bold\">\n                  {(state.pageNum - 1) * state.pageSize + index + 1}\n                </td>\n                <td></td>\n                <td>{proposal.proposedBy.slice(0, 10)}...</td>\n                <td>{proposal.actionEnum}</td>\n                <td>\n                  {(proposal.approvals.length / proposal.threshold) * 100.0}%\n                </td>\n                <td>{proposal.createdAt}</td>\n                <td>{proposal.expires}</td>\n                <td>\n                  {!!proposal.token ? (\n                    <span>\n                      {shiftDecimals(proposal.amount, proposal.token.decimals)}\n                    </span>\n                  ) : (\n                    <span>{proposal.amount}</span>\n                  )}\n                </td>\n                <td style={{ pointerEvents: \"none\" }}>\n                  {proposal.approvals.length >= proposal.threshold && (\n                    <button\n                      style={{ pointerEvents: \"auto\" }}\n                      onClick={() => fasttrack(proposal)}\n                      className=\"btn btn-info btn-outline btn-xs\"\n                    >\n                      Execute\n                    </button>\n                  )}\n                </td>\n              </tr>\n            ))}\n          </tbody>\n          <tfoot>\n            <tr>\n              <th></th>\n              <th></th>\n              <th>Proposed by</th>\n              <th>Action</th>\n              <th>Approved</th>\n              <th>Created at</th>\n              <th>Expired at</th>\n              <th>Value</th>\n              <th></th>\n            </tr>\n          </tfoot>\n        </table>\n      </div>\n    </KeystoneContent>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/coolmouse.near/widget/KSTNAnvil.Proposals.Index", "fact_widget_deployments_id": "782f383e1422d973b8bfbc3c5cfc746e", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}