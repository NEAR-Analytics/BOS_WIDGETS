{"tx_hash": "3H5Q3sVGkw2SJ8rXo7EkZQkT7NFy9qn72LC26M3vXV31", "action_id_social": "8Hh8jhHQNMVdq8cYstx6oqMyvSTFpuNyoCzZXMoWYT86-0-widget", "block_id": 108319191, "block_timestamp": "2023-12-19T09:23:17.373Z", "signer_id": "coolmouse.near", "widget_name": "KSTNAnvil.Proposals.Keystone", "source_code": "// constants\n\nconst abi = [\n  // propose(action: uint256, amount: uint256, data: bytes, lifetime: uint256, targets: address[3])\n  {\n    inputs: [\n      {\n        name: \"action\",\n        type: \"uint256\",\n      },\n      {\n        name: \"amount\",\n        type: \"uint256\",\n      },\n      {\n        name: \"data\",\n        type: \"bytes\",\n      },\n      {\n        name: \"lifetime\",\n        type: \"uint256\",\n      },\n      {\n        name: \"targets\",\n        type: \"address[3]\",\n      },\n    ],\n    name: \"propose\",\n    outputs: [\n      {\n        name: \"\",\n        type: \"bytes32\",\n      },\n    ],\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n];\nconst keystoneAddress = \"0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512\"; // Anvil\n\n// states\n\nState.init({\n  action: \"add-signer\",\n  lifetime: 172800,\n  target: \"\",\n  targetLabel: \"Recipient address\",\n  name: \"\",\n  symbol: \"\",\n});\n\nif (state.action !== null) {\n  if (state.action == \"add-signer\") {\n    State.update({ targetLabel: \"New signer address\" });\n  } else if (state.action == \"remove-signer\") {\n    State.update({ targetLabel: \"Existing signer address\" });\n  } else if (state.action == \"set-blueprint\") {\n    State.update({ targetLabel: \"New ERC-20 token template address\" });\n  }\n}\n\n// funcs\n\nlet createProposal = () => {\n  let actionEnum = {\n    \"add-signer\": 1, // 2^0\n    \"deploy-token\": 2, // 2^1\n    \"remove-signer\": 4, // 2^2\n    \"set-blueprint\": 8, // 2^3\n  }[state.action];\n  // derive proposal data from given fields\n  let data = \"\";\n  if (state.action != \"deploy-token\") {\n    data += \"0x\" + \"0\".repeat(64);\n  } else {\n    try {\n      data += \"0x\";\n      data += ethers.utils.formatBytes32String(state.name).slice(2);\n      data += ethers.utils.formatBytes32String(state.symbol).slice(2);\n    } catch (err) {\n      console.error(err);\n      return;\n    }\n  }\n  // fill targets\n  let targets = [];\n  if ([\"add-signer\", \"remove-signer\", \"set-blueprint\"].includes(state.action)) {\n    targets.push(state.target);\n  }\n  for (let i = targets.length; i < 3; i++) {\n    targets.push(\"0x\" + \"0\".repeat(40));\n  }\n  let keystone;\n  try {\n    keystone = new ethers.Contract(\n      keystoneAddress,\n      abi,\n      Ethers.provider().getSigner()\n    );\n  } catch (err) {\n    console.error(\"Unable to instantiate contract connection.\");\n    return;\n  }\n  keystone\n    .propose(actionEnum, 0, data, state.lifetime, targets)\n    .then((transaction) => {\n      console.log(\"transactionHash is \" + transaction.hash);\n    })\n    .catch((err) => {\n      console.error(err);\n    });\n};\n\n// styles\nconst KeystoneContent = styled.div`\n  h1, h2, h3, h4, h5 {\n    margin: 0;\n  }\n  ol, ul, menu {\n    list-style: none;\n    margin: 0;\n    padding: 0;\n  }\n  .absolute {\n    position: absolute;\n  }\n  .breadcrumbs {\n    max-width: 100%;\n    overflow-x: auto;\n    padding-top: 0.5rem;\n    padding-bottom: 0.5rem;\n  }\n  .breadcrumbs > ul, .breadcrumbs > ol {\n    display: flex;\n    align-items: center;\n    white-space: nowrap;\n    min-height: min-content;\n  }\n  .breadcrumbs > ul > li, .breadcrumbs > ol > li {\n    display: flex;\n    align-items: center;\n  }\n  .breadcrumbs > ul > li + ::before, .breadcrumbs > ol > li + ::before {\n    content: \"\";\n    margin-left: 0.5rem;\n    margin-right: 0.75rem;\n    display: block;\n    height: 0.375rem;\n    width: 0.375rem;\n    transform: matrix(0.707107, 0.707107, -0.707107, 0.707107, 0, 0);\n    opacity: 0.4;\n    border-top: 1px solid;\n    border-right: 1px solid;\n    background-color: transparent;\n  }\n  .breadcrumbs > ul > li > a, .breadcrumbs > ol > li > a {\n    display: flex;\n    cursor: pointer;\n    align-items: center;\n  }\n  .btn {\n    display: inline-flex;\n    height: 3rem;\n    min-height: 3rem;\n    flex-shrink: 0;\n    cursor: pointer;\n    user-select: none;\n    flex-wrap: wrap;\n    align-items: center;\n    justify-content: center;\n    border-radius: 0.5rem;\n    border-color: transparent;\n    border-color: currentColor;\n    padding-left: 1rem;\n    padding-right: 1rem;\n    text-align: center;\n    font-size: 0.875rem;\n    line-height: 1em;\n    gap: 0.5rem;\n    font-weight: 600;\n    text-decoration-line: none;\n    transition-duration: 200ms;\n    transition-timing-function: cubic-bezier(0, 0, 0.2, 1);\n    border-width: 1px;\n    animation: button-pop 0.25s ease-out;\n    transition-property: color, background-color, border-color, opacity, box-shadow, transform;\n    color: currentColor;\n    box-shadow: 0 0 #0000, 0 0 #0000), 0;\n    outline-color: currentColor;\n    background-color: currentColor;\n  }\n  .btn-outline {\n    border-color: currentColor;\n    background-color: transparent;\n    box-shadow: 0 0 #0000, 0 0 #0000), 0;\n  }\n  .btn-secondary {\n    color: oklch(0.748 0.26 342.55);\n    border-color: oklch(0.748 0.26 342.55);\n  }\n  .glass, .glass.btn-active {\n    border: none;\n    backdrop-filter: blur(40px);\n    background-color: transparent;\n    background-image: linear-gradient(135deg, rgb(255 255 255 / 30%) 0%, rgb(0 0 0 / 0%) 100%), linear-gradient( 100deg, rgb(255 255 255 / 10%) 25%, rgb(0 0 0 / 0%) 25% );\n    box-shadow: 0 0 0 1px rgb(255 255 255 / 10%) inset, 0 0 0 2px rgb(0 0 0 / 5%);\n    text-shadow: 0 1px rgb(0 0 0 / 5%);\n  }\n  .card {\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    border-radius: 1rem;\n  }\n  .card-body {\n    display: flex;\n    flex: 1 1 auto;\n    flex-direction: column;\n    padding: 2rem;\n    gap: 0.5rem;\n  }\n  .card-title {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    font-size: 1.25rem;\n    line-height: 1.75rem;\n    font-weight: 600;\n  }\n  .col-span-1 {\n    grid-column: span 1 / span 1;\n  }\n  .col-span-2 {\n    grid-column: span 2 / span 2;\n  }\n  .ease-in-out {\n    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n  }\n  .flex {\n    display: flex;\n  }\n  .float-right {\n    float: right;\n  }\n  .form-control {\n    display: flex;\n    flex-direction: column;\n  }\n  .grid {\n    display: grid;\n  }\n  .grid-flow-row-dense {\n    grid-auto-flow: row dense;\n  }\n  .h-full {\n    height: 100%;\n  }\n  .input {\n    flex-shrink: 1;\n    appearance: none;\n    height: 3rem;\n    padding-left: 1rem;\n    padding-right: 1rem;\n    font-size: 1rem;\n    line-height: 1.5rem;\n    border-radius: 0.5rem;\n    border-width: 1px;\n    border-color: transparent;\n    background-color: oklch(0.7206 0.191 231.6) / 0.2;\n  }\n  .input-info {\n    border-color: oklch(0.7206 0.191 231.6);\n  }\n  .justify-between {\n    justify-content: space-between;\n  }\n  .justify-center {\n    justify-content: center;\n  }\n  .label {\n    display: flex;\n    user-select: none;\n    align-items: center;\n    justify-content: space-between;\n    padding-left: 0.25rem;\n    padding-right: 0.25rem;\n    padding-top: 0.5rem;\n    padding-bottom: 0.5rem;\n  }\n  .label-text {\n    font-size: 0.875rem;\n    line-height: 1.25rem;\n    color: currentColor;\n  }\n  .left-12 {\n    left: 3rem;\n  }\n  .left-51 {\n    left: 11.75rem;\n  }\n  .left-100 {\n    left: 20rem;\n  }\n  .max-w-7xl {\n    max-width: 80rem;\n  }\n  .ml-4 {\n    margin-left: 1rem;\n  }\n  .mr-2 {\n    margin-right: 0.5rem;\n  }\n  .mx-auto {\n    margin-left: auto;\n    margin-right: auto;\n  }\n  .mx-20 {\n    margin-left: 5rem;\n    margin-right: 5rem;\n  }\n  .overflow-x-auto {\n    overflow-x: auto;\n  }\n  .px-2 {\n    padding-left: 0.5rem;\n    padding-right: 0.5rem;\n  }\n  .py-20 {\n    padding-top: 5rem;\n    padding-bottom: 5rem;\n  }\n  .pt-4 {\n    padding-top: 1rem;\n  }\n  .text-lg {\n    font-size: 1.125rem;\n    line-height: 1.75rem;\n  }\n  .text-xs {\n    font-size: 0.75rem;\n    line-height: 1rem;\n  }\n  .transition {\n    transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;\n    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n    transition-duration: 150ms;\n  }\n  .w-5 {\n    width: 1.25rem;\n  }\n  .w-96 {\n    width: 24rem;\n  }\n  .w-full {\n    width: 100%;\n  }\n`;\n\nreturn (\n  <>\n    <Widget src=\"coolmouse.near/widget/KSTNAnvil.Navbar\" />\n    <KeystoneContent>\n      <div className=\"overflow-x-auto mx-20 pt-4\">\n        <div className=\"text-lg breadcrumbs\">\n          <ul>\n            <li>\n              <Link href={\"/coolmouse.near/widget/KSTNAnvil.Index\"}>\n                {\" \"}\n                Home{\" \"}\n              </Link>\n            </li>\n            <li>\n              <Link href={\"/coolmouse.near/widget/KSTNAnvil.Proposals.Index\"}>\n                {\" \"}\n                Proposals{\" \"}\n              </Link>\n            </li>\n            <li>\n              <svg\n                className=\"h-full w-5 mr-2\"\n                fill=\"currentColor\"\n                height=\"24px\"\n                version=\"1.1\"\n                viewBox=\"0 0 24 24\"\n                width=\"24px\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n              >\n                <path\n                  d=\"\n                    M22.3,16.7\n                    l1.4-1.4\n                    L20,11.6l-5.8,5.8\n                    c-0.5-0.3-1.1-0.4-1.7-0.4\n                    C10.6,17,9,18.6,9,20.5\n                    s1.6,3.5,3.5,3.5\n                    s3.5-1.6,3.5-3.5\n                    c0-0.6-0.2-1.2-0.4-1.7\n                    l1.9-1.9\n                    l2.3,2.3\n                    l1.4-1.4\n                    l-2.3-2.3\n                    l1.1-1.1\n                    L22.3,16.7z\n                    M12.5,22\n                    c-0.8,0-1.5-0.7-1.5-1.5\n                    s0.7-1.5,1.5-1.5\n                    s1.5,0.7,1.5,1.5\n                    S13.3,22,12.5,22z\n                  \"\n                />\n                <path\n                  d=\"\n                    M2,19\n                    c0-3.9,3.1-7,7-7\n                    c2,0,3.9,0.9,5.3,2.4\n                    l1.5-1.3\n                    c-0.9-1-1.9-1.8-3.1-2.3\n                    C14.1,9.7,15,7.9,15,6\n                    c0-3.3-2.7-6-6-6\n                    S3,2.7,3,6\n                    c0,1.9,0.9,3.7,2.4,4.8\n                    C2.2,12.2,0,15.3,0,19\n                    v5\n                    h8\n                    v-2\n                    H2\n                    V19z\n                    M5,6\n                    c0-2.2,1.8-4,4-4\n                    s4,1.8,4,4\n                    s-1.8,4-4,4\n                    S5,8.2,5,6z\n                  \"\n                />\n              </svg>\n              Create a keystone proposal\n            </li>\n          </ul>\n        </div>\n        <div className=\"grid grid-flow-row-dense md:grid-cols-4 sm:grid-cols-2 py-20\">\n          <div className=\"md:col-span-1 sm:col-span-0\"></div>\n          <div className=\"col-span-2\">\n            <div className=\"card w-96 glass mx-auto\">\n              <div className=\"card-body\">\n                <h2 className=\"card-title\">Create a keystone proposal</h2>\n                <div className=\"form-control\">\n                  <label className=\"label\">\n                    <span className=\"label-text\">Select action</span>\n                  </label>\n                  <select\n                    aria-label=\"Select proposal action\"\n                    className=\"input input-bordered input-info max-w-xsrounded transition ease-in-out focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none\"\n                    onChange={(event) =>\n                      State.update({ action: event.target.value })\n                    }\n                    value={state.action}\n                  >\n                    <option value=\"add-signer\">Add new signer</option>\n                    <option value=\"remove-signer\">Remove signer</option>\n                    <option value=\"deploy-token\">\n                      Deploy new ERC-20 token\n                    </option>\n                    <option value=\"set-blueprint\">\n                      Set new ERC-20 token template\n                    </option>\n                  </select>\n                </div>\n                {[\"add-signer\", \"remove-signer\", \"set-blueprint\"].includes(\n                  state.action\n                ) && (\n                  <div className=\"form-control\">\n                    <label className=\"label\">\n                      <span className=\"label-text\">{state.targetLabel}</span>\n                    </label>\n                    <input\n                      className=\"input input-bordered input-info w-full max-w-xs\"\n                      onChange={(event) =>\n                        State.update({ target: event.target.value })\n                      }\n                      placeholder=\"Address\"\n                      type=\"text\"\n                      value={state.target}\n                    />\n                  </div>\n                )}\n                {state.action == \"deploy-token\" && (\n                  <div className=\"form-control\">\n                    <label className=\"label\">\n                      <span className=\"label-text\">Name</span>\n                    </label>\n                    <input\n                      className=\"input input-bordered input-info w-full max-w-xs\"\n                      onChange={(event) =>\n                        State.update({ name: event.target.value })\n                      }\n                      placeholder=\"New token name\"\n                      type=\"text\"\n                      value={state.name}\n                    />\n                  </div>\n                )}\n                {state.action == \"deploy-token\" && (\n                  <div className=\"form-control\">\n                    <label className=\"label\">\n                      <span className=\"label-text\">Symbol</span>\n                    </label>\n                    <input\n                      className=\"input input-bordered input-info w-full max-w-xs\"\n                      minLength={3}\n                      maxLength={5}\n                      onChange={(event) =>\n                        State.update({ symbol: event.target.value })\n                      }\n                      placeholder=\"New token symbol\"\n                      type=\"text\"\n                      value={state.symbol}\n                    />\n                    <div className=\"form-control\">\n                      <label className=\"label\">\n                        <span className=\"label-text\">Decimals</span>\n                      </label>\n                      <input\n                        disabled\n                        type=\"number\"\n                        value=\"18\"\n                        placeholder=\"Decimals\"\n                        className=\"input input-bordered input-info w-full max-w-xs\"\n                      />\n                    </div>\n                  </div>\n                )}\n                {!!state.action && (\n                  <div className=\"form-control\">\n                    <label className=\"label\">\n                      <span className=\"label-text\">Time until expiry</span>\n                    </label>\n                    <input\n                      className=\"range range-secondary\"\n                      max=\"172800\"\n                      min=\"0\"\n                      onChange={(event) =>\n                        State.update({ lifetime: Big(event.target.value) })\n                      }\n                      step=\"21600\"\n                      type=\"range\"\n                      value={state.lifetime}\n                    />\n                    <div className=\"w-full flex justify-between text-xs px-2\">\n                      <span>\n                        0<label className=\"absolute ml-4 left-12\">day</label>\n                      </span>\n                      <span>|</span>\n                      <span>\n                        1<label className=\"absolute ml-4 left-51\">day</label>\n                      </span>\n                      <span>|</span>\n                      <span>\n                        2\n                        <label className=\"absolute ml-4 left-100\"> days </label>\n                      </span>\n                    </div>\n                  </div>\n                )}\n                {!!state.action && (\n                  <div className=\"form-control\">\n                    <button\n                      className=\"btn btn-secondary btn-outline\"\n                      onClick={createProposal}\n                    >\n                      Create proposal\n                    </button>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </KeystoneContent>\n  </>\n);\n", "metadata": {"description": "Create keystone proposal for Keystone index", "name": "KSTNAnvil.Proposals.Keystone", "tags": {"bos-gg": ""}}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/coolmouse.near/widget/KSTNAnvil.Proposals.Keystone", "fact_widget_deployments_id": "415d48826edf914589f34371b79b9c8b", "inserted_timestamp": "2023-12-19T11:24:05.250Z", "modified_timestamp": "2023-12-20T03:22:11.422Z", "__row_index": 0}