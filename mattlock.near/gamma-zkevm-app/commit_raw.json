{"tx_hash": "25JWfSXbPyrxkyVCMEmRAt8EchnHHfYdSNkwKRWtpRbk", "action_id_social": "FAFRnNxGwqLEED3FEjMJrdEMrHdzzGyZuaK3Y5JRvMKn-0-widget", "block_id": 97993031, "block_timestamp": "2023-08-03T16:34:57.104Z", "signer_id": "mattlock.near", "widget_name": "gamma-zkevm-app", "source_code": "State.init({\n  activePair: defaultPair,\n  isPoolFetching: false,\n  isUserPositionsFetching: false,\n});\n\nconst sender = Ethers.send(\"eth_requestAccounts\", [])[0];\n\nif (!sender)\n  return (\n    <div\n      style={{\n        display: \"flex\",\n        maxWidth: \"480px\",\n        flexDirection: \"column\",\n        margin: \"auto\",\n      }}\n    >\n      <Web3Connect connectLabel=\"Connect with Web3 to use the app.\" />\n    </div>\n  );\n\nconst { chainId } = Ethers.getNetwork();\nconst chainIdToSwitch = \"0x44D\";\n\nconst switchChain = () => {\n  const zkevmChain = {\n    chainId: \"0x44D\",\n    chainName: \"Polygon zkEVM\",\n    nativeCurrency: {\n      name: \"Ethereum\",\n      symbol: \"ETH\",\n      decimals: 18,\n    },\n    rpcUrls: [\"https://zkevm-rpc.com\"],\n    blockExplorerUrls: [\"https://zkevm.polygonscan.com\"],\n  };\n\n  Ethers.send(\"wallet_addEthereumChain\", [zkevmChain]);\n};\n\nconst SwitchWrapper = styled.div`\n  display: flex;\n  flex-direction: column;\n  background: #1d1e1f;\n  font-family: 'Inter';\n  max-width: 480px;\n  color: #fff;\n  margin: auto;\n  text-align: center;\n  border-radius: 12px;\n  padding: 16px 0;\n  align-items: center;\n  gap: 12px;\n  button {\n    background: #8247E5;\n    border: none;\n    &:hover {\n      background: #8257F5;\n    }\n  }\n`;\n\nif (chainId !== 1101) {\n  return (\n    <SwitchWrapper>\n      <h4>Please switch to Polygon zkEVM</h4>\n      <button onClick={switchChain}>Switch to Polygon zkEVM</button>\n      <p>**Please refresh once after switch chain**</p>\n    </SwitchWrapper>\n  );\n}\n\nconst fetchPoolsData = () => {\n  State.update({\n    isPoolFetching: true,\n  });\n  asyncFetch(\n    \"https://wire2.gamma.xyz/quickswap/polygon-zkevm/hypervisors/allData\"\n  ).then((res) => {\n    if (!res.ok) return;\n\n    State.update({\n      poolsData: res.body,\n      isPoolFetching: false,\n    });\n  });\n};\n\nconst fetchUserData = () => {\n  State.update({\n    isUserPositionsFetching: true,\n  });\n  asyncFetch(\n    `https://wire2.gamma.xyz/quickswap/polygon-zkevm/user/${sender}`\n  ).then((res) => {\n    if (!res.ok) return;\n\n    State.update({\n      userPositions: res.body[sender],\n      isUserPositionsFetching: false,\n    });\n  });\n};\n\nif (state.poolsData === undefined) {\n  fetchPoolsData();\n}\n\nif (sender && state.userPositions === undefined) {\n  fetchUserData();\n}\n\nconst refetch = () => {\n  fetchPoolsData();\n  fetchUserData();\n  console.log(\"refetching\");\n};\n\nconst postRefetch = () => {\n  setTimeout(() => refetch(), 45_000);\n};\n\nconst defaultPair = {\n  id: \"N WETH-USDC\",\n  token0: \"WETH\",\n  token1: \"USDC\",\n  decimals0: 18,\n  decimals1: 6,\n};\n\nconst Wrapper = styled.div`\n    display:flex;\n    align-items: start;\n    justify-content: center;\n    flex-wrap: wrap;\n    gap: 24px;\n`;\nconst VStack = styled.div`\n  display: flex;\n    align-items: start;\n    justify-content: center;\n  flex-direction: column;\n  gap: 4px;\n`;\nconst Button = styled.button`\n    background: #1d1e1f;\n    border-radius: 4px;\n    border: none;\n    max-width: 640px;\n    width: 100%;\n    color: #fff;\n    padding: 8px 0;\n    font-weight: 600;\n    font-size: 14px;\n    position: relative;\n    min-height: 37px;\n    margin: auto;\n    &:hover {\n      background: #2b2a2b;\n    }\n    &:disabled {\n      background: #333;\n      color: #ccc;\n    }\n`;\n\nconst handlePairClick = (pair) => {\n  State.update({\n    activePair: pair,\n  });\n};\n\nconst {\n  activePair,\n  poolsData,\n  userPositions,\n  isPoolFetching,\n  isUserPositionsFetching,\n} = state;\n\nreturn (\n  <VStack>\n    <Button\n      disabled={isPoolFetching || isUserPositionsFetching}\n      onClick={refetch}\n    >\n      {isPoolFetching || isUserPositionsFetching\n        ? \"Fetching Table Data...\"\n        : \"Refresh\"}\n    </Button>\n    <Wrapper>\n      <Widget\n        src=\"mattlock.near/widget/gamma-zkevm-table\"\n        props={{ handlePairClick, poolsData, userPositions }}\n      />\n\n      <Widget\n        src=\"james-cordova423.near/widget/gamma-zkevm-vault\"\n        props={{ pair: activePair, refetch: postRefetch }}\n      />\n    </Wrapper>\n  </VStack>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/mattlock.near/widget/gamma-zkevm-app", "fact_widget_deployments_id": "f7e400f865572145552690c540f11059", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}