{"tx_hash": "2TdYUwypPjagB2qPFEte8PG2rUcmXTasRsyKSaNfxBCN", "action_id_social": "ATKGmbPtcq3BorjFAc3uHXWtuacSwyjpAJrp6vKuik9B-0-widget", "block_id": 98518310, "block_timestamp": "2023-08-10T21:37:13.566Z", "signer_id": "mattlock.near", "widget_name": "op-bridge-demo", "source_code": "State.init({ console: \"Welcome!\" });\n// for goerli\nconst OP_BRIDGE_DEPOSIT_CONTRACT = \"0x636Af16bf2f682dD3109e60102b8E1A089FedAa8\";\nconst OP_BRIDGE_WITHDRAW_CONTRACT =\n  \"0x4200000000000000000000000000000000000010\";\nconst ETH_ADDR = \"0x0000000000000000000000000000000000000000\";\nconst ETH_ADDR_L1 = `0xdeaddeaddeaddeaddeaddeaddeaddeaddead0000`;\nconst DEFAULT_AMOUNT = ethers.utils.parseUnits(\"0.05\", 18);\n\nconst provider = Ethers.provider();\nconst sender = Ethers.send(\"eth_requestAccounts\", [])[0];\n\nconst { chainId } = state;\n\nif (sender) {\n  Ethers.provider()\n    .getNetwork()\n    .then(({ chainId }) => {\n      State.update({ chainId });\n    });\n}\n\nconst isMainnet = chainId === 1 || chainId === 10;\nconst isOPGoerli = chainId === 420;\nconst isGoerli = chainId === 5;\n\nconst bridgeAbi = [\n  {\n    inputs: [\n      { internalType: \"uint32\", name: \"_l2Gas\", type: \"uint32\" },\n      { internalType: \"bytes\", name: \"_data\", type: \"bytes\" },\n    ],\n    name: \"depositETH\",\n    outputs: [],\n    stateMutability: \"payable\",\n    type: \"function\",\n  },\n  {\n    anonymous: false,\n    inputs: [\n      {\n        indexed: true,\n        internalType: \"address\",\n        name: \"from\",\n        type: \"address\",\n      },\n      {\n        indexed: true,\n        internalType: \"address\",\n        name: \"to\",\n        type: \"address\",\n      },\n      {\n        indexed: false,\n        internalType: \"uint256\",\n        name: \"amount\",\n        type: \"uint256\",\n      },\n      {\n        indexed: false,\n        internalType: \"bytes\",\n        name: \"extraData\",\n        type: \"bytes\",\n      },\n    ],\n    name: \"ETHDepositInitiated\",\n    type: \"event\",\n  },\n];\nconst bridgeIface = new ethers.utils.Interface(bridgeAbi);\n\nconst withdrawAbi = [\n  {\n    inputs: [\n      {\n        internalType: \"address\",\n        name: \"_l2Token\",\n        type: \"address\",\n      },\n      {\n        internalType: \"uint256\",\n        name: \"_amount\",\n        type: \"uint256\",\n      },\n      {\n        internalType: \"uint32\",\n        name: \"_minGasLimit\",\n        type: \"uint32\",\n      },\n      {\n        internalType: \"bytes\",\n        name: \"_extraData\",\n        type: \"bytes\",\n      },\n    ],\n    name: \"withdraw\",\n    outputs: [],\n    stateMutability: \"payable\",\n    type: \"function\",\n  },\n];\nconst withdrawIface = new ethers.utils.Interface(withdrawAbi);\n\nfunction getDeposits() {\n  console.log(\"getDeposits\");\n  if (!isGoerli)\n    return State.update({\n      console: `Switch to ETH Goerli to see your deposits`,\n    });\n  const bridgeContract = new ethers.Contract(\n    OP_BRIDGE_DEPOSIT_CONTRACT,\n    bridgeAbi,\n    Ethers.provider().getSigner()\n  );\n\n  bridgeContract\n    .queryFilter(bridgeContract.filters.ETHDepositInitiated(sender))\n    .then((events) => {\n      console.log(events);\n      State.update({\n        deposits: JSON.stringify(\n          events.map(({ transactionHash }) => transactionHash)\n        ),\n      });\n      events.forEach((ev) => {\n        ev.getTransaction().then((tx) => console.log(\"tx\", tx));\n        ev.getTransactionReceipt().then((tx) => console.log(\"txr\", tx));\n      });\n    });\n}\n\nfunction handleDepositETH() {\n  if (!isGoerli)\n    return State.update({\n      console: `switch to Goerli Testnet (not Optimism Goerli, ETH Goerli) to deposit ETH to OP Goerli`,\n    });\n\n  const encodedData = bridgeIface.encodeFunctionData(\n    \"depositETH(uint32, bytes)\",\n    [200000, 0]\n  );\n\n  Ethers.provider()\n    .getSigner()\n    .sendTransaction({\n      to: OP_BRIDGE_DEPOSIT_CONTRACT,\n      data: encodedData,\n      value: DEFAULT_AMOUNT,\n      gasLimit,\n    })\n    .then((tx) => {\n      consle.log(\"tx:\", tx);\n    })\n    .catch((e) => {\n      console.log(\"bridge error:\", e);\n    });\n}\n\nfunction handleWithdrawInitiating() {\n  if (!isOPGoerli)\n    return State.update({\n      console: `switch to OP Goerli testnet to initiate a withdrawal transaction`,\n    });\n\n  console.log(\"withdraw\");\n\n  const encodedData = withdrawIface.encodeFunctionData(\n    \"withdraw(address, uint256, uint32, bytes)\",\n    [ETH_ADDR_L1, DEFAULT_AMOUNT, 0, []]\n  );\n\n  console.log(\"encoded\");\n\n  Ethers.provider()\n    .getSigner()\n    .sendTransaction({\n      to: OP_BRIDGE_WITHDRAW_CONTRACT,\n      data: encodedData,\n      value: DEFAULT_AMOUNT,\n      gasLimit,\n    })\n    .then((tx) => {\n      consle.log(\"tx:\", tx);\n    })\n    .catch((e) => {\n      console.log(\"bridge error:\", e);\n    });\n}\n\nif (!sender) {\n  return (\n    <div className=\"w3button\">\n      <Web3Connect connectLabel=\"Connect to a wallet\" />\n    </div>\n  );\n}\n\nreturn (\n  <div>\n    <h3>Console:</h3>\n    <p>{state.console}</p>\n    {isGoerli && (\n      <>\n        <h3>Deposits:</h3>\n        <Widget src={`ciocan.near/widget/op-bridge-list`} />\n        <button onClick={handleDepositETH}>Deposit 0.05 ETH to L2</button>\n        <br />\n        <br />\n        <p>To withdraw, switch to OP Goerli network</p>\n      </>\n    )}\n    {isOPGoerli && (\n      <>\n        <button onClick={handleWithdrawInitiating}>\n          Withdraw 0.05 ETH on L2\n        </button>\n        <br />\n        <br />\n        <p>To withdraw, switch to ETH Goerli network</p>\n      </>\n    )}\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/mattlock.near/widget/op-bridge-demo", "fact_widget_deployments_id": "33d1d74207b398f1ca51d55e7dac4195", "inserted_timestamp": "2023-08-10T22:43:54.670Z", "modified_timestamp": "2023-08-10T22:43:54.670Z", "__row_index": 1}