{"tx_hash": "2DPSbkmgJMFDJBDkG98CHCCX4brLY1nxWwyFUBpFYEtT", "action_id_social": "CvamVbW3cGPpMz4knMw8mtPpdUa5QNvszD96PHKHY4D6-0-widget", "block_id": 98811970, "block_timestamp": "2023-08-14T21:18:04.561Z", "signer_id": "y3k.near", "widget_name": "near_atlas.components.react_charts.MonthlyActiveAcounts", "source_code": "let raw_data = fetch(\n  \"https://api.flipsidecrypto.com/api/v2/queries/c493c7b1-cfcc-4aee-ad79-869b4ed8ca90/data/latest\",\n  {\n    subscribe: true,\n    method: \"GET\",\n    headers: {\n      Accept: \"*/*\",\n    },\n  }\n);\n\nconst r_data = raw_data.body || [];\n\nconst sortedData = r_data.sort((a, b) => {\n  return new Date(a[\"DAY\"]) - new Date(b[\"DAY\"]);\n});\n\nconst series1 = {\n  label: \"RETURNING_MAAS\",\n  data: sortedData.map((item) => {\n    const date = new Date(item.DAY);\n    const month = date.toLocaleString(\"default\", { month: \"long\" });\n    const year = date.getFullYear();\n    return {\n      primary: date.toLocaleString(\"default\"),\n      secondary: Number(item.RETURNING_MAAS),\n    };\n  }),\n};\n\nconst series2 = {\n  label: \"NEW_MAAS\",\n  data: sortedData.map((item) => {\n    const date = new Date(item.DAY);\n    const month = date.toLocaleString(\"default\", { month: \"long\" });\n    const year = date.getFullYear();\n    return {\n      primary: date.toLocaleString(\"default\"),\n      secondary: Number(item.NEW_MAAS),\n    };\n  }),\n};\n\nfunction getWeekLabel(d) {\n  // Convert the date string to a date object\n  const date = new Date(d);\n\n  // Calculate the week number\n  const startOfYear = new Date(date.getFullYear(), 0, 1);\n  const weekNumber = Math.ceil(\n    ((date - startOfYear) / 86400000 + startOfYear.getDay() + 1) / 7\n  );\n\n  // Create the week label\n  const weekLabel = `Week ${weekNumber}`;\n\n  return weekLabel;\n}\n\nconst primaryAxis = {\n  type: \"time\",\n  tickFormat: getWeekLabel,\n  stacked: true,\n  getValue: (datum) => datum.primary,\n};\n\nconst secondaryAxes = [\n  {\n    // position: \"top\",\n    // show: false,\n    getValue: (datum) => datum.secondary,\n    stacked: true,\n    type: \"linear\",\n  },\n];\n\nconst output = [series2, series1];\n\nreturn (\n  <div>\n    <ReactChart\n      chart_name=\"BarCustom\"\n      data={output}\n      options={{\n        secondaryAxes: secondaryAxes,\n        primaryAxis: primaryAxis,\n        minHeight: \"600px\",\n      }}\n    />\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/y3k.near/widget/near_atlas.components.react_charts.MonthlyActiveAcounts", "fact_widget_deployments_id": "fb26736aef9547a2b713fe8f47b628d4", "inserted_timestamp": "2023-08-14T22:41:30.872Z", "modified_timestamp": "2023-08-14T22:41:30.872Z", "__row_index": 16}