{"tx_hash": "AJbfpAFuQ8PxBk6SMPh962M7SRbnBvne6FaXozCdkNjL", "action_id_social": "CvxVAfXiL4eKzzU3x4kb7n4ZzhrMo9on2APhXBBBMT5K-0-widget", "block_id": 109908042, "block_timestamp": "2024-01-08T15:03:58.202Z", "signer_id": "y3k.near", "widget_name": "near_atlas.components.MainChainActiveAcounts", "source_code": "let near_raw_data = fetch(\n  \"https://api.flipsidecrypto.com/api/v2/queries/dd943572-4890-4bbf-a566-91cbf49e3dc2/data/latest\",\n  {\n    subscribe: true,\n    method: \"GET\",\n    headers: {\n      Accept: \"*/*\",\n    },\n  }\n);\n\nlet aurora_raw_data = fetch(\n  \"https://api.flipsidecrypto.com/api/v2/queries/ece24566-9ae2-44b3-9530-05693a8c0b3e/data/latest\",\n  {\n    subscribe: true,\n    method: \"GET\",\n    headers: {\n      Accept: \"*/*\",\n    },\n  }\n);\n\nconst initialState = {\n  selectedDateRange: \"1Y\",\n  near_raw_data: [],\n  aurora_raw_data: [],\n};\n\nstate = State.init(initialState);\n\nconst handleDateRangeChange = (range) => {\n  State.update({\n    selectedDateRange: range,\n  });\n};\n\nconst near_data = near_raw_data.body || [];\n\nconst aurora_data = aurora_raw_data.body || [];\n\nState.update({ near_raw_data: near_data, aurora_raw_data: aurora_data });\n\nlet Style = styled.div`\n                `;\n\nconst processData = (raw_data, dateRange) => {\n  const endDate = new Date();\n  let startDate = new Date();\n\n  switch (dateRange) {\n    case \"1M\":\n      startDate.setMonth(endDate.getMonth() - 1);\n      break;\n    case \"3M\":\n      startDate.setMonth(endDate.getMonth() - 3);\n      break;\n    case \"YTD\":\n      startDate = new Date(endDate.getFullYear(), 0, 1); // start of the year\n      break;\n    case \"1Y\":\n      startDate.setFullYear(endDate.getFullYear() - 1);\n      break;\n    case \"3Y\":\n      startDate.setFullYear(endDate.getFullYear() - 3);\n      break;\n  }\n\n  const processedData = raw_data.filter((entry) => {\n    const entryDate = new Date(entry[\"DAY\"]);\n    return entryDate >= startDate && entryDate <= endDate;\n  });\n\n  // Sort the processed data by date\n  return processedData.sort((a, b) => new Date(a[\"DAY\"]) - new Date(b[\"DAY\"]));\n};\n\nconst dataToDisplayNEAR = processData(\n  state.near_raw_data,\n  state.selectedDateRange\n);\nconst dataToDisplayAURORA = processData(\n  state.aurora_raw_data,\n  state.selectedDateRange\n);\n\nconst dates = dataToDisplayNEAR.map((entry) => entry[\"DAY\"]);\n\nconst NEAR_MAAS = {};\nconst AURORA_MAAS = {};\n\ndataToDisplayNEAR.forEach((entry) => {\n  NEAR_MAAS[entry[\"DAY\"]] = entry[\"MAA\"];\n});\n\ndataToDisplayAURORA.forEach((entry) => {\n  AURORA_MAAS[entry[\"DAY\"]] = entry[\"MAA\"];\n});\n\nconst stacked_options = {\n  maintainAspectRatio: true,\n  plugins: {\n    legend: {\n      display: true,\n      position: \"bottom\",\n    },\n  },\n  scales: {\n    y: {\n      stacked: true,\n      grid: {\n        color: \"rgb(41,51,64)\", // This will change the gridline color\n        borderColor: \"rgb(240,255,240)\",\n      },\n      ticks: {\n        color: \"rgb(240,255,240)\", // This will change the axis text label color\n      },\n    },\n    x: {\n      stacked: true,\n      grid: {\n        color: \"rgb(41,51,64)\", // This will change the gridline color\n      },\n      ticks: {\n        color: \"rgb(240,255,240)\", // This will change the axis text label color\n      },\n    },\n  },\n};\n\nconst stacked_bar_data = {\n  dates,\n  datasets: [\n    {\n      label: \"NEAR MAAs\",\n      data: NEAR_MAAS,\n      backgroundColor: \"rgb(250,164,58)\",\n    },\n    {\n      label: \"AURORA MAAs\",\n      data: AURORA_MAAS,\n      backgroundColor: \"rgb(13,131,171)\",\n    },\n  ],\n};\n\nreturn (\n  <Style>\n    <div className=\"relative text-bg-dark rounded-4 p-3 mb-4\">\n      <div className=\"absolute top-0 right-0 flex space-x-2 p-3\">\n        {[\"1M\", \"3M\", \"YTD\", \"1Y\", \"3Y\"].map((range) => (\n          <button\n            key={range}\n            onClick={() => handleDateRangeChange(range)}\n            className={`px-3 py-1 rounded transition-colors duration-200 ease-in ${\n              state.selectedDateRange === range\n                ? \"bg-blue-500 text-white\"\n                : \"bg-gray-800 text-gray-400 hover:bg-gray-700\"\n            }`}\n          >\n            {range}\n          </button>\n        ))}\n        <button className=\"px-3 py-1 rounded transition-colors duration-200 ease-in bg-gray-800 text-gray-400 hover:bg-gray-700\">\n          <a\n            href=\"https://api.flipsidecrypto.com/api/v2/queries/c493c7b1-cfcc-4aee-ad79-869b4ed8ca90/data/latest\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            className=\"text-red-50 whitespace-normal break-words block max-w-xs\"\n          >\n            <svg\n              xmlns=\"http://www.w3.org/2000/svg\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              strokeWidth={1.5}\n              stroke=\"currentColor\"\n              className=\"w-6 h-6\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                d=\"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3\"\n              />\n            </svg>\n          </a>\n        </button>\n      </div>\n      <div className=\"rounded-4 p-3 mb-4 pt-16\">\n        {\" \"}\n        {data !== null ? (\n          <div>\n            <BarEl options={stacked_options} data={stacked_bar_data} />\n          </div>\n        ) : (\n          <div>Loading ...</div>\n        )}\n      </div>\n    </div>\n  </Style>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/y3k.near/widget/near_atlas.components.MainChainActiveAcounts", "fact_widget_deployments_id": "f425746575addf128ebe308b6875da86", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}