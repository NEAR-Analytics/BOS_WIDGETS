{"tx_hash": "CP31JTCSvN7JJt67idteHz2H5EtPZeudjdwDCpW1rUdw", "action_id_social": "5e5SVHYJ6wNCvnD7DwUyYSXzEg8PoCLCZ3GSyxor5cZ4-0-widget", "block_id": 100862723, "block_timestamp": "2023-09-11T05:44:52.456Z", "signer_id": "juaner.near", "widget_name": "MetaPool.StakeNearButton", "source_code": "const StakeButton = styled.button`\n  background-color: #c7ff18;\n  width: 100%;\n  height: 60px;\n  border-radius: 8px;\n  color: #000;\n  font-size: 18px;\n  font-weight: 500;\n  border: none;\n  transition: 0.5s;\n\n  &:disabled {\n    opacity: 0.5;\n  }\n  @media (max-width: 768px) {\n    height: 40px;\n    font-size: 16px;\n  }\n`;\n\nconst {\n  disabled,\n  amount,\n  lpToken,\n  stakeType,\n  stakedBalance,\n  contractId,\n  stnearPriceUsd,\n  onSuccess,\n} = props;\n\nconst accountId = context.accountId;\nState.init({\n  loading: false,\n});\n\nconst stakeNear = () => {\n  State.update({\n    loading: true,\n  });\n  try {\n    const txs = [\n      {\n        contractName: contractId,\n        methodName: \"deposit_and_stake\",\n        deposit: ethers.utils.parseUnits(amount, 24).toString(),\n        args: {},\n      },\n    ];\n    if (Big(stakedBalance || 0).eq(0)) {\n      txs.push({\n        contractName: contractId,\n        methodName: \"ft_balance_of\",\n        args: {\n          account_id: accountId,\n        },\n      });\n    }\n    Near.call(txs);\n    onSuccess?.();\n  } finally {\n    State.update({\n      loading: false,\n    });\n  }\n};\nconst unstakeNearFastly = () => {\n  State.update({\n    loading: true,\n  });\n  const ONE_NEAR = new BN(\"1\" + \"0\".repeat(24));\n  const l = Big(amount).mul(Big(10).pow(24)).toFixed(0);\n  const e = l.mul(stnearPriceUsd);\n  Near.call([\n    {\n      contractName: contractId,\n      methodName: \"liquid_unstake\",\n      deposit: 0,\n      args: {\n        st_near_to_burn: l.toFixed(0),\n        min_expected_near: e.sub(ONE_NEAR.divn(10)).toFixed(0),\n      },\n    },\n  ]);\n\n  onSuccess?.();\n  State.update({\n    loading: false,\n  });\n};\nconst unstakeNearDelay = () => {\n  State.update({\n    loading: true,\n  });\n  Near.call([\n    {\n      contractName: contractId,\n      methodName: \"unstake\",\n      args: {\n        amount: Big(ethers.utils.parseUnits(amount, 24)).toFixed(0),\n      },\n    },\n  ]);\n  State.update({\n    loading: false,\n  });\n};\n\nconst handleClick = () => {\n  if (stakeType === 0) {\n    stakeNear();\n    return;\n  }\n  if (stakeType === 1) {\n    unstakeNearFastly();\n    return;\n  }\n  if (stakeType === 2) {\n    unstakeNearDelay();\n    return;\n  }\n};\n\nreturn (\n  <>\n    <StakeButton disabled={disabled} onClick={handleClick}>\n      {state.loading ? \"Wait...\" : stakeType ? \"Unstake\" : \"Stake Now\"}\n    </StakeButton>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/juaner.near/widget/MetaPool.StakeNearButton", "fact_widget_deployments_id": "6cdf97b90779cca109529c311e39444a", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 1}