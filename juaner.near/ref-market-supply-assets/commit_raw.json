{"tx_hash": "y2VRuwVhz2adcZuZjpScMzqtDhfryzbBX4TKePnJ1zg", "action_id_social": "DM4P9Y4syKisBXfMZo1nrKyMv3xD7CjvSdzbY7skX7Ub-0-widget", "block_id": 100578962, "block_timestamp": "2023-09-07T09:01:48.035Z", "signer_id": "juaner.near", "widget_name": "ref-market-supply-assets", "source_code": "const Container = styled.div`\n  background-color: #25283a;\n  border-radius: 12px;\n  .template {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-left: 6px;\n  }\n  .assets_table {\n    display: block;\n    width: 100%;\n    tr {\n      color: #7c7f96;\n      border: none;\n      height: 50px;\n    }\n    th,\n    td {\n      border: none;\n      font-size: 14px;\n    }\n    td {\n      color: #fff;\n    }\n    th:first-child,\n    td:first-child {\n      padding-left: 20px;\n      min-width: 160px;\n    }\n    th:nth-child(5) {\n      min-width: 120px;\n    }\n    tbody {\n      .table_handlers div {\n        background-color: rgba(0, 255, 163, 0.6);\n        transition: 0.5s;\n      }\n      tr:hover {\n        background-color: #373a53;\n        border-radius: 12px;\n        .table_handlers div {\n          background-color: #00ffa3;\n        }\n      }\n      tr:last-child td:first-child {\n        border-bottom-left-radius: 12px;\n      }\n      tr:last-child td:last-child {\n        border-bottom-right-radius: 12px;\n      }\n    }\n    .table_handlers {\n      display: flex;\n      justify-content: end;\n      align-items: center;\n      padding-right: 10px;\n    }\n  }\n\n  .tokenIcon {\n    width: 26px;\n    height: 26px;\n    border-radius: 100px;\n    margin-right: 8px;\n  }\n  .rewardIcon {\n    width: 16px;\n    height: 16px;\n    border-radius: 100px;\n  }\n  .text_green_color {\n    color: #78ff9e;\n  }\n  .ml_4_ne {\n    margin-left: -4px;\n  }\n  .mt_25 {\n    margin-top: 25px;\n  }\n  .mt-10 {\n    margin-top: 10px;\n  }\n  .font-18 {\n    font-size: 18px;\n  }\n  .title {\n    padding-left: 20px;\n  }\n  @media (max-width: 900px) {\n    background-color: transparent;\n    .assets_table {\n      display: none;\n    }\n    .text_green_color {\n      color: #fff;\n    }\n  }\n`;\n\n/** base tool start  */\nconst wnearbase64 =\n  \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAABmJLR0QA/wD/AP+gvaeTAAADvElEQVRYhbWYTUtjVxjH/9fRaFBaK3Q0ahCE3HTR0kWLL0g72nEh6NaAL+BivkIXHUpblWr9Ai78CIKgQqC1xYJNVnWwdiFCF9OS4CRRM2o7TRyw+XWRJk2uebuJ/uFC7jnP89xfzrnPOee5hmwIqJc0LOmxpA8keSW1SnpD0p+SLiT9JumZpF1Je4Zh3Nh5RiUQHcAKEMWeov/5td8FRBPwFZCwCWFVAvgCaKwWxAsc1ghh1RHwrl2QR8DlHYNk9BcwWinIMJC8J5CMEsDH5UDeAa7uGSSjC8DMfb6RA9Ik6WdJ79ma09r0q6R+wzBeS1JdTsdnhUACgYA8Ho8cDofGx8d1fn5u62mrq6tyuVwyTVPBYNDa/b6kT/NaSK8jBdPX4/EgKXsNDQ1xfX1d0Tz4/f48X9M0C5n9DTzMhVkpFjA3WOaam5srCxKPx+ns7LzlW0TLGZB6IGIHRhIrK0X5AZiZmSnoV0RRoF7AaKmguYFmZ2ezv+vq6tja2iros7m5iSSamppYWlqqBAZgRMA3lcJEo1Gmpqay9y0tLRwe5i/SZ2dntLe309bWxt7eHuFwuFKYrwX8UClMLBYjkUjQ19eXbevp6SEa/X//9Pl89Pb2cnx8DGAH5jsBf9iBATg5OaGrqyvbPjg4SDKZJBQKMTo6yunpadbfBsxzkd4rbMEAHBwc0NzcnO3z+XykUqlb/jZgrgTcVAMDsLGxgWEY2f7l5eVaYG6qHpmM5ufns/2GYbC+vl4tzJWA32uBSaVSTE9PZ22cTif7+/vVwDwX8H01MJFIhJGRESKRyK0Mc7vdRCIRuzDf1il9eLalo6MjDQwMqLu7Wx0dHXI6ndre3pbb7ZYkhcNhTUxMKJFI2An7TMBjOyOzu7tLa2srLpeLeDyeZ2vNsMnJSUKhUKUjM2xrb1pYWMDhcCAJv99f0N6aYdY9qoheAA8k2d+1nzx5Uuofsri4WHSDLaKl7GQB7RQ5z1iDud1uLi9Ln9WtGVYG5hXwdt7bA3xZyNI0zbx1ZGdnpyRIRslkkv7+/jwQr9dbyPTprVcZaKRAnRQIBDBNE5fLxdraWkUgGcViMcbGxmhoaMDr9RIMBq0mB4CjYG6RLtzuq16y6iXgKZnspAu4WsvZckoAH5UEyQEaAM7vCeSCcgVcASAT+OWOQQ4oNzUlgBqBz0mXE7XoFfCUYi+rTaiHwDLpldKOXgBLWNeRIjLKm+RBPZD0SNInkj5U+svVW5LelHQl6aXSX672Jf0o6SfDMP6pNP6/QZPF1Du0/sIAAAAASUVORK5CYII=\";\nconst closeButtonBase64 =\n  \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAACXBIWXMAACE4AAAhOAFFljFgAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAERSURBVHgBtdjLDYMwEEXRUSqhY+gg0xElUAIlvOAAwkEEPJ93JVaM47OJsCyyBaBbnhFrvZAreyzPvDxT2fv8stte1L2FVPnt014H6g+GhrrA/KJuMOmoG8zeWIZmPBdGNWC+lcEBbblRrZhi2Rdo4wIzyoDR88J0lBvDQIUxmag0TAYqHRNB0TAeFNgYB4qPSUapZBZEqTByolSYGVEqxl5iD6RZe2j/a9dxTp5ODAcVxOSikjA5KANGQTzkmTHVGg4KgQ9lOgoJX+00FBKPEGEUCOcZNwrEw5UZhfUWgoJxoHppHFQJ1oiay+DIxhhQ09N1jEpyN6gJD3dEKqQuUAemGtpR5XpmEHI4bl3GGvMBHUHk6KgoFgEAAAAASUVORK5CYII=\";\nlet MAX_RATIO = 10_000;\nlet BURROW_CONTRACT = \"contract.main.burrow.near\";\nlet accountId = context.accountId;\nlet B = Big();\nB.DP = 60; // set precision to 60 decimals\n\nState.init({ tableData: [] });\n\nconst toAPY = (v) => (v ? (Math.round(v * 100) / 100).toFixed(2) : 0);\nconst clone = (o) => JSON.parse(JSON.stringify(o));\nconst shrinkToken = (value, decimals) => {\n  return B(value).div(B(10).pow(decimals || 0));\n};\n\nconst expandToken = (value, decimals) => {\n  return B(value || 0).mul(B(10).pow(decimals || 0));\n};\n\nconst formatToken = (v) => Math.floor(v * 10_000) / 10_000;\n\nconst power = (x, y) => {\n  if (y === 0) {\n    return 1;\n  } else if (y % 2 === 0) {\n    return power(x, parseInt(y / 2)) * power(x, parseInt(y / 2));\n  } else {\n    return x * power(x, parseInt(y / 2)) * power(x, parseInt(y / 2));\n  }\n};\nconst nFormat = (num, digits) => {\n  const lookup = [\n    { value: 1, symbol: \"\" },\n    { value: 1e3, symbol: \"K\" },\n    { value: 1e6, symbol: \"M\" },\n  ];\n  var item = lookup\n    .slice()\n    .reverse()\n    .find((item) => num >= item.value);\n  return item ? (num / item.value).toFixed(digits) + item.symbol : \"0\";\n};\nconst {\n  rewards,\n  account,\n  balances,\n  selectedTokenId,\n  amount,\n  hasError,\n  assets,\n  tabName,\n  showModal,\n} = state;\nconst hasData = assets.length > 0 && rewards.length > 0 && account;\n/** base tool end */\n// if (!accountId) {\n//   return <Widget src=\"juaner.near/widget/ref_account-signin\" />;\n// }\n\nconst config = Near.view(BURROW_CONTRACT, \"get_config\");\nconst formatAssets = (data) => {\n  const rewardsMap = data.rewards\n    ? data.rewards.reduce((acc, cur) => {\n        return {\n          ...acc,\n          [cur.token_id]: cur,\n        };\n      }, {})\n    : {};\n  const assetsMap = data.assets\n    ? data.assets.reduce((acc, cur) => {\n        return {\n          ...acc,\n          [cur.token_id]: cur,\n        };\n      }, {})\n    : {};\n\n  const _assets = data.assets\n    .filter(\n      (a) => a.config.can_deposit && ![\"meta-token.near\"].includes(a.token_id)\n    )\n    .map((asset) => {\n      const { token_id, metadata, price, config } = asset;\n      const r = data.rewards.find((a) => a.token_id === asset.token_id);\n      const netTvlMultiplier = config.net_tvl_multiplier / 10000;\n      const depositApy =\n        r.apyBase + r.apyRewardTvl * netTvlMultiplier + r.apyReward;\n      const hasRewards = rewardsMap[token_id] && assetsMap[token_id];\n      const rewardMap = hasRewards && rewardsMap[token_id];\n      const rewardTokens = rewardMap && rewardMap.rewardTokens;\n      const token_usd_price = price && price.usd;\n      const { volatility_ratio, extra_decimals } = config;\n      const totalLiquidity = B(asset.supplied.balance || 0)\n        .plus(asset.reserved)\n        .toFixed();\n      const decimals = metadata.decimals + extra_decimals;\n      const totalLiquidity_shrink = shrinkToken(totalLiquidity, decimals);\n\n      const totalLiquidity_usd = B(totalLiquidity_shrink || 0)\n        .mul(token_usd_price || 0)\n        .toNumber();\n      return {\n        icon: metadata.icon,\n        symbol: metadata.symbol,\n        depositApy,\n        rewardTokens,\n        volatility_ratio,\n        totalLiquidity_usd,\n        token_id,\n      };\n    });\n  if (!state.activeArrow) {\n    State.update({\n      activeArrow: \"up-totalLiquidity_usd\",\n    });\n    return _assets.sort((a, b) => b.totalLiquidity_usd - a.totalLiquidity_usd);\n  } else {\n    const [type, key] = state.activeArrow.split(\"-\");\n    return _assets.sort((a, b) =>\n      type === \"down\" ? a[key] - b[key] : b[key] - a[key]\n    );\n  }\n};\n\nconst onLoad = (data) => {\n  State.update(data);\n  // get market can deposit assets\n  if (data.assets?.length) State.update({ tableData: formatAssets(data) });\n};\n\nconst assetsMap = assets\n  ? assets.reduce((acc, cur) => {\n      return {\n        ...acc,\n        [cur.token_id]: cur,\n      };\n    }, {})\n  : {};\n\nconst renderAssets = (data) =>\n  data.map((record) => {\n    const {\n      icon,\n      symbol,\n      depositApy,\n      rewardTokens,\n      volatility_ratio,\n      token_id,\n      totalLiquidity_usd,\n    } = record;\n\n    const rewardTokensImg =\n      rewardTokens &&\n      rewardTokens.map((token_id, index) => {\n        const metadata = assetsMap[token_id].metadata;\n        return (\n          <img\n            class={`rewardIcon ${index > 0 ? \"ml_4_ne\" : \"\"}`}\n            src={metadata.icon}\n          ></img>\n        );\n      });\n\n    const cf = volatility_ratio / 100;\n    const totalLiquidity_usd_display = nFormat(totalLiquidity_usd, 2);\n    return (\n      <tr key={token_id}>\n        <td>\n          <img src={icon || wnearbase64} class=\"tokenIcon\"></img>\n          {symbol !== \"wNEAR\" ? symbol : \"NEAR\"}\n        </td>\n        <td>{toAPY(depositApy)}%</td>\n        <td>{rewardTokensImg}</td>\n        <td>{cf}%</td>\n        <td>${totalLiquidity_usd_display}</td>\n        <td>\n          <div class=\"table_handlers\">\n            <Widget\n              src=\"juaner.near/widget/ref-operation-button\"\n              props={{\n                clickEvent: () => {\n                  handleSelect(token_id);\n                },\n                buttonType: \"solid\",\n                actionName: \"Supply\",\n                hoverOn: true,\n              }}\n            />\n          </div>\n        </td>\n      </tr>\n    );\n  });\n\nconst renderMbAssets = (data, hasDollar) =>\n  data.map((item) => {\n    const {\n      icon,\n      symbol,\n      depositApy,\n      rewardTokens,\n      volatility_ratio,\n      token_id,\n      totalLiquidity_usd,\n    } = item;\n    const rewardTokensImg =\n      rewardTokens &&\n      rewardTokens.map((token_id, index) => {\n        const metadata = assetsMap[token_id].metadata;\n        return (\n          <img\n            class={`rewardIcon ${index > 0 ? \"ml_4_ne\" : \"\"}`}\n            src={metadata.icon}\n          ></img>\n        );\n      });\n\n    const cf = volatility_ratio / 100;\n    const totalLiquidity_usd_display = nFormat(totalLiquidity_usd, 2);\n    return (\n      <div className=\"mb_row\" key={token_id}>\n        <div className=\"mb_row_header\">\n          <div className=\"mb_row_token\">\n            <img src={icon || wnearbase64} class=\"tokenIcon\"></img>\n            {symbol !== \"wNEAR\" ? symbol : \"NEAR\"}\n          </div>\n          <div className=\"double_lines\">${totalLiquidity_usd_display}</div>\n        </div>\n        <div className=\"mb_row_item\">\n          <div className=\"mb_row_label\">Supply Apy</div>\n          <div className=\"mb_row_value\">{toAPY(depositApy)}%</div>\n        </div>\n        <div className=\"mb_row_item\">\n          <div className=\"mb_row_label\">Rewards</div>\n          <div className=\"mb_row_value\">{rewardTokensImg}</div>\n        </div>\n        <div className=\"mb_row_item\">\n          <div className=\"mb_row_label\">C.F.</div>\n          <div className=\"mb_row_value\">{cf}%</div>\n        </div>\n        <div className=\"mb_row_actions\">\n          <div className=\"action_btn\">\n            <Widget\n              src=\"juaner.near/widget/ref-operation-button\"\n              props={{\n                clickEvent: () => {\n                  handleSelect(token_id);\n                },\n                buttonType: \"solid\",\n                actionName: \"Supply\",\n                hoverOn: true,\n              }}\n            />\n          </div>\n        </div>\n      </div>\n    );\n  });\n\nconst handleSelect = (token_id) => {\n  State.update({\n    selectedTokenId: token_id,\n    amount: \"\",\n    hasError: false,\n    showModal: true,\n  });\n};\nfunction closeModal() {\n  State.update({\n    showModal: false,\n  });\n}\nconst selectedToken = (selectedTokenId && assetsMap[selectedTokenId]) || {};\nconst selectedTokenMeta = selectedToken.metadata || {};\n\nconst handleSort = (type, key) => {\n  if (!state.tableData.length) return;\n  State.update({\n    tableData: state.tableData.sort((a, b) =>\n      type === \"down\" ? a[key] - b[key] : b[key] - a[key]\n    ),\n    activeArrow: `${type}-${key}`,\n  });\n};\n\nreturn (\n  <Container>\n    {/* load data */}\n    {!hasData && (\n      <Widget src=\"juaner.near/widget/ref_burrow-data\" props={{ onLoad }} />\n    )}\n\n    {/* markets */}\n    <div class=\"fw-bold text-white pt-3 font-18 title\">\n      <span class=\"text_green_color\">Supply</span> Market\n    </div>\n    <table class=\"assets_table click\" border=\"0\">\n      <thead>\n        <tr>\n          <th scope=\"col\" width=\"20%\">\n            Assets\n          </th>\n          <th scope=\"col\" width=\"15%\">\n            <div className=\"table_sorter\">\n              <span>APY</span>\n              <div className=\"arrows\">\n                <div className=\"arrow-wrap\">\n                  <div\n                    className={`arrow arrow-up ${\n                      state.activeArrow === \"up-depositApy\" && \"active\"\n                    }`}\n                    onClick={() => {\n                      handleSort(\"up\", \"depositApy\");\n                    }}\n                  />\n                </div>\n                <div className=\"arrow-wrap\">\n                  <div\n                    className={`arrow arrow-down ${\n                      state.activeArrow === \"down-depositApy\" && \"active\"\n                    }`}\n                    onClick={() => {\n                      handleSort(\"down\", \"depositApy\");\n                    }}\n                  />\n                </div>\n              </div>\n            </div>\n          </th>\n          <th scope=\"col\" width=\"15%\">\n            Rewards\n          </th>\n          <th scope=\"col\" width=\"15%\">\n            <div className=\"table_sorter\">\n              <span> C.F.</span>\n              <div className=\"arrows\">\n                <div className=\"arrow-wrap\">\n                  <div\n                    className={`arrow arrow-up ${\n                      state.activeArrow === \"up-volatility_ratio\" && \"active\"\n                    }`}\n                    onClick={() => {\n                      handleSort(\"up\", \"volatility_ratio\");\n                    }}\n                  />\n                </div>\n                <div className=\"arrow-wrap\">\n                  <div\n                    className={`arrow arrow-down ${\n                      state.activeArrow === \"down-volatility_ratio\" && \"active\"\n                    }`}\n                    onClick={() => {\n                      handleSort(\"down\", \"volatility_ratio\");\n                    }}\n                  />\n                </div>\n              </div>\n            </div>\n          </th>\n          <th scope=\"col\" width=\"20%\">\n            <div className=\"table_sorter\">\n              <span>Total Supply</span>\n              <div className=\"arrows\">\n                <div className=\"arrow-wrap\">\n                  <div\n                    className={`arrow arrow-up ${\n                      state.activeArrow === \"up-totalLiquidity_usd\" && \"active\"\n                    }`}\n                    onClick={() => {\n                      handleSort(\"up\", \"totalLiquidity_usd\");\n                    }}\n                  />\n                </div>\n                <div className=\"arrow-wrap\">\n                  <div\n                    className={`arrow arrow-down ${\n                      state.activeArrow === \"down-totalLiquidity_usd\" &&\n                      \"active\"\n                    }`}\n                    onClick={() => {\n                      handleSort(\"down\", \"totalLiquidity_usd\");\n                    }}\n                  />\n                </div>\n              </div>\n            </div>\n          </th>\n          <th scope=\"col\" width=\"15%\"></th>\n        </tr>\n      </thead>\n      <tbody>{renderAssets(state.tableData) || \"\"}</tbody>\n    </table>\n    <div className=\"mb_table\">{renderMbAssets(state.tableData)}</div>\n    <Widget\n      src=\"juaner.near/widget/ref-market-supply-supply\"\n      props={{ selectedTokenId, showModal, closeModal, selectedTokenMeta }}\n    />\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/juaner.near/widget/ref-market-supply-assets", "fact_widget_deployments_id": "d004bf744fed3752bb9a148af91a10b3", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 5}