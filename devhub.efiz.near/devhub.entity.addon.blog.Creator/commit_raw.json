{"tx_hash": "3Ued319Kopm6x1DMq1dBCeQD35iFKsdvH2oEthmE6Gwm", "action_id_social": "XUz32h4vDr88wV1SP3i7EbtT3GcjxTZyH3n99ZzvT3Y-0-widget", "block_id": 104562808, "block_timestamp": "2023-10-30T20:41:46.429Z", "signer_id": "devhub.efiz.near", "widget_name": "devhub.entity.addon.blog.Creator", "source_code": "const Banner = styled.div`\n  border-radius: var(--bs-border-radius-xl) !important;\n  height: 100%;\n\n  & > div :not(.btn) {\n    position: absolute;\n    display: none;\n    margin: 0 !important;\n    width: 0 !important;\n    height: 0 !important;\n  }\n\n  .btn {\n    padding: 0.5rem 0.75rem !important;\n    min-height: 32;\n    line-height: 1;\n\n    border: none;\n    border-radius: 50px;\n    --bs-btn-color: #ffffff;\n    --bs-btn-bg: #087990;\n    --bs-btn-border-color: #087990;\n    --bs-btn-hover-color: #ffffff;\n    --bs-btn-hover-bg: #055160;\n    --bs-btn-hover-border-color: #055160;\n    --bs-btn-focus-shadow-rgb: 49, 132, 253;\n    --bs-btn-active-color: #ffffff;\n    --bs-btn-active-bg: #055160;\n    --bs-btn-active-border-color: #055160;\n    --bs-btn-active-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);\n    opacity: 0.8;\n\n    &:hover {\n      opacity: 1;\n    }\n  }\n`;\n\nconst FormContainer = styled.div`\n  & > *:not(:last-child) {\n    margin-bottom: 1rem;\n  }\n`;\n\nconst { data, handle } = props;\n\nconst initialData = data; // TODO: Check Storage API\n\nconst [content, setContent] = useState(initialData.content || \"\");\nconst [title, setTitle] = useState(initialData.title || \"\");\nconst [author, setAuthor] = useState(initialData.author || \"\");\nconst [previewMode, setPreviewMode] = useState(\"card\"); // \"card\" or \"page\"\n\n// Legacy State.init for IpfsUploader\nState.init({\n  image: {\n    cid: \"bafkreic4xgorjt6ha5z4s5e3hscjqrowe5ahd7hlfc5p4hb6kdfp6prgy4\",\n  },\n});\n\nconst Container = styled.div`\n  width: 100%;\n  margin: 0 auto;\n  padding: 20px;\n  text-align: left;\n`;\n\nconst cidToURL = (cid) => `https://ipfs.near.social/ipfs/${cid}`;\n\nconst hasDataChanged = () => {\n  return (\n    content !== initialData.content ||\n    title !== initialData.title ||\n    author !== initialData.author\n  );\n};\n\nconst handlePublish = () => {\n  Near.call({\n    contractName: \"devgovgigs.near\",\n    methodName: \"add_post\",\n    args: {\n      labels: [\"blog\", handle],\n      body: {\n        post_type: \"Comment\",\n        description: JSON.stringify({\n          title,\n          content,\n          author,\n          image: state.image.cid,\n          tags: data.includeTags,\n          community: handle,\n        }),\n        comment_version: \"V2\",\n      },\n    },\n    deposit: Big(10).pow(21).mul(2),\n    gas: Big(10).pow(12).mul(100),\n  });\n};\n\nfunction Preview() {\n  switch (previewMode) {\n    case \"card\": {\n      return (\n        <Widget\n          src=\"devhub.efiz.near/widget/devhub.entity.addon.blog.Card\"\n          props={{\n            title,\n            content,\n            author,\n            image: state.image,\n            tags: data.includeTags,\n            community: handle,\n          }}\n        />\n      );\n    }\n    case \"page\": {\n      return (\n        <Widget\n          src=\"devhub.efiz.near/widget/devhub.entity.addon.blog.Page\"\n          props={{\n            title,\n            content,\n            author,\n            image: state.image,\n            tags: data.includeTags,\n            community: handle,\n          }}\n        />\n      );\n    }\n  }\n}\n\nreturn (\n  <Container>\n    <ul className=\"nav nav-tabs\" id=\"editPreviewTabs\" role=\"tablist\">\n      <li className=\"nav-item\" role=\"presentation\">\n        <button\n          className=\"nav-link active\"\n          id=\"edit-tab\"\n          data-bs-toggle=\"tab\"\n          data-bs-target=\"#edit\"\n          type=\"button\"\n          role=\"tab\"\n          aria-controls=\"edit\"\n          aria-selected=\"true\"\n        >\n          Edit\n        </button>\n      </li>\n      <li className=\"nav-item\" role=\"presentation\">\n        <button\n          className=\"nav-link\"\n          id=\"preview-tab\"\n          data-bs-toggle=\"tab\"\n          data-bs-target=\"#preview\"\n          type=\"button\"\n          role=\"tab\"\n          aria-controls=\"preview\"\n          aria-selected=\"false\"\n        >\n          Preview\n        </button>\n      </li>\n    </ul>\n    <div className=\"tab-content\" id=\"editPreviewTabsContent\">\n      <div\n        className=\"tab-pane show active p-4\"\n        id=\"edit\"\n        role=\"tabpanel\"\n        aria-labelledby=\"edit-tab\"\n      >\n        <FormContainer>\n          <div style={{ height: 280 }}>\n            <Banner\n              alt=\"Blog background Preview\"\n              className=\"card-img-top d-flex flex-column justify-content-end align-items-end p-4\"\n              style={{\n                background: `center / cover no-repeat url(${cidToURL(\n                  state.image.cid\n                )})`,\n              }}\n            >\n              <IpfsImageUpload image={state.image} />\n            </Banner>\n          </div>\n          <div>\n            <h5>Title</h5>\n            <div className=\"flex-grow-1\">\n              <Widget\n                // TODO: LEGACY.\n                src=\"devhub.efiz.near/widget/gigs-board.components.molecule.text-input\"\n                props={{\n                  className: \"flex-grow-1\",\n                  onChange: (e) => setTitle(e.target.value),\n                  value: title,\n                  placeholder: \"Title\",\n                }}\n              />\n            </div>\n          </div>\n          <div>\n            <h5>Author</h5>\n            <div className=\"flex-grow-1\">\n              <Widget\n                // TODO: LEGACY.\n                src=\"devhub.efiz.near/widget/gigs-board.components.molecule.text-input\"\n                props={{\n                  className: \"flex-grow-1\",\n                  onChange: (e) => setAuthor(e.target.value),\n                  value: author,\n                  placeholder: \"Author\",\n                }}\n              />\n            </div>\n          </div>\n          <div>\n            <h5>Content</h5>\n            <Widget\n              src=\"devhub.efiz.near/widget/devhub.components.molecule.MarkdownEditor\"\n              props={{ data: { content }, onChange: setContent }}\n            />\n          </div>\n        </FormContainer>\n        <div\n          className={\"d-flex align-items-center justify-content-end gap-3 mt-4\"}\n        >\n          <Widget\n            src={\"devhub.efiz.near/widget/devhub.components.molecule.Button\"}\n            props={{\n              classNames: { root: \"btn-success\" },\n              disabled: !hasDataChanged(),\n              icon: {\n                type: \"bootstrap_icon\",\n                variant: \"bi-check-circle-fill\",\n              },\n              label: \"Publish\",\n              onClick: handlePublish,\n            }}\n          />\n        </div>\n      </div>\n      <div\n        className=\"tab-pane\"\n        id=\"preview\"\n        role=\"tabpanel\"\n        aria-labelledby=\"preview-tab\"\n        style={{ position: \"relative\" }}\n      >\n        <div style={{ position: \"absolute\", top: 10, right: 0 }}>\n          <Widget\n            // LEGACY\n            src=\"devhub.efiz.near/widget/gigs-board.components.molecule.button-switch\"\n            props={{\n              currentValue: previewMode,\n              key: \"previewMode\",\n              onChange: (e) => setPreviewMode(e.target.value),\n              options: [\n                { label: \"Card\", value: \"card\" },\n                { label: \"Page\", value: \"page\" },\n              ],\n\n              title: \"Preview mode selection\",\n            }}\n          />\n        </div>\n        <div className=\"w-100 h-100 p-4\">\n          <Preview />\n        </div>\n      </div>\n    </div>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/devhub.efiz.near/widget/devhub.entity.addon.blog.Creator", "fact_widget_deployments_id": "65aaa1cd40cdc1f0eded4a2e40d4ce27", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 3}