{"tx_hash": "6jShyECcxrVqdfhcrhvNMKjb7KPUTk25qm4C6knGBkny", "action_id_social": "5E6myagYBVTjRthPjV8e2AYmXgzPsiB71r7kUvW3nuMV-0-widget", "block_id": 104221686, "block_timestamp": "2023-10-26T03:56:29.301Z", "signer_id": "devhub.efiz.near", "widget_name": "devhub.entity.community.configuration.AddonsConfigurator", "source_code": "const { getAvailableAddons } =\n  VM.require(\"devhub.efiz.near/widget/core.adapter.devhub-contract\") ||\n  (() => {});\n\nconst { href } = VM.require(\"devhub.efiz.near/widget/core.lib.url\") || (() => {});\n\nconst availableAddons = getAvailableAddons() || [];\n\nconst Container = styled.div`\n  display: flex;\n  flex-direction: column;\n  width: 100%;\n`;\n\nconst Item = styled.div`\n  padding: 10px;\n  margin: 5px;\n  display: flex;\n  align-items: center;\n  gap: 10px;\n`;\n\nconst Icon = styled.span`\n  margin-right: 10px;\n`;\n\nconst EditableField = styled.input`\n  flex: 1;\n`;\n\nconst ToggleButton = styled.input`\n  margin-left: 10px;\n`;\n\nfunction generateRandom6CharUUID() {\n  const chars = \"0123456789abcdefghijklmnopqrstuvwxyz\";\n  let result = \"\";\n\n  for (let i = 0; i < 6; i++) {\n    const randomIndex = Math.floor(Math.random() * chars.length);\n    result += chars[randomIndex];\n  }\n\n  return result;\n}\n\nconst AddonItem = ({\n  data,\n  onUpdate,\n  onMove,\n  onRemove,\n  index,\n  isTop,\n  isBottom,\n}) => {\n  const handleNameChange = (event) => {\n    const newName = event.target.value;\n    onUpdate({ ...data, display_name: newName });\n  };\n\n  const handleEnableChange = () => {\n    onUpdate({ ...data, enabled: !data.enabled });\n  };\n\n  const moveItemUp = () => {\n    if (!isTop) {\n      onMove(index, index - 1);\n    }\n  };\n\n  const moveItemDown = () => {\n    if (!isBottom) {\n      onMove(index, index + 1);\n    }\n  };\n\n  const removeItem = () => {\n    onRemove(data.id);\n  };\n\n  return (\n    <div>\n      <Item>\n        <div>\n          <div style={{ display: \"flex\", gap: \"0\" }}>\n            <button\n              className=\"btn btn-sm btn-secondary rounded-0\"\n              onClick={moveItemUp}\n              disabled={isTop}\n            >\n              <i className=\"bi bi-arrow-up\"></i>\n            </button>\n            <button\n              className=\"btn btn-sm btn-secondary rounded-0\"\n              onClick={moveItemDown}\n              disabled={isBottom}\n            >\n              <i className=\"bi bi-arrow-down\"></i>\n            </button>\n          </div>\n        </div>\n        <EditableField\n          className=\"form-control border border-2\"\n          type=\"text\"\n          value={data.display_name}\n          disabled={!data.enabled}\n          onChange={handleNameChange}\n          maxLength={30}\n        />\n        <Widget\n          src={\"devhub.efiz.near/widget/devhub.components.atom.Toggle\"}\n          props={{\n            label: \"Enabled:\",\n            value: data.enabled,\n            onChange: handleEnableChange,\n          }}\n        />\n        {/* TODO: Redirects to the addon to configure there */}\n        {/* <button className=\"btn btn-outline-secondary\">\n          Edit\n          <i className=\"bi bi-box-arrow-in-up-right\" />\n        </button> */}\n        <button className=\"btn btn-outline-danger\" onClick={removeItem}>\n          <i className=\"bi bi-trash-fill\" />\n        </button>\n      </Item>\n    </div>\n  );\n};\n\nfunction arraysAreEqual(arr1, arr2) {\n  if (arr1.length !== arr2.length) {\n    return false;\n  }\n  for (let i = 0; i < arr1.length; i++) {\n    if (arr1[i] !== arr2[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nconst AddonsConfigurator = ({ data, onSubmit }) => {\n  const [originalList, setOriginalList] = useState(data);\n  const [list, setList] = useState(data);\n  const [changesMade, setChangesMade] = useState(false);\n\n  useEffect(() => {\n    setOriginalList(data);\n  }, [data]);\n\n  const updateItem = (updatedItem) => {\n    const updatedList = list.map((item) =>\n      item.id === updatedItem.id ? updatedItem : item\n    );\n    setList(updatedList);\n    setChangesMade(!arraysAreEqual(originalList, updatedList));\n  };\n\n  const moveItem = (fromIndex, toIndex) => {\n    const updatedList = [...list];\n    const [movedItem] = updatedList.splice(fromIndex, 1);\n    updatedList.splice(toIndex, 0, movedItem);\n    setList(updatedList);\n    setChangesMade(!arraysAreEqual(originalList, updatedList));\n  };\n\n  const [selectedAddon, setSelectedAddon] = useState(null);\n\n  const handleAddItem = () => {\n    const newItem = {\n      id: generateRandom6CharUUID(),\n      addon_id: selectedAddon.id,\n      display_name: selectedAddon.title,\n      enabled: true,\n      parameters: \"{}\",\n    };\n    const updatedList = [...list, newItem];\n    setList(updatedList);\n    setChangesMade(!arraysAreEqual(originalList, updatedList));\n  };\n\n  const removeItem = (id) => {\n    const updatedList = list.filter((item) => item.id !== id);\n    setList(updatedList);\n    setChangesMade(!arraysAreEqual(originalList, updatedList));\n  };\n\n  return (\n    <Container>\n      {list.map((item, index) => (\n        <AddonItem\n          key={item.id}\n          data={item}\n          onUpdate={updateItem}\n          onMove={moveItem}\n          onRemove={removeItem}\n          index={index}\n          isTop={index === 0}\n          isBottom={index === list.length - 1}\n        />\n      ))}\n      {availableAddons && list.length < 7 && (\n        <div className=\"d-flex justify-content-center\">\n          <div className=\"d-flex gap-2 flex-grow-1 px-4\">\n            <Widget\n              src={\"near/widget/DIG.InputSelect\"}\n              props={{\n                groups: [\n                  {\n                    items: (availableAddons || []).map((it) => ({\n                      label: it.title,\n                      value: it.id,\n                    })),\n                  },\n                ],\n                rootProps: {\n                  value: selectedAddon.id ?? null,\n                  placeholder: \"Select an addon\",\n                  onValueChange: (value) =>\n                    setSelectedAddon(\n                      (availableAddons || []).find((it) => it.id === value)\n                    ),\n                },\n              }}\n            />\n            <button\n              className=\"btn btn-success\"\n              onClick={handleAddItem}\n              disabled={!selectedAddon}\n            >\n              <i className=\"bi bi-plus\" />\n            </button>\n          </div>\n        </div>\n      )}\n      <div\n        className={\"d-flex align-items-center justify-content-end gap-3 mt-4\"}\n      >\n        <Widget\n          src={\"devhub.efiz.near/widget/devhub.components.molecule.Button\"}\n          props={{\n            classNames: { root: \"btn-success\" },\n            disabled: !changesMade,\n            icon: {\n              type: \"bootstrap_icon\",\n              variant: \"bi-check-circle-fill\",\n            },\n            label: \"Submit\",\n            onClick: () => onSubmit(list),\n          }}\n        />\n      </div>\n    </Container>\n  );\n};\n\nreturn AddonsConfigurator(props);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/devhub.efiz.near/widget/devhub.entity.community.configuration.AddonsConfigurator", "fact_widget_deployments_id": "555afe458c6da11f6944176d74c85aea", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 24}