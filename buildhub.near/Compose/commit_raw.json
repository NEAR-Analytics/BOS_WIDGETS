{"tx_hash": "9aHxPEkGMTokJvYADHfCi9iLwdN6Gp3SpevedyP49BZR", "action_id_social": "HEuNnXCNHync5vDZF3X4HSJ1xT6D1NVjMxDMdHkwQtUC-0-widget", "block_id": 113012972, "block_timestamp": "2024-02-17T10:57:57.514Z", "signer_id": "buildhub.near", "widget_name": "Compose", "source_code": "const { Button } = VM.require(\"buildhub.near/widget/components\") || {\n  Button: () => <></>,\n};\n\nif (!context.accountId) {\n  return \"\";\n}\n\nconst indexKey = props.indexKey ?? \"main\";\nconst draftKey = props.draftKey ?? \"draft\";\nconst template = props.template || \"\";\nconst feed = props.feed;\nconst draft = Storage.privateGet(draftKey);\nconst groupId = props.groupId;\n\nif (draft === null) {\n  return \"\";\n}\n\nconst [initialText] = useState(draft || template);\n\nfunction checkAndAppendHashtag(input, target) {\n  if (input.toLowerCase().includes(`#${target.toLowerCase()}`)) {\n    return input;\n  } else {\n    return input + ` #${target}`;\n  }\n}\n\nconst composeData = () => {\n  const text = state.content.text;\n\n  const requiredHashtags = props.requiredHashtags || [\"build\"];\n  if (feed.hashtag) requiredHashtags.push(feed.hashtag.toLowerCase());\n  text = text + `\\n\\n`;\n  requiredHashtags.forEach((hashtag) => {\n    text = checkAndAppendHashtag(text, hashtag);\n  });\n\n  const data = {\n    post: {\n      main: JSON.stringify({ ...state.content, text }),\n    },\n    index: {\n      post: JSON.stringify({\n        key: indexKey,\n        value: {\n          type: \"md\",\n        },\n      }),\n    },\n  };\n\n  const item = {\n    type: \"social\",\n    path: `${context.accountId}/post/main`,\n  };\n\n  const notifications = state.extractMentionNotifications(text, item);\n\n  if (notifications.length) {\n    data.index.notify = JSON.stringify(\n      notifications.length > 1 ? notifications : notifications[0],\n    );\n  }\n\n  const hashtags = state.extractHashtags(text);\n\n  if (hashtags.length) {\n    data.index.hashtag = JSON.stringify(\n      hashtags.map((hashtag) => ({\n        key: hashtag,\n        value: item,\n      })),\n    );\n  }\n\n  return data;\n};\n\nState.init({\n  showPreview: false,\n  posted: false,\n  onChange: ({ content }) => {\n    State.update({ content });\n    Storage.privateSet(draftKey, content.text || \"\");\n  },\n});\n\nconst [showToast, setShowToast] = useState(false);\n\nreturn (\n  <>\n    <div\n      data-bs-theme=\"dark\"\n      style={{\n        background: \"var(--bg-2, #2b2f31)\",\n        borderRadius: \"1rem\",\n        border: \"1px solid var(--stroke-color, rgba(255, 255, 255, 0.2)\",\n        marginBottom: \"1rem\",\n      }}\n    >\n      <div>\n        <Widget\n          src=\"devs.near/widget/Common.Compose\"\n          props={{\n            placeholder: \"What's happening?\",\n            onChange: state.onChange,\n            initialText,\n            onHelper: ({ extractMentionNotifications, extractHashtags }) => {\n              State.update({ extractMentionNotifications, extractHashtags });\n            },\n            composeButton: (onCompose) => (\n              <CommitButton\n                disabled={!state.content || state.content.text === template}\n                force\n                className=\"btn rounded-3\"\n                style={{\n                  backgroundColor: \"var(--yellow, #ffaf51)\",\n                  color: \"var(--button-primary-color, #000)\",\n                  fontSize: \"14px\",\n                  fontWeight: \"500\",\n                  padding: \"10px 16px\",\n                }}\n                data={composeData}\n                onCommit={() => {\n                  onCompose();\n                  setShowToast(true);\n                  State.update({ content: { text: \"\", image: {} } });\n                }}\n              >\n                Post\n              </CommitButton>\n            ),\n            previewButton: () => (\n              <button\n                disabled={!state.content || state.content.text === template}\n                className=\"btn rounded-3 me-2\"\n                style={{\n                  backgroundColor: \"var(--button-outline-bg, transparent)\",\n                  color: \"var(--button-outline-color, #fff)\",\n                  border:\n                    \"1px solid var(--stroke-color, rgba(255, 255, 255, 0.2)\",\n                  fontSize: \"14px\",\n                  fontWeight: \"500\",\n                  padding: \"10px 16px\",\n                }}\n                onClick={() =>\n                  State.update({ showPreview: !state.showPreview })\n                }\n              >\n                Preview <i className=\"bi bi-eye\"></i>\n              </button>\n            ),\n          }}\n        />\n      </div>\n      {state.content && state.showPreview && (\n        <div className=\"px-3\">\n          <Widget\n            key=\"post-preview\"\n            src=\"buildhub.near/widget/components.Post\"\n            props={{\n              accountId: context.accountId,\n              content: state.content || { type: \"md\", text: \"\" },\n              blockHeight: \"now\",\n              noBorder: true,\n            }}\n          />\n        </div>\n      )}\n    </div>\n    <Widget\n      src=\"near/widget/DIG.Toast\"\n      props={{\n        title: \"Post Submitted Successfully\",\n        type: \"success\",\n        open: showToast,\n        onOpenChange: (v) => setShowToast(v),\n        trigger: <></>,\n        action: (\n          <Button\n            variant=\"primary\"\n            style={{ fontSize: 14 }}\n            onClick={() => setShowToast(false)}\n          >\n            dismiss\n          </Button>\n        ),\n        providerProps: { duration: 1000 },\n      }}\n    />\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/buildhub.near/widget/Compose", "fact_widget_deployments_id": "7f6605ea13ae47eda3f8821b8a8560ef", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 31}