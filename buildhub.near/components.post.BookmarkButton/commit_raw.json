{"tx_hash": "A5v3Chygp4jBWxNX8u7VKowAkyYqnhg3cE5UrUTBouFN", "action_id_social": "E7A4UzW1fszJ4Dfjd3VYaqgERXAGy1vRM4s62HR865RA-0-widget", "block_id": 109997862, "block_timestamp": "2024-01-09T17:27:17.836Z", "signer_id": "buildhub.near", "widget_name": "components.post.BookmarkButton", "source_code": "const item = props.item;\n\nif (!item) {\n  return \"\";\n}\n\nuseEffect(() => {\n  State.update({ hasBookmark: null });\n}, [item]);\n\nconst bookmarks = Social.index(\"bookmark\", item);\n\nconst dataLoading = bookmarks === null;\n\nconst bookmarksByUsers = {};\n\n(bookmarks || []).forEach((bookmark) => {\n  if (bookmark.value.type === \"bookmark\") {\n    bookmarksByUsers[bookmark.accountId] = bookmark;\n  } else if (bookmark.value.type === \"unbookmark\") {\n    delete bookmarksByUsers[bookmark.accountId];\n  }\n});\nif (state.hasBookmark === true) {\n  bookmarksByUsers[context.accountId] = {\n    accountId: context.accountId,\n  };\n} else if (state.hasBookmark === false) {\n  delete bookmarksByUsers[context.accountId];\n}\n\nconst accountsWithBookmarks = Object.keys(bookmarksByUsers);\nconst likeCount = accountsWithBookmarks.length;\nconst hasBookmark = context.accountId && !!bookmarksByUsers[context.accountId];\n\nconst bookmarkSvg = (\n  <svg\n    width=\"20\"\n    height=\"20\"\n    viewBox=\"0 0 20 20\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path\n      d=\"M4.16671 1.66667H15.8334C16.2936 1.66667 16.6667 2.03977 16.6667 2.50001V18.4528C16.6667 18.6828 16.4801 18.8695 16.25 18.8695C16.1718 18.8695 16.095 18.8473 16.0287 18.8058L10 15.0261L3.97137 18.8058C3.7764 18.928 3.51926 18.8691 3.39702 18.6741C3.35543 18.6078 3.33337 18.5311 3.33337 18.4528V2.50001C3.33337 2.03977 3.70647 1.66667 4.16671 1.66667ZM15 3.33334H5.00004V16.1937L10 13.0589L15 16.1937V3.33334Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nconst bookmarkFillSvg = (\n  <svg\n    width=\"20\"\n    height=\"20\"\n    viewBox=\"0 0 20 20\"\n    fill=\"#FFAF51\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path\n      d=\"M4.16671 1.66675H15.8334C16.2936 1.66675 16.6667 2.03985 16.6667 2.50008V18.4528C16.6667 18.6829 16.4801 18.8696 16.25 18.8696C16.1718 18.8696 16.095 18.8474 16.0287 18.8058L10 15.0262L3.97137 18.8058C3.7764 18.9281 3.51926 18.8692 3.39702 18.6742C3.35543 18.6078 3.33337 18.5312 3.33337 18.4528V2.50008C3.33337 2.03985 3.70647 1.66675 4.16671 1.66675ZM15 3.33341H5.00004V16.1937L10 13.059L15 16.1937V3.33341Z\"\n      fill=\"#FFAF51\"\n    />\n  </svg>\n);\n\nconst BookmarkButton = styled.div`\n  line-height: 20px;\n  min-height: 20px;\n  display: inline-flex;\n  align-items: center;\n  justify-content: left;\n  background: inherit;\n  color: inherit;\n  font-size: 16px;\n  .icon {\n    position: relative;\n    &:before {\n      margin: -8px;\n      content: \"\";\n      position: absolute;\n      top: 0;\n      left: 0;\n      bottom: 0;\n      right: 0;\n      border-radius: 50%;\n    }\n  }\n\n  .count {\n    margin-left: 8px;\n  }\n\n  &:not([disabled]) {\n    cursor: pointer;\n  }\n\n  &:not([disabled]):hover {\n    opacity: 1 !important;\n    color: #ffaf51;\n\n    .icon:before {\n      background: rgba(255, 175, 81, 0.1);\n    }\n  }\n  .bookmarked {\n    color: #ffaf51;\n  }\n\n  .loading {\n    @keyframes scaleAnimation {\n      0%,\n      100% {\n        transform: scale(1) rotate(0deg);\n      }\n      25% {\n        transform: scale(1.2) rotate(-15deg);\n      }\n      50% {\n        transform: scale(1) rotate(0deg);\n      }\n      75% {\n        transform: scale(1.2) rotate(15deg);\n      }\n    }\n\n    transform-origin: center;\n    animation: scaleAnimation 1s ease-in-out infinite;\n  }\n`;\n\nconst likeClick = () => {\n  if (state.loading || dataLoading || !context.accountId) {\n    return;\n  }\n  State.update({\n    loading: true,\n  });\n  const data = {\n    index: {\n      bookmark: JSON.stringify({\n        key: item,\n        value: {\n          type: hasBookmark ? \"unbookmark\" : \"bookmark\",\n        },\n      }),\n    },\n  };\n\n  Social.set(data, {\n    onCommit: () => State.update({ loading: false, hasBookmark: !hasBookmark }),\n    onCancel: () => State.update({ loading: false }),\n  });\n};\n\nconst title = hasBookmark ? \"Unbookmark\" : \"Bookmark\";\n\nreturn (\n  <div className=\"d-inline-flex align-items-center\">\n    <BookmarkButton\n      disabled={state.loading || dataLoading || !context.accountId}\n      title={title}\n      onClick={likeClick}\n    >\n      <span\n        className={`icon ${state.loading ? \"loading \" : \"\"}${\n          hasBookmark ? \"bookmarked\" : \"\"\n        }`}\n      >\n        {hasBookmark ? bookmarkFillSvg : bookmarkSvg}\n      </span>\n    </BookmarkButton>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/buildhub.near/widget/components.post.BookmarkButton", "fact_widget_deployments_id": "e6e3edcfbaf5e103f60434deb611cfd8", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}