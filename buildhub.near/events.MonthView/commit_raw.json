{"tx_hash": "8254YJx4byTSafUZN7BksFAcAuowt2Z2CrDB9Q5qE1du", "action_id_social": "DYazXZi8peUb6rnF8XghiWFbRWwAmW2AxykDKSTkZcFQ-0-widget", "block_id": 118163062, "block_timestamp": "2024-05-03T14:14:04.596Z", "signer_id": "buildhub.near", "widget_name": "events.MonthView", "source_code": "const { Modal, Hashtag, Button } = VM.require(\n  \"buildhub.near/widget/components\"\n) || {\n  Modal: () => <></>,\n  Hashtag: () => <></>,\n  Button: () => <></>,\n};\nconst currentDate = props.currentDate || new Date();\nconst events = props.events || [];\nconst theme = props.theme;\nconst [parsedEvents, setParsedEvents] = useState(events);\n// update events recurring data according to calender library requirements (ref: https://fullcalendar.io/docs/recurring-events)\nuseEffect(() => {\n  if (Array.isArray(events)) {\n    const updatedEvent = events.map((event, index) => {\n      if (event.recurrence) {\n        const frequency = event.recurrence.frequency;\n        switch (frequency) {\n          case \"daily\":\n            return {\n              ...event,\n              groupId: event.title + \"_\" + index,\n            };\n          case \"weekly\":\n            return {\n              ...event,\n              groupId: event.title + \"_\" + index,\n              daysOfWeek: event.recurrence.daysOfWeek ?? [\n                new Date(event.start).getDay(),\n              ],\n            };\n          default:\n            return event;\n        }\n      } else return event;\n    });\n    setParsedEvents(updatedEvent);\n  }\n}, [events]);\nconst customCSSDark = `\n  :root {\n    --fc-page-bg-color: var(--bg-color, #000000);\n    --fc-border-color: var(--stroke-color, rgba(255, 255, 255, 0.20));\n    --fc-today-bg-color: #424451;\n  }\n  body {\n    margin: 0;\n  }\n  html {\n    background-color: var(--fc-page-bg-color);\n    color: var(--text-color, #fff);\n    font-family: sans-serif;\n  }\n  /* FC Header */\n  .fc-col-header-cell {\n    background: var(--bg-2, #23242B);\n    .fc-col-header-cell-cushion {\n      display: block;\n      text-align: left;\n      font-size: 16px;\n      font-style: normal;\n      font-weight: 400;\n      line-height: 170%; /* 27.2px */\n      padding: 10px;\n    }\n  }\n  /* FC Day */\n  .fc-day-today {\n    .fc-daygrid-day-frame {\n      background: var(--fc-today-bg-color, #424451);\n    }\n  }\n  .fc .fc-daygrid-event-harness {\n    a {\n      color: var(--text-color, #fff);\n    }\n  }\n  .fc-day-other {\n    .fc-daygrid-day-frame {\n      background: var(--bg-1, #000000);\n    }\n  }\n  .fc-daygrid-day-frame {\n    padding: 10px;\n    background: var(--bg-2, #23242B);\n  }\n  .fc .fc-daygrid-day-top {\n    flex-direction: row;\n    .fc-daygrid-day-number {\n      font-size: 16px;\n      font-style: normal;\n      font-weight: 400;\n      line-height: 170%; /* 27.2px */\n    }\n  }\n`;\nconst customCSSLight = `\n  :root {\n    --fc-page-bg-color: var(--bg-color, #fff);\n    --fc-border-color: var(--stroke-color, #fff);\n    --fc-today-bg-color: #ededed;\n  }\n  body {\n    margin: 0;\n  }\n  html {\n    background-color: var(--fc-page-bg-color);\n    color: var(--text-color, #000);\n    font-family: sans-serif;\n  }\n  /* FC Header */\n  .fc-col-header-cell {\n    background: var(--bg-2, #ededed);\n    .fc-col-header-cell-cushion {\n      display: block;\n      text-align: left;\n      font-size: 16px;\n      font-style: normal;\n      font-weight: 400;\n      line-height: 170%; /* 27.2px */\n      padding: 10px;\n    }\n  }\n  /* FC Day */\n  .fc-day-today {\n    .fc-daygrid-day-frame {\n      background: var(--fc-today-bg-color, #fff);\n    }\n  }\n  .fc .fc-daygrid-event-harness {\n    a {\n      color: var(--text-color, #000);\n    }\n  }\n  .fc-day-other {\n    .fc-daygrid-day-frame {\n      background: var(--bg-1, #cdcdcd);\n    }\n  }\n  .fc-daygrid-day-frame {\n    padding: 10px;\n    background: var(--bg-2, #fff);\n  }\n  .fc .fc-daygrid-day-top {\n    flex-direction: row;\n    .fc-daygrid-day-number {\n      font-size: 16px;\n      font-style: normal;\n      font-weight: 400;\n      line-height: 170%; /* 27.2px */\n    }\n  }\n`;\nconst EventModal = styled.div`\n  ${props.theme === \"light\" &&\n  `\n  background: white !important;\n  color: black;\n`}\n`;\nconst embedCss =\n  props.embedCss ?? theme === \"light\" ? customCSSLight : customCSSDark;\nconst code = `\n<script src='https://cdn.jsdelivr.net/npm/fullcalendar/index.global.js'></script>\n<!-- iframe-resizer -->\n<!-- <script type=\"text/javascript\" src=\"https://cdnjs.cloudflare.com/ajax/libs/iframe-resizer/4.3.6/iframeResizer.contentWindow.js\"></script> -->\n<style>\n  ${embedCss}\n</style>\n<div id=\"calendar\"></div>\n<script>\n  document.addEventListener('DOMContentLoaded', function() {\n    var calendarEl = document.getElementById('calendar');\n    var calendar = new FullCalendar.Calendar(calendarEl, {\n      initialView: 'dayGridMonth',\n      headerToolbar: false,\n      events: ${JSON.stringify(parsedEvents)},\n      eventClick: function(info) {\n        info.jsEvent.preventDefault(); // don't let the browser navigate\n        // Post the event details to the parent window\n        window.parent.postMessage(JSON.stringify({ event: info.event}), '*');\n      },\n    });\n    calendar.render();\n    calendar.gotoDate(new Date(${currentDate.getTime()}));\n  });\n</script>\n`;\nconst [data, setData] = useState(null);\nconst [showModal, setShowModal] = useState(false);\nconst toggleModal = () => {\n  setShowModal((prev) => !prev);\n};\nconst organizers =\n  (data?.extendedProps?.organizers || []).map((it) => {\n    if (it.customOption) {\n      return it.organizer;\n    }\n    return it;\n  }) ?? [];\nconst hashtags =\n  (data?.extendedProps?.hashtags || []).map((it) => {\n    if (it.customOption) {\n      return it.hashtags;\n    }\n    return it;\n  }) ?? [];\nlet eventAuthor;\nlet eventApp;\nlet eventType;\nlet eventKey;\nif (data) {\n  eventAuthor = data?.extendedProps?.key?.split(\"/\")[0] ?? \"\";\n  eventApp = data?.extendedProps?.key?.split(\"/\")[1] ?? \"\";\n  eventType = data?.extendedProps?.key?.split(\"/\")[2] ?? \"\";\n  eventKey = data?.extendedProps?.key?.split(\"/\")[3] ?? \"\";\n}\nconst handleDelete = () => {\n  Social.set({\n    [eventApp]: {\n      [eventType]: {\n        [eventKey]: {\n          \"\": null,\n        },\n      },\n    },\n  });\n};\nreturn (\n  <>\n    <iframe\n      srcDoc={code}\n      onMessage={(data) => {\n        const dataObj = JSON.parse(data);\n        setData(dataObj.event);\n        toggleModal();\n      }}\n      style={{\n        width: \"100%\",\n        height: \"100vh\",\n      }}\n    />\n    {data && (\n      <Modal\n        className=\"modal-view\"\n        open={showModal}\n        onOpenChange={toggleModal}\n        title={data.title}\n        theme={props.theme}\n      >\n        <div style={{ maxWidth: 600 }}>\n          <div className=\"mb-3 d-flex align-items-center gap-5 flex-wrap\">\n            <span>\n              <h5 style={{ fontSize: 12, fontWeight: 700, marginBottom: 8 }}>\n                START\n              </h5>\n              <i className=\"bi bi-calendar\"></i>\n              {new Date(data.start).toLocaleDateString(\"en-us\", {\n                hour: \"2-digit\",\n                minute: \"numeric\",\n              })}\n            </span>\n            <span>\n              <h5 style={{ fontSize: 12, fontWeight: 700, marginBottom: 8 }}>\n                END\n              </h5>\n              <i className=\"bi bi-calendar\"></i>\n              {new Date(data.end).toLocaleDateString(\"en-us\", {\n                hour: \"2-digit\",\n                minute: \"numeric\",\n              })}\n            </span>\n          </div>\n          {data.extendedProps.description && (\n            <div className=\"mb-3\">\n              <h5 style={{ fontSize: 12, fontWeight: 700, marginBottom: 8 }}>\n                DESCRIPTION\n              </h5>\n              <p>{data.extendedProps.description}</p>\n            </div>\n          )}\n          {organizers.length > 0 && (\n            <div className=\"mb-3\">\n              <h5 style={{ fontSize: 12, fontWeight: 700, marginBottom: 8 }}>\n                ORGANIZERS\n              </h5>\n              <div className=\"d-flex align-items-center gap-3 flex-wrap\">\n                {organizers.map((organizer) => {\n                  const organizerProfile = Social.getr(`${organizer}/profile`);\n                  return (\n                    <span className=\"d-flex align-items-center gap-1\">\n                      <Widget\n                        src=\"mob.near/widget/Image\"\n                        loading=\"\"\n                        props={{\n                          image: organizerProfile.image,\n                          fallbackUrl:\n                            \"https://ipfs.near.social/ipfs/bafkreibas66y6ewop5ix2n6mgybpjz6epg7opqvcplmm5jw4jlhdik5nhe\",\n                          style: {\n                            width: 24,\n                            height: 24,\n                            borderRadius: 12,\n                            objectFit: \"cover\",\n                          },\n                        }}\n                      />\n                      {organizerProfile.name ??\n                        organizers[0] ??\n                        \"No name profile\"}\n                    </span>\n                  );\n                })}\n              </div>\n            </div>\n          )}\n          {hashtags.length > 0 && (\n            <div className=\"mb-3\">\n              <h5 style={{ fontSize: 12, fontWeight: 700, marginBottom: 8 }}>\n                HASHTAGS\n              </h5>\n              <div className=\"d-flex align-items-center gap-2 flex-wrap\">\n                {hashtags.map((tag) => (\n                  <Hashtag key={tag}>{tag}</Hashtag>\n                ))}\n              </div>\n            </div>\n          )}\n          {data.extendedProps.location && (\n            <span className=\"d-flex align-items-center gap-1 mb-3\">\n              <i className=\"bi bi-geo-alt\"></i>\n              {data?.extendedProps?.location}\n            </span>\n          )}\n        </div>\n        <div className=\"d-flex align-items-center gap-3\">\n          <Button\n            noLink={true}\n            href={`${data?.url}`}\n            target=\"_blank\"\n            variant=\"primary\"\n          >\n            Join Now\n          </Button>\n          {eventAuthor === context.accountId && (\n            <Button\n              onClick={handleDelete}\n              style={{ background: \"#ff2b2b\" }}\n              variant=\"primary\"\n            >\n              Delete Event\n            </Button>\n          )}\n        </div>\n      </Modal>\n    )}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/buildhub.near/widget/events.MonthView", "fact_widget_deployments_id": "dd7e44b98f718bf3c1984a022e2d1d51", "inserted_timestamp": "2024-05-03T15:40:44.027Z", "modified_timestamp": "2024-05-03T15:40:44.027Z", "__row_index": 14}