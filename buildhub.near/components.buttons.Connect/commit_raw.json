{"tx_hash": "CV8Cs7DdaXkJWPnjPMVt2nqmQUZXXQhHchrhRk52GCwj", "action_id_social": "CVemaBbpRuNAeYvqtXmzV7zVjATVeFeeK3dbU5uTZ18E-0-widget", "block_id": 117392570, "block_timestamp": "2024-04-22T16:24:25.287Z", "signer_id": "buildhub.near", "widget_name": "components.buttons.Connect", "source_code": "const { joinBtnChildren, connectedChildren, showActivity, className, href } =\n  props;\nconst { Bullet, Button } = VM.require(\"buildhub.near/widget/components\") || {\n  Bullet: () => <></>,\n  Button: () => <></>,\n};\nconst DaoSDK = VM.require(\"sdks.near/widget/SDKs.Sputnik.DaoSDK\") || (() => {});\nif (!DaoSDK) {\n  return <></>;\n}\nconst daoId = \"build.sputnik-dao.near\";\nconst sdk = DaoSDK(daoId);\nif (!sdk) {\n  return <></>;\n}\nconst userAccountId = context.accountId;\nconst data = sdk?.checkIsMemberOrPending({\n  accountId: userAccountId,\n  rolesToCheck: [\"community\", \"council\"],\n});\nconst connectEdge = Social.keys(\n  `${userAccountId}/graph/connect/${daoId}`,\n  undefined,\n  {\n    values_only: true,\n  }\n);\n// get DAO policy, deposit, and group\nconst policy = sdk?.getPolicy();\nif (policy === null || data === null) {\n  return \"\";\n}\nconst deposit = policy?.proposal_bond;\nconst roleId = \"community\";\nconst handleJoin = () => {\n  const connectData = {\n    [userAccountId]: {\n      graph: {\n        connect: {\n          [daoId]: \"\",\n        },\n      },\n      index: {\n        graph: JSON.stringify({\n          key: \"connect\",\n          value: {\n            type: \"connect\",\n            accountId: daoId,\n          },\n        }),\n      },\n      notify: JSON.stringify({\n        key: daoId,\n        value: {\n          type: \"connect\",\n        },\n      }),\n    },\n  };\n  sdk.createAddMemberProposal({\n    description: `add ${userAccountId} to the ${roleId} group`,\n    memberId: userAccountId,\n    roleId: roleId,\n    gas: 219000000000000,\n    deposit: deposit,\n    additionalCalls: [\n      {\n        contractName: \"social.near\",\n        methodName: \"set\",\n        deposit: 100000000000000000000000,\n        args: { data: connectData, options: { refund_unused_deposit: true } },\n      },\n    ],\n  });\n};\nconst isConnected = Object.keys(connectEdge || {}).length > 0;\nconst Container = styled.div`\n  .custom-button {\n    display: flex;\n    padding: 10px 20px;\n    justify-content: center;\n    align-items: center;\n    gap: 4px;\n    border-radius: 8px;\n    background: #eca227;\n    color: #fff;\n    margin: 0;\n    a {\n      color: #fff !important;\n    }\n    /* Other/Button_text */\n    font-size: 14px;\n    font-style: normal;\n    font-weight: 500;\n    line-height: normal;\n    text-decoration: none;\n    transition: all 300ms;\n    &:hover {\n      background: #c98a40;\n    }\n  }\n  a {\n    @apply custom-button;\n  }\n`;\nconst { href: linkHref } = VM.require(\"buildhub.near/widget/lib.url\") || {\n  href: () => {},\n};\nconst Component = () => {\n  if (!context.accountId) {\n    return (\n      <Button\n        href={\"https://nearbuilders.org/join\"}\n        variant=\"primary\"\n        noLink={true}\n      >\n        Join Now\n      </Button>\n    );\n  } else if (data.isDaoMember || isConnected) {\n    if (showActivity) {\n      return (\n        <div className=\"d-flex flex-column align-items-center gap-3\">\n          <Bullet variant=\"light\">\n            {data.isDaoMember ? \"Joined\" : \"Pending application\"}\n          </Bullet>\n          <Link\n            style={{ color: \"#df9731\", fontWeight: 600 }}\n            to={linkHref({\n              widgetSrc: \"buildhub.near/widget/app\",\n              params: {\n                page: \"feed\",\n              },\n            })}\n          >\n            View Activity{\" \"}\n            <svg\n              xmlns=\"http://www.w3.org/2000/svg\"\n              width=\"16\"\n              height=\"17\"\n              viewBox=\"0 0 16 17\"\n              fill=\"none\"\n            >\n              <path\n                d=\"M10.7809 7.83327L7.2049 4.25726L8.1477 3.31445L13.3332 8.49993L8.1477 13.6853L7.2049 12.7425L10.7809 9.1666H2.6665V7.83327H10.7809Z\"\n                fill=\"#df9731\"\n              />\n            </svg>\n          </Link>\n        </div>\n      );\n    }\n    return <div>{connectedChildren}</div>;\n  } else {\n    if (href) {\n      return (\n        <Link href={href} className={className}>\n          {joinBtnChildren}\n        </Link>\n      );\n    } else {\n      return (\n        <button className={className} onClick={handleJoin}>\n          {joinBtnChildren}\n        </button>\n      );\n    }\n  }\n};\nreturn (\n  <Container>\n    <Component />\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/buildhub.near/widget/components.buttons.Connect", "fact_widget_deployments_id": "26fa2d17dcf87ad435ca87bf49d43c1e", "inserted_timestamp": "2024-04-22T18:38:50.728Z", "modified_timestamp": "2024-04-22T18:38:50.728Z", "__row_index": 1}