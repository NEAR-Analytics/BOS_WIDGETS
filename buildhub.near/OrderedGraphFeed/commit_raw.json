{"tx_hash": "CV8Cs7DdaXkJWPnjPMVt2nqmQUZXXQhHchrhRk52GCwj", "action_id_social": "CVemaBbpRuNAeYvqtXmzV7zVjATVeFeeK3dbU5uTZ18E-0-widget", "block_id": 117392570, "block_timestamp": "2024-04-22T16:24:25.287Z", "signer_id": "buildhub.near", "widget_name": "OrderedGraphFeed", "source_code": "const { Header } = VM.require(\"buildhub.near/widget/components.Header\") || {\n  Header: () => <></>,\n};\nconst accountId = props.accountId ?? context.accountId;\nconst itemType = props.itemType;\nconst renderItem = props.renderItem;\nif (!itemType) {\n  return <p className=\"text-white\">No graph item type passed.</p>;\n}\nconst items = Social.getr(`${accountId}/graph/${itemType}`, \"final\", {\n  withBlockHeight: true,\n});\nconst StorageKey = \"order\";\nconst order = Storage.privateGet(StorageKey);\nconst graphItems = useMemo(() => {\n  if (items === null || order === null) {\n    return [];\n  }\n  const itemMap = new Map();\n  const path = [];\n  const buildSrc = (node) => {\n    if (node.hasOwnProperty(\"\")) {\n      itemMap.set(path.join(\"/\"), node[\":block\"]);\n    }\n    Object.entries(node).forEach(([key, value]) => {\n      if (typeof value === \"object\") {\n        path.push(key);\n        buildSrc(value);\n        path.pop();\n      }\n    });\n  };\n  buildSrc(items ?? {}, [], itemMap);\n  let entries = [...itemMap.entries()];\n  entries.sort((a, b) => b[1] - a[1]);\n  entries = entries.map((a) => a[0]);\n  entries.sort((a, b) => (order?.[a] || 0) - (order?.[b] || 0));\n  Storage.privateSet(\n    StorageKey,\n    Object.fromEntries(entries.map((a, i) => [a, i + 1]))\n  );\n  return entries;\n}, [items, order]);\nlet transformedArray = graphItems.map((item) => {\n  let splitParts = item.split(\"/\");\n  let accountId = splitParts[0];\n  let lastPart = splitParts[splitParts.length - 1];\n  let blockHeight = isNaN(lastPart) ? null : parseInt(lastPart);\n  return { accountId, blockHeight };\n});\nlet filteredArray = transformedArray.filter(\n  (item) => item.blockHeight !== null\n);\nreturn (\n  <>\n    <Header>{itemType}s</Header>\n    {(filteredArray ?? []).map((item) => renderItem(item))}\n    {filteredArray.length === 0 && (\n      <p className=\"fw-bold text-white\">No {itemType}s!</p>\n    )}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/buildhub.near/widget/OrderedGraphFeed", "fact_widget_deployments_id": "d63a3ffcfc863f4bbed86e3c58ceac81", "inserted_timestamp": "2024-04-22T18:38:50.728Z", "modified_timestamp": "2024-04-22T18:38:50.728Z", "__row_index": 3}