{"tx_hash": "nfnCLuZrrKAZAi1DyWsk2zYhxpZHsTw28xCUxxbwqNs", "action_id_social": "AxVKb5bc1xTvAzjWpNoU37KZ9gTWLDF5onrN6ZEkMDHK-0-widget", "block_id": 105996727, "block_timestamp": "2023-11-18T18:36:32.136Z", "signer_id": "beachsunandrockandroll.near", "widget_name": "ProdigyPianoDiary", "source_code": "const [user, setUser] = useState(\"\");\nconst [sheetIdx, setSheetIdx] = useState(\"\");\n\nconst { getNormalDate, ppdContract, ppdAbi } = VM.require(\n  \"beachsunandrockandroll.near/widget/utils\"\n);\n\nState.init({\n  visibleObj: \"userSheets\",\n});\n\nconst getUsers = () => {\n  const ppd = new ethers.Contract(\n    ppdContract,\n    ppdAbi.body,\n    Ethers.provider().getSigner()\n  );\n\n  ppd.getUsers().then((res) => {\n    State.update({ users: res });\n  });\n};\n\nconst isUserRegistered = () => {\n  if (!state.users) return false;\n\n  const userTmp = state.users.find(\n    (user) => user[0].toLowerCase() === state.sender\n  );\n\n  if (userTmp != undefined) setUser(userTmp);\n\n  return userTmp != undefined;\n};\n\nif (state.sender === undefined) {\n  const accounts = Ethers.send(\"eth_requestAccounts\", []);\n  if (accounts.length) {\n    State.update({ sender: accounts[0] });\n    getUsers();\n  }\n}\n\nreturn (\n  <>\n    {!!state.sender ? (\n      <>\n        {!isUserRegistered() && (\n          <Widget src={`beachsunandrockandroll.near/widget/registerUser`} />\n        )}\n      </>\n    ) : (\n      <Web3Connect connectLabel=\"Connect with Web3\" />\n    )}\n    {user !== \"\" && (\n      <div class=\"mt-4 p-3\">\n        <button\n          onClick={() => {\n            State.update({ visibleObj: \"composerList\" });\n          }}\n        >\n          Get composer List\n        </button>\n        <button\n          onClick={() => {\n            State.update({ visibleObj: \"userSheets\" });\n          }}\n        >\n          Get my Sheets\n        </button>\n      </div>\n    )}\n\n    {/*{user && <>{user[1]}</>}\n\n    */}\n    {!!state.sender &&\n      isUserRegistered() &&\n      state.visibleObj === \"userSheets\" && (\n        <Widget\n          src={`beachsunandrockandroll.near/widget/userSheets`}\n          props={{\n            action: (sheetId) => {\n              State.update({ visibleObj: \"sheet\", sheetIdx: sheetId });\n            },\n          }}\n        />\n      )}\n    {!!state.sender && isUserRegistered() && state.visibleObj === \"sheet\" && (\n      <Widget\n        src={`beachsunandrockandroll.near/widget/sheet`}\n        props={{\n          action: viewSheet,\n          sheetIdx: state.sheetIdx,\n          back: () => State.update({ visibleObj: \"userSheets\" }),\n        }}\n      />\n    )}\n    {!!state.sender &&\n      isUserRegistered() &&\n      state.visibleObj === \"composerList\" && (\n        <Widget\n          src={`beachsunandrockandroll.near/widget/composerList`}\n          props={{\n            back: () => State.update({ visibleObj: \"userSheets\" }),\n          }}\n        />\n      )}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/beachsunandrockandroll.near/widget/ProdigyPianoDiary", "fact_widget_deployments_id": "026d22254c0029be7d5a44973289b14d", "inserted_timestamp": "2023-11-18T20:34:02.914Z", "modified_timestamp": "2023-11-18T20:34:02.914Z", "__row_index": 0}