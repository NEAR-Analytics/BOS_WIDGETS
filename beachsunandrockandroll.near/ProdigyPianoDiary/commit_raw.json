{"tx_hash": "HzgdpXh8Yudg7jyU2vrYK3VgSA7Us9qUT46HWqWujVv1", "action_id_social": "3WgKWqpkkBJctmgqrFjxGy6JPfoDikVX2muLncjF4YrR-0-widget", "block_id": 105995983, "block_timestamp": "2023-11-18T18:23:51.094Z", "signer_id": "beachsunandrockandroll.near", "widget_name": "ProdigyPianoDiary", "source_code": "const [user, setUser] = useState(\"\");\nconst [sheetIdx, setSheetIdx] = useState(\"\");\n\nconst { getNormalDate, ppdContract, ppdAbi } = VM.require(\n  \"beachsunandrockandroll.near/widget/utils\"\n);\n\nState.init({\n  visibleObj: \"userSheets\",\n});\n\nconst getUsers = () => {\n  const ppd = new ethers.Contract(\n    ppdContract,\n    ppdAbi.body,\n    Ethers.provider().getSigner()\n  );\n\n  ppd.getUsers().then((res) => {\n    State.update({ users: res });\n  });\n};\n\n// const getComposerSheets = () => {\n//   const ppd = new ethers.Contract(\n//     ppdContract,\n//     ppdAbi.body,\n//     Ethers.provider().getSigner()\n//   );\n//   console.log(\"llamando cs\");\n//   try {\n//     ppd.getComposerSheets(0).then((res) => {\n//       console.log(\"en composer sheets\");\n//       console.log(res);\n//       // const comp = res && res.map((r) => r[0]);\n//       // State.update({ composers: comp });\n//     });\n//   } catch (e) {\n//     console.log(e);\n//   }\n// };\n\nconst isUserRegistered = () => {\n  if (!state.users) return false;\n\n  const userTmp = state.users.find(\n    (user) => user[0].toLowerCase() === state.sender\n  );\n\n  if (userTmp != undefined) setUser(userTmp);\n\n  return userTmp != undefined;\n};\n\nif (state.sender === undefined) {\n  const accounts = Ethers.send(\"eth_requestAccounts\", []);\n  if (accounts.length) {\n    State.update({ sender: accounts[0] });\n    getUsers();\n  }\n}\n\nreturn (\n  <>\n    {user !== \"\" && (\n      <div class=\"mt-4 p-3\">\n        <button\n          onClick={() => {\n            State.update({ visibleObj: \"composerList\" });\n          }}\n        >\n          Get composer List\n        </button>\n        <button\n          onClick={() => {\n            State.update({ visibleObj: \"userSheets\" });\n          }}\n        >\n          Get my Sheets\n        </button>\n      </div>\n    )}\n\n    {!!state.sender ? (\n      <>\n        {!isUserRegistered() && (\n          <Widget src={`beachsunandrockandroll.near/widget/registerUser`} />\n        )}\n      </>\n    ) : (\n      <Web3Connect connectLabel=\"Connect with Web3\" />\n    )}\n    {/*{user && <>{user[1]}</>}\n\n    */}\n    {!!state.sender &&\n      isUserRegistered() &&\n      state.visibleObj === \"userSheets\" && (\n        <Widget\n          src={`beachsunandrockandroll.near/widget/userSheets`}\n          props={{\n            action: (sheetId) => {\n              State.update({ visibleObj: \"sheet\", sheetIdx: sheetId });\n            },\n          }}\n        />\n      )}\n    {!!state.sender && isUserRegistered() && state.visibleObj === \"sheet\" && (\n      <Widget\n        src={`beachsunandrockandroll.near/widget/sheet`}\n        props={{\n          action: viewSheet,\n          sheetIdx: state.sheetIdx,\n          back: () => State.update({ visibleObj: \"userSheets\" }),\n        }}\n      />\n    )}\n    {!!state.sender &&\n      isUserRegistered() &&\n      state.visibleObj === \"composerList\" && (\n        <Widget\n          src={`beachsunandrockandroll.near/widget/composerList`}\n          props={{\n            back: () => State.update({ visibleObj: \"userSheets\" }),\n          }}\n        />\n      )}\n  </>\n);\n", "metadata": {"platform": "jutsu.ai"}, "branch": {"draft": null}, "widget_modules_used": null, "widget_url": "https://near.social/#/beachsunandrockandroll.near/widget/ProdigyPianoDiary", "fact_widget_deployments_id": "7dd8aa05e37a6b9a857034148541f54d", "inserted_timestamp": "2023-11-18T20:24:41.143Z", "modified_timestamp": "2023-11-18T20:24:41.143Z", "__row_index": 1}