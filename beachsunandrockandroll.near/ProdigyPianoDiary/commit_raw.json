{"tx_hash": "2Jm9eJMxc6hM51GreksPBN3mwN4ivSrp57PuysY4fPWC", "action_id_social": "CABt8BMBNLgnbuNihUVmvFyTZZpwTMvH6Co6qzfH9YBX-0-widget", "block_id": 106012798, "block_timestamp": "2023-11-18T23:13:44.827Z", "signer_id": "beachsunandrockandroll.near", "widget_name": "ProdigyPianoDiary", "source_code": "const [user, setUser] = useState(\"\");\nconst [sheetIdx, setSheetIdx] = useState(\"\");\n\nconst { getNormalDate, ppdContract, ppdAbi } = VM.require(\n  \"beachsunandrockandroll.near/widget/utils\"\n);\n\nconst Wrapper = styled.div`\n  background-color: #e7e1db;\n  height: 100%;\n`;\n\nState.init({\n  visibleObj: \"userSheets\",\n});\n\nconst getUsers = () => {\n  const ppd = new ethers.Contract(\n    ppdContract,\n    ppdAbi.body,\n    Ethers.provider().getSigner()\n  );\n\n  ppd.getUsers().then((res) => {\n    State.update({ users: res });\n  });\n};\n\nconst isUserRegistered = () => {\n  if (!state.users) return false;\n\n  const userTmp = state.users.find(\n    (user) => user[0].toLowerCase() === state.sender\n  );\n\n  if (userTmp != undefined) setUser(userTmp);\n\n  return userTmp != undefined;\n};\n\nif (state.sender === undefined) {\n  const accounts = Ethers.send(\"eth_requestAccounts\", []);\n  if (accounts.length) {\n    State.update({ sender: accounts[0] });\n    getUsers();\n  }\n}\n\nreturn (\n  <Wrapper>\n    <Widget src={`beachsunandrockandroll.near/widget/header`} />\n    {!!state.sender ? (\n      <>\n        {!isUserRegistered() && (\n          <Widget src={`beachsunandrockandroll.near/widget/registerUser`} />\n        )}\n      </>\n    ) : (\n      <div class=\"text-center\">\n        <h1 class=\"fw-bold pt-5\">Welcome to Prodigy Piano Diary</h1>\n        <h3>Transformative Practice for Pianists</h3>\n        <img\n          src=\"https://raw.githubusercontent.com/gonzalobarria/prodigy-piano-diary/master/public/images/piano-hand.png\"\n          alt=\"PPD\"\n        />\n      </div>\n    )}\n    {user !== \"\" && (\n      <div class=\"mt-4 p-3\">\n        <button\n          onClick={() => {\n            State.update({ visibleObj: \"composerList\" });\n          }}\n        >\n          Get composer List\n        </button>\n        <button\n          onClick={() => {\n            State.update({ visibleObj: \"userSheets\" });\n          }}\n        >\n          Get my Sheets\n        </button>\n      </div>\n    )}\n\n    {/*{user && <>{user[1]}</>}\n\n    */}\n    {!!state.sender &&\n      isUserRegistered() &&\n      state.visibleObj === \"userSheets\" && (\n        <Widget\n          src={`beachsunandrockandroll.near/widget/userSheets`}\n          props={{\n            action: (sheetId) => {\n              State.update({ visibleObj: \"sheet\", sheetIdx: sheetId });\n            },\n          }}\n        />\n      )}\n    {!!state.sender && isUserRegistered() && state.visibleObj === \"sheet\" && (\n      <Widget\n        src={`beachsunandrockandroll.near/widget/sheet`}\n        props={{\n          action: viewSheet,\n          sheetIdx: state.sheetIdx,\n          back: () => State.update({ visibleObj: \"userSheets\" }),\n        }}\n      />\n    )}\n    {!!state.sender &&\n      isUserRegistered() &&\n      state.visibleObj === \"composerList\" && (\n        <Widget\n          src={`beachsunandrockandroll.near/widget/composerList`}\n          props={{\n            back: () => State.update({ visibleObj: \"userSheets\" }),\n          }}\n        />\n      )}\n  </Wrapper>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/beachsunandrockandroll.near/widget/ProdigyPianoDiary", "fact_widget_deployments_id": "23a7719f423f1c846e87fb4c6d428b95", "inserted_timestamp": "2023-11-19T01:00:52.152Z", "modified_timestamp": "2023-11-19T01:00:52.152Z", "__row_index": 4}