{"tx_hash": "Fhr35PnT8qJ68T4iW4UB96oje5xrz9V1Qu1zYsH4WqjX", "action_id_social": "5Kj9WiFEXSeVdEyMbwEKEc7jMdymA4JKGmbHN2m8i5HY-0-widget", "block_id": 105980484, "block_timestamp": "2023-11-18T13:52:49.772Z", "signer_id": "beachsunandrockandroll.near", "widget_name": "sheet", "source_code": "const sheetIdx = props.sheetIdx || 0;\nconst back = props.back;\n\nconst { getNormalDate, ppdContract, ppdAbi } = VM.require(\n  \"beachsunandrockandroll.near/widget/utils\"\n);\n\nState.init({\n  userSheets: [],\n});\n\nconst getUserSheets = () => {\n  if (ppdContract == undefined) return;\n\n  const ppd = new ethers.Contract(\n    ppdContract,\n    ppdAbi.body,\n    Ethers.provider().getSigner()\n  );\n\n  ppd.getUserIdx().then((userIdx) => {\n    ppd.getUserSheets(parseInt(userIdx.toString())).then((userSheets) => {\n      userSheets.map((userSheet, i) => {\n        if (i === sheetIdx) {\n          const sheet = {\n            name: userSheet[0],\n            createdAt: getNormalDate(userSheet[1]),\n            difficulty: userSheet[2],\n            dataUri: userSheet[3],\n          };\n          State.update({ sheet });\n        }\n      });\n    });\n  });\n};\n\nconst getRecordsBySheet = () => {\n  const ppd = new ethers.Contract(\n    ppdContract,\n    ppdAbi.body,\n    Ethers.provider().getSigner()\n  );\n\n  ppd.getUserIdx().then((userIdx) => {\n    ppd\n      .getRecordsBySheet(parseInt(userIdx.toString()), sheetIdx)\n      .then((res) => {\n        console.log(res);\n        let records = [];\n        res.map((r) => {\n          console.log(r[5] === false);\n          records.push({\n            phraseNum: parseInt(r[0].toString()),\n            subPhraseNum: parseInt(r[1].toString()),\n            qtyMinutes: r[2],\n            studyType: r[3],\n            focusType: r[4],\n            isAllSheet: r[5] === true,\n            createdAt: parseInt(r[6].toString()),\n          });\n        });\n        // const comp = res && res.map((r) => r[0]);\n        State.update({ records });\n      });\n  });\n};\n\nif (state.sender === undefined) {\n  const accounts = Ethers.send(\"eth_requestAccounts\", []);\n  if (accounts.length) {\n    State.update({ sender: accounts[0] });\n    getUserSheets();\n    getRecordsBySheet();\n  }\n}\n\nreturn (\n  <>\n    <h2>{state.sheet.name}</h2>\n    <button onClick={back}>Back</button>\n    {state.records &&\n      state.records.map((record) => {\n        return (\n          <>\n            <div>Phrase Number: {record.phraseNum}</div>\n            <div>Qty Minutes: {record.qtyMinutes}</div>\n            <div>Study Type: {record.studyType}</div>\n            <div>Focus Type: {record.focusType}</div>\n            <div>is all sheet?: {record.isAllSheet ? \"yes\" : \"no\"}</div>\n            <div>SubPhrase Number: {record.subPhraseNum}</div>\n            <div>Created at: {getNormalDate(record.createdAt)}</div>\n          </>\n        );\n      })}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/beachsunandrockandroll.near/widget/sheet", "fact_widget_deployments_id": "75453f2ca812513fea19d0b5a5aa8027", "inserted_timestamp": "2023-11-18T15:43:27.160Z", "modified_timestamp": "2023-11-18T15:43:27.160Z", "__row_index": 2}