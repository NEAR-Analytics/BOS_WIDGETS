{"tx_hash": "CMA4Y5Qmfbw5NiHcm9DwBADgkdxBpyzkbkob3Ck3Mohs", "action_id_social": "5E6NJzymmsDjgyaCtnuDWrxa7wfE288eAYoFJii4ntja-0-widget", "block_id": 106019706, "block_timestamp": "2023-11-19T01:11:26.782Z", "signer_id": "beachsunandrockandroll.near", "widget_name": "addSheet", "source_code": "const setAddSheet = props.setAddSheet;\n\nconst { ppdContract, ppdAbi } = VM.require(\n  \"beachsunandrockandroll.near/widget/utils\"\n);\n\nconst [sheetName, setSheetName] = useState(\"\");\nconst [composerIdx, setComposerIdx] = useState(0);\nconst [difficulty, setDifficulty] = useState(0);\n\nState.init({\n  img: null,\n});\n\nconst addSheet = () => {\n  if (ppdContract == undefined) return;\n\n  const ppd = new ethers.Contract(\n    ppdContract,\n    ppdAbi.body,\n    Ethers.provider().getSigner()\n  );\n\n  ppd.getUserIdx().then((userIdx) => {\n    let dataUri = \"\";\n    if (state.img.cid) dataUri = state.img.cid;\n\n    ppd\n      .addSheet(\n        sheetName,\n        composerIdx,\n        Big(userIdx).toFixed(),\n        parseInt(difficulty),\n        dataUri\n      )\n      .then(() => {\n        setAddSheet(false);\n      });\n  });\n};\n\nconst getComposers = () => {\n  if (ppdContract == undefined) return;\n\n  const ppd = new ethers.Contract(\n    ppdContract,\n    ppdAbi.body,\n    Ethers.provider().getSigner()\n  );\n\n  ppd.getComposers().then((res) => {\n    const comp = res && res.map((r) => r[0]);\n    State.update({ composers: comp });\n  });\n};\n\nuseEffect(() => {\n  getComposers();\n}, [ppdContract]);\n\nreturn (\n  <>\n    <div>\n      <h5 class=\"text-center pb-2\">Fill the Form to Add a new Sheet</h5>\n      <input\n        className=\"form-control m-2 p-2\"\n        type=\"text\"\n        id=\"sheetName\"\n        name=\"sheetName\"\n        required\n        placeholder=\"Name of the Sheet\"\n        onChange={(event) => {\n          setSheetName(event.target.value);\n        }}\n      />\n      <Typeahead\n        className=\"p-2\"\n        options={state.composers}\n        // multiple\n        onChange={(value) => {\n          setComposerIdx(0);\n        }}\n        placeholder=\"Select Composer\"\n      />\n      <div class=\"px-2 pb-2\">\n        Sheet upload: <br />\n        <IpfsImageUpload image={state.img} />\n      </div>\n      <input\n        className=\"form-control m-2 p-2\"\n        type=\"number\"\n        id=\"difficulty\"\n        name=\"difficulty\"\n        required\n        placeholder=\"Level of Difficulty\"\n        onChange={(event) => {\n          setDifficulty(event.target.value);\n        }}\n      />\n      <div class=\"px-2 pt-2\">\n        <button onClick={addSheet}>Add Sheet</button>\n        <button\n          onClick={() => {\n            setAddSheet(false);\n          }}\n          class=\"btn btn-outline-secondary\"\n        >\n          Close\n        </button>\n      </div>\n    </div>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/beachsunandrockandroll.near/widget/addSheet", "fact_widget_deployments_id": "094cf9c5ed9edb9d4f63512f94265cc6", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}