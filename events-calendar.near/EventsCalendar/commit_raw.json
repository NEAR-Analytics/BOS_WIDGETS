{"tx_hash": "EdqKKM5j8pgWezetKYAmhFfnXPyP3QpumZoeWJpWdZg7", "action_id_social": "DPk1TodaXoN6odJUxM7U2jVwtrtzgF3j4FRzfknRwAz5-0-widget", "block_id": 106937314, "block_timestamp": "2023-12-01T15:51:49.313Z", "signer_id": "events-calendar.near", "widget_name": "EventsCalendar", "source_code": "// Contrato Inteligente a utilizar\nconst contract = \"bookstorebos.near\";\n\n// M\u00e9todos de consulta para obtener el listado de eventos\nconst books = Near.view(contract, \"all_books\", {});\nconst booksbuy = context.accountId\n  ? Near.view(contract, \"books_for_owner\", {\n      account_id: context.accountId,\n    })\n  : [];\n\n// Inicializaci\u00f3n del objeto de estado con propiedades\nState.init({\n  title: \"\",\n  description: \"\",\n  author: \"\",\n  year: \"\",\n  price: \"\",\n  stock: \"\",\n});\n\n// M\u00e9todo para agregar un evento\nconst createBook = () => {\n  if (state.title == \"\") {\n    return console.log(\"El nombre del organizador no debe estar vacio\");\n  }\n  if (state.description == \"\") {\n    return console.log(\"La descripcion del tema no debe estar vacio\");\n  }\n  if (state.author == \"\") {\n    return console.log(\"La fecha del evento no debe estar vacio\");\n  }\n  if (state.year == \"\") {\n    return console.log(\"La hora del evento no debe estar vacio\");\n  }\n  if (state.price == \"\") {\n    return console.log(\"El link del evento no debe estar vacio\");\n  }\n  if (state.stock == \"\") {\n    return console.log(\n      \"Agrega algun premio por participaci\u00f3n, POAP o cualquier informacion adicional\"\n    );\n  }\n\n  Near.call(contract, \"create_book\", {\n    title: state.title,\n    description: state.description,\n    author: state.author,\n    year: state.year,\n    price: state.price,\n    stock: state.stock,\n  });\n};\n\n// M\u00e9todo para comprar un libro\nconst buyBook = (book_id, price) => {\n  const amount = price * 1000000000000000000000;\n  Near.call(\n    contract,\n    \"buy_book\",\n    {\n      book_id: book_id,\n    },\n    300000000000000,\n    amount\n  );\n};\n\n// Renderizado de la UI\nreturn (\n  <>\n    <div class=\"container border border-info p-3\">\n      <h3 class=\"text-center\">Eventos de Comunidades Criptos en LATAM</h3>\n      <br />\n      {context.accountId ? (\n        <div class=\"border border-black p-3\">\n          <h3>Ingresa tu Evento</h3>\n          <div class=\"container\">\n            <div class=\"row\">\n              <div class=\"col-sm\">\n                <input\n                  placeholder=\"Organizador\"\n                  onChange={(e) => State.update({ title: e.target.value })}\n                />\n              </div>\n              <div class=\"col-sm\">\n                <input\n                  placeholder=\"Tema\"\n                  onChange={(e) =>\n                    State.update({ description: e.target.value })\n                  }\n                />\n              </div>\n              <div class=\"col-sm\">\n                <input\n                  placeholder=\"Fecha\"\n                  onChange={(e) => State.update({ author: e.target.value })}\n                />\n              </div>\n            </div>\n            <br />\n            <div class=\"row\">\n              <div class=\"col-sm\">\n                <input\n                  placeholder=\"Hora\"\n                  onChange={(e) => State.update({ year: e.target.value })}\n                />\n              </div>\n              <div class=\"col-sm\">\n                <input\n                  placeholder=\"Link\"\n                  onChange={(e) => State.update({ price: e.target.value })}\n                />\n              </div>\n              <div class=\"col-sm\">\n                <input\n                  placeholder=\"Extras\"\n                  onChange={(e) => State.update({ stock: e.target.value })}\n                />\n              </div>\n            </div>\n            <br />\n            <button\n              class=\"btn btn-primary mt-2\"\n              onClick={async () => {\n                createBook();\n              }}\n            >\n              Guardar\n            </button>\n          </div>\n        </div>\n      ) : (\n        <p class=\"text-center py-2\">\n          Debes iniciar sesi\u00f3n para ingresar eventos\n        </p>\n      )}\n      <br />\n      <div class=\"border border-black p-3\">\n        <h3>Pr\u00f3ximos Eventos:</h3>\n        <table className=\"table table-hover table-sm\">\n          <thead>\n            <tr class=\"p-3 mb-2 bg-primary bg-gradient text-white rounded-5 text-center\">\n              <th>Organizador</th>\n              <th>Tema</th>\n              <th>Fecha</th>\n              <th>Hora</th>\n              <th></th>\n              <th>Link</th>\n              <th>Extras</th>\n            </tr>\n          </thead>\n          <tbody>\n            {books.map((data, key) => {\n              return (\n                <>\n                  <tr class=\"text-center\">\n                    <td>{data.title}</td>\n                    <td>{data.author}</td>\n                    <td>{data.stock}</td>\n                    <td>{data.price}</td>\n                    <td>\n                      {context.accountId ? (\n                        <button\n                          class=\"btn btn-primary\"\n                          onClick={async () => {\n                            buyBook(data.book_id, data.price);\n                          }}\n                        >\n                          Asistir\u00e9\n                        </button>\n                      ) : (\n                        <span></span>\n                      )}\n                    </td>\n                  </tr>\n                </>\n              );\n            })}\n          </tbody>\n        </table>\n      </div>\n      <br />\n      {context.accountId ? (\n        <div class=\"border border-black p-3\">\n          <h3>Eventos a los que asistir\u00e9</h3>\n          <table className=\"table table-hover table-sm\">\n            <thead>\n              <tr class=\"p-3 mb-2 bg-primary bg-gradient text-white rounded-5 text-center\">\n                <th>Organizador</th>\n                <th>Tema</th>\n              </tr>\n            </thead>\n            <tbody>\n              {booksbuy.map((data, key) => {\n                return (\n                  <>\n                    <tr class=\"text-center\">\n                      <td>{data.title}</td>\n                      <td>{data.author}</td>\n                    </tr>\n                  </>\n                );\n              })}\n            </tbody>\n          </table>\n        </div>\n      ) : (\n        <span></span>\n      )}\n    </div>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/events-calendar.near/widget/EventsCalendar", "fact_widget_deployments_id": "e28235789f0eb13ab8301aa054776501", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}