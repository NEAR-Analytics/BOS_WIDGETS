{"tx_hash": "EHWcxW7ybZmdgnHgH3KLTogqYvmoAhL2AeAjUc7hmvc6", "action_id_social": "5EiyyiiPDkEhKRrn2e9XNQKEjAGsqxtLZVwGQfYVcUXv-0-widget", "block_id": 115714422, "block_timestamp": "2024-03-29T11:20:43.464Z", "signer_id": "ndcdev.near", "widget_name": "daos-staging.Pages.Proposals.Create", "source_code": "let { contractName } = VM.require(`ndcdev.near/widget/daos-staging.Config`);\n\nif (!contractName) return <Widget src=\"flashui.near/widget/Loading\" />;\n\nconst { dao_id, id } = props;\nconst accountId = context.accountId;\n\nconst Container = styled.div`\n  position: relative;\n  width: 100%;\n  height: max-content;\n  overflow: hidden;\n  padding: 1rem 0 5rem 0;\n\n  h3 {\n    font-size: 2rem;\n    font-weight: 400;\n  }\n\n  h4 {\n    font-size: 1.5rem;\n    font-weight: 300;\n  }\n`;\n\nconst FormWrapper = styled.div`\n  width: 100%;\n\n  @media screen and (max-width: 786px) {\n    width: 100%;\n    padding: 1rem;\n  }\n`;\n\nconst form = {\n  Report: [\n    {\n      name: \"title\",\n      label: \"Title\",\n      value: \"\",\n      type: \"text\",\n      required: true,\n    },\n    {\n      name: \"proposal_id\",\n      label: \"Proposal ID\",\n      value: \"\",\n      type: \"text\",\n      required: false,\n    },\n    {\n      name: \"audience\",\n      label:\n        \"How many people did your project reach during this funding period?\",\n      value: \"\",\n      type: \"number\",\n      required: false,\n    },\n    {\n      name: \"growth\",\n      label:\n        \"How does this month's audience reach compare to previous periods (provide a %)\",\n      value: \"\",\n      type: \"number\",\n      required: false,\n    },\n    {\n      name: \"average_engagement_rate\",\n      label:\n        \"What is the average engagement rate on your project's primary platform (choose one)? Use the formula (Total Likes, Shares & Comments / Total Followers) X 100 = AER %\",\n      value: \"\",\n      type: \"number\",\n      required: false,\n    },\n    {\n      name: \"performance_statement_1\",\n      label:\n        \"What is the biggest win (most improved part of project) during this funding period vs. the previous one (if applicable)?\",\n      value: \"\",\n      type: \"textarea\",\n      required: false,\n    },\n    {\n      name: \"performance_statement_2\",\n      label:\n        \"What is the biggest challenge your project is facing? What did not improve during this funding period?\",\n      value: \"\",\n      type: \"textarea\",\n      required: false,\n    },\n  ],\n  Proposal: [\n    {\n      name: \"title\",\n      label: \"Title\",\n      value: \"\",\n      type: \"text\",\n      required: true,\n    },\n    {\n      name: \"description\",\n      label: \"Description\",\n      value: \"# Title\\n## Description\",\n      type: \"textarea\",\n      required: true,\n    },\n    {\n      name: \"requested_amount\",\n      label: \"Requested Amount (USD)\",\n      value: \"\",\n      type: \"number\",\n      min: \"0\",\n      required: false,\n    },\n    {\n      name: \"tags\",\n      label: \"Tags\",\n      value: \"\",\n      type: \"tag\",\n    },\n  ],\n};\n\nconst [post, setPost] = useState(null);\nconst [formEls, setFormEls] = useState({\n  accountId: accountId,\n  post_type: \"Proposal\",\n  title: \"\",\n  description: form.Proposal.find((el) => el.name === \"description\").value,\n});\n\nif (id) {\n  const post = Near.view(contractName, \"get_post_by_id\", { id: parseInt(id) });\n  setPost(post);\n}\n\nlet daos = null;\ndaos = Near.view(contractName, \"get_dao_list\");\n\nconst [errors, setErrors] = useState({});\nconst [selectedDaoId, setSelectedDaoId] = useState(0);\nconst [attachments, setAttachments] = useState([]);\n\nuseEffect(() => {\n  if (post) {\n    setFormEls({\n      ...formEls,\n      title: post.title,\n      description: post.description,\n      requested_amount: post.requested_amount ?? 0,\n      tags: post.labels ?? [],\n    });\n    setAttachments(post.attachments);\n  }\n}, [post]);\n\nuseEffect(() => {\n  if (daos) {\n    setSelectedDaoId(daos.find((d) => d.handle === dao_id).id || daos[0].id);\n  }\n}, [daos]);\n\nconst handleChange = (el, value) => {\n  if (el.name === \"requested_amount\" && value.startsWith(\"-\")) return;\n  const newFormEl = formEls;\n  const newFormElErrors = errors;\n  newFormEl[el.name] = value;\n  newFormElErrors[el.name] = value.length < 1;\n\n  setErrors(newFormElErrors);\n  setFormEls(newFormEl);\n};\n\nif (daos) {\n  daos = daos.map((dao) => {\n    return { name: dao.title, id: dao.id };\n  });\n}\n\nif (!daos) return <Widget src=\"flashui.near/widget/Loading\" />;\n\nconst handleSelectDao = (e) => {\n  setSelectedDaoId(e.target.value);\n};\n\nconst handleAttachments = (file) => {\n  setAttachments([file]);\n};\n\nconst handleSave = () => {\n  if (!accountId) return;\n\n  let body = {\n    title: formEls.title,\n    labels: formEls.tags ?? [],\n    post_type: formEls.post_type,\n    requested_amount: parseInt(formEls.requested_amount ?? 0),\n    description: formEls.description,\n    metrics: {},\n    reports: [],\n    attachments,\n  };\n\n  if (formEls.post_type === \"Report\") {\n    body.proposal_id = parseInt(formEls.proposal_id);\n    body.metrics = {\n      audience: formEls[\"audience\"],\n      growth: formEls[\"growth\"],\n      average_engagement_rate: formEls[\"average_engagement_rate\"],\n      performance_statement_1: formEls[\"performance_statement_1\"],\n      performance_statement_2: formEls[\"performance_statement_2\"],\n    };\n    body.report_version = \"V1\";\n  } else {\n    body.proposal_version = \"V1\";\n  }\n\n  id\n    ? Near.call(contractName, \"edit_post\", { id: parseInt(id), body })\n    : Near.call(\n        contractName,\n        \"add_post\",\n        {\n          dao_id: parseInt(selectedDaoId),\n          body,\n        },\n        \"200000000000000\",\n        10000000000000000000000,\n      );\n};\n\nreturn (\n  <Container>\n    <div className=\"d-flex justify-content-center\">\n      <FormWrapper className=\"mt-3 mb-5 d-flex flex-column gap-3\">\n        <div className=\"title d-flex flex-column align-items-center text-center mb-4\">\n          <h1>DAO Post creation Form</h1>\n          <div className=\"mt-3 text-center\">\n            <p>\n              <b>Please use this form to report key performance metrics.</b>\n            </p>\n          </div>\n        </div>\n\n        <Widget\n          src=\"ndcdev.near/widget/daos-staging.Components.Form\"\n          props={{\n            form,\n            formEls,\n            setFormEls,\n            handleChange,\n            handleSave,\n            handleSelectDao,\n            handleAttachments,\n            attachments,\n            daos,\n            selectedDaoId,\n            id,\n          }}\n        />\n      </FormWrapper>\n    </div>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/ndcdev.near/widget/daos-staging.Pages.Proposals.Create", "fact_widget_deployments_id": "750c93625aa624ce56c433be98a34b58", "inserted_timestamp": "2024-03-29T12:35:00.532Z", "modified_timestamp": "2024-03-29T13:29:16.475Z", "__row_index": 2}