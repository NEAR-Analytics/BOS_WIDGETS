{"tx_hash": "ESSL4W4QbYqfd9Kvexph1LxMD7Xm7AoPRBM5z6bo4eWf", "action_id_social": "B8okRTtcQLBXxDwkS3xbCwYVvoxsuHC594TKr3rSXRsb-0-widget", "block_id": 111872822, "block_timestamp": "2024-02-01T18:41:40.966Z", "signer_id": "ndcdev.near", "widget_name": "MDAO.Components.MarkdownEditor", "source_code": "const { element, handleChange } = props;\n\nconst AutoComplete = styled.div`\n  z-index: 5;\n\n  &\n    > [data-component=\"devhub.near/widget/devhub.components.molecule.AccountAutocomplete\"] {\n    ::before {\n      background: none;\n    }\n    background: linear-gradient(\n      258deg,\n      rgba(162, 195, 254, 0.25) 0%,\n      rgba(225, 197, 252, 0.25) 28.72%,\n      rgba(241, 220, 210, 0.25) 100%\n    );\n    border-radius: 10px;\n    padding: 5px;\n  }\n`;\nconst [text, setText] = useState(element.value);\nconst [handler, setHandler] = useState(null);\nconst [mentionInput, setMentionInput] = useState(\"\");\nconst [mentionsArray, setMentionsArray] = useState([]);\nconst [showAccountAutocomplete, setShowAccountAutocomplete] = useState(false);\n\nfunction handleTextChange(value) {\n  const words = value.split(/\\s+/);\n  const allMentiones = words\n    .filter((word) => word.startsWith(\"@\"))\n    .map((mention) => mention.slice(1));\n  const newMentiones = allMentiones.filter(\n    (item) => !mentionsArray.includes(item)\n  );\n\n  setText(value);\n  setShowAccountAutocomplete(newMentiones?.length > 0);\n  setMentionInput(newMentiones?.[0] ?? \"\");\n  setMentionsArray(allMentiones);\n}\n\nfunction handleAutoComplete(id) {\n  let currentIndex = 0;\n  const updatedText = text.replace(/(?:^|\\s)(@[^\\s]*)/g, (match) => {\n    if (currentIndex === mentionsArray.indexOf(mentionInput)) {\n      currentIndex++;\n      return ` @${id}`;\n    } else {\n      currentIndex++;\n      return match;\n    }\n  });\n\n  setHandler(\"autocompleteSelected\");\n  setShowAccountAutocomplete(false);\n  setText(updatedText);\n}\n\nreturn (\n  <>\n    <Widget\n      src={\"devhub.near/widget/devhub.components.molecule.MarkdownEditor\"}\n      props={{\n        data: { handler, content: text },\n        onChange: (val) => {\n          handleChange(element, val);\n          setHandler(\"update\");\n          handleTextChange(val);\n        },\n      }}\n    />\n    {showAccountAutocomplete && (\n      <AutoComplete>\n        <Widget\n          src=\"devhub.near/widget/devhub.components.molecule.AccountAutocomplete\"\n          props={{\n            term: mentionInput,\n            onSelect: handleAutoComplete,\n            onClose: () => setShowAccountAutocomplete(false),\n          }}\n        />\n      </AutoComplete>\n    )}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/ndcdev.near/widget/MDAO.Components.MarkdownEditor", "fact_widget_deployments_id": "c46dbebfbcc74184e3068516bfa1883e", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 2}