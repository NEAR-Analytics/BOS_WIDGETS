{"tx_hash": "HpdhpMkLiPr1ZGF9cEQCxMVGRSU7XAxKisVUDoh1UMxD", "action_id_social": "FVw7vgqNPEUaTmmr9TCfagL9dJ3wLLbWUCP8KiibLEpG-0-widget", "block_id": 111043513, "block_timestamp": "2024-01-22T14:57:27.280Z", "signer_id": "ndcdev.near", "widget_name": "Dashboard.Pages.Home", "source_code": "const { ndcDAOs } = VM.require(`ndcdev.near/widget/Dashboard.Config`);\nconst { Container, ChartContainer } = VM.require(\n  `ndcdev.near/widget/Dashboard.Pages.styled`,\n);\n\nif (!ndcDAOs || !Container || !ChartContainer)\n  return <Widget src=\"flashui.near/widget/Loading\" />;\n\nconst PERIODS = [\"daily\", \"weekly\", \"monthly\"];\nconst defaultDAOOption = \"All DAOs\";\n\nconst dailyTotal = {\n  labels: [],\n  data: [],\n};\n\nconst dailyTotalUsers = {\n  labels: [],\n  data: [],\n};\n\nconst [loading, setLoading] = useState(false);\nconst [totalTx, setTotalTx] = useState(0);\nconst [totalAccounts, setTotalAccounts] = useState(0);\nconst [uniqueAccounts, setUniqueAccounts] = useState(0);\nconst [period, setPeriod] = useState(PERIODS[0]);\nconst [selectedDAOs, setSelectedDAOs] = useState([]);\nconst [dailyTotalTx, setdailyTotalTx] = useState([]);\nconst [uniqueActiveUsers, setUniqueActiveUsers] = useState([]);\n\nconst baseUrl = \"https://api.pikespeak.ai\";\n\nconst get = async (url) =>\n  asyncFetch(`${baseUrl}/${url}`, {\n    method: \"GET\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      \"x-api-key\": \"36f2b87a-7ee6-40d8-80b9-5e68e587a5b5\",\n    },\n  });\n\nconst API = {\n  get_total_tx: (accountId) => get(`account/tx-count/${accountId}`),\n  get_daily_total_tx: (accountId) => get(`account/daily-tx-count/${accountId}`),\n  get_accounts: (accountId) =>\n    get(`event-historic/account/relationships/${accountId}?search=${accountId}\n  `),\n  get_unique_accounts_by_period: (accountId) =>\n    get(`contract-analysis/unique-users-by-period/${accountId}`),\n  get_activity_by_period: (accountId) =>\n    get(`contract-analysis/metrics/${accountId}`),\n  get_retentions: (accountId) =>\n    get(`contract-analysis/retention/${accountId}`),\n};\n\nconst fetchData = () => {\n  setLoading(true);\n  let _totalTx = 0;\n  let _totalAccounts = 0;\n  let _uniqueAccounts = 0;\n  let _uniqueActiveUsers = [];\n  let _dailyTotalTx = [];\n  const daos = selectedDAOs.length ? selectedDAOs : ndcDAOs;\n\n  daos.map((accountId) => {\n    API.get_total_tx(accountId).then((resp) => {\n      _totalTx += parseInt(resp.body);\n      setTotalTx(_totalTx);\n    });\n    API.get_accounts(accountId).then((resp) => {\n      _totalAccounts += resp.body.length;\n      setTotalAccounts(_totalAccounts);\n    });\n    API.get_unique_accounts_by_period(accountId).then((resp) => {\n      _uniqueAccounts += parseInt(resp.body[period].data.length);\n      _uniqueActiveUsers.push(...resp.body[period].data);\n      setUniqueAccounts(_uniqueAccounts);\n      setUniqueActiveUsers(_uniqueActiveUsers);\n    });\n    API.get_daily_total_tx(accountId).then((res) => {\n      _dailyTotalTx.push(...res.body);\n      setdailyTotalTx(_dailyTotalTx);\n    });\n  });\n\n  setLoading(false);\n};\n\nuseEffect(() => fetchData(), [selectedDAOs, period]);\n\ndailyTotalTx\n  .sort((a, b) => new Date(a.date) - new Date(b.date))\n  .forEach((element) => {\n    dailyTotal.labels.push(element.date);\n    dailyTotal.data.push(element.count);\n  });\n\nuniqueActiveUsers\n  .sort((a, b) => new Date(a.day) - new Date(b.day))\n  .forEach((element) => {\n    dailyTotalUsers.labels.push(element.day);\n    dailyTotalUsers.data.push(element.unique_users);\n  });\n\nreturn (\n  <Container>\n    <div className=\"section\">\n      <div className=\"d-flex w-100 gap-3 justify-content-between\">\n        <div className=\"select-dao\">\n          <Widget\n            src={`ndcdev.near/widget/Dashboard.Components.Select.index`}\n            props={{\n              options: ndcDAOs,\n              defaultValue: defaultDAOOption,\n              isOpen: selectOpen,\n              multiple: true,\n              values: selectedDAOs,\n              containerClass: \"selected-container\",\n              onClear: () => setSelectedDAOs([]),\n              onChange: (value) => {\n                setSelectedDAOs(\n                  value === defaultDAOOption\n                    ? []\n                    : selectedDAOs.includes(value)\n                    ? selectedDAOs.filter(\n                        (dao) => dao !== value && dao !== defaultDAOOption,\n                      )\n                    : [...selectedDAOs, value],\n                );\n              },\n            }}\n          />\n        </div>\n        <div className=\"select-period\">\n          <Widget\n            src={`ndcdev.near/widget/Dashboard.Components.Select.index`}\n            props={{\n              options: PERIODS,\n              isOpen: selectOpen,\n              values: period,\n              onChange: setPeriod,\n              containerClass: \"selected-container\",\n            }}\n          />\n        </div>\n      </div>\n    </div>\n    <Widget\n      src={`ndcdev.near/widget/Dashboard.Components.MetricsDisplay.index`}\n      props={{\n        totalTx,\n        totalAccounts,\n        uniqueAccounts,\n        loading,\n      }}\n    />\n    <ChartContainer>\n      <Widget\n        src={`ndcdev.near/widget/Dashboard.Components.Chart.index`}\n        props={{ title: \"DAILY NUMBER OF TRANSACTIONS\", data: dailyTotal }}\n      />\n      <Widget\n        src={`ndcdev.near/widget/Dashboard.Components.Chart.index`}\n        props={{ title: \"UNIQUE ACTIVE USERS\", data: dailyTotalUsers }}\n      />\n    </ChartContainer>\n    <div className=\"section py-5\">\n      <Widget\n        src={`ndcdev.near/widget/Dashboard.Components.Table.index`}\n        props={{ ndcDAOs }}\n      />\n    </div>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/ndcdev.near/widget/Dashboard.Pages.Home", "fact_widget_deployments_id": "f09220e027e914c40601fdc95349215b", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 10}