{"tx_hash": "3rtet9xQN4ZLgT4AspSKTDms9RapSj8Hkj2aR85kyD8E", "action_id_social": "AdZGP7nn5duYPAXD3kMEAfzJdCtfwoyPFELLh6XYC2zg-0-widget", "block_id": 118095499, "block_timestamp": "2024-05-02T14:22:06.895Z", "signer_id": "ndcdev.near", "widget_name": "daos.Pages.Proposals.List", "source_code": "let { contractName } = VM.require(`ndcdev.near/widget/daos.Config`);\n\nif (!contractName || !Near) return <Widget src=\"flashui.near/widget/Loading\" />;\nconst daos = Near.view(contractName, \"get_dao_list\");\n\nlet { dao_id, type, accountId } = props;\n\nlet items = null;\nlet dao = null;\n\nif (dao_id) {\n  dao = Near.view(contractName, \"get_dao_by_handle\", {\n    handle: dao_id,\n  });\n\n  if (!dao) <Widget src=\"flashui.near/widget/Loading\" />;\n\n  items = Near.view(contractName, \"get_all_posts\", {\n    dao_id: dao.id,\n    page: 0,\n    limit: 100,\n  });\n\n  if (dao.owners.includes(context.accountId)) {\n    const inReviewItems = Near.view(contractName, \"get_all_posts\", {\n      dao_id: dao.id,\n      page: 0,\n      limit: 100,\n      status: \"InReview\",\n    });\n\n    if (items) {\n      items = [...items, ...inReviewItems];\n    }\n  }\n} else if (accountId) {\n  items = Near.view(contractName, \"get_posts_by_author\", {\n    author: accountId,\n    page: 0,\n    limit: 100,\n  });\n\n  if (items && items.length === 0) {\n    items = Near.view(contractName, \"get_all_posts\", { page: 0, limit: 100 });\n    accountId = null;\n  }\n} else\n  items = Near.view(contractName, \"get_all_posts\", { page: 0, limit: 100 });\n\nif (!items) return <Widget src=\"flashui.near/widget/Loading\" />;\n\nconst Table = styled.div`\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  margin-bottom: 1rem 0 3rem 0;\n\n  .created {\n    color: #5c656a;\n    font-size: 14px;\n    font-style: normal;\n    font-weight: 500;\n    line-height: normal;\n  }\n\n  .account-link {\n    color: #4855fc;\n  }\n\n  @media screen and (max-width: 768px) {\n    display: none;\n  }\n`;\n\nconst TableHeader = styled.div`\n  display: flex;\n  justify-content: space-between;\n  background: #f8f8f8;\n  padding: 10px 16px;\n  jusify-content: flex-start;\n`;\n\nconst TableHeaderCell = styled.div`\n  padding: 0 0 0 10px;\n  display: flex;\n  flex: ${(props) => props.flex || 1};\n\n  .selected-container {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0px 16px;\n    gap: 10px;\n    font-size: 14px;\n    font-weight: 600;\n\n    i {\n      color: #b0afb1;\n    }\n\n    &.dao {\n      @media screen and (max-width: 768px) {\n        width: 100%;\n      }\n    }\n  }\n`;\n\nconst Mobile = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 2rem;\n  width: 100%;\n\n  @media screen and (min-width: 768px) {\n    display: none;\n  }\n`;\n\nconst Select = styled.select`\n  border: none;\n  max-width: 150px;\n  height: 100%;\n  background: #f8f8f8;\n\n  @media screen and (max-width: 768px) {\n    background: unset;\n    min-width: 100%;\n    font-size: 22px;\n  }\n`;\n\nconst MobileHeader = styled.div`\n  display: flex;\n  justify-content: space-between;\n  gap: 1rem;\n  align-items: center;\n`;\n\nconst FilterButton = styled.div`\n  display: flex;\n  width: 50px;\n  height: 50px;\n  padding: 10px;\n  justify-content: center;\n  align-items: center;\n  border-radius: 95.238px;\n  border: 0.952px solid\n    var(--NEAR-Primary-Colors-Off-White-Variation-1, #f0efe7);\n  background: var(--Primary-Base-White, #fff);\n`;\n\nconst MobileTitle = styled.div`\n  color: var(--NEAR-Primary-Colors-Black-Variation-1, #000);\n  font-family: \"FK Grotesk\";\n  font-size: 20px;\n  font-style: normal;\n  font-weight: 500;\n  line-height: normal;\n`;\n\nconst FiltersContainer = styled.div`\n  display: flex;\n  height: 768px;\n  width: 100%\n  padding: 64px 16px 48px 16px;\n  flex-direction: column;\n  align-items: center;\n  flex-shrink: 0;\n  border-radius: 14px 14px 0px 0px;\n  background: var(--Primary-Base-White, #FFF);\n  box-shadow: 0px -305px 85px 0px rgba(0, 0, 0, 0.03), 0px -195px 78px 0px rgba(0, 0, 0, 0.03), 0px -110px 66px 0px rgba(0, 0, 0, 0.01), 0px -49px 49px 0px rgba(0, 0, 0, 0.01), 0px -12px 27px 0px rgba(0, 0, 0, 0.02);\n`;\n\nconst HeaderFilter = styled.div`\n  width: 100%;\n  padding: 1rem;\n`;\n\nconst FilterLayout = styled.div`\n  min-height: 50px;\n  max-height: 400px;\n  overflow-y: auto;\n  padding: 1rem 0;\n`;\n\nconst FilterEntry = styled.div`\n  padding: 10px 5px;\n  font-size: 14px;\n  background-color: ${(props) => (props.selected ? \"#F5F6FE;\" : \"white\")};\n  border-left: ${(props) => (props.selected ? \"2px solid #626AD1\" : \"none\")};\n  cursor: pointer;\n  font-size: 20px;\n\n  .dao-img {\n    width: 32px;\n    height: 32px;\n    border-radius: 50%;\n  }\n\n  .dao-container {\n    display: flex;\n    justify-content: flex-start;\n    gap: 1rem;\n  }\n\n  .text {\n    color: #666;\n  }\n\n  .owner {\n    font-size: 12px;\n  }\n\n  &:hover {\n    background-color: #f2f2f2;\n  }\n`;\n\nconst SortContainer = styled.div`\n  display: flex;\n  justify-content: space-between;\n  width: 100%;\n`;\n\nconst [filteredDao, useFilteredDao] = useState(false);\nconst [filteredStatus, useFilteredStatus] = useState(false);\n\nconst handleFilterDaoChange = () => {\n  if (e.target.value === \"all\") {\n    useFilteredDao(false);\n  } else {\n    useFilteredDao(e.target.value);\n  }\n};\n\nconst handleFilterStatusChange = (e) => {\n  if (e.target.value === \"all\") {\n    useFilteredStatus(false);\n  } else {\n    useFilteredStatus(e.target.value);\n  }\n};\n\nconst [preparedItems, setPreparedItems] = useState(items);\n\nconst statuses = [\n  { key: \"InReview\", value: \"In Review\" },\n  { key: \"New\", value: \"New\" },\n  { key: \"Approved\", value: \"Approved\" },\n  { key: \"Rejected\", value: \"Rejected\" },\n  { key: \"Closed\", value: \"Closed\" },\n];\n\nconst [sortOrders, setSortOrders] = useState({});\n\nconst sortData = (entity, field) => {\n  const isAsc = sortOrders[entity][field] !== \"ASC\";\n  const newSortOrder = isAsc ? \"ASC\" : \"DESC\";\n\n  const sortedItems = [...preparedItems].sort((a, b) => {\n    if (a[entity][field] === b[entity][field]) return 0;\n    return (\n      isAsc\n        ? a[entity][field] > b[entity][field]\n        : a[entity][field] < b[entity][field]\n    )\n      ? 1\n      : -1;\n  });\n\n  setPreparedItems(sortedItems);\n  setSortOrders({ ...sortOrders, [entity]: { [field]: newSortOrder } });\n};\n\nuseEffect(() => {\n  setPreparedItems(\n    items\n      .sort((a, b) => b.created_at - a.created_at)\n      .filter((item) => {\n        if (filteredDao) {\n          return item.post.dao_id === daos[filteredDao].id;\n        }\n        return item;\n      })\n      .filter((item) => {\n        if (filteredStatus) {\n          return item.post.status === statuses[filteredStatus].value;\n        }\n        return item;\n      }),\n  );\n}, [filteredDao, filteredStatus]);\n\nconst [showMobileFilter, setShowMobileFilter] = useState(false);\nconst [showMobileDaoFilter, setShowMobileDaoFilter] = useState(false);\nconst [showMobileStatusFilter, setShowMobileStatusFilter] = useState(false);\n\nconst handleMobileFilter = () => {\n  setShowMobileFilter(!showMobileFilter);\n};\n\nif (!preparedItems) return <Widget src=\"flashui.near/widget/Loading\" />;\n\nreturn (\n  <>\n    <Table>\n      <TableHeader>\n        <TableHeaderCell>\n          <SortContainer\n            role=\"button\"\n            onClick={() => sortData(\"post\", \"status\")}\n          >\n            <div>Status</div>\n            <div className=\"selected-container\">\n              <i className=\"ph ph-caret-up-down fs-5\" />\n            </div>\n            {/* <Select value={filteredStatus} onChange={handleFilterStatusChange}>\n              <option value=\"all\">All</option>\n              {statuses.map((status, index) => (\n                <option key={index} value={status.key}>\n                  {status.value}\n                </option>\n              ))}\n            </Select> */}\n          </SortContainer>\n        </TableHeaderCell>\n        <TableHeaderCell flex={2}>\n          <SortContainer role=\"button\" onClick={() => sortData(\"dao\", \"title\")}>\n            <div>DAO</div>\n            {/* <Select value={filteredDao} onChange={handleFilterDaoChange}>\n              <option value=\"all\">All</option>\n              {daos.map((dao, index) => (\n                <option key={index} value={dao.id}>\n                  {dao.title}\n                </option>\n              ))}\n            </Select> */}\n            <div className=\"selected-container\">\n              <i className=\"ph ph-caret-up-down fs-5\" />\n            </div>\n          </SortContainer>\n        </TableHeaderCell>\n        <TableHeaderCell\n          role=\"button\"\n          onClick={() => sortData(\"post\", \"created_at\")}\n        >\n          Created\n          <div className=\"selected-container\">\n            <i className=\"ph ph-caret-up-down fs-5\" />\n          </div>\n        </TableHeaderCell>\n        <TableHeaderCell\n          role=\"button\"\n          onClick={() => sortData(\"post\", \"author_id\")}\n        >\n          Modified\n          <div className=\"selected-container\">\n            <i className=\"ph ph-caret-up-down fs-5\" />\n          </div>\n        </TableHeaderCell>\n        <TableHeaderCell flex={3.2}>Proposals states</TableHeaderCell>\n        <TableHeaderCell></TableHeaderCell>\n        <TableHeaderCell></TableHeaderCell>\n      </TableHeader>\n\n      {preparedItems.length === 0 ? (\n        <div className=\"w-100 my-5 d-flex justify-content-center align-tems-center\">\n          <h1>No active Reports</h1>\n        </div>\n      ) : (\n        preparedItems.map((row, index) => (\n          <div key={row.post.title}>\n            <Widget\n              src=\"ndcdev.near/widget/daos.Components.Post\"\n              props={{\n                item: row.post,\n                index,\n                type,\n                rowId: row.post.id,\n                dao: row.dao,\n              }}\n            />\n          </div>\n        ))\n      )}\n    </Table>\n\n    <Mobile>\n      <>\n        <MobileHeader>\n          <MobileTitle>All Proposals</MobileTitle>\n          <FilterButton onClick={handleMobileFilter}>\n            <i class=\"ph ph-funnel\"></i>\n          </FilterButton>\n        </MobileHeader>\n        {showMobileFilter ? (\n          <FiltersContainer>\n            <HeaderFilter className=\"d-flex justify-content-between\">\n              <MobileTitle>Filters</MobileTitle>\n              <MobileTitle\n                onClick={() => setShowMobileFilter(!showMobileFilter)}\n              >\n                <i class=\"ph ph-x\"></i>\n              </MobileTitle>\n            </HeaderFilter>\n            <HeaderFilter>\n              <div\n                onClick={() => setShowMobileDaoFilter(!showMobileDaoFilter)}\n                className=\"d-flex justify-content-between\"\n              >\n                <MobileTitle>DAO</MobileTitle>\n                {showMobileDaoFilter ? (\n                  <i class=\"ph ph-caret-up\"></i>\n                ) : (\n                  <i class=\"ph ph-caret-down\"></i>\n                )}\n              </div>\n              {showMobileDaoFilter && (\n                <FilterLayout>\n                  {daos.map((dao, index) => (\n                    <FilterEntry\n                      key={index}\n                      selected={index === filteredDao}\n                      onClick={() =>\n                        useFilteredDao(filteredDao === index ? false : index)\n                      }\n                    >\n                      <div className=\"dao-container\">\n                        <img className=\"dao-img\" src={dao.logo_url} />\n                        <div> {dao.title} </div>\n                      </div>\n                    </FilterEntry>\n                  ))}\n                </FilterLayout>\n              )}\n            </HeaderFilter>\n            <HeaderFilter>\n              <div\n                onClick={() =>\n                  setShowMobileStatusFilter(!showMobileStatusFilter)\n                }\n                className=\"d-flex justify-content-between\"\n              >\n                <MobileTitle>Status</MobileTitle>\n                {showMobileStatusFilter ? (\n                  <i class=\"ph ph-caret-up\"></i>\n                ) : (\n                  <i class=\"ph ph-caret-down\"></i>\n                )}\n              </div>\n              {showMobileStatusFilter && (\n                <FilterLayout>\n                  {statuses.map((status, index) => (\n                    <FilterEntry\n                      key={index}\n                      selected={index === filteredStatus}\n                      onClick={() =>\n                        useFilteredStatus(\n                          filteredStatus === index ? false : index,\n                        )\n                      }\n                    >\n                      {status.value}\n                    </FilterEntry>\n                  ))}\n                </FilterLayout>\n              )}\n            </HeaderFilter>\n          </FiltersContainer>\n        ) : preparedItems.length === 0 ? (\n          <div className=\"w-100 my-5 d-flex justify-content-center align-tems-center\">\n            <h1>No active Reports</h1>\n          </div>\n        ) : (\n          preparedItems.map((row, index) => (\n            <div key={row.post.title}>\n              <Widget\n                src=\"ndcdev.near/widget/daos.Components.Post\"\n                props={{\n                  item: row.post,\n                  index,\n                  type,\n                  rowId: row.post.id,\n                  isMobile: true,\n                  dao: row.dao,\n                }}\n              />\n            </div>\n          ))\n        )}\n      </>\n    </Mobile>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/ndcdev.near/widget/daos.Pages.Proposals.List", "fact_widget_deployments_id": "40a2422eb158851f02af267243b38ad8", "inserted_timestamp": "2024-05-02T15:39:45.265Z", "modified_timestamp": "2024-05-02T15:39:45.265Z", "__row_index": 0}