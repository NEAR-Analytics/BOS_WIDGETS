{"tx_hash": "4jD85bFAbM9u2JxP2PAStLCVexNRWpM9yi2Xjncwztp3", "action_id_social": "DuQQ1V6WiDn5XQuTUFPHSb2PtHs5zKh4B9V3NGxRgDSf-0-widget", "block_id": 113761497, "block_timestamp": "2024-02-28T16:21:03.630Z", "signer_id": "ndcdev.near", "widget_name": "daos.Pages.Proposals.Create", "source_code": "let { contractName } = VM.require(`ndcdev.near/widget/daos.Config`);\n\nif (!contractName) return <Widget src=\"flashui.near/widget/Loading\" />;\n\nconst { dao_id } = props;\n\nconst Container = styled.div`\n  position: relative;\n  width: 100%;\n  height: max-content;\n  overflow: hidden;\n\n  h3 {\n    font-size: 2rem;\n    font-weight: 400;\n  }\n\n  h4 {\n    font-size: 1.5rem;\n    font-weight: 300;\n  }\n`;\n\nconst FormWrapper = styled.div`\n  width: 100%;\n  padding: 3rem;\n\n  @media screen and (max-width: 786px) {\n    width: 100%;\n    padding: 1rem;\n  }\n`;\n\nconst form = {\n  Report: [\n    {\n      name: \"project_name\",\n      label: \"Project Name\",\n      value: \"\",\n      type: \"text\",\n      required: true,\n    },\n    {\n      name: \"proposal_id\",\n      label: \"Proposal ID\",\n      value: \"\",\n      type: \"text\",\n      required: false,\n    },\n    {\n      name: \"metric:audience\",\n      label:\n        \"Audience Metric: how many people did your project reach during this funding period?\",\n      value: \"\",\n      type: \"number\",\n      required: true,\n    },\n    {\n      name: \"metric:growth\",\n      label:\n        \"Growth Metric: how does this month's audience reach compare to previous periods (provide a %)\",\n      value: \"\",\n      type: \"number\",\n      required: true,\n    },\n    {\n      name: \"metric:average_engagement_rate\",\n      label:\n        \"Average Engagement Rate: what is the average engagement rate on your project's primary platform (choose one)? Use the formula (Total Likes, Shares & Comments / Total Followers) X 100 = AER %\",\n      value: \"\",\n      type: \"number\",\n      required: true,\n    },\n    {\n      name: \"metric:performance_statement:answer_1\",\n      label:\n        \"Performance Statement: What is the biggest win (most improved part of project) during this funding period vs. the previous one (if applicable)?\",\n      value: \"\",\n      type: \"textarea\",\n      required: true,\n    },\n    {\n      name: \"metric:performance_statement:answer_2\",\n      label:\n        \"Performance statement: What is the biggest challenge your project is facing? What did not improve during this funding period?\",\n      value: \"\",\n      type: \"textarea\",\n      required: true,\n    },\n  ],\n  Proposal: [\n    {\n      name: \"project_name\",\n      label: \"Project Name\",\n      value: \"\",\n      type: \"text\",\n      required: true,\n    },\n    {\n      name: \"description\",\n      label: \"Description\",\n      value: \"# Title\\n## Description\",\n      type: \"textarea\",\n      required: true,\n    },\n    {\n      name: \"requested_amount\",\n      label: \"Requested Amount (USD)\",\n      value: \"\",\n      type: \"number\",\n      required: false,\n    },\n    {\n      name: \"tags\",\n      label: \"Tags\",\n      value: \"\",\n      type: \"tag\",\n    },\n  ],\n};\n\nconst [formEls, setFormEls] = useState({\n  accountId: context.accountId,\n  type: \"Proposal\",\n  id: new Date().getTime(),\n  description: form.Proposal.find((el) => el.name === \"description\").value,\n});\n\nconst [errors, setErrors] = useState({});\nconst [selectedDaoId, setSelectedDaoId] = useState(dao_id);\n\nconst handleChange = (el, value) => {\n  const newFormEl = formEls;\n  const newFormElErrors = errors;\n  newFormEl[el.name] = value;\n  newFormElErrors[el.name] = value.length < 1;\n\n  setErrors(newFormElErrors);\n  setFormEls(newFormEl);\n};\n\nlet daos = null\n\ndaos = Near.view(contractName, \"get_dao_list\")\n\nif (daos) {\n  daos = daos.map((dao) => {\n    return { name: dao.title, id: dao.id };\n  });\n}\n\nif (!daos) return <Widget src=\"flashui.near/widget/Loading\" />;\n\nconst handleSelectDao = (e) => {\n  setSelectedDaoId(e.target.value);\n};\n\nconst handleSave = () => {\n  let body = {\n    title: formEls.project_name,\n    description: formEls.description,\n    labels: formEls.tags ?? [],\n    post_type: formEls.type,\n    requested_amount: parseInt(formEls.requested_amount ?? 0),\n    metrics: {},\n    reports: [],\n    attachments: [],\n  };\n\n  if (formEls.type === \"Report\") {\n    body.proposal_id = formEls.proposal_id;\n    body.report_version = \"V1\";\n  } else {\n    body.proposal_version = \"V1\";\n  }\n\n  Near.call(contractName, \"add_post\", {\n    dao_id: parseInt(selectedDaoId),\n    body,\n  });\n};\n\nreturn (\n  <Container>\n    <div className=\"d-flex justify-content-center\">\n      <FormWrapper className=\"mt-3 mb-5 d-flex flex-column gap-3\">\n        <div className=\"title d-flex flex-column align-items-center text-center mb-4\">\n          <h1>DAO Proposal / Report Form</h1>\n          <div className=\"mt-3 text-center\">\n            <p>\n              <b>Please use this form to report key performance metrics.</b>\n            </p>\n          </div>\n        </div>\n\n        <Widget\n          src=\"ndcdev.near/widget/daos.Components.Form\"\n          props={{\n            form,\n            formEls,\n            setFormEls,\n            handleChange,\n            handleSave,\n            handleSelectDao,\n            daos,\n            selectedDaoId,\n            dao_id,\n          }}\n        />\n      </FormWrapper>\n    </div>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/ndcdev.near/widget/daos.Pages.Proposals.Create", "fact_widget_deployments_id": "e0b69c2241979b2d7c097f992b792d40", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 17}