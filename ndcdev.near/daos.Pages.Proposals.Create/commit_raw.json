{"tx_hash": "6mWRNPSPxXsxwwNwRw7jNaAE2x9zbHnZGbR3pS6ntpof", "action_id_social": "EgJeX4K372MdaVC6FXFk1yRU3tN88EFPN1EYBQ76XA1e-0-widget", "block_id": 114265173, "block_timestamp": "2024-03-07T12:25:34.641Z", "signer_id": "ndcdev.near", "widget_name": "daos.Pages.Proposals.Create", "source_code": "let { contractName } = VM.require(`ndcdev.near/widget/daos.Config`);\n\nif (!contractName) return <Widget src=\"flashui.near/widget/Loading\" />;\n\nconst { dao_id } = props;\n\nconst Container = styled.div`\n  position: relative;\n  width: 100%;\n  height: max-content;\n  overflow: hidden;\n\n  h3 {\n    font-size: 2rem;\n    font-weight: 400;\n  }\n\n  h4 {\n    font-size: 1.5rem;\n    font-weight: 300;\n  }\n`;\n\nconst FormWrapper = styled.div`\n  width: 100%;\n  padding: 3rem;\n\n  @media screen and (max-width: 786px) {\n    width: 100%;\n    padding: 1rem;\n  }\n`;\n\nconst form = {\n  Report: [\n    {\n      name: \"project_name\",\n      label: \"Project Name\",\n      value: \"\",\n      type: \"text\",\n      required: true,\n    },\n    {\n      name: \"proposal_id\",\n      label: \"Proposal ID\",\n      value: \"\",\n      type: \"text\",\n      required: false,\n    },\n    {\n      name: \"audience\",\n      label:\n        \"How many people did your project reach during this funding period?\",\n      value: \"\",\n      type: \"number\",\n      required: false,\n    },\n    {\n      name: \"growth\",\n      label:\n        \"How does this month's audience reach compare to previous periods (provide a %)\",\n      value: \"\",\n      type: \"number\",\n      required: false,\n    },\n    {\n      name: \"average_engagement_rate\",\n      label:\n        \"What is the average engagement rate on your project's primary platform (choose one)? Use the formula (Total Likes, Shares & Comments / Total Followers) X 100 = AER %\",\n      value: \"\",\n      type: \"number\",\n      required: false,\n    },\n    {\n      name: \"performance_statement_1\",\n      label:\n        \"What is the biggest win (most improved part of project) during this funding period vs. the previous one (if applicable)?\",\n      value: \"\",\n      type: \"textarea\",\n      required: false,\n    },\n    {\n      name: \"performance_statement_2\",\n      label:\n        \"What is the biggest challenge your project is facing? What did not improve during this funding period?\",\n      value: \"\",\n      type: \"textarea\",\n      required: false,\n    },\n  ],\n  Proposal: [\n    {\n      name: \"project_name\",\n      label: \"Project Name\",\n      value: \"\",\n      type: \"text\",\n      required: true,\n    },\n    {\n      name: \"description\",\n      label: \"Description\",\n      value: \"# Title\\n## Description\",\n      type: \"textarea\",\n      required: true,\n    },\n    {\n      name: \"requested_amount\",\n      label: \"Requested Amount (USD)\",\n      value: \"\",\n      type: \"number\",\n      min: \"0\",\n      required: false,\n    },\n    {\n      name: \"tags\",\n      label: \"Tags\",\n      value: \"\",\n      type: \"tag\",\n    },\n  ],\n};\n\nconst [formEls, setFormEls] = useState({\n  accountId: context.accountId,\n  post_type: \"Proposal\",\n  id: new Date().getTime(),\n  description: form.Proposal.find((el) => el.name === \"description\").value,\n});\n\nlet daos = null;\ndaos = Near.view(contractName, \"get_dao_list\");\nconst [errors, setErrors] = useState({});\nconst [selectedDaoId, setSelectedDaoId] = useState(0);\nconst [attachments, setAttachments] = useState([])\n\nconsole.log(attachments)\nuseEffect(() => {\n  if (daos) {\n    setSelectedDaoId(dao_id || daos[0].id)\n  }\n},[daos])\n\nconst handleChange = (el, value) => {\n  if (el.name === \"requested_amount\" && value.startsWith('-')) return\n  const newFormEl = formEls;\n  const newFormElErrors = errors;\n  newFormEl[el.name] = value;\n  newFormElErrors[el.name] = value.length < 1;\n\n  setErrors(newFormElErrors);\n  setFormEls(newFormEl);\n};\n\n\nif (daos) {\n  daos = daos.map((dao) => {\n    return { name: dao.title, id: dao.id };\n  });\n}\n\nif (!daos) return <Widget src=\"flashui.near/widget/Loading\" />;\n\n\nconst handleSelectDao = (e) => {\n  setSelectedDaoId(e.target.value);\n};\n\nconst handleAttachments = (file) => {\n  setAttachments([file])\n}\n\nconst handleSave = () => {\n  let body = {\n    title: formEls.project_name,\n    labels: formEls.tags ?? [],\n    post_type: formEls.post_type,\n    requested_amount: parseInt(formEls.requested_amount ?? 0),\n    description: formEls.description,\n    metrics: {},\n    reports: [],\n    attachments: attachments,\n  };\n\n  if (formEls.post_type === \"Report\") {\n    body.proposal_id = parseInt(formEls.proposal_id);\n    body.metrics = {\n      audience: formEls[\"audience\"],\n      growth: formEls[\"growth\"],\n      average_engagement_rate: formEls[\"average_engagement_rate\"],\n      performance_statement_1: formEls[\"performance_statement_1\"],\n      performance_statement_2: formEls[\"performance_statement_2\"],\n    };\n    body.report_version = \"V1\";\n  } else {\n    body.proposal_version = \"V1\";\n  }\n\n  Near.call(contractName, \"add_post\", {\n    dao_id: parseInt(selectedDaoId),\n    body,\n  });\n};\n\nreturn (\n  <Container>\n    <div className=\"d-flex justify-content-center\">\n      <FormWrapper className=\"mt-3 mb-5 d-flex flex-column gap-3\">\n        <div className=\"title d-flex flex-column align-items-center text-center mb-4\">\n          <h1>DAO Proposal / Report Form</h1>\n          <div className=\"mt-3 text-center\">\n            <p>\n              <b>Please use this form to report key performance metrics.</b>\n            </p>\n          </div>\n        </div>\n\n        <Widget\n          src=\"ndcdev.near/widget/daos.Components.Form\"\n          props={{\n            form,\n            formEls,\n            setFormEls,\n            handleChange,\n            handleSave,\n            handleSelectDao,\n            handleAttachments,\n            attachments,\n            daos,\n            selectedDaoId,\n            dao_id,\n          }}\n        />\n      </FormWrapper>\n    </div>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/ndcdev.near/widget/daos.Pages.Proposals.Create", "fact_widget_deployments_id": "6ef6af92742ae54eb5d4eddcf8b06667", "inserted_timestamp": "2024-03-07T13:25:59.222Z", "modified_timestamp": "2024-03-07T14:26:59.479Z", "__row_index": 31}