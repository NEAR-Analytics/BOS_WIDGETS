{"tx_hash": "DZjTCXF7Gc4fqeZozb34ZTerA8KbEjh2pQh9RfzJVrPb", "action_id_social": "AyogJTyN5VRS5V8noYKEZRK4MwqaUrcsZ9jk76ugCw2n-0-widget", "block_id": 117463007, "block_timestamp": "2024-04-23T17:02:10.829Z", "signer_id": "ndcdev.near", "widget_name": "daos.Components.Comments", "source_code": "let { contractName } = VM.require(`ndcdev.near/widget/daos.Config`);\n\nif (!contractName) return <Widget src=\"flashui.near/widget/Loading\" />;\n\nconst GAS = \"200000000000000\";\nconst DEPOSIT = 10000000000000000000000;\nconst { postId, commentId, showCreate } = props;\nconst accountId = context.accountId;\n\nif (!contractName) return <Widget src=\"flashui.near/widget/Loading\" />;\n\nconst Post = styled.div`\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  margin-left: 1rem;\n  padding-left: 1rem;\n  border-left: 2px solid rgb(241 241 241);\n`;\n\nconst [showMore, setShowMore] = useState(null);\nconst [showReply, setShowReply] = useState({ [postId]: showCreate });\n\nlet post = Near.view(contractName, \"get_post_by_id\", {\n  id: parseInt(postId),\n});\n\nif (!post) return <Widget src=\"flashui.near/widget/Loading\" />;\n\nlet dao = Near.view(contractName, \"get_dao_by_id\", {\n  id: parseInt(post.dao_id),\n});\n\nlet comments = Near.view(contractName, \"get_post_comments\", {\n  post_id: parseInt(postId),\n});\n\nif (!comments || !dao) return <Widget src=\"flashui.near/widget/Loading\" />;\n\nconst isLikedByMe = (comment) =>\n  comment.likes\n    ? comment.likes.some((like) => like.author_id === accountId)\n    : false;\n\nconst handleLike = (id) => {\n  if (!accountId) return;\n  Near.call(contractName, \"comment_like\", { id });\n};\n\nconst handleSpam = (comment) => {\n  if (!accountId) return;\n  Near.call(\n    contractName,\n    \"change_comment_is_spam\",\n    {\n      id: comment.id,\n      is_spam: !comment.snapshot.is_spam,\n    },\n    GAS,\n    DEPOSIT,\n  );\n};\n\nconst commentById = (id) => comments.find((c) => c.id === id);\n\nconst CommentsList = ({ comments }) => (\n  <>\n    {comments.map((comment) => (\n      <>\n        {(!comment.snapshot.is_spam ||\n          dao.owners.includes(context.accountId)) && (\n          <Widget\n            src=\"ndcdev.near/widget/daos.Components.Comment\"\n            props={{\n              dao,\n              comment,\n              isLikedByMe,\n              showReply,\n              setShowReply,\n              handleLike,\n              handleSpam,\n              isPreview: false,\n              postId,\n            }}\n          />\n        )}\n        <Post>\n          {comment.child_comments.length > 0 && (\n            <CommentsList\n              comments={comment.child_comments.map((childId) =>\n                commentById(childId),\n              )}\n            />\n          )}\n        </Post>\n      </>\n    ))}\n  </>\n);\n\nreturn (\n  <>\n    {!commentId && (\n      <Widget\n        src=\"ndcdev.near/widget/daos.Components.CreateReply\"\n        props={{ postId }}\n      />\n    )}\n\n    <CommentsList\n      comments={\n        commentId\n          ? comments.filter((c) => c.id === parseInt(commentId))\n          : comments.filter((c) => !c.parent_comment)\n      }\n    />\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/ndcdev.near/widget/daos.Components.Comments", "fact_widget_deployments_id": "4678536850821393e2f6f9a490b8f182", "inserted_timestamp": "2024-04-23T18:43:16.795Z", "modified_timestamp": "2024-04-23T19:39:39.293Z", "__row_index": 4}