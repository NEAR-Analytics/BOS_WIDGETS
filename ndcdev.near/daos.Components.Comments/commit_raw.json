{"tx_hash": "2Hbpq4cfKq8zzXFc9qryJTJAShU7TYcH5wtCPwjXt2rK", "action_id_social": "7aEX6TtmHwJnNkdPWdTNK69QAkph6gyhH3EP8CrWuS8z-0-widget", "block_id": 113752707, "block_timestamp": "2024-02-28T13:10:39.064Z", "signer_id": "ndcdev.near", "widget_name": "daos.Components.Comments", "source_code": "let { contractName } = VM.require(`ndcdev.near/widget/daos.Config`);\n\nif (!contractName) return <Widget src=\"flashui.near/widget/Loading\" />;\n\nconst { postId, commentId, showCreate } = props;\nconst accountId = context.accountId;\n\nif (!contractName) return <Widget src=\"flashui.near/widget/Loading\" />;\n\nconst Post = styled.div`\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  margin-left: 1rem;\n  padding-left: 1rem;\n  border-left: 2px solid rgb(241 241 241);\n`;\n\nconst [showMore, setShowMore] = useState(null);\nconst [showReply, setShowReply] = useState({ [postId]: showCreate });\n\nlet comments = Near.view(contractName, \"get_post_comments\", {\n  post_id: parseInt(postId),\n});\n\nif (!comments) return <Widget src=\"flashui.near/widget/Loading\" />;\n\ncomments = comments.sort(\n  (a, b) => parseInt(b.snapshot.timestamp) - parseInt(a.snapshot.timestamp),\n);\n\nconst isLikedByMe = (comment) =>\n  comment.likes\n    ? comment.likes.some((like) => like.author_id === accountId)\n    : false;\n\nconst handleLike = (id) => {\n  Near.call(contractName, \"comment_like\", { id });\n};\n\nconst commentById = (id) => comments.find((c) => c.id === id);\n\nconst CommentsList = ({ comments }) => (\n  <>\n    {comments.map((comment) => (\n      <>\n        <Widget\n          src=\"ndcdev.near/widget/daos.Components.Comment\"\n          props={{\n            comment,\n            isLikedByMe,\n            showReply,\n            setShowReply,\n            handleLike,\n            isPreview: false,\n            postId,\n          }}\n        />\n        <Post>\n          {comment.child_comments.length > 0 && (\n            <CommentsList\n              comments={comment.child_comments.map((childId) =>\n                commentById(childId),\n              )}\n            />\n          )}\n        </Post>\n      </>\n    ))}\n  </>\n);\n\nreturn (\n  <>\n    {!commentId && (\n      <Widget\n        src=\"ndcdev.near/widget/daos.Components.CreateReply\"\n        props={{ id: postId }}\n      />\n    )}\n\n    <CommentsList\n      comments={\n        commentId\n          ? comments.filter((c) => c.id === parseInt(commentId))\n          : comments.filter((c) => !c.parent_comment)\n      }\n    />\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/ndcdev.near/widget/daos.Components.Comments", "fact_widget_deployments_id": "f19a96c66b2130a6cc6a09f56adefdc5", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 8}