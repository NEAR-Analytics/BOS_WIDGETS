{"tx_hash": "Db2vbaD6wyNzwnhz6yjjVgd9UF429h6RG4ZvjGk45frw", "action_id_social": "24xbkrJXRH85vNgEg92fGzbwmoUpkuNVjC9UfmZifChW-0-widget", "block_id": 113694724, "block_timestamp": "2024-02-27T16:16:43.068Z", "signer_id": "ndcdev.near", "widget_name": "daos.Components.MetricsDisplay.index", "source_code": "const { daos, deliverTreasury, typeOfProject } = props;\nconst { Items } = VM.require(\n  `ndcdev.near/widget/daos.Components.MetricsDisplay.styled`\n);\n\nconst [totalTreasury, setTotalTreasury] = useState(0);\nconst [loading, setLoading] = useState(false);\n\nconst getTotalTreasury = async (accountId) => {\n  try {\n    return asyncFetch(`${baseUrl}/account/balance/${accountId}`, {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"x-api-key\": \"36f2b87a-7ee6-40d8-80b9-5e68e587a5b5\",\n      },\n    });\n  } catch (e) {\n    console.log(e);\n  }\n};\n\nconst fetchDaoFunds = async () => {\n  const totalDAOTreasuryAmount = 0;\n  setLoading(false);\n\n  const promises = daos.flatMap((dao) => [\n    getTotalTreasury(dao.account_id).then((resp) => {\n      if (!resp.body) return;\n\n      const data = resp.body;\n      if (data)\n        totalDAOTreasuryAmount +=\n          data.find((d) => d.contract === \"Near\")?.amount ?? 0;\n    }),\n  ]);\n\n  Promise.all(promises).then((res) => {\n    setTotalTreasury(res);\n    setLoading(false);\n  });\n};\n\nfetchDaoFunds();\nif (!Items || loading) return <Widget src=\"flashui.near/widget/Loading\" />;\n\nconst Item = ({ value, text, color, type }) => {\n  return (\n    <Widget\n      src={`ndcdev.near/widget/daos.Components.MetricsDisplay.Item`}\n      props={{ value, text, color, type }}\n    />\n  );\n};\n\nreturn (\n  <Items>\n    <Item\n      value={totalTreasury}\n      loading={loading}\n      text={props.text.totalTreasury}\n    />\n    <Item\n      value={deliverTreasury}\n      loading={loading}\n      text={props.text.deliverTreasury}\n    />\n    <Item\n      value={typeOfProject}\n      loading={loading}\n      type=\"list\"\n      text={props.text.typeOfProject}\n    />\n  </Items>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/ndcdev.near/widget/daos.Components.MetricsDisplay.index", "fact_widget_deployments_id": "a061261bb0f465d58b3ebe322b90cc71", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 5}