{"tx_hash": "6jMEVPpbhzQPP3n9dhXNi3uo3BuPM2DcjG7XfWnkggxB", "action_id_social": "G85oGhcKJxFFna7gVi8phq7FjvwNhjDZhZmhWge3fLgh-0-widget", "block_id": 117945457, "block_timestamp": "2024-04-30T10:44:40.891Z", "signer_id": "ndcdev.near", "widget_name": "daos.Components.MarkdownEditor", "source_code": "const { element, handleChange } = props;\n\nconst AutoComplete = styled.div`\n  z-index: 5;\n\n  &\n    > [data-component=\"devhub.near/widget/devhub.components.molecule.AccountAutocomplete\"] {\n    ::before {\n      background: none;\n    }\n    background: white;\n    border-radius: 10px;\n  }\n`;\nconst [text, setText] = useState(element.value);\nconst [handler, setHandler] = useState(null);\nconst [mentionInput, setMentionInput] = useState(\"\");\nconst [mentionsArray, setMentionsArray] = useState([]);\nconst [showAccountAutocomplete, setShowAccountAutocomplete] = useState(false);\n\nfunction handleTextChange(value) {\n  const words = value.split(/\\s+/);\n  const allMentiones = words\n    .filter((word) => word.startsWith(\"@\"))\n    .map((mention) => mention.slice(1));\n  const newMentiones = allMentiones.filter(\n    (item) => !mentionsArray.includes(item)\n  );\n\n  setText(value);\n  setShowAccountAutocomplete(newMentiones?.length > 0);\n  setMentionInput(newMentiones?.[0] ?? \"\");\n  setMentionsArray(allMentiones);\n}\n\nfunction handleAutoComplete(id) {\n  let currentIndex = 0;\n  const updatedText = text.replace(/(?:^|\\s)(@[^\\s]*)/g, (match) => {\n    if (currentIndex === mentionsArray.indexOf(mentionInput)) {\n      currentIndex++;\n      return ` @${id}`;\n    } else {\n      currentIndex++;\n      return match;\n    }\n  });\n\n  setHandler(\"autocompleteSelected\");\n  setShowAccountAutocomplete(false);\n  setText(updatedText);\n}\n\nreturn (\n  <>\n    <Widget\n      src={\"devhub.near/widget/devhub.components.molecule.MarkdownEditor\"}\n      props={{\n        data: { handler, content: text },\n        onChange: (val) => {\n          handleChange(element, val);\n          setHandler(\"update\");\n          handleTextChange(val);\n        },\n      }}\n    />\n    {showAccountAutocomplete && (\n      <AutoComplete>\n        <Widget\n          src=\"devhub.near/widget/devhub.components.molecule.AccountAutocomplete\"\n          props={{\n            term: mentionInput,\n            onSelect: handleAutoComplete,\n            onClose: () => setShowAccountAutocomplete(false),\n          }}\n        />\n      </AutoComplete>\n    )}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/ndcdev.near/widget/daos.Components.MarkdownEditor", "fact_widget_deployments_id": "2dffabda5acac2da40f240a7e7645bb1", "inserted_timestamp": "2024-04-30T12:47:49.607Z", "modified_timestamp": "2024-04-30T12:47:49.607Z", "__row_index": 2}