{"tx_hash": "w3GuqgRPqap9t4C31XWph2qXjG9Npt8atWWspdTEJBR", "action_id_social": "AtVfbX7fV2PzhxMZkvbrdrhZi1qsCaXW7FGo9WC98T5R-0-widget", "block_id": 101403034, "block_timestamp": "2023-09-18T13:01:15.829Z", "signer_id": "libertydao.near", "widget_name": "boroughs.Mapbox", "source_code": "const API_URL = props.API_URL || \"\";\nconst ACCESS_TOKEN =\n  props.accessToken ||\n  \"pk.eyJ1IjoiZWpsYnJhZW0iLCJhIjoiY2xrbmIwaW53MGE0NTNtbGsydWd2MmpyZSJ9.m1ZfEqv2fGet2zblGknT8A\";\nconst styleUrl = props.styleUrl || \"mapbox://styles/mapbox/streets-v12\"; // see https://docs.mapbox.com/api/maps/styles/#mapbox-styles\nconst center = props.center || [-87.6298, 41.8781]; // starting position [lng, lat]\nconst zoom = props.zoom || 9; // starting zoom\nconst accountId = context.accountId;\nconst edit = props.edit || false;\nconst markers = props.markers || [];\nconst onMapClick = props.onMapClick || (() => {});\n\nconst code = `\n<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"initial-scale=1,maximum-scale=1,user-scalable=no\">\n    \n    <link href=\"https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css\" rel=\"stylesheet\">\n    \n    <script src=\"https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js\"></script>\n    \n    <style>\n      body { margin: 0; padding: 0; }\n      #map { position: absolute; top: 0; bottom: 0; width: 100%; }\n\n      // CHANGE MARKER\n      .marker {\n        background-image: url('https://ipfs.near.social/ipfs/bafkreiens4ch3nptl7bqav5zyfnvcg7peurd3xmuvbngyg3hjdwj2xec6e');\n        background-size: cover;\n        width: 27px;\n        height: 34px;\n        border-radius: 50%;\n        cursor: pointer;\n      }\n\n      // CHANGE MARKER ACTIVE \n      #mymarker {\n        background-image: url('https://humans.nearverselabs.com/active.svg') !important;\n      }\n\n      h6 {\n        margin:0;\n        font-size: 16px;\n      }\n\n      .mapboxgl-popup-content{\n        background: rgb(25, 26, 26);\n        color: white;\n        border: 1px solid;\n        border-radius: 9px;\n        padding: 10px;\n      }\n\n      .mapboxgl-popup-close-button{\n        color: white;\n      }\n\n      .popup{\n          padding: 10px; \n          display:flex; \n          gap:12px;\n          @media (max-width: 510px) {\n            padding: 0;\n          }\n      }\n\n      .logo{\n        width:48px; \n        height:60px;\n        @media (max-width: 510px) {\n          width:36px; \n          height:50px;\n        }        \n      }\n      .mapboxgl-ctrl-logo {\n    display: none !important;\n}\n\n      .gap-16{\n        display:flex; \n        align-items:center;\n        gap: 16px;\n      }\n\n      .gap-14{\n        display:flex; \n        gap: 14px;\n        flex-direction:column;\n        @media (max-width: 510px) {\n          gap: 3px;\n        } \n      }\n\n      a {\n        outline: 0;\n      }\n    </style>\n  </head>\n  <body>\n\n    <div id=\"map\"></div>\n\n    <script>\n\n    mapboxgl.accessToken = \"${ACCESS_TOKEN}\";\n\n    const map = new mapboxgl.Map({\n        container: 'map', // container ID\n        style: '${styleUrl}',\n        center: [${center[0]}, ${center[1]}], \n        zoom: ${zoom}\n    });\n\n    function handleLink (link){\n      window.top.postMessage(link, \"*\");\n    }\n\n    function getDetail (row) {\n      const user = row.user;\n       var title = \"\";\n       const near = row.user.accountId.indexOf(\".near\");\n       if(user.name){\n        title = user.name;\n       } else if(near !== -1){\n        title = user.accountId;\n       } else {\n          title = user.accountId.slice(0, 12);\n       }\n\n      var state = {\n        twitter: false,\n        social:false\n      }\n\n      if(user.twitter !== \"https://twitter.com/\"){\n        state.twitter = true\n      }\n      if(user.social !== \"https://social.near.page/u/\"){\n        state.social = true\n      }\n      const profileImageUrl = \"https://i.near.social/magic/large/https://near.social/magic/img/account/\"+ user.accountId;\n      \n      \n        // CUSTOMIZE POP UP\n       const HTML = '<div class=\"popup\">'+\n       '<div class=\"logo-container\">'+\n          '<img src=\"'+ profileImageUrl +'\" class=\"logo\" />'+\n          '</div>'+\n          '<div class=\"gap-14\">'+\n            '<h6>'+title+'</h6>'+\n            '<div class=\"gap-16\">'+\n            (state.social? \"<a href='\"+user.social+\"' target='_blank' onclick='handleLink(\"+JSON.stringify(user.social)+\")'   >  \" : '') +\n            '<svg width=\"29\" height=\"12\" viewBox=\"0 0 29 12\" fill=\"'+(state.social?'white':'grey')+'\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M0.240133 7.38517V4.85885L10.3454 0.409091V3.31579L3.42674 6.0933L3.52004 5.94258V6.30144L3.42674 6.15072L10.3454 8.92823V11.8349L0.240133 7.38517ZM28.7599 7.38517L18.6546 11.8349V8.92823L25.5733 6.15072L25.48 6.30144V5.94258L25.5733 6.0933L18.6546 3.31579V0.409091L28.7599 4.85885V7.38517Z\"></path></svg>'+\n             (state.social? '</a>' : '') +\n             (state.twitter? \"<a href='\"+user.twitter+\"' target='_blank' onclick='handleLink(\"+JSON.stringify(user.twitter)+\")'   >  \" : '') +\n            '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"18\" viewBox=\"0 0 24 24\"><path fill=\"'+(state.twitter?'white':'grey')+'\" d=\"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z\"/></svg>'+\n             (state.twitter? '</a>' : '') +\n           '</div>'+\n          '</div>'+\n        '</div>';\n        \n        return HTML;\n    };\n\n    // Function to populate markers to the map\n    function populateMarkers() {\n        const markersData = ${JSON.stringify(markers)};\n        markersData.forEach(marker => {\n          const el = document.createElement('div');\n          el.className = 'marker';\n          ${\n            accountId\n              ? `if(marker.accountId === \"${accountId}\") el.id = 'mymarker';`\n              : ``\n          }\n          new mapboxgl.Marker()\n              .setLngLat([marker.lng, marker.lat])\n              .addTo(map);\n        });\n    }\n\n    populateMarkers();\n\n    ${\n      accountId &&\n      `\n      map.on('click', function(event) {\n        const { lngLat } = event;\n\n        // const _el = document.getElementById(\"mymarker\");\n        // const myel = _el ? _el : document.createElement('div');\n        // myel.className = 'marker';\n        // myel.id = 'mymarker';\n        \n        new mapboxgl.Marker(myel)\n            .setLngLat([lngLat.lng, lngLat.lat])\n            .addTo(map);\n\n        window.parent.postMessage({\n          handler: 'map-click',\n          coordinates: lngLat\n        }, '*');\n      });\n    `\n    }\n    \n    </script>\n  </body>\n</html>\n  `;\n\nconst Container = styled.div`\n  height: 100%;\n  display: flex;\n\n  /* reset */\n  button,\n  fieldset,\n  input {\n    all: unset;\n  }\n`;\n\nreturn (\n  <Container>\n    <iframe\n      id=\"myMap\"\n      className=\"w-100 h-100\"\n      srcDoc={code}\n      onMessage={(e) => {\n        switch (e.handler) {\n          case \"map-click\": {\n            onMapClick(e.coordinates);\n            break;\n          }\n          //   case \"update\": {\n          //     onChange(e.content);\n          //   }\n          //   case \"resize\": {\n          //     const offset = 0;\n          //     if (statusConfig.length) {\n          //       offset = 10;\n          //     }\n          //     State.update({ iframeHeight: e.height + offset });\n          //   }\n        }\n      }}\n    />\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/libertydao.near/widget/boroughs.Mapbox", "fact_widget_deployments_id": "41b53285f33de928a7e2b00312049fcd", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}