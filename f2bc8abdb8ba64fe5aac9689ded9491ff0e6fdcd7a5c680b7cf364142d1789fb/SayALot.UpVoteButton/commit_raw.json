{"tx_hash": "AngauS12ci6SDb7RWUm1ZkksQrFBQaPUPbhGFj2DfJ68", "action_id_social": "2P7Bevg3z7VNqaAy7VaKUqpUaitP5sFPATJV6VspijYG-0-widget", "block_id": 103607216, "block_timestamp": "2023-10-17T20:19:44.067Z", "signer_id": "f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb", "widget_name": "SayALot.UpVoteButton", "source_code": "const {\r\n  isTest,\r\n  authorForWidget,\r\n  reactedElementData,\r\n  widgets,\r\n  disabled,\r\n  articleSbts,\r\n  upVotes,\r\n} = props;\r\n\r\nconst data = reactedElementData;\r\n\r\nconst libSrcArray = [widgets.libUpVotes];\r\n\r\nconst initLibCalls = [\r\n  {\r\n    functionName: \"getUpVotes\",\r\n    key: \"upVotes\",\r\n    props: {\r\n      id: data.id ?? `${data.author}-${data.timeCreate}`,\r\n      articleSbts,\r\n    },\r\n  },\r\n];\r\n\r\nif (!upVotes) {\r\n  State.init({\r\n    libCalls: initLibCalls,\r\n    upVotes: [],\r\n  });\r\n}\r\n\r\nlet upVotesData = upVotes ?? state.upVotes;\r\n\r\nlet userVote = upVotesData.find((vote) => vote.accountId === context.accountId);\r\n\r\nlet hasUserVoted = userVote !== undefined;\r\n\r\nfunction getUpVoteButtonClass() {\r\n  if (hasUserVoted) {\r\n    return \"info\";\r\n  } else {\r\n    return \"info outline\";\r\n  }\r\n}\r\n\r\nfunction callLibs(srcArray, stateUpdate, libCalls) {\r\n  return (\r\n    <>\r\n      {srcArray.map((src) => {\r\n        return (\r\n          <Widget\r\n            src={src}\r\n            props={{\r\n              isTest,\r\n              stateUpdate,\r\n              libCalls,\r\n            }}\r\n          />\r\n        );\r\n      })}\r\n    </>\r\n  );\r\n}\r\n\r\nfunction stateUpdate(obj) {\r\n  State.update(obj);\r\n}\r\n\r\nfunction upVoteButtonListener() {\r\n  let newLibCalls = state.libCalls !== undefined ? [...state.libCalls] : [];\r\n\r\n  if (!hasUserVoted) {\r\n    newLibCalls.push({\r\n      functionName: \"addVote\",\r\n      key: \"newVote\",\r\n      props: {\r\n        id: data.id ?? `${data.author}-${data.timeCreate}`,\r\n      },\r\n    });\r\n  } else {\r\n    newLibCalls.push({\r\n      functionName: \"deleteVote\",\r\n      key: \"deletedVote\",\r\n      props: {\r\n        id: data.id ?? `${data.author}-${data.timeCreate}`,\r\n        upVoteId: userVote.value.upVoteId,\r\n      },\r\n    });\r\n  }\r\n  State.update({ libCalls: newLibCalls });\r\n}\r\n\r\nconst IconContainer = styled.div`\r\n  transform: rotate(-90deg);\r\n`;\r\n\r\nconst Icon = styled.i`\r\n  margin: 0px !important;\r\n`;\r\n\r\nconst CallLibrary = styled.div`\r\n  display: none;\r\n`;\r\n\r\nreturn (\r\n  <>\r\n    <Widget\r\n      src={widgets.newStyledComponents.Input.Button}\r\n      props={{\r\n        // text: `+${upVotesData.length}`,\r\n        children: (\r\n          <div className=\"d-flex\">\r\n            <span>{`+${upVotesData.length}`}</span>\r\n            <IconContainer>\r\n              <Icon className=\"bi bi-fast-forward-fill\"></Icon>\r\n            </IconContainer>\r\n          </div>\r\n        ),\r\n        disabled,\r\n        className: `${getUpVoteButtonClass()}`,\r\n        size: \"sm\",\r\n        onClick: upVoteButtonListener,\r\n        // icon: (\r\n        //   <IconContainer>\r\n        //     <Icon className=\"bi bi-fast-forward-fill\"></Icon>\r\n        //   </IconContainer>\r\n        // ),\r\n        // icon: (\r\n        //   <IconContainer>\r\n        //     <Icon className=\"bi bi-fast-forward-button\"></Icon>\r\n        //   </IconContainer>\r\n        // ),\r\n        // icon: <i className=\"bi bi-hand-thumbs-up\"></i>,\r\n        // icon: \"\u23eb\",\r\n      }}\r\n    />\r\n\r\n    <CallLibrary>\r\n      {callLibs(libSrcArray, stateUpdate, state.libCalls)}\r\n    </CallLibrary>\r\n  </>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/SayALot.UpVoteButton", "fact_widget_deployments_id": "55c4138bbcb7ada6a790eb00798875f9", "inserted_timestamp": "2023-10-17T22:24:02.215Z", "modified_timestamp": "2023-10-17T22:24:02.215Z", "__row_index": 32}