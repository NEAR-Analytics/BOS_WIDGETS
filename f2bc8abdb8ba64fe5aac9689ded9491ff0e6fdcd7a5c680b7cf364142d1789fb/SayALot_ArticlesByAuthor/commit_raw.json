{"tx_hash": "6EB2exdqaJfTTDFfnuZbWM6WrqBgjwTdg8YypjJa3Tr", "action_id_social": "vub6ufhepop998zQokiYtYWuMx2YYgnjncTaZMqA3Cr-0-widget", "block_id": 96922095, "block_timestamp": "2023-07-20T15:01:57.782Z", "signer_id": "f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb", "widget_name": "SayALot_ArticlesByAuthor", "source_code": "const isDebug = props.isDebug;\r\n\r\nconst addressForArticles = isDebug ? \"test_sayALotArticle\" : \"sayALotArticle\";\r\nconst authorForWidget =\r\n  \"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb\";\r\nconst tagSelected = props.tag;\r\nconst accountId = props.accountId ?? context.accountId;\r\nif (!accountId) {\r\n  return \"No account ID\";\r\n}\r\nconst profile = props.profile ?? Social.getr(`${accountId}/profile`);\r\nif (profile === null) {\r\n  return \"Loading\";\r\n}\r\n\r\nconst getDateLastEdit = (timestamp) => {\r\n  const date = new Date(Number(timestamp));\r\n  const dateString = `${date.toLocaleDateString()} / ${date.toLocaleTimeString()}`;\r\n  return dateString;\r\n};\r\n\r\nconst articleBlackList = [\r\n  91092435, 91092174, 91051228, 91092223, 91051203, 96414482, 96402919,\r\n  96402330, 96401880, 96412953, 96412953, 95766840, 95413943,\r\n];\r\n\r\n// ========== GET INDEX ARRAY FOR ARTICLES ==========\r\nconst postsIndex = Social.index(addressForArticles, \"main\", {\r\n  order: \"desc\",\r\n  accountId: undefined,\r\n});\r\n\r\nconsole.log(0, postsIndex);\r\n\r\nif (!postsIndex) {\r\n  return \"Loading...\";\r\n}\r\n\r\n// ========== GET ALL ARTICLES ==========\r\nconst resultArticles =\r\n  postsIndex &&\r\n  postsIndex.reduce((acc, { accountId, blockHeight }) => {\r\n    const postData = Social.get(\r\n      `${accountId}/${addressForArticles}/main`,\r\n      blockHeight\r\n    );\r\n    const postDataWithBlockHeight = { ...JSON.parse(postData), blockHeight };\r\n    return [...acc, postDataWithBlockHeight];\r\n  }, []);\r\nconsole.log(1, resultArticles);\r\n\r\n// ========== FILTER DUBLICATES ==========\r\nconst filteredArticles =\r\n  resultArticles.length &&\r\n  resultArticles\r\n    .reduce((acc, article) => {\r\n      if (!acc.some(({ articleId }) => articleId === article.articleId)) {\r\n        return [...acc, article];\r\n      } else {\r\n        return acc;\r\n      }\r\n    }, [])\r\n    .filter((article) => !articleBlackList.includes(article.blockHeight));\r\nconsole.log(2, filteredArticles);\r\n\r\nconst filteredArticlesByTag =\r\n  filteredArticles.length &&\r\n  filteredArticles.reduce((acc, article) => {\r\n    if (article.tags && article.tags.includes(tagSelected)) {\r\n      console.log(article);\r\n      return [...acc, article];\r\n    } else {\r\n      console.log(acc);\r\n      console.log(article);\r\n      return acc;\r\n    }\r\n  }, []);\r\nconsole.log(3, filteredArticlesByTag);\r\n\r\nreturn (\r\n  <>\r\n    <Widget\r\n      src={`${authorForWidget}/widget/SayALot_MainNavigation`}\r\n      props={{ currentNavPill: \"articles\", isDebug }}\r\n    />\r\n    <div>\r\n      Tag:\r\n      {tagSelected}\r\n    </div>\r\n    <ol>\r\n      {filteredArticlesByTag &&\r\n        filteredArticlesByTag.map((article, index) => (\r\n          <li key={article.articleId}>\r\n            <a\r\n              href={\r\n                isDebug\r\n                  ? `#/${authorForWidget}/widget/SayALot_OneArticle?articleId=${article.articleId}&blockHeight=${article.blockHeight}&lastEditor=${article.lastEditor}&isDebug=true\r\n            `\r\n                  : `#/${authorForWidget}/widget/SayALot_OneArticle?articleId=${article.articleId}&blockHeight=${article.blockHeight}&lastEditor=${article.lastEditor}\r\n            `\r\n              }\r\n            >\r\n              {article.articleId}{\" \"}\r\n              <small>\r\n                (last edited:\r\n                {getDateLastEdit(article.timeLastEdit)})\r\n              </small>\r\n            </a>\r\n            <Widget\r\n              src={`${authorForWidget}/widget/SayALot_TagList`}\r\n              props={{ tags: article.tags, isDebug }}\r\n            />\r\n          </li>\r\n        ))}\r\n    </ol>\r\n  </>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/SayALot_ArticlesByAuthor", "fact_widget_deployments_id": "29527669683c731c948a90691fa13739", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}