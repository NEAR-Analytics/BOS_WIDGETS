{"tx_hash": "JBy1kqMTKsvRKhJPvLdp55pHj53HKjBsmgrqHZcBypxU", "action_id_social": "DeoapoLQm2KY5D3eL9envrU4icPsP19VfaAsqks8YfZy-0-widget", "block_id": 98064967, "block_timestamp": "2023-08-04T15:09:49.014Z", "signer_id": "f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb", "widget_name": "sayALot.generalHandler", "source_code": "//===============================================INITIALIZATION=====================================================\r\nlet { sharedBlockHeight, tagShared, isTest, accountId } = props;\r\n\r\nif (!accountId) accountId = context.accountId;\r\n\r\nconst tabs = {\r\n  SHOW_ARTICLES_LIST: { id: 0 },\r\n  SHOW_ARTICLE: { id: 1 },\r\n  ARTICLE_WORKSHOP: { id: 2 },\r\n};\r\n\r\nState.init({\r\n  displayedTabId: tabs.SHOW_ARTICLES_LIST.id,\r\n  articleToRenderData: {},\r\n  filterBy: tagShared\r\n    ? { parameterName: \"tag\", parameterValue: tagShared }\r\n    : { parameterName: \"\" },\r\n});\r\n\r\n//=============================================END INITIALIZATION===================================================\r\n\r\n//==================================================CONSTS==========================================================\r\n\r\n//const authorForWidget = \"sayalot.near\";\r\nconst authorForWidget =\r\n  \"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb\";\r\nconst thisWidgetName = \"sayALot.generalHandler\";\r\n\r\nlet writersWhiteList = [\r\n  \"neardigitalcollective.near\",\r\n  \"blaze.near\",\r\n  \"jlw.near\",\r\n  \"kazanderdad.near\",\r\n  \"joep.near\",\r\n  \"sarahkornfeld.near\",\r\n  \"yuensid.near\",\r\n  \"shubham007.near\",\r\n  \"fiftycent.near\",\r\n  \"ozymandius.near\",\r\n  \"chloe.near\",\r\n];\r\n\r\nconst sayALotWorkers = [\r\n  \"silkking.near\",\r\n  \"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb\",\r\n  \"blaze.near\",\r\n  \"ayelen.near\",\r\n  \"kenrou-it.near\",\r\n];\r\n\r\nif (isTest) {\r\n  writersWhiteList = sayALotWorkers;\r\n}\r\n\r\nconst widgets = {\r\n  thisWidget: `${authorForWidget}/widget/${thisWidgetName}`,\r\n  styledComponents: \"rubycop.near/widget/NDC.StyledComponents\",\r\n  header: `${authorForWidget}/widget/NDC.NavBar`,\r\n  showArticlesList: `${authorForWidget}/widget/SayALot.AllArticlesList`,\r\n  generalCard: `f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/NDC.GeneralCard`,\r\n  oneArticle: `${authorForWidget}/widget/NDC.General.ArticleView`,\r\n  reactions: \"sayalot.near/widget/SayALot_Reactions\",\r\n  addComment: \"rubycop.near/widget/NDC.Nomination.AddComment\",\r\n  candidatePage: \"#/rubycop.near/widget/NDC.Nomination.Candidate.Page\",\r\n};\r\n\r\nconst profile = props.profile ?? Social.getr(`${accountId}/profile`);\r\nif (profile === null) {\r\n  return \"Loading\";\r\n}\r\n\r\nlet authorProfile = {};\r\nif (state.filterBy.parameterName == \"author\") {\r\n  authorProfile = Social.getr(`${state.filterBy.parameterValue}/profile`);\r\n  if (!authorProfile) return \"Loading...\";\r\n}\r\n\r\nconst brand = {\r\n  homePageId: tabs.SHOW_ARTICLES_LIST.id,\r\n  brandName: \"Say a lot\",\r\n  logoHref:\r\n    \"https://ipfs.near.social/ipfs/bafkreiaqxa4st4vp4rtq2iyobdgqe5tpfg55mmyvfg25upd2qplcxylyfi\",\r\n  logoRemWidth: 6,\r\n  logoRemHeight: 6,\r\n};\r\n\r\nconst navigationPills = [\r\n  { id: tabs.SHOW_ARTICLES_LIST.id, title: \"Articles\" },\r\n  { id: tabs.SHOW_ARTICLES_LIST.id, title: \"Authors\" },\r\n];\r\n\r\nconst navigationButtons = [\r\n  { id: ARTICLE_WORKSHOP.id, title: \"+Create article\" },\r\n];\r\n\r\n//=================================================END CONSTS=======================================================\r\n\r\n//=================================================GET DATA=========================================================\r\nconst addressForArticles = isTest ? \"test_sayALotArticle\" : \"sayALotArticle\";\r\nconst articleBlackList = [91092435, 91092174, 91051228, 91092223, 91051203];\r\n\r\nfunction getLastEditionsByArticle() {\r\n  const allArticles = Social.index(addressForArticles, \"main\", {\r\n    order: \"desc\",\r\n    accountId:\r\n      state.filterBy.parameterName == \"author\" && state.filterBy.parameterValue,\r\n  });\r\n\r\n  const oldFormatArticlesTestBasicDataArray = [\r\n    [\r\n      \"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb\",\r\n      97325392,\r\n    ],\r\n    [\r\n      \"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb\",\r\n      97317287,\r\n    ],\r\n    [\"ayelen.near\", 96927579],\r\n    [\"kenrou-it.near\", 96924422],\r\n    [\r\n      \"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb\",\r\n      96879470,\r\n    ],\r\n    [\r\n      \"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb\",\r\n      96878182,\r\n    ],\r\n    [\r\n      \"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb\",\r\n      96643643,\r\n    ],\r\n    [\"silkking.near\", 96491128],\r\n  ];\r\n\r\n  const oldFormatArticlesMainBasicDataArray = [\r\n    [\"ozymandius.near\", 97329049],\r\n    [\"fiftycent.near\", 97322138],\r\n    [\"blaze.near\", 97255023],\r\n    [\"jlw.near\", 97250015],\r\n    [\"kazanderdad.near\", 96692435],\r\n    [\"blaze.near\", 96414482],\r\n    [\"blaze.near\", 96412953],\r\n    [\"sarahkornfeld.near\", 96402919],\r\n    [\"sarahkornfeld.near\", 96402476],\r\n    [\"sarahkornfeld.near\", 96402330],\r\n    [\"sarahkornfeld.near\", 96401880],\r\n    [\"ozymandius.near\", 95810612],\r\n    [\"blaze.near\", 95766756],\r\n    [\"blaze.near\", 95766700],\r\n    [\"jlw.near\", 95705034],\r\n    [\"blaze.near\", 95413943],\r\n    [\"blaze.near\", 94936576],\r\n    [\"yuensid.near\", 94866690],\r\n    [\"sarahkornfeld.near\", 94863580],\r\n    [\"blaze.near\", 94801223],\r\n    [\"sarahkornfeld.near\", 94344236],\r\n    [\"sarahkornfeld.near\", 94188387],\r\n    [\"jlw.near\", 93986868],\r\n    [\"blaze.near\", 92999498],\r\n  ];\r\n\r\n  const oldFormatArticlesBasicDataArray = isTest\r\n    ? oldFormatArticlesTestBasicDataArray\r\n    : oldFormatArticlesMainBasicDataArray;\r\n\r\n  if (state.filterBy.parameterName == \"author\") {\r\n    oldFormatArticlesBasicDataArray = oldFormatArticlesBasicDataArray.filter(\r\n      (articleBasicData) =>\r\n        articleBasicData[0] === state.filterBy.parameterValue\r\n    );\r\n  }\r\n\r\n  let oldFormatArticlesArray = oldFormatArticlesBasicDataArray.map(\r\n    (oldFormatBasicArticleData) => {\r\n      let article = Social.get(\r\n        `${oldFormatBasicArticleData[0]}/${addressForArticles}/main`,\r\n        oldFormatBasicArticleData[1]\r\n      );\r\n\r\n      let articleParsed = undefined;\r\n      if (article) {\r\n        articleParsed = JSON.parse(article);\r\n        articleParsed.blockHeight = oldFormatBasicArticleData[1];\r\n      }\r\n\r\n      return articleParsed;\r\n    }\r\n  );\r\n\r\n  let newFormatArticlesData = allArticles\r\n    .filter((articleIndex) => articleIndex.value.id)\r\n    .filter(\r\n      (articleIndex) =>\r\n        articleIndex.value.id.split(\"-\")[0] === articleIndex.accountId\r\n    )\r\n    .filter((articleIndex) => writersWhiteList.includes(articleIndex.accountId))\r\n    .filter(\r\n      (articleIndex) => !articleBlackList.includes(articleIndex.blockHeight)\r\n    );\r\n\r\n  let lastestEditArticlesDataArray = newFormatArticlesData.filter(\r\n    (articleData) => {\r\n      const latestEditForThisArticle = newFormatArticlesData.find(\r\n        (newArticleData) => newArticleData.value.id === articleData.value.id\r\n      );\r\n      return (\r\n        JSON.stringify(articleData) === JSON.stringify(latestEditForThisArticle)\r\n      );\r\n    }\r\n  );\r\n\r\n  let finalNewFormatArticles = lastestEditArticlesDataArray.map(\r\n    (latestEditArticle) => {\r\n      const article = Social.get(\r\n        `${latestEditArticle.accountId}/${addressForArticles}/main`,\r\n        latestEditArticle.blockHeight\r\n      );\r\n\r\n      let articleParsed = undefined;\r\n      if (article) {\r\n        articleParsed = JSON.parse(article);\r\n        articleParsed.blockHeight = latestEditArticle.blockHeight;\r\n        articleParsed.realArticleId = latestEditArticle.value.articleId;\r\n      }\r\n\r\n      return articleParsed;\r\n    }\r\n  );\r\n\r\n  let finalOldFormatArticles = oldFormatArticlesArray.filter(\r\n    (oldFormatArticle) => {\r\n      return !finalNewFormatArticles.find(\r\n        (newFormatArticle) =>\r\n          newFormatArticle.articleId === oldFormatArticle.articleId\r\n      );\r\n    }\r\n  );\r\n\r\n  let finalArticlesWithoutUsersFilters = finalNewFormatArticles.concat(\r\n    finalOldFormatArticles\r\n  );\r\n\r\n  let finalArticles = finalArticlesWithoutUsersFilters.filter((article) => {\r\n    return article.tags.includes(state.filterBy.parameterValue);\r\n  });\r\n\r\n  return state.filterBy.parameterName == \"tag\"\r\n    ? finalArticles\r\n    : finalArticlesWithoutUsersFilters;\r\n}\r\n\r\nconst finalArticles = getLastEditionsByArticle() ?? [];\r\n//===============================================END GET DATA=======================================================\r\n\r\n//=================================================FUNCTIONS========================================================\r\n\r\nfunction stateUpdate(obj) {\r\n  State.update(obj);\r\n}\r\n\r\nfunction handleOpenArticle(articleToRenderData) {\r\n  State.update({\r\n    displayedTabId: tabs.SHOW_ARTICLE.id,\r\n    articleToRenderData,\r\n  });\r\n}\r\n\r\nfunction handleFilterArticles(filter) {\r\n  State.update({\r\n    displayedTabId: tabs.SHOW_ARTICLES_LIST.id,\r\n    filterBy: { parameterName: filter.filterBy, parameterValue: filter.value },\r\n  });\r\n}\r\n\r\nfunction handleBackButton() {\r\n  State.update({\r\n    displayedTabId: tabs.SHOW_ARTICLES_LIST.id,\r\n    articleToRenderData: {},\r\n  });\r\n}\r\n\r\n//===============================================END FUNCTIONS======================================================\r\nreturn (\r\n  <>\r\n    <Widget\r\n      src={widgets.header}\r\n      props={{\r\n        isTest,\r\n        stateUpdate,\r\n        brand,\r\n        pills: navigationPills,\r\n        navigationButtons,\r\n        displayedTabId: state.displayedTabId,\r\n        writersWhiteList,\r\n        handleFilterArticles,\r\n      }}\r\n    />\r\n    {state.displayedTabId == tabs.SHOW_ARTICLES_LIST.id && (\r\n      <Widget\r\n        src={widgets.showArticlesList}\r\n        props={{\r\n          isTest,\r\n          finalArticles,\r\n          tabs,\r\n          widgets,\r\n          addressForArticles,\r\n          handleOpenArticle,\r\n          handleFilterArticles,\r\n          authorForWidget,\r\n        }}\r\n      />\r\n    )}\r\n    {state.displayedTabId == tabs.SHOW_ARTICLE.id && (\r\n      <Widget\r\n        src={widgets.oneArticle}\r\n        props={{\r\n          isTest,\r\n          handleBackButton,\r\n          articleToRenderData: state.articleToRenderData,\r\n          authorForWidget,\r\n        }}\r\n      />\r\n    )}\r\n  </>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/sayALot.generalHandler", "fact_widget_deployments_id": "533b6c210139fdc765c7b4f3363b5546", "inserted_timestamp": "2023-08-04T16:48:57.987Z", "modified_timestamp": "2023-08-04T16:48:57.987Z", "__row_index": 49}