{"tx_hash": "1KX4yY2VndfrKbHRRGSJwLRQ4WL1QFmyozZv9cqnFp9", "action_id_social": "2JqqUmsNb8x9vdtsGA3pNnkncYKojzkSpPfCJT9sKauH-0-widget", "block_id": 97393896, "block_timestamp": "2023-07-26T18:08:38.506Z", "signer_id": "f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb", "widget_name": "SayALot_ArticlesByTag", "source_code": "const isDebug = props.isDebug;\n\nconst addressForArticles = isDebug ? \"test_sayALotArticle\" : \"sayALotArticle\";\nconst authorForWidget =\n  \"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb\";\nconst tagSelected = props.tag;\nconst accountId = props.accountId ?? context.accountId;\nif (!accountId) {\n  return \"No account ID\";\n}\n\nconst writersWhiteList = props.writersWhiteList ?? [\n  \"neardigitalcollective.near\",\n  \"blaze.near\",\n  \"jlw.near\",\n  \"kazanderdad.near\",\n  \"joep.near\",\n  \"sarahkornfeld.near\",\n  \"yuensid.near\",\n  \"shubham007.near\",\n  \"fiftycent.near\",\n  \"ozymandius.near\",\n];\n\nconst sayALotWorkers = [\n  \"silkking.near\",\n  \"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb\",\n  \"blaze.near\",\n  \"ayelen.near\",\n  \"kenrou-it.near\",\n];\n\nif (isDebug) {\n  writersWhiteList = sayALotWorkers;\n}\n\nconst profile = props.profile ?? Social.getr(`${accountId}/profile`);\nif (profile === null) {\n  return \"Loading\";\n}\n\nconst getDateLastEdit = (timestamp) => {\n  const date = new Date(Number(timestamp));\n  const dateString = `${date.toLocaleDateString()} / ${date.toLocaleTimeString()}`;\n  return dateString;\n};\n\n// // ========== GET INDEX ARRAY FOR ARTICLES ==========\n// const postsIndex = Social.index(addressForArticles, \"main\", {\n//   order: \"desc\",\n//   accountId: undefined,\n// });\n\n// if (!postsIndex) {\n//   return \"Loading...\";\n// }\n// // ========== GET ALL ARTICLES ==========\n// const resultArticles =\n//   postsIndex &&\n//   postsIndex.reduce((acc, { accountId, blockHeight }) => {\n//     const postData = Social.get(\n//       `${accountId}/${addressForArticles}/main`,\n//       blockHeight\n//     );\n//     if (!postData) {\n//       return acc;\n//     }\n//     const postDataWithBlockHeight = { ...JSON.parse(postData), blockHeight };\n//     return [...acc, postDataWithBlockHeight];\n//   }, []);\n// // ========== FILTER DUBLICATES ==========\n// const filteredArticles =\n//   resultArticles.length &&\n//   resultArticles.reduce((acc, article) => {\n//     if (!acc.some(({ articleId }) => articleId === article.articleId)) {\n//       return [...acc, article];\n//     } else {\n//       return acc;\n//     }\n//   }, []);\n\nfunction getLastEditionsByArticle() {\n  const allArticles = Social.index(addressForArticles, \"main\", {\n    order: \"desc\",\n    accountId: author,\n  });\n\n  const oldFormatArticlesTestBasicDataArray = [\n    [\n      \"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb\",\n      97325392,\n    ],\n    [\n      \"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb\",\n      97317287,\n    ],\n    [\"ayelen.near\", 96927579],\n    [\"kenrou-it.near\", 96924422],\n    [\n      \"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb\",\n      96879470,\n    ],\n    [\n      \"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb\",\n      96878182,\n    ],\n    [\n      \"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb\",\n      96643643,\n    ],\n    [\"silkking.near\", 96491128],\n  ];\n\n  const oldFormatArticlesMainBasicDataArray = [\n    [\"ozymandius.near\", 97329049],\n    [\"fiftycent.near\", 97322138],\n    [\"blaze.near\", 97255023],\n    [\"jlw.near\", 97250015],\n    [\"kazanderdad.near\", 96692435],\n    [\"blaze.near\", 96414482],\n    [\"blaze.near\", 96412953],\n    [\"sarahkornfeld.near\", 96402919],\n    [\"sarahkornfeld.near\", 96402476],\n    [\"sarahkornfeld.near\", 96402330],\n    [\"sarahkornfeld.near\", 96401880],\n    [\"ozymandius.near\", 95810612],\n    [\"blaze.near\", 95766756],\n    [\"blaze.near\", 95766700],\n    [\"jlw.near\", 95705034],\n    [\"blaze.near\", 95413943],\n    [\"blaze.near\", 94936576],\n    [\"yuensid.near\", 94866690],\n    [\"sarahkornfeld.near\", 94863580],\n    [\"blaze.near\", 94801223],\n    [\"sarahkornfeld.near\", 94344236],\n    [\"sarahkornfeld.near\", 94188387],\n    [\"jlw.near\", 93986868],\n    [\"blaze.near\", 92999498],\n  ];\n\n  const oldFormatArticlesBasicDataArray = isDebug\n    ? oldFormatArticlesTestBasicDataArray\n    : oldFormatArticlesMainBasicDataArray;\n\n  if (author) {\n    oldFormatArticlesBasicDataArray = oldFormatArticlesBasicDataArray.filter(\n      (articleBasicData) => articleBasicData[0] === author\n    );\n  }\n\n  let oldFormatArticlesArray = oldFormatArticlesBasicDataArray.map(\n    (oldFormatBasicArticleData) => {\n      let article = Social.get(\n        `${oldFormatBasicArticleData[0]}/${addressForArticles}/main`,\n        oldFormatBasicArticleData[1]\n      );\n\n      let articleParsed = JSON.parse(article);\n      if (articleParsed) {\n        articleParsed.blockHeight = oldFormatBasicArticleData[1];\n      }\n\n      return articleParsed;\n    }\n  );\n\n  let newFormatArticlesData = allArticles\n    .filter((articleIndex) => articleIndex.value.id)\n    .filter(\n      (articleIndex) =>\n        articleIndex.value.id.split(\"-\")[0] === articleIndex.accountId\n    )\n    .filter((articleIndex) => writersWhiteList.includes(articleIndex.accountId))\n    .filter(\n      (articleIndex) => !articleBlackList.includes(articleIndex.blockHeight)\n    );\n\n  let lastestEditArticlesDataArray = newFormatArticlesData.filter(\n    (articleData) => {\n      const latestEditForThisArticle = newFormatArticlesData.find(\n        (newArticleData) => newArticleData.value.id\n      );\n      return (\n        JSON.stringify(articleData) === JSON.stringify(latestEditForThisArticle)\n      );\n    }\n  );\n\n  let finalNewFormatArticles = lastestEditArticlesDataArray.map(\n    (latestEditArticle) => {\n      const article = Social.get(\n        `${latestEditArticle.accountId}/${addressForArticles}/main`,\n        latestEditArticle.blockHeight\n      );\n\n      let articleParsed = JSON.parse(article);\n      articleParsed.blockHeight = latestEditArticle.blockHeight;\n\n      return articleParsed;\n    }\n  );\n\n  let finalOldFormatArticles = oldFormatArticlesArray.filter(\n    (oldFormatArticle) => {\n      return !finalNewFormatArticles.find(\n        (newFormatArticle) =>\n          newFormatArticle.articleId === oldFormatArticle.articleId\n      );\n    }\n  );\n\n  let finalArticles = finalNewFormatArticles.concat(finalOldFormatArticles);\n\n  return finalArticles;\n}\n\nconst lastEditionsArticleArray = getLastEditionsByArticle();\n\nconst finalArticles =\n  lastEditionsArticleArray.length &&\n  lastEditionsArticleArray.reduce((acc, article) => {\n    if (\n      article.tags &&\n      Array.isArray(article.tags) &&\n      article.tags.includes(tagSelected)\n    ) {\n      return [...acc, article];\n    } else {\n      return acc;\n    }\n  }, []);\n\nreturn (\n  <>\n    <Widget\n      src={`${authorForWidget}/widget/SayALot_MainNavigation`}\n      props={{ currentNavPill: \"articles\", isDebug }}\n    />\n    <div>\n      Tag:\n      {tagSelected}\n    </div>\n    <ol>\n      {finalArticles &&\n        finalArticles.map((article, index) => (\n          <li key={article.articleId}>\n            <a\n              href={\n                isDebug\n                  ? `#/${authorForWidget}/widget/SayALot_OneArticle?articleId=${article.articleId}&blockHeight=${article.blockHeight}&lastEditor=${article.lastEditor}&isDebug=true\n            `\n                  : `#/${authorForWidget}/widget/SayALot_OneArticle?articleId=${article.articleId}&blockHeight=${article.blockHeight}&lastEditor=${article.lastEditor}\n            `\n              }\n            >\n              {article.articleId}{\" \"}\n              <small>\n                (last edited:\n                {getDateLastEdit(article.timeLastEdit)})\n              </small>\n            </a>\n            <Widget\n              src={`${authorForWidget}/widget/SayALot_TagList`}\n              props={{ tags: article.tags, isDebug }}\n            />\n          </li>\n        ))}\n    </ol>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/SayALot_ArticlesByTag", "fact_widget_deployments_id": "02e6fcf60b42173bd5b5711007bd28a3", "inserted_timestamp": "2000-01-01T00:00:00.000Z", "modified_timestamp": "2000-01-01T00:00:00.000Z", "__row_index": 2}