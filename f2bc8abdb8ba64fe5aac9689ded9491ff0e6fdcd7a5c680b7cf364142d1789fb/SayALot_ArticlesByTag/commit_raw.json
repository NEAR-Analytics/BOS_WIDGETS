{"tx_hash": "KvqSfCZX6WYpYgaekDE4AEUCVYH2j6GEHTirJJ9WPdv", "action_id_social": "CPx3n6HZgowTYqE2ymeLmPUEJaNurWNLuQe4Dw7TRgm6-0-widget", "block_id": 94137963, "block_timestamp": "2023-06-13T21:34:42.816Z", "signer_id": "f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb", "widget_name": "SayALot_ArticlesByTag", "source_code": "const addressForArticles = \"sayALotArticle\";\r\nconst authorForWidget =\r\n  \"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb\";\r\nconst tagSelected = props.tag;\r\nconst accountId = props.accountId ?? context.accountId;\r\nif (!accountId) {\r\n  return \"No account ID\";\r\n}\r\nconst profile = props.profile ?? Social.getr(`${accountId}/profile`);\r\nif (profile === null) {\r\n  return \"Loading\";\r\n}\r\n\r\nconst getDateLastEdit = (timestamp) => {\r\n  const date = new Date(Number(timestamp));\r\n  const dateString = `${date.toLocaleDateString()} / ${date.toLocaleTimeString()}`;\r\n  return dateString;\r\n};\r\n\r\n// ========== GET INDEX ARRAY FOR ARTICLES ==========\r\nconst postsIndex = Social.index(addressForArticles, \"main\", {\r\n  order: \"desc\",\r\n  accountId: undefined,\r\n});\r\n// ========== GET ALL ARTICLES ==========\r\nconst resultArticles =\r\n  postsIndex &&\r\n  postsIndex.reduce((acc, { accountId, blockHeight }) => {\r\n    const postData = Social.get(\r\n      `${accountId}/${addressForArticles}/main`,\r\n      blockHeight\r\n    );\r\n    const postDataWithBlockHeight = { ...JSON.parse(postData), blockHeight };\r\n    return [...acc, postDataWithBlockHeight];\r\n  }, []);\r\n// ========== FILTER DUBLICATES ==========\r\nconst filteredArticles =\r\n  resultArticles.length &&\r\n  resultArticles.reduce((acc, article) => {\r\n    if (!acc.some(({ articleId }) => articleId === article.articleId)) {\r\n      return [...acc, article];\r\n    } else {\r\n      return acc;\r\n    }\r\n  }, []);\r\n\r\nconst filteredArticlesByTag =\r\n  filteredArticles.length &&\r\n  filteredArticles.reduce((acc, article) => {\r\n    if (article.tags && article.tags.includes(tagSelected)) {\r\n      console.log(article);\r\n      return [...acc, article];\r\n    } else {\r\n      return acc;\r\n    }\r\n  }, []);\r\n\r\nreturn (\r\n  <>\r\n    <Widget\r\n      src={`${authorForWidget}/widget/SayALot_MainNavigation`}\r\n      props={{ currentNavPill: \"articles\" }}\r\n    />\r\n    <div>\r\n      Tag:\r\n      {tagSelected}\r\n    </div>\r\n    <ol>\r\n      {filteredArticlesByTag &&\r\n        filteredArticlesByTag.map((article, index) => (\r\n          <li key={article.articleId}>\r\n            <a\r\n              href={`#/${authorForWidget}/widget/SayALot_OneArticle?articleId=${article.articleId}&blockHeight=${article.blockHeight}&lastEditor=${article.lastEditor}\r\n            `}\r\n            >\r\n              {article.articleId}{\" \"}\r\n              <small>\r\n                (last edited:\r\n                {getDateLastEdit(article.timeLastEdit)})\r\n              </small>\r\n            </a>\r\n            <Widget\r\n              src={`${authorForWidget}/widget/SayALot_TagList`}\r\n              props={{ tags: article.tags }}\r\n            />\r\n          </li>\r\n        ))}\r\n    </ol>\r\n  </>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/SayALot_ArticlesByTag", "fact_widget_deployments_id": "76e640f17ce21ec08aa595ed1079e496", "inserted_timestamp": "2000-01-01T00:00:00.000Z", "modified_timestamp": "2000-01-01T00:00:00.000Z", "__row_index": 9}