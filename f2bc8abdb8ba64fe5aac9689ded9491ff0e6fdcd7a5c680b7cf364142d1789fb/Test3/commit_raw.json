{"tx_hash": "G1VWdvvJF8vKVMRd4p7BbtAK1EKsXW7EBtw8kVqtQGSD", "action_id_social": "Ci4xcDpfw4oATmG3FQoiMFtTVh39Nhh3xZX9u7dKzZ5d-0-widget", "block_id": 107160914, "block_timestamp": "2023-12-04T21:00:51.700Z", "signer_id": "f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb", "widget_name": "Test3", "source_code": "State.init({\r\n  libsLoaded: false,\r\n});\r\n\r\nconst widgets = {\r\n  libNotifications: `f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/lib.notifications`,\r\n};\r\n\r\nconst imports = { notifications: [\"notify\", \"clg\"] };\r\n\r\nfunction stateUpdate(obj) {\r\n  State.update(obj);\r\n}\r\n\r\nState.update({ libsLoaded: true });\r\n\r\nObject.keys(imports).forEach((library) => {\r\n  imports[library].forEach((functionCalled) => {\r\n    if (!state[library][functionCalled]) {\r\n      State.update({ libsLoaded: false });\r\n    }\r\n  });\r\n});\r\n\r\nif (!state.libsLoaded) {\r\n  return (\r\n    <Widget\r\n      src={`${widgets.libNotifications}`}\r\n      props={{ stateUpdate, imports: imports[\"notifications\"] }}\r\n    />\r\n  );\r\n}\r\n\r\nfunction onCommit() {\r\n  State.update({ articleCommited: true, notifications: undefined });\r\n}\r\n\r\nfunction findLastArticle(articles) {\r\n  return articles.find((article) => article.accountId === context.accountId);\r\n}\r\n\r\nconst articles = Social.index(\"test_sayALotArticle_v0.0.2\", \"main\", {\r\n  order: \"desc\",\r\n});\r\n\r\nconst lastArticleFromThisAuthor = articles && findLastArticle(articles);\r\n\r\nif (\r\n  articles &&\r\n  JSON.stringify(state.lastArticleFromThisAuthor) !==\r\n    JSON.stringify(lastArticleFromThisAuthor)\r\n) {\r\n  State.update({ lastArticleFromThisAuthor });\r\n}\r\n\r\nif (state.articleCommited) {\r\n  State.update({\r\n    articleCreated: state.lastArticleFromThisAuthor,\r\n    articleCommited: false,\r\n  });\r\n}\r\n\r\nconsole.log(state);\r\n\r\nif (state.articleCreated !== undefined) {\r\n  console.log(\"inside if\");\r\n  state.notifications.notify(\r\n    \"mention\",\r\n    `${context.accountId}`,\r\n    `https://near.social/${context.accountId}/widget/SayALot?isTest=t&sharedBlockHeight=${articleCreated.blockHeight}`\r\n  );\r\n}\r\n\r\nfunction makePost() {\r\n  Social.set(\r\n    {\r\n      [\"test_sayALotArticle_v0.0.2\"]: {\r\n        main: `{\"title\":\"Test again TT.TT 3\",\"author\":\"${\r\n          context.accountId\r\n        }\",\"lastEditor\":\"${\r\n          context.accountId\r\n        }\",\"timeLastEdit\":${Date.now()},\"timeCreate\":${Date.now()},\"body\": \"@${\r\n          context.accountId\r\n        }\",\"version\":0,\"navigation_id\":null,\"tags\":{},\"id\":\"${\r\n          context.accountId\r\n        }-${Date.now()}\",\"sbts\":[\"public\"]}`,\r\n      },\r\n      index: {\r\n        [\"test_sayALotArticle_v0.0.2\"]: `{\"key\":\"main\",\"value\":{\"type\":\"md\",\"id\":\"${\r\n          context.accountId\r\n        }-${Date.now()}\"}}`,\r\n      },\r\n    },\r\n    {\r\n      force: true,\r\n      onCommit,\r\n      onCancel,\r\n    }\r\n  );\r\n}\r\n\r\nSocial.set(\r\n  {\r\n    post: {\r\n      main: JSON.stringify({\r\n        type: \"md\",\r\n        text: `${notificationTypeText[notificationType]} ${redirectTo}`,\r\n      }),\r\n    },\r\n    index: {\r\n      notify: JSON.stringify({\r\n        key: userToNotify,\r\n        value: {\r\n          type: \"mention\",\r\n          item: {\r\n            type: \"social\",\r\n            path: `${context.accountId}/post/main`,\r\n          },\r\n        },\r\n      }),\r\n    },\r\n  },\r\n  {\r\n    force: true,\r\n    onCommit: () => {\r\n      stateUpdate({ articleCreated: undefined });\r\n    },\r\n  }\r\n);\r\n\r\nreturn <button onClick={makePost}>Make post + Notify mention</button>;\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/Test3", "fact_widget_deployments_id": "424cf5549c8ff1a019e826901c326818", "inserted_timestamp": "2023-12-04T22:52:58.400Z", "modified_timestamp": "2023-12-20T03:22:11.422Z", "__row_index": 0}