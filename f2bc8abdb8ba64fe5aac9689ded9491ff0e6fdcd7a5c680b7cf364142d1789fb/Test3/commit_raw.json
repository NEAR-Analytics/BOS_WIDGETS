{"tx_hash": "CkYQdVE5db43LjgL4Br5JLgJJqbeUUUxYB3J6ZAWoBDx", "action_id_social": "C29rWojLYarPt7k1nf6AYGSrCdzTiY94FvppzqjHtmzu-0-widget", "block_id": 106897583, "block_timestamp": "2023-12-01T00:22:47.884Z", "signer_id": "f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb", "widget_name": "Test3", "source_code": "State.init({\r\n  libsLoaded: false,\r\n});\r\n\r\nconst widgets = {\r\n  libNotifications: `f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/lib.notifications`,\r\n};\r\n\r\nfunction stateUpdate(obj) {\r\n  State.update(obj);\r\n}\r\n\r\nconst imports = { notifications: [\"notify\", \"clg\"] };\r\n\r\nfunction onCommit() {\r\n  State.update({ articleCommited: true });\r\n}\r\n\r\nfunction findLastArticle(articles) {\r\n  return articles.find((article) => article.accountId === context.accountId);\r\n}\r\n\r\nconst articles = Social.index(\"test_sayALotArticle_v0.0.2\", \"main\", {\r\n  order: \"desc\",\r\n});\r\n\r\nconst lastArticleFromThisAuthor = findLastArticle(articles);\r\n\r\nif (\r\n  articles &&\r\n  JSON.stringify(state.lastArticleFromThisAuthor) !==\r\n    JSON.stringify(lastArticleFromThisAuthor)\r\n) {\r\n  console.log(\"Found last article\");\r\n  State.update({ lastArticleFromThisAuthor });\r\n}\r\n\r\nif (state.articleCommited) {\r\n  console.log(\"Proceding to push notification\");\r\n  State.update({\r\n    articleCreated: state.lastArticleFromThisAuthor,\r\n    articleCommited: false,\r\n  });\r\n}\r\n\r\nif (state.articleCreated) {\r\n  console.log(\"call nofity(): \", state.notify);\r\n  state.notify(\r\n    \"mention\",\r\n    \"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb\",\r\n    `https://near.social/f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/SayALot?isTest=t&sharedBlockHeight=${articleCreated.blockHeight}`\r\n  );\r\n}\r\n\r\nfunction makePost() {\r\n  Social.set(\r\n    {\r\n      [\"test_sayALotArticle_v0.0.2\"]: {\r\n        main: '{\"title\":\"Test notification9\",\"author\":\"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb\",\"lastEditor\":\"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb\",\"timeLastEdit\":1701379839727,\"timeCreate\":1701379839727,\"body\":\"Test\",\"version\":0,\"navigation_id\":null,\"tags\":{},\"id\":\"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb-1701379839727\",\"sbts\":[\"public\"]}',\r\n      },\r\n      index: {\r\n        [\"test_sayALotArticle_v0.0.2\"]:\r\n          '{\"key\":\"main\",\"value\":{\"type\":\"md\",\"id\":\"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb-1701379839727\"}}',\r\n      },\r\n    },\r\n    {\r\n      force: true,\r\n      onCommit,\r\n      onCancel,\r\n    }\r\n  );\r\n}\r\n\r\nState.update({ libsLoaded: true });\r\n\r\nObject.keys(imports).forEach((library) => {\r\n  imports[library].forEach((functionCalled) => {\r\n    if (!state[functionCalled]) {\r\n      State.update({ libsLoaded: false });\r\n    }\r\n  });\r\n});\r\n\r\nif (!state.libsLoaded) {\r\n  return (\r\n    <Widget\r\n      src={`${widgets.libNotifications}`}\r\n      props={{ stateUpdate, imports: imports[\"notifications\"] }}\r\n    />\r\n  );\r\n}\r\n\r\nreturn <button onClick={makePost}>Make post + Notify mention</button>;\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/Test3", "fact_widget_deployments_id": "e215bb3148ea0dd6920bf70d1fc268ec", "inserted_timestamp": "2023-12-01T02:38:08.643Z", "modified_timestamp": "2023-12-20T02:50:47.065Z", "__row_index": 9}