{"tx_hash": "Bp5UEM1oThXLoYLhWEXKDLLXC8zJiQR3tyuop3RFaEbi", "action_id_social": "Ax8UjPuKTW8JpkZx5yuhAzwWVsb5awtnWxTxc3jES3Lp-0-widget", "block_id": 97327091, "block_timestamp": "2023-07-25T21:01:17.034Z", "signer_id": "f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb", "widget_name": "Test3", "source_code": "const isDebug = props.isDebug;\r\nconst addressForArticles = isDebug ? \"test_sayALotArticle\" : \"sayALotArticle\";\r\n\r\nconst writersWhiteList = props.writersWhiteList ?? [\r\n  \"neardigitalcollective.near\",\r\n  \"blaze.near\",\r\n  \"jlw.near\",\r\n  \"kazanderdad.near\",\r\n  \"joep.near\",\r\n  \"sarahkornfeld.near\",\r\n  \"yuensid.near\",\r\n  \"shubham007.near\",\r\n  \"fiftycent.near\",\r\n];\r\n\r\nconst sayALotWorkers = [\r\n  \"silkking.near\",\r\n  \"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb\",\r\n  \"blaze.near\",\r\n  \"ayelen.near\",\r\n  \"kenrou-it.near\",\r\n];\r\n\r\nif (isDebug) {\r\n  writersWhiteList = sayALotWorkers;\r\n}\r\n\r\nconst articleBlackList = [91092435, 91092174, 91051228, 91092223, 91051203];\r\n\r\nfunction getLastEditionsByArticle() {\r\n  const allArticles = Social.index(addressForArticles, \"main\", {\r\n    order: \"desc\",\r\n    accountId: undefined,\r\n  });\r\n\r\n  const oldFormatArticlesData = isDebug\r\n    ? [\r\n        [\"ayelen.near\", 96927579],\r\n        [\r\n          \"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb\",\r\n          96399182,\r\n        ],\r\n      ]\r\n    : [\r\n        [\"fiftycent.near\", 97322138],\r\n        [\"blaze.near\", 97255023],\r\n        [\"jlw.near\", 97250015],\r\n        [\"kazanderdad.near\", 96692435],\r\n        [\"blaze.near\", 96414482],\r\n        [\"blaze.near\", 96412953],\r\n        [\"sarahkornfeld.near\", 96402919],\r\n        [\"sarahkornfeld.near\", 96402476],\r\n        [\"sarahkornfeld.near\", 96402330],\r\n        [\"sarahkornfeld.near\", 96401880],\r\n        [\"blaze.near\", 95766756],\r\n        [\"blaze.near\", 95766700],\r\n        [\"jlw.near\", 95705034],\r\n        [\"blaze.near\", 95413943],\r\n        [\"blaze.near\", 94936576],\r\n        [\"yuensid.near\", 94866690],\r\n        [\"sarahkornfeld.near\", 94863580],\r\n        [\"blaze.near\", 94801223],\r\n        [\"sarahkornfeld.near\", 94344236],\r\n        [\"sarahkornfeld.near\", 94188387],\r\n        [\"jlw.near\", 93986868],\r\n        [\"blaze.near\", 92999498],\r\n      ];\r\n  let oldFormatArticles = [];\r\n\r\n  for (let i = 0; i < oldFormatArticlesData.length; i++) {\r\n    let article = Social.get(\r\n      `${oldFormatArticlesData[i][0]}/${addressForArticles}/main`,\r\n      oldFormatArticlesData[i][1]\r\n    );\r\n\r\n    oldFormatArticles.push(JSON.parse(article));\r\n  }\r\n\r\n  let newFormatArticlesData = allArticles\r\n    .filter((articleIndex) => articleIndex.value.id)\r\n    .filter(\r\n      (articleIndex) =>\r\n        articleIndex.value.id.split(\"-\")[0] === articleIndex.accountId\r\n    )\r\n    .filter((articleIndex) => writersWhiteList.includes(articleIndex.accountId))\r\n    .filter(\r\n      (articleIndex) => !articleBlackList.includes(articleIndex.blockHeight)\r\n    );\r\n\r\n  let reducedArticlesData = [];\r\n\r\n  for (let i = 0; i < newFormatArticlesData.length; i++) {\r\n    let currentArticleData = newFormatArticlesData[i];\r\n    let articleWithSameId = reducedArticlesData.find(\r\n      (article) => article.value.id === currentArticleData.value.id\r\n    );\r\n\r\n    if (!articleWithSameId) {\r\n      reducedArticlesData.push(currentArticleData);\r\n    }\r\n  }\r\n\r\n  let reducedArticles = [];\r\n  for (let i = 0; i < reducedArticlesData.length; i++) {\r\n    const article = Social.get(\r\n      `${reducedArticlesData[i].accountId}/${addressForArticles}/main`,\r\n      reducedArticlesData[i].blockHeight\r\n    );\r\n    reducedArticles.push(JSON.parse(article));\r\n  }\r\n\r\n  let finalArticles = [];\r\n  for (let i = 0; i < oldFormatArticles.length; i++) {\r\n    let articleWithNewStructure = reducedArticles.find(\r\n      (article) => article.articleId === oldFormatArticles[i].articleId\r\n    );\r\n\r\n    if (!articleWithNewStructure) {\r\n      finalArticles.push(oldFormatArticles[i]);\r\n    }\r\n  }\r\n\r\n  for (let i = 0; i < reducedArticles.length; i++) {\r\n    finalArticles.push(reducedArticles[i]);\r\n  }\r\n\r\n  return finalArticles;\r\n}\r\n\r\nconsole.log(getLastEditionsByArticle());\r\n\r\nreturn <div>{JSON.stringify(getLastEditionsByArticle())}</div>;\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/Test3", "fact_widget_deployments_id": "7a2e71534ee5b9aa82b8823132f051d0", "inserted_timestamp": "2000-01-01T00:00:00.000Z", "modified_timestamp": "2000-01-01T00:00:00.000Z", "__row_index": 14}