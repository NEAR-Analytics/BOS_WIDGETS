{"tx_hash": "FspEojvHdZt7Rm3dYZBMbn4xoZyvRvne1bDUjF7wRNoC", "action_id_social": "QvTwVvXUwphHrUxBiSk6dA8zjLwAtt7rHougimLDstL-0-widget", "block_id": 98961625, "block_timestamp": "2023-08-16T20:18:14.156Z", "signer_id": "f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb", "widget_name": "NDC.UpVoteButton", "source_code": "const { isTest, authorForWidget, reactedElementData, widgets } = props;\r\n\r\nconst data = reactedElementData;\r\n\r\nconst libSrcArray = [`${authorForWidget}/widget/SayALot.lib.upVotes`];\r\n\r\nconst libCalls = [\r\n  {\r\n    functionName: \"getUpVotes\",\r\n    key: \"upVotes\",\r\n    props: {\r\n      elementReactedId: data.realArticleId,\r\n      createdInteraction: state.createdInteraction,\r\n    },\r\n  },\r\n];\r\n\r\nState.init({\r\n  libCalls,\r\n});\r\n\r\nlet userJustDeleted =\r\n  state.createdInteraction !== undefined ? state.createdInteraction : false;\r\n\r\nlet userJustVoted =\r\n  state.createdInteraction !== undefined ? !state.createdInteraction : false;\r\n\r\nfunction getNumberOfUpVotes() {\r\n  if (state.createdInteraction !== undefined && userJustDeleted) {\r\n    return state.upVotes.reactionsStatistics - 1 ?? 0;\r\n  } else if (state.createdInteraction !== undefined && userJustVoted) {\r\n    return state.upVotes.reactionsStatistics + 1 ?? 0;\r\n  } else {\r\n    return state.upVotes.reactionsStatistics ?? 0;\r\n  }\r\n}\r\n\r\nfunction getUpVoteButtonClass() {\r\n  if (\r\n    (state.createdInteraction !== undefined && userJustVoted) ||\r\n    (state.createdInteraction !== undefined && !userJustDeleted) ||\r\n    (state.upVotes.userInteraction.value.deleteReaction !== undefined &&\r\n      !state.upVotes.userInteraction.value.deleteReaction)\r\n  ) {\r\n    return \"primary\";\r\n  } else {\r\n    return \"secondary dark\";\r\n  }\r\n}\r\n\r\nfunction callLibs(srcArray, stateUpdate, libCalls) {\r\n  return (\r\n    <>\r\n      {srcArray.map((src) => {\r\n        return (\r\n          <Widget\r\n            src={src}\r\n            props={{\r\n              isTest,\r\n              stateUpdate,\r\n              libCalls,\r\n            }}\r\n          />\r\n        );\r\n      })}\r\n    </>\r\n  );\r\n}\r\n\r\nfunction stateUpdate(obj) {\r\n  State.update(obj);\r\n}\r\n\r\nfunction upVoteListener() {\r\n  let newLibCalls = [...libCalls];\r\n\r\n  let isDelete;\r\n\r\n  if (state.createdInteraction !== undefined && userJustDeleted) {\r\n    isDelete = false;\r\n  } else if (state.createdInteraction !== undefined && userJustVoted) {\r\n    isDelete = true;\r\n  } else {\r\n    isDetele =\r\n      state.upVotes.userInteraction.value.deleteReaction !== undefined\r\n        ? !state.upVotes.userInteraction.value.deleteReaction\r\n        : false;\r\n  }\r\n\r\n  function onCommit() {\r\n    State.update({\r\n      createdInteraction: isDelete,\r\n    });\r\n  }\r\n\r\n  newLibCalls.push({\r\n    functionName: \"addVote\",\r\n    key: \"addVote\",\r\n    props: {\r\n      isDelete,\r\n      elementReactedId: data.realArticleId,\r\n      onCommit,\r\n    },\r\n  });\r\n  State.update({ libCalls: newLibCalls });\r\n}\r\n\r\nconst CallLibrary = styled.div`\r\n  display: none;\r\n`;\r\n\r\nreturn (\r\n  <>\r\n    <Widget\r\n      src={widgets.styledComponents}\r\n      props={{\r\n        Button: {\r\n          text: `+${getNumberOfUpVotes()}`,\r\n          className: getUpVoteButtonClass(),\r\n          size: \"sm\",\r\n          onClick: upVoteListener,\r\n          icon: <i className=\"bi bi-hand-thumbs-up\"></i>,\r\n        },\r\n      }}\r\n    />\r\n\r\n    <CallLibrary>\r\n      {callLibs(libSrcArray, stateUpdate, state.libCalls)}\r\n    </CallLibrary>\r\n  </>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/NDC.UpVoteButton", "fact_widget_deployments_id": "53d4da1470f9b45765dd86a73f868a7c", "inserted_timestamp": "2023-08-16T22:21:38.234Z", "modified_timestamp": "2023-08-16T22:21:38.234Z", "__row_index": 8}