{"tx_hash": "EszSyM95yH3W5qs87HkgbjExuNtpJqSsbGwqQ2pVxN6d", "action_id_social": "J4frViahDzJU4vcoVD75XbYNhtLa5FnybebZ1C2JybQ4-0-widget", "block_id": 98984995, "block_timestamp": "2023-08-17T03:33:06.538Z", "signer_id": "f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb", "widget_name": "NDC.UpVoteButton", "source_code": "const { isTest, authorForWidget, reactedElementData, widgets } = props;\n\nconst data = reactedElementData;\n\nconst libSrcArray = [`${authorForWidget}/widget/SayALot.lib.upVotes`];\n\nconst libCalls = [\n  {\n    functionName: \"getUpVotes\",\n    key: \"upVotes\",\n    props: {\n      elementReactedId: data.realArticleId,\n      createdInteraction: state.createdInteraction,\n    },\n  },\n];\n\nState.init({\n  libCalls,\n});\n\nif (state.upVotes.reactionsStatistics && !state.numberOfvotesModified) {\n  State.update({ numberOfVotes: state.upVotes.reactionsStatistics ?? 0 });\n}\n\nconst lastUserVote = state.upVotes.userInteraction;\nif (\n  data.realArticleId ===\n  \"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb-1691530843649\"\n) {\n  console.log(\"createdInteraction: \", state.createdInteraction);\n  console.log(\"lastUserVote: \", lastUserVote);\n  console.log(\"numberOfvotesModified: \", state.numberOfvotesModified);\n}\nlet isDelete;\nif (state.createdInteraction !== undefined) {\n  isDelete = !state.createdInteraction;\n} else if (lastUserVote) {\n  if (state.numberOfvotesModified) {\n    isDelete = lastUserVote.value.deleteReaction;\n  } else {\n    isDelete = !lastUserVote.value.deleteReaction;\n  }\n} else {\n  isDelete = false;\n}\nif (\n  data.realArticleId ===\n  \"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb-1691530843649\"\n) {\n  console.log(isDelete);\n}\n\nfunction getUpVoteButtonClass() {\n  if (isDelete) {\n    return \"primary\";\n  } else {\n    return \"secondary dark\";\n  }\n}\n\nfunction callLibs(srcArray, stateUpdate, libCalls) {\n  return (\n    <>\n      {srcArray.map((src) => {\n        return (\n          <Widget\n            src={src}\n            props={{\n              isTest,\n              stateUpdate,\n              libCalls,\n            }}\n          />\n        );\n      })}\n    </>\n  );\n}\n\nfunction stateUpdate(obj) {\n  State.update(obj);\n}\n\nfunction upVoteListener() {\n  let newLibCalls = [...libCalls];\n\n  function onCommit() {\n    state.numberOfVotes &&\n      State.update({\n        numberOfvotesModified: !state.numberOfvotesModified,\n        numberOfVotes: isDelete\n          ? state.numberOfVotes - 1\n          : state.numberOfVotes + 1,\n        createdInteraction: !isDelete,\n      });\n  }\n\n  newLibCalls.push({\n    functionName: \"addVote\",\n    key: \"addVote\",\n    props: {\n      isDelete,\n      elementReactedId: data.realArticleId,\n      onCommit,\n    },\n  });\n  State.update({ libCalls: newLibCalls });\n}\n\nconst CallLibrary = styled.div`\n  display: none;\n`;\nreturn (\n  <>\n    <Widget\n      src={widgets.styledComponents}\n      props={{\n        Button: {\n          text: `+${state.numberOfVotes ?? 0}`,\n          className: `${getUpVoteButtonClass()}`,\n          size: \"sm\",\n          onClick: upVoteListener,\n          icon: <i className=\"bi bi-hand-thumbs-up\"></i>,\n        },\n      }}\n    />\n\n    <CallLibrary>\n      {callLibs(libSrcArray, stateUpdate, state.libCalls)}\n    </CallLibrary>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/NDC.UpVoteButton", "fact_widget_deployments_id": "211f674c12736695105540f8bddc2992", "inserted_timestamp": "2023-08-17T05:22:22.970Z", "modified_timestamp": "2023-08-17T05:22:22.970Z", "__row_index": 50}