{"tx_hash": "J8ak2vkfSeU9YBQmyFbKNePvhAmWQMZUhb8sEyNeeN1S", "action_id_social": "BQTbxFJa1xmkwG2MSBDM3fXsmB26Xm9BemTdLRMnRSuU-0-widget", "block_id": 94267120, "block_timestamp": "2023-06-15T22:00:23.961Z", "signer_id": "f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb", "widget_name": "EasyPoll.Voting2", "source_code": "State.init({\r\n  profile: {},\r\n  showQuestionsByThisUser: false,\r\n  pollsByThisCreator: [{}],\r\n  polls: [{}],\r\n  poll: {},\r\n});\r\n\r\nconst polls =\r\n  !props.previewInfo &&\r\n  Social.index(\"poll_question\", `question-v${indexVersion}`);\r\nif (JSON.stringify(polls) != JSON.stringify(state.polls)) {\r\n  State.update({ polls: polls });\r\n}\r\n\r\nif (!state.polls) {\r\n  return \"Loading\";\r\n} else {\r\n  const poll =\r\n    props.previewInfo ??\r\n    state.polls.find((q) => q.blockHeight == questionBlockHeight);\r\n\r\n  if (JSON.stringify(poll) != JSON.stringify(state.poll)) {\r\n    State.update({ poll: poll });\r\n  }\r\n\r\n  if (!state.poll && !isPreview) {\r\n    return \"Loading... \";\r\n  }\r\n}\r\n\r\nlet pollsByThisCreator = Social.index(\r\n  \"poll_question\",\r\n  `question-v${indexVersion}`,\r\n  {\r\n    accountId: state.poll.accountId,\r\n  }\r\n);\r\n\r\nif (\r\n  JSON.stringify(pollsByThisCreator) != JSON.stringify(state.pollsByThisCreator)\r\n) {\r\n  State.update({ pollsByThisCreator: pollsByThisCreator });\r\n}\r\n\r\nif (!state.pollsByThisCreator) {\r\n  return \"Loading\";\r\n}\r\n\r\nlet profile = Social.getr(`${state.poll.accountId}/profile`);\r\n\r\nif (JSON.stringify(profile) != JSON.stringify(state.profile)) {\r\n  State.update({ profile: profile });\r\n}\r\n\r\n// if (!profile) {\r\n//   return \"Loading\";\r\n// }\r\n\r\nlet canOperate = props.canOperate;\r\n\r\nfunction showDescription(description) {\r\n  if (state.descriptionHeightLimited && description.length > 501) {\r\n    return description.slice(0, 500) + \"...\";\r\n  } else {\r\n    return description;\r\n  }\r\n}\r\n\r\nconst renderPollTypeIcon = () => {\r\n  let allPollTypes = [];\r\n  for (let i = 0; i < poll.value.questions.length; i++) {\r\n    if (!allPollTypes.includes(poll.value.questions[i].questionType)) {\r\n      allPollTypes.push(poll.value.questions[i].questionType);\r\n    }\r\n  }\r\n\r\n  return allPollTypes.length == 1 &&\r\n    (allPollTypes[0] == \"0\" || allPollTypes[0] == \"1\") ? (\r\n    <i className=\"bi bi-pie-chart\" style={{ padding: \"0.6rem 0.8rem\" }}></i>\r\n  ) : allPollTypes.length == 1 && allPollTypes[0] == \"2\" ? (\r\n    <i\r\n      style={{\r\n        transform: \"rotate(90deg)\",\r\n        padding: \"0.6rem 0.8rem\",\r\n      }}\r\n      className=\"bi bi-bar-chart-line\"\r\n    ></i>\r\n  ) : allPollTypes.length == 1 && allPollTypes[0] == \"3\" ? (\r\n    <i className=\"bi bi-file-text\" style={{ padding: \"0.6rem 0.8rem\" }}></i>\r\n  ) : (\r\n    <i className=\"bi bi-collection\" style={{ padding: \"0.6rem 0.8rem\" }}></i>\r\n  );\r\n};\r\n\r\nconst FlexContainer = styled.div`\r\n    display:flex;\r\n    @media screen and (max-width: 768px)  {\r\n      display: block;\r\n      padding: 1rem;\r\n    }\r\n`;\r\n\r\nconst VotingContainer = styled.div`\r\n    width: 75%;\r\n    margin: 2rem 0.5rem 2rem 2rem;\r\n    padding: 2rem;\r\n    @media screen and (max-width: 768px)  {\r\n      width: 100%;\r\n      margin: 0rem;\r\n    }\r\n`;\r\n\r\nconst NoFlexInMobile = styled.div`\r\n  display:flex;\r\n   @media screen and (max-width: 768px)  {\r\n     display: block;\r\n    }\r\n`;\r\n\r\nconst renderQuestionsByThisCreator = () => {\r\n  //TODO show only the 2 polls\r\n  return state.pollsByThisCreator.map((pollByCreator, index) => {\r\n    let divStyle =\r\n      index == 0\r\n        ? { backGroundColor: \"white\" }\r\n        : {\r\n            backGroundColor: \"white\",\r\n            paddingTop: \"1rem\",\r\n            borderTop: \"1px solid #ced4da\",\r\n          };\r\n    return (\r\n      <div style={divStyle}>\r\n        <div className=\"d-flex align-items-center\">\r\n          <div\r\n            className=\"d-flex justify-content-center\"\r\n            style={{\r\n              maxHeight: \"2.8rem\",\r\n              aspectRatio: \"1\",\r\n              borderRadius: \"16px\",\r\n              backgroundColor: \"#F2F6FA\",\r\n              marginRight: \"0.8rem\",\r\n            }}\r\n          >\r\n            {renderPollTypeIcon(pollByCreator)}\r\n          </div>\r\n          <p\r\n            style={{\r\n              fontWeight: \"500\",\r\n              margin: \"0\",\r\n              maxWidth: \"100%\",\r\n              overflow: \"hidden\",\r\n              textOverflow: \"ellipsis\",\r\n              textWrap: \"nowrap\",\r\n            }}\r\n          >\r\n            {pollByCreator.value.title}\r\n          </p>\r\n        </div>\r\n        <div className=\"d-flex justify-content-between flex-nowrap text-secondary mb-2\">\r\n          <div>\r\n            <i className=\"bi bi-people\"></i>\r\n            <span>\r\n              {getValidAnswersQtyFromQuestion(pollByCreator.blockHeight)}\r\n            </span>\r\n          </div>\r\n          <span>\r\n            Ends\r\n            <Widget\r\n              src={`silkking.near/widget/timeAgo`}\r\n              props={{\r\n                timeInFuture: pollByCreator.value.endTimestamp,\r\n                reduced: true,\r\n              }}\r\n            />\r\n          </span>\r\n          <span\r\n            style={{\r\n              backgroundColor: isUpcoming(pollByCreator)\r\n                ? \"#FFF3B4\"\r\n                : isActive(pollByCreator)\r\n                ? \"#D9FCEF\"\r\n                : \"#FFE5E5\",\r\n\r\n              height: \"1.5rem\",\r\n              width: \"4rem\",\r\n              textAlign: \"center\",\r\n              borderRadius: \"16px\",\r\n              marginRight: \"1rem\",\r\n              lineHeight: \"1.5rem\",\r\n              fontSize: \"0.8rem\",\r\n              letterSpacing: \"-0.025rem\",\r\n              color: isUpcoming(pollByCreator)\r\n                ? \"#FFC905\"\r\n                : isActive(pollByCreator)\r\n                ? \"#00B37D\"\r\n                : \"#FF4747\",\r\n              fontWeight: \"500\",\r\n            }}\r\n          >\r\n            {isUpcoming(pollByCreator)\r\n              ? \"Upcoming\"\r\n              : isActive(pollByCreator)\r\n              ? \"Active\"\r\n              : \"Closed\"}\r\n          </span>\r\n        </div>\r\n      </div>\r\n    );\r\n  });\r\n};\r\n\r\nconst widgetOwner = \"neardigitalcollective.near\";\r\nconst indexVersion = props.indexVersion ?? \"3.2.0\";\r\nconst whitelist = props.whitelist;\r\n\r\nreturn (\r\n  <div>\r\n    <FlexContainer className=\"content-align-start justify-content-between\">\r\n      <VotingContainer\r\n        style={{\r\n          borderRadius: \"18px\",\r\n          background: \"white\",\r\n          boxShadow: \"0px 8px 28px rgba(43, 68, 106, 0.05)\",\r\n        }}\r\n      >\r\n        <NoFlexInMobile className=\"justify-content-between\">\r\n          <NoFlexInMobile>\r\n            <Widget\r\n              src=\"mob.near/widget/ProfileImage\"\r\n              props={{\r\n                profile: state.profile,\r\n                question: state.poll.accountId,\r\n                className: \"float-start d-inline-block me-2\",\r\n                style: {\r\n                  width: \"3.5rem\",\r\n                  aspectRatio: \"1\",\r\n                  marginLeft: \"1rem\",\r\n                  borderRadius: \"100%\",\r\n                  overflow: \"hidden\",\r\n                },\r\n              }}\r\n            />\r\n            <div>\r\n              <p style={{ margin: \"0\", fontWeight: \"300\" }}>Created by</p>\r\n              <p\r\n                style={{\r\n                  fontWeight: \"500\",\r\n                  maxWidth: \"100%\",\r\n                  overflow: \"hidden\",\r\n                  textOverflow: \"ellipsis\",\r\n                  textWrap: \"nowrap\",\r\n                }}\r\n              >\r\n                {state.poll.accountId}\r\n              </p>\r\n            </div>\r\n          </NoFlexInMobile>\r\n\r\n          {Date.now() < state.poll.value.endTimestamp && (\r\n            <>\r\n              <span>\r\n                Started{\" \"}\r\n                {new Date(state.poll.value.startTimestamp).toLocaleDateString()}\r\n              </span>\r\n\r\n              <span\r\n                style={{\r\n                  paddingLeft: \"1.2rem\",\r\n                  borderLeft: \"2px solid #ced4da\",\r\n                  height: \"max-content\",\r\n                }}\r\n              >\r\n                Ends\r\n                <Widget\r\n                  src={`silkking.near/widget/timeAgo`}\r\n                  props={{\r\n                    timeInFuture: state.poll.value.endTimestamp,\r\n                    reduced: true,\r\n                  }}\r\n                />\r\n              </span>\r\n            </>\r\n          )}\r\n          <span\r\n            style={{\r\n              backgroundColor: props.isUpcoming(state.poll)\r\n                ? \"#FFF3B4\"\r\n                : props.isActive(state.poll)\r\n                ? \"#D9FCEF\"\r\n                : \"#FFE5E5\",\r\n\r\n              height: \"2.1rem\",\r\n              width: \"5rem\",\r\n              textAlign: \"center\",\r\n              borderRadius: \"16px\",\r\n              marginRight: \"1rem\",\r\n              lineHeight: \"1.9rem\",\r\n              fontSize: \"1rem\",\r\n              letterSpacing: \"-0.025rem\",\r\n              color: props.isUpcoming(state.poll)\r\n                ? \"#FFC905\"\r\n                : props.isActive(state.poll)\r\n                ? \"#00B37D\"\r\n                : \"#FF4747\",\r\n              fontWeight: \"500\",\r\n            }}\r\n          >\r\n            {props.isUpcoming(state.poll)\r\n              ? \"Upcoming\"\r\n              : props.isActive(state.poll)\r\n              ? \"Active\"\r\n              : \"Closed\"}\r\n          </span>\r\n        </NoFlexInMobile>\r\n        <div className=\"d-flex my-3\">\r\n          <div\r\n            style={{\r\n              height: \"inherit\",\r\n              backgroundColor: \"#AAC8F7\",\r\n              width: \"0.5rem\",\r\n              minWidth: \"5px\",\r\n              marginRight: \"0.5rem\",\r\n              borderRadius: \"8px\",\r\n            }}\r\n          >\r\n            {/*Decorative div, do not delete*/}\r\n          </div>\r\n          <h2\r\n            style={{\r\n              fontWeight: \"700\",\r\n              fontSize: \"2rem\",\r\n              letterSpacing: \"0.1px\",\r\n              color: \"#010A2D\",\r\n              wordWrap: \"anywhere\",\r\n            }}\r\n          >\r\n            {state.poll.value.title}\r\n          </h2>\r\n        </div>\r\n        <div\r\n          style={{\r\n            position: \"relative\",\r\n            width: \"max-content\",\r\n            margin: \"1rem\",\r\n          }}\r\n        >\r\n          <Widget\r\n            src={`${widgetOwner}/widget/EasyPoll.Share`}\r\n            props={{ blockHeight: props.questionBlockHeight }}\r\n          />\r\n        </div>\r\n        <div\r\n          className=\"p-3\"\r\n          style={{\r\n            position: \"relative\",\r\n            border: \"1.5px solid rgb(206, 212, 218)\",\r\n            borderRadius: \"24px\",\r\n            wordWrap: \"anywhere\",\r\n          }}\r\n        >\r\n          <h3\r\n            style={{\r\n              fontWeight: \"700\",\r\n              fontSize: \"1.2rem\",\r\n              marginBottom: \"1.2rem\",\r\n            }}\r\n          >\r\n            Description\r\n          </h3>\r\n          <p style={{ fontSize: \"0.9rem\" }}>\r\n            {showDescription(state.poll.value.description)}\r\n          </p>\r\n          {state.poll.value.description.length > 501 &&\r\n          !props.descriptionHeightLimited ? (\r\n            <div\r\n              style={{\r\n                position: \"absolute\",\r\n                bottom: \"-1.125rem\",\r\n                left: \"0\",\r\n                right: \"0\",\r\n                marginRight: \"auto\",\r\n                marginLeft: \"auto\",\r\n                textAlign: \"center\",\r\n              }}\r\n            >\r\n              <h4\r\n                style={{\r\n                  fontSize: \"1.2rem\",\r\n                  display: \"inline-block\",\r\n                  backgroundColor: \"white\",\r\n                  padding: \"0 1rem\",\r\n                  cursor: \"pointer\",\r\n                }}\r\n                onClick={() =>\r\n                  props.stateUpdate({ descriptionHeightLimited: true })\r\n                }\r\n              >\r\n                Show less <i className=\"bi bi-arrow-up\"></i>\r\n              </h4>\r\n            </div>\r\n          ) : (\r\n            state.poll.value.description.length > 501 && (\r\n              <div\r\n                style={{\r\n                  position: \"absolute\",\r\n                  bottom: \"-1.125rem\",\r\n                  left: \"0\",\r\n                  right: \"0\",\r\n                  marginRight: \"auto\",\r\n                  marginLeft: \"auto\",\r\n                  textAlign: \"center\",\r\n                }}\r\n              >\r\n                <h4\r\n                  style={{\r\n                    fontSize: \"1.2rem\",\r\n                    display: \"inline-block\",\r\n                    backgroundColor: \"white\",\r\n                    padding: \"0 1rem\",\r\n                    cursor: \"pointer\",\r\n                  }}\r\n                  onClick={() =>\r\n                    props.stateUpdate({ descriptionHeightLimited: false })\r\n                  }\r\n                >\r\n                  Show more <i className=\"bi bi-arrow-down\"></i>\r\n                </h4>\r\n              </div>\r\n            )\r\n          )}\r\n        </div>\r\n        {state.poll.value.tgLink != \"\" &&\r\n          state.poll.value.tgLink != undefined && (\r\n            <div\r\n              className=\"mt-3 d-flex justify-content-between\"\r\n              style={{\r\n                border: \"1.5px solid #D4E5FB\",\r\n                padding: \"1.2rem 1.7rem\",\r\n                borderRadius: \"24px\",\r\n              }}\r\n            >\r\n              <div className=\"d-flex\">\r\n                <i\r\n                  className=\"bi bi-people d-flex align-items-center justify-content-center\"\r\n                  style={{\r\n                    height: \"100%\",\r\n                    aspectRatio: \"1\",\r\n                    backgroundColor: \"#2F5BCF\",\r\n                    borderRadius: \"14px\",\r\n                    marginRight: \"1rem\",\r\n                    color: \"white\",\r\n                  }}\r\n                ></i>\r\n                <div>\r\n                  <p\r\n                    className=\"m-0\"\r\n                    style={{\r\n                      color: \"#2F5BCF\",\r\n                      fontWeight: \"500\",\r\n                      fontSize: \"0.7rem\",\r\n                    }}\r\n                  >\r\n                    Discussion link\r\n                  </p>\r\n                  <h6>\r\n                    <a\r\n                      style={{\r\n                        color: \"#2346B1\",\r\n                        maxWidth: \"100%\",\r\n                        overflow: \"hidden\",\r\n                        textOverflow: \"ellipsis\",\r\n                        textWrap: \"nowrap\",\r\n                      }}\r\n                      href={state.poll.value.tgLink}\r\n                    >\r\n                      {state.poll.value.tgLink}\r\n                    </a>\r\n                  </h6>\r\n                </div>\r\n              </div>\r\n              <div className=\"d-flex align-items-center\">\r\n                <a\r\n                  target=\"_blank\"\r\n                  href={state.poll.value.tgLink}\r\n                  style={{ userSelect: \"none\" }}\r\n                >\r\n                  <i\r\n                    className=\"bi bi-box-arrow-up-right\"\r\n                    style={{\r\n                      color: \"#2F5BCF\",\r\n                      cursor: \"pointer\",\r\n                    }}\r\n                  ></i>\r\n                </a>\r\n                <i\r\n                  className=\"bi bi-clipboard\"\r\n                  style={{\r\n                    userSelect: \"none\",\r\n                    color: \"#2F5BCF\",\r\n                    cursor: \"pointer\",\r\n                    marginLeft: \"0.8rem\",\r\n                  }}\r\n                  onClick={() => clipboard.writeText(state.poll.value.tgLink)}\r\n                ></i>\r\n              </div>\r\n            </div>\r\n          )}\r\n        {\r\n          <Widget\r\n            src={`${widgetOwner}/widget/EasyPoll.DisplayVote`}\r\n            props={{\r\n              poll: state.poll,\r\n              isPreview: props.isPreview,\r\n              indexVersion,\r\n              whitelist,\r\n            }}\r\n          />\r\n        }\r\n      </VotingContainer>\r\n      {\r\n        // <Widget\r\n        //   src={`${widgetOwner}/widget/EasyPoll.PollsByCreator`}\r\n        //   props={{\r\n        //     ...props,\r\n        //   }}\r\n        // />\r\n      }\r\n    </FlexContainer>\r\n    {state.showQuestionsByThisUser && (\r\n      <Widget\r\n        src=\"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/renderVotingPollModal\"\r\n        props={{\r\n          stateHandler: State.update(object),\r\n          showQuestionsByThisUser: state.showQuestionsByThisUser,\r\n          indexVersion,\r\n          canOperate,\r\n        }}\r\n      />\r\n    )}\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/EasyPoll.Voting2", "fact_widget_deployments_id": "881ee0016b6c795cf1b9b95996f1a960", "inserted_timestamp": "2000-01-01T00:00:00.000Z", "modified_timestamp": "2000-01-01T00:00:00.000Z", "__row_index": 6}