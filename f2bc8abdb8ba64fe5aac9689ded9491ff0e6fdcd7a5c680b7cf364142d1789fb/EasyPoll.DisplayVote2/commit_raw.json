{"tx_hash": "GDBoAFvfuLLQGYu17YLixmHMufxSasxLUSbBkPJBjmoG", "action_id_social": "2Qq16S2f7r2o19UbjHei42wycPGSaNBNkJJs6nYoCVGA-0-widget", "block_id": 94275508, "block_timestamp": "2023-06-16T00:40:35.534Z", "signer_id": "f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb", "widget_name": "EasyPoll.DisplayVote2", "source_code": "const widgetOwner = \"neardigitalcollective.near\";\n\nlet defaultVotes = [];\nfor (let i = 0; i < props.poll.value.questions.length; i++) {\n  if (props.poll.value.questions[i].questionType == \"2\") {\n    defaultVotes.push([\"\"]);\n  } else {\n    defaultVotes.push(\"\");\n  }\n}\n\nState.init({\n  vote: defaultVotes,\n});\n\nfunction getInputStyles(questionType, questionNumber, optionNumber) {\n  if (questionType == \"2\") {\n    return state.vote[questionNumber].includes(optionNumber + \"\")\n      ? {\n          borderColor: \"black\",\n          backgroundColor: \"black\",\n          width: \"1rem\",\n          marginRight: \"0.7rem\",\n        }\n      : {\n          width: \"1rem\",\n          marginRight: \"0.7rem\",\n        };\n  } else {\n    return optionNumber + \"\" == state.vote[questionNumber]\n      ? {\n          borderColor: \"black\",\n          backgroundColor: \"black\",\n          width: \"1rem\",\n          marginRight: \"0.7rem\",\n        }\n      : {\n          width: \"1rem\",\n          marginRight: \"0.7rem\",\n        };\n  }\n}\n\nfunction getBgColor(index, isPrimary) {\n  let allColorsOfThisType =\n    state.vote != `${index}` && isPrimary ? allBgColors : allSecondaryBgColors;\n\n  return Number.isInteger((index + 1) / allColorsOfThisType.length)\n    ? allColorsOfThisType[0]\n    : allColorsOfThisType[\n        ((index + 1) / allColorsOfThisType.length -\n          Math.trunc((index + 1) / allColorsOfThisType.length)) *\n          allColorsOfThisType.length -\n          1\n      ];\n}\n\nfunction isVoteValid() {\n  let isValid = state.vote.length == props.poll.value.questions.length;\n  isValid = isValid && context.accountId;\n  for (let i = 0; i < state.vote.length; i++) {\n    const vote = state.vote[i];\n    // vote should always be a string, but in one case is treated as an array. Replace array with csv\n    if (Array.isArray(vote)) {\n      isValid = isValid && vote.filter((v) => v.trim() != \"\").length > 0;\n    } else {\n      isValid = isValid && vote.trim() != \"\";\n    }\n  }\n  return isValid;\n}\n\nfunction clickRadioInputHandler(questionNumber, optionNumber) {\n  return () => {\n    let newVote = state.vote;\n\n    newVote[questionNumber] = optionNumber + \"\";\n    State.update({ vote: newVote });\n  };\n}\n\nfunction clickCheckboxInputHandler(questionNumber, optionNumber) {\n  return () => {\n    let newVote = state.vote;\n\n    let oldQuestionVotes = newVote[questionNumber];\n    let newQuestionVotes = [];\n\n    if (!oldQuestionVotes.includes(optionNumber + \"\")) {\n      newQuestionVotes = oldQuestionVotes;\n      newQuestionVotes.push(optionNumber + \"\");\n    } else {\n      for (let i = 0; i < oldQuestionVotes.length; i++) {\n        if (oldQuestionVotes[i] != optionNumber + \"\") {\n          newQuestionVotes.push(oldQuestionVotes[i]);\n        }\n      }\n    }\n\n    newVote[questionNumber] = newQuestionVotes.filter((a) => a != \"\");\n\n    State.update({ votes: newVote });\n  };\n}\n\nconst renderMultipleChoiceInput = ({\n  questionNumber,\n  questionType,\n  option,\n  optionNumber,\n}) => (\n  <>\n    <Widget\n      src={`${widgetOwner}/widget/EasyPoll.DisplayMultiVote`}\n      props={{\n        vote: state.vote,\n        questionNumber,\n        questionType,\n        option,\n        optionNumber,\n        canVote: props.canVote,\n        getBgColor: getBgColor,\n        countVotes: props.countVotes,\n        clickRadioInputHandler: clickRadioInputHandler,\n        getInputStyles: getInputStyles,\n      }}\n    />\n  </>\n);\n\nreturn (\n  <>\n    <Widget\n      src={`f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/EasyPoll.DisplayMultiVote2`}\n      props={{\n        poll: props.poll,\n        indexVersion: props.indexVersion,\n        vote: state.vote,\n        questions: props.poll.value.questions,\n        renderMultipleChoiceInput,\n        getInputStyles: getInputStyles,\n        hasVoted: props.hasVoted,\n        stateUpdate: (data) => State.update(data),\n        isQuestionOpen: props.isQuestionOpen,\n        isVoteValid: isVoteValid,\n        validAnswersToThisPoll: props.validAnswersToThisPoll,\n      }}\n    />\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/EasyPoll.DisplayVote2", "fact_widget_deployments_id": "1ee0fd0f5db2eaf30ab0897d6c65192d", "inserted_timestamp": "2000-01-01T00:00:00.000Z", "modified_timestamp": "2000-01-01T00:00:00.000Z", "__row_index": 7}