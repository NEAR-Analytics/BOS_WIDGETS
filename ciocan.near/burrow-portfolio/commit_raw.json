{"tx_hash": "2VVMr49BXbds9cUZS1YRjqdEYNQYdT1CLiuXoCh6aQej", "action_id_social": "74qqrdqgUfU6fZsDqv6wMJiuUiNdgcrCjtHn6vdkh2a9-0-widget", "block_id": 85358995, "block_timestamp": "2023-02-16T15:00:33.947Z", "signer_id": "ciocan.near", "widget_name": "burrow-portfolio", "source_code": "let accountId = context.accountId;\n\nif (!accountId) {\n  return \"Please sign in with NEAR wallet\";\n}\n\nconst toAPY = (v) => Math.round(v * 100) / 100;\n\nconst nFormat = (num, digits) => {\n  const lookup = [\n    { value: 1, symbol: \"\" },\n    { value: 1e3, symbol: \"k\" },\n    { value: 1e6, symbol: \"M\" },\n  ];\n  const rx = /\\.0+$|(\\.[0-9]*[1-9])0+$/;\n  var item = lookup\n    .slice()\n    .reverse()\n    .find((item) => num >= item.value);\n  return item\n    ? (num / item.value).toFixed(digits).replace(rx, \"$1\") + item.symbol\n    : \"0\";\n};\n\nconst { assets, rewards, balances } = state;\n\nconst hasData = assets.length > 0 && rewards.length > 0;\n\nconst onLoad = (data) => {\n  State.update(data);\n};\n\nconst allAssets = hasData\n  ? assets.map((asset, index) => {\n      const r = rewards.find((a) => a.token_id === asset.token_id);\n      const totalApy = r.apyBase + r.apyRewardTvl + r.apyReward;\n      const liquidity = nFormat(asset.availableLiquidity, 2);\n      console.log(asset.token_id, balances[index]);\n      if (balances[index] === \"0\") return null;\n      return (\n        <tr>\n          <td>{asset.metadata.symbol}</td>\n          <td class=\"text-end\">{toAPY(totalApy)}%</td>\n          <td class=\"text-end\">{liquidity}</td>\n        </tr>\n      );\n    })\n  : undefined;\n\nreturn (\n  <div>\n    {!hasData && (\n      <Widget src=\"ciocan.near/widget/burrow-data\" props={{ onLoad }} />\n    )}\n    <table class=\"table\">\n      <thead>\n        <tr\n          style={{\n            color: \"rgba(0, 0, 0, 0.4)\",\n          }}\n        >\n          <th scope=\"col\">Deposited Assets</th>\n          <th scope=\"col\" class=\"text-end\">\n            APY\n          </th>\n          <th scope=\"col\" class=\"text-end\">\n            Deposited\n          </th>\n        </tr>\n      </thead>\n      <tbody>{allAssets}</tbody>\n    </table>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/ciocan.near/widget/burrow-portfolio", "fact_widget_deployments_id": "06a5f844e284ad0fec8496672b174543", "inserted_timestamp": "2000-01-01T00:00:00.000Z", "modified_timestamp": "2000-01-01T00:00:00.000Z", "__row_index": 1}