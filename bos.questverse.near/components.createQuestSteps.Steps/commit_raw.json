{"tx_hash": "CnDK9nxRhCGZhhRga2G2oYhgR2R1AqjTaDU34BBzJxrp", "action_id_social": "2xdyoV9DLtqWkBErRbBXf7WEwP5L2CRndvEBRU6gjWUe-0-widget", "block_id": 107505562, "block_timestamp": "2023-12-09T09:13:58.096Z", "signer_id": "bos.questverse.near", "widget_name": "components.createQuestSteps.Steps", "source_code": "function handleFormComplete(value) {\n  const questArgs = {\n    args: {\n      quest_id: value.id,\n      title: value.form.title,\n      name: context.accountId,\n      starts_at: value.starts_at,\n      expires_at: value.expires_at,\n      total_participants_allowed: value.numberOfParticipants,\n      indexer_name: value.total_participants_allowed,\n      description: value.description,\n      img_url: value.img_url,\n      tags: value.tags,\n      humans_only: value.humans_only,\n    },\n  };\n\n  Near.call([\n    {\n      contractName: \"v0.questverse.near\",\n      methodName: \"create_quest\",\n      args: questArgs.args,\n      deposit: (value.tokensAllocated + 0.02)*10^24,\n    },\n  ]);\n}\n\nconst steps = [\n  {\n    title: \"Select Quest Template\",\n    active: state.step === 0,\n    icon: state.step > 0 ? <i className=\"bi bi-check2\"></i> : undefined,\n    className: state.step > 0 ? \"active-outline\" : undefined,\n  },\n  {\n    title: \"Allowlist\",\n    active: state.step === 1,\n    icon: state.step > 1 ? <i className=\"bi bi-check2\"></i> : undefined,\n    className: state.step > 1 ? \"active-outline\" : undefined,\n  },\n  {\n    title: \"Allocate Rewards\",\n    active: state.step === 2,\n    icon: state.step > 2 ? <i className=\"bi bi-check2\"></i> : undefined,\n    className: state.step > 2 ? \"active-outline\" : undefined,\n  },\n  {\n    title: \"Timing\",\n    active: state.step === 3,\n    icon: state.step > 3 ? <i className=\"bi bi-check2\"></i> : undefined,\n    className: state.step > 3 ? \"active-outline\" : undefined,\n  },\n  {\n    title: \"Finalize\",\n    active: state.step === 4,\n    icon: state.step > 4 ? <i className=\"bi bi-check2\"></i> : undefined,\n    className: state.step > 5 ? \"active-outline\" : undefined,\n  },\n];\n\nconst totalSteps = 4;\n\nlet initialFormState = {\n  quest_id: value.id,\n  title: \"\",\n  name: context.accountId,\n  starts_at: null,\n  expires_at: null,\n  total_participants_allowed: 10,\n  indexer_name: \"\",\n  description: \"\",\n  img_url: \"\",\n  tags: [\"quest\"],\n  humans_only: False,\n\n  //STEP\n  inputs: {},\n  //STEP 2\n  masterList: [],\n  allowedList: [],\n  excludedList: [],\n\n  //STEP 3\n  rewardNetwork: \"\",\n  rewardToken: \"\",\n  tokensAllocated: 0,\n  rewardAmount: \"\",\n\n  //STEP 4\n  date_start: \"\",\n  date_end: \"\",\n  indexerConfig: {\n    selectedOption: \"astrodao.near\",\n    selectedAction: \"join a dao\",\n    formData: {},\n    contractID: \"\",\n    inputs: {\n      account_id: \"\",\n      amount: \"\",\n      post_id: \"\",\n      count: \"\",\n      tags: \"\",\n      role: \"\",\n    },\n    indexerId: \"\",\n  },\n};\n\nState.init({\n  step: 0,\n  form: initialFormState,\n  errors: null,\n});\n\nconst handleNext = (data) => {\n  State.update({\n    // update here\n    step: state.step + 1,\n  });\n};\n\nconst handlePrevious = () => {\n  State.update({\n    step: state.step - 1,\n  });\n};\n\nconst handleStepComplete = (value) => {\n  // const stepValid = true;\n  // Object.keys(value).forEach((key) => {\n  //   const properties = types[\"hack.near/type/quest\"].properties.find(\n  //     (p) => p.name === key\n  //   );\n  //   const validation = validateType(properties.type, value[key], properties);\n  //   if (validation) {\n  //     State.update({\n  //       errors: {\n  //         ...state.errors,\n  //         [key]: validation,\n  //       },\n  //     });\n  //     stepValid = false;\n  //   } else {\n  //     State.update({\n  //       errors: {\n  //         ...state.errors,\n  //         [key]: null,\n  //       },\n  //     });\n  //   }\n  // });\n  //\n  // if (!stepValid) return;\n  //\n  if (state.step === 4) {\n    console.log(\"FINAL FORM\", value);\n    const finalAnswers = {\n      ...state.form,\n      ...value,\n    };\n\n    State.update({\n      step: state.step,\n      form: finalAnswers,\n    });\n    console.log(\"FINAL ANSWERS\", finalAnswers);\n    handleFormComplete(finalAnswers);\n    return;\n  }\n  State.update({\n    step: state.step + 1,\n    form: {\n      ...state.form,\n      ...value,\n    },\n  });\n};\n\nconst FormContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n`;\nreturn (\n  <FormContainer>\n    <h1 className=\"h3 fw-bold mb-4\">Create a Quest</h1>\n    <Widget\n      src={`nearui.near/widget/Navigation.Steps`}\n      props={{\n        steps: steps,\n        onClick: (i) => {\n          if (i > state.step) return;\n          State.update({\n            step: i,\n          });\n        },\n      }}\n    />\n    <Widget\n      src={`bos.questverse.near/widget/components.createQuestSteps.step${state.step + 1\n        }`}\n      props={{\n        formState: state.form,\n        onComplete: handleStepComplete,\n        errors: state.errors,\n        renderFooter: (stepState, otherProps) => (\n          <Widget\n            src={`bos.questverse.near/widget/components.quest.create.footer`}\n            props={{\n              isLast: state.step >= steps.length - 1,\n              hasPrevious: state.step > 0,\n              onNext: () => {\n                handleStepComplete(stepState);\n              },\n              onPrevious: () => {\n                State.update({\n                  step: state.step - 1,\n                });\n              },\n              onReset: () => {\n                State.update({\n                  step: 0,\n                  form: initialFormState,\n                  errors: null,\n                });\n              },\n              ...otherProps,\n            }}\n          />\n        ),\n      }}\n    />\n  </FormContainer>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bos.questverse.near/widget/components.createQuestSteps.Steps", "fact_widget_deployments_id": "9d56f3c6223966eff03cb13633db3079", "inserted_timestamp": "2023-12-09T11:18:52.094Z", "modified_timestamp": "2023-12-20T03:22:11.422Z", "__row_index": 2}