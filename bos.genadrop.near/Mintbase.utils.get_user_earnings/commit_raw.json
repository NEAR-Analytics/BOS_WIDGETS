{"tx_hash": "ANAE6tt34MGwHey9fq6c49Cn12ud4Wgk4frsvobWZQiw", "action_id_social": "311c1kyj8rRGWskn6DdSSFx39CwaXBFkzGA7j181kJJQ-0-widget", "block_id": 117436302, "block_timestamp": "2024-04-23T07:26:49.644Z", "signer_id": "bos.genadrop.near", "widget_name": "Mintbase.utils.get_user_earnings", "source_code": "function fetchGraphQL(operationsDoc, operationName, variables) {\n  return asyncFetch(\n    `https://graph.mintbase.xyz/mainnet${\n      variables.account && variables.account.endsWith(\".testnet\")\n        ? \"testnet\"\n        : \"mainnet\"\n    }`,\n    {\n      method: \"POST\",\n      headers: {\n        \"mb-api-key\": \"anon\",\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        query: operationsDoc,\n        variables: variables,\n        operationName: operationName,\n      }),\n    }\n  ).then((result) => result.body);\n}\n\nconst operationsDoc = `\n      query GetEarned($account: String!, $currency: [String!] = [\"near\"], $limit: Int!, $offset: Int!) {\n        earnings: nft_earnings(\n          where: {receiver_id: {_eq: $account}}\n          order_by: {timestamp: desc}\n          limit: $limit\n          offset: $offset\n        ) {\n          offer_id\n          offer {\n            offered_by\n            offered_at\n            token {\n              metadata_id\n              __typename\n            }\n            nft_token {\n              media\n              base_uri\n              __typename\n            }\n            receiptId: receipt_id\n            __typename\n          }\n          nft_token {\n            media\n            base_uri\n            media_hash\n            title\n            __typename\n          }\n          amount\n          currency\n          nft_contract_id\n          approval_id\n          timestamp\n          receiver_id\n          token_id\n          __typename\n        }\n        earnings_aggregate: nft_earnings_aggregate(\n          where: {receiver_id: {_eq: $account}, currency: {_in: $currency}}\n        ) {\n          aggregate {\n            sum {\n              amount\n              __typename\n            }\n            count\n            __typename\n          }\n          __typename\n        }\n        lists_aggregate: nft_listings_aggregate(\n          distinct_on: [token_id, nft_contract_id]\n          where: {listed_by: {_eq: $account}}\n        ) {\n          aggregate {\n            count\n            __typename\n          }\n          __typename\n        }\n      }\n    `;\n\nfunction getUserEarnings({ account, currency, limit, offset }) {\n  return fetchGraphQL(operationsDoc, \"GetEarned\", {\n    account: account,\n    currency: currency,\n    limit: limit ?? 100,\n    offset: offset ?? 0,\n  });\n}\n\nreturn { getUserEarnings };\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bos.genadrop.near/widget/Mintbase.utils.get_user_earnings", "fact_widget_deployments_id": "0f453d6a17fe57f1f3169776d82a5b1e", "inserted_timestamp": "2024-04-23T09:44:05.024Z", "modified_timestamp": "2024-04-23T09:44:05.024Z", "__row_index": 1}