{"tx_hash": "3fhMMCoUPwmq8eBmf4eFmkMLkxS8BjUhsiMaHxufaVLv", "action_id_social": "5ns3WdwMPyw5chbDNtKFhQhrNuCYDLC73jeXAAVvnTFU-0-widget", "block_id": 112393434, "block_timestamp": "2024-02-08T15:22:23.556Z", "signer_id": "bos.genadrop.near", "widget_name": "DropFlow.ArtistPage.Preview.Tabs", "source_code": "const accountId = context.accountId;\nconst pageOwnerId = props.accountId ?? accountId;\nconst widgetOwner = \"jgodwill.near\";\nconst isLoggedIn = props.isLoggedIn ?? context.accountId ? true : false;\nif (!pageOwnerId) {\n  return \"No account ID\";\n}\n\nconst profile = props.profile ?? Social.getr(`${pageOwnerId}/profile`);\n\nif (profile === null) {\n  return \"Loading\";\n}\n\nconst description = profile.description;\n\n// Create a separate titleMap for dynamic linking\nconst titleMap = {\n  feed: \"Feed\",\n  nfts: \"NFTs\",\n  discussions: \"Discussions\",\n  polls: \"Polls\",\n  docs: \"Docs\",\n  portfolio: \"Portfolio\",\n};\n\nconst pills = [];\n\n// Extract keys and values from feedTabs\nconst tabKeys = props.feedTabsArr ?? Object.keys(profile.feedTabs);\nconst tabValues = tabKeys.map(() => \"\");\n\n// Combine keys and values into objects with titles from titleMap (fallback to key value)\ntabKeys &&\n  tabKeys.forEach((key, index) => {\n    pills.push({\n      id: key,\n      title:\n        titleMap[key] ||\n        tabValues[index] ||\n        key.charAt(0).toUpperCase() + key.slice(1),\n    });\n  });\n\nconsole.log(\"pills\", pills);\nconst Nav = styled.div`\n  .nav-pills {\n    background: #fbfbfb;\n    font-weight: 400;\n    --bs-nav-pills-border-radius: 0;\n    --bs-nav-link-color: #b0b0b0;\n    --bs-nav-pills-link-active-color: #000;\n    --bs-nav-pills-link-active-bg: #fbfbfb;\n    --bs-nav-link-padding-y: 0.5rem;\n    border-bottom: 1px solid #eee;\n    padding-top: 3px;\n  }\n  .nav-link.active {\n    border-bottom: 3px solid #000;\n    font-weight: 500;\n  }\n\n  .nav-item:not(:has(> .disabled)):hover {\n    background: rgba(0, 0, 0, 0.15);\n    * {\n      color: #000 !important;\n    }\n  }\n\n  margin: 0 -12px;\n`;\n\nconst Loading = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  min-height: 70vh;\n  justify-content: center;\n  h1 {\n    font-size: 32px;\n    font-weight: 600;\n  }\n  span {\n    color: #b0b0b0;\n    font-size: 14px;\n  }\n`;\nconst feedAccounts = [];\n\nconst graph = Social.keys(`${pageOwnerId}/profile/feed/*`, \"final\");\nconsole.log(\"Graph\", Object.keys(graph[pageOwnerId].profile.feed || {}));\nif (graph !== null) {\n  feedAccounts = Object.keys(graph[pageOwnerId].profile.feed || {});\n  if (feedAccounts.length > 0) {\n    feedAccounts.push(context.pageOwnerId);\n  }\n}\nconsole.log(\"Feed Accounts\", feedAccounts);\n\nconst hashtagGraph = Social.keys(\n  `${pageOwnerId}/profile/discussion/data/*`,\n  \"final\"\n);\n\nconst [fetchedHashtags, setFetchedHashtags] = useState([]);\nconst [selectedHashtag, setSelectedHashtag] = useState(\n  fetchedHashtags[0] ?? null\n);\nconst fetchHashtags = () => {\n  if (hashtagGraph !== null) {\n    setFetchedHashtags(\n      Object.keys(hashtagGraph[pageOwnerId].profile.discussion.data || {})\n    );\n  } else {\n    setFetchedHashtags([]);\n  }\n};\n\npageOwnerId && fetchHashtags();\nconsole.log(\"fetchedHashtags\", fetchedHashtags[0]);\n\nconsole.log(\"selectedHashtag\", selectedHashtag);\n\nconst communityAddress = JSON.parse(profile.discussion.community);\n\nconsole.log(\"community: \", profile.discussion.community);\n\nconst nftType = profile.nfts.type;\nconst nftAddresses = profile.nfts && JSON.parse(profile.nfts.content);\nconst portfolio = profile.folio;\n\nconst currentTheme = Number(profile.theme) ?? 0;\n\nconst getFirstSBTToken = () => {\n  const view = Near.view(\"registry.i-am-human.near\", \"sbt_tokens_by_owner\", {\n    account: `${context.accountId}`,\n    issuer: \"fractal.i-am-human.near\",\n  });\n  return view?.[0]?.[1]?.[0];\n};\n\nconst hasSBTToken = getFirstSBTToken() !== undefined;\n\nconsole.log(\"isOwner? \", accountId === pageOwnerId);\nconsole.log(\"owner\", pageOwnerId);\nconsole.log(\"feedTabs\", profile.feedTabs);\nreturn (\n  <>\n    <Nav>\n      <ul className=\"nav nav-pills nav-fill\" id=\"pills-tab\" role=\"tablist\">\n        {profile.feedTabs &&\n          pills &&\n          pills.map(({ id, title }, i) => (\n            <li className=\"nav-item\" role=\"presentation\" key={i}>\n              <button\n                className={`nav-link ${i === 0 ? \"active\" : \"\"}`}\n                id={`pills-${id}-tab`}\n                data-bs-toggle=\"pill\"\n                data-bs-target={`#pills-${id}`}\n                type=\"button\"\n                role=\"tab\"\n                aria-controls={`pills-${id}`}\n                aria-selected={i === 0}\n                onClick={() => {\n                  const key = `load${id}`;\n                  !state[key] && State.update({ [key]: true });\n                }}\n              >\n                {title}\n              </button>\n            </li>\n          ))}\n      </ul>\n    </Nav>\n    {!profile.feedTabs ? (\n      <Loading className=\"w-100 mx-auto text-center\">\n        <h4>Nothing to show yet\ud83d\ude3f</h4>\n        {accountId === pageOwnerId && (\n          <p>\n            Don't have Page?{\" \"}\n            <Link\n              className=\"btn btn-outline-secondary rounded-5\"\n              href={`/bos.genadrop.near/widget/DropFlow.CreatePage.Index?pageOwnerId=${pageOwnerId}`}\n            >\n              Create One\n            </Link>\n          </p>\n        )}\n      </Loading>\n    ) : (\n      <div className=\"tab-content\" id=\"pills-tabContent\">\n        <div\n          className=\"tab-pane fade show active\"\n          id=\"pills-feed\"\n          role=\"tabpanel\"\n          aria-labelledby=\"pills-feed-tab\"\n        >\n          <div className=\"col-lg-8 mx-auto\">\n            {feedAccounts.length > 0 ? (\n              <Widget\n                key=\"feed\"\n                src=\"bos.genadrop.near/widget/CPlanet.MainPage.Feed\"\n                props={{ accounts: [...feedAccounts] }}\n              />\n            ) : (\n              <Widget\n                key=\"feed\"\n                src=\"bos.genadrop.near/widget/CPlanet.MainPage.Feed\"\n              />\n            )}\n          </div>\n        </div>\n        <div\n          className=\"tab-pane fade\"\n          id=\"pills-discussions\"\n          role=\"tabpanel\"\n          aria-labelledby=\"pills-discussions-tab\"\n        >\n          <div className=\"col-lg-12 mx-auto\">\n            {profile.discussion.type === \"hashtag\" && (\n              <div>\n                <div className=\"hashtags gap-2 my-3\">\n                  {fetchedHashtags.map((hashtag) => (\n                    <button\n                      className={`btn btn-outline-primary ${\n                        currentTheme !== 2 && \"rounded-5\"\n                      } btn-sm`}\n                      onClick={() => setSelectedHashtag(hashtag)}\n                    >\n                      {`#${hashtag}`}\n                    </button>\n                  ))}\n                </div>\n                {selectedHashtag ? (\n                  <Widget\n                    src=\"jgodwill.near/widget/Hashtag.Feed\"\n                    props={{ hashtag: selectedHashtag }}\n                  />\n                ) : (\n                  <Loading>\n                    <h1>Click a tag above \u261d\ud83c\udffe</h1>\n                    <span>\n                      click a tag button above to view discussions based on it\n                    </span>\n                  </Loading>\n                )}\n              </div>\n            )}\n            {profile.discussion.type === \"nftcommunity\" && (\n              <Widget\n                key=\"discussion\"\n                src=\"bos.genadrop.near/widget/CPlanet.Group.Index\"\n                props={{ groupId: communityAddress[0] }}\n              />\n            )}\n          </div>\n        </div>\n        <div\n          className=\"tab-pane fade\"\n          id=\"pills-nfts\"\n          role=\"tabpanel\"\n          aria-labelledby=\"pills-nfts-tab\"\n        >\n          {/* {state.loadnfts && (\n            <Widget src=\"mob.near/widget/N.YourNFTs\" props={{ pageOwnerId }} />\n          )} */}\n          {nftType === \"collection\" && (\n            <Widget\n              src=\"bos.genadrop.near/widget/DropFlow.CollectionNFTs\"\n              props={{ contractId: nftAddresses[0], profile }}\n            />\n          )}\n          {nftType === \"single\" && (\n            // <Widget\n            //   src=\"bos.genadrop.near/widget/DropFlow.AccountNFTs\"\n            //   props={{ accountId: nftAddresses[0] }}\n            // />\n            <div className=\"mt-2 row g-4\">\n              {nftAddresses.map((address) => (\n                <div className=\"col-md\">\n                  <Widget\n                    src=\"jgodwill.near/widget/DropFlow.SingleNFT\"\n                    props={{\n                      contractId: address.contractId,\n                      tokenId: address.tokenId,\n                      chainState: address.chain?.toLowerCase(),\n                    }}\n                  />\n                </div>\n              ))}\n              {/* <pre>{JSON.stringify(nftAddresses, null, 2)}</pre> */}\n            </div>\n          )}\n        </div>\n        <div\n          className=\"tab-pane fade\"\n          id=\"pills-polls\"\n          role=\"tabpanel\"\n          aria-labelledby=\"pills-polls-tab\"\n        >\n          <div className=\"section polls\">\n            <div className=\"polls-main\">\n              <div className=\"polls-tab-main\">\n                <div className=\"attach-nft-buttons d-flex align-items-center gap-2\">\n                  <div className=\"p-2 ms-auto\">\n                    <p\n                      style={{\n                        margin: \"0\",\n                        fontWeight: \"bold\",\n                        fontSize: \"15px\",\n                        color: hasSBTToken ? \"#239F28\" : \"#DD5E56\",\n                      }}\n                    >\n                      {!isLoggedIn\n                        ? \"Sign In To Use EasyPoll\"\n                        : hasSBTToken\n                        ? \"Verified Human\"\n                        : \"Non-Verified Human\"}\n                    </p>\n                  </div>\n                </div>\n\n                <div className=\"mb-2 feed\">\n                  <h4>My Polls</h4>\n                </div>\n\n                {hasSBTToken && (\n                  <Widget\n                    src={`${widgetOwner}/widget/EasyPoll.MyPolls`}\n                    props={{\n                      indexVersion,\n                      blackList,\n                      tabs,\n                      whitelist,\n                      widgetOwner,\n                    }}\n                  />\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n        <div\n          className=\"tab-pane fade\"\n          id=\"pills-portfolio\"\n          role=\"tabpanel\"\n          aria-labelledby=\"pills-portfolio-tab\"\n        >\n          {portfolio && (\n            <div className=\"d-flex flex-column gap-2 mt-4\">\n              {Object.keys(portfolio).map((item) => {\n                const portfolioEntry = JSON.parse(portfolio[item]);\n                const imagUrl = portfolioEntry.image.cid\n                  ? `https://ipfs.near.social/ipfs/${portfolioEntry.image.cid}`\n                  : `https://wallpapercave.com/wp/wp3589909.jpg`;\n                const itemText = portfolioEntry.text;\n                return (\n                  portfolio[item] && (\n                    <div\n                      className=\"d-flex align-items-center gap-3 mb-3 entry\"\n                      key={item}\n                    >\n                      <div\n                        className=\"folioImage rounded h-100\"\n                        style={{ overflow: \"hidden\" }}\n                      >\n                        <img\n                          src={imagUrl}\n                          // className=\"col-sm\"\n                          width=\"64px\"\n                          height=\"64px\"\n                          style={{ objectFit: \"cover\" }}\n                          alt={portfolioEntry.title}\n                        />\n                      </div>\n                      <div className=\"col-sm\" style={{ flex: \"1\" }}>\n                        <h5 className=\"card-title\">{portfolioEntry.title}</h5>\n                        <div\n                          className=\"md_txt\"\n                          style={{\n                            maxHeight: `${2 * 1.2}em`,\n                            overflow: \"hidden\",\n                          }}\n                        >\n                          <Markdown text={portfolioEntry.text} />\n                        </div>\n                      </div>\n                      <div className=\"date_created\">\n                        <small>\n                          {new Date(\n                            portfolioEntry.date_created\n                          ).toLocaleDateString(\"en-US\", {\n                            month: \"short\",\n                            day: \"numeric\",\n                            year: \"numeric\",\n                          })}\n                        </small>\n                      </div>\n                      <div\n                        className=\"d-flex justify-content-end align-items-center\"\n                        style={{ flex: \"0.33\" }}\n                      >\n                        <button className=\"btn btn-primary\">More</button>\n                      </div>\n                    </div>\n                  )\n                );\n              })}\n            </div>\n          )}\n        </div>\n      </div>\n    )}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bos.genadrop.near/widget/DropFlow.ArtistPage.Preview.Tabs", "fact_widget_deployments_id": "82b78201cf8ec8fd229f2cf1889ea0dd", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 1}