{"tx_hash": "4UZYssdCxCjfkJhs8721xk6Qv1mFZ6v6YYBkX6GUB4hg", "action_id_social": "3cKpNvdBCtakPvy4PuHzLDhANkmm4yoDzbr1m59tzfaP-0-widget", "block_id": 96730743, "block_timestamp": "2023-07-18T03:22:33.907Z", "signer_id": "efiz.near", "widget_name": "every.thing", "source_code": "const typeName = props.typeName || \"widget\";\nconst metadataTemplate = props.metadataTemplate || \"efiz.near/widget/docs.card\";\n\nState.init({\n  accountId: props.accountId || null,\n  tag: props.tag || null,\n});\n\nlet keys = `${state.accountId ?? \"*\"}/${typeName}/*`;\n\nif (state.tag) {\n  const taggedWidgets = Social.keys(\n    `${state.accountId ?? \"*\"}/${typeName}/*/metadata/tags/${state.tag}`,\n    \"final\"\n  );\n\n  if (taggedWidgets === null) {\n    return <p>Loading tags</p>;\n  }\n\n  keys = Object.entries(taggedWidgets)\n    .map((kv) =>\n      Object.keys(kv[1][typeName]).map((w) => `${kv[0]}/${typeName}/${w}`)\n    )\n    .flat();\n\n  if (!keys.length) {\n    return (\n      <>\n        <p>No types found by tag #{state.tag}</p>\n        <button onClick={() => State.update({ tag: null })}>reset</button>\n      </>\n    );\n  }\n}\n\nconst data = Social.keys(keys, \"final\", {\n  return_type: \"BlockHeight\",\n  limit: 1,\n});\n\nif (data === null) {\n  return <p>\"Loading\"</p>;\n}\n\nconst processData = (data) => {\n  const accounts = Object.entries(data);\n\n  const allItems = accounts\n    .map((account) => {\n      const accountId = account[0];\n      return Object.entries(account[1][typeName]).map((kv) => ({\n        accountId,\n        typeName: kv[0],\n        blockHeight: kv[1],\n      }));\n    })\n    .flat();\n\n  allItems.sort((a, b) => b.blockHeight - a.blockHeight);\n  return allItems;\n};\n\nconst renderItem = (a) => {\n  return (\n    <div className=\"m-1\" key={JSON.stringify(a)} style={{ minHeight: \"10em\" }}>\n      <Widget\n        src={metadataTemplate}\n        props={{\n          path: `${a.accountId}/${typeName}/${a.typeName}`,\n        }}\n      />\n    </div>\n  );\n};\n\nif (JSON.stringify(data) !== JSON.stringify(state.data || {})) {\n  State.update({\n    data,\n    allItems: processData(data),\n  });\n}\nreturn (\n  <div className=\"px-2 mx-auto\">\n    <div className=\"mb-2 d-flex align-items-baseline gap-2\">\n      Filter:\n      {state.accountId ? (\n        <a className=\"btn btn-outline-primary\">\n          <Widget\n            src=\"mob.near/widget/ProfileLine\"\n            props={{ accountId: state.accountId, link: false }}\n          />\n          <i\n            className=\"bi bi-x-square\"\n            onClick={() => State.update({ accountId: null })}\n          ></i>\n        </a>\n      ) : (\n        <>\n          <input\n            className=\"form-control d-inline-block w-auto\"\n            placeholder={\"accountId\"}\n            value={state.accountIdVal}\n            onChange={(e) =>\n              State.update({\n                accountIdVal: e.target.value,\n              })\n            }\n          />\n          <button\n            onClick={() => State.update({ accountId: state.accountIdVal })}\n          >\n            apply\n          </button>\n        </>\n      )}\n      {state.tag ? (\n        <a className=\"btn btn-outline-primary\">\n          <span className=\"badge text-bg-secondary\">#{state.tag}</span>\n          <i className=\"bi bi-x-square\"></i>\n        </a>\n      ) : (\n        <>\n          <input\n            className=\"form-control d-inline-block w-auto\"\n            placeholder={\"tag\"}\n            value={state.tag}\n            onChange={(e) =>\n              State.update({\n                tagVal: e.target.value,\n              })\n            }\n          />\n          <button onClick={() => State.update({ tag: state.tagVal })}>\n            apply\n          </button>\n        </>\n      )}\n    </div>\n    <Widget\n      src=\"efiz.near/widget/ItemFeed\"\n      props={{ items: state.allItems || [], renderItem }}\n    />\n  </div>\n);\n", "metadata": {"platform": "nearpad"}, "branch": {"draft": null}, "widget_modules_used": null, "widget_url": "https://near.social/#/efiz.near/widget/every.thing", "fact_widget_deployments_id": "f3b6325923e7a20fc990c6f05611366b", "inserted_timestamp": "2000-01-01T00:00:00.000Z", "modified_timestamp": "2000-01-01T00:00:00.000Z", "__row_index": 2}