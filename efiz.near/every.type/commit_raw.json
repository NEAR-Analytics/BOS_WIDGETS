{"tx_hash": "CYsVJ4h1Vphq4ASUDykNnkcZYV5iQtpHcni9KWWV4LxP", "action_id_social": "H8hDkw4b36UhPVqfVtKg5D7nYtqLeRFpa9PPGTx8H6DV-0-widget", "block_id": 96419242, "block_timestamp": "2023-07-14T02:04:19.504Z", "signer_id": "efiz.near", "widget_name": "every.type", "source_code": "const accountId = props.accountId;\nconst typeName = props.typeName || \"type\";\nconst tag = props.tag;\nconst metadataTemplate =\n  props.metadataTemplate || \"efiz.near/widget/every.type.metadata\";\n\nlet keys = `${accountId ?? \"*\"}/${typeName}/*`;\n\nif (tag) {\n  const taggedWidgets = Social.keys(\n    `${accountId ?? \"*\"}/${typeName}/*/metadata/tags/${tag}`,\n    \"final\"\n  );\n\n  if (taggedWidgets === null) {\n    return render(\"Loading tags\");\n  }\n\n  keys = Object.entries(taggedWidgets)\n    .map((kv) =>\n      Object.keys(kv[1][typeName]).map((w) => `${kv[0]}/${typeName}/${w}`)\n    )\n    .flat();\n\n  if (!keys.length) {\n    return render(`No types found by tag #${tag}`);\n  }\n}\n\nconst data = Social.keys(keys, \"final\", {\n  return_type: \"BlockHeight\",\n  limit: 1,\n});\n\nif (data === null) {\n  return <p>\"Loading\"</p>;\n}\n\nconst processData = (data) => {\n  const accounts = Object.entries(data);\n\n  const allItems = accounts\n    .map((account) => {\n      const accountId = account[0];\n      return Object.entries(account[1][typeName]).map((kv) => ({\n        accountId,\n        typeName: kv[0],\n        blockHeight: kv[1],\n      }));\n    })\n    .flat();\n\n  allItems.sort((a, b) => b.blockHeight - a.blockHeight);\n  return allItems;\n};\n\nconst renderItem = (a) => {\n  return (\n    <div className=\"mb-3\" key={JSON.stringify(a)} style={{ minHeight: \"10em\" }}>\n      <Widget\n        src=\"efiz.near/widget/every.type.metadata\"\n        props={{\n          accountId: a.accountId,\n          widgetName: a.typeName,\n          blockHeight: a.blockHeight,\n        }}\n      />\n    </div>\n  );\n};\n\nif (JSON.stringify(data) !== JSON.stringify(state.data || {})) {\n  State.update({\n    data,\n    allItems: processData(data),\n  });\n}\n\nreturn (\n  <div className=\"px-2 mx-auto\">\n    {(accountId || tag) && (\n      <div className=\"mb-2\">\n        Filter:\n        {accountId && (\n          <a className=\"btn btn-outline-primary\">\n            <Widget\n              src=\"mob.near/widget/ProfileLine\"\n              props={{ accountId, link: false }}\n            />\n            <i className=\"bi bi-x-square\"></i>\n          </a>\n        )}\n        {tag && (\n          <a className=\"btn btn-outline-primary\">\n            <span className=\"badge text-bg-secondary\">#{tag}</span>\n            <i className=\"bi bi-x-square\"></i>\n          </a>\n        )}\n      </div>\n    )}\n    <Widget\n      src=\"efiz.near/widget/ItemFeed\"\n      props={{ items: state.allItems || [], renderItem }}\n    />\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/efiz.near/widget/every.type", "fact_widget_deployments_id": "e95d6a255ba3bb1200a5c67e828f7445", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}