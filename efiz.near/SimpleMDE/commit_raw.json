{"tx_hash": "Bg6qGxbA2ZKftBpNxtP8yoYF1pGPFrHyY8wJZgK7PBLe", "action_id_social": "CVXDEsTRBJFz9S5p446ZqsKeWQHZMRpaqkSthQhU2k9y-0-widget", "block_id": 98371702, "block_timestamp": "2023-08-08T21:04:04.501Z", "signer_id": "efiz.near", "widget_name": "SimpleMDE", "source_code": "/**\n * iframe embedding a SimpleMDE component\n * https://github.com/sparksuite/simplemde-markdown-editor\n */\n\nfunction defaultOnChange(content) {\n  console.log(content);\n}\n\nconst data = props.data;\nconst onChange = props.onChange ?? defaultOnChange;\nconst height = props.height ?? \"450\";\nconst fontFamily = props.fontFamily ?? \"Arial, sans-serif\";\nconst fontSize = props.fontSize ?? \"14px\";\n\nState.init({\n  iframeHeight: height,\n});\n\n// SIMPLE MDE CONFIG //\nconst autoFocus = props.autoFocus ?? true;\nconst renderingConfig = JSON.stringify(\n  props.renderingConfig ?? {\n    singleLineBreaks: false,\n    codeSyntaxHighlighting: true,\n  }\n);\n\n// Add or remove toolbar items\n// For adding unique items, configure the switch-case below\nconst toolbarConfig = JSON.stringify(\n  props.toolbar ?? [\n    \"heading\",\n    \"bold\",\n    \"italic\",\n    \"|\", // adding | creates a divider in the toolbar\n    \"quote\",\n    \"code\",\n    \"link\",\n    \"image\",\n    \"mention\",\n    \"reference\",\n    \"unordered-list\",\n    \"ordered-list\",\n    \"checklist\",\n    \"table\",\n    \"horizontal-rule\",\n  ]\n);\n\nconst code = `\n<style>\n#react-root {\n    font-family: ${fontFamily};\n    font-size: ${fontSize}; \n}\n</style>\n<script src=\"https://unpkg.com/react@18/umd/react.development.js\" crossorigin></script>\n<script src=\"https://unpkg.com/react-dom@18/umd/react-dom.development.js\" crossorigin></script>\n<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css\">\n<script src=\"https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js\"></script>\n<script src=\"https://cdn.jsdelivr.net/highlight.js/latest/highlight.min.js\"></script>\n<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/highlight.js/latest/styles/github.min.css\">\n\n<div id=\"react-root\"></div>\n\n<script>\nfunction MarkdownEditor(props) {\n    const [value, setValue] = React.useState(props.initialText || \"\");\n\n    React.useEffect(() => {\n        const generateToolbarItems = () => {\n            return ${toolbarConfig}.map((item) => {\n                switch(item) {\n                    // CONFIGURE CUSTOM IMPLEMENTATIONS HERE\n                    case \"checklist\": {\n                        function handleChecklist(editor) {\n                            const cursorPos = editor.codemirror.getCursor();\n                            const lineText = editor.codemirror.getLine(cursorPos.line);\n                            if (lineText.trim() === \"\") {\n                                editor.codemirror.replaceRange(\" - [ ] \", cursorPos);\n                            } else {\n                                editor.codemirror.replaceRange(\"\\\\n - [ ] \", cursorPos);\n                            }\n                        }\n                        return {\n                            name: \"checklist\",\n                            action: handleChecklist,\n                            className: \"fa fa-check-square\",\n                            title: \"Insert Checklist\"\n                        }\n                    }\n                    case \"mention\": {\n                        function handleMention(editor) {\n                            const cursorPos = editor.codemirror.getCursor();\n                            editor.codemirror.replaceRange(\"@\", cursorPos);\n                        }\n                        return {\n                            name: \"mention\",\n                            action: handleMention,\n                            className: \"fa fa-at\",\n                            title: \"Insert Mention\"\n                        }\n                    }\n                    case \"reference\": {\n                        function handleReference(editor) {\n                            const cursorPos = editor.codemirror.getCursor();\n                            editor.codemirror.replaceRange(\"bos://\", cursorPos);\n                        }\n                        return {\n                            name: \"reference\",\n                            action: handleReference,\n                            className: \"fa fa-external-link-square\",\n                            title: \"Reference Thing\"\n                        }\n                    }\n                    case \"image\": {\n                        // TODO: convert to upload to IPFS\n                        return {\n                            name: \"image\",\n                            action: SimpleMDE.drawImage,\n                            className: \"fa fa-picture-o\",\n                            title: \"Insert Image\"\n                        }\n                    }\n                    default: {\n                        return item;\n                    }\n                }\n            });\n        };\n        \n        const simplemde = new SimpleMDE({\n            element: document.getElementById(\"markdown-input\"),\n            autofocus: ${autoFocus},\n            renderingConfig: ${renderingConfig},\n            toolbar: generateToolbarItems(),\n            initialValue: value,\n        });\n\n        const updateIframeHeight = () => {\n            const iframeHeight = document.body.scrollHeight;\n            window.parent.postMessage({ handler: \"resize\", height: iframeHeight }, \"*\");\n        };\n\n        simplemde.codemirror.on('change', () => {\n            const content = simplemde.value();\n            window.parent.postMessage({ handler: \"update\", content }, \"*\");\n            updateIframeHeight();\n        });\n    }, []);\n\n    return React.createElement('textarea', { id: 'markdown-input', value: value, onChange: setValue });\n}\n\nconst domContainer = document.querySelector('#react-root');\nconst root = ReactDOM.createRoot(domContainer);\n\nwindow.addEventListener(\"message\", (event) => {\n    root.render(React.createElement(MarkdownEditor, {\n        initialText: event.data.content }));\n});\n</script>\n`;\nreturn (\n  <iframe\n    className=\"w-100\"\n    style={{\n      height: `${state.iframeHeight}px`,\n    }}\n    srcDoc={code}\n    message={data.content ?? \"\"}\n    onMessage={(e) => {\n      switch (e.handler) {\n        case \"update\": {\n          onChange(e.content);\n        }\n        case \"resize\": {\n          State.update({ iframeHeight: e.height + 20 });\n        }\n      }\n    }}\n  />\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/efiz.near/widget/SimpleMDE", "fact_widget_deployments_id": "7928dbcc2eae7a401ce23d77adcec608", "inserted_timestamp": "2023-08-08T22:36:34.097Z", "modified_timestamp": "2023-08-08T22:36:34.097Z", "__row_index": 16}