{"tx_hash": "BZ8cJXubbBKcBEzzLacX97Nr6VNkQaTzgSf6Faw4AYui", "action_id_social": "42n3oghy1kX4u2ymEWooDZpiS7Fsc5rNjvSVfdeqWCfC-0-widget", "block_id": 105816496, "block_timestamp": "2023-11-16T09:30:13.943Z", "signer_id": "f9c8ea61fc52563789402a7b3e34e5b1aa6eda06f535a2c3afb7c725488c5a6c", "widget_name": "zkQuest", "source_code": "// Welcome to quest 7.\n//\n// Oh no, looks like there's a mix-up with our code! Your mission is to sort out the right contract function,\n// whip up the proper hash, and get that transaction flying straight.\n// Check out the details in the sendSolution() function and let's get this sorted!\n//\n// BOS.gg allows you to edit this code live, and execute it, when you click \"Preview\" button.\n//\n\nconst DESTINATION_CHAIN = 324;\nconst QUEST_ADDRESS = \"0xeD6ade662726D7f595D4fa55D5EDEB5d2B7F730E\";\nconst QUEST_ID = 7;\nconst QUEST_NAME = \"008\";\n\nconst QUEST_ABI = [\n  \"function submitAnswerForQuest(string, bytes32)\",\n  \"function getQuests() public view returns (tuple(string, string, string, uint256, uint16, address, bool, uint16 attempts)[])\",\n];\n\nState.init({\n  accountBalance: 0,\n  chainId: 0,\n  attempted: false,\n  questAttempts: 0,\n  questSolved: false,\n  transactionHash: \"\",\n  transactionStatus: \"\",\n});\n\nlet account = Ethers.send(\"eth_requestAccounts\", [])[0];\n\nif (account) {\n  Ethers.provider()\n    .getNetwork()\n    .then((chainIdData) => {\n      State.update({\n        chainId: chainIdData.chainId,\n      });\n    });\n}\n\nfunction changeChain() {\n  Ethers.setChain({ chainId: DESTINATION_CHAIN });\n}\n\nfunction getQuestStatus() {\n  const questContract = new ethers.Contract(\n    QUEST_ADDRESS,\n    QUEST_ABI,\n    Ethers.provider().getSigner()\n  );\n  questContract.getQuests().then((result) => {\n    State.update({\n      questSolved: result[QUEST_ID][6],\n      questAttempts: result[QUEST_ID][7],\n    });\n  });\n}\n\nfunction sendSolution() {\n  const questContract = new ethers.Contract(\n    QUEST_ADDRESS,\n    QUEST_ABI,\n    Ethers.provider().getSigner()\n  );\n\n  let transactionHash = \"\";\n\n  // 1. Oops! We've been calling the wrong contract function all this time.\n  //    Tip: You can use era-test-node to replay transactions from your previous submissions, with --show-calls=user --resolve-hashes\n\n  // 2. And then there's the payload... Some of it seems to have gone missing!\n  //    - Don't forget to include `QUEST_NAME`.\n  //    - A keccak hash generated from a combination of specific elements: answer, your zkQuest account address, and the number of attempts.\n  //\n  //    let answerHash = ethers.utils.solidityKeccak256([\"string\", \"address\", \"uint16\"], [ANSWER, ADDRESS, attempts]);\n  //    Oh, and the answer is the private key of the first 'rich' account from era-test-node (with '0x' prefix)\n\n  // 3. Call the identified contract function with the constructed payload.\n  let answerHash = ethers.utils.solidityKeccak256(\n    [\"string\", \"address\", \"uint16\"],\n    [\n      \"0x7726827caac94a7f9e1b160f7ea819f172f7b6f9d2a97f992c38edeab82d4110\",\n      \"0x30D7f59Dc675d8F270619FC8515d21034BcdbaeC\",\n      attempts,\n    ]\n  );\n\n  questContract\n    .submitAnswerForQuest(QUEST_NAME, answerHash, { gasLimit: 1000000 })\n    .then((transaction) => {\n      console.log(\"Hash is: \");\n      console.log(transaction.hash);\n      transactionHash = transaction.hash;\n\n      transaction\n        .wait()\n        .then((receipt) => {\n          State.update({\n            transactionStatus: \"ok\",\n          });\n        })\n        .catch((error) => {\n          State.update({\n            transactionStatus: \"failed\",\n          });\n        });\n    })\n    .catch((error) => console.log(\"Error submitting transaction: \" + error))\n    .finally(() =>\n      State.update({\n        transactionHash: transactionHash,\n        attempted: true,\n      })\n    );\n}\n\nfunction step1WalletConnection() {\n  if (account) {\n    return [\n      true,\n      <div>\n        <h2>Step 1: Wallet selection - DONE</h2>\n      </div>,\n    ];\n  } else {\n    return [\n      false,\n      <div>\n        <h2>Step 1: Wallet selection</h2>\n        <h4> Let's start - connect wallet </h4>\n        <p> There should be a button at the top right corner</p>\n      </div>,\n    ];\n  }\n}\n\nfunction step2ChainSelection() {\n  if (state.chainId == DESTINATION_CHAIN) {\n    return [\n      true,\n      <div>\n        <h2>Step 2: Chain selection - DONE</h2>\n      </div>,\n    ];\n  } else {\n    return [\n      false,\n      <div>\n        <h2>Step 2: Chain selection</h2>\n        Now we have to make sure that we're on the right chain.\n        <p>Current chain: {state.chainId}</p>\n        <button onClick={() => changeChain()}>Change chain</button>\n      </div>,\n    ];\n  }\n}\n\nfunction displayTaskDetails() {\n  return (\n    <div>\n      <h1 style={{ color: \"red\" }}>Did you think it would be THAT easy??</h1>\n      Did you even check what you signed?? <br />\n      But no worries - this is the advantage of BOS - you can fix the code and\n      try again. <br />\n      Start by clicking on the three lines in the top right corner - and select{\" \"}\n      <b>Fork widget</b> <br />\n      Then you can see the source code, and edit it live. <br />\n      More instructions are in the code.\n    </div>\n  );\n}\n\nfunction step3SendTheTransaction() {\n  getQuestStatus();\n  if (state.attempted == false) {\n    return [\n      false,\n      <div>\n        <h2>Step 3: Send Transaction</h2>\n        <button onClick={() => sendSolution()}>Send Solution</button>\n      </div>,\n    ];\n  } else {\n    return [\n      true,\n      <div>\n        <h2>Step 3: Send Transaction</h2>\n        Transaction Hash: {state.transactionHash} <br />\n        Transaction Status: {state.transactionStatus} <br />\n        {state.transactionStatus == \"failed\"\n          ? displayTaskDetails()\n          : \"congrats\"}\n      </div>,\n    ];\n  }\n}\n\nfunction allSteps() {\n  let steps = [];\n  const [step1Success, step1Payload] = step1WalletConnection();\n  steps.push(step1Payload);\n  if (!step1Success) {\n    return steps;\n  }\n  const [step2Success, step2Payload] = step2ChainSelection();\n  steps.push(step2Payload);\n  if (!step2Success) {\n    return steps;\n  }\n\n  const [step3Success, step3Payload] = step3SendTheTransaction();\n  steps.push(step3Payload);\n  if (!step3Success) {\n    return steps;\n  }\n\n  return steps;\n}\n\nif (state.questSolved) {\n  return (\n    <div>\n      <h1>Quest is solved - good job.</h1>\n    </div>\n  );\n}\n\nreturn (\n  <>\n    <div class=\"container border border-info p-3 text-center\">\n      <h1>Welcome to zkQuest - The Other frontend</h1>\n      <br />\n      In this quest, we'll be using zkSync Javascript SDK to interact with the\n      blockchain.\n      <br />\n      The code that you see right now is hosted on NEAR blockchain - via BOS\n      (Blockchain Operating System).\n      <br />\n      <br />\n      You can see more details{\" \"}\n      <a href=\"https://docs.near.org/bos/tutorial/ethers-js\">HERE</a>\n      <br />\n      <div>{allSteps()}</div>\n    </div>\n  </>\n);\n", "metadata": {"tags": {"bos-gg": ""}}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/f9c8ea61fc52563789402a7b3e34e5b1aa6eda06f535a2c3afb7c725488c5a6c/widget/zkQuest", "fact_widget_deployments_id": "4235b49eb3464ffea0b5b854a668b4ee", "inserted_timestamp": "2023-11-16T11:30:27.678Z", "modified_timestamp": "2023-11-16T11:30:27.678Z", "__row_index": 8}