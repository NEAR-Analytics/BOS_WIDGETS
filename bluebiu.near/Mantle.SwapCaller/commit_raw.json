{"tx_hash": "8XUT1MtVvUynjXN51CW6cuei2Cc793tUJrZMoLDPcTFh", "action_id_social": "G6AtXVWrmPZp57FmejLHXsKPKgfkMZrsWTDhaS6kb2pc-0-widget", "block_id": 99479952, "block_timestamp": "2023-08-23T14:45:03.312Z", "signer_id": "bluebiu.near", "widget_name": "Mantle.SwapCaller", "source_code": "const {\n  tokenIn,\n  tokenOut,\n  config,\n  selectedDex,\n  onLoadSwapCall,\n  sender,\n  amountIn,\n} = props;\n\nconst qs = `${tokenIn.address}-${tokenOut.address}-${amountIn}-${selectedDex}`;\n\nif (qs !== state.cacheQs) {\n  State.update({\n    cacheQs: qs,\n  });\n} else {\n  return <div></div>;\n}\n\nif (!sender) {\n  return <div></div>;\n}\n\nconst exactInputAbi = [\n  {\n    inputs: [\n      {\n        components: [\n          {\n            internalType: \"bytes\",\n            name: \"path\",\n            type: \"bytes\",\n          },\n          {\n            internalType: \"address\",\n            name: \"recipient\",\n            type: \"address\",\n          },\n          {\n            internalType: \"uint256\",\n            name: \"deadline\",\n            type: \"uint256\",\n          },\n          {\n            internalType: \"uint256\",\n            name: \"amountIn\",\n            type: \"uint256\",\n          },\n          {\n            internalType: \"uint256\",\n            name: \"amountOutMinimum\",\n            type: \"uint256\",\n          },\n        ],\n        internalType: \"struct ISwapRouter.ExactInputParams\",\n        name: \"params\",\n        type: \"tuple\",\n      },\n    ],\n    name: \"exactInput\",\n    outputs: [\n      {\n        internalType: \"uint256\",\n        name: \"amountOut\",\n        type: \"uint256\",\n      },\n    ],\n    stateMutability: \"payable\",\n    type: \"function\",\n  },\n];\nconst expandToken = (value, decimals) => {\n  return new Big(value).mul(new Big(10).pow(decimals));\n};\n\nconst selectedDexItem = config.dapps.find((dapp) => dapp.name === selectedDex);\n\nconst signer = Ethers.provider().getSigner();\n\nconst callSwap = () => {\n  const swapContract = new ethers.Contract(\n    selectedDexItem.swapRouter,\n    exactInputAbi,\n    signer\n  );\n\n  const value = expandToken(amountIn, tokenIn.decimals).toFixed();\n\n  const path = [tokenIn.address, tokenOut.address];\n  const pathBytes = \"0x\" + path.map((address) => address.substr(2)).join(\"\");\n\n  const deadline = new Big(Math.floor(Date.now() / 1000)).add(new Big(1800));\n\n  swapContract\n    .exactInput([pathBytes, sender, deadline, value, \"0\"], {\n      gasPrice: ethers.utils.parseUnits(gasPrice ?? \"10\", \"gwei\"),\n      gasLimit: gasLimit ?? 300000,\n    })\n    .then((tx) => {\n      tx.wait().then((receipt) => {\n        const { status, transactionHash } = receipt;\n        // TODO: add action\n      });\n    })\n    .catch(() => {});\n};\n\nif (Number(amountIn) > 0 && onLoadSwapCall) {\n  onLoadSwapCall({ callSwap });\n}\n\nreturn <div></div>;\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/Mantle.SwapCaller", "fact_widget_deployments_id": "91bdb7f17d0cd03971b3fa8ee5ea4584", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 4}