{"tx_hash": "4nrg88pddGPui2ct7inZgV92dN2wdscByeWXDntVRCqd", "action_id_social": "5iLr9awgaKnaSgmKQrowRuPabCp8ZRYFvPkWqb6f9Yno-0-widget", "block_id": 99600702, "block_timestamp": "2023-08-25T04:39:22.404Z", "signer_id": "bluebiu.near", "widget_name": "Mantle.SwapCaller", "source_code": "const {\n  tokenIn,\n  tokenOut,\n  config,\n  selectedDex,\n  onLoadSwapCall,\n  sender,\n  amountIn,\n  onSwapCallBack,\n} = props;\n\nconst qs = `${tokenIn.address}-${tokenOut.address}-${amountIn}-${selectedDex}`;\n\nif (qs !== state.cacheQs) {\n  State.update({\n    cacheQs: qs,\n  });\n} else {\n  return <div></div>;\n}\n\nif (!sender) {\n  return <div></div>;\n}\n\nconst exactInputAbi = [\n  {\n    inputs: [\n      {\n        components: [\n          {\n            internalType: \"address\",\n            name: \"tokenIn\",\n            type: \"address\",\n          },\n          {\n            internalType: \"address\",\n            name: \"tokenOut\",\n            type: \"address\",\n          },\n          {\n            internalType: \"uint24\",\n            name: \"fee\",\n            type: \"uint24\",\n          },\n          {\n            internalType: \"address\",\n            name: \"recipient\",\n            type: \"address\",\n          },\n          {\n            internalType: \"uint256\",\n            name: \"deadline\",\n            type: \"uint256\",\n          },\n          {\n            internalType: \"uint256\",\n            name: \"amountIn\",\n            type: \"uint256\",\n          },\n          {\n            internalType: \"uint256\",\n            name: \"amountOutMinimum\",\n            type: \"uint256\",\n          },\n          {\n            internalType: \"uint160\",\n            name: \"sqrtPriceLimitX96\",\n            type: \"uint160\",\n          },\n        ],\n        internalType: \"struct ISwapRouter.ExactInputSingleParams\",\n        name: \"params\",\n        type: \"tuple\",\n      },\n    ],\n    name: \"exactInputSingle\",\n    outputs: [\n      {\n        internalType: \"uint256\",\n        name: \"amountOut\",\n        type: \"uint256\",\n      },\n    ],\n    stateMutability: \"payable\",\n    type: \"function\",\n  },\n];\nconst expandToken = (value, decimals) => {\n  return new Big(value).mul(new Big(10).pow(decimals));\n};\n\nconst selectedDexItem = config.dapps.find((dapp) => dapp.name === selectedDex);\n\nconst signer = Ethers.provider().getSigner();\n\nconst callSwap = (fee) => {\n  const swapContract = new ethers.Contract(\n    selectedDexItem.swapRouter,\n    exactInputAbi,\n    signer\n  );\n\n  const value = expandToken(amountIn, tokenIn.decimals).toFixed();\n\n  const deadline = new Big(Math.floor(Date.now() / 1000)).add(new Big(1800));\n\n  const inputs = [\n    tokenIn.address,\n    tokenOut.address,\n    fee,\n    sender,\n    deadline.toFixed(),\n    value,\n    \"0\",\n    0,\n  ];\n\n  swapContract\n    .exactInputSingle(inputs, {\n      gasPrice: ethers.utils.parseUnits(gasPrice ?? \"10\", \"gwei\"),\n      gasLimit: gasLimit ?? 300000,\n    })\n    .then((tx) => {\n      tx.wait().then((receipt) => {\n        const { status, transactionHash } = receipt;\n        console.log(\"transactionHash: \", transactionHash);\n        // TODO: add action\n        onSwapCallBack();\n      });\n    })\n    .catch(() => {});\n};\n\nif (Number(amountIn) > 0 && onLoadSwapCall) {\n  onLoadSwapCall({ callSwap });\n}\n\nreturn <div></div>;\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/Mantle.SwapCaller", "fact_widget_deployments_id": "fa94f39a965d8267e1710d942087fd11", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}