{"tx_hash": "9fuLe3ohgHGMUbWGxCkW2PNjVxKtkj8tjS7fm1nxGoJf", "action_id_social": "AeZuZqNB18AKpSjSxAwR3UmTLAkUSe8kZPFrMaEgZP2n-0-widget", "block_id": 116598823, "block_timestamp": "2024-04-11T08:42:16.818Z", "signer_id": "bluebiu.near", "widget_name": "AAVE.Data.Zerolend", "source_code": "const {\n  account,\n  config,\n  multicall,\n  multicallAddress,\n  assetsToSupply,\n  markets,\n  rewardToken,\n  onLoad,\n} = props;\n\nuseEffect(() => {\n  if (!account) return \"\";\n\n  function getRewardsData() {\n    const aTokenAddresss = assetsToSupply?.map((item) => item.aTokenAddress);\n\n    const calls = aTokenAddresss?.map((addr) => ({\n      address: config.incentivesProxy,\n      name: \"getRewardsData\",\n      params: [addr, config.rewardAddress],\n    }));\n\n    multicall({\n      abi: [\n        {\n          inputs: [\n            { internalType: \"address\", name: \"asset\", type: \"address\" },\n            { internalType: \"address\", name: \"reward\", type: \"address\" },\n          ],\n          name: \"getRewardsData\",\n          outputs: [\n            { internalType: \"uint256\", name: \"\", type: \"uint256\" },\n            { internalType: \"uint256\", name: \"\", type: \"uint256\" },\n            { internalType: \"uint256\", name: \"\", type: \"uint256\" },\n            { internalType: \"uint256\", name: \"\", type: \"uint256\" },\n          ],\n          stateMutability: \"view\",\n          type: \"function\",\n        },\n      ],\n      calls,\n      options: {},\n      multicallAddress,\n      provider: Ethers.provider(),\n    })\n      .then((res) => {\n        console.log(\"--------------------fetchRewardsData_res\", res);\n\n        onLoad({\n          emissionPerSeconds: res,\n        });\n      })\n      .catch((err) => {\n        console.log(\"fetchRewardsData_err\", err);\n      });\n  }\n\n  function getAllUserRewards() {\n    const arr = markets\n      ?.map((item) => [\n        item.aTokenAddress,\n        // item.stableDebtTokenAddress,\n        item.variableDebtTokenAddress,\n      ])\n      .flat();\n    const addrs = [...new Set(arr)];\n\n    const rewardsProvider = new ethers.Contract(\n      config.incentivesProxy,\n      [\n        {\n          inputs: [\n            { internalType: \"address[]\", name: \"assets\", type: \"address[]\" },\n            { internalType: \"address\", name: \"user\", type: \"address\" },\n          ],\n          name: \"getAllUserRewards\",\n          outputs: [\n            {\n              internalType: \"address[]\",\n              name: \"rewardsList\",\n              type: \"address[]\",\n            },\n            {\n              internalType: \"uint256[]\",\n              name: \"unclaimedAmounts\",\n              type: \"uint256[]\",\n            },\n          ],\n          stateMutability: \"view\",\n          type: \"function\",\n        },\n      ],\n      Ethers.provider().getSigner()\n    );\n\n    rewardsProvider\n      .getAllUserRewards(addrs, account)\n      .then((res) => {\n        try {\n          console.log(\"getAllUserRewards_res:\", res);\n          const _amount = res[1].reduce((total, cur) => {\n            return Big(total).plus(ethers.utils.formatUnits(cur)).toFixed();\n          }, 0);\n\n          rewardToken[0].unclaimed = _amount;\n          onLoad({\n            rewardData: rewardToken,\n          });\n        } catch (error) {\n          console.log(\"catch_getAllUserRewards_error\", error);\n        }\n      })\n      .catch((err) => {\n        console.log(\"getAllUserRewards_error:\", err);\n      });\n  }\n\n  getRewardsData();\n  getAllUserRewards();\n\n  return <div style={{ display: \"none\" }} />;\n}, [account]);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/AAVE.Data.Zerolend", "fact_widget_deployments_id": "4aa3255a994b20076549e3d5bbe8c9ea", "inserted_timestamp": "2024-04-11T10:39:33.912Z", "modified_timestamp": "2024-04-11T10:39:33.912Z", "__row_index": 1}