{"tx_hash": "EatGct93JgLSSRjZCWWkXB5c8BRGetjLfqhbJnUeRXqx", "action_id_social": "C8oXe7P7JPP4b2HwKTWW9SZMwygo2fZPsV8Sr3P47T2M-0-widget", "block_id": 107110499, "block_timestamp": "2023-12-04T03:44:03.263Z", "signer_id": "bluebiu.near", "widget_name": "Avalanche.Lending.Yours", "source_code": "const Yours = styled.div`\n  display: flex;\n  gap: 20px;\n`;\nconst YoursTableWrapper = styled.div`\n  background-color: rgba(53, 55, 73, 0.2);\n  border-radius: 6px;\n  width: 50%;\n`;\nconst Title = styled.div`\n  padding: 20px;\n  border-bottom: 1px solid #292c42;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n`;\nconst Label = styled.div`\n  font-size: 14px;\n  font-weight: 400;\n  color: #7c7f96;\n  &.yours-table-title {\n    color: var(--yours-table-title);\n  }\n`;\nconst Value = styled.div`\n  font-size: 18px;\n  font-weight: 700;\n  margin-top: 4px;\n  color: #fff;\n  &.supply-color {\n    color: var(--supply-color);\n  }\n  &.borrow-color {\n    color: var(--borrow-color);\n  }\n`;\nconst Right = styled.div`\n  text-align: right;\n`;\n\nconst { markets, dapps, currentDapp } = props;\nconst formatData = () => {\n  let userTotalSupplyUsd = Big(0);\n  let userTotalBorrowUsd = Big(0);\n  let totalCollateralUsd = Big(0);\n  if (currentDapp === \"All\") {\n    const dappsToList = Object.values(dapps);\n    dappsToList.forEach((dapp) => {\n      userTotalSupplyUsd = userTotalSupplyUsd.plus(dapp.userTotalSupplyUsd);\n      userTotalBorrowUsd = userTotalBorrowUsd.plus(dapp.userTotalBorrowUsd);\n      totalCollateralUsd = totalCollateralUsd.plus(dapp.totalCollateralUsd);\n    });\n  } else {\n    const dapp = dapps[currentDapp];\n    if (dapp) {\n      userTotalSupplyUsd = Big(dapp.userTotalSupplyUsd || 0);\n      userTotalBorrowUsd = Big(dapp.userTotalBorrowUsd || 0);\n      totalCollateralUsd = Big(dapp.totalCollateralUsd || 0);\n    }\n  }\n  const marketsToList = Object.values(markets);\n  const supplies = [];\n  const borrows = [];\n  let rewards = [];\n  let change = Big(0);\n  marketsToList\n    .filter((market) => market.dapp === currentDapp || currentDapp === \"All\")\n    .forEach((market) => {\n      const dapp = dapps[market.dapp];\n      let rewardSupplyApy = 0;\n      let rewardBorrowApy = 0;\n      if (market.distributionApy) {\n        market.distributionApy.forEach((reward) => {\n          const supplyApy = reward.apyAccountSupply || reward.supply;\n          const borrowApy = reward.apyAccountBorrow || reward.borrow;\n          rewardSupplyApy += Number(supplyApy.slice(0, -1));\n          rewardBorrowApy += Number(borrowApy.slice(0, -1));\n        });\n      }\n\n      if (Big(market.userSupply || 0).gt(0)) {\n        supplies.push({\n          icon: market.icon,\n          symbol: market.underlyingToken.symbol,\n          dappIcon: dapp.dappIcon,\n          dappName: dapp.dappName,\n          apy: market.supplyApy,\n          isCollateral: market.userMerberShip,\n          balance: market.userSupply,\n          balance_value: Big(market.userSupply || 0)\n            .mul(market.underlyingPrice)\n            .toString(),\n          address: market.address,\n          distributionApy: market.distributionApy,\n        });\n        change = change.add(\n          Big(\n            (Number(market.supplyApy.slice(0, -1)) + rewardSupplyApy) / 100 || 0\n          )\n            .mul(market.userSupply || 0)\n            .mul(market.underlyingPrice)\n        );\n      }\n      if (Big(market.userBorrow || 0).gt(0)) {\n        borrows.push({\n          icon: market.icon,\n          symbol: market.underlyingToken.symbol,\n          dappIcon: dapp.dappIcon,\n          dappName: dapp.dappName,\n          apy: market.borrowApy,\n          borrowed: market.userBorrow,\n          borrowed_value: Big(market.userBorrow || 0)\n            .mul(market.underlyingPrice)\n            .toString(),\n          address: market.address,\n          distributionApy: market.distributionApy,\n        });\n        change = change.minus(\n          Big(\n            (Number(market.borrowApy.slice(0, -1)) - rewardBorrowApy) / 100 || 0\n          )\n            .mul(market.userBorrow || 0)\n            .mul(market.underlyingPrice)\n        );\n      }\n    });\n  Object.values(dapps).forEach((dapp) => {\n    if (\n      dapp.rewards &&\n      dapp.rewards.length &&\n      (currentDapp === \"All\" || currentDapp === dapp.dappName)\n    ) {\n      dapp.rewards.forEach((reward) => {\n        rewards.push({\n          icon: reward.icon,\n          symbol: reward.symbol,\n          dappIcon: dapp.dappIcon,\n          dappName: dapp.dappName,\n          dailyReward: reward.dailyRewards,\n          dailyReward_value: Big(reward.dailyRewards || 0)\n            .mul(reward.price)\n            .toString(),\n          unclaimed: reward.unclaimed,\n          unclaimed_value: Big(reward.unclaimed || 0)\n            .mul(reward.price || 0)\n            .toString(),\n        });\n      });\n    }\n  });\n\n  State.update({\n    userTotalSupplyUsd: userTotalSupplyUsd.toString(),\n    userTotalBorrowUsd: userTotalBorrowUsd.toString(),\n    userBorrowLimit: Big(userTotalBorrowUsd || 0)\n      .div(totalCollateralUsd.eq(0) ? 1 : totalCollateralUsd)\n      .mul(100)\n      .toFixed(2),\n    supplies,\n    borrows,\n    rewards,\n    netApy: change\n      .div(userTotalSupplyUsd.eq(0) ? 1 : userTotalSupplyUsd)\n      .mul(100)\n      .toFixed(2),\n  });\n};\n\nconst prevMarketTimestamp = Storage.privateGet(\"prevMarketTimestampYours\");\n\nif (prevMarketTimestamp !== props.timestamp) {\n  if (markets) {\n    formatData();\n    Storage.privateSet(\"prevMarketTimestampYours\", props.timestamp);\n  }\n}\n\nreturn (\n  <>\n    <Yours>\n      <YoursTableWrapper>\n        <Title>\n          <div>\n            <Label className=\"yours-table-title\">You Deposit</Label>\n            <Value className=\"supply-color\">\n              <Widget\n                src=\"bluebiu.near/widget/Avalanche.Lending.Total\"\n                props={{\n                  total: state.userTotalSupplyUsd,\n                  digit: 2,\n                  unit: \"$\",\n                }}\n              />\n            </Value>\n          </div>\n          <Right>\n            <Label>Net APY</Label>\n            <Value>{currentDapp === \"All\" ? \"-\" : state.netApy}%</Value>\n          </Right>\n        </Title>\n        <Widget\n          src=\"bluebiu.near/widget/Avalanche.Lending.DepositTable\"\n          props={{\n            data: state.supplies || [],\n            onButtonClick: props.onButtonClick,\n          }}\n        />\n      </YoursTableWrapper>\n      <YoursTableWrapper>\n        <Title>\n          <div>\n            <Label className=\"yours-table-title\">Borrow</Label>\n            <Value className=\"borrow-color\">\n              <Widget\n                src=\"bluebiu.near/widget/Avalanche.Lending.Total\"\n                props={{\n                  total: state.userTotalBorrowUsd,\n                  digit: 2,\n                  unit: \"$\",\n                }}\n              />\n            </Value>\n          </div>\n          <Right>\n            <Label>Your Borrow Limit</Label>\n            <Value>{state.userBorrowLimit}%</Value>\n          </Right>\n        </Title>\n        <Widget\n          src=\"bluebiu.near/widget/Avalanche.Lending.BorrowTable\"\n          props={{\n            data: state.borrows || [],\n            onButtonClick: props.onButtonClick,\n          }}\n        />\n      </YoursTableWrapper>\n    </Yours>\n    <Widget\n      src=\"bluebiu.near/widget/Avalanche.Lending.RewardsTable\"\n      props={{\n        data: state.rewards || [],\n        dapps: props.dappsConfig,\n        onSuccess: props.onSuccess,\n      }}\n    />\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/Avalanche.Lending.Yours", "fact_widget_deployments_id": "47f1479cfe89ad44539d61597d317ef4", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 7}