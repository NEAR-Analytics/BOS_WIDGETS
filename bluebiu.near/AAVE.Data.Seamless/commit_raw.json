{"tx_hash": "EYiXm3QMt6DDHEBnBrWMesXJ6rhkXYRVqrbCyF2aKm2z", "action_id_social": "25Rv116WKaW4p8dTwsjpE7GW3zMDeNUMNdx3wC4WpLE7-0-widget", "block_id": 116616707, "block_timestamp": "2024-04-11T15:02:24.470Z", "signer_id": "bluebiu.near", "widget_name": "AAVE.Data.Seamless", "source_code": "const {\n  account,\n  config,\n  multicall,\n  multicallAddress,\n  assetsToSupply,\n  markets,\n  rewardToken,\n  onLoad,\n} = props;\n\nuseEffect(() => {\n  if (!account) return \"\";\n\n  function getRewardsData() {\n    const aTokenAddresss = assetsToSupply?.map((item) => item.aTokenAddress);\n\n    const calls = aTokenAddresss?.map((addr) => ({\n      address: config.incentivesProxy,\n      name: \"getRewardsData\",\n      params: [addr, config.rewardAddress],\n    }));\n\n    multicall({\n      abi: [\n        {\n          inputs: [\n            { internalType: \"address\", name: \"asset\", type: \"address\" },\n            { internalType: \"address\", name: \"reward\", type: \"address\" },\n          ],\n          name: \"getRewardsData\",\n          outputs: [\n            { internalType: \"uint256\", name: \"\", type: \"uint256\" },\n            { internalType: \"uint256\", name: \"\", type: \"uint256\" },\n            { internalType: \"uint256\", name: \"\", type: \"uint256\" },\n            { internalType: \"uint256\", name: \"\", type: \"uint256\" },\n          ],\n          stateMutability: \"view\",\n          type: \"function\",\n        },\n      ],\n      calls,\n      options: {},\n      multicallAddress,\n      provider: Ethers.provider(),\n    })\n      .then((res) => {\n        console.log(\"fetchRewardsData_res\", res);\n\n        onLoad({\n          emissionPerSeconds: res,\n        });\n      })\n      .catch((err) => {\n        console.log(\"fetchRewardsData_err\", err);\n      });\n  }\n\n  function getAllUserRewards() {\n    const arr = markets\n      ?.map((item) => [item.aTokenAddress, item.variableDebtTokenAddress])\n      .flat();\n    const addrs = [...new Set(arr)];\n\n    const rewardsProvider = new ethers.Contract(\n      config.incentivesProxy,\n      [\n        {\n          inputs: [\n            { internalType: \"address[]\", name: \"assets\", type: \"address[]\" },\n            { internalType: \"address\", name: \"user\", type: \"address\" },\n          ],\n          name: \"getAllUserRewards\",\n          outputs: [\n            {\n              internalType: \"address[]\",\n              name: \"rewardsList\",\n              type: \"address[]\",\n            },\n            {\n              internalType: \"uint256[]\",\n              name: \"unclaimedAmounts\",\n              type: \"uint256[]\",\n            },\n          ],\n          stateMutability: \"view\",\n          type: \"function\",\n        },\n      ],\n      Ethers.provider().getSigner()\n    );\n\n    rewardsProvider\n      .getAllUserRewards(addrs, account)\n      .then((res) => {\n        try {\n          console.log(\"getAllUserRewards_res:\", res);\n          const [addrs, amounts] = res;\n          addrs.forEach((addr, i) => {\n            rewardToken.find(\n              (item) => item.address.toLowerCase() === addr.toLowerCase()\n            ).unclaimed = ethers.utils.formatUnits(\n              amounts[i],\n              item.decimals || 18\n            );\n          });\n\n          onLoad({\n            rewardData: rewardToken,\n          });\n        } catch (error) {\n          console.log(\"catch_getAllUserRewards_error\", error);\n        }\n      })\n      .catch((err) => {\n        console.log(\"getAllUserRewards_error:\", err);\n      });\n  }\n\n  getRewardsData();\n  getAllUserRewards();\n\n  return <div style={{ display: \"none\" }} />;\n}, [account]);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/AAVE.Data.Seamless", "fact_widget_deployments_id": "c22a829cd5cb0a194abb0bce850f9b7f", "inserted_timestamp": "2024-04-11T16:49:18.947Z", "modified_timestamp": "2024-04-11T16:49:18.947Z", "__row_index": 0}