{"tx_hash": "HDqFgoXUmZKH6yuT67t7kp2TyiwdZBerPN375z8AaAMU", "action_id_social": "DLo44Gjgpt3DdKQaHmysCpauGmFcXJZu2XpQpDz4g3vy-0-widget", "block_id": 114514743, "block_timestamp": "2024-03-11T10:48:07.728Z", "signer_id": "bluebiu.near", "widget_name": "Avalanche.Lending.Collection", "source_code": "const {\n  chainId,\n  chainName,\n  connectProps,\n  defaultDapp,\n  addAction,\n  toast,\n  multicall,\n  multicallAddress,\n  wethAddress,\n  prices,\n} = props;\n\nconst dapps = props.dapps || {};\n\nconst account = Ethers.send(\"eth_requestAccounts\", [])[0];\nif (!account) {\n  return (\n    <Widget\n      src=\"bluebiu.near/widget/Arbitrum.Swap.ConnectButton\"\n      props={{\n        ...connectProps,\n        isWrongNetwork: false,\n      }}\n    />\n  );\n}\n\nuseEffect(() => {\n  State.update({\n    chainId: -1,\n    updateData: defaultDapp || \"All\",\n    showDialog: false,\n    tableButtonClickData: null,\n    currentTab: \"Market\",\n    currentDapp: defaultDapp || \"All\",\n    dapps: {},\n  });\n}, []);\n\nEthers.provider()\n  .getNetwork()\n  .then(({ chainId }) => {\n    State.update({ chainId });\n  })\n  .catch(() => {});\n\nif (state.chainId !== chainId) {\n  return (\n    <Widget\n      src=\"bluebiu.near/widget/Arbitrum.Swap.ConnectButton\"\n      props={{\n        ...connectProps,\n        isWrongNetwork: true,\n      }}\n    />\n  );\n}\nconst Container = styled.div`\n  padding-bottom: 20px;\n  max-width: 1000px;\n  width: 100%;\n  margin: 0 auto;\n  position: relative;\n`;\n\nconst handleTableButtonClick = (address, actionText) => {\n  const market = state.markets[address];\n  const dapp = state.dapps[market.dapp];\n  const dappConfig = dapps[market.dapp];\n  State.update({\n    tableButtonClickData: {\n      ...dapp,\n      ...market,\n      config: { ...dappConfig, wethAddress },\n      actionText,\n    },\n    showDialog: true,\n  });\n};\nreturn (\n  <Container>\n    {state.updateData && (\n      <>\n        {(state.updateData === \"All\" || !state.dapps[state.updateData]) && (\n          <Widget src=\"bluebiu.near/widget/0vix.LendingSpinner\" />\n        )}\n        <Widget\n          src=\"bluebiu.near/widget/Avalanche.Lending.Data\"\n          props={{\n            update: state.updateData,\n            dapps: dapps,\n            chainId,\n            multicall,\n            multicallAddress,\n            wethAddress,\n            prices,\n            onLoad: (data) => {\n              const { markets, dapp } = data;\n              const dapps = state.dapps;\n              dapps[dapp.dappName] = dapp;\n              const _markets = { ...state.markets, ...markets };\n              State.update({\n                markets: _markets,\n                dapps,\n                updateData:\n                  state.updateData === \"All\" && !data.allLoaded ? \"All\" : \"\",\n                timestamp: Date.now(),\n              });\n            },\n          }}\n        />\n      </>\n    )}\n    <Widget\n      src=\"bluebiu.near/widget/Avalanche.Lending.Tabs\"\n      props={{\n        currentTab: state.currentTab,\n        onChange: (tab) => {\n          State.update({\n            currentTab: tab,\n            timestamp: Date.now(),\n          });\n        },\n      }}\n    />\n    <Widget\n      src=\"bluebiu.near/widget/Avalanche.Lending.Dapps\"\n      props={{\n        dapps: Object.values(dapps) || [],\n        currentDapp: state.currentDapp,\n        onChange: (dapp) => {\n          let _updateDapp = \"\";\n          if (dapp == \"All\") {\n            _updateDapp =\n              Object.values(dapps).length === Object.values(state.dapps).length\n                ? \"\"\n                : \"All\";\n          } else {\n            _updateDapp = !state.dapps[dapp] ? dapp : \"\";\n          }\n          State.update({\n            currentDapp: dapp,\n            updateData: _updateDapp,\n            timestamp: Date.now(),\n          });\n        },\n      }}\n    />\n    {state.currentTab === \"Market\" && (\n      <Widget\n        src=\"bluebiu.near/widget/Avalanche.Lending.Market\"\n        props={{\n          currentDapp: state.currentDapp,\n          markets: state.markets,\n          dapps: state.dapps,\n          timestamp: state.timestamp,\n          onButtonClick: handleTableButtonClick,\n        }}\n      />\n    )}\n    {state.currentTab === \"Yours\" && (\n      <Widget\n        src=\"bluebiu.near/widget/Avalanche.Lending.Yours\"\n        props={{\n          currentDapp: state.currentDapp,\n          markets: state.markets,\n          timestamp: state.timestamp,\n          dapps: state.dapps,\n          dappsConfig: dapps,\n          toast,\n          onButtonClick: handleTableButtonClick,\n          onSuccess: (dapp) => {\n            State.update({\n              updateData: dapp,\n            });\n          },\n        }}\n      />\n    )}\n    <Widget\n      src=\"bluebiu.near/widget/Avalanche.Lending.Dialog\"\n      props={{\n        display: state.showDialog,\n        data: state.tableButtonClickData,\n        chainId: state.chainId,\n        addAction,\n        toast,\n        onClose: () => {\n          State.update({\n            showDialog: false,\n          });\n        },\n        onSuccess: () => {\n          State.update({\n            updateData: state.tableButtonClickData.dappName,\n          });\n        },\n      }}\n    />\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/Avalanche.Lending.Collection", "fact_widget_deployments_id": "db0712a0f259fb906a72b4c538b05ffa", "inserted_timestamp": "2024-03-11T12:27:40.652Z", "modified_timestamp": "2024-03-11T12:27:40.652Z", "__row_index": 6}