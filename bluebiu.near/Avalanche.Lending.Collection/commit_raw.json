{"tx_hash": "A75tj5b9T4ZnU2JkbuZWJLaYB3XJGmX8NdgDiYEJQsiv", "action_id_social": "HNuzbU1b3xrBRD4uF2iQbxXSmNcG8LG3MjrcaW12HQDm-0-widget", "block_id": 102379579, "block_timestamp": "2023-10-01T14:40:03.261Z", "signer_id": "bluebiu.near", "widget_name": "Avalanche.Lending.Collection", "source_code": "const { chainId, chainName, connectProps, dapps, multicallv2 } = props;\n\nconst account = Ethers.send(\"eth_requestAccounts\", [])[0];\nif (!account) {\n  return (\n    <Widget\n      src=\"bluebiu.near/widget/Arbitrum.Swap.ConnectButton\"\n      props={{\n        ...connectProps,\n        isWrongNetwork: false,\n      }}\n    />\n  );\n}\n\nState.init({\n  chainId: -1,\n  updateData: \"All\",\n  showDialog: false,\n  tableButtonClickData: null,\n  currentTab: \"Market\",\n  currentDapp: \"All\",\n  dapps: {},\n});\n\nEthers.provider()\n  .getNetwork()\n  .then(({ chainId }) => {\n    State.update({ chainId });\n  })\n  .catch(() => {});\n\nif (state.chainId !== chainId) {\n  return (\n    <Widget\n      src=\"bluebiu.near/widget/Arbitrum.Swap.ConnectButton\"\n      props={{\n        ...connectProps,\n        isWrongNetwork: true,\n      }}\n    />\n  );\n}\nconst Container = styled.div`\n  padding-bottom: 20px;\n  max-width: 1000px;\n  width: 100%;\n  margin: 0 auto;\n`;\n\nconst handleTableButtonClick = (address, actionText) => {\n  const market = state.markets[address];\n  const dapp = state.dapps[market.dapp];\n  const dappConfig = dapps[market.dapp];\n  State.update({\n    tableButtonClickData: {\n      ...market,\n      ...dapp,\n      config: dappConfig,\n      actionText,\n    },\n    showDialog: true,\n  });\n};\n\nreturn (\n  <>\n    {state.updateData && (\n      <>\n        {state.updateData === \"All\" && (\n          <Widget src=\"bluebiu.near/widget/0vix.LendingSpinner\" />\n        )}\n        <Widget\n          src=\"bluebiu.near/widget/Avalanche.Lending.Data\"\n          props={{\n            multicallv2,\n            update: state.updateData,\n            dapps: dapps,\n            chainId,\n            onLoad: (data) => {\n              const { markets, dapp } = data;\n              const dapps = state.dapps;\n              dapps[dapp.dappName] = dapp;\n              const _markets = { ...state.markets, ...markets };\n              State.update({\n                markets: _markets,\n                dapps,\n                updateData:\n                  state.updateData === \"All\" && !data.allLoaded ? \"All\" : \"\",\n                timestamp: Date.now(),\n              });\n            },\n          }}\n        />\n      </>\n    )}\n    <Container>\n      <Widget\n        src=\"bluebiu.near/widget/Avalanche.Lending.Tabs\"\n        props={{\n          currentTab: state.currentTab,\n          onChange: (tab) => {\n            State.update({ currentTab: tab, timestamp: Date.now() });\n          },\n        }}\n      />\n      <Widget\n        src=\"bluebiu.near/widget/Avalanche.Lending.Dapps\"\n        props={{\n          dapps: Object.values(dapps) || [],\n          currentDapp: state.currentDapp,\n          onChange: (dapp) => {\n            State.update({ currentDapp: dapp, timestamp: Date.now() });\n          },\n        }}\n      />\n      {state.currentTab === \"Market\" && (\n        <Widget\n          src=\"bluebiu.near/widget/Avalanche.Lending.Market\"\n          props={{\n            currentDapp: state.currentDapp,\n            markets: state.markets,\n            dapps: state.dapps,\n            timestamp: state.timestamp,\n            onButtonClick: handleTableButtonClick,\n          }}\n        />\n      )}\n      {state.currentTab === \"Yours\" && (\n        <Widget\n          src=\"bluebiu.near/widget/Avalanche.Lending.Yours\"\n          props={{\n            currentDapp: state.currentDapp,\n            markets: state.markets,\n            timestamp: state.timestamp,\n            dapps: state.dapps,\n            dappsConfig: dapps,\n            onButtonClick: handleTableButtonClick,\n            onSuccess: (dapp) => {\n              State.update({\n                updateData: dapp,\n              });\n            },\n          }}\n        />\n      )}\n      <Widget\n        src=\"bluebiu.near/widget/Avalanche.Lending.Dialog\"\n        props={{\n          display: state.showDialog,\n          data: state.tableButtonClickData,\n          onClose: () => {\n            State.update({\n              showDialog: false,\n            });\n          },\n          onSuccess: () => {\n            State.update({\n              updateData: state.tableButtonClickData.dappName,\n            });\n          },\n          onMessage: (params) => {\n            State.update({\n              message: params,\n            });\n          },\n        }}\n      />\n    </Container>\n    {state.message?.open && (\n      <Widget\n        src=\"bluebiu.near/widget/0vix.LendingMessage\"\n        props={{\n          status: state.message.status,\n          text: state.message.text,\n          onClose: () => {\n            State.update({\n              message: { open: false },\n            });\n          },\n        }}\n      />\n    )}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/Avalanche.Lending.Collection", "fact_widget_deployments_id": "f32a66f9f88e14849c4c78276e66cba9", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 1}