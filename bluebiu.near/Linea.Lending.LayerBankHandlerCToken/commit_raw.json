{"tx_hash": "HnMT6kfX4YLbvEBwMtjNzwGe9uvz7A646CV5FLxs8v6k", "action_id_social": "7fAAF1yzqZ6BV9XSHoyjizaWWXcfV2TqUde8rngcT85P-0-widget", "block_id": 106869627, "block_timestamp": "2023-11-30T13:37:31.361Z", "signer_id": "bluebiu.near", "widget_name": "Linea.Lending.LayerBankHandlerCToken", "source_code": "const CTOKEN_ABI = [\n  {\n    inputs: [\n      { internalType: \"address\", name: \"gToken\", type: \"address\" },\n      { internalType: \"uint256\", name: \"uAmount\", type: \"uint256\" },\n    ],\n    name: \"supply\",\n    outputs: [{ internalType: \"uint256\", name: \"\", type: \"uint256\" }],\n    stateMutability: \"payable\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      { internalType: \"address\", name: \"gToken\", type: \"address\" },\n      { internalType: \"uint256\", name: \"uAmount\", type: \"uint256\" },\n    ],\n    name: \"redeemUnderlying\",\n    outputs: [{ internalType: \"uint256\", name: \"\", type: \"uint256\" }],\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      { internalType: \"address\", name: \"gToken\", type: \"address\" },\n      { internalType: \"uint256\", name: \"amount\", type: \"uint256\" },\n    ],\n    name: \"borrow\",\n    outputs: [],\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      { internalType: \"address\", name: \"gToken\", type: \"address\" },\n      { internalType: \"uint256\", name: \"amount\", type: \"uint256\" },\n    ],\n    name: \"repayBorrow\",\n    outputs: [],\n    stateMutability: \"payable\",\n    type: \"function\",\n  },\n];\n\nconst { market, actionText, amount, loading, onSuccess, onError } = props;\nconst account = Ethers.send(\"eth_requestAccounts\", [])[0];\nif (!loading || !account) return \"\";\nconst CNativeTokenContract = new ethers.Contract(\n  \"0x009a0b7C38B542208936F1179151CD08E2943833\",\n  [\n    {\n      inputs: [],\n      name: \"supply\",\n      outputs: [],\n      stateMutability: \"payable\",\n      type: \"function\",\n    },\n  ],\n  Ethers.provider().getSigner()\n);\nconst CTokenContract = new ethers.Contract(\n  \"0x009a0b7C38B542208936F1179151CD08E2943833\",\n  CTOKEN_ABI,\n  Ethers.provider().getSigner()\n);\n\nif (actionText === \"Deposit\") {\n  if (market.underlyingToken.address === \"native\") {\n    CNativeTokenContract.supply(market.address, 0, {\n      value: ethers.utils.parseUnits(\n        Big(amount).toFixed(market.underlyingToken.decimals).toString(),\n        market.underlyingToken.decimals\n      ),\n    })\n      .then((tx) => {\n        tx.wait().then((res) => {\n          onSuccess(res);\n        });\n      })\n      .catch((err) => {\n        onError(err);\n      });\n  } else {\n    CTokenContract.supply(\n      market.address,\n      ethers.utils.parseUnits(\n        Big(amount).toFixed(market.underlyingToken.decimals).toString(),\n        market.underlyingToken.decimals\n      ),\n      {\n        gasLimit: 50000,\n      }\n    )\n      .then((tx) => {\n        tx.wait().then((res) => {\n          onSuccess(res);\n        });\n      })\n      .catch((err) => {\n        onError(err);\n      });\n  }\n  return \"\";\n}\nif (actionText === \"Withdraw\") {\n  CTokenContract.redeemUnderlying(\n    market.address,\n    ethers.utils.parseUnits(amount, market.underlyingToken.decimals)\n  )\n    .then((tx) => {\n      tx.wait().then((res) => {\n        onSuccess(res);\n      });\n    })\n    .catch((err) => {\n      onError();\n    });\n  return \"\";\n}\n\nif (actionText === \"Borrow\") {\n  CTokenContract.borrow(\n    market.address,\n    ethers.utils.parseUnits(amount, market.underlyingToken.decimals)\n  )\n    .then((tx) => {\n      tx.wait().then((res) => {\n        onSuccess(res);\n      });\n    })\n    .catch((err) => {\n      console.log(err);\n      onError();\n    });\n  return \"\";\n}\nif (actionText === \"Repay\") {\n  CTokenContract.repayBorrow(\n    market.address,\n    ethers.utils.parseUnits(amount, market.underlyingToken.decimals)\n  )\n    .then((tx) => {\n      tx.wait().then((res) => {\n        onSuccess(res);\n      });\n    })\n    .catch((err) => {\n      console.log(err);\n      onError();\n    });\n}\n\nreturn \"\";\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/Linea.Lending.LayerBankHandlerCToken", "fact_widget_deployments_id": "9ff20ba6cba9ee46a27d6017ba7b6589", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}