{"tx_hash": "4qbPXES2cE7Ja2TdqVz5TUDrWB6SZTi7FnVF3fdzES5z", "action_id_social": "44J2pQn9KaD4eta5mF83GeYsK3fbFx4JLoiMYAAZ7Kov-0-widget", "block_id": 102380511, "block_timestamp": "2023-10-01T14:57:28.319Z", "signer_id": "bluebiu.near", "widget_name": "Linea.Lending.LayerBankHandlerCToken", "source_code": "const CTOKEN_ABI = [\n  {\n    inputs: [\n      { internalType: \"address\", name: \"account\", type: \"address\" },\n      { internalType: \"uint256\", name: \"uAmount\", type: \"uint256\" },\n    ],\n    name: \"supply\",\n    outputs: [{ internalType: \"uint256\", name: \"\", type: \"uint256\" }],\n    stateMutability: \"payable\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      { internalType: \"uint256\", name: \"redeemAmount\", type: \"uint256\" },\n    ],\n    name: \"redeemUnderlying\",\n    outputs: [],\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      { internalType: \"uint256\", name: \"borrowAmount\", type: \"uint256\" },\n    ],\n    name: \"borrow\",\n    outputs: [],\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n  {\n    inputs: [{ internalType: \"uint256\", name: \"repayAmount\", type: \"uint256\" }],\n    name: \"repayBorrow\",\n    outputs: [],\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n];\n\nconst { market, actionText, amount, loading, onSuccess, onError } = props;\nconst account = Ethers.send(\"eth_requestAccounts\", [])[0];\nif (!loading || !account) return \"\";\n\nconst CNativeTokenContract = new ethers.Contract(\n  market.address,\n  [\n    {\n      inputs: [account],\n      name: \"supply\",\n      outputs: [],\n      stateMutability: \"payable\",\n      type: \"function\",\n    },\n  ],\n  Ethers.provider().getSigner()\n);\n\nconst CTokenContract = new ethers.Contract(\n  market.address,\n  CTOKEN_ABI,\n  Ethers.provider().getSigner()\n);\n\nif (actionText === \"Deposit\") {\n  if (market.underlyingToken.address === \"native\") {\n    CNativeTokenContract.supply(account, 0, {\n      value: ethers.utils.parseUnits(amount, market.underlyingToken.decimals),\n    })\n      .then((tx) => {\n        tx.wait().then((res) => {\n          onSuccess(res);\n        });\n      })\n      .catch((err) => {\n        onError(err);\n      });\n  } else {\n    CTokenContract.supply(\n      account,\n      ethers.utils.parseUnits(amount, market.underlyingToken.decimals)\n    )\n      .then((tx) => {\n        tx.wait().then((res) => {\n          onSuccess(res);\n        });\n      })\n      .catch((err) => {\n        onError(err);\n      });\n  }\n  return \"\";\n}\nif (actionText === \"Withdraw\") {\n  CTokenContract.redeemUnderlying(\n    ethers.utils.parseUnits(amount, market.underlyingToken.decimals)\n  )\n    .then((tx) => {\n      tx.wait().then((res) => {\n        onSuccess(res);\n      });\n    })\n    .catch((err) => {\n      onError();\n    });\n  return \"\";\n}\nif (actionText === \"Borrow\") {\n  CTokenContract.borrow(\n    ethers.utils.parseUnits(amount, market.underlyingToken.decimals)\n  )\n    .then((tx) => {\n      tx.wait().then((res) => {\n        onSuccess(res);\n      });\n    })\n    .catch((err) => {\n      console.log(err);\n      onError();\n    });\n  return \"\";\n}\nif (actionText === \"Repay\") {\n  CTokenContract.repayBorrow(\n    ethers.utils.parseUnits(amount, market.underlyingToken.decimals)\n  )\n    .then((tx) => {\n      tx.wait().then((res) => {\n        onSuccess(res);\n      });\n    })\n    .catch((err) => {\n      console.log(err);\n      onError();\n    });\n}\n\nreturn \"\";\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/Linea.Lending.LayerBankHandlerCToken", "fact_widget_deployments_id": "8551ee9ee606d1ebed176c86be201083", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 3}