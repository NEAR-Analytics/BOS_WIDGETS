{"tx_hash": "B4WCYhsHWV9ShNoHBqhbwCKDRCSNWMbQneHgyhCGVTvQ", "action_id_social": "8JV6Wa9gBksqBWu6nBtw998b7sCtG92h34BKR91HPdGi-0-widget", "block_id": 117946589, "block_timestamp": "2024-04-30T11:08:52.592Z", "signer_id": "bluebiu.near", "widget_name": "Lending.Orbit.Yours", "source_code": "const Yours = styled.div`\n  display: flex;\n  gap: 20px;\n`;\nconst YoursTableWrapper = styled.div`\n  background-color: rgba(53, 55, 73, 0.2);\n  border-radius: 6px;\n  width: 50%;\n`;\nconst Title = styled.div`\n  padding: 20px;\n  border-bottom: 1px solid #292c42;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n`;\nconst Label = styled.div`\n  font-size: 14px;\n  font-weight: 400;\n  color: #7c7f96;\n  &.yours-table-title {\n    color: var(--yours-table-title);\n  }\n`;\nconst Value = styled.div`\n  font-size: 18px;\n  font-weight: 700;\n  margin-top: 4px;\n  color: #fff;\n  &.supply-color {\n    color: var(--supply-color);\n  }\n  &.borrow-color {\n    color: var(--borrow-color);\n  }\n`;\nconst Right = styled.div`\n  text-align: right;\n`;\n\nconst { markets, dapps, toast, currentDapp, borrowLimit, orbitTab } = props;\n\nconst { userTotalSupplyUsd, userTotalBorrowUsd, totalCollateralUsd } =\n  dapps[currentDapp];\nconst formatData = () => {\n  const marketsToList = Object.values(markets);\n  const supplies = [];\n  const borrows = [];\n  let rewards = [];\n  let change = Big(0);\n  marketsToList.forEach((market) => {\n    const dapp = dapps[market.dapp];\n    let rewardSupplyApy = 0;\n    let rewardBorrowApy = 0;\n    // if (market.distributionApy) {\n    //   market.distributionApy.forEach((reward) => {\n    //     const supplyApy = reward.apyAccountSupply || reward.supply;\n    //     const borrowApy = reward.apyAccountBorrow || reward.borrow;\n    //     rewardSupplyApy += Number(supplyApy.slice(0, -1));\n    //     rewardBorrowApy += Number(borrowApy.slice(0, -1));\n    //   });\n    // }\n\n    if (Big(market.userSupply || 0).gt(0)) {\n      const { compSupplySpeed, oTokenBalance, oTokenTotalSupply, decimals } =\n        market;\n\n      const RewardRate = Big(compSupplySpeed || 0)\n        .times(43200)\n        .times(30)\n        .times(Big(oTokenBalance || 1).div(Big(oTokenTotalSupply || 1)))\n        .div(Math.pow(10, decimals))\n        .toFixed();\n\n      supplies.push({\n        icon: market.underlyingToken.icon,\n        symbol: market.underlyingToken.symbol,\n        dappIcon: dapp.dappIcon,\n        dappName: dapp.dappName,\n        apy: market.supplyApy,\n        isCollateral: market.isCollateral,\n        balance: market.userSupply,\n        balance_value: Big(market.userSupply || 0)\n          .mul(Big(market.underlyingPrice || 0))\n          .toString(),\n        address: market.address,\n        RewardRate,\n        // distributionApy: market.distributionApy,\n      });\n      // change = change.add(\n      //   Big(\n      //     (Number(market.supplyApy.slice(0, -1)) + rewardSupplyApy) / 100 || 0\n      //   )\n      //     .mul(market.userSupply || 0)\n      //     .mul(Big(market.underlyingPrice||0))\n      // );\n    }\n    if (Big(market.userBorrow || 0).gt(0)) {\n      borrows.push({\n        icon: market.underlyingToken.icon,\n        symbol: market.underlyingToken.symbol,\n        dappIcon: dapp.dappIcon,\n        dappName: dapp.dappName,\n        apy: market.borrowApy,\n        borrowed: market.userBorrow,\n        borrowed_value: Big(market.userBorrow || 0)\n          .mul(Big(market.underlyingPrice || 0))\n          .toString(),\n        address: market.address,\n        // distributionApy: market.distributionApy,\n      });\n      // change = change.minus(\n      //   Big(\n      //     (Number(market.borrowApy.slice(0, -1)) - rewardBorrowApy) / 100 || 0\n      //   )\n      //     .mul(market.userBorrow || 0)\n      //     .mul(Big(market.underlyingPrice||0))\n      // );\n    }\n  });\n  // Object.values(dapps).forEach((dapp) => {\n  //   if (\n  //     dapp.rewards &&\n  //     dapp.rewards.length &&\n  //     (currentDapp === \"All\" || currentDapp === dapp.dappName)\n  //   ) {\n  //     dapp.rewards.forEach((reward) => {\n  //       rewards.push({\n  //         icon: reward.icon,\n  //         symbol: reward.symbol,\n  //         dappIcon: dapp.dappIcon,\n  //         dappName: dapp.dappName,\n  //         dailyReward: reward.dailyRewards,\n  //         dailyReward_value: Big(reward.dailyRewards || 0)\n  //           .mul(reward.price || 0)\n  //           .toString(),\n  //         unclaimed: reward.unclaimed,\n  //         unclaimed_value: Big(reward.unclaimed || 0)\n  //           .mul(reward.price || 0)\n  //           .toString(),\n  //         ...reward,\n  //       });\n  //     });\n  //   }\n  // });\n  State.update({\n    // userTotalBorrowUsd: userTotalBorrowUsd.toString(),\n    supplies,\n    borrows,\n    // rewards,\n    // netApy: change\n    //   .div(userTotalSupplyUsd.eq(0) ? 1 : userTotalSupplyUsd)\n    //   .mul(100)\n    //   .toFixed(2),\n  });\n};\n\nuseEffect(() => {\n  if (markets) {\n    formatData();\n  }\n}, [markets, currentDapp]);\n\nconst rewards = state.supplies.reduce((total, cur) => {\n  return Big(total).plus(Big(cur.RewardRate)).toFixed(2);\n}, 0);\nconst formatRate = (num) => {\n  if (isNaN(Number(num))) return \"-\";\n  if (Big(num).lt(0.01)) {\n    return \"<0.01\";\n  } else {\n    return Number(num).toFixed(2);\n  }\n};\n\nlet rewardsData;\nif (orbitTab === \"ORBIT\") {\n  rewardsData = [\n    {\n      dappName: \"Orbit Protocol\",\n      pool: \"ORBIT\",\n      reward: formatRate(rewards),\n    },\n  ];\n}\nif (orbitTab === \"RENZO\") {\n  rewardsData = [\n    {\n      dappName: \"Orbit Protocol\",\n      pool: \"RENZO\",\n      reward: formatRate(rewards),\n    },\n  ];\n}\nif (orbitTab === \"KELP\") {\n  rewardsData = [\n    {\n      dappName: \"Orbit Protocol\",\n      pool: \"KELP\",\n      reward: formatRate(rewards),\n    },\n  ];\n}\nconsole.log(\"YOURS--\", props, state);\n\nreturn (\n  <>\n    <Yours>\n      <YoursTableWrapper>\n        <Title>\n          <div>\n            <Label className=\"yours-table-title\">You Deposit</Label>\n            <Value className=\"supply-color\">\n              <Widget\n                src=\"bluebiu.near/widget/Avalanche.Lending.Total\"\n                props={{\n                  total: userTotalSupplyUsd,\n                  digit: 2,\n                  unit: \"$\",\n                }}\n              />\n            </Value>\n          </div>\n          <Right>\n            <Label>LTV</Label>\n            <Value className=\"supply-color\">\n              {!Big(userTotalBorrowUsd || 0).eq(0) &&\n              !Big(userTotalSupplyUsd || 0).eq(0)\n                ? Big(userTotalBorrowUsd || 1)\n                    .div(Big(userTotalSupplyUsd || 1))\n                    .times(100)\n                    .toFixed(2)\n                : \"-\"}\n              %\n            </Value>\n          </Right>\n        </Title>\n        <Widget\n          src=\"bluebiu.near/widget/Avalanche.Lending.DepositTable\"\n          props={{\n            data: state.supplies || [],\n            onButtonClick: props.onButtonClick,\n          }}\n        />\n      </YoursTableWrapper>\n      <YoursTableWrapper>\n        <Title>\n          <div>\n            <Label className=\"yours-table-title\">Borrow</Label>\n            <Value className=\"borrow-color\">\n              <Widget\n                src=\"bluebiu.near/widget/Avalanche.Lending.Total\"\n                props={{\n                  total: userTotalBorrowUsd,\n                  digit: 2,\n                  unit: \"$\",\n                }}\n              />\n            </Value>\n          </div>\n          <Right>\n            <Label>Your Borrow Limit</Label>\n            <Value className=\"supply-color\">\n              ${Number(borrowLimit).toFixed(2)}\n            </Value>\n          </Right>\n        </Title>\n        <Widget\n          src=\"bluebiu.near/widget/Avalanche.Lending.BorrowTable\"\n          props={{\n            data: state.borrows || [],\n            onButtonClick: props.onButtonClick,\n          }}\n        />\n      </YoursTableWrapper>\n    </Yours>\n    <Widget\n      src=\"bluebiu.near/widget/Lending.Orbit.RewardsTable\"\n      props={{\n        data: rewardsData,\n        dapps: props.dappsConfig,\n        onSuccess: props.onSuccess,\n        supplies: state.supplies,\n        toast,\n      }}\n    />\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/Lending.Orbit.Yours", "fact_widget_deployments_id": "6b1cf6a946fe441517909ee8e961dd06", "inserted_timestamp": "2024-04-30T12:47:49.607Z", "modified_timestamp": "2024-04-30T12:47:49.607Z", "__row_index": 6}