{"tx_hash": "Ez34XfeevEBD52mP75aG1PXKaXYLEwV2dB4qhA9wYv4c", "action_id_social": "9QUBwhjMpSZpRcdaFumsNCgH2WsU6pZD8RnvctucYo8N-0-widget", "block_id": 119552925, "block_timestamp": "2024-05-23T09:08:36.498Z", "signer_id": "bluebiu.near", "widget_name": "Staking.Ledgity.Data", "source_code": "const {\n  CHAIN_LIST,\n  multicallAddress,\n  multicall,\n  account,\n  prices,\n  update,\n  onLoad,\n  StakeTokens,\n} = props;\n\nconst { formatUnits, parseUnits } = ethers.utils;\n\nuseEffect(() => {\n  if (!account || !update || !multicallAddress) return;\n\n  let count = 0;\n  let _balanceRes = {};\n  let _APY = \"\";\n  let _TVL = \"\";\n\n  function formatData(params) {\n    console.log(params, count);\n    if (count < 1) return;\n    count = 0;\n    console.log(\"_balanceRes--\", _balanceRes);\n    for (let i = 0; i < StakeTokens.length; i++) {\n      StakeTokens[i].balance = _balanceRes[StakeTokens[i].address];\n    }\n\n    onLoad({\n      StakeTokens,\n      // APY: _APY + \"%\",\n      // TVL: _TVL,\n    });\n  }\n\n  function getWalletBalance() {\n    // not eth\n    const underlyingTokens = StakeTokens.filter((market) => {\n      return market.address && !market.isNative;\n    });\n\n    Ethers.provider()\n      .getBalance(account)\n      .then((rawBalance) => {\n        _balanceRes[\"native\"] = ethers.utils.formatUnits(rawBalance, 18);\n\n        if (underlyingTokens.length) {\n          const calls = underlyingTokens.map((token) => ({\n            address: token.address,\n            name: \"balanceOf\",\n            params: [account],\n          }));\n\n          multicall({\n            abi: [\n              {\n                constant: true,\n                inputs: [\n                  {\n                    name: \"_owner\",\n                    type: \"address\",\n                  },\n                ],\n                name: \"balanceOf\",\n                outputs: [\n                  {\n                    name: \"balance\",\n                    type: \"uint256\",\n                  },\n                ],\n                payable: false,\n                stateMutability: \"view\",\n                type: \"function\",\n              },\n            ],\n            calls,\n            options: {},\n            multicallAddress,\n            provider: Ethers.provider(),\n          })\n            .then((res) => {\n              console.log(\"getWalletBalance--\", res);\n\n              for (let i = 0, len = res.length; i < len; i++) {\n                _balanceRes[underlyingTokens[i].address] = res[i]\n                  ? ethers.utils.formatUnits(\n                      res[i][0],\n                      underlyingTokens[i].decimals\n                    )\n                  : \"0\";\n              }\n\n              count++;\n              formatData(\"getWalletBalance\");\n            })\n            .catch((err) => {\n              console.log(\"getWalletBalance-error--\", err);\n              // setTimeout(() => {\n              //   getWalletBalance();\n              // }, 500);\n            });\n        } else {\n          count++;\n          formatData(\"getWalletBalance\");\n        }\n      });\n  }\n\n  getWalletBalance();\n}, [account, update, config]);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/Staking.Ledgity.Data", "fact_widget_deployments_id": "298209a12ef53cca511e6da60526824c", "inserted_timestamp": "2024-05-23T10:52:14.304Z", "modified_timestamp": "2024-05-23T10:52:14.304Z", "__row_index": 1}