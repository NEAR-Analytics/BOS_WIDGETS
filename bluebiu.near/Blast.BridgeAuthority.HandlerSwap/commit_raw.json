{"tx_hash": "3hBUePSqjRqC7QdWdCniGXGXrkx4qgW14WXbDJfGUa7L", "action_id_social": "7THx8ruFevx7eK2hf2FkmjBwzwpY6ZNP65mShGVbPov-0-widget", "block_id": 117522325, "block_timestamp": "2024-04-24T12:54:35.772Z", "signer_id": "bluebiu.near", "widget_name": "Blast.BridgeAuthority.HandlerSwap", "source_code": "const {\n  amount,\n  account,\n  currency,\n  routerAddress,\n  routerEthAddress,\n  target,\n  loading,\n  onSuccess,\n  onError,\n  quote,\n} = props;\nif (!loading) return \"\";\n\nconst {\n  getExtraData,\n} = VM.require('bluebiu.near/widget/Blast.BridgeAuthority.Util');\n\nconst L1BlastBridgeProxyAbi = [\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"address\",\n        \"name\": \"_localToken\",\n        \"type\": \"address\"\n      },\n      {\n        \"internalType\": \"address\",\n        \"name\": \"_remoteToken\",\n        \"type\": \"address\"\n      },\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"_amount\",\n        \"type\": \"uint256\"\n      },\n      {\n        \"internalType\": \"uint32\",\n        \"name\": \"_minGasLimit\",\n        \"type\": \"uint32\"\n      },\n      {\n        \"internalType\": \"bytes\",\n        \"name\": \"_extraData\",\n        \"type\": \"bytes\"\n      }\n    ],\n    \"name\": \"bridgeERC20\",\n    \"outputs\": [],\n    \"stateMutability\": \"nonpayable\",\n    \"type\": \"function\"\n  }\n]\n\nconst L2BlastBridgeAbi = [\n  {\n    \"inputs\": [\n      {\n        \"internalType\": \"address\",\n        \"name\": \"_localToken\",\n        \"type\": \"address\"\n      },\n      {\n        \"internalType\": \"address\",\n        \"name\": \"_remoteToken\",\n        \"type\": \"address\"\n      },\n      {\n        \"internalType\": \"uint256\",\n        \"name\": \"_amount\",\n        \"type\": \"uint256\"\n      },\n      {\n        \"internalType\": \"uint32\",\n        \"name\": \"_minGasLimit\",\n        \"type\": \"uint32\"\n      },\n      {\n        \"internalType\": \"bytes\",\n        \"name\": \"_extraData\",\n        \"type\": \"bytes\"\n      }\n    ],\n    \"name\": \"bridgeERC20\",\n    \"outputs\": [],\n    \"stateMutability\": \"nonpayable\",\n    \"type\": \"function\"\n  }\n]\n\nconst signer = Ethers.provider().getSigner()\nconst rawAmount = new Big(amount).mul(Math.pow(10, currency.decimals)).toString()\nif (target.id === 81457) {\n  let pRes\n  // const L1BlastBridgeProxy = '0x3a05E5d33d7Ab3864D53aaEc93c8301C1Fa49115'\n  if (currency.isNative) {\n    const params = {\n      from: account,\n      to: routerAddress,\n      value: rawAmount,\n    }\n    pRes = signer.sendTransaction(params).then(tx => {\n      console.log('tx:', tx)\n      // Storage.privateSet(tx.hash, tx);\n      return tx.wait()\n    })\n  } else {\n    const L1BridgeContract = new ethers.Contract(\n      routerAddress,\n      L1BlastBridgeProxyAbi,\n      signer\n    )\n\n    pRes = L1BridgeContract.bridgeERC20(\n      currency.targetAddress,\n      currency.address,\n      rawAmount,\n      800000,\n      getExtraData(amount),\n      {\n        gasLimit: 800000\n      }\n    ).then(tx => tx.wait())\n  }\n\n  pRes.then(res => {\n    console.log('res: ', res)\n    onSuccess(res);\n  }).catch(err => {\n    console.log('err:', err)\n    onError(err);\n  })\n\n\n\n} else {\n  const L2BlastBridge = '0x4300000000000000000000000000000000000005'\n\n  let pRes\n  let nonce, blockNumber\n  if (currency.isNative) {\n    const params = {\n      from: account,\n      to: L2BlastBridge,\n      value: rawAmount,\n    }\n\n    pRes = signer.sendTransaction(params).then(tx => {\n      console.log('tx:', tx)\n      nonce = tx.nonce\n      return tx.wait()\n    })\n  } else {\n    const L2BridgeContract = new ethers.Contract(\n      routerAddress,\n      L2BlastBridgeAbi,\n      signer\n    )\n\n    pRes = L2BridgeContract.bridgeERC20(\n      currency.address,\n      '0x6B175474E89094C44Da98b954EedeAC495271d0F',\n      rawAmount,\n      800000,\n      getExtraData(amount),\n      {\n        gasLimit: 800000\n      }\n    ).then(tx => tx.wait())\n  }\n\n  pRes.then(res => {\n    blockNumber = res.blockNumber\n    console.log('res', res)\n    Storage.privateSet(res.transactionHash, {\n      nonce,\n      blockNumber,\n    });\n    onSuccess(res);\n  }).catch(err => {\n    onError(err);\n  })\n\n}\n\n\nreturn \"\";", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/Blast.BridgeAuthority.HandlerSwap", "fact_widget_deployments_id": "2e550b0f61c53ca1d9d3d067fa06d7e3", "inserted_timestamp": "2024-04-24T14:41:50.718Z", "modified_timestamp": "2024-04-24T14:41:50.718Z", "__row_index": 1}