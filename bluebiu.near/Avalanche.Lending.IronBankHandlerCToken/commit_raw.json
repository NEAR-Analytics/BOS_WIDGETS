{"tx_hash": "HfZi1B8TV5bdTogMmno6i16yUdJA7ukpgxWyN83WDdig", "action_id_social": "DhkEC3zFHVmFABLkppv11ASM9UmcR3HeYE9DUfK5AdfG-0-widget", "block_id": 102380444, "block_timestamp": "2023-10-01T14:56:14.061Z", "signer_id": "bluebiu.near", "widget_name": "Avalanche.Lending.IronBankHandlerCToken", "source_code": "const CTOKEN_ABI = [\n  {\n    constant: false,\n    inputs: [{ internalType: \"uint256\", name: \"mintAmount\", type: \"uint256\" }],\n    name: \"mint\",\n    outputs: [{ internalType: \"uint256\", name: \"\", type: \"uint256\" }],\n    payable: false,\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      { internalType: \"uint256\", name: \"redeemAmount\", type: \"uint256\" },\n    ],\n    name: \"redeemUnderlying\",\n    outputs: [],\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      { internalType: \"uint256\", name: \"borrowAmount\", type: \"uint256\" },\n    ],\n    name: \"borrow\",\n    outputs: [],\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n  {\n    inputs: [{ internalType: \"uint256\", name: \"repayAmount\", type: \"uint256\" }],\n    name: \"repayBorrow\",\n    outputs: [],\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n  {\n    constant: false,\n    inputs: [],\n    name: \"mintNative\",\n    outputs: [{ internalType: \"uint256\", name: \"\", type: \"uint256\" }],\n    payable: true,\n    stateMutability: \"payable\",\n    type: \"function\",\n  },\n];\n\nconst { market, actionText, amount, loading, onSuccess, onError } = props;\n\nif (!loading) return \"\";\n\nconst CTokenContract = new ethers.Contract(\n  market.address,\n  CTOKEN_ABI,\n  Ethers.provider().getSigner()\n);\n\nif (actionText === \"Deposit\") {\n  if (market.underlyingToken.address === \"native\") {\n    CTokenContract.mintNative({\n      value: ethers.utils.parseUnits(amount, market.underlyingToken.decimals),\n    })\n      .then((tx) => {\n        tx.wait().then((res) => {\n          onSuccess(res);\n        });\n      })\n      .catch((err) => {\n        onError(err);\n      });\n  } else {\n    CTokenContract.mint(\n      ethers.utils.parseUnits(amount, market.underlyingToken.decimals)\n    )\n      .then((tx) => {\n        tx.wait().then((res) => {\n          onSuccess(res);\n        });\n      })\n      .catch((err) => {\n        onError(err);\n      });\n  }\n  return \"\";\n}\nif (actionText === \"Withdraw\") {\n  CTokenContract.redeemUnderlying(\n    ethers.utils.parseUnits(amount, market.underlyingToken.decimals)\n  )\n    .then((tx) => {\n      tx.wait().then((res) => {\n        onSuccess(res);\n      });\n    })\n    .catch((err) => {\n      onError();\n    });\n  return \"\";\n}\nif (actionText === \"Borrow\") {\n  CTokenContract.borrow(\n    ethers.utils.parseUnits(amount, market.underlyingToken.decimals)\n  )\n    .then((tx) => {\n      tx.wait().then((res) => {\n        onSuccess(res);\n      });\n    })\n    .catch((err) => {\n      console.log(err);\n      onError();\n    });\n  return \"\";\n}\nif (actionText === \"Repay\") {\n  CTokenContract.repayBorrow(\n    ethers.utils.parseUnits(amount, market.underlyingToken.decimals)\n  )\n    .then((tx) => {\n      tx.wait().then((res) => {\n        onSuccess(res);\n      });\n    })\n    .catch((err) => {\n      console.log(err);\n      onError();\n    });\n}\n\nreturn \"\";\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/Avalanche.Lending.IronBankHandlerCToken", "fact_widget_deployments_id": "d74b2062b7f735a921e8d849af090133", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 2}