{"tx_hash": "4fWsxstLVCdrRA5nQ8vKep6gLg4U9LAE3tTVawyjSQqj", "action_id_social": "GUGgvfJy4Rma2zdJipscQLZyZ49Uz3FixJMmCz3qGepQ-0-widget", "block_id": 104311232, "block_timestamp": "2023-10-27T11:20:56.986Z", "signer_id": "bluebiu.near", "widget_name": "Base.Bridge.Swap", "source_code": "const Flex = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n`;\nconst Chains = styled.div`\n  display: flex;\n  align-items: center;\n  margin-bottom: 20px;\n`;\nconst ChainWrapper = styled.div`\n  &:first-child {\n    width: 60%;\n  }\n  &:nth-child(2) {\n    width: 40%;\n  }\n`;\nconst Label = styled.div`\n  font-family: Gantari;\n  font-size: 18px;\n  font-weight: 500;\n  color: var(--label-color);\n`;\nconst ChainLogo = styled.img`\n  width: 44px;\n  height: 44px;\n  border-radius: 10px;\n`;\nconst ChainName = styled.div`\n  font-family: Gantari;\n  font-size: 18px;\n  font-weight: 500;\n  color: var(--chain-name-color);\n`;\nconst ExchangeIcon = styled.div`\n  color: var(--label-color);\n  transform: rotate(90deg);\n  margin-right: 30px;\n  margin-top: 20px;\n`;\nconst Chain = styled.div`\n  display: flex;\n  gap: 10px;\n  align-items: center;\n  margin-top: 20px;\n`;\nconst Receive = styled.div`\n  display: flex;\n  justify-content: space-between;\n  margin-top: 20px;\n`;\nconst AmountWrapper = styled.div`\n  display: flex;\n  flex-direction: column;\n  text-align: right;\n`;\nconst Amount = styled.div`\n  font-size: 18px;\n  font-weight: 500;\n  color: var(--chain-name-color);\n`;\nconst Value = styled.div`\n  font-size: 14px;\n  font-weight: 400;\n  color: var(--thirdary-text-color);\n`;\nconst Send = styled.div`\n  position: relative;\n`;\nconst ErrorTips = styled.div`\n  font-size: 16px;\n  font-weight: 400;\n  color: #ff61d3;\n`;\n\nconst {\n  chain,\n  mainnet,\n  tokens,\n  amountOutFn,\n  chainId,\n  handlerSwap,\n  handleStargateTx,\n  showNetwrokDialog,\n} = props;\nconst account = Ethers.send(\"eth_requestAccounts\", [])[0];\nconst reverseCurrency = (_currency) => {\n  const [_address, _decimals, _poolId] = [\n    _currency.address,\n    _currency.decimals,\n    _currency.poolId,\n  ];\n  _currency.address = _currency.targetAddress;\n  _currency.decimals = _currency.targetDecimals;\n  _currency.poolId = _currency.targetPoolId;\n  _currency.targetAddress = _address;\n  _currency.targetDecimals = _decimals;\n  _currency.targetPoolId = _poolId;\n\n  return _currency;\n};\n\nconst cached_chainId = Storage.privateGet(\"cached_chainId\");\nif (\n  (cached_chainId !== chainId || !state.from) &&\n  chainId !== -1 &&\n  [chain.id, mainnet.id].includes(chainId)\n) {\n  const chains = chainId === chain.id ? [chain, mainnet] : [mainnet, chain];\n  const cached_token = Storage.privateGet(\n    `cached_token_${chains[0].id}_${chains[1].id}`\n  );\n  const params = {\n    from: chains[0],\n    to: chains[1],\n    amount: \"1\",\n    currency:\n      chainId === mainnet.id\n        ? cached_token || reverseCurrency(tokens[0])\n        : cached_token || tokens[0],\n    updateInputTokenBalance: true,\n    loading: true,\n  };\n  Storage.privateSet(\"cached_chainId\", chainId);\n  if (chainId === mainnet.id) {\n    params.tokens = tokens.map((token) => reverseCurrency(token));\n  }\n  State.update(params);\n}\n\nconst getTrade = () => {\n  State.update({\n    loading: true,\n  });\n};\n\nfunction debounce(fn, wait) {\n  let timer;\n  return () => {\n    clearTimeout(timer);\n    timer = setTimeout(fn, wait);\n  };\n}\n\nconst checkGasIsEnough = () => {\n  if (!account) return;\n  const provider = Ethers.provider();\n  provider.getBalance(account).then((rawBalance) => {\n    const balance = ethers.utils.formatUnits(rawBalance._hex, 18);\n    const _balance = state.currency.isNative\n      ? Big(balance || 0).minus(state.amount || 0)\n      : Big(balance || 0);\n    State.update({ isGasEnough: !_balance.lt(state.gasCost || 0) });\n  });\n};\n\nconst debouncedGetTrade = debounce(getTrade, 500);\n\nreturn (\n  <>\n    <Chains\n      onClick={() => {\n        State.update({ displayCurrencySelect: false });\n      }}\n    >\n      <ChainWrapper>\n        <Label>Bridge from</Label>\n        <Flex>\n          <Chain>\n            {state.from.logo && <ChainLogo src={state.from.logo} />}\n            <ChainName>{state.from.name}</ChainName>\n          </Chain>\n          <ExchangeIcon\n            onClick={() => {\n              showNetwrokDialog(state.to.id);\n            }}\n          >\n            <Widget src=\"bluebiu.near/widget/Arbitrum.Swap.ExchangeIcon\" />\n          </ExchangeIcon>\n        </Flex>\n      </ChainWrapper>\n      <ChainWrapper>\n        <Label>To</Label>\n        <Chain>\n          {state.to.logo && <ChainLogo src={state.to.logo} />}\n          <ChainName>{state.to.name}</ChainName>\n        </Chain>\n      </ChainWrapper>\n    </Chains>\n    <Send>\n      <Label>Send</Label>\n      <Widget\n        src=\"bluebiu.near/widget/Base.Bridge.Input\"\n        props={{\n          currency: state.currency,\n          amount: state.amount,\n          updateTokenBalance: state.updateInputTokenBalance,\n          onCurrencySelectOpen: () => {\n            State.update({\n              displayCurrencySelect: true,\n              selectedTokenAddress: state.currency.address,\n            });\n          },\n          onUpdateCurrencyBalance: (balance) => {\n            State.update({\n              maxInputBalance: ethers.utils.formatUnits(\n                balance,\n                state.currency.decimals\n              ),\n              updateInputTokenBalance: false,\n            });\n          },\n          onGetPrice: (price) => {\n            State.update({\n              price,\n            });\n          },\n          onAmountChange: (val) => {\n            const params = {\n              amount: val,\n              loading: val && Number(val) && state.currency.address,\n            };\n            if (val && Number(val)) debouncedGetTrade();\n            params.errorTips = Big(val || 0).gt(state.maxInputBalance || 0)\n              ? \"Invalid amount! Amount should be less than token balance\"\n              : \"\";\n            State.update(params);\n            checkGasIsEnough();\n          },\n        }}\n      />\n      <ErrorTips>{state.errorTips}</ErrorTips>\n      <Widget\n        src=\"bluebiu.near/widget/Base.Bridge.TokenList\"\n        props={{\n          display: state.displayCurrencySelect,\n          selectedTokenAddress: state.selectedTokenAddress,\n          tokens: state.tokens || tokens || [],\n          onClose: () => {\n            State.update({\n              displayCurrencySelect: false,\n            });\n          },\n          onSelect: (currency) => {\n            State.update({\n              displayCurrencySelect: false,\n              currency,\n              updateInputTokenBalance: true,\n            });\n            Storage.privateSet(\n              `cached_token_${state.from.id}_${state.to.id}`,\n              currency\n            );\n          },\n        }}\n      />\n    </Send>\n    <Receive>\n      <Label>Receive</Label>\n      <AmountWrapper>\n        <Amount>\n          {state.received || \"-\"} {state.currency?.symbol}\n        </Amount>\n        <Value>\n          \u2248 $\n          <Widget\n            src=\"bluebiu.near/widget/Base.Bridge.Value\"\n            props={{\n              price: state.price,\n              amount: state.received,\n            }}\n          />\n        </Value>\n      </AmountWrapper>\n    </Receive>\n    <Widget\n      src=\"bluebiu.near/widget/Base.Bridge.Button\"\n      props={{\n        disabled: state.errorTips,\n        amount: state.amount,\n        maxInputBalance: state.maxInputBalance,\n        currency: state.currency,\n        target: {\n          dstId: state.to?.dstId,\n          address: state.currency?.targetAddress,\n          poolId: state.currency?.targetPoolId,\n        },\n        from: state.from,\n        gasCost: state.gasCost,\n        isGasEnough: state.isGasEnough,\n        handlerSwap,\n        onSuccess: (hash) => {\n          handleStargateTx({\n            hash,\n            amount: state.amount,\n            price: state.price,\n            from: state.from,\n            to: state.to,\n            currency: state.currency,\n          });\n        },\n      }}\n    />\n    <Widget\n      src={amountOutFn}\n      props={{\n        loading: state.loading,\n        amount: state.amount,\n        target: {\n          dstId: state.to?.dstId,\n          address: state.currency?.targetAddress,\n        },\n        routerAddress: state.from?.routerAddress,\n        onLoad: (data) => {\n          State.update({\n            loading: false,\n            ...data,\n          });\n          checkGasIsEnough();\n        },\n      }}\n    />\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/Base.Bridge.Swap", "fact_widget_deployments_id": "61af40223428fbf54461b379c3f9d4b8", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}