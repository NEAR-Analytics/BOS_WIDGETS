{"tx_hash": "7gAqj4WfNFSDTMEo8oPYQ9jAMnjihJz99e86bSwHRaKc", "action_id_social": "AUx97ibfJGRPZm44LWTFdDwXBN1rsPvgDJrXaFKbV7dG-0-widget", "block_id": 104076839, "block_timestamp": "2023-10-24T03:55:59.726Z", "signer_id": "bluebiu.near", "widget_name": "Avalanche.Lending.BenqiHandlerCToken", "source_code": "const CTOKEN_ABI = [\n  {\n    constant: false,\n    inputs: [{ internalType: \"uint256\", name: \"mintAmount\", type: \"uint256\" }],\n    name: \"mint\",\n    outputs: [{ internalType: \"uint256\", name: \"\", type: \"uint256\" }],\n    payable: false,\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      { internalType: \"uint256\", name: \"redeemAmount\", type: \"uint256\" },\n    ],\n    name: \"redeemUnderlying\",\n    outputs: [],\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      { internalType: \"uint256\", name: \"borrowAmount\", type: \"uint256\" },\n    ],\n    name: \"borrow\",\n    outputs: [],\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n  {\n    inputs: [{ internalType: \"uint256\", name: \"repayAmount\", type: \"uint256\" }],\n    name: \"repayBorrow\",\n    outputs: [],\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n];\n\nconst { market, actionText, amount, loading, onSuccess, onError } = props;\nif (!loading) return \"\";\n\nconst CNativeTokenContract = new ethers.Contract(\n  market.address,\n  [\n    {\n      inputs: [],\n      name: \"mint\",\n      outputs: [],\n      stateMutability: \"payable\",\n      type: \"function\",\n    },\n  ],\n  Ethers.provider().getSigner()\n);\n\nconst CTokenContract = new ethers.Contract(\n  market.address,\n  CTOKEN_ABI,\n  Ethers.provider().getSigner()\n);\n\nif (actionText === \"Deposit\") {\n  if (market.underlyingToken.address === \"native\") {\n    CNativeTokenContract.mint({\n      value: ethers.utils.parseUnits(amount, market.underlyingToken.decimals),\n    })\n      .then((tx) => {\n        tx.wait().then((res) => {\n          onSuccess(res);\n        });\n      })\n      .catch((err) => {\n        onError(err);\n      });\n  } else {\n    CTokenContract.mint(\n      ethers.utils.parseUnits(amount, market.underlyingToken.decimals)\n    )\n      .then((tx) => {\n        tx.wait().then((res) => {\n          onSuccess(res);\n        });\n      })\n      .catch((err) => {\n        onError(err);\n      });\n  }\n  return \"\";\n}\nif (actionText === \"Withdraw\") {\n  CTokenContract.redeemUnderlying(\n    ethers.utils.parseUnits(amount, market.underlyingToken.decimals)\n  )\n    .then((tx) => {\n      tx.wait().then((res) => {\n        onSuccess(res);\n      });\n    })\n    .catch((err) => {\n      onError();\n    });\n  return \"\";\n}\nif (actionText === \"Borrow\") {\n  CTokenContract.borrow(\n    ethers.utils.parseUnits(amount, market.underlyingToken.decimals)\n  )\n    .then((tx) => {\n      tx.wait().then((res) => {\n        onSuccess(res);\n      });\n    })\n    .catch((err) => {\n      console.log(err);\n      onError();\n    });\n  return \"\";\n}\nif (actionText === \"Repay\") {\n  CTokenContract.repayBorrow(\n    ethers.utils.parseUnits(amount, market.underlyingToken.decimals)\n  )\n    .then((tx) => {\n      tx.wait().then((res) => {\n        onSuccess(res);\n      });\n    })\n    .catch((err) => {\n      console.log(err);\n      onError();\n    });\n}\n\nreturn \"\";\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/Avalanche.Lending.BenqiHandlerCToken", "fact_widget_deployments_id": "f60815c63ad7b5ffc84a472490196a88", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}