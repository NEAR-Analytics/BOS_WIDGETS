{"tx_hash": "2DpnndcPJ6jXwJBwF76CRteiTXZqKbdz3JNb52hiQ3eP", "action_id_social": "GEdpDoqfY5zoDBgoisDv1HDBE9hMrTLKmQkEdXbeMS3J-0-widget", "block_id": 111687897, "block_timestamp": "2024-01-30T12:04:14.798Z", "signer_id": "bluebiu.near", "widget_name": "Lending.LiquityContent", "source_code": "const StyledContainer = styled.div`\n  padding-top: 18px;\n`;\n\nconst {\n  dexConfig,\n  wethAddress,\n  multicallAddress,\n  chainIdNotSupport,\n  multicall,\n  prices,\n  account,\n  addAction,\n  toast,\n  chainId,\n  nativeCurrency,\n  tab,\n} = props;\n\nState.init({\n  newMarkets: {},\n});\n\nconst { markets } = dexConfig;\nconst getWalletBalance = () => {\n  if (!markets) return;\n  let nativeOToken = \"\";\n  const underlyingTokens = Object.values(markets)\n    .filter((market) => {\n      if (market.underlyingToken.address === \"native\")\n        nativeOToken = wethAddress;\n      return (\n        market.underlyingToken.address &&\n        market.underlyingToken.address !== \"native\"\n      );\n    })\n    .map((market) => ({\n      ...market.underlyingToken,\n    }));\n  const calls = underlyingTokens.map((token) => ({\n    address: token.address,\n    name: \"balanceOf\",\n    params: [account],\n  }));\n\n  multicall({\n    abi: [\n      {\n        constant: true,\n        inputs: [\n          {\n            name: \"_owner\",\n            type: \"address\",\n          },\n        ],\n        name: \"balanceOf\",\n        outputs: [\n          {\n            name: \"balance\",\n            type: \"uint256\",\n          },\n        ],\n        payable: false,\n        stateMutability: \"view\",\n        type: \"function\",\n      },\n    ],\n    calls,\n    options: {},\n    multicallAddress,\n    provider: Ethers.provider(),\n  })\n    .then((res) => {\n      console.log(5555, res);\n      for (let i = 0, len = res.length; i < len; i++) {\n        markets[underlyingTokens[i].address].userUnderlyingBalance = res[i][0]\n          ? ethers.utils.formatUnits(\n              res[i][0]._hex,\n              underlyingTokens[i].decimals\n            )\n          : \"0\";\n      }\n\n      if (nativeOToken) {\n        const provider = Ethers.provider();\n        provider.getBalance(account).then((rawBalance) => {\n          markets[nativeOToken].userUnderlyingBalance =\n            ethers.utils.formatUnits(rawBalance._hex, 18);\n\n          // count++;\n          // formatedData(\"getWalletBalance\");\n        });\n      } else {\n        // count++;\n        // formatedData(\"getWalletBalance\");\n      }\n      console.log(6666, markets);\n      State.update({\n        newMarkets: markets,\n      });\n    })\n    .catch((err) => {\n      console.log(\"getWalletBalance error\", err);\n    });\n};\nuseEffect(() => {\n  State.update({\n    loading: !chainIdNotSupport,\n  });\n}, []);\nuseEffect(() => {\n  getWalletBalance();\n}, [dexConfig]);\n// const handleTableButtonClick = (address, actionText) => {\n//   const market = state.markets[address];\n//   const dapp = {\n//     userTotalSupplyUsd: state.userTotalSupplyUsd,\n//     userTotalBorrowUsd: state.userTotalBorrowUsd,\n//     totalCollateralUsd: state.totalCollateralUsd,\n//     rewards: state.rewards,\n//     dappIcon: dexConfig.icon,\n//     dappName: dexConfig.name,\n//   };\n\n//   State.update({\n//     tableButtonClickData: {\n//       ...dapp,\n//       ...market,\n//       config: { ...dexConfig, wethAddress },\n//       actionText,\n//     },\n//     showDialog: true,\n//   });\n// };\n\nreturn (\n  <StyledContainer>\n    {tab === \"market\" && (\n      <Widget\n        src=\"bluebiu.near/widget/Lending.LiquityMarkets\"\n        props={{\n          markets: state.markets,\n          totalCollateralUsd: state.totalCollateralUsd,\n          userTotalBorrowUsd: state.userTotalBorrowUsd,\n          addAction,\n          toast,\n          chainId,\n          nativeCurrency,\n          dexConfig: {\n            ...dexConfig,\n            markets: state.newMarkets,\n          },\n          account,\n          prices,\n          onSuccess: () => {\n            State.update({\n              loading: true,\n            });\n          },\n        }}\n      />\n    )}\n    {tab === \"yours\" && (\n      <Widget\n        src=\"bluebiu.near/widget/Lending.LiquityYours\"\n        props={{\n          ...props,\n          dexConfig: {\n            ...dexConfig,\n            markets: state.newMarkets,\n          },\n          // currentDapp: dexConfig.name,\n          // markets: state.markets,\n          // timestamp: state.timestamp,\n          // dapps: {\n          //   [dexConfig.name]: {\n          //     userTotalSupplyUsd: state.userTotalSupplyUsd,\n          //     userTotalBorrowUsd: state.userTotalBorrowUsd,\n          //     totalCollateralUsd: state.totalCollateralUsd,\n          //     rewards: state.rewards,\n          //     dappIcon: dexConfig.icon,\n          //     dappName: dexConfig.name,\n          //   },\n          // },\n          // dappsConfig: {\n          //   [dexConfig.name]: dexConfig,\n          // },\n          // toast,\n          // onButtonClick: handleTableButtonClick,\n          onSuccess: () => {\n            State.update({\n              loading: true,\n            });\n          },\n        }}\n      />\n    )}\n    {/* <Widget\n      src={dexConfig.data}\n      props={{\n        update: state.loading,\n        account,\n        wethAddress,\n        multicallAddress,\n        multicall,\n        prices,\n        ...dexConfig,\n        onLoad: (data) => {\n          console.log(\"data=================\", data);\n          State.update({\n            loading: false,\n            timestamp: Date.now(),\n            ...data,\n          });\n        },\n      }}\n    /> */}\n    {/* <Widget\n      src=\"bluebiu.near/widget/Avalanche.Lending.Dialog\"\n      props={{\n        display: state.showDialog,\n        data: state.tableButtonClickData,\n        chainId,\n        addAction,\n        toast,\n        source: \"dapp\",\n        onClose: () => {\n          State.update({\n            showDialog: false,\n          });\n        },\n        onSuccess: () => {\n          State.update({\n            loading: true,\n          });\n        },\n      }}\n    /> */}\n  </StyledContainer>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/Lending.LiquityContent", "fact_widget_deployments_id": "714ac62efa182585fb5ce5aea1f74a27", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}