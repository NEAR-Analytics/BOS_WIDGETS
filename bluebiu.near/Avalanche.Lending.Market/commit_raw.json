{"tx_hash": "DaNiij8XQE1rLQgkCCeyfr8PCj1hDyQp74ucYRqZMn2Z", "action_id_social": "DdBdNZbeTrVUNp2DvrRZobUuo6AVmpZxR3QzFy9Wrxnv-0-widget", "block_id": 114629452, "block_timestamp": "2024-03-13T12:57:55.307Z", "signer_id": "bluebiu.near", "widget_name": "Avalanche.Lending.Market", "source_code": "const Market = styled.div`\n  width: 100%;\n`;\nconst MarketTableHeader = styled.div`\n  display: flex;\n  align-items: center;\n  font-size: 14px;\n  font-weight: 500;\n  gap: 4px;\n  padding-left: 20px;\n  height: 38px;\n`;\nconst Item = styled.div`\n  display: flex;\n  gap: 6px;\n  align-items: center;\n  justify-content: center;\n  color: #fff;\n  flex-grow: 1;\n  height: 100%;\n  &.td {\n    min-height: 52px;\n  }\n  &.asset {\n    width: 20%;\n    color: #7c7f96;\n    justify-content: left;\n    flex-grow: 0;\n  }\n  &.head_apy {\n    justify-content: flex-start;\n  }\n  &.apy {\n    flex-direction: column;\n    align-items: flex-start;\n    padding: 6px 0px;\n  }\n  &.w_60 {\n    width: 60%;\n  }\n  &.w_40 {\n    width: 40%;\n  }\n  &.w_33 {\n    width: 33.33333333%;\n  }\n`;\nconst RewardApyItem = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 4px;\n`;\nconst RewardIcon = styled.img`\n  width: 14px;\n  height: 14px;\n`;\nconst RewardApy = styled.div`\n  font-weight: 400;\n  line-height: 14px;\n  color: rgba(255, 255, 255, 0.5);\n`;\nconst MergeItems = styled.div`\n  display: flex;\n  align-items: center;\n  border-radius: 6px;\n  height: 100%;\n  &.supply {\n    width: 32%;\n  }\n  &.header-supply {\n    background-color: var(--supply-bg-color);\n  }\n  &.body-supply {\n    cursor: pointer;\n    &:hover {\n      background-color: var(--supply-bg-color);\n    }\n  }\n  &.borrow {\n    width: 48%;\n  }\n  &.header-borrow {\n    background-color: var(--borrow-bg-color);\n  }\n  &.body-borrow {\n    cursor: pointer;\n    &:hover {\n      background-color: var(--borrow-bg-color);\n    }\n  }\n`;\nconst ArrowIconWrapper = styled.div`\n  opacity: 0.3;\n  cursor: pointer;\n  transform: rotate(90deg);\n  &.active {\n    opacity: 1;\n  }\n`;\nconst Row = styled.div`\n  margin-top: 4px;\n  display: flex;\n  align-items: center;\n  font-size: 14px;\n  font-weight: 500;\n  gap: 4px;\n  background-color: rgba(53, 55, 73, 0.2);\n  border-radius: 6px;\n  padding-left: 20px;\n`;\n\nState.init({\n  sortKey: \"supplyApy\",\n});\n\nconst { currentDapp, markets, dapps, onButtonClick, account } = props;\n\nconst formateData = (sortKey) => {\n  const marketsToList = Object.values(markets);\n  const data = marketsToList\n    .filter((market) => currentDapp === \"All\" || market.dapp === currentDapp)\n    .map((market) => {\n      const dapp = dapps[market.dapp];\n      return {\n        icon: market.underlyingToken.icon,\n        symbol: market.underlyingToken.symbol,\n        dappIcon: dapp.dappIcon,\n        dappName: dapp.dappName,\n        totalSupply: Big(market.totalSupply)\n          .mul(market.underlyingPrice)\n          .toString(),\n        supplyApy: market.supplyApy,\n        totalBorrows: Big(market.totalBorrows)\n          .mul(market.underlyingPrice)\n          .toString(),\n        borrowApy: market.borrowApy,\n        liquidity: Big(market.liquidity).mul(market.underlyingPrice).toString(),\n        address: market.address,\n        distributionApy: market.distributionApy,\n      };\n    });\n  State.update({\n    data: data.sort((a, b) => {\n      if ([\"supplyApy\", \"borrowApy\"].includes(sortKey)) {\n        return b[sortKey].slice(0, -1) - a[sortKey].slice(0, -1);\n      }\n      return b[sortKey] - a[sortKey];\n    }),\n  });\n};\n\nconst prevMarketTimestamp = Storage.privateGet(\"prevMarketTimestampMarket\");\n\nif (prevMarketTimestamp !== props.timestamp) {\n  if (markets) {\n    formateData(state.sortKey);\n    Storage.privateSet(\"prevMarketTimestampMarket\", props.timestamp);\n  }\n}\n\nreturn (\n  <Market>\n    <MarketTableHeader>\n      <Item className=\"asset\">Asset</Item>\n      <MergeItems className=\"supply header-supply\">\n        <Item className=\"w_60\">Deposit</Item>\n        <Item className=\"w_40 head_apy\">\n          Deposit APY\n          <ArrowIconWrapper\n            className={state.sortKey === \"supplyApy\" && \"active\"}\n            onClick={() => {\n              State.update({\n                sortKey: \"supplyApy\",\n              });\n              formateData(\"supplyApy\");\n            }}\n          >\n            <Widget\n              src=\"bluebiu.near/widget/0vix.LendingArrowIcon\"\n              props={{ color: \"#fff\" }}\n            />\n          </ArrowIconWrapper>\n        </Item>\n      </MergeItems>\n      <MergeItems className=\"borrow header-borrow\">\n        <Item className=\"w_33\">Borrowed</Item>\n        <Item className=\"w_33 head_apy\">\n          Borrow APY\n          <ArrowIconWrapper\n            className={state.sortKey === \"borrowApy\" && \"active\"}\n            onClick={() => {\n              State.update({\n                sortKey: \"borrowApy\",\n              });\n              formateData(\"borrowApy\");\n            }}\n          >\n            <Widget\n              src=\"bluebiu.near/widget/0vix.LendingArrowIcon\"\n              props={{ color: \"#fff\" }}\n            />\n          </ArrowIconWrapper>\n        </Item>\n        <Item className=\"w_33\">\n          Market Size\n          <ArrowIconWrapper\n            className={state.sortKey === \"liquidity\" && \"active\"}\n            onClick={() => {\n              State.update({\n                sortKey: \"liquidity\",\n              });\n              formateData(\"liquidity\");\n            }}\n          >\n            <Widget\n              src=\"bluebiu.near/widget/0vix.LendingArrowIcon\"\n              props={{ color: \"#fff\" }}\n            />\n          </ArrowIconWrapper>\n        </Item>\n      </MergeItems>\n    </MarketTableHeader>\n    {(state.data || []).map((market) => (\n      <Row key={market.address}>\n        <Item className=\"td asset\">\n          <Widget\n            src=\"bluebiu.near/widget/Avalanche.Lending.Asset\"\n            props={{\n              icon: market.icon,\n              symbol: market.symbol,\n              dappIcon: market.dappIcon,\n              dappName: market.dappName,\n            }}\n          />\n        </Item>\n        <MergeItems\n          className=\"supply body-supply\"\n          onClick={() => {\n            onButtonClick(market.address, \"Deposit\");\n          }}\n        >\n          <Item className=\"td w_60\">\n            <Widget\n              src=\"bluebiu.near/widget/Avalanche.Lending.Total\"\n              props={{\n                total: market.totalSupply,\n                digit: 2,\n                unit: \"$\",\n              }}\n            />\n          </Item>\n          <Item className=\"td w_40 apy\">\n            <div>{market.supplyApy}</div>\n            {market.distributionApy &&\n              market.distributionApy\n                .filter((reward) => {\n                  const apy = reward.supply.slice(0, -1);\n                  return !!Number(apy);\n                })\n                .map((reward) => (\n                  <RewardApyItem key={reward.symbol}>\n                    <RewardIcon src={reward.icon} />\n                    <RewardApy>{reward.supply}</RewardApy>\n                  </RewardApyItem>\n                ))}\n          </Item>\n        </MergeItems>\n        <MergeItems\n          className=\"borrow body-borrow\"\n          onClick={() => {\n            onButtonClick(market.address, \"Borrow\");\n          }}\n        >\n          <Item className=\"td w_33\">\n            <Widget\n              src=\"bluebiu.near/widget/Avalanche.Lending.Total\"\n              props={{\n                total: market.totalBorrows,\n                digit: 2,\n                unit: \"$\",\n              }}\n            />\n          </Item>\n          <Item className=\"td w_33 apy\">\n            <div>{market.borrowApy}</div>\n            {market.distributionApy &&\n              market.distributionApy\n                .filter((reward) => {\n                  const apy = reward.borrow.slice(0, -1);\n                  return !!Number(apy);\n                })\n                .map((reward) => (\n                  <RewardApyItem key={reward.symbol}>\n                    <RewardIcon src={reward.icon} />\n                    <RewardApy>{reward.borrow}</RewardApy>\n                  </RewardApyItem>\n                ))}\n          </Item>\n          <Item className=\"td w_33\">\n            <Widget\n              src=\"bluebiu.near/widget/Avalanche.Lending.Total\"\n              props={{\n                total: market.liquidity,\n                digit: 2,\n                unit: \"$\",\n              }}\n            />\n          </Item>\n        </MergeItems>\n      </Row>\n    ))}\n  </Market>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/Avalanche.Lending.Market", "fact_widget_deployments_id": "c1420b0cd51b7a246ce355479f1705a4", "inserted_timestamp": "2024-03-13T14:28:53.036Z", "modified_timestamp": "2024-03-13T14:28:53.036Z", "__row_index": 0}