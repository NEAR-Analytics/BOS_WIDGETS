{"tx_hash": "8sBhuBLVdW2df3UnGFsEPmLECfz6Y2fYA6vwSMwiQ61c", "action_id_social": "B4s1N6xvVSXTR4k3hBAfrUo6EjiRszdf9Pt7DZYxTbig-0-widget", "block_id": 116616458, "block_timestamp": "2024-04-11T14:57:15.212Z", "signer_id": "bluebiu.near", "widget_name": "Lending.CompoundV3.CheckAllowance", "source_code": "const { account, spender, token, toast, onLoad } = props;\n\nconst checkAllowance = (amount, cb) => {\n  const TokenContract = new ethers.Contract(\n    token.address,\n    [\n      {\n        constant: true,\n        inputs: [\n          {\n            name: \"_owner\",\n            type: \"address\",\n          },\n          {\n            name: \"_spender\",\n            type: \"address\",\n          },\n        ],\n        name: \"allowance\",\n        outputs: [\n          {\n            name: \"\",\n            type: \"uint256\",\n          },\n        ],\n        payable: false,\n        stateMutability: \"view\",\n        type: \"function\",\n      },\n    ],\n    Ethers.provider().getSigner()\n  );\n  TokenContract.allowance(account, spender).then((allowanceRaw) => {\n    cb(\n      !allowanceRaw.lt(Big(amount).mul(Big(10).pow(token.decimals)).toFixed(0))\n    );\n  });\n};\n\nconst handleApprove = (amount, onSuccess, onError) => {\n  const toastId = toast?.loading({\n    title: `Approve ${amount} ${token.symbol}`,\n  });\n\n  const TokenContract = new ethers.Contract(\n    token.address,\n    [\n      {\n        constant: false,\n        inputs: [\n          {\n            name: \"_spender\",\n            type: \"address\",\n          },\n          {\n            name: \"_value\",\n            type: \"uint256\",\n          },\n        ],\n        name: \"approve\",\n        outputs: [\n          {\n            name: \"\",\n            type: \"bool\",\n          },\n        ],\n        payable: false,\n        stateMutability: \"nonpayable\",\n        type: \"function\",\n      },\n    ],\n    Ethers.provider().getSigner()\n  );\n  TokenContract.approve(\n    spender,\n    ethers.utils.parseUnits(\n      Big(amount).toFixed(token.decimals).toString(),\n      token.decimals\n    )\n  )\n    .then((tx) => {\n      tx.wait().then((res) => {\n        const { status, transactionHash } = res;\n        toast?.dismiss(toastId);\n        if (status !== 1) throw new Error(\"\");\n        onSuccess();\n        toast?.success({\n          title: \"Approve Successfully!\",\n          text: `Approved ${amount} ${token.symbol}`,\n          tx: transactionHash,\n          chainId,\n        });\n        onApprovedSuccess();\n      });\n    })\n    .catch((err) => {\n      onError();\n      toast?.dismiss(toastId);\n      toast?.fail({\n        title: \"Approve Failed!\",\n        text: err?.message?.includes(\"user rejected transaction\")\n          ? \"User rejected transaction\"\n          : `Approved ${amount} ${token.symbol}`,\n      });\n    });\n};\n\nuseEffect(() => {\n  onLoad({\n    checkAllowance,\n    handleApprove,\n  });\n}, []);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/Lending.CompoundV3.CheckAllowance", "fact_widget_deployments_id": "37a1336a5a62f3ca8dd1fb1db0d1c1c8", "inserted_timestamp": "2024-04-11T16:49:18.947Z", "modified_timestamp": "2024-04-11T16:49:18.947Z", "__row_index": 0}