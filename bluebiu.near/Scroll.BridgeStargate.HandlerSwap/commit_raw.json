{"tx_hash": "5fzuaPY6Edo6ap7aQoCneU8tUx7BmydwaM3g8LoER14a", "action_id_social": "44863QvkddTXs2u1H38TyQr57qs5Q4bgpcYbiHJqsHuy-0-widget", "block_id": 116610422, "block_timestamp": "2024-04-11T12:48:58.220Z", "signer_id": "bluebiu.near", "widget_name": "Scroll.BridgeStargate.HandlerSwap", "source_code": "const {\n  amount,\n  account,\n  currency,\n  routerAddress,\n  routerEthAddress,\n  target,\n  loading,\n  onSuccess,\n  onError,\n} = props;\nif (!loading) return \"\";\n\nconst chainIds = {\n  1: 101,\n  534352: 214\n}\n\nlet RouterContract\nlet method\nif (target.dstId === 1) {\n  RouterContract = new ethers.Contract(\n    routerAddress,\n    [\n      {\n        \"inputs\": [\n          {\n            \"internalType\": \"address\",\n            \"name\": \"_oft\",\n            \"type\": \"address\"\n          },\n          {\n            \"internalType\": \"uint16\",\n            \"name\": \"_dstChainId\",\n            \"type\": \"uint16\"\n          },\n          {\n            \"internalType\": \"bytes32\",\n            \"name\": \"_toAddress\",\n            \"type\": \"bytes32\"\n          },\n          {\n            \"internalType\": \"uint256\",\n            \"name\": \"_amount\",\n            \"type\": \"uint256\"\n          },\n          {\n            \"internalType\": \"uint256\",\n            \"name\": \"_minAmount\",\n            \"type\": \"uint256\"\n          },\n          {\n            \"components\": [\n              {\n                \"internalType\": \"address payable\",\n                \"name\": \"refundAddress\",\n                \"type\": \"address\"\n              },\n              {\n                \"internalType\": \"address\",\n                \"name\": \"zroPaymentAddress\",\n                \"type\": \"address\"\n              },\n              {\n                \"internalType\": \"bytes\",\n                \"name\": \"adapterParams\",\n                \"type\": \"bytes\"\n              }\n            ],\n            \"internalType\": \"struct ICommonOFT.LzCallParams\",\n            \"name\": \"_callParams\",\n            \"type\": \"tuple\"\n          },\n          {\n            \"components\": [\n              {\n                \"internalType\": \"uint256\",\n                \"name\": \"callerBps\",\n                \"type\": \"uint256\"\n              },\n              {\n                \"internalType\": \"address\",\n                \"name\": \"caller\",\n                \"type\": \"address\"\n              },\n              {\n                \"internalType\": \"bytes2\",\n                \"name\": \"partnerId\",\n                \"type\": \"bytes2\"\n              }\n            ],\n            \"internalType\": \"struct IOFTWrapper.FeeObj\",\n            \"name\": \"_feeObj\",\n            \"type\": \"tuple\"\n          }\n        ],\n        \"name\": \"sendOFTV2\",\n        \"outputs\": [],\n        \"stateMutability\": \"payable\",\n        \"type\": \"function\"\n      },\n    ],\n    Ethers.provider().getSigner()\n  );\n\n  method = 'sendOFTV2'\n} else {\n  RouterEthContract = new ethers.Contract(\n    routerAddress,\n    [\n      {\n        \"inputs\": [\n          {\n            \"internalType\": \"address\",\n            \"name\": \"_proxyOft\",\n            \"type\": \"address\"\n          },\n          {\n            \"internalType\": \"uint16\",\n            \"name\": \"_dstChainId\",\n            \"type\": \"uint16\"\n          },\n          {\n            \"internalType\": \"bytes32\",\n            \"name\": \"_toAddress\",\n            \"type\": \"bytes32\"\n          },\n          {\n            \"internalType\": \"uint256\",\n            \"name\": \"_amount\",\n            \"type\": \"uint256\"\n          },\n          {\n            \"internalType\": \"uint256\",\n            \"name\": \"_minAmount\",\n            \"type\": \"uint256\"\n          },\n          {\n            \"components\": [\n              {\n                \"internalType\": \"address payable\",\n                \"name\": \"refundAddress\",\n                \"type\": \"address\"\n              },\n              {\n                \"internalType\": \"address\",\n                \"name\": \"zroPaymentAddress\",\n                \"type\": \"address\"\n              },\n              {\n                \"internalType\": \"bytes\",\n                \"name\": \"adapterParams\",\n                \"type\": \"bytes\"\n              }\n            ],\n            \"internalType\": \"struct ICommonOFT.LzCallParams\",\n            \"name\": \"_callParams\",\n            \"type\": \"tuple\"\n          },\n          {\n            \"components\": [\n              {\n                \"internalType\": \"uint256\",\n                \"name\": \"callerBps\",\n                \"type\": \"uint256\"\n              },\n              {\n                \"internalType\": \"address\",\n                \"name\": \"caller\",\n                \"type\": \"address\"\n              },\n              {\n                \"internalType\": \"bytes2\",\n                \"name\": \"partnerId\",\n                \"type\": \"bytes2\"\n              }\n            ],\n            \"internalType\": \"struct IOFTWrapper.FeeObj\",\n            \"name\": \"_feeObj\",\n            \"type\": \"tuple\"\n          }\n        ],\n        \"name\": \"sendProxyOFTV2\",\n        \"outputs\": [],\n        \"stateMutability\": \"payable\",\n        \"type\": \"function\"\n      },\n    ],\n    Ethers.provider().getSigner()\n  );\n  method = 'sendProxyOFTV2'\n}\n\nconst minAmount = ethers.utils.parseUnits(\n  Big(amount || 0)\n    .mul(0.995)\n    .toFixed(currency.decimals),\n  currency.decimals\n);\n\nconst _amount = ethers.utils.parseUnits(\n  Big(amount || 0)\n    .toFixed(currency.decimals),\n  currency.decimals\n);\n\nconst toAddressBytes = ethers.utils.defaultAbiCoder.encode(['address'], [account])\nconst adapterParams = ethers.utils.solidityPack([\"uint16\", \"uint256\"], [1, 999999999999999])\n\nRouterContract[method](\n  currency.address,\n  chainIds[target.dstId],\n  toAddressBytes,\n  _amount.toString(),\n  '0',\n  {\n    refundAddress: account,\n    zroPaymentAddress: '0x0000000000000000000000000000000000000000',\n    adapterParams,\n  },\n  {\n    caller: \"0x0000000000000000000000000000000000000000\",\n    callerBps: 0,\n    partnerId: \"0x0000\",\n  },\n  {\n    gasLimit: 100000,\n    // nonce: nonce || undefined,\n  }\n).then((tx) => {\n  tx.wait()\n    .then((res) => {\n      onSuccess(res);\n    })\n    .catch((err) => {\n      onError(tx);\n    });\n})\n  .catch((err) => {\n    console.log('err: ', err)\n    onError(err);\n  });\n\n\nreturn \"\";\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/Scroll.BridgeStargate.HandlerSwap", "fact_widget_deployments_id": "81e9afa3c74920f6203c9709f1640401", "inserted_timestamp": "2024-04-11T14:43:07.705Z", "modified_timestamp": "2024-04-11T14:43:07.705Z", "__row_index": 0}