{"tx_hash": "CX4rXxPhYK1L66FTokof1tfKtyYEEPS3kuDAP4dSzyQd", "action_id_social": "2DGY69EhvTbKUPJTULTAZevtoQ9nYkuujqtHqURtY581-0-widget", "block_id": 119618915, "block_timestamp": "2024-05-24T07:03:35.065Z", "signer_id": "bluebiu.near", "widget_name": "Liquidity.Connector.METAVAULT", "source_code": "\nconst {\n  Column,\n  Row,\n  StyledVaultImage,\n  SvgIcon,\n  StyledDashedUndeline,\n  TdTxt,\n  PoolPercentage,\n  StrategyTxt,\n  TitleText,\n  ContainerLogin,\n} = VM.require('bluebiu.near/widget/Liquidity.Handler.Styles')\n\nState.init({\n  allData: null,\n  loading: false,\n  dataList: [],\n  filterList: [],\n  dataIndex: -1,\n  categoryIndex: 0,\n  chainIndex: 0,\n  token: '',\n})\nconst IconRight = (\n  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"8\" height=\"10\" viewBox=\"0 0 8 10\" fill=\"none\">\n    <path d=\"M7.18407 4.21913C7.68448 4.61945 7.68448 5.38054 7.18407 5.78087L2.28485 9.70024C1.63009 10.2241 0.660156 9.75788 0.660156 8.91937L0.660156 1.08062C0.660156 0.242118 1.63009 -0.224055 2.28485 0.299756L7.18407 4.21913Z\" fill=\"#979ABE\" />\n  </svg>\n)\nconst {\n  toast,\n  CHAIN_LIST,\n  multicallAddress,\n  dexConfig,\n  curChain,\n  isChainSupported,\n  onSwitchChain,\n  addAction,\n  connectProps,\n  prices,\n} = props\n\nconst formatFiat = (value) => {\n  const number = Number(value).toLocaleString(\"en\", {\n    currency: \"USD\",\n    style: \"currency\",\n    compactDisplay: \"short\",\n    notation: \"compact\",\n    maximumFractionDigits: 2,\n  });\n  return number;\n};\n\nconst formatPercent = (value) => {\n  return `${Number(value * 100).toLocaleString(\"en\", {\n    maximumFractionDigits: 2,\n  })}%`;\n};\n\nconst sender = Ethers.send(\"eth_requestAccounts\", [])[0];\nif (!sender || !isChainSupported) {\n  return (\n    <Widget\n      src=\"bluebiu.near/widget/Swap.ChainWarnigBox\"\n      props={{\n        chain: curChain,\n        onSwitchChain: onSwitchChain,\n        switchingChain: switchingChain,\n        theme: dexConfig.theme?.button,\n      }}\n    />\n  );\n}\n\nconst {\n  pairs,\n  addresses,\n  storeAddress,\n  ICON_VAULT_MAP,\n} = dexConfig\nfunction handleChangeDataIndex(index) {\n  state.dataIndex === index ? State.update({\n    dataIndex: -1\n  }) : State.update({\n    dataIndex: index\n  })\n}\nfunction handleChangeCategoryIndex(index) {\n  State.update({\n    categoryIndex: index\n  })\n}\nfunction handleChangeChainIndex(index) {\n  const chain = CHAIN_LIST[index]\n  onSwitchChain({\n    chainId: `0x${Number(chain.chain_id).toString(16)}`,\n  });\n}\nfunction handleSearchInput(event) {\n  State.update({\n    token: event.target.value\n  })\n}\nfunction refetch() {\n  // fetchAllData()\n  State.update({\n    loading: true\n  })\n  setTimeout(() => {\n    State.update({\n      loading: false\n    })\n  }, 500)\n}\n\nuseEffect(() => {\n  if (state.dataList) {\n    let filterList = []\n    if (state.categoryIndex === 0) {\n      filterList = state.dataList.filter(data => {\n        const source = data.id.toUpperCase()\n        const target = (state.token || '').toUpperCase()\n        return source.indexOf(target) > -1\n      })\n    } else if (state.categoryIndex === 1) {\n      state.dataList.forEach(data => {\n        if (Big(data?.myBalance ?? 0).gt(0)) {\n          filterList.push(data)\n        }\n      })\n    }\n    State.update({\n      filterList\n    })\n  }\n}, [state.dataList, state.token, state.categoryIndex])\n\nconst columnList = [{\n  width: '25%',\n  key: 'pool',\n  label: 'Pool',\n  type: 'slot',\n  render: (data) => {\n    return (\n      <>\n        <StyledVaultImage>\n          <img src={ICON_VAULT_MAP[data.token]} alt={data.token} />\n        </StyledVaultImage>\n        <TdTxt>{data.token}</TdTxt>\n        {/* <PoolPercentage>{data?.initialData?.feeTier}%</PoolPercentage> */}\n      </>\n    )\n  }\n}, {\n  width: '15%',\n  key: 'chain',\n  label: 'Chain',\n  type: 'slot',\n  render: () => <img style={{ width: 26 }} src={curChain.logo} alt={curChain.name} />\n}, {\n  width: '15%',\n  key: 'myBalance',\n  label: 'My Balance',\n  type: 'slot',\n  render: (data) => {\n    return (\n      <>\n        <TdTxt>{data.myBalance}</TdTxt> <TdTxt>{data.token}</TdTxt>\n      </>\n    )\n  }\n}, {\n  width: '15%',\n  key: 'poolBalance',\n  label: 'Pool Balance',\n  type: 'slot',\n  render: (data) => {\n    return (\n      <>\n        <TdTxt>{data.poolBalance}</TdTxt> <TdTxt>{data.token}</TdTxt>\n      </>\n    )\n  }\n}, {\n  width: '15%',\n  key: 'apy',\n  label: 'Fee APY',\n  type: 'slot',\n  render: () => {\n    return (\n      <TdTxt>-</TdTxt>\n    )\n  }\n}, {\n  width: '15%',\n  key: 'trader',\n  label: 'Trader Unr. PnL',\n  type: 'slot',\n  render: (data, index) => {\n    return (\n      <>\n        <TdTxt>{data.trader}</TdTxt> <TdTxt>{data.token}</TdTxt>\n        <SvgIcon className={[\"icon-right\", index === state.dataIndex ? \"rotate\" : \"\"]}>\n          {IconRight}\n        </SvgIcon>\n      </>\n    )\n  }\n}]\n\nreturn state.loading ? <Widget src=\"bluebiu.near/widget/0vix.LendingSpinner\" /> : (\n  <Column>\n    <Widget\n      src={\"bluebiu.near/widget/Liquidity.Data.METAVAULT\"}\n      props={{\n        pairs,\n        addresses,\n        prices,\n        curChain,\n        multicallAddress,\n        storeAddress,\n        onLoad: (data) => {\n          State.update({\n            dataList: data.dataList,\n            loading: false\n          })\n        }\n      }}\n    />\n    <Widget\n      src={\"bluebiu.near/widget/Liquidity.Bridge.Filter\"}\n      props={{\n        token: state.token,\n        chains: CHAIN_LIST,\n        categoryIndex: state.categoryIndex,\n        chainIndex: state.chainIndex,\n        onSearchInput: handleSearchInput,\n        onChangeCategoryIndex: handleChangeCategoryIndex,\n        onChangeChainIndex: handleChangeChainIndex,\n      }}\n    />\n    <Widget\n      src={\"bluebiu.near/widget/Liquidity.Bridge.METAVAULT.List\"}\n      props={{\n        toast,\n        prices,\n        refetch,\n        columnList,\n        storeAddress,\n        dataIndex: state.dataIndex,\n        onChangeDataIndex: handleChangeDataIndex,\n        dataList: state.filterList,\n        addresses,\n        addAction,\n        proxyAddress,\n        multicallAddress,\n        ICON_VAULT_MAP,\n      }}\n    />\n  </Column>\n)", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/Liquidity.Connector.METAVAULT", "fact_widget_deployments_id": "5cfabf9e8608d718e23cd60d02e0b18a", "inserted_timestamp": "2024-05-24T08:51:16.982Z", "modified_timestamp": "2024-05-24T08:51:16.982Z", "__row_index": 1}