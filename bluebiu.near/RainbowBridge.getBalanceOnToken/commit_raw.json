{"tx_hash": "552L5k6UhfAR6byptJrXCSXDQ8BGsfff9TMkU1m1W8eX", "action_id_social": "7FspVhBHj2wy8GYAuH3ehthjHKztdopf5BaC7e8Mh3oi-0-widget", "block_id": 99899856, "block_timestamp": "2023-08-29T03:38:01.156Z", "signer_id": "bluebiu.near", "widget_name": "RainbowBridge.getBalanceOnToken", "source_code": "const { token, sender, onLoad, forceReload } = props;\n\nconst { accountId } = context;\n\nconst Erc20Abi = [\n  {\n    constant: true,\n    inputs: [\n      {\n        name: \"_owner\",\n        type: \"address\",\n      },\n    ],\n    name: \"balanceOf\",\n    outputs: [\n      {\n        name: \"balance\",\n        type: \"uint256\",\n      },\n    ],\n    payable: false,\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    constant: true,\n    inputs: [\n      {\n        name: \"_owner\",\n        type: \"address\",\n      },\n      {\n        name: \"_spender\",\n        type: \"address\",\n      },\n    ],\n    name: \"allowance\",\n    outputs: [\n      {\n        name: \"\",\n        type: \"uint256\",\n      },\n    ],\n    payable: false,\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    constant: false,\n    inputs: [\n      {\n        name: \"_spender\",\n        type: \"address\",\n      },\n      {\n        name: \"_value\",\n        type: \"uint256\",\n      },\n    ],\n    name: \"approve\",\n    outputs: [\n      {\n        name: \"\",\n        type: \"bool\",\n      },\n    ],\n    payable: false,\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n];\n\nconst shrinkToken = (value, decimals) => {\n  return new Big(value || 0).div(Big(10).pow(decimals || 24));\n};\n\nconst expandToken = (value, decimals) => {\n  return new Big(value).mul(Big(10).pow(decimals));\n};\n\nconst account = fetch(\"https://rpc.mainnet.near.org\", {\n  method: \"POST\",\n  headers: {\n    \"Content-Type\": \"application/json\",\n  },\n  body: JSON.stringify({\n    jsonrpc: \"2.0\",\n    id: \"dontcare\",\n    method: \"query\",\n    params: {\n      request_type: \"view_account\",\n      finality: \"final\",\n      account_id: accountId,\n    },\n  }),\n});\n\nconst getBalanceNear = () => {\n  let amount;\n\n  if (!accountId) {\n    return \"0\";\n  }\n\n  if (token.name === \"NEAR\") amount = account.body.result.amount;\n  else {\n    amount = Near.view(token.near_address, \"ft_balance_of\", {\n      account_id: accountId,\n    });\n  }\n\n  return !amount ? \"0\" : shrinkToken(amount, token.decimals).toFixed();\n};\n\nconst getErc20Balance = () => {\n  const Interface = new ethers.utils.Interface(Erc20Abi);\n  return Ethers.provider()\n    .call({\n      to: token.ethereum_address,\n      data: Interface.encodeFunctionData(\"balanceOf\", [sender]),\n    })\n    .then((rawBalance) => {\n      const receiverBalanceHex = Interface.decodeFunctionResult(\n        \"balanceOf\",\n        rawBalance\n      );\n      const rawAmount = receiverBalanceHex.toString();\n\n      return shrinkToken(rawAmount, token.decimals).toFixed();\n    });\n};\n\nconst getNativeEthBalance = () => {\n  const provider = Ethers.provider();\n  return provider.getBalance(sender).then((rawBalance) => {\n    return shrinkToken(rawBalance.toString(), token.decimals).toFixed();\n  });\n};\n\nconst ethBalance = () => {\n  if (token.ethereum_address === \"\") {\n    return getNativeEthBalance();\n  } else {\n    console.log(\"token111: \", token);\n\n    return getErc20Balance();\n  }\n};\n\nif (sender && onLoad && token) {\n  const nearBalance = getBalanceNear();\n  console.log(\"nearBalance: \", nearBalance);\n\n  ethBalance().then((amount) => {\n    console.log(\"eth amount: \", amount);\n    onLoad({\n      nearBalance,\n      ethBalance: amount,\n    });\n  });\n}\n\nreturn \"\";\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/RainbowBridge.getBalanceOnToken", "fact_widget_deployments_id": "7b67fb1f34d723bdb0646699e0893967", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}