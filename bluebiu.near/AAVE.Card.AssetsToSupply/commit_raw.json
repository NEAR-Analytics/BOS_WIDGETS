{"tx_hash": "CmYB8YRDZueuF5Y4FPtqPCgsczd2jQ7VZ64eHzjppPda", "action_id_social": "BWT1uJWYiGEg3X1WAGw759dBasT5vQDwT8P8LbhStq6b-0-widget", "block_id": 116250512, "block_timestamp": "2024-04-06T14:25:55.432Z", "signer_id": "bluebiu.near", "widget_name": "AAVE.Card.AssetsToSupply", "source_code": "const {\n  config,\n  dexConfig,\n  assetsToSupply,\n  showSupplyModal,\n  setShowSupplyModal,\n  onActionSuccess,\n  chainId,\n  healthFactor,\n  formatHealthFactor,\n  calcHealthFactor,\n  depositETHGas,\n  depositERC20Gas,\n  theme,\n  yourTotalSupply,\n  yourSupplies,\n  borrowETHGas,\n  borrowERC20Gas,\n} = props;\n\nState.init({\n  data: undefined,\n  showBorrowModal: false,\n});\n\nconst SupplyButton = ({ data, ...rest }) => {\n  let disabled;\n\n  if (dexConfig.name === \"Seamless Protocol\") {\n    const { totalSupplyUSD, supplyCap } = data;\n    const isFull = Big(totalSupplyUSD || 0).gte(Big(supplyCap || 0));\n    disabled = Number(data.balanceInUSD) === 0 || isFull;\n  } else {\n    disabled = Number(data.balanceInUSD) === 0;\n  }\n  return (\n    <Widget\n      src={`${config.ownerId}/widget/AAVE.PrimaryButton`}\n      props={{\n        config,\n        // width: 148,\n        theme,\n        children: \"Supply\",\n        disabled,\n        onClick: () => {\n          State.update({ data });\n          setShowSupplyModal(true);\n        },\n      }}\n    />\n  );\n};\n\nconst BorrowButton = ({ data }) => {\n  let disabled;\n  if (dexConfig.name === \"Seamless Protocol\") {\n    const { totalDebtsUSD, borrowCap } = data;\n    const isFull = Big(totalDebtsUSD || 0).gte(Big(borrowCap || 0));\n    disabled =\n      isNaN(Number(yourTotalSupply)) || !Number(yourTotalSupply) || isFull;\n  } else {\n    disabled = isNaN(Number(yourTotalSupply)) || !Number(yourTotalSupply);\n  }\n  return (\n    <Widget\n      src={`${config.ownerId}/widget/AAVE.PrimaryButton`}\n      props={{\n        config,\n        disabled,\n        children: \"Borrow\",\n        theme,\n        onClick: () => {\n          State.update({ data, showBorrowModal: true });\n          // setShowBorrowModal(true);\n        },\n      }}\n    />\n  );\n};\n\nlet headers;\nlet tableData;\n\nif (dexConfig.name === \"Seamless Protocol\") {\n  headers = [\n    \"Asset\",\n    \"Total supplied\",\n    \"Supply APY\",\n    \"Total Borrowed\",\n    \"Borrow APY\",\n    \"Can be Collateral\",\n    \"\",\n  ];\n  tableData = assetsToSupply.map((row) => [\n    <Widget\n      src={`${config.ownerId}/widget/AAVE.Card.TokenWrapper`}\n      props={{\n        children: [\n          <img width={64} height={64} src={row.icon} />,\n          <div>\n            <div className=\"token-title\">{row.symbol}</div>\n            <div className=\"token-chain\">{row.name}</div>\n          </div>,\n        ],\n      }}\n    />,\n    <div>\n      <div>\n        <Widget\n          src={`${config.ownerId}/widget/Utils.FormatNumber`}\n          props={{\n            number: row.totalSupply,\n          }}\n        />\n      </div>\n      <div>\n        $\n        <Widget\n          src={`${config.ownerId}/widget/Utils.FormatNumber`}\n          props={{\n            number: row.totalSupplyUSD,\n          }}\n        />\n      </div>\n    </div>,\n    `${(Number(row.supplyAPY) * 100).toFixed(2)} %`,\n\n    <div>\n      <div>\n        <Widget\n          src={`${config.ownerId}/widget/Utils.FormatNumber`}\n          props={{\n            number: row.totalDebts,\n          }}\n        />\n      </div>\n      <div>\n        ${\" \"}\n        <Widget\n          src={`${config.ownerId}/widget/Utils.FormatNumber`}\n          props={{\n            number: row.totalDebtsUSD,\n          }}\n        />\n      </div>\n    </div>,\n\n    `${(Number(row.variableBorrowAPY) * 100).toFixed(2)} %`,\n    <div style={{ paddingLeft: \"50px\" }}>\n      {(row.isIsolated || (!row.isIsolated && !row.usageAsCollateralEnabled)) &&\n        \"\u2014\"}\n      {!row.isIsolated && row.usageAsCollateralEnabled && (\n        <img\n          src={`${config.ipfsPrefix}/bafkreibsy5fzn67veowyalveo6t34rnqvktmok2zutdsp4f5slem3grc3i`}\n          width={16}\n          height={16}\n        />\n      )}\n    </div>,\n    <div style={{ display: \"flex\", gap: 10 }}>\n      <SupplyButton data={row} />\n      <BorrowButton\n        data={{\n          ...row,\n        }}\n      />\n    </div>,\n  ]);\n}\nif ([\"zerolend\", \"AAVE V3\"].includes(dexConfig.name)) {\n  headers = [\n    \"Asset\",\n    \"Wallet Balance\",\n    \"Supply APY\",\n    \"Available to borrow\",\n    \"Borrow APY\",\n    \"Can be Collateral\",\n    \"\",\n  ];\n  tableData = assetsToSupply.map((row) => [\n    <Widget\n      src={`${config.ownerId}/widget/AAVE.Card.TokenWrapper`}\n      props={{\n        children: [\n          <img width={64} height={64} src={row.icon} />,\n          <div>\n            <div className=\"token-title\">{row.symbol}</div>\n            <div className=\"token-chain\">{row.name}</div>\n          </div>,\n        ],\n      }}\n    />,\n    <div>\n      <div>{Number(row.balance).toFixed(7)}</div>\n      <div>$ {row.balanceInUSD}</div>\n    </div>,\n    <div>\n      <div>{`${(Number(row.supplyAPY) * 100).toFixed(2)} %`}</div>\n\n      <div>\n        {dexConfig.rewardToken\n          ? `${(Number(row.supplyRewardApy) * 100).toFixed(2)} %`\n          : \"\"}\n      </div>\n    </div>,\n    <div>\n      <div>{Number(row.availableBorrows).toFixed(7)}</div>\n      <div>$ {row.availableBorrowsUSD}</div>\n    </div>,\n\n    <div>\n      <div>{`${(Number(row.variableBorrowAPY) * 100).toFixed(2)} %`}</div>\n      <div>\n        {dexConfig.rewardToken\n          ? `${(Number(row.borrowRewardApy) * 100).toFixed(2)} %`\n          : \"\"}\n      </div>\n    </div>,\n    <div style={{ paddingLeft: \"50px\" }}>\n      {(row.isIsolated || (!row.isIsolated && !row.usageAsCollateralEnabled)) &&\n        \"\u2014\"}\n      {!row.isIsolated && row.usageAsCollateralEnabled && (\n        <img\n          src={`${config.ipfsPrefix}/bafkreibsy5fzn67veowyalveo6t34rnqvktmok2zutdsp4f5slem3grc3i`}\n          width={16}\n          height={16}\n        />\n      )}\n    </div>,\n    <div style={{ display: \"flex\", gap: 10 }}>\n      <SupplyButton data={row} />\n      <BorrowButton\n        data={{\n          ...row,\n        }}\n      />\n    </div>,\n  ]);\n}\n\nreturn (\n  <>\n    <Widget\n      src={`${config.ownerId}/widget/AAVE.Card.CardsView`}\n      props={{\n        config,\n        style: {\n          marginTop: \"16px\",\n        },\n        title: \"Market\",\n        body:\n          !assetsToSupply || assetsToSupply.length === 0 ? (\n            <Widget\n              src={`${config.ownerId}/widget/AAVE.Card.CardEmpty`}\n              props={{\n                config,\n                children: \"Nothing supplied yet\",\n              }}\n            />\n          ) : (\n            <>\n              <Widget\n                src={`${config.ownerId}/widget/AAVE.Card.CardsTable`}\n                props={{\n                  config,\n                  headers,\n                  data: tableData,\n                }}\n              />\n            </>\n          ),\n      }}\n    />\n    {showSupplyModal && (\n      <Widget\n        src={`${config.ownerId}/widget/AAVE.Modal.SupplyModal`}\n        props={{\n          config,\n          theme,\n          onRequestClose: () => setShowSupplyModal(false),\n          data: {\n            ...state.data,\n            healthFactor,\n          },\n          onActionSuccess,\n          chainId,\n          depositETHGas,\n          depositERC20Gas,\n          formatHealthFactor,\n          calcHealthFactor,\n        }}\n      />\n    )}\n    {state.showBorrowModal && (\n      <Widget\n        src={`${config.ownerId}/widget/AAVE.Modal.BorrowModal`}\n        props={{\n          config,\n          theme,\n          onRequestClose: () => {\n            State.update({\n              showBorrowModal: false,\n            });\n            // setShowBorrowModal(false)\n          },\n          data: {\n            ...state.data,\n            healthFactor,\n          },\n          onActionSuccess,\n          chainId,\n          borrowETHGas,\n          borrowERC20Gas,\n          formatHealthFactor,\n          calcHealthFactor,\n        }}\n      />\n    )}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/AAVE.Card.AssetsToSupply", "fact_widget_deployments_id": "2b5aee6b8e6b622fb9eb723213859cd2", "inserted_timestamp": "2024-04-06T18:51:49.787Z", "modified_timestamp": "2024-04-06T18:51:49.787Z", "__row_index": 0}