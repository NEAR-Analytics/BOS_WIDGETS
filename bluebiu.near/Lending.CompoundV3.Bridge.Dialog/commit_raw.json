{"tx_hash": "He7GLXgVFCA96zEiNmBsHMcqR1N2YZ9RdrAkRE7QTQSj", "action_id_social": "3fTR7Yv1gWLr6RTcCSGwHzLRb5Yo6UZRJJfWxeNFwS6X-0-widget", "block_id": 116810367, "block_timestamp": "2024-04-14T07:00:35.978Z", "signer_id": "bluebiu.near", "widget_name": "Lending.CompoundV3.Bridge.Dialog", "source_code": "const StyledFlex = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: flex-start;\n  gap: 0;\n`;\nconst StyledInput = styled.input`\n  background-color: transparent;\n  font-size: 16px;\n  color: #fff;\n  flex-grow: 1;\n`;\nconst StyledFont = styled.div`\n  color: #fff;\n  font-family: Gantari;\n  font-size: 16px;\n  font-style: normal;\n  font-weight: 400;\n  line-height: normal;\n  white-space: normal;\n`;\nconst StyledDialog = styled.div`\n  position: fixed;\n  left: 0;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n`;\nconst StyledMasker = styled.div`\n  position: absolute;\n  left: 0;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.5);\n  z-index: 99;\n`;\nconst StyledDialogMain = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  position: relative;\n  padding: 20px;\n  width: 418px;\n  border-radius: 16px;\n  border: 1px solid #373a53;\n  background: #2e3142;\n  z-index: 999;\n  & > div {\n    width: 100%;\n  }\n`;\nconst StyledClose = styled.div`\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n`;\nconst StyledBalanceWrapper = styled.div`\n  height: 80px;\n  background: #1b1e27;\n  border: 1px solid #33364b;\n  border-radius: 8px;\n  padding: 16px 14px 13px 12px;\n`;\nconst StyledButton = styled.button`\n  flex: 1;\n  height: 48px;\n  border-radius: 8px;\n  text-align: center;\n  line-height: 48px;\n  color: #fff;\n  font-family: Gantari;\n  font-size: 16px;\n  font-style: normal;\n  font-weight: 500;\n  &:hover {\n    opacity: 0.8;\n  }\n`;\nconst {\n  asset,\n  type,\n  collaterValue,\n  borrowCapacity,\n  availableToBorrow,\n  cometAddress,\n  borrowApr,\n  supplyApr,\n  account,\n  toast,\n  onAmountChange,\n  onAddAction,\n  onClose,\n} = props;\n\nuseEffect(() => {\n  clearTimeout(Storage.privateGet(\"timer\"));\n  const timer = setTimeout(() => {\n    onAmountChange({\n      amount: state.amount || 0,\n      type,\n      cb: (res) => {\n        State.update({ ...res });\n      },\n    });\n    if (!state.amount || asset.isNative) {\n      State.update({ isApproved: true });\n      return;\n    }\n    state?.checkAllowance(state.amount, (isApproved) => {\n      State.update({ isApproved });\n    });\n  }, 500);\n  Storage.privateSet(\"timer\", timer);\n}, [state.amount]);\n\nreturn (\n  <StyledDialog>\n    <StyledMasker />\n    <StyledDialogMain>\n      <StyledFlex style={{ marginBottom: 24, justifyContent: \"space-between\" }}>\n        <StyledFlex style={{ gap: 6 }}>\n          <StyledFont\n            style={{\n              fontSize: 16,\n              fontWeight: 700,\n            }}\n          >\n            {type} {asset.symbol}\n          </StyledFont>\n          {type === \"Supply\" && (\n            <StyledFont\n              style={{\n                fontSize: 16,\n                fontWeight: 700,\n                color: \"#10FFB7\",\n              }}\n            >\n              {supplyApr}%\n            </StyledFont>\n          )}\n          {[\"Borrow\", \"Repay\"].includes(type) && (\n            <StyledFont\n              style={{\n                fontSize: 16,\n                fontWeight: 700,\n                color: \"#7945FF\",\n              }}\n            >\n              {borrowApr}%\n            </StyledFont>\n          )}\n          {[\"Supply\", \"Borrow\", \"Repay\"].includes(type) && (\n            <StyledFont\n              style={{\n                fontSize: 14,\n                color: \"#979ABE\",\n              }}\n            >\n              Net APR\n            </StyledFont>\n          )}\n        </StyledFlex>\n        <StyledClose\n          onClick={() => {\n            onClose();\n          }}\n        >\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            width=\"12\"\n            height=\"12\"\n            viewBox=\"0 0 12 12\"\n            fill=\"none\"\n          >\n            <path\n              d=\"M7.73284 6.00004L11.7359 1.99701C12.0368 1.696 12.0882 1.2593 11.8507 1.0219L10.9779 0.14909C10.7404 -0.0884124 10.3043 -0.0363122 10.0028 0.264491L6.00013 4.26743L1.99719 0.264591C1.69619 -0.036712 1.25948 -0.0884125 1.02198 0.14939L0.149174 1.0223C-0.0882277 1.2594 -0.0368271 1.6961 0.264576 1.99711L4.26761 6.00004L0.264576 10.0033C-0.0363271 10.3041 -0.0884277 10.7405 0.149174 10.978L1.02198 11.8509C1.25948 12.0884 1.69619 12.0369 1.99719 11.736L6.00033 7.73276L10.0029 11.7354C10.3044 12.037 10.7405 12.0884 10.978 11.8509L11.8508 10.978C12.0882 10.7405 12.0368 10.3041 11.736 10.0029L7.73284 6.00004Z\"\n              fill=\"#979ABE\"\n            />\n          </svg>\n        </StyledClose>\n      </StyledFlex>\n      <StyledBalanceWrapper style={{ marginBottom: 24 }}>\n        <StyledFlex\n          style={{ marginBottom: 16, justifyContent: \"space-between\" }}\n        >\n          <StyledInput\n            placeholder=\"0.00\"\n            value={state.amount || \"\"}\n            onChange={(ev) => {\n              if (isNaN(Number(ev.target.value))) return;\n              if (Big(ev.target.value || 0).gt(asset.walletBalance)) return;\n              State.update({\n                amount: ev.target.value,\n              });\n            }}\n          />\n          <StyledFlex style={{ gap: 6 }}>\n            {/* <StyledChain></StyledChain> */}\n            <img src={asset.icon} style={{ width: 20, height: 20 }} />\n            <StyledFont\n              style={{\n                fontSize: 14,\n                fontWeight: 500,\n              }}\n            >\n              {asset.symbol}\n            </StyledFont>\n          </StyledFlex>\n        </StyledFlex>\n        <StyledFlex style={{ justifyContent: \"space-between\" }}>\n          <StyledFont\n            style={{\n              fontSize: 12,\n              color: \"#979ABE\",\n            }}\n          >\n            <Widget\n              src=\"bluebiu.near/widget/Utils.FormatAmount\"\n              props={{\n                amount: Big(state.amount || 0).mul(asset.price),\n                prev: \"$\",\n              }}\n            />\n          </StyledFont>\n          <StyledFlex style={{ gap: 5 }}>\n            <StyledFont\n              style={{\n                fontSize: 12,\n                color: \"#979ABE\",\n              }}\n            >\n              Balance:\n            </StyledFont>\n            <StyledFlex\n              style={{ gap: \"8px\", cursor: \"pointer\" }}\n              onClick={() => {\n                const _balance = Big(asset.walletBalance || 0);\n                const splits = _balance.toFixed(18).split(\".\");\n                const _amount = _balance.lt(0.000001)\n                  ? _balance.toFixed(splits[1].length)\n                  : asset.walletBalance;\n                State.update({\n                  amount: _amount.replace(/\\.?0+$/, \"\"),\n                });\n              }}\n            >\n              <StyledFont\n                style={{\n                  textDecoration: \"underline\",\n                  color: \"#FFF\",\n                  fontSize: 12,\n                }}\n              >\n                <Widget\n                  src=\"bluebiu.near/widget/Utils.FormatAmount\"\n                  props={{\n                    amount: asset.walletBalance,\n                  }}\n                />\n              </StyledFont>\n              <StyledFont\n                style={{\n                  color: \"#979ABE\",\n                  fontSize: 12,\n                }}\n              >\n                {asset.symbol}\n              </StyledFont>\n            </StyledFlex>\n          </StyledFlex>\n        </StyledFlex>\n      </StyledBalanceWrapper>\n      {type !== \"Supply\" && (\n        <StyledFlex\n          style={{ marginBottom: 24, gap: 16, flexDirection: \"column\" }}\n        >\n          {[\"Collateral\", \"Withdraw\"].includes(type) && (\n            <StyledFlex\n              style={{ width: \"100%\", justifyContent: \"space-between\" }}\n            >\n              <StyledFont\n                style={{\n                  color: \"#979ABE\",\n                  fontSize: 14,\n                }}\n              >\n                Collateral Value\n              </StyledFont>\n              <StyledFlex style={{ gap: \"5px\" }}>\n                <StyledFont\n                  style={{\n                    textDecoration:\n                      state.availableToBorrow !== undefined\n                        ? \"line-through\"\n                        : \"inherit\",\n                    fontSize: 14,\n                    color:\n                      state.availableToBorrow !== undefined\n                        ? \"#979ABE\"\n                        : \"#fff\",\n                  }}\n                >\n                  <Widget\n                    src=\"bluebiu.near/widget/Utils.FormatAmount\"\n                    props={{\n                      amount: collaterValue,\n                      prev: \"$\",\n                    }}\n                  />\n                </StyledFont>\n                {state.collaterValue !== undefined && (\n                  <>\n                    <svg\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                      width=\"8\"\n                      height=\"10\"\n                      viewBox=\"0 0 8 10\"\n                      fill=\"none\"\n                    >\n                      <path\n                        d=\"M7.5 4.13397C8.16667 4.51887 8.16667 5.48113 7.5 5.86603L1.5 9.33013C0.833334 9.71503 -4.47338e-07 9.2339 -4.13689e-07 8.4641L-1.10848e-07 1.5359C-7.71986e-08 0.766098 0.833333 0.284973 1.5 0.669873L7.5 4.13397Z\"\n                        fill=\"#979ABE\"\n                      />\n                    </svg>\n                    <StyledFont\n                      style={{\n                        color: \"#FFF\",\n                        fontSize: \"14px\",\n                      }}\n                    >\n                      <Widget\n                        src=\"bluebiu.near/widget/Utils.FormatAmount\"\n                        props={{\n                          amount: state.collaterValue,\n                          prev: \"$\",\n                        }}\n                      />\n                    </StyledFont>\n                  </>\n                )}\n              </StyledFlex>\n            </StyledFlex>\n          )}\n          <StyledFlex\n            style={{ width: \"100%\", justifyContent: \"space-between\" }}\n          >\n            <StyledFont\n              style={{\n                color: \"#979ABE\",\n                fontSize: \"14px\",\n              }}\n            >\n              Borrow Capacity\n            </StyledFont>\n            <StyledFlex style={{ gap: 5 }}>\n              <StyledFont\n                style={{\n                  textDecoration:\n                    state.borrowCapacity !== undefined\n                      ? \"line-through\"\n                      : \"inherit\",\n                  fontSize: 14,\n                  color:\n                    state.borrowCapacity !== undefined ? \"#979ABE\" : \"#fff\",\n                }}\n              >\n                <Widget\n                  src=\"bluebiu.near/widget/Utils.FormatAmount\"\n                  props={{\n                    amount: borrowCapacity,\n                    prev: \"$\",\n                  }}\n                />\n              </StyledFont>\n              {state.borrowCapacity !== undefined && (\n                <>\n                  <svg\n                    xmlns=\"http://www.w3.org/2000/svg\"\n                    width=\"8\"\n                    height=\"10\"\n                    viewBox=\"0 0 8 10\"\n                    fill=\"none\"\n                  >\n                    <path\n                      d=\"M7.5 4.13397C8.16667 4.51887 8.16667 5.48113 7.5 5.86603L1.5 9.33013C0.833334 9.71503 -4.47338e-07 9.2339 -4.13689e-07 8.4641L-1.10848e-07 1.5359C-7.71986e-08 0.766098 0.833333 0.284973 1.5 0.669873L7.5 4.13397Z\"\n                      fill=\"#979ABE\"\n                    />\n                  </svg>\n                  <StyledFont\n                    style={{\n                      fontSize: 14,\n                    }}\n                  >\n                    <Widget\n                      src=\"bluebiu.near/widget/Utils.FormatAmount\"\n                      props={{\n                        amount: state.borrowCapacity,\n                        prev: \"$\",\n                      }}\n                    />\n                    {/* <span style={{ color: \"#979ABE\" }}>USDC</span> */}\n                  </StyledFont>\n                </>\n              )}\n            </StyledFlex>\n          </StyledFlex>\n          <StyledFlex\n            style={{ width: \"100%\", justifyContent: \"space-between\" }}\n          >\n            <StyledFont\n              style={{\n                fontSize: 14,\n                color: \"#979ABE\",\n              }}\n            >\n              Available to Borrow\n            </StyledFont>\n            <StyledFlex style={{ gap: 5 }}>\n              <StyledFont\n                style={{\n                  textDecoration:\n                    state.availableToBorrow !== undefined\n                      ? \"line-through\"\n                      : \"inherit\",\n                  fontSize: 14,\n                  color:\n                    state.availableToBorrow !== undefined ? \"#979ABE\" : \"#fff\",\n                }}\n              >\n                <Widget\n                  src=\"bluebiu.near/widget/Utils.FormatAmount\"\n                  props={{\n                    amount: availableToBorrow,\n                    prev: \"$\",\n                  }}\n                />\n              </StyledFont>\n              {state.availableToBorrow !== undefined && (\n                <>\n                  <svg\n                    xmlns=\"http://www.w3.org/2000/svg\"\n                    width=\"8\"\n                    height=\"10\"\n                    viewBox=\"0 0 8 10\"\n                    fill=\"none\"\n                  >\n                    <path\n                      d=\"M7.5 4.13397C8.16667 4.51887 8.16667 5.48113 7.5 5.86603L1.5 9.33013C0.833334 9.71503 -4.47338e-07 9.2339 -4.13689e-07 8.4641L-1.10848e-07 1.5359C-7.71986e-08 0.766098 0.833333 0.284973 1.5 0.669873L7.5 4.13397Z\"\n                      fill=\"#979ABE\"\n                    />\n                  </svg>\n                  <StyledFont style={{ fontSize: 14 }}>\n                    <Widget\n                      src=\"bluebiu.near/widget/Utils.FormatAmount\"\n                      props={{\n                        amount: state.availableToBorrow,\n                        prev: \"$\",\n                      }}\n                    />\n                    {/* <span style={{ color: \"#979ABE\" }}>USDC</span> */}\n                  </StyledFont>\n                </>\n              )}\n            </StyledFlex>\n          </StyledFlex>\n        </StyledFlex>\n      )}\n      {!asset.isNative && (\n        <StyledFont\n          style={{\n            width: 382,\n            marginBottom: 20,\n            fontSize: 14,\n            color: \"#979ABE\",\n          }}\n        >\n          You need to approve Compound on the {asset.symbol} contract before you\n          can use this asset. You only need to do this once.\n        </StyledFont>\n      )}\n      <StyledFlex>\n        <StyledButton\n          disabled={!state.amount || state.loading}\n          style={{\n            backgroundColor: [\"Borrow\", \"Repay\"].includes(type)\n              ? \"#5D36C3\"\n              : \"#00ad79\",\n          }}\n          onClick={() => {\n            if (!Big(state.amount || 0).gt(0)) return;\n            if (!state.isApproved) {\n              State.update({\n                loading: true,\n              });\n              state.handleApprove(\n                state.amount,\n                () => {\n                  State.update({\n                    loading: false,\n                    isApproved: true,\n                  });\n                  onAddAction({ amount: state.amount, type });\n                },\n                () => {\n                  State.update({\n                    loading: false,\n                  });\n                }\n              );\n            } else {\n              onAddAction({ amount: state.amount, type });\n            }\n          }}\n        >\n          {state.loading ? (\n            <Widget\n              src=\"bluebiu.near/widget/0vix.LendingLoadingIcon\"\n              props={{\n                size: 16,\n              }}\n            />\n          ) : state.isApproved ? (\n            \"Add\"\n          ) : (\n            \"Approve & Add\"\n          )}\n        </StyledButton>\n      </StyledFlex>\n    </StyledDialogMain>\n    <Widget\n      src=\"bluebiu.near/widget/Lending.CompoundV3.CheckAllowance\"\n      props={{\n        account,\n        spender: cometAddress,\n        token: asset,\n        amount: state.amount,\n        toast,\n        onLoad: (data) => {\n          State.update({ ...data });\n        },\n      }}\n    />\n  </StyledDialog>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/Lending.CompoundV3.Bridge.Dialog", "fact_widget_deployments_id": "82b57abd2bc0023f64773ff2c97e3b79", "inserted_timestamp": "2024-04-14T09:16:01.381Z", "modified_timestamp": "2024-04-14T09:16:01.381Z", "__row_index": 3}