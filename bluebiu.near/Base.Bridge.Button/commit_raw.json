{"tx_hash": "2FyPbakM4FVcTVuc2qBYMSPX8qyU5qRBy8to69TDber8", "action_id_social": "UtBRF7yBLHnZDcPd37A6dy1gzHuKzafvHpeAj1b9Mtb-0-widget", "block_id": 106333168, "block_timestamp": "2023-11-23T06:26:29.662Z", "signer_id": "bluebiu.near", "widget_name": "Base.Bridge.Button", "source_code": "const Button = styled.button`\n  width: 100%;\n  height: 60px;\n  border-radius: 10px;\n  background-color: var(--button-color);\n  line-height: 60px;\n  border: none;\n  font-size: 18px;\n  font-weight: 500;\n  color: var(--button-text-color);\n  margin-top: 20px;\n\n  &:disabled {\n    opacity: 0.3;\n  }\n`;\nconst account = Ethers.send(\"eth_requestAccounts\", [])[0];\nconst {\n  disabled,\n  amount,\n  maxInputBalance,\n  currency,\n  from,\n  target,\n  handlerSwap,\n  gasCost,\n  isGasEnough,\n  onSuccess,\n} = props;\n\nif (disabled) return <Button disabled={disabled}>Confrim</Button>;\nif (Big(amount || 0).eq(0))\n  return <Button disabled={true}>Enter An Amount</Button>;\nif (Big(amount || 0).gt(maxInputBalance || 0) || !currency) {\n  return <Button disabled>Insufficient {currency?.symbol} Balance</Button>;\n}\n\nState.init({\n  isApproved: false,\n  loading: false,\n});\nif (!isGasEnough) {\n  return (\n    <Button disabled>\n      Not enough gas({Big(gasCost || 0).toFixed(3)}) needed\n    </Button>\n  );\n}\nconst spender = currency\n  ? currency.oftAddress\n    ? currency.oftAddress\n    : currency.isNative\n    ? from.routerEthAddress\n    : from.routerAddress\n  : \"\";\n\nconst getAllowance = () => {\n  if (!spender) return;\n  const TokenContract = new ethers.Contract(\n    currency.address,\n    [\n      {\n        constant: true,\n        inputs: [\n          {\n            name: \"_owner\",\n            type: \"address\",\n          },\n          {\n            name: \"_spender\",\n            type: \"address\",\n          },\n        ],\n        name: \"allowance\",\n        outputs: [\n          {\n            name: \"\",\n            type: \"uint256\",\n          },\n        ],\n        payable: false,\n        stateMutability: \"view\",\n        type: \"function\",\n      },\n    ],\n    Ethers?.provider()?.getSigner()\n  );\n  TokenContract?.allowance(account, spender)\n    .then((allowanceRaw) => {\n      State.update({\n        isApproved: !Big(\n          ethers.utils.formatUnits(allowanceRaw._hex, currency.decimals)\n        ).lt(amount),\n      });\n    })\n    .catch((err) => {});\n};\n\nif (!currency?.isNative) {\n  getAllowance();\n} else {\n  State.update({ isApproved: true });\n}\n\nconst handleApprove = () => {\n  State.update({\n    loading: true,\n  });\n  const TokenContract = new ethers.Contract(\n    currency.address,\n    [\n      {\n        constant: false,\n        inputs: [\n          {\n            name: \"_spender\",\n            type: \"address\",\n          },\n          {\n            name: \"_value\",\n            type: \"uint256\",\n          },\n        ],\n        name: \"approve\",\n        outputs: [\n          {\n            name: \"\",\n            type: \"bool\",\n          },\n        ],\n        payable: false,\n        stateMutability: \"nonpayable\",\n        type: \"function\",\n      },\n    ],\n    Ethers.provider().getSigner()\n  );\n  TokenContract.approve(\n    spender,\n    ethers.utils.parseUnits(amount, currency.decimals)\n  )\n    .then((tx) => {\n      tx.wait().then((res) => {\n        const { status, transactionHash } = res;\n        State.update({\n          isApproved: status === 1,\n          loading: false,\n        });\n      });\n    })\n    .catch(() => {\n      State.update({\n        loading: false,\n      });\n    });\n};\n\nif (!state.isApproved) {\n  return (\n    <Button onClick={handleApprove} disabled={state.loading}>\n      {state.loading && (\n        <Widget\n          src=\"bluebiu.near/widget/0vix.LendingLoadingIcon\"\n          props={{\n            size: 16,\n          }}\n        />\n      )}\n      Approve\n    </Button>\n  );\n}\n\nreturn (\n  <>\n    <Widget\n      src={handlerSwap}\n      props={{\n        amount,\n        account,\n        currency,\n        routerAddress: from.routerAddress,\n        routerEthAddress: from.routerEthAddress,\n        loading: state.loading,\n        target,\n        onSuccess: (res) => {\n          State.update({ loading: false });\n          const { status, transactionHash } = res;\n          if (status === 1) {\n            onSuccess?.(transactionHash);\n          }\n        },\n        onError: (err) => {\n          State.update({ loading: false });\n        },\n      }}\n    />\n    <Button\n      onClick={() => {\n        State.update({ loading: true });\n      }}\n      disabled={state.loading}\n    >\n      {state.loading && (\n        <Widget\n          src=\"bluebiu.near/widget/0vix.LendingLoadingIcon\"\n          props={{\n            size: 16,\n          }}\n        />\n      )}\n      Confirm\n    </Button>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/Base.Bridge.Button", "fact_widget_deployments_id": "66bff53db8b180de892b0f5b52ac0a4a", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}