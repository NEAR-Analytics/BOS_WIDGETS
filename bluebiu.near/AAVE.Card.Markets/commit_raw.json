{"tx_hash": "Ec4BAhhCUuqqSsduV6TvP4gXH7BTt9wZxAh2cN8KjCyb", "action_id_social": "EgsvT4KJE8ScYRjh8ezhroCZ6ni3PhVf3tmzMJdomm76-0-widget", "block_id": 117153346, "block_timestamp": "2024-04-19T06:01:47.959Z", "signer_id": "bluebiu.near", "widget_name": "AAVE.Card.Markets", "source_code": "const {\n  config,\n  addAction,\n  dexConfig,\n  assetsToSupply,\n  showSupplyModal,\n  setShowSupplyModal,\n  onActionSuccess,\n  chainId,\n  healthFactor,\n  formatHealthFactor,\n  calcHealthFactor,\n  depositETHGas,\n  depositERC20Gas,\n  theme,\n  yourTotalSupply,\n  yourSupplies,\n  borrowETHGas,\n  borrowERC20Gas,\n} = props;\n\nconst CenterRow = styled.div`\n  /* text-align: center; */\n`;\n\nconst CenterItem = styled.div`\n  display: flex;\n  flex-direction: column;\n`;\n\nconst ItemPrimary = styled.div`\n  font-size: 16px;\n\n  &.apy {\n    color: rgb(34, 160, 107);\n  }\n`;\nconst ItemSub = styled.div`\n  font-size: 14px;\n  font-weight: 400;\n  color: rgb(162, 166, 149);\n  &.radio {\n    display: flex;\n    gap: 3px;\n    align-items: center;\n    color: rgb(178, 232, 16);\n  }\n`;\n\nconst IconMouth = styled.img`\n  width: 14px;\n  height: 14px;\n`;\n\nState.init({\n  data: undefined,\n  showBorrowModal: false,\n  showLoopModal: false,\n});\n\nconst SupplyButton = ({ data, ...rest }) => {\n  let disabled;\n\n  if (dexConfig.name === \"Seamless Protocol\") {\n    const { totalSupplyUSD, supplyCapUSD } = data;\n    const isFull = Big(totalSupplyUSD || 0).gte(Big(supplyCapUSD || 0));\n\n    disabled = !data.balanceInUSD || Number(data.balanceInUSD) === 0 || isFull;\n  } else {\n    disabled = !data.balanceInUSD || Number(data.balanceInUSD) === 0;\n  }\n  return (\n    <Widget\n      src={`${config.ownerId}/widget/AAVE.PrimaryButton`}\n      props={{\n        config,\n        // width: 148,\n        theme,\n        children: \"Supply\",\n        disabled,\n        onClick: () => {\n          State.update({ data });\n          setShowSupplyModal(true);\n        },\n      }}\n    />\n  );\n};\n\nconst BorrowButton = ({ data }) => {\n  let disabled;\n  if (dexConfig.name === \"Seamless Protocol\") {\n    const { totalDebtsUSD, borrowCapUSD } = data;\n    const isFull = Big(totalDebtsUSD || 0).gte(Big(borrowCapUSD || 0));\n\n    disabled =\n      isNaN(Number(yourTotalSupply)) || !Number(yourTotalSupply) || isFull;\n  } else {\n    disabled = isNaN(Number(yourTotalSupply)) || !Number(yourTotalSupply);\n  }\n  if (!data.supportBorrow) {\n    disabled = true;\n  }\n  return (\n    <Widget\n      src={`${config.ownerId}/widget/AAVE.PrimaryButton`}\n      props={{\n        config,\n        disabled,\n        children: \"Borrow\",\n        theme,\n        onClick: () => {\n          State.update({ data, showBorrowModal: true });\n          // setShowBorrowModal(true);\n        },\n      }}\n    />\n  );\n};\n\nconst LoopButton = ({ data }) => {\n  let disabled;\n  // if (dexConfig.name === \"Seamless Protocol\") {\n  //   const { totalSupplyUSD, supplyCapUSD } = data;\n  //   const isFull = Big(totalSupplyUSD || 0).gte(Big(supplyCapUSD || 0));\n\n  //   disabled = Number(data.balanceInUSD) === 0 || isFull;\n  // } else {\n  //   disabled = Number(data.balanceInUSD) === 0;\n  // }\n  disabled = !data.balanceInUSD || Number(data.balanceInUSD) === 0;\n\n  return (\n    <Widget\n      src={`${config.ownerId}/widget/AAVE.PrimaryButton`}\n      props={{\n        config,\n        disabled,\n        children: \"Loop\",\n        theme,\n        onClick: () => {\n          State.update({ data, showLoopModal: true });\n        },\n      }}\n    />\n  );\n};\n\nfunction formatRate(_value) {\n  if (isNaN(Number(_value))) return \"\";\n  let value = (Number(_value) * 100).toFixed();\n  return Big(value || 0).lt(0.01) ? \"<0.01%\" : `${Number(value).toFixed(2)}%`;\n}\n\nfunction formatNumber(value, digits) {\n  if (isNaN(Number(value))) return \"\";\n  if (Big(value || 0).eq(0)) return `$ 0`;\n  return Big(value || 0).lt(0.01)\n    ? \"< $0.01\"\n    : `$ ${Number(value).toFixed(digits || 2)}`;\n}\nfunction formatValue(value, digits) {\n  if (isNaN(Number(value))) return \"\";\n  if (Number(value) === 0) return \"0\";\n  return Big(value || 0).lt(0.0000001)\n    ? \"< 0.0000001\"\n    : `${Number(value).toFixed(digits || 2)}`;\n}\nlet headers;\nlet tableData;\n\nif ([\"ZeroLend\", \"AAVE V3\", \"Seamless Protocol\"].includes(dexConfig.name)) {\n  headers = [\n    \"Asset\",\n    \"Wallet Balance\",\n    \"Supply APY\",\n    \"Available to borrow\",\n    \"Borrow APY\",\n    \"Can be Collateral\",\n    \"\",\n  ];\n  tableData = assetsToSupply.map((row) => [\n    <Widget\n      src={`${config.ownerId}/widget/AAVE.Card.TokenWrapper`}\n      props={{\n        children: [\n          <img width={64} height={64} src={row.icon} />,\n          <CenterItem>\n            <div className=\"token-title\">{row.symbol}</div>\n            {/* <div className=\"token-chain\">{row.name}</div> */}\n          </CenterItem>,\n        ],\n      }}\n    />,\n    <div>\n      <div>{formatValue(row.balance, 7)}</div>\n      <div>{formatNumber(row.balanceInUSD)}</div>\n    </div>,\n    <div>\n      <div>\n        {row.supplyAPY ? `${(Number(row.supplyAPY) * 100).toFixed(2)} %` : \"\"}\n      </div>\n\n      <div>\n        {dexConfig.rewardToken && row.supplyRewardApy\n          ? `${(Number(row.supplyRewardApy) * 100).toFixed(2)} %`\n          : \"\"}\n      </div>\n    </div>,\n    <div>\n      <CenterRow>{formatValue(row.availableBorrows, 7)}</CenterRow>\n      <CenterRow>{formatNumber(row.availableBorrowsUSD)}</CenterRow>\n      {/* <CenterRow>\n        {row.availableBorrows ? Number(row.availableBorrows).toFixed(7) : \"\"}\n      </CenterRow>\n\n      <CenterRow>\n        {row.availableBorrowsUSD\n          ? `$${Number(row.availableBorrowsUSD).toFixed(2)}`\n          : \"\"}\n      </CenterRow> */}\n    </div>,\n\n    <div>\n      <div>\n        {row.borrowAPY ? `${(Number(row.borrowAPY) * 100).toFixed(2)} %` : \"\"}\n      </div>\n      <div>\n        {dexConfig.rewardToken && row.borrowRewardApy\n          ? `${(Number(row.borrowRewardApy) * 100).toFixed(2)} %`\n          : \"\"}\n      </div>\n    </div>,\n    <div style={{ paddingLeft: \"50px\" }}>\n      {(row.isIsolated || (!row.isIsolated && !row.usageAsCollateralEnabled)) &&\n        \"\u2014\"}\n      {!row.isIsolated && row.usageAsCollateralEnabled && (\n        <img\n          src={`${config.ipfsPrefix}/bafkreibsy5fzn67veowyalveo6t34rnqvktmok2zutdsp4f5slem3grc3i`}\n          width={16}\n          height={16}\n        />\n      )}\n    </div>,\n    <div style={{ display: \"flex\", gap: 10 }}>\n      <SupplyButton data={row} />\n\n      <BorrowButton\n        data={{\n          ...row,\n        }}\n      />\n    </div>,\n  ]);\n}\nif ([\"Pac Finance\"].includes(dexConfig.name)) {\n  headers = [\n    \"Assets\",\n    \"Your Balance\",\n    // \"Estimated Blast Points\",\n    \"Supply APY\",\n    \"Borrow APY\",\n    \"Pool Liquidity\",\n    // \"Can be Collateral\",\n    \"\",\n  ];\n  tableData = assetsToSupply.map((row) => [\n    <Widget\n      src={`${config.ownerId}/widget/AAVE.Card.TokenWrapper`}\n      props={{\n        children: [\n          <img width={64} height={64} src={row.icon} />,\n          <CenterItem>\n            <ItemPrimary style={{ fontWeight: 700 }}>{row.symbol}</ItemPrimary>\n            <ItemSub>LTV: {Big(row.LTV).times(100).toFixed()}%</ItemSub>\n          </CenterItem>,\n        ],\n      }}\n    />,\n    <CenterItem>\n      <ItemPrimary>{formatValue(row.balance, 7)}</ItemPrimary>\n      <ItemSub>{formatNumber(row.balanceInUSD)}</ItemSub>\n    </CenterItem>,\n    // <CenterItem>\n    //   <ItemPrimary>{}</ItemPrimary>\n    //   <ItemSub>{`Pts/day/${row.symbol}`}</ItemSub>\n    // </CenterItem>,\n    <CenterItem>\n      <ItemPrimary className=\"apy\">{`${(\n        (Number(row.supplyAPY) + Number(row.NATIVE_YIELD || 0)) *\n        100\n      ).toFixed(2)} %`}</ItemPrimary>\n      <ItemSub className=\"radio\">\n        <IconMouth src=\"https://ipfs.near.social/ipfs/bafkreiffqyfmusnew73zt6slkeoryvevuw7ojcgvfdirgf3oqdsll5yyga\" />\n        {Number(row.EXTRA_RADIO) * 100}%\n      </ItemSub>\n    </CenterItem>,\n    <CenterItem>\n      <ItemPrimary className=\"apy\">{`${(Number(row.borrowAPY) * 100).toFixed(\n        2\n      )} %`}</ItemPrimary>\n    </CenterItem>,\n    <CenterItem>\n      <ItemPrimary>\n        <Widget\n          src={`${config.ownerId}/widget/Utils.FormatNumber`}\n          props={{ number: row.totalSupply }}\n        />\n      </ItemPrimary>\n      <ItemSub>{formatRate(row.utilized)} utilized</ItemSub>\n    </CenterItem>,\n    // <CenterItem style={{ paddingLeft: \"50px\" }}>\n    //   {(row.isIsolated || (!row.isIsolated && !row.usageAsCollateralEnabled)) &&\n    //     \"\u2014\"}\n    //   {!row.isIsolated && row.usageAsCollateralEnabled && (\n    //     <img\n    //       src={`${config.ipfsPrefix}/bafkreibsy5fzn67veowyalveo6t34rnqvktmok2zutdsp4f5slem3grc3i`}\n    //       width={16}\n    //       height={16}\n    //     />\n    //   )}\n    // </CenterItem>,\n    <div style={{ display: \"flex\", gap: 10 }}>\n      <SupplyButton data={row} />\n      {row.supportBorrow ? (\n        <BorrowButton\n          data={{\n            ...row,\n          }}\n        />\n      ) : (\n        <div style={{ width: \"100%\" }}></div>\n      )}\n\n      {row.supportLoop ? (\n        <LoopButton data={row} />\n      ) : (\n        <div style={{ width: \"100%\" }}></div>\n      )}\n    </div>,\n  ]);\n}\nreturn (\n  <>\n    <Widget\n      src={`${config.ownerId}/widget/AAVE.Card.CardsView`}\n      props={{\n        config,\n        style: {\n          marginTop: \"16px\",\n        },\n        title: \"Market\",\n        body:\n          !assetsToSupply || assetsToSupply.length === 0 ? (\n            <Widget\n              src={`${config.ownerId}/widget/AAVE.Card.CardEmpty`}\n              props={{\n                config,\n                children: \"Nothing supplied yet\",\n              }}\n            />\n          ) : (\n            <>\n              <Widget\n                src={`${config.ownerId}/widget/AAVE.Card.CardsTable`}\n                props={{\n                  config,\n                  headers,\n                  data: tableData,\n                }}\n              />\n            </>\n          ),\n      }}\n    />\n    {showSupplyModal && (\n      <Widget\n        src={`${config.ownerId}/widget/AAVE.Modal.SupplyModal`}\n        props={{\n          config,\n          theme,\n          onRequestClose: () => setShowSupplyModal(false),\n          data: {\n            ...state.data,\n            healthFactor,\n          },\n          onActionSuccess,\n          chainId,\n          depositETHGas,\n          depositERC20Gas,\n          formatHealthFactor,\n          calcHealthFactor,\n          addAction,\n          dexConfig,\n        }}\n      />\n    )}\n    {state.showBorrowModal && (\n      <Widget\n        src={`${config.ownerId}/widget/AAVE.Modal.BorrowModal`}\n        props={{\n          config,\n          theme,\n          onRequestClose: () => {\n            State.update({\n              showBorrowModal: false,\n            });\n            // setShowBorrowModal(false)\n          },\n          data: {\n            ...state.data,\n            healthFactor,\n          },\n          onActionSuccess,\n          chainId,\n          borrowETHGas,\n          borrowERC20Gas,\n          formatHealthFactor,\n          calcHealthFactor,\n          addAction,\n          dexConfig,\n        }}\n      />\n    )}\n    {state.showLoopModal && (\n      <Widget\n        src={`${config.ownerId}/widget/AAVE.Modal.LoopModal`}\n        props={{\n          config,\n          theme,\n          // onRequestClose: () => setShowSupplyModal(false),\n          onRequestClose: () => {\n            State.update({\n              showLoopModal: false,\n            });\n          },\n          data: {\n            ...state.data,\n            healthFactor,\n          },\n          onActionSuccess,\n          chainId,\n          depositETHGas,\n          depositERC20Gas,\n          formatHealthFactor,\n          calcHealthFactor,\n          addAction,\n          dexConfig,\n        }}\n      />\n    )}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/AAVE.Card.Markets", "fact_widget_deployments_id": "be7eed83f4dc41bca4b11fb7071bf691", "inserted_timestamp": "2024-04-19T07:40:30.999Z", "modified_timestamp": "2024-04-19T07:40:30.999Z", "__row_index": 5}