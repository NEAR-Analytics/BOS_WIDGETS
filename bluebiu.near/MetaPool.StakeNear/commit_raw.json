{"tx_hash": "5S1ZK7MQian1YD1SYT3s7i6XYPjXxZDKFeLHXvui4u6w", "action_id_social": "9yVpj6babRp2ttX6y9xgwA691h7iAKMiagzZ3UzQ8Ete-0-widget", "block_id": 101395489, "block_timestamp": "2023-09-18T10:23:47.408Z", "signer_id": "bluebiu.near", "widget_name": "MetaPool.StakeNear", "source_code": "const {\n  chain,\n  stnearPrice,\n  stnearPriceUsd,\n  nearUsdPrice,\n  token,\n  lpToken,\n  contractId,\n  contractData,\n  network,\n} = props;\n\nconst Button = styled.div`\n  font-size: 14px;\n  font-weight: 500;\n  color: rgba(51, 44, 75, 1);\n  background-color: #c7ff18;\n  border-radius: 6px;\n  width: 80px;\n  height: 36px;\n  line-height: 36px;\n  text-align: center;\n  flex-shrink: 0;\n  margin-left: 10px;\n  cursor: pointer;\n`;\nconst StakeWrapper = styled.div`\n  @media (max-width: 768px) {\n    padding: 0px 20px 20px;\n  }\n`;\nconst StakeNear = styled.div`\n  @media (max-width: 768px) {\n    padding-top: 20px;\n  }\n`;\nconst CollectWalletTips = styled.div`\n  display: flex;\n  background-color: rgba(199, 255, 24, 0.2);\n  height: 39px;\n  border-radius: 8px;\n  padding: 0px 20px;\n  align-items: center;\n`;\nconst ButtonLabel = styled.div`\n  font-size: 16px;\n  font-weight: 600;\n  color: #fff;\n  padding-left: 10px;\n  .sp {\n    color: #c7ff18;\n  }\n`;\n\nconst nearAccount = context.accountId;\n\nState.init({\n  stakeType: 0, // 0 for stake, 1 for fastunstake, 2 for delayed stake\n  stakable: false,\n  amount: \"\",\n  balanceLoading: false,\n  amountOut: \"\",\n  isUpdateAccountInfo: true,\n});\n\nconst utils = {\n  formatGetValue: (amount) => {\n    if (!amount || parseFloat(amount) <= 0 || !stnearPriceUsd) return 0;\n    if (state.stakeType === 0) {\n      return (amount / stnearPrice).toFixed(5);\n    }\n    if (state.stakeType === 1) {\n      return Big(amount * stnearPrice)\n        .mul(0.997)\n        .toFixed(5);\n    }\n    if (state.stakeType === 2) {\n      return (amount * stnearPrice).toFixed(5);\n    }\n  },\n  formatWithdrawalsTime: () => {\n    return \"\";\n    // September 22nd, 06:17\n  },\n};\n\nconst getBalance = () => {\n  if (!nearAccount) return;\n  asyncFetch(network, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify({\n      jsonrpc: \"2.0\",\n      id: \"dontcare\",\n      method: \"query\",\n      params: {\n        request_type: \"view_account\",\n        finality: \"final\",\n        account_id: nearAccount,\n      },\n    }),\n  })\n    .then((res) => {\n      const amount = res.body.result.amount;\n      const balance = amount\n        ? Big(ethers.utils.formatUnits(amount, 24)).toFixed(4, 0)\n        : \"0\";\n      if (\n        Big(balance)\n          .sub(state.balance || 0)\n          .abs()\n          .gt(0.5)\n      ) {\n        State.update({\n          balanceLoading: false,\n          balance,\n        });\n      } else {\n        setTimeout(() => {\n          getBalance();\n        }, 500);\n      }\n    })\n    .catch((err) => {\n      State.update({\n        balanceLoading: false,\n        balance: \"0\",\n      });\n    });\n};\n\nconst renderButton = () => {\n  if (!nearAccount) {\n    return (\n      <CollectWalletTips>\n        <svg\n          width=\"20px\"\n          height=\"20px\"\n          viewBox=\"0 0 20 20\"\n          fill=\"none\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n          className=\"icon\"\n        >\n          <path\n            d=\"M10 2.94047e-06C15.5137 3.42249e-06 20 4.48558 20 10C20 15.5137 15.5137 20 10 20C4.48558 20 -3.42256e-06 15.5144 -2.94047e-06 10C-2.45838e-06 4.48558 4.48558 2.45838e-06 10 2.94047e-06ZM10 18.5651C14.7231 18.5651 18.5651 14.7231 18.5651 10C18.5651 5.27766 14.7231 1.43493 10 1.43493C5.27766 1.43493 1.43492 5.27694 1.43492 10C1.43492 14.7231 5.27766 18.5651 10 18.5651ZM11.0762 14.6635C11.0762 14.3781 10.9628 14.1044 10.761 13.9025C10.5592 13.7007 10.2854 13.5873 10 13.5873C9.71457 13.5873 9.44084 13.7007 9.23901 13.9025C9.03719 14.1044 8.9238 14.3781 8.9238 14.6635C8.9238 14.9489 9.03719 15.2227 9.23901 15.4245C9.44084 15.6263 9.71457 15.7397 10 15.7397C10.2854 15.7397 10.5592 15.6263 10.761 15.4245C10.9628 15.2227 11.0762 14.9489 11.0762 14.6635ZM10 4.2603C10.396 4.2603 10.7175 4.581 10.7175 4.97776L10.7175 11.4349C10.7175 11.831 10.396 12.1524 10 12.1524C9.60396 12.1524 9.28254 11.831 9.28254 11.4349L9.28254 4.97776C9.28254 4.581 9.60396 4.2603 10 4.2603Z\"\n            fill=\"#C7FF18\"\n          />\n        </svg>\n        <ButtonLabel>\n          Click top right button to{\" \"}\n          <span className=\"sp\">Connect Near Wallet</span>\n        </ButtonLabel>\n      </CollectWalletTips>\n    );\n  }\n  return (\n    <Widget\n      src=\"bluebiu.near/widget/MetaPool.StakeNearButton\"\n      props={{\n        disabled: !state.stakable,\n        amount: state.amount,\n        amountOut: state.amountOut,\n        lpToken,\n        stakedBalance: state.stakedBalance,\n        stakeType: state.stakeType,\n        contractId,\n        stnearPriceUsd,\n        onSuccess: () => {\n          if (state.stakeType === 0) {\n            getBalance();\n            return;\n          }\n          State.update({\n            amount: \"\",\n            errorTips: \"\",\n            amountOut: \"\",\n            isUpdateAccountInfo: true,\n          });\n        },\n      }}\n    />\n  );\n};\n\nif (!state.balance) {\n  getBalance();\n}\n\nreturn (\n  <StakeNear>\n    <Widget\n      src=\"bluebiu.near/widget/MetaPool.StakeNearAccountInfo\"\n      props={{\n        contractId,\n        isUpdate: state.isUpdateAccountInfo,\n        account: nearAccount,\n        onLoad: (data) => {\n          if (\n            data.stakedBalance &&\n            Big(data.stakedBalance)\n              .sub(state.stakedBalance || 0)\n              .abs()\n              .gt(0.5)\n          ) {\n            State.update({\n              isUpdateAccountInfo: false,\n              ...data,\n            });\n          }\n        },\n      }}\n    />\n    <Widget\n      src=\"bluebiu.near/widget/MetaPool.Switcher\"\n      props={{\n        type: state.stakeType,\n        onChange: (stakeType) => {\n          State.update({\n            stakeType,\n            amount: \"\",\n            amountOut: \"\",\n            isUpdateAccountInfo: !!stakeType,\n            errorTips: \"\",\n          });\n        },\n      }}\n    />\n    <StakeWrapper>\n      {false ? (\n        <div className=\"mt_20\">\n          <Widget\n            src=\"bluebiu.near/widget/MetaPool.Alert\"\n            props={{\n              text: (\n                <span>\n                  The promotional launch period is a great opportunity to earn\n                  up to {nearApy}% APY, but keep in mind that your tokens will\n                  be locked until{\" \"}\n                  <span className=\"fw_700\">\n                    {utils.formatWithdrawalsTime()}\n                  </span>\n                  . After that, you'll be able to unstake them and withdraw your\n                  earnings.\n                </span>\n              ),\n            }}\n          />\n        </div>\n      ) : (\n        <>\n          {state.stakeType === 2 && (\n            <div className=\"mt_20\">\n              <Widget\n                src=\"bluebiu.near/widget/MetaPool.Alert\"\n                props={{\n                  text: `Delayed unstake takes up to 6 days to complete.`,\n                  button: (\n                    <Button\n                      onClick={() => {\n                        State.update({\n                          stakeType: 1,\n                          amount: \"\",\n                          amountOut: \"\",\n                          errorTips: \"\",\n                        });\n                      }}\n                    >\n                      Try fast\n                    </Button>\n                  ),\n                }}\n              />\n            </div>\n          )}\n          <Widget\n            src=\"bluebiu.near/widget/MetaPool.StakeInput\"\n            props={{\n              stakeType: state.stakeType,\n              price: nearUsdPrice || 0,\n              amount: state.amount,\n              errorTips: state.errorTips,\n              balance: state.stakeType ? state.stakedBalance : state.balance,\n              balanceLoading: state.balanceLoading,\n              token,\n              lpToken,\n              onAmountChange: (amount, errorTips) => {\n                const balance = state.stakeType\n                  ? state.stakedBalance\n                  : state.balance;\n                State.update({\n                  amount,\n                  errorTips,\n                  stakable:\n                    Number(amount) &&\n                    !isNaN(Number(balance)) &&\n                    !Big(balance).lt(amount) &&\n                    !Big(amount).lt(1),\n                  amountOut: utils.formatGetValue(amount),\n                });\n              },\n            }}\n          />\n          <Widget\n            src=\"bluebiu.near/widget/MetaPool.StakeResult\"\n            props={{\n              chain,\n              lpToken,\n              token,\n              stakeType: state.stakeType,\n              value: state.amountOut,\n              stnearPrice,\n            }}\n          />\n          {state.stakeType === 1 && (\n            <div className=\"mt_20\">\n              <Widget\n                src=\"bluebiu.near/widget/MetaPool.Alert\"\n                props={{\n                  text: `Fee is 0.3%`,\n                }}\n              />\n            </div>\n          )}\n          {state.stakeType === 2 && !!Number(state.amount) && (\n            <div className=\"mt_20\">\n              <Widget\n                src=\"bluebiu.near/widget/MetaPool.Alert\"\n                props={{\n                  text: `Funds will be available in approximately 2 days 0 hours.\n                    You will NOT receive rewards during that period.`,\n                }}\n              />\n            </div>\n          )}\n          <div className=\"mt_20\">{renderButton()}</div>\n        </>\n      )}\n    </StakeWrapper>\n  </StakeNear>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bluebiu.near/widget/MetaPool.StakeNear", "fact_widget_deployments_id": "eb65e308818c719f8fe6b426eb9435ad", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 4}