{"tx_hash": "6HkBtbQW9xHLj3WF6TWXzFeskxqXWQCh7Yiu3SaqUQbb", "action_id_social": "9zqmwEezKz8ko8hVxToo1mMRtbUmCF3x4kmmtsMGoyC9-0-widget", "block_id": 114035257, "block_timestamp": "2024-03-03T21:01:11.275Z", "signer_id": "sdks.near", "widget_name": "SDKs.Verifiers.FarcasterVerifier", "source_code": "const $ = VM.require(\"sdks.near/widget/Loader\");\nconst { EthereumSigner } = $(\"@sdks/eth-signer\");\nconst FarcasterAPI = VM.require(`sdks.near/widget/SDKs.Farcaster.FarcasterAPI`);\n\nconst FarcasterVerifier = {\n  createProof: (handle, evmAddress, nearAccount) => {\n    return FarcasterAPI.getHandleOwner(handle).then((expectedAddresses) => {\n      if (!expectedAddresses.includes(evmAddress)) {\n        return new Promise((_, reject) =>\n          reject(\"This Ethereum address is not linked to this handle\")\n        );\n      }\n\n      return FarcasterVerifier.sign(handle, nearAccount, evmAddress).then(\n        (signature) => {\n          return {\n            handle,\n            signature,\n          };\n        }\n      );\n    });\n  },\n  sign: (handle, nearAccount, evmAddress) => {\n    return EthereumSigner.sign(\n      FarcasterVerifier.getChallenge(handle, nearAccount, evmAddress)\n    );\n  },\n  verify: (handle, nearAccount, signature) => {\n    return FarcasterAPI.getHandleOwner(handle).then((expectedAddresses) => {\n      return (\n        expectedAddresses\n          .map((expectedAddress) => {\n            const message = FarcasterVerifier.getChallenge(\n              handle,\n              nearAccount,\n              expectedAddress\n            );\n\n            return EthereumSigner.verify(message, signature, expectedAddress);\n          })\n          .filter((verification) => verification).length > 0\n      );\n    });\n  },\n  getChallenge: (handle, nearAccount, address) => {\n    return `${nearAccount.toLowerCase()} with address ${address.toLowerCase()} owns the ${handle.toLowerCase()} handle on farcaster`;\n  },\n};\n\nreturn FarcasterVerifier;\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/sdks.near/widget/SDKs.Verifiers.FarcasterVerifier", "fact_widget_deployments_id": "9b6a8b24daa3a0d61b8f986a4b214bb6", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 1}