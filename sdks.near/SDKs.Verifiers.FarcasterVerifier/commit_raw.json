{"tx_hash": "4Etfx4RDpb97NPicE4vGfvKgn43rZFo88PibF7cyHQQs", "action_id_social": "G1Sk4QryYbrpdstR78CaDM5tejoPoTW1tZG4tzqvZH7F-0-widget", "block_id": 114040867, "block_timestamp": "2024-03-03T23:08:17.784Z", "signer_id": "sdks.near", "widget_name": "SDKs.Verifiers.FarcasterVerifier", "source_code": "const $ = VM.require(\"sdks.near/widget/Loader\");\nconst { EthereumSigner } = $(\"@sdks/eth-signer\");\nconst FarcasterAPI = VM.require(`sdks.near/widget/SDKs.Farcaster.FarcasterAPI`);\n\nconst FarcasterVerifier = {\n  createProof: (handle, evmAddress, nearAccount) => {\n    return FarcasterAPI.getHandleOwner(handle).then((expectedAddresses) => {\n      console.log(expectedAddresses, evmAddress, evmAddress.toLowerCase());\n      if (!expectedAddresses.includes(evmAddress.toLowerCase())) {\n        return new Promise((_, reject) =>\n          reject(\"This Ethereum address is not linked to this handle\")\n        );\n      }\n\n      return FarcasterVerifier.sign(handle, nearAccount, evmAddress).then(\n        (signature) => {\n          return {\n            handle,\n            signature,\n          };\n        }\n      );\n    });\n  },\n  sign: (handle, nearAccount, evmAddress) => {\n    return EthereumSigner.sign(\n      FarcasterVerifier.getChallenge(handle, nearAccount, evmAddress)\n    );\n  },\n  verify: (handle, nearAccount, signature) => {\n    return FarcasterAPI.getHandleOwner(handle).then((expectedAddresses) => {\n      return (\n        expectedAddresses\n          .map((expectedAddress) => {\n            const message = FarcasterVerifier.getChallenge(\n              handle,\n              nearAccount,\n              expectedAddress\n            );\n\n            return EthereumSigner.verify(message, signature, expectedAddress);\n          })\n          .filter((verification) => verification).length > 0\n      );\n    });\n  },\n  getChallenge: (handle, nearAccount, address) => {\n    return `${nearAccount.toLowerCase()} with address ${address.toLowerCase()} owns the ${handle.toLowerCase()} handle on farcaster`;\n  },\n};\n\nreturn FarcasterVerifier;\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/sdks.near/widget/SDKs.Verifiers.FarcasterVerifier", "fact_widget_deployments_id": "3a32edafba9611ea3458200983c8d55d", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}