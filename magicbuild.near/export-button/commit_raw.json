{"tx_hash": "boH8iNPqaEQBJDpSshCWDe6Wf8CMW4GxqeraxkkStCi", "action_id_social": "G4tBBHrcWQEeTrnnCkNsupX6XmeVcM6rBUVdzJHBzpxW-0-widget", "block_id": 105077384, "block_timestamp": "2023-11-06T14:18:35.367Z", "signer_id": "magicbuild.near", "widget_name": "export-button", "source_code": "State.init({\r\n  cMethod: props.cMethod,\r\n  widgetName: props.widgetName || `MagicBuild-widget-form-${Date.now()}`,\r\n  name: \"\",\r\n  description: \"\",\r\n  website: \"\",\r\n  image: {\r\n    ipfs_cid: \"\",\r\n  },\r\n  tags: {},\r\n  clicked: false,\r\n  export: false,\r\n  img: null,\r\n  tags,\r\n  choose,\r\n});\r\nconst onInputChangeWidgetName = ({ target }) => {\r\n  State.update({ widgetName: target.value.replaceAll(\" \", \"-\") });\r\n  State.update({ clicked: false });\r\n  State.update({ export: false });\r\n};\r\nconst onInputChangeWidgetTitle = ({ target }) => {\r\n  State.update({ name: target.value });\r\n};\r\nconst onInputChangeWidgetDescription = ({ target }) => {\r\n  State.update({ description: target.value });\r\n};\r\nconst onInputChangeWidgetWebsite = ({ target }) => {\r\n  State.update({ website: target.value });\r\n};\r\nconst uploadFileUpdateState = (body) => {\r\n  asyncFetch(\"https://ipfs.near.social/add\", {\r\n    method: \"POST\",\r\n    headers: { Accept: \"application/json\" },\r\n    body,\r\n  }).then((res) => {\r\n    const cid = res.body.cid;\r\n    State.update({ image: { ipfs_cid: cid } });\r\n    State.update({ img: { cid } });\r\n  });\r\n};\r\n\r\nconst filesOnChange = (files) => {\r\n  if (files) {\r\n    State.update({ img: { uploading: true, cid: null } });\r\n    uploadFileUpdateState(files[0]);\r\n  }\r\n};\r\n\r\nconst openModal = () => {\r\n  const taggedWidgets = Social.keys(`*/widget/*/metadata/tags/*`, \"final\");\r\n  let tags = [];\r\n  Object.keys(taggedWidgets).forEach((item) => {\r\n    if (taggedWidgets[item].widget) {\r\n      if (Object.keys(taggedWidgets[item].widget).length > 0) {\r\n        Object.keys(taggedWidgets[item].widget).forEach((item1) => {\r\n          if (taggedWidgets[item].widget[item1].metadata.tags) {\r\n            if (\r\n              Object.keys(taggedWidgets[item].widget[item1].metadata.tags)\r\n                .length > 0\r\n            ) {\r\n              Object.keys(\r\n                taggedWidgets[item].widget[item1].metadata.tags\r\n              ).forEach((tag) => {\r\n                tags.push(tag);\r\n              });\r\n            }\r\n          }\r\n        });\r\n      }\r\n    }\r\n  });\r\n  State.update({ tags: tags });\r\n  State.update({ clicked: false });\r\n  State.update({ export: false });\r\n};\r\nconst exportForm = () => {\r\n  if (!state.clicked) {\r\n    State.update({ clicked: true });\r\n    const abi = {\r\n      schema_version: \"0.3.0\",\r\n      address: props.contractAddress,\r\n      cssStyle: props.cssStyle,\r\n      metadata: {\r\n        name: \"\",\r\n        version: \"0.1.0\",\r\n        authors: [\"\"],\r\n      },\r\n      body: {\r\n        functions: [],\r\n      },\r\n    };\r\n\r\n    const tagsObj = state.choose.reduce((accumulator, value) => {\r\n      return { ...accumulator, [value]: \"\" };\r\n    }, {});\r\n    const abiMethod = state.cMethod;\r\n    abiMethod.forEach((item) => {\r\n      abi.body.functions.push(item);\r\n    });\r\n    const exportListData = Social.get(\r\n      `${context.accountId}/magicbuild/widgetList`\r\n    );\r\n    const exporttList = JSON.parse(exportListData) || [];\r\n\r\n    const isExist = false;\r\n    exporttList.forEach((item, index) => {\r\n      if (item.widgetName == state.widgetName) {\r\n        exporttList[index].widgetName = state.widgetName;\r\n        isExist = true;\r\n      }\r\n    });\r\n    if (!isExist) {\r\n      exporttList.push({ widgetName: state.widgetName });\r\n    }\r\n\r\n    const data = {\r\n      widget: {\r\n        [state.widgetName]: {\r\n          \"\":\r\n            \"const user = context.accountId;\\r\\nconst props = \" +\r\n            JSON.stringify(abi).replaceAll(\"\\\\\", \"\") +\r\n            \" \\r\\n\\r\\nreturn (\\r\\n  <>\\r\\n    <Widget src={'magicbuild.near/widget/widget'} props={props} />\\r\\n  </>\\r\\n);\\r\\n\",\r\n          metadata: {\r\n            name: state.name,\r\n            description: state.description,\r\n            linktree: {\r\n              website: state.website,\r\n            },\r\n            image: {\r\n              ipfs_cid: state.img.cid,\r\n            },\r\n            tags: tagsObj,\r\n          },\r\n        },\r\n      },\r\n      magicbuild: { widgetList: exporttList },\r\n    };\r\n    Social.set(data, {\r\n      force: true,\r\n      onCommit: () => {\r\n        State.update({ export: true });\r\n      },\r\n      onCancel: () => {\r\n        State.update({ clicked: false });\r\n      },\r\n    });\r\n  }\r\n};\r\nreturn (\r\n  <>\r\n    <label></label>\r\n    <button\r\n      data-bs-toggle=\"modal\"\r\n      data-bs-target={`#export-${Date.now()}`}\r\n      class=\"btn btn-primary form-control \"\r\n      onClick={openModal}\r\n    >\r\n      \ud83d\udd3cExport\r\n    </button>\r\n    <div\r\n      class=\"modal fade\"\r\n      id={`export-${Date.now()}`}\r\n      tabindex=\"-2\"\r\n      aria-labelledby=\"exportLabel\"\r\n      aria-hidden=\"true\"\r\n    >\r\n      <div class=\"modal-dialog\">\r\n        <div class=\"modal-content\">\r\n          <div class=\"modal-header\">\r\n            <h1 class=\"modal-title fs-5\" id=\"exportLabel\">\r\n              Export Widget\r\n            </h1>\r\n            <button\r\n              type=\"button\"\r\n              class=\"btn-close\"\r\n              data-bs-dismiss=\"modal\"\r\n              aria-label=\"Close\"\r\n            ></button>\r\n          </div>\r\n          <div class=\"modal-body\">\r\n            {state.export && state.widgetName ? (\r\n              <>\r\n                <hr />\r\n                <h5>Export Success</h5>\r\n                <div class=\"alert alert-primary\" role=\"alert\">\r\n                  <a\r\n                    href={`https://near.social/${context.accountId}/widget/${state.widgetName}`}\r\n                  >\r\n                    {`https://near.social/${context.accountId}/widget/${state.widgetName}`}\r\n                  </a>\r\n                </div>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <div class=\"form-group\">\r\n                  <label>Widget URL</label>\r\n                  <input\r\n                    class=\"form-control\"\r\n                    defaultValue={state.widgetName || \"\"}\r\n                    onChange={(e) => onInputChangeWidgetName(e)}\r\n                  />\r\n                  <small class=\"form-text text-muted\">\r\n                    A new widget configured with the form will be created.\r\n                  </small>\r\n                </div>\r\n                <div class=\"form-group pt-2\">\r\n                  <label>Name</label>\r\n                  <input\r\n                    class=\"form-control\"\r\n                    defaultValue={state.name || \"\"}\r\n                    onChange={(e) => onInputChangeWidgetTitle(e)}\r\n                  />\r\n                </div>\r\n                <div class=\"form-group pt-2\">\r\n                  <label>Description</label>\r\n                  <input\r\n                    class=\"form-control\"\r\n                    defaultValue={state.description || \"\"}\r\n                    onChange={(e) => onInputChangeWidgetDescription(e)}\r\n                  />\r\n                </div>\r\n                <div class=\"form-group pt-2\">\r\n                  <label></label>\r\n                  <Files\r\n                    multiple={false}\r\n                    accepts={[\"image/*\"]}\r\n                    minFileSize={1}\r\n                    clickable\r\n                    className=\"btn btn-outline-primary\"\r\n                    onChange={filesOnChange}\r\n                  >\r\n                    {state.img?.uploading ? (\r\n                      <> Uploading </>\r\n                    ) : (\r\n                      \"Upload Logo Application\"\r\n                    )}\r\n                  </Files>\r\n                </div>\r\n                <div class=\"form-group pt-2\">\r\n                  <label></label>\r\n                  {state.img && !state.img.uploading ? (\r\n                    <img\r\n                      class=\"rounded w-50 h-50\"\r\n                      style={{ objectFit: \"cover\" }}\r\n                      src={`https://ipfs.near.social/ipfs/${state.img.cid}`}\r\n                      alt=\"upload preview\"\r\n                    />\r\n                  ) : (\r\n                    \"\"\r\n                  )}\r\n                </div>\r\n                <div class=\"form-group pt-2\">\r\n                  <label>Website</label>\r\n                  <input\r\n                    class=\"form-control\"\r\n                    defaultValue={state.website || \"\"}\r\n                    onChange={(e) => onInputChangeWidgetWebsite(e)}\r\n                  />\r\n                </div>\r\n                <div class=\"form-group pt-2\">\r\n                  <label>Tags</label>\r\n\r\n                  <Typeahead\r\n                    options={state.tags || []}\r\n                    multiple\r\n                    onChange={(value) => {\r\n                      State.update({ choose: value });\r\n                    }}\r\n                    placeholder=\"Input tag...\"\r\n                  />\r\n                </div>\r\n              </>\r\n            )}\r\n          </div>\r\n          <div class=\"modal-footer\">\r\n            <button\r\n              type=\"button\"\r\n              class=\"btn btn-secondary\"\r\n              data-bs-dismiss=\"modal\"\r\n            >\r\n              Close\r\n            </button>\r\n\r\n            <button\r\n              type=\"button\"\r\n              disabled={state.clicked}\r\n              onClick={exportForm}\r\n              class=\"btn btn-primary\"\r\n            >\r\n              Export\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/magicbuild.near/widget/export-button", "fact_widget_deployments_id": "234075dfa6e440a92560b306016d1973", "inserted_timestamp": "2023-11-06T16:24:22.201Z", "modified_timestamp": "2023-11-06T16:24:22.201Z", "__row_index": 68}