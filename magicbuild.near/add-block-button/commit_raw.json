{"tx_hash": "6w3REbmdHZaM4wh9iZBD9HiGx1LU3gvmoSY93pU2MmaY", "action_id_social": "2c5AER959EtvpuLPdK1uQJHS2PdSZDKtm2oL9QGrysw1-0-widget", "block_id": 113769319, "block_timestamp": "2024-02-28T19:14:15.921Z", "signer_id": "magicbuild.near", "widget_name": "add-block-button", "source_code": "State.init({\r\n  blockList: {},\r\n  openModalBlock: false,\r\n  clickedModalBlock: false,\r\n});\r\n\r\nconst selectWidget = props.selectWidget ?? (() => {});\r\n\r\nconst loadData = () => {\r\n  const widgetListGet = Social.get(\r\n    `${context.accountId}/magicbuild/widgetList`\r\n  );\r\n  if (widgetListGet) {\r\n    const widgetList = JSON.parse(widgetListGet);\r\n    const widgetLogo = {};\r\n    for (const widget of widgetList) {\r\n      const logoWidgets = Social.get(\r\n        `${context.accountId}/widget/${widget.widgetName}/metadata/image/ipfs_cid`\r\n      );\r\n      const widgetName = widget.widgetName;\r\n      if (logoWidgets) Object.assign(widgetLogo, { [widgetName]: logoWidgets });\r\n    }\r\n    State.update({ widgetLogo: widgetLogo });\r\n    State.update({ clientList: clientListData });\r\n  }\r\n\r\n  const blockWidgetPattern = {\r\n    stack: {\r\n      widgetName: \"Stack\",\r\n      widgetUrl: \"magicbuild.near/widget/ui-stack\",\r\n      props: {},\r\n      type: \"block\",\r\n    },\r\n  };\r\n  State.update({ blockWidgetPattern: blockWidgetPattern });\r\n};\r\nloadData();\r\n\r\nconst addBlock = (widgetUrl, widgetProps) => {\r\n  const id = Date.now();\r\n  const block = {\r\n    [id]: {\r\n      widgetUrl: widgetUrl,\r\n      props: widgetProps || {},\r\n      type: \"block\",\r\n    },\r\n  };\r\n  State.update({ openModalBlock: false });\r\n};\r\nconst openModalBlock = (e, type) => {\r\n  if (type == \"show\") {\r\n    State.update({ openModalBlock: true, clicked: false });\r\n  }\r\n  if (type == \"close\") {\r\n    State.update({ selectBlock: null, selectPositionBlock: null });\r\n    State.update({ openModalBlock: false });\r\n  }\r\n};\r\n\r\nconst selectLayout = (layoutType) => {\r\n  const id = Date.now();\r\n  const block = {\r\n    [id]: { layoutType: layoutType, type: \"layout\" },\r\n  };\r\n  State.update({ openModalBlock: false });\r\n};\r\n\r\nreturn (\r\n  <>\r\n    {state.openModalBlock && (\r\n      <>\r\n        <div\r\n          style={{ display: \"block\" }}\r\n          className={`modal fade show`}\r\n          id=\"addBlock\"\r\n          tabindex=\"-1\"\r\n          aria-labelledby=\"addBlockLabel\"\r\n        >\r\n          <div class=\"modal-dialog modal-lg\">\r\n            <div class=\"modal-content\">\r\n              <div class=\"modal-header\">\r\n                <h1 class=\"modal-title fs-5\" id=\"addBlockLabel\">\r\n                  Choose Block\r\n                </h1>\r\n                <button\r\n                  type=\"button\"\r\n                  class=\"btn-close\"\r\n                  onClick={(e) => openModalBlock(e, \"close\")}\r\n                ></button>\r\n              </div>\r\n              <div class=\"modal-body\">\r\n                <ul class=\"nav nav-tabs\" role=\"tablistBlock\">\r\n                  {!state.selectBlock && (\r\n                    <li class=\"nav-item\" role=\"presentation\">\r\n                      <span\r\n                        class=\"nav-link px-3 \"\r\n                        id=\"layout-tab\"\r\n                        data-bs-toggle=\"pill\"\r\n                        data-bs-target=\"#pills-layout-list\"\r\n                        type=\"button\"\r\n                        role=\"tab\"\r\n                        aria-controls=\"pills-layout-list\"\r\n                        aria-selected=\"true\"\r\n                      >\r\n                        Layout\r\n                      </span>\r\n                    </li>\r\n                  )}\r\n                  <li class=\"nav-item\" role=\"presentation\">\r\n                    <span\r\n                      class=\"nav-link px-3 active \"\r\n                      id=\"block-list-tab\"\r\n                      data-bs-toggle=\"pill\"\r\n                      data-bs-target=\"#pills-block-list\"\r\n                      type=\"button\"\r\n                      role=\"tab\"\r\n                      aria-controls=\"pills-block-list-label\"\r\n                      aria-selected=\"true\"\r\n                    >\r\n                      Block\r\n                    </span>\r\n                  </li>\r\n\r\n                  <li class=\"nav-item\" role=\"presentation\">\r\n                    <span\r\n                      class=\"nav-link px-3\"\r\n                      id=\"export-list-tab\"\r\n                      data-bs-toggle=\"pill\"\r\n                      data-bs-target=\"#pills-export-list\"\r\n                      type=\"button\"\r\n                      role=\"tab\"\r\n                      aria-controls=\"pills-export-list\"\r\n                      aria-selected=\"true\"\r\n                    >\r\n                      Your Exported\r\n                    </span>\r\n                  </li>\r\n                  <li class=\"nav-item\" role=\"presentation\">\r\n                    <span\r\n                      class=\"nav-link px-3\"\r\n                      id=\"export-self-customize-tab\"\r\n                      data-bs-toggle=\"pill\"\r\n                      data-bs-target=\"#pills-self-customize-list\"\r\n                      type=\"button\"\r\n                      role=\"tab\"\r\n                      aria-controls=\"pills-self-customize-list\"\r\n                      aria-selected=\"true\"\r\n                    >\r\n                      Import Widget\r\n                    </span>\r\n                  </li>\r\n                </ul>\r\n\r\n                <div class=\"tab-content\">\r\n                  <div\r\n                    class=\"tab-pane fade \"\r\n                    id={`pills-layout-list`}\r\n                    role=\"tabpanel\"\r\n                    aria-labelledby={`pills-tab-layout-list`}\r\n                    tabindex=\"0\"\r\n                  >\r\n                    <div class=\"row m-3 overflow-auto \">\r\n                      <div class=\"col m-2\">\r\n                        {state.blockData}\r\n                        <div\r\n                          class=\"card p-2 align-items-center\"\r\n                          style={{ width: \"130px\" }}\r\n                          onClick={(e) => selectLayout(\"50-50\")}\r\n                        >\r\n                          <svg\r\n                            width=\"48\"\r\n                            height=\"48\"\r\n                            viewBox=\"0 0 48 48\"\r\n                            xmlns=\"http://www.w3.org/2000/svg\"\r\n                            aria-hidden=\"true\"\r\n                            focusable=\"false\"\r\n                          >\r\n                            <path\r\n                              fill-rule=\"evenodd\"\r\n                              clip-rule=\"evenodd\"\r\n                              d=\"M39 12C40.1046 12 41 12.8954 41 14V34C41 35.1046 40.1046 36 39 36H9C7.89543 36 7 35.1046 7 34V14C7 12.8954 7.89543 12 9 12H39ZM39 34V14H25V34H39ZM23 34H9V14H23V34Z\"\r\n                            ></path>\r\n                          </svg>\r\n                          <div class=\"card-body p-0\">\r\n                            <span\r\n                              class=\"card-text  d-inline-block text-truncate \"\r\n                              style={{\r\n                                maxWidth: \"120px\",\r\n                                fontWeight: \"bold\",\r\n                              }}\r\n                            >\r\n                              50/50\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                      <div class=\"col m-2\">\r\n                        <div\r\n                          class=\"card p-2 align-items-center\"\r\n                          style={{ width: \"130px\" }}\r\n                          onClick={(e) => selectLayout(\"33-66\")}\r\n                        >\r\n                          <svg\r\n                            width=\"48\"\r\n                            height=\"48\"\r\n                            viewBox=\"0 0 48 48\"\r\n                            xmlns=\"http://www.w3.org/2000/svg\"\r\n                            aria-hidden=\"true\"\r\n                            focusable=\"false\"\r\n                          >\r\n                            <path\r\n                              fill-rule=\"evenodd\"\r\n                              clip-rule=\"evenodd\"\r\n                              d=\"M39 12C40.1046 12 41 12.8954 41 14V34C41 35.1046 40.1046 36 39 36H9C7.89543 36 7 35.1046 7 34V14C7 12.8954 7.89543 12 9 12H39ZM39 34V14H20V34H39ZM18 34H9V14H18V34Z\"\r\n                            ></path>\r\n                          </svg>\r\n                          <div class=\"card-body p-0\">\r\n                            <span\r\n                              class=\"card-text  d-inline-block text-truncate \"\r\n                              style={{\r\n                                maxWidth: \"120px\",\r\n                                fontWeight: \"bold\",\r\n                              }}\r\n                            >\r\n                              33/66\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                      <div class=\"col m-2 \">\r\n                        <div\r\n                          class=\"card p-2 align-items-center\"\r\n                          style={{ width: \"130px\" }}\r\n                          onClick={(e) => selectLayout(\"66-33\")}\r\n                        >\r\n                          <svg\r\n                            width=\"48\"\r\n                            height=\"48\"\r\n                            viewBox=\"0 0 48 48\"\r\n                            xmlns=\"http://www.w3.org/2000/svg\"\r\n                            aria-hidden=\"true\"\r\n                            focusable=\"false\"\r\n                          >\r\n                            <path\r\n                              fill-rule=\"evenodd\"\r\n                              clip-rule=\"evenodd\"\r\n                              d=\"M39 12C40.1046 12 41 12.8954 41 14V34C41 35.1046 40.1046 36 39 36H9C7.89543 36 7 35.1046 7 34V14C7 12.8954 7.89543 12 9 12H39ZM39 34V14H30V34H39ZM28 34H9V14H28V34Z\"\r\n                            ></path>\r\n                          </svg>\r\n                          <div class=\"card-body p-0\">\r\n                            <span\r\n                              class=\"card-text  d-inline-block text-truncate \"\r\n                              style={{\r\n                                maxWidth: \"120px\",\r\n                                fontWeight: \"bold\",\r\n                              }}\r\n                            >\r\n                              66/33\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                      <div class=\"col m-2 \">\r\n                        <div\r\n                          class=\"card p-2 align-items-center\"\r\n                          style={{ width: \"130px\" }}\r\n                          onClick={(e) => selectLayout(\"33-33-33\")}\r\n                        >\r\n                          <svg\r\n                            width=\"48\"\r\n                            height=\"48\"\r\n                            viewBox=\"0 0 48 48\"\r\n                            xmlns=\"http://www.w3.org/2000/svg\"\r\n                            aria-hidden=\"true\"\r\n                            focusable=\"false\"\r\n                          >\r\n                            <path\r\n                              fill-rule=\"evenodd\"\r\n                              d=\"M41 14a2 2 0 0 0-2-2H9a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h30a2 2 0 0 0 2-2V14zM28.5 34h-9V14h9v20zm2 0V14H39v20h-8.5zm-13 0H9V14h8.5v20z\"\r\n                            ></path>\r\n                          </svg>\r\n                          <div class=\"card-body p-0\">\r\n                            <span\r\n                              class=\"card-text  d-inline-block text-truncate \"\r\n                              style={{\r\n                                maxWidth: \"120px\",\r\n                                fontWeight: \"bold\",\r\n                              }}\r\n                            >\r\n                              33/33/33\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div class=\"col m-2 \">\r\n                        <div\r\n                          class=\"card p-2 align-items-center\"\r\n                          style={{ width: \"130px\" }}\r\n                          onClick={(e) => selectLayout(\"25-50-25\")}\r\n                        >\r\n                          <svg\r\n                            width=\"48\"\r\n                            height=\"48\"\r\n                            viewBox=\"0 0 48 48\"\r\n                            xmlns=\"http://www.w3.org/2000/svg\"\r\n                            aria-hidden=\"true\"\r\n                            focusable=\"false\"\r\n                          >\r\n                            <path\r\n                              fill-rule=\"evenodd\"\r\n                              d=\"M41 14a2 2 0 0 0-2-2H9a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h30a2 2 0 0 0 2-2V14zM31 34H17V14h14v20zm2 0V14h6v20h-6zm-18 0H9V14h6v20z\"\r\n                            ></path>\r\n                          </svg>\r\n                          <div class=\"card-body p-0\">\r\n                            <span\r\n                              class=\"card-text  d-inline-block text-truncate \"\r\n                              style={{\r\n                                maxWidth: \"120px\",\r\n                                fontWeight: \"bold\",\r\n                              }}\r\n                            >\r\n                              25/50/25\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <div\r\n                    class=\"tab-pane fade  \"\r\n                    id={`pills-export-list`}\r\n                    role=\"tabpanel\"\r\n                    aria-labelledby={`pills-export-list`}\r\n                    tabindex=\"0\"\r\n                  >\r\n                    <div\r\n                      class=\"row m-3 overflow-auto \"\r\n                      style={{ height: \"600px\" }}\r\n                    >\r\n                      {state.exportList &&\r\n                        state.exportList.map((widget, index) => (\r\n                          <div class=\"col m-2\">\r\n                            <div\r\n                              class=\"card p-2 align-items-center\"\r\n                              style={{ width: \"130px\", height: \"180px\" }}\r\n                              onClick={(e) => {\r\n                                selectWidget(\r\n                                  `${context.accountId}/widget/${widget.widgetName}`\r\n                                );\r\n                              }}\r\n                            >\r\n                              <img\r\n                                src={\r\n                                  state.widgetLogo[widget.widgetName]\r\n                                    ? `https://ipfs.near.social/ipfs/${\r\n                                        state.widgetLogo[widget.widgetName]\r\n                                      }`\r\n                                    : \"https://ipfs.near.social/ipfs/bafkreido7gsk4dlb63z3s5yirkkgrjs2nmyar5bxyet66chakt2h5jve6e\"\r\n                                }\r\n                                class=\"card-img-top\"\r\n                                alt=\"...\"\r\n                              />\r\n                              <div class=\"card-body p-0\">\r\n                                <span\r\n                                  class=\"card-text  d-inline-block text-truncate \"\r\n                                  style={{\r\n                                    maxWidth: \"120px\",\r\n                                    fontWeight: \"bold\",\r\n                                  }}\r\n                                >\r\n                                  {widget.widgetName}\r\n                                </span>\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        ))}\r\n                    </div>\r\n                  </div>\r\n                  <div\r\n                    class=\"tab-pane fade show active\"\r\n                    id={`pills-block-list`}\r\n                    role=\"tabpanel\"\r\n                    aria-labelledby={`pills-block-list`}\r\n                    tabindex=\"0\"\r\n                  >\r\n                    <div\r\n                      class=\"row m-3 overflow-auto \"\r\n                      style={{ height: \"600px\" }}\r\n                    >\r\n                      {state.blockWidgetPattern &&\r\n                        Object.keys(state.blockWidgetPattern).map(\r\n                          (widget, index) => (\r\n                            <div class=\"col m-2\">\r\n                              <div\r\n                                class=\"card p-2 align-items-center\"\r\n                                style={{ width: \"150px\", height: \"150px\" }}\r\n                                onClick={(e) => {\r\n                                  openModalBlock(e, \"close\");\r\n                                  selectWidget(\r\n                                    `${state.blockWidgetPattern[widget].widgetUrl}`\r\n                                  );\r\n                                }}\r\n                              >\r\n                                <div class=\"card-body p-0\">\r\n                                  <span\r\n                                    class=\"card-text  d-inline-block text-truncate \"\r\n                                    style={{\r\n                                      maxWidth: \"120px\",\r\n                                      fontWeight: \"120px\",\r\n                                    }}\r\n                                  >\r\n                                    {\r\n                                      state.blockWidgetPattern[widget]\r\n                                        .widgetName\r\n                                    }\r\n                                  </span>\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                          )\r\n                        )}\r\n                    </div>\r\n                  </div>\r\n                  <div\r\n                    class=\"tab-pane fade \"\r\n                    id={`pills-self-customize-list`}\r\n                    role=\"tabpanel\"\r\n                    aria-labelledby={`pills-tab-self-customize-list`}\r\n                    tabindex=\"0\"\r\n                  >\r\n                    <div class=\"row m-3\">\r\n                      <div class=\"form-group col-md-12 \">\r\n                        <div class=\"card mb-2\">\r\n                          <div class=\"card-header\">Widget</div>\r\n                          <div class=\"card-body\">\r\n                            <div class=\"form-group\">\r\n                              <label>Widget Url:</label>\r\n                              <input\r\n                                class=\"form-control\"\r\n                                value={state.widgetUrl}\r\n                                onChange={(e) => onInputChangeWidgetUrl(e)}\r\n                              />\r\n                            </div>\r\n                            <div class=\"form-group\">\r\n                              <label>Props:</label>\r\n                              <input\r\n                                class=\"form-control\"\r\n                                value={state.widgetProps}\r\n                                onChange={(e) => onInputChangeWidgetProps(e)}\r\n                              />\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                        <div class=\"card\">\r\n                          <div class=\"card-header\" id=\"headingOne\">\r\n                            <h5 class=\"mb-0\">\r\n                              <button class=\"btn btn-link\">Preview</button>\r\n                            </h5>\r\n                          </div>\r\n\r\n                          <div id=\"collapseOne\" class=\"collapse show\">\r\n                            <div class=\"card-body\">\r\n                              {state.widgetUrl ? (\r\n                                <Widget\r\n                                  src={state.widgetUrl}\r\n                                  props={state.props || null}\r\n                                />\r\n                              ) : (\r\n                                \"\"\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                        <div class=\"text-mute pt-2\">\r\n                          <button\r\n                            type=\"button\"\r\n                            onClick={(e) => {\r\n                              selectWidget(state.widgetUrl);\r\n                            }}\r\n                            class=\"btn btn-primary\"\r\n                          >\r\n                            Add\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"modal-footer\">\r\n                <button\r\n                  type=\"button\"\r\n                  class=\"btn btn-secondary\"\r\n                  onClick={(e) => openModalBlock(e, \"close\")}\r\n                >\r\n                  Close\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"modal-backdrop fade show\"></div>\r\n      </>\r\n    )}\r\n    <div class=\"d-grid gap-2 p-1\">\r\n      <button\r\n        type=\"button\"\r\n        onClick={(e) => {\r\n          openModalBlock(e, \"show\");\r\n          State.update({\r\n            selectBlock: blockId,\r\n          });\r\n          State.update({\r\n            selectPositionBlock: 1,\r\n          });\r\n        }}\r\n        class=\"btn btn-outline-primary btn-lg btn-block\"\r\n      >\r\n        Add Block +\r\n      </button>\r\n    </div>\r\n  </>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/magicbuild.near/widget/add-block-button", "fact_widget_deployments_id": "47bcf150b4d1de524c02374c1dfa0f2d", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 4}