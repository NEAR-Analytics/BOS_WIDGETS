{"tx_hash": "AwpdwnqNKoEy6Nb7aVM9bv5UWaxegC8BSyyUjrkEgHUj", "action_id_social": "U1fdCR1yjUWSEnWgfnWbaRPbu8R3w19UDgzmWU6EpUp-0-widget", "block_id": 104831246, "block_timestamp": "2023-11-03T10:00:48.122Z", "signer_id": "magicbuild.near", "widget_name": "save-client-button", "source_code": "State.init({\r\n  clientName: props.clientName ? props.clientName : \"\",\r\n  clientId: props.clientId ? props.clientId : null,\r\n  clientContract: props.clientContract ? props.clientContract : \"\",\r\n  clientList: [],\r\n  abi: props.abi ? props.abi : null,\r\n  displayModal: false,\r\n  error,\r\n  clicked: false,\r\n});\r\nconst onInputChangeClientName = ({ target }) => {\r\n  State.update({ clientName: target.value });\r\n  State.update({ clicked: false });\r\n};\r\nconst onInputChangeClientContract = ({ target }) => {\r\n  State.update({ error: null, clicked: false });\r\n  State.update({ clientContract: target.value });\r\n};\r\nconst showModal = (e, type) => {\r\n  if (type == \"show\") {\r\n    State.update({ displayModal: true, clicked: false });\r\n  }\r\n  if (type == \"close\") {\r\n    State.update({ displayModal: false });\r\n  }\r\n};\r\nconst loadData = () => {\r\n  const clientList = Social.get(`${context.accountId}/magicbuild/clientList`);\r\n  if (clientList) {\r\n    const clientListData = JSON.parse(clientList);\r\n    State.update({ clientList: clientListData });\r\n  }\r\n};\r\nloadData();\r\nconst saveClient = (e) => {\r\n  if (!state.clicked) {\r\n    State.update({ clicked: true });\r\n    if (state.clientName.length < 5) {\r\n      State.update({\r\n        error: \"Name requires more than 5 characters\",\r\n      });\r\n    } else {\r\n      asyncFetch(\"https://rpc.near.org/\", {\r\n        body: JSON.stringify({\r\n          method: \"query\",\r\n          params: {\r\n            request_type: \"view_code\",\r\n            account_id: state.clientContract,\r\n            finality: \"final\",\r\n          },\r\n          id: 154,\r\n          jsonrpc: \"2.0\",\r\n        }),\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        method: \"POST\",\r\n      }).then((res) => {\r\n        if (res.body.result.code_base64) {\r\n          const data = state.clientList;\r\n          if (state.clientId) {\r\n            data.forEach((item, index) => {\r\n              if (item.clientId == state.clientId) {\r\n                data[index].abi = state.abi;\r\n                data[index].clientName = state.clientName;\r\n              }\r\n            });\r\n          } else {\r\n            const clientId = Date.now();\r\n            const clientData = {\r\n              clientId: clientId,\r\n              clientName: state.clientName,\r\n              address: state.clientContract,\r\n              archived: false,\r\n              abi: state.abi,\r\n            };\r\n            data.push(clientData);\r\n          }\r\n          const saveData = {\r\n            magicbuild: {\r\n              clientList: data,\r\n            },\r\n          };\r\n          Social.set(saveData, {\r\n            force: true,\r\n            onCommit: () => {\r\n              State.update({ displayModal: false });\r\n            },\r\n            onCancel: () => {},\r\n          });\r\n        } else {\r\n          State.update({\r\n            error:\r\n              \"Unable to save Account ID because the contract has not been deployed yet!\",\r\n          });\r\n        }\r\n      });\r\n    }\r\n  }\r\n};\r\n\r\nreturn (\r\n  <div>\r\n    <label></label>\r\n    <button\r\n      class=\"btn btn-primary form-control \"\r\n      onClick={(e) => showModal(e, \"show\")}\r\n    >\r\n      {state.clientId ? \"\u2705 Save Client\" : \"\u2795 Create Client\"}\r\n    </button>\r\n    {state.displayModal && (\r\n      <>\r\n        <div\r\n          style={{ display: \"block\" }}\r\n          className={`modal fade show`}\r\n          id=\"createClient\"\r\n          tabindex=\"-1\"\r\n          aria-labelledby=\"createClientLabel\"\r\n        >\r\n          <div class=\"modal-dialog\">\r\n            <div class=\"modal-content\">\r\n              <div class=\"modal-header\">\r\n                <h1 class=\"modal-title fs-5\" id=\"createClientLabel\">\r\n                  Create Client\r\n                </h1>\r\n                <button\r\n                  type=\"button\"\r\n                  class=\"btn-close\"\r\n                  onClick={(e) => showModal(e, \"close\")}\r\n                ></button>\r\n              </div>\r\n              <div class=\"modal-body\">\r\n                <div class=\"form-group\">\r\n                  <label>Name</label>\r\n                  <input\r\n                    class=\"form-control\"\r\n                    value={state.clientName}\r\n                    onChange={(e) => onInputChangeClientName(e)}\r\n                  />\r\n                </div>\r\n                <div class=\"form-group\">\r\n                  <label>Address</label>\r\n                  <input\r\n                    class=\"form-control\"\r\n                    value={state.clientContract}\r\n                    onChange={(e) => onInputChangeClientContract(e)}\r\n                  />\r\n                </div>\r\n                <div class=\"form-group\">\r\n                  <label>Chain</label>\r\n                  <select class=\"form-control\">\r\n                    <option selected>Near Chain</option>\r\n                    <option disabled>Ethereum Chain</option>\r\n                    <option disabled>AVAX Chain</option>\r\n                  </select>\r\n                </div>\r\n                {!state.error && (\r\n                  <small class=\"form-text text-muted\">\r\n                    A new Client will be created.\r\n                  </small>\r\n                )}\r\n\r\n                {state.error && (\r\n                  <p class=\"text-danger\" role=\"alert\">\r\n                    {state.error}\r\n                  </p>\r\n                )}\r\n              </div>\r\n              <div class=\"modal-footer\">\r\n                <button\r\n                  type=\"button\"\r\n                  class=\"btn btn-secondary\"\r\n                  onClick={(e) => showModal(e, \"close\")}\r\n                >\r\n                  Close\r\n                </button>\r\n                <button\r\n                  type=\"button\"\r\n                  disabled={state.clicked}\r\n                  onClick={(e) => saveClient(e)}\r\n                  class=\"btn btn-primary\"\r\n                >\r\n                  {state.clientId ? \"Save\" : \"Create\"}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"modal-backdrop fade show\"></div>\r\n      </>\r\n    )}\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/magicbuild.near/widget/save-client-button", "fact_widget_deployments_id": "6921bcfbaaaa5a3991ab37061c0aeb36", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}