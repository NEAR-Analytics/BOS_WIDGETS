{"tx_hash": "4BfFWE1bcuRadQP9tdZxy43m2VrwMDAqM6un2TDubupx", "action_id_social": "AWfCJ4NigQGXfRVYoDKudtNRw3G8KFWzg7QBSFDMijP5-0-widget", "block_id": 105304873, "block_timestamp": "2023-11-09T16:08:04.611Z", "signer_id": "everycanvas.near", "widget_name": "canvas.view", "source_code": "const { value, onChange, onSubmit, onCancel, selectedSource } = props;\n\nlet drawings = [];\n\nlet indices = [];\n\nif (selectedSource) {\n  switch (selectedSource) {\n    case \"canvas\":\n      indices = Social.index(\n        \"post\",\n        {\n          // thing\n          type: \"thing\",\n          path: \"efiz.near/thing/draw\", // this is the page??\n        },\n        {\n          order: \"desc\",\n          limit: 100, // this needs to adjust based on slider\n          // accountId: props.accounts, // undefined\n        }\n      );\n\n      if (!indices) {\n        return <p>Loading...</p>;\n      }\n\n      drawings = indices\n        .map((it) => {\n          const path = `${it.accountId}/post/main`;\n          const blockHeight = it.blockHeight;\n\n          const val = JSON.parse(Social.get(path, blockHeight) || \"null\");\n          return val.content.shapes ? val.content.shapes : [];\n        })\n        .flat();\n      break;\n    case \"feed\":\n      indices = Social.index(\"post\", \"main\", {\n        order: \"desc\",\n        limit: 100, // this needs to adjust based on slider\n        // accountId: props.accounts, // undefined\n      });\n\n      if (!indices) {\n        return <p>Loading...</p>;\n      }\n\n      const offsetX = 100; // Horizontal offset for each text shape\n      const offsetY = 100; // Vertical offset for each text shape\n      let x = 0; // Initial X position\n      let y = 0; // Initial Y position\n\n      drawings = indices.map((it, index) => {\n        const path = `${it.accountId}/post/main`;\n        const blockHeight = it.blockHeight;\n\n        x += offsetX;\n        y += offsetY;\n\n        const val = JSON.parse(Social.get(path, blockHeight) || \"null\");\n        return {\n          id: `shape:${path}${blockHeight}`,\n          type: \"text\",\n          x,\n          y,\n          props: { text: val.text, align: \"start\", size: \"s\" },\n        };\n      });\n      break;\n  }\n}\n\nif (drawings.length === 0) {\n  return <p>No drawings yet!</p>;\n}\n\n// const [initialShapes, setInitialShapes] = useState([]);\n\n// useEffect(() => {\n//   if (typeof value === \"string\") {\n//     setInitialShapes([\n//       {\n//         id: `shape:editor`,\n//         type: \"text\",\n//         props: { text: value, align: \"start\", size: \"s\" },\n//       },\n//     ]);\n//   }\n// }, [value, setInitialShapes]);\n\nreturn (\n  <Widget\n    src=\"everycanvas.near/widget/canvas.core\"\n    props={{ initialShapes: drawings }}\n  />\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/everycanvas.near/widget/canvas.view", "fact_widget_deployments_id": "b6e60326e13c04127cebe9bbd23c8632", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 3}