{"tx_hash": "96ec9oroVhto2pAqnDksFyrhbLGWGsmpshFd8Ydtm9cp", "action_id_social": "J2B7jLXfRitM3UovEcj8J9LXdSWscBFxhJjk3oUjtMQp-0-widget", "block_id": 99805695, "block_timestamp": "2023-08-27T21:48:41.082Z", "signer_id": "sourcescan.near", "widget_name": "SourceScan.Contracts.Info", "source_code": "const useNetwork = (mainnet, testnet) => {\n  return context.networkId === \"mainnet\" ? mainnet : testnet;\n};\n\nfunction customDecodeURIComponent(encodedStr) {\n  const specialChars = {\n    \"%21\": \"!\",\n    \"%23\": \"#\",\n    \"%24\": \"$\",\n    \"%26\": \"&\",\n    \"%27\": \"'\",\n    \"%28\": \"(\",\n    \"%29\": \")\",\n    \"%2A\": \"*\",\n    \"%2B\": \"+\",\n    \"%2C\": \",\",\n    \"%2F\": \"/\",\n    \"%3A\": \":\",\n    \"%3B\": \";\",\n    \"%3D\": \"=\",\n    \"%3F\": \"?\",\n    \"%40\": \"@\",\n    \"%5B\": \"[\",\n    \"%5D\": \"]\",\n  };\n\n  return encodedStr.replace(/%[0-9a-fA-F]{2}/g, (match) => {\n    return specialChars[match] || match;\n  });\n}\n\nState.init({\n  ownerId: useNetwork(\"sourcescan.near\", \"sourcescan.testnet\"),\n  apiHost: \"https://sourcescan.2bb.dev\",\n  rpcUrl: useNetwork(\n    \"https://rpc.mainnet.near.org\",\n    \"https://rpc.testnet.near.org\"\n  ),\n  theme:\n    typeof props.theme === \"string\"\n      ? JSON.parse(customDecodeURIComponent(props.theme))\n      : props.theme || {\n          bg: \"#e3e8ef\",\n          color: \"#4c5566\",\n          border: \"1px dashed #748094\",\n          text: {\n            fontSize: \"16px\",\n          },\n          heading: {\n            fontSize: \"18px\",\n            fontWeight: \"600\",\n            underline: true,\n          },\n        },\n  contract: null,\n  wasm: { value: null, error: false },\n  tx: { value: null, error: false },\n});\n\nconst getContract = async () => {\n  Near.asyncView(state.ownerId, \"get_contract\", {\n    contract_id: props.contractId,\n  })\n    .then((res) => {\n      State.update({\n        contract: res,\n      });\n    })\n    .catch((err) => {\n      console.log(err);\n    });\n};\n\nif (!props.contractId) {\n  return \"Please provide a contractId to the component\";\n} else {\n  getContract();\n}\n\nconst Main = styled.div`\n  background-color: ${state.theme.bg};\n  padding: 18px;\n  width: 50%;\n  color: ${state.theme.color};\n  border: ${state.theme.border};\n  border-radius: 16px;\n  display: flex;\n  flex-direction: column;\n  text-align: start;\n  align-items: start;\n  justify-content: start;\n  gap: 30px;\n\n  @media only screen and (max-width: 600px) {\n    width: 80%;\n    text-align: center;\n    align-items: center;\n    justify-content: center;\n  }\n`;\n\nconst Stack = styled.div`\n  display: flex;\n  flex-direction: column;\n  justify-content: start;\n  align-items: start;\n  text-align: start;\n  gap: 5px;\n\n  @media only screen and (max-width: 600px) {\n    text-align: center;\n    align-items: center;\n    justify-content: center;\n  }\n`;\n\nconst HStack = styled.div`\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n  align-items: center;\n  gap: 5px;\n`;\n\nconst UHeading = styled.div`\n  font-size: ${state.theme.heading.fontSize};\n  font-weight: ${state.theme.heading.fontWeight};\n  text-decoration: ${state.theme.heading.underline ? \"underline\" : \"none\"};\n  text-underline-offset: 6px;\n  text-decoration-style: dashed;\n  text-decoration-color: gray;\n`;\n\nconst Heading = styled.div`\n  font-size: ${state.theme.heading.fontSize};\n  font-weight: ${state.theme.heading.fontWeight};\n`;\n\nconst Desktop = styled.div`\n  display: flex;\n\n  @media only screen and (max-width: 600px) {\n    display: none;\n  }\n`;\n\nconst Mobile = styled.div`\n  display: none;\n\n  @media only screen and (max-width: 600px) {\n    display: flex;\n  }\n`;\n\nconst Text = styled.div`\n  font-size: ${state.theme.text.fontSize};\n  color: ${state.theme.color};\n`;\n\nconst Center = styled.div`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n`;\n\nconst A = styled.a`\n  text-decoration: none;\n  color: ${state.theme.color};\n\n  :hover {\n    text-decoration: none;\n    color: ${state.theme.color};\n  }\n`;\n\nconst truncateStringInMiddle = (str, maxLength) => {\n  if (str.length <= maxLength) {\n    return str;\n  }\n\n  const halfMaxLength = Math.floor(maxLength / 2);\n  const firstHalf = str.slice(0, halfMaxLength);\n  const secondHalf = str.slice(-halfMaxLength);\n\n  return firstHalf + \"...\" + secondHalf;\n};\n\nconst wasmCheck = () => {\n  const options = {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify({\n      jsonrpc: \"2.0\",\n      id: \"dontcare\",\n      method: \"query\",\n      params: {\n        request_type: \"view_code\",\n        finality: \"final\",\n        account_id: props.contractId,\n      },\n    }),\n  };\n  asyncFetch(state.rpcUrl, options)\n    .then((rpc_res) => {\n      asyncFetch(`${state.apiHost}/ipfs/${state.contract.cid}/wasm_code_base64`)\n        .then((ipfs_res) => {\n          State.update({\n            wasm: {\n              value: rpc_res.body.result.code_base64 === ipfs_res.body,\n              error: false,\n            },\n          });\n        })\n        .catch((err) => {\n          console.log(err);\n          State.update({\n            wasm: {\n              value: null,\n              error: true,\n            },\n          });\n        });\n    })\n    .catch((err) => {\n      State.update({\n        wasm: {\n          error: true,\n        },\n      });\n      console.log(err);\n    });\n};\n\nconst txCheck = () => {\n  asyncFetch(`${state.apiHost}/api/ipfs/getTxHash`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    body: `{ \"cid\": \"${state.contract.cid}\" }`,\n  })\n    .then((res) => {\n      State.update({\n        tx: {\n          value: res.body.tx_hash === state.contract.deploy_tx,\n          error: false,\n        },\n      });\n    })\n    .catch((err) => {\n      console.log(err);\n      State.update({\n        tx: { value: null, error: true },\n      });\n    });\n};\n\nif (state.contract) {\n  wasmCheck();\n  txCheck();\n}\n\nreturn (\n  <Center>\n    {!state.contract ? (\n      <Widget\n        src={`${state.ownerId}/widget/SourceScan.Common.Spinner`}\n        props={{ width: \"64px\", height: \"64px\" }}\n      />\n    ) : (\n      <Main>\n        <HStack>\n          <Heading>{props.contractId}</Heading>\n          <A\n            href={`https://${\n              context.networkId === \"mainnet\" ? \"\" : \"testnet.\"\n            }nearblocks.io/address/${props.contractId}`}\n            target={\"_blank\"}\n          >\n            <Widget\n              src={`${state.ownerId}/widget/SourceScan.Common.Icons.LinkIcon`}\n              props={{ width: \"18px\", height: \"18px\" }}\n            />\n          </A>\n        </HStack>\n        <Stack>\n          <UHeading>Security Checks</UHeading>\n          <Stack>\n            <HStack>\n              {state.wasm.value === null ? (\n                <Widget\n                  src={`${state.ownerId}/widget/SourceScan.Common.Spinner`}\n                />\n              ) : state.wasm.value ? (\n                <Widget\n                  src={`${state.ownerId}/widget/SourceScan.Common.Icons.CheckIcon`}\n                  props={{\n                    width: \"20px\",\n                    height: \"20px\",\n                    tooltip: { placement: props.placement, label: \"Approved\" },\n                  }}\n                />\n              ) : (\n                <Widget\n                  src={`${state.ownerId}/widget/SourceScan.Common.Icons.CrossIcon`}\n                  props={{\n                    width: \"20px\",\n                    height: \"20px\",\n                    tooltip: {\n                      placement: props.placement,\n                      label: state.wasm.error ? \"Error\" : \"Not approved\",\n                    },\n                  }}\n                />\n              )}\n              <Text>\n                Wasm Code {state.wasm.value ? \"Matches\" : \"Mismatches\"}\n              </Text>\n            </HStack>\n            <HStack>\n              {state.tx.value === null ? (\n                <Widget\n                  src={`${state.ownerId}/widget/SourceScan.Common.Spinner`}\n                />\n              ) : state.tx.value ? (\n                <Widget\n                  src={`${state.ownerId}/widget/SourceScan.Common.Icons.CheckIcon`}\n                  props={{\n                    width: \"20px\",\n                    height: \"20px\",\n                    tooltip: { placement: props.placement, label: \"Approved\" },\n                  }}\n                />\n              ) : (\n                <Widget\n                  src={`${state.ownerId}/widget/SourceScan.Common.Icons.CrossIcon`}\n                  props={{\n                    width: \"32px\",\n                    height: \"32px\",\n                    tooltip: {\n                      placement: props.placement,\n                      label: state.tx.error ? \"Error\" : \"Not approved\",\n                    },\n                  }}\n                />\n              )}\n              <Text>Deploy Tx {state.tx.value ? \"Matches\" : \"Mismatches\"}</Text>\n            </HStack>\n          </Stack>\n        </Stack>\n        <Stack>\n          <UHeading>Deploy Tx</UHeading>\n          <HStack>\n            <Desktop>\n              <Text>{state.contract.deploy_tx}</Text>\n            </Desktop>\n            <Mobile>\n              <Text>{truncateStringInMiddle(state.contract.deploy_tx, 8)}</Text>\n            </Mobile>\n            <A\n              href={`https://${\n                context.networkId === \"mainnet\" ? \"\" : \"testnet.\"\n              }nearblocks.io/txns/${state.contract.deploy_tx}`}\n              target={\"_blank\"}\n            >\n              <Widget\n                src={`${state.ownerId}/widget/SourceScan.Common.Icons.LinkIcon`}\n                props={{ width: \"18px\", height: \"18px\" }}\n              />\n            </A>\n          </HStack>\n        </Stack>\n        <Stack>\n          <UHeading>Entry Point</UHeading>\n          <Text>{state.contract.entry_point}</Text>\n        </Stack>\n        <Stack>\n          <UHeading>Lang</UHeading>\n          <Text>{state.contract.lang === \"ts\" ? \"TypeScript\" : \"Rust\"}</Text>\n        </Stack>\n        <Stack>\n          <UHeading>IPFS</UHeading>\n          <HStack>\n            <Desktop>\n              <Text>{state.contract.cid}</Text>\n            </Desktop>\n            <Mobile>\n              <Text>{truncateStringInMiddle(state.contract.cid, 8)}</Text>\n            </Mobile>\n            <A\n              href={`${state.apiHost}/ipfs/${state.contract.cid}`}\n              target={\"_blank\"}\n            >\n              <Widget\n                src={`${state.ownerId}/widget/SourceScan.Common.Icons.LinkIcon`}\n                props={{ width: \"18px\", height: \"18px\" }}\n              />\n            </A>\n          </HStack>\n        </Stack>\n        {state.contract.github ? <UHeading>Github</UHeading> : null}\n      </Main>\n    )}\n  </Center>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/sourcescan.near/widget/SourceScan.Contracts.Info", "fact_widget_deployments_id": "c8086543f88cd7545e022a945c6c14bf", "inserted_timestamp": "2023-08-27T23:41:49.482Z", "modified_timestamp": "2023-08-27T23:41:49.482Z", "__row_index": 4}