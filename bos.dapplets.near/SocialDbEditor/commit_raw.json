{"tx_hash": "5cypaacSN5XogANPWik44eTnQs6UysWNXT5USikMHt1e", "action_id_social": "69GePE94gFpsf8m96eo9NiNhiC6jvFxnYmNty6e5zSBW-0-widget", "block_id": 118955698, "block_timestamp": "2024-05-15T07:15:26.355Z", "signer_id": "bos.dapplets.near", "widget_name": "SocialDbEditor", "source_code": "const contractId = \"social.dapplets.near\";\n\nconst [query, setQuery] = useState(\n  `${context.accountId}/settings/dapplets.near/mutation/Sandbox/**`\n);\n\nconst originalData = Near.view(contractId, \"get\", {\n  keys: [query],\n});\n\nconst [modifiedJson, setModifiedJson] = useState(\"\");\n\nuseEffect(() => {\n  setModifiedJson(JSON.stringify(originalData, null, 2));\n}, [originalData]);\n\nconst isArray = (a) => Array.isArray(a);\n\nconst isObject = (o) => !isArray(o) && typeof o === \"object\";\n\nconst removeDuplicates = (data, prevData) => {\n  const obj = Object.entries(data).reduce((obj, [key, value]) => {\n    const prevValue = isObject(prevData) ? prevData[key] : undefined;\n    if (isObject(value)) {\n      const newValue = isObject(prevValue)\n        ? removeDuplicates(value, prevValue)\n        : value;\n      if (newValue !== undefined) {\n        obj[key] = newValue;\n      }\n    } else if (value !== prevValue) {\n      obj[key] = value;\n    }\n\n    return obj;\n  }, {});\n  return Object.keys(obj).length ? obj : undefined;\n};\n\nconst handleSaveClick = () => {\n  Near.call(\n    contractId,\n    \"set\",\n    {\n      data: removeDuplicates(JSON.parse(modifiedJson), originalData),\n    },\n    null, // gas\n    \"10000000000000000000000\" // deposit 0.01 near\n  );\n};\n\nreturn (\n  <div class=\"container\">\n    <div style={{ marginBottom: \"1rem\" }}>\n      <label for=\"query\">Contract ID</label>\n      <input\n        className=\"form-control\"\n        id=\"query\"\n        placeholder=\"bos.dapplets.near/settings/dapplets.near/mutation/Zoo/**\"\n        value={query}\n        onChange={(e) => setQuery(e.target.value)}\n      />\n    </div>\n    <div style={{ marginBottom: \"1rem\" }}>\n      <label for=\"codeInput\">Data</label>\n      <textarea\n        id=\"codeInput\"\n        className=\"form-control\"\n        value={modifiedJson}\n        onChange={(e) => setModifiedJson(e.target.value)}\n        style={{ fontFamily: \"monospace\", fontSize: 14 }}\n        rows=\"15\"\n      ></textarea>\n    </div>\n    <div style={{ marginBottom: \"1rem\" }}>\n      <button type=\"button\" class=\"btn btn-primary\" onClick={handleSaveClick}>\n        Save\n      </button>\n    </div>\n  </div>\n);\n", "metadata": {"fork_of": "bos.dapplets.near/widget/SocialDbEditor@118921163"}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bos.dapplets.near/widget/SocialDbEditor", "fact_widget_deployments_id": "fbc7dbc89d03cacce6f8940e01ada574", "inserted_timestamp": "2024-05-15T08:51:40.294Z", "modified_timestamp": "2024-05-15T08:51:40.294Z", "__row_index": 1}