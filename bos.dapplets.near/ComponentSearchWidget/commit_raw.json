{"tx_hash": "D5tNGTW3j2DbfX5DutUFQN4zHHBkGFWXr3PhT7vtQe4E", "action_id_social": "ArVdKNC5cYLz7Fi9XPss1GHwoTcxmfhi88cGvZyqXSA9-0-widget", "block_id": 110476944, "block_timestamp": "2024-01-15T15:30:52.457Z", "signer_id": "bos.dapplets.near", "widget_name": "ComponentSearchWidget", "source_code": "const allMetadata = Social.get([\"*/widget/*/metadata/name\", \"*/widget/*/metadata/tags/*\"], \"final\") || {};\nconst keys = Social.keys([\"*/widget/*\"], \"final\", { values_only: true }) || {};\n\nconst requiredTag = props.filterTag;\nconst boostedTag = props.boostedTag;\nconst inputTerm = props.term;\n\nconst debounce = (func, wait) => {\n  const pause = wait || 350;\n  let timeout;\n\n  return (args) => {\n    const later = () => {\n      clearTimeout(timeout);\n      func(args);\n    };\n\n    clearTimeout(timeout);\n    timeout = setTimeout(later, pause);\n  };\n};\n\nconst _search = (term) => {\n  const terms = (term || \"\")\n    .toLowerCase()\n    .split(/[^\\w._\\/-]/)\n    .filter((s) => !!s.trim());\n\n  const matchedWidgets = [];\n\n  const limit = props.limit ?? 30;\n\n  const MaxSingleScore = 1;\n  const MaxScore = MaxSingleScore * 4;\n\n  const computeScore = (s) => {\n    s = s.toLowerCase();\n    return (\n      terms\n        .map((term) => {\n          const pos = s.indexOf(term);\n          return pos >= 0 ? Math.exp(-pos) : 0;\n        })\n        .reduce((s, v) => s + v, 0) / terms.length\n    );\n  };\n\n  Object.entries(keys).forEach(([accountId, data]) => {\n    Object.keys(data.widget).forEach((componentId) => {\n      const widgetSrc = `${accountId}/widget/${componentId}`;\n      const widgetSrcScore = computeScore(widgetSrc);\n      const componentIdScore = computeScore(componentId);\n      const metadata = allMetadata[accountId].widget[componentId].metadata;\n      const name = metadata.name || componentId;\n      if (requiredTag && !(metadata.tags && requiredTag in metadata.tags)) {\n        return;\n      }\n      const boosted = boostedTag && metadata.tags && boostedTag in metadata.tags;\n      const tags = Object.keys(metadata.tags || {}).slice(0, 10);\n      const nameScore = computeScore(name);\n      const tagsScore = Math.min(\n        MaxSingleScore,\n        tags.map(computeScore).reduce((s, v) => s + v, 0),\n      );\n      const score = (widgetSrcScore + componentIdScore + nameScore + tagsScore) / MaxScore;\n      if (score > 0) {\n        matchedWidgets.push({\n          score,\n          accountId,\n          widgetName: componentId,\n          widgetSrc,\n          name,\n          tags,\n          boosted,\n        });\n      }\n    });\n  });\n\n  matchedWidgets.sort((a, b) => (b.boosted ? 2 : 0) + b.score - (a.boosted ? 2 : 0) - a.score);\n  const result = matchedWidgets.slice(0, limit);\n\n  State.update({\n    result,\n  });\n\n  if (props.onChange) {\n    props.onChange({ term, result });\n  }\n};\n\nconst _searchDebounced = debounce(_search, 200);\n\nconst computeResults = (term) => {\n  State.update({\n    term: term,\n  });\n\n  _searchDebounced(term);\n};\n\nif (props.term && props.term !== state.oldTerm) {\n  State.update({\n    oldTerm: props.term,\n  });\n  if (props.term !== state.term) {\n    computeResults(props.term);\n  }\n}\n\nconst Wrapper = styled.div`\n  width: 100%;\n  height: 40px;\n  position: relative;\n\n  .bi-search {\n    position: absolute;\n    top: 0;\n    left: 18px;\n    z-index: 100;\n    font-size: 14px;\n    line-height: 40px;\n    color: #687076;\n  }\n\n  .input-group {\n    height: 100%;\n  }\n\n  input {\n    padding: 0 14px 0 42px;\n    border: 1px solid #d0d5dd !important;\n    background: #ffffff;\n    border-radius: 100px;\n  }\n\n  button {\n    border-color: #d0d5dd !important;\n    border-radius: 0 100px 100px 0 !important;\n    border-left: none !important;\n    background: #fff !important;\n    color: #687076 !important;\n\n    &:hover,\n    &:focus {\n      color: #000 !important;\n    }\n  }\n\n  @media (max-width: 500px) {\n    width: 100%;\n  }\n`;\nconst iconSearch = (<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"bi bi-search\" viewBox=\"0 0 16 16\">\n  <path d=\"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0\" />\n</svg>)\nconst iconClose = (<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"bi bi-x\" viewBox=\"0 0 16 16\">\n  <path d=\"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708\" />\n</svg>)\n\nconst SpanSearch = styled.span`\n    position: absolute;\n    top: 13px;\n    left: -5px;\n    display: inline-block;\n    width: 16px;\n    height: 16px;`\nreturn (\n  <Wrapper>\n    <SpanSearch>{iconSearch}</SpanSearch>\n\n    <div className=\"input-group\">\n      <input\n        type=\"text\"\n        className={`form-control ${state.term ? \"border-end-0\" : \"\"}`}\n        value={state.term ?? \"\"}\n        onChange={(e) => computeResults(e.target.value)}\n        placeholder={props.placeholder ?? `Search components`}\n      />\n\n      {state.term && (\n        <button\n          className=\"btn btn-outline-secondary border border-start-0\"\n          type=\"button\"\n          onClick={() => computeResults(\"\")}\n        >\n          <span>{iconClose}</span>\n        </button>\n      )}\n    </div>\n\n    {props.debug && <pre>{JSON.stringify(state.result, undefined, 2)}</pre>}\n  </Wrapper>\n);\n", "metadata": {"fork_of": "bos.dapplets.near/widget/ComponentSearchWidget@110476625"}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bos.dapplets.near/widget/ComponentSearchWidget", "fact_widget_deployments_id": "8b9878ae5fa0cd9787b7b70529b7a0f0", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 1}