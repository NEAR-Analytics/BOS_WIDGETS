{"tx_hash": "HSbED8fVmk33KrLjEVDvEgjPFukgf2JhUj1XkJNMWhAr", "action_id_social": "5B9QREAeMb7HkQiMNkdkW8K4RPuuV6ynJ3UqS5KwjEW5-0-widget", "block_id": 115013961, "block_timestamp": "2024-03-19T09:28:39.985Z", "signer_id": "bos.dapplets.near", "widget_name": "OnboardingTest.Main", "source_code": "const [show, setShow] = useState(false)\nconst [start, setStart] = useState(false)\nconst [showFrom, setShowFrom] = useState(0)\n\nconst response = Near.view('app.webguide.near', 'get_guide', { guide_id: props?.link?.id })\nconst data = response && JSON.parse(response)\nconst lastShowTimes = data && data?.map((chapter) => Storage.privateGet(chapter.id + '/lastShowTime'))\n\nconsole.log('data', data)\nconsole.log('props?.link?.id', props?.link?.id)\nconsole.log('props', props)\nconsole.log('lastShowTimes',lastShowTimes)\n\nuseEffect(() => {\n  if (!start && (lastShowTimes === null || lastShowTimes?.[0] === null)) return;\n  setStart(true);\n  const lastShowByIds = {}\n  if (lastShowTimes) {\n    for (let i = 0; i < lastShowTimes.length; ++i) {\n      const elapsed = Date.now() - (lastShowTimes[i] ?? 0)\n      // if (elapsed > 1000 * 60 * 60 * 3) {\n      // TESTING\n      lastShowByIds[data[i].id] = elapsed > 1000 * 60 * 1 * 1 ? 1 : 0\n    }\n  }\n  console.log('lastShowByIds', lastShowByIds)\n\n  if (!lastShowTimes && context.accountId === props?.link?.authorId) {\n    setShow(true)\n  } else if (Object.values(lastShowByIds).includes(1)) {\n    data.sort((chapA, chapB) => lastShowByIds[chapA.id] - lastShowByIds[chapB.id])\n    console.log('data after sort', data)\n    setShowFrom(Object.values(lastShowByIds).filter(a => !a).length)\n    setShow(true)\n  }\n}, [start, lastShowTimes])\n\nsetTimeout(() => setStart(true), 10000)\n\nconst OverlayTriggerWrapper = styled.div`\n  display: flex;\n  z-index: 500;\n\n  .OverlayTrigger {\n    position: absolute;\n    background: #db504a;\n    border: 1px solid #db504a;\n    width: 6px;\n    height: 49px;\n    right: -6px;\n    top: 10px;\n    border-radius: 0px 4px 4px 0px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    box-sizing: border-box;\n    z-index: 79;\n  }\n`\n\nconst Onboarding = styled.div`\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n\n  animation: falling-animation 0.3s linear forwards;\n\n  @keyframes falling-animation {\n    from {\n      transform: translate(-50%, -200%);\n    }\n\n    to {\n      transform: translate(-50%, -50%);\n    }\n  }\n`;\n\nconst handleClose = (doNotShowAgain) => {\n  // const time = doNotShowAgain ? 30000000000000 : Date.now()\n  const time = doNotShowAgain ? Date.now() + 1000 * 60 : Date.now() // TESTING\n  data && data.forEach((chapter) => Storage.privateSet(chapter.id + '/lastShowTime', time))\n  setShow(false)\n}\n\nconst saveData = (inputData) => {\n  if (context?.accountId) {\n    Near.call(\n      'app.webguide.near',\n      'set_guide',\n      {\n        guide_id: props.link.id,\n        data: inputData,\n      }\n    )\n  }\n}\n\nif (show) {\n  // const time = doNotShowAgain ? 30000000000000 : Date.now()\n  const time = doNotShowAgain ? Date.now() + 1000 * 60 : Date.now() // TESTING\n  console.log('time on start', time)\n  data && data.forEach((chapter) => {\n    Storage.privateSet(chapter.id + '/lastShowTime', time)\n  })\n}\n\nreturn (\n  <OverlayTriggerWrapper>\n    {show ? (\n      <DappletOverlay>\n        <Onboarding>\n          <Widget\n            props={{ handleClose, data, saveData, setShow, link: props.link, showFrom }}\n            src=\"bos.dapplets.near/widget/Onboarding.SandboxOnboarding\"\n          />\n        </Onboarding>\n      </DappletOverlay>\n    ) : null}\n  </OverlayTriggerWrapper>\n)\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bos.dapplets.near/widget/OnboardingTest.Main", "fact_widget_deployments_id": "3ca923c51069a616f19f9aef54a5f01b", "inserted_timestamp": "2024-03-19T10:31:52.433Z", "modified_timestamp": "2024-03-19T10:31:52.433Z", "__row_index": 5}