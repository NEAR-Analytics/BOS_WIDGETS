{"tx_hash": "3J7FXqhG6cH4fFx54W3CfHqTNQX5KoXSwihdnveUzZpm", "action_id_social": "3m4GsSfgGEBiciPvebTE8ndrirLHqSvUYGFLmqBmD9FT-0-widget", "block_id": 118980229, "block_timestamp": "2024-05-15T15:24:58.232Z", "signer_id": "bos.dapplets.near", "widget_name": "Paywall.Content", "source_code": "if (!props.content) return <></>;\n\nconst { nearAccountId, CONTRACT_ADDRESS } = props;\nconst { content, is_purchased } = props.content;\n\nconst userAccountId = context.accountId || nearAccountId\n\n/**\n * From near-api-js/packages/near-api-js/src/utils/format.ts\n */\nconst NEAR_NOMINATION_EXP = 24;\nconst NEAR_NOMINATION = new BN('10', 10).pow(new BN(NEAR_NOMINATION_EXP, 10));\nconst ROUNDING_OFFSETS = [];\nconst BN10 = new BN(10);\n\nfor (let i = 0, offset = new BN(5); i < NEAR_NOMINATION_EXP; i++) {\n  ROUNDING_OFFSETS[i] = offset;\n  offset = offset.mul(BN10)\n}\n\nfunction trimTrailingZeroes(value) {\n  return value.replace(/\\.?0*$/, '');\n}\n\nfunction formatWithCommas(value) {\n  const pattern = /(-?\\d+)(\\d{3})/;\n  while (pattern.test(value)) {\n    value = value.replace(pattern, '$1,$2');\n  }\n  return value;\n}\n\nfunction formatNearAmount(balance, fracDigitsExternal) {\n  const fracDigits = fracDigitsExternal || NEAR_NOMINATION\n\n  const balanceBN = new BN(balance, 10);\n  if (fracDigits !== NEAR_NOMINATION_EXP) {\n    const roundingExp = NEAR_NOMINATION_EXP - fracDigits - 1;\n    if (roundingExp > 0) {\n      balanceBN.iadd(ROUNDING_OFFSETS[roundingExp]);\n    }\n  }\n\n  balance = balanceBN.toString();\n  const wholeStr = balance.substring(0, balance.length - NEAR_NOMINATION_EXP) || '0';\n  const fractionStr = balance\n    .substring(balance.length - NEAR_NOMINATION_EXP)\n    .padStart(NEAR_NOMINATION_EXP, '0')\n    .substring(0, fracDigits);\n\n  return trimTrailingZeroes(`${formatWithCommas(wholeStr)}.${fractionStr}`);\n}\n\nfunction formatNear(amount) {\n  return Number(formatNearAmount(amount, 3));\n}\n/**\n * End\n */\n\nState.init({\n  basic: false,\n  loading: false\n})\n\nconst onBuy = () => {\n  try {\n    State.update({ loading: true })\n    Near.call(\n      CONTRACT_ADDRESS,\n      \"buy\",\n      {\n        content_id: content.id\n      },\n      '50000000000000',\n      content.cost\n    );\n  } catch (err) {\n    console.error(err);\n    State.update({ loading: false });\n  }\n};\n\nconst Wrapper = styled.div`\n  .content-blur-wrapper {\n    overflow: hidden;\n    width: 100%;\n    border-radius: 16px;\n    border: 1px solid rgb(207, 217, 222);\n    aspect-ratio: 1.777;\n    cursor: default;\n    position: relative;\n    box-sizing: border-box;\n  }\n\n  .content-wrapper-basic {\n    overflow: hidden;\n    width: 100%;\n    border-radius: 4px;\n    aspect-ratio: 1.777;\n    position: relative;\n    box-sizing: border-box;\n  }\n\n  .unlock-content-overlay {\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    gap: 16px;\n    background-color: rgba(255, 255, 255, 0.7);\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n  }\n\n  .unlock-content-overlay > .text {\n    color: #000;\n    text-align: center;\n    font-family: Helvetica;\n    font-size: 15px;\n    font-style: normal;\n    font-weight: 700;\n    line-height: normal;\n  }\n\n  .unlock-content-overlay > .price {\n    color: #000;\n    text-align: center;\n    font-family: Helvetica;\n    font-size: 28px;\n    font-style: normal;\n    font-weight: 700;\n    line-height: normal;\n  }\n\n  .unlock-content-overlay > .main-button {\n    display: flex;\n    padding: 10px 40px;\n    justify-content: center;\n    align-items: center;\n    gap: 10px;\n    border-radius: 20px;\n    background: #1d9bf0;\n    color: #fff;\n    text-align: center;\n    font-family: Helvetica;\n    font-size: 15px;\n    font-style: normal;\n    font-weight: 700;\n    line-height: normal;\n    border: none;\n    cursor: pointer;\n    transition-duration: 0.2s;\n  }\n\n  .unlock-content-overlay > .main-button:hover {\n    background-color: rgb(26, 140, 216);\n  }\n\n  .unlock-content-overlay > .main-button:disabled {\n    background: #99cdf8;\n    cursor: default;\n  }\n\n  .content-image {\n    width: 100%;\n  }\n\n  .blurred {\n    filter: blur(1em);\n  }\n`;\n\nconst Loader = () => (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    width=\"20px\"\n    height=\"20px\"\n    viewBox=\"0 0 100 100\"\n    preserveAspectRatio=\"xMidYMid\"\n  >\n    <circle\n      cx=\"50\"\n      cy=\"50\"\n      fill=\"none\"\n      stroke=\"#ffffff\"\n      strokeWidth=\"10\"\n      r=\"35\"\n      strokeDasharray=\"164.93361431346415 56.97787143782138\"\n    >\n      <animateTransform\n        attributeName=\"transform\"\n        type=\"rotate\"\n        repeatCount=\"indefinite\"\n        dur=\"1s\"\n        values=\"0 50 50;360 50 50\"\n        keyTimes=\"0;1\"\n      ></animateTransform>\n    </circle>\n  </svg>\n);\n\nreturn (\n  <Wrapper>\n    <div className={state.basic ? \"content-wrapper-basic\" : \"content-blur-wrapper\"}>\n    {is_purchased ? (\n        <>\n          <img className=\"content-image\" src={content.link} />\n          <Widget  loading={<></>} src=\"bos.dapplets.near/widget/Paywall.Badge\"  props={{ accountId: content.author }}/>\n        </>\n      ) : (\n        <>\n          <img className=\"content-image blurred\" src={content.link} />\n          {userAccountId ? (\n            <div className=\"unlock-content-overlay\">\n              <div className=\"text\">Unlock this content</div>\n              <div className=\"price\">{formatNear(content.cost)} $NEAR</div>\n              <button\n                className=\"main-button\"\n                onClick={() => onBuy(contentId, content.cost)}\n                disabled={state.loading}\n              >\n                {state.loading ? <Loader /> : \"Buy\"}\n              </button>\n            </div>\n          ) : (\n            <div className=\"unlock-content-overlay\">\n              <div className=\"text\">Login and unlock this content</div>\n              <div className=\"price\">{formatNear(content.cost)} $NEAR</div>\n              <button\n                className=\"main-button\"\n                onClick={() => onBuy(contentId, content.cost)}\n                disabled={true}\n              >\n                {state.loading ? <Loader /> : \"Buy\"}\n              </button>\n            </div>\n          )}\n          <Widget  loading={<></>} src=\"bos.dapplets.near/widget/Paywall.Badge\"  props={{ accountId: content.author }}/>\n        </>\n      )}\n    </div>\n  </Wrapper>\n);", "metadata": {}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bos.dapplets.near/widget/Paywall.Content", "fact_widget_deployments_id": "9bc19c9846dc1dba53dc8f55ec32a3af", "inserted_timestamp": "2024-05-15T16:55:31.288Z", "modified_timestamp": "2024-05-15T17:51:14.266Z", "__row_index": 0}