{"tx_hash": "83o4NsHS3kJSBLvdZGT9e3zRnHmPU3Nmo87axthLxEJ9", "action_id_social": "HbfvjEqCj8dqYPtQjCGEc8WzZb53gLRGkHF4q8VLB5Bg-0-widget", "block_id": 117230078, "block_timestamp": "2024-04-20T08:59:21.495Z", "signer_id": "bos.dapplets.near", "widget_name": "Paywall.Form", "source_code": "const { linkId, CONTRACT_ADDRESS } = props\n\n/**\n * From near-api-js/packages/near-api-js/src/utils/format.ts\n */\nconst NEAR_NOMINATION_EXP = 24;\n\nfunction cleanupAmount(amount) {\n  return amount.replace(/,/g, '').trim();\n}\n\nfunction trimLeadingZeroes(value) {\n  value = value.replace(/^0+/, '');\n  if (value === '') {\n      return '0';\n  }\n  return value;\n}\n\nfunction parseNearAmount(amt) {\n  if (!amt) { return null; }\n  amt = cleanupAmount(amt);\n  const split = amt.split('.');\n  const wholePart = split[0];\n  const fracPart = split[1] || '';\n  if (split.length > 2 || fracPart.length > NEAR_NOMINATION_EXP) {\n      throw new Error(`Cannot parse '${amt}' as NEAR amount`);\n  }\n  return trimLeadingZeroes(wholePart + fracPart.padEnd(NEAR_NOMINATION_EXP, '0'));\n}\n/**\n * End\n */\n\nState.init({\n  img: null,\n  amount: null,\n  loading: false,\n});\n\nconst uploadFileUpdateState = (body) => {\n  asyncFetch(\"https://ipfs.near.social/add\", {\n    method: \"POST\",\n    headers: { Accept: \"application/json\" },\n    body,\n  }).then((res) => {\n    const cid = res.body.cid;\n    State.update({ img: { cid } });\n  });\n};\n\nconst filesOnChange = (files) => {\n  if (files) {\n    State.update({ img: { uploading: true, cid: null } });\n    uploadFileUpdateState(files[0]);\n  }\n};\n\nconst amountOnChange = ({ target }) => {\n   State.update({ amount: target.value.trim(), wrongPrice: false });\n};\n\nconst sendOnChange = () => {\n  if (!/^\\d+([.]\\d+)?$/g.test(state.amount)) {\n    State.update({ wrongPrice: true })\n  } else {\n    try {\n      State.update({ loading: true })\n      Near.call(\n        CONTRACT_ADDRESS,\n        \"add_paid_content\",\n        {\n          link: `https://ipfs.near.social/ipfs/${state.img.cid}`,\n          cost: parseNearAmount(state.amount),\n          context_id: linkId\n        }\n      );\n    } catch (err) {\n      console.error(err);\n      State.update({ loading: false })\n    }\n  }\n};\n\nconst cancelOnChange = () => {\n  State.update({\n    img: null,\n    amount: null,\n  });\n};\n\nconst iconBtnUpload = (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n  >\n    <path\n      d=\"M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15\"\n      stroke=\"white\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    />\n    <path\n      d=\"M17 8L12 3L7 8\"\n      stroke=\"white\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    />\n    <path\n      d=\"M12 3V15\"\n      stroke=\"white\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    />\n  </svg>\n);\n\nconst WrapperWidget = styled.div`\n  display: flex;\n  position: relative;\n  flex-direction: column;\n  min-width: 350px;\n  max-width: 780px;\n  width: 100%;\n  padding: 10px;\n  border-radius: 16px;\n  box-sizing: border-box;\n  border: 1px solid #8899a6;\n  background: #fff;\n\n  .ButtonUpload {\n    cursor: pointer;\n    border-radius: 4px;\n    background: #3d7fff;\n    box-sizing: border-box;\n    width: 128px;\n    height: 44px;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 6px;\n    color: #fff;\n    font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Roboto\", \"Oxygen\", \"Ubuntu\", \"Cantarell\", \"Fira Sans\", \"Droid Sans\", \"Helvetica Neue\", sans-serif;\n    font-size: 14px;\n    font-weight: 400;\n    line-height: normal;\n    &:hover {\n      opacity: 0.5;\n    }\n  }\n`;\n\nconst Title = styled.div`\n  font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Roboto\", \"Oxygen\", \"Ubuntu\", \"Cantarell\", \"Fira Sans\", \"Droid Sans\", \"Helvetica Neue\", sans-serif;\n  color: #222;\n  font-size: 18px;\n  font-weight: 700;\n  line-height: normal;\n  padding-bottom: 10px;\n`;\n\nconst InputsBlock = styled.div`\n  border-radius: 4px;\n  border: 1px solid #c1c6ce;\n  padding: 10px;\n  margin-bottom: 14px;\n  box-sizing: border-box;\n  position: relative;\n`;\n\nconst UploadBlocker = styled.div`\n  position: absolute;\n  width: calc(100% - 16px);\n  height: 50px;\n  background: white;\n  opacity: .5;\n  top: 8px;\n  left: 8px;\n`;\n\nconst UploadBlock = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 14px;\n  box-sizing: border-box;\n`;\n\nconst FileInput = styled.input`\n  font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Roboto\", \"Oxygen\", \"Ubuntu\", \"Cantarell\", \"Fira Sans\", \"Droid Sans\", \"Helvetica Neue\", sans-serif;\n  border-radius: 4px;\n  background: #e7ecef;\n  display: flex;\n  height: 44px;\n  padding: 10px;\n  font-size: 14px;\n  font-weight: 400;\n  line-height: normal;\n  color: #222;\n  border: none;\n  outline: none;\n  box-sizing: border-box;\n  flex-grow: 1;\n  margin-right: 8px;\n`;\n\nconst BlockAmount = styled.div`\n  .default {\n    border-radius: 4px;\n    border: 1px solid #c1c6ce;\n    background: #fff;\n\n    display: flex;\n    height: 44px;\n    padding: 4px 10px;\n    flex-direction: column;\n    box-sizing: border-box;\n  }\n\n  .error {\n    border-color: red;\n  }\n`;\n\nconst LabelAmount = styled.div`\n  font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Roboto\", \"Oxygen\", \"Ubuntu\", \"Cantarell\", \"Fira Sans\", \"Droid Sans\", \"Helvetica Neue\", sans-serif;\n  color: #919191;\n  font-size: 12px;\n  font-weight: 400;\n  line-height: normal;\n`;\n\nconst InputAmount = styled.input`\n  font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Roboto\", \"Oxygen\", \"Ubuntu\", \"Cantarell\", \"Fira Sans\", \"Droid Sans\", \"Helvetica Neue\", sans-serif;\n  color: #222;\n  font-size: 14px;\n  background: #fff;\n  font-weight: 400;\n  line-height: normal;\n  border: none;\n  outline: none;\n  height: 16px;\n  box-sizing: border-box;\n  &:disabled {\n    color: #919191;\n  }\n`;\n\nconst WrongAmountMessage = styled.div`\n  font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Roboto\", \"Oxygen\", \"Ubuntu\", \"Cantarell\", \"Fira Sans\", \"Droid Sans\", \"Helvetica Neue\", sans-serif;\n  color: red;\n  padding: 8px 8px 0 12px;\n  font-size: 14px;\n`;\n\nconst ButtonsBlock = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 0 10px;\n  box-sizing: border-box;\n`;\n\nconst ButtonCancel = styled.button`\n  font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Roboto\", \"Oxygen\", \"Ubuntu\", \"Cantarell\", \"Fira Sans\", \"Droid Sans\", \"Helvetica Neue\", sans-serif;\n  border-radius: 4px;\n  display: flex;\n  background: #c1c6ce;\n  border: none;\n  outline: none;\n  justify-content: center;\n  align-items: center;\n  color: #fff;\n  font-size: 14px;\n  max-width: 230px;\n  width: 100%;\n  height: 44px;\n  font-weight: 400;\n  line-height: 149%;\n  box-sizing: border-box;\n  margin: 0 4px;\n  cursor: pointer;\n\n  &:disabled {\n    background: #dbdfe5 !important;\n    cursor: default;\n  }\n\n  &:hover {\n    background: #a9aeb5;\n  }\n`;\n\nconst ButtonSend = styled.button`\n  font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Roboto\", \"Oxygen\", \"Ubuntu\", \"Cantarell\", \"Fira Sans\", \"Droid Sans\", \"Helvetica Neue\", sans-serif;\n  border-radius: 4px;\n  display: flex;\n  background: #3d7fff;\n  border: none;\n  outline: none;\n  justify-content: center;\n  align-items: center;\n  color: #fff;\n  font-size: 14px;\n  max-width: 230px;\n  width: 100%;\n  height: 44px;\n  font-weight: 400;\n  line-height: 149%;\n  box-sizing: border-box;\n  margin: 0 4px;\n  cursor: pointer;\n\n  &:disabled {\n    background: #8db4ff !important;\n    cursor: default;\n  }\n\n  &:hover {\n    background: #2564df;\n  }\n`;\n\nconst Loader = () => (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    width=\"20px\"\n    height=\"20px\"\n    viewBox=\"0 0 100 100\"\n    preserveAspectRatio=\"xMidYMid\"\n  >\n    <circle\n      cx=\"50\"\n      cy=\"50\"\n      fill=\"none\"\n      stroke=\"#ffffff\"\n      strokeWidth=\"10\"\n      r=\"35\"\n      strokeDasharray=\"164.93361431346415 56.97787143782138\"\n    >\n      <animateTransform\n        attributeName=\"transform\"\n        type=\"rotate\"\n        repeatCount=\"indefinite\"\n        dur=\"1s\"\n        values=\"0 50 50;360 50 50\"\n        keyTimes=\"0;1\"\n      ></animateTransform>\n    </circle>\n  </svg>\n);\n\nreturn (\n  <WrapperWidget>\n    <Title>Configure your content</Title>\n    <InputsBlock>\n      <UploadBlocker style={{ display: state.loading ? 'block' : 'none'}} />\n      <UploadBlock>\n        <FileInput readOnly value={state.img.cid ? state.img.cid : \"\"} />\n\n        <Files\n          multiple={false}\n          accepts={[\"image/*\"]}\n          minFileSize={1}\n          clickable\n          className=\"ButtonUpload\"\n          onChange={filesOnChange}\n        >\n          {iconBtnUpload}\n          {state.img?.uploading ? <> Uploading </> : \"Upload image\"}\n        </Files>\n      </UploadBlock>\n\n      <BlockAmount>\n        <div className={state.wrongPrice? \"default error\" : \"default\"}>\n          <LabelAmount>Price (NEAR)</LabelAmount>\n          <InputAmount\n            value={state.amount || \"\"}\n            onChange={amountOnChange}\n            disabled={state.loading}\n          />\n        </div>\n      </BlockAmount>\n      {state.wrongPrice\n        ? (<WrongAmountMessage>\n          The price must consist only of numbers separated by \".\"\n          </WrongAmountMessage>)\n        : null}\n    </InputsBlock>\n    <ButtonsBlock>\n      <ButtonCancel\n        onClick={cancelOnChange}\n        disabled={!state.img && !state.amount || state.loading}\n      >\n        Clear\n      </ButtonCancel>\n      <ButtonSend\n        onClick={sendOnChange}\n        disabled={!state.img || !state.amount || state.wrongPrice || state.loading}\n      >\n        {state.loading ? <Loader /> : \"Add\"}\n      </ButtonSend>\n    </ButtonsBlock>\n  </WrapperWidget>\n);\n", "metadata": {}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bos.dapplets.near/widget/Paywall.Form", "fact_widget_deployments_id": "fbb2bb6053a7ff8aca98065ba3ebaa5e", "inserted_timestamp": "2024-04-20T10:36:12.900Z", "modified_timestamp": "2024-04-20T10:36:12.900Z", "__row_index": 23}