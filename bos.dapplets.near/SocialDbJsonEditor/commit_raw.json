{"tx_hash": "D52dfNPpbZfhPT3aJu32XtcUfZNxRNL6FvTbQ2FdkriG", "action_id_social": "41SzMgZvPVim3MC7jTdNC43gPpw9ZsWbhBZCY9uGPsUq-0-widget", "block_id": 118957602, "block_timestamp": "2024-05-15T07:52:01.114Z", "signer_id": "bos.dapplets.near", "widget_name": "SocialDbJsonEditor", "source_code": "const contractId = \"social.dapplets.near\";\n\nconst [query, setQuery] = useState(\n  `${context.accountId}/settings/dapplets.near/mutation/Sandbox/targets`\n);\n\nconst originalData = Near.view(contractId, \"get\", {\n  keys: [query],\n});\n\nconst [modifiedJson, setModifiedJson] = useState(\"\");\n\nconst unpackValue = (obj, path) => {\n  const [first, ...rest] = typeof path === \"string\" ? path.split(\"/\") : path;\n  return first ? unpackValue(obj[first], rest) : obj;\n};\n\nconst packValue = (value, path) => {\n  const rest = typeof path === \"string\" ? path.split(\"/\") : path;\n  const last = rest.pop();\n  return last ? packValue({ [last]: value }, rest) : value;\n};\n\nuseEffect(() => {\n  const json = unpackValue(originalData, query);\n  const formattedJson = JSON.stringify(JSON.parse(json), null, 2);\n  setModifiedJson(formattedJson);\n}, [originalData]);\n\nconst isArray = (a) => Array.isArray(a);\n\nconst isObject = (o) => !isArray(o) && typeof o === \"object\";\n\nconst removeDuplicates = (data, prevData) => {\n  const obj = Object.entries(data).reduce((obj, [key, value]) => {\n    const prevValue = isObject(prevData) ? prevData[key] : undefined;\n    if (isObject(value)) {\n      const newValue = isObject(prevValue)\n        ? removeDuplicates(value, prevValue)\n        : value;\n      if (newValue !== undefined) {\n        obj[key] = newValue;\n      }\n    } else if (value !== prevValue) {\n      obj[key] = value;\n    }\n\n    return obj;\n  }, {});\n  return Object.keys(obj).length ? obj : undefined;\n};\n\nconst handleSaveClick = () => {\n  const compactJson = JSON.stringify(JSON.parse(modifiedJson));\n  const dataToBeSaved = packValue(compactJson, query);\n\n  Near.call(\n    contractId,\n    \"set\",\n    {\n      data: removeDuplicates(dataToBeSaved, originalData),\n    },\n    null, // gas\n    \"10000000000000000000000\" // deposit 0.01 near\n  );\n};\n\nreturn (\n  <div class=\"container\">\n    <div style={{ marginBottom: \"1rem\" }}>\n      <label for=\"query\">Path</label>\n      <input\n        className=\"form-control\"\n        id=\"query\"\n        placeholder=\"bos.dapplets.near/settings/dapplets.near/mutation/Zoo/**\"\n        value={query}\n        onChange={(e) => setQuery(e.target.value)}\n      />\n    </div>\n    <div style={{ marginBottom: \"1rem\" }}>\n      <label for=\"codeInput\">Data</label>\n      <textarea\n        id=\"codeInput\"\n        className=\"form-control\"\n        value={modifiedJson}\n        onChange={(e) => setModifiedJson(e.target.value)}\n        style={{ fontFamily: \"monospace\", fontSize: 14 }}\n        rows=\"15\"\n      ></textarea>\n    </div>\n    <div style={{ marginBottom: \"1rem\" }}>\n      <button type=\"button\" class=\"btn btn-primary\" onClick={handleSaveClick}>\n        Save\n      </button>\n    </div>\n  </div>\n);\n", "metadata": {"fork_of": "bos.dapplets.near/widget/SocialDbEditor@118921163"}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bos.dapplets.near/widget/SocialDbJsonEditor", "fact_widget_deployments_id": "2ce6201ca7045752c4ba3cede28f5542", "inserted_timestamp": "2024-05-15T09:49:53.859Z", "modified_timestamp": "2024-05-15T09:49:53.859Z", "__row_index": 0}