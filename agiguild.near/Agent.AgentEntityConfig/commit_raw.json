{"tx_hash": "AenCgDKWkfAQtGUXsmHNrXGWa9L1pFDkd9M8FapXk93N", "action_id_social": "FMZ9cFezbGDPEvJGRf3QttM7t7Uao7aBmLQbFrdDEpkj-0-widget", "block_id": 114978915, "block_timestamp": "2024-03-18T21:16:57.612Z", "signer_id": "agiguild.near", "widget_name": "Agent.AgentEntityConfig", "source_code": "const entityType = \"agent\";\nconst entityIndexer = \"agents\";\nconst entityTable = \"agents\";\n\nconst user = \"dataplatform_near\";\nconst collection = `${user}_${entityIndexer}_${entityTable}`;\n\nconst { schema } = VM.require(`agiguild.near/widget/Schema.Agent`);\nif (!schema ) {\n  return <></>;\n}\nconst dataFields = Object.keys(schema).filter((key) => typeof schema[key] === \"object\");\nconst buildQueries = (searchKey, sort) => {\n  const queryFilter = searchKey ? `name: {_ilike: \"%${searchKey}%\"}` : \"\";\n  let querySortOption;\n  switch (sort) {\n    case \"z-a\":\n      querySortOption = `{ name: desc },`;\n      break;\n    case \"a-z\":\n      querySortOption = `{ name: asc },`;\n      break;\n    default:\n      querySortOption = \"{ id: desc },\";\n  }\n\n  return `\nquery ListQuery($offset: Int, $limit: Int) {\n  ${collection}(\n      where: {${queryFilter}}\n      order_by: [${querySortOption} ], \n      offset: $offset, limit: $limit) {\n      ${convertPascalToSnake(dataFields).join(\"\\n\")}\n  }\n  ${collection}_aggregate {\n    aggregate {\n      count\n    }\n  }\n}\n`;\n};\nconst queryName = \"ListQuery\";\n\nconst convertSnakeToPascal = (item) => {\n    const newItems = {};\n    Object.keys(item).forEach((key) => {\n    const pascalKey = key.replace(/(_\\w)/g, (m) => m[1].toUpperCase());\n    newItems[pascalKey] = item[key];\n  });\n  return newItems;\n};\nconst convertPascalToSnake = (itemArray) => {\n    const newItems = [];\n    itemArray.forEach((key) => {\n        const snakeKey = key.replace(/([A-Z])/g, (m) => \"_\" + m.toLowerCase());\n        newItems.unshift(snakeKey);\n    });\n    return newItems;\n}\n\nconst renderItem = (item, editFunction) => {\n  return (\n    <Widget\n      src=\"agiguild.near/widget/Agent.AgentCard\"\n      props={{\n        item: convertSnakeToPascal(item),\n        editFunction,\n      }}\n    />\n  );\n};\n\nconst createWidget = \"near/widget/Entities.Template.EntityCreate\";\n\nreturn (\n  <div>\n    <Widget\n      src=\"near/widget/Entities.Template.EntityList\"\n      props={{ entityType, buildQueries, queryName, collection, renderItem, createWidget, schema }}\n    />\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/agiguild.near/widget/Agent.AgentEntityConfig", "fact_widget_deployments_id": "ee30814212e9b4b122ed693b48b8e1ff", "inserted_timestamp": "2024-03-18T22:28:44.089Z", "modified_timestamp": "2024-03-18T22:28:44.089Z", "__row_index": 7}