{"tx_hash": "DRPgz37iEjEWu6RTUTFjBEvgNEPEo4e2P1pJyD9tnW42", "action_id_social": "FxQY4WPqncMi1bZZLtWj2ERc95BFYe3dC6kqdHvmLz4L-0-widget", "block_id": 114535889, "block_timestamp": "2024-03-11T19:00:02.841Z", "signer_id": "agiguild.near", "widget_name": "Agent.AgentEntityConfig", "source_code": "const entityType = \"Agent\";\nconst entityIndexer = \"agents\";\nconst entityTable = \"agents\";\n\nconst user = \"dataplatform_near\";\nconst collection = `${user}_${entityIndexer}_${entityTable}`;\n\nconst { schema } = VM.require(`${REPL_AGIGUILD}/widget/Schema.Agent`);\nif (!schema ) {\n  return <></>;\n}\n\nconst buildQueries = (searchKey, sort) => {\n  const queryFilter = searchKey ? `name: {_ilike: \"%${searchKey}%\"}` : \"\";\n  let querySortOption;\n  switch (sort) {\n    case \"z-a\":\n      querySortOption = `{ name: desc },`;\n      break;\n    case \"a-z\":\n      querySortOption = `{ name: asc },`;\n      break;\n    default:\n      querySortOption = \"{ id: desc },\";\n  }\n\n  return `\nquery ListQuery($offset: Int, $limit: Int) {\n  ${collection}(\n      where: {${queryFilter}}\n      order_by: [${querySortOption} ], \n      offset: $offset, limit: $limit) {\n      ${Object.keys(convertPascalToSnake(schema)).join(\"\\n\")}\n  }\n  ${collection}_aggregate {\n    aggregate {\n      count\n    }\n  }\n}\n`;\n};\nconst queryName = \"ListQuery\";\n\nconst convertSnakeToPascal = (item) => {\n    const newItems = {};\n    Object.keys(item).forEach((key) => {\n    const pascalKey = key.replace(/(_\\w)/g, (m) => m[1].toUpperCase());\n    newItems[pascalKey] = item[key];\n  });\n  return newItems;\n};\nconst convertPascalToSnake = (item) => {\n    const newItems = {};\n    Object.keys(item).forEach((key) => {\n        const snakeKey = key.replace(/([A-Z])/g, (m) => \"_\" + m.toLowerCase());\n        newItems[snakeKey] = item[key];\n    });\n    return newItems;\n}\n\nconst renderItem = (item, editFunction) => {\n  return (\n    <Widget\n      src=\"${REPL_AGIGUILD}/widget/Agent.AgentCard\"\n      props={{\n        item: convertSnakeToPascal(item),\n        editFunction,\n      }}\n    />\n  );\n};\n\nconst createWidget = \"near/widget/Entities.Template.EntityCreate\";\n\nreturn (\n  <div>\n    <Widget\n      src=\"near/widget/Entities.Template.EntityList\"\n      props={{ entityType, buildQueries, queryName, collection, renderItem, createWidget, schema }}\n    />\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/agiguild.near/widget/Agent.AgentEntityConfig", "fact_widget_deployments_id": "3dd7258ed70058e74e31b7739d3d5006", "inserted_timestamp": "2024-03-11T20:25:40.244Z", "modified_timestamp": "2024-03-11T20:25:40.244Z", "__row_index": 4}