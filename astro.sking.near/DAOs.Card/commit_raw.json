{"tx_hash": "8TG1N6YwJRKbgRgDhWqrPFxBaDyQdhy9VRPdR6uGVJRP", "action_id_social": "AoVaycWZppi1r4qcJHARNboVhf32RfeuTY79F6cug93i-0-widget", "block_id": 97498211, "block_timestamp": "2023-07-28T02:37:46.997Z", "signer_id": "astro.sking.near", "widget_name": "DAOs.Card", "source_code": "const daoId = props.daoId;\nconst balance = props.balance;\n\nif (!daoId) {\n  return \"DAO ID not provided\";\n}\n// -- Pikespeak API\nconst baseApi = \"https://api.pikespeak.ai\";\nconst publicApiKey = \"36f2b87a-7ee6-40d8-80b9-5e68e587a5b5\";\n\nconst fetchApiConfig = {\n  mode: \"cors\",\n  headers: {\n    \"x-api-key\": publicApiKey,\n  },\n};\n\nconst constructURL = (baseURL, paramObj) => {\n  let params = \"\";\n  for (const [key, value] of Object.entries(paramObj ?? {})) {\n    params += `${key}=${value}&`;\n  }\n  params = params.slice(0, -1);\n  return `${baseURL}?${params}`;\n};\n\nconst fether = {\n  balances: (accounts) => {\n    return fetch(\n      constructURL(`${baseApi}/account/balances`, { accounts }),\n      fetchApiConfig\n      );\n    },\n    proposalsStatus: (daoId) => {\n      return fetch(\n        constructURL(`${baseApi}/daos/proposals/status/${daoId}`),\n        fetchApiConfig\n        );\n  },\n};\nconst balances = fether.balances([daoId]);\nconst proposalsStatus = fether.proposalsStatus(daoId);\nlet activeProposalsCount;\nlet totalProposalsCount;\n\nproposalsStatus &&\nproposalsStatus.body?.forEach((p) => {\n  activeProposalsCount += p[\"InProgress\"] ? parseInt(p[\"InProgress\"]) : 0;\n  totalProposalsCount += p[\"Total\"] ? parseInt(p[\"Total\"]) : 0;\n});\n// --\n\n// -- Social DB\nconst profile = Social.get(`${daoId}/profile/**`, \"final\");\n// --\n\n// -- Smart Contract\nconst policy = Near.view(daoId, \"get_policy\");\nlet members = [];\npolicy && policy.roles.forEach((role) => {\n  if (typeof role.kind.Group === \"object\") {\n    members = members.concat(role.kind.Group);\n  }\n});\nmembers = [...new Set(members)];\n// --\n\nconst shorten = (str, len) => {\n  if (str.length <= len) {\n    return str;\n  }\n  return str.slice(0, len) + \"...\";\n};\n\nconst shortenNumber = (n) => {\n  if (n < 1e3) return n;\n  if (n >= 1e3 && n < 1e6) return (n / 1e3).toFixed(1) + \"k\";\n  if (n >= 1e6 && n < 1e9) return (n / 1e6).toFixed(1) + \"m\";\n  if (n >= 1e9 && n < 1e12) return (n / 1e9).toFixed(1) + \"b\";\n  if (n >= 1e12) return (n / 1e12).toFixed(1) + \"t\";\n};\n\nconst daoLink = ({ daoId, tab }) => {\n  return `/#/astro.sking.near/widget/DAO?daoId=${daoId}${tab && `&tab=${tab}`}`;\n};\n\nconst Wrapper = styled.div`\n  border: 1px solid transparent;\n\n  &:hover {\n    border: 1px solid #4498e0;\n  }\n\n  .dao-card-stats {\n    grid-template-columns: repeat(3, 1fr);\n    grid-template-rows: repeat(2, 1fr);\n    column-gap: 0.5rem;\n    row-gap: 0.2rem;\n\n    & > p:nth-child(1),\n    & > p:nth-child(2),\n    & > p:nth-child(3) {\n      font-size: 0.8rem;\n      color: #4498e0;\n      margin: 0;\n    }\n\n    & > p:nth-child(4),\n    & > p:nth-child(5),\n    & > p:nth-child(6) {\n      font-size: 0.8rem;\n      font-weight: 600;\n      margin: 0;\n    }\n\n    p > b {\n      font-size: 1.15rem;\n    }\n  }\n\n  a {\n    color: #4498e0;\n    font-size: 0.8rem;\n    font-weight: 600;\n    text-decoration: none;\n\n    &:hover {\n      color: #4498e0cc;\n  }\n`;\n\nreturn (\n  <Wrapper className=\"ndc-card p-4 d-flex flex-column gap-2 h-100\">\n    <Widget\n      src=\"nui.sking.near/widget/Element.User\"\n      props={{\n        accountId: daoId,\n        href: \"#/astro.sking.near/widget/DAO?daoId=\" + daoId,\n      }}\n    />\n    <p className=\"text-muted overflow-hidden small my-3 mx-1\">\n      {shorten(profile?.description || \"\", 80)}\n      {profile !== null &&\n        (!profile?.description || profile?.description?.length < 1) &&\n        \"No description\"}\n    </p>\n    <div className=\"d-grid justify-content-between text-center dao-card-stats mb-3 mt-auto\">\n      <p>DAO Funds</p>\n      <p>Members/Groups</p>\n      <p>Active proposals</p>\n      <p>\n        {balances && (\n          <>\n            <b className=\"me-1\">{shortenNumber(balances.body.totalUsd)}</b>USD\n          </>\n        )}\n      </p>\n      <p>\n        <b>{members.length}</b>/{policy.roles.length - 1}\n      </p>\n      <p>\n        <b>{activeProposalsCount}</b>/{totalProposalsCount}\n      </p>\n    </div>\n    <div className=\"d-flex gap-2 justify-content-around gap-3 mb-3\">\n      <a href={daoLink({ daoId, tab: \"settings\" })}>\n        <i className=\"bi me-1 bi-gear\" />\n        Settings\n      </a>\n      <a href={daoLink({ daoId, tab: \"nfts\" })}>\n        <i className=\"bi me-1 bi-image\" />\n        NFTs\n      </a>\n      <a href={daoLink({ daoId, tab: \"bounties\" })}>\n        <i className=\"bi me-1 bi-briefcase\" />\n        Bounties\n      </a>\n      <a href={daoLink({ daoId, tab: \"proposals\" })}>\n        <i className=\"bi me-1 bi-question-circle\" />\n        Polls\n      </a>\n    </div>\n    <div className=\"d-flex gap-2 justify-content-between\">\n      <Widget\n        src=\"nui.sking.near/widget/Social.FollowButton\"\n        props={{\n          variant: \"info flex-1 w-100\",\n          size: \"lg\",\n          accountId: daoId,\n        }}\n      />\n      <Widget\n        src=\"nui.sking.near/widget/Input.Button\"\n        props={{\n          variant: \"info outline flex-1 w-100\",\n          size: \"lg\",\n          buttonProps: {\n            style: {\n              fontWeight: 500,\n            },\n          },\n          children: <>View Profile</>,\n          href: daoLink({ daoId }),\n        }}\n      />\n    </div>\n  </Wrapper>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/astro.sking.near/widget/DAOs.Card", "fact_widget_deployments_id": "cbbd95fa131c713d5934c7dadcb3cedc", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 15}