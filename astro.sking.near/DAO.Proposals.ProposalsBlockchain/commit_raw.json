{"tx_hash": "59RwJLasWDB2nTmCx9hWDQbUiPoHvbV2uBtW5TNVKbAF", "action_id_social": "DQ3BuMLrYrZHxBfL43XXQpuAJvQyGoyQhzjxFsRvbJGi-0-widget", "block_id": 96767276, "block_timestamp": "2023-07-18T14:46:04.392Z", "signer_id": "astro.sking.near", "widget_name": "DAO.Proposals.ProposalsBlockchain", "source_code": "const daoId = props.daoId;\nconst proposalsPerPage = props.proposalsPerPage ?? 10; // Number of proposals to fetch at a time\n\nState.init({\n  daoId,\n  proposals: [],\n  lastProposalId: null, // To keep track of the last loaded proposal\n  hasMore: true, // Boolean to know if there are more proposals to load\n});\n\nconst loadProposals = () => {\n  const lastProposalId =\n    state.lastProposalId !== null\n      ? state.lastProposalId\n      : Near.view(daoId, \"get_last_proposal_id\");\n  if (lastProposalId === null) return;\n\n  // Prevents multiple calls to loadProposals() before the first call is finished\n  if (state.proposals.length > 0 && state.proposals[0].id === lastProposalId)\n    return;\n\n  const fromIndex = Math.max(0, lastProposalId - proposalsPerPage + 1); // Ensures fromIndex is never less than 0\n  const limit = fromIndex === 0 ? lastProposalId + 1 : proposalsPerPage; // Ensure we don't fetch the same proposals twice if fromIndex is 0\n\n  const newProposals = Near.view(daoId, \"get_proposals\", {\n    from_index: fromIndex,\n    limit: limit,\n  });\n  if (newProposals === null) return;\n\n  console.log(\"Saving new proposals...\");\n  State.update({\n    ...state,\n    hasMore: fromIndex > 0,\n    proposals: [...state.proposals, ...newProposals.reverse()],\n    lastProposalId: fromIndex - 1,\n    isLoading: false,\n  });\n};\n\nreturn (\n  <>\n    <InfiniteScroll loadMore={loadProposals} hasMore={state.hasMore}>\n      {state.proposals.map((proposal, i) => {\n        if (proposal.status === \"Removed\") return null;\n        return (\n          <Widget\n            key={i}\n            src={\"sking.near/widget/DAO.Proposal\"}\n            props={{\n              daoId: state.daoId,\n              proposal: proposal,\n            }}\n          />\n        );\n      })}\n    </InfiniteScroll>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/astro.sking.near/widget/DAO.Proposals.ProposalsBlockchain", "fact_widget_deployments_id": "20b7154d9a1f7963a63627903f746cde", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}