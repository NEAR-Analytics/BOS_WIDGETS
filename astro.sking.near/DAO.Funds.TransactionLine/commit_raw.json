{"tx_hash": "2NDcWLBbzRK6mf9y1y8iiqKULVr6yigdn2acu34mJQYG", "action_id_social": "9iJaes7XfLPVFFh5RKvD4J7vS9Uv2kazaVuZyEfs2vms-0-widget", "block_id": 96742290, "block_timestamp": "2023-07-18T06:57:48.444Z", "signer_id": "astro.sking.near", "widget_name": "DAO.Funds.TransactionLine", "source_code": "const transfer = props.transfer;\nconst daoId = props.daoId;\nconst type = props.type;\n\nconst direction = transfer.sender == daoId ? \"out\" : \"in\";\nconst explorerUrl = \"https://explorer.near.org\";\n\n// convert timestamp from ns to ms\nconst timestampMillis = Big(transfer.timestamp).div(1000000);\nconst date = new Date(timestampMillis.toNumber()).toLocaleString();\n\nconst ellipsis = (str, length) => {\n  if (str.length <= length) {\n    return str;\n  }\n  const mid = Math.floor(length / 2);\n  return str.slice(0, mid) + \"...\" + str.slice(str.length - mid);\n};\n\nlet proposalId = null;\n\nif (direction === \"out\") {\n  //   const res = fetch(\"https://archival-rpc.mainnet.near.org\", {\n  //     method: \"POST\",\n  //     headers: {\n  //       \"Content-Type\": \"application/json\",\n  //     },\n  //     body: JSON.stringify({\n  //       jsonrpc: \"2.0\",\n  //       id: \"dontcare\",\n  //       method: \"EXPERIMENTAL_tx_status\",\n  //       params: [transfer.transaction_id, transfer.sender],\n  //     }),\n  //   });\n\n  //   const argsBase64 = res.body.result.transaction.actions[0].FunctionCall.args;\n  //   if (argsBase64) {\n  //     const args = JSON.parse(\n  //       Buffer.from(argsBase64, \"base64\").toString(\"utf-8\")\n  //     );\n  //     proposalId = args.id;\n  //   }\n  const res = fetch(\n    \"https://api.pikespeak.ai/tx/graph-by-hash/\" + transfer.transaction_id,\n    {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"x-api-key\": \"36f2b87a-7ee6-40d8-80b9-5e68e587a5b5\",\n      },\n    }\n  );\n\n  proposalId =\n    res.body[0].transaction_graph.transaction.actions[0].action.args.id;\n}\n\nconst TransferDirectionIcon = styled.div`\n  background-color: ${(props) =>\n    props.direction == \"in\" ? \"#5BC65F\" : \"#DD5E56\"};\n  color: white;\n  border-radius: 50%;\n  margin-right: 1rem;\n  height: 50px;\n  width: 50px;\n  min-width: 50px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 28px;\n`;\n\nconst Container = styled.div`\n  display: grid;\n  grid-template-columns: 50px auto minmax(120px, 160px) minmax(120px, 160px);\n  grid-template-rows: 1fr;\n  grid-column-gap: 1rem;\n  align-items: center;\n`;\n\ncons\n\nreturn (\n  <Container>\n    <TransferDirectionIcon\n      direction={direction}\n      title={direction == \"in\" ? \"Incoming\" : \"Outgoing\"}\n    >\n      {direction == \"out\" ? (\n        <i className=\"bi bi-arrow-up-short\"></i>\n      ) : (\n        <i className=\"bi bi-arrow-down-short\"></i>\n      )}\n    </TransferDirectionIcon>\n    <div className=\"d-flex flex-column text-start tx-info gap-1 justify-content-start\">\n      <span title={direction == \"out\" ? transfer.receiver : transfer.sender}>\n        <Widget\n          src=\"nui.sking.near/widget/Element.User\"\n          props={{\n            accountId: direction == \"out\" ? transfer.receiver : transfer.sender,\n            options: {\n              size: \"sm\",\n              showSocialName: true,\n              showImage: false,\n            },\n          }}\n        />\n      </span>\n      <a\n        href={`${explorerUrl}/transactions/${transfer.transaction_id}`}\n        target=\"_blank\"\n        rel=\"noreferrer\"\n        title={transfer.transaction_id}\n      >\n        {ellipsis(transfer.transaction_id, 10)}\n        <i className=\"bi bi-box-arrow-up-right ms-1\"></i>\n      </a>\n      <span>{date}</span>\n    </div>\n    <div className=\"d-flex justify-content-end\">\n      <Widget\n        src=\"nui.sking.near/widget/Element.Token\"\n        props={{\n          amountWithDecimals:\n            direction == \"out\" ? -transfer.amount : transfer.amount,\n          address: type == \"ft\" ? transfer.contract : \"\",\n        }}\n      />\n    </div>\n    <div className=\"d-flex justify-content-end\">\n      {proposalId && (\n        <Widget\n          src=\"nui.sking.near/widget/Layout.Modal\"\n          props={{\n            toggle: (\n              <Widget\n                src=\"nui.sking.near/widget/Input.Button\"\n                props={{\n                  children: `Proposal #${proposalId}`,\n                  variant: \"secondary outline\",\n                  size: \"sm\",\n                }}\n              />\n            ),\n            content: (\n              <Widget\n                src=\"sking.near/widget/DAO.Proposal\"\n                props={{ daoId: daoId, proposalId: proposalId }}\n              />\n            ),\n          }}\n        />\n      )}\n    </div>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/astro.sking.near/widget/DAO.Funds.TransactionLine", "fact_widget_deployments_id": "dd13dc12e44470c96fab359461543767", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 6}