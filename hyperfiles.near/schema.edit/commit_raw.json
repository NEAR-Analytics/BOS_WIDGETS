{"tx_hash": "GC6bBZPAdwJ555bdizGYKddW3u9eW1pujXAvu4XbCK9Z", "action_id_social": "EJLwrxqBHLJGgz1xeGUHU8G1opxkaqU2BgfvxmWn6bU4-0-widget", "block_id": 117760551, "block_timestamp": "2024-04-27T20:30:17.889Z", "signer_id": "hyperfiles.near", "widget_name": "schema.edit", "source_code": "// schema.edit Component\nconst schemaPattern = props.schemaPattern ?? \"*/schema/*\";\nconst placeholder = props.placeholder ?? \"Schema\";\nconst initialSchemaObject = props.initialSchemaObject || {};\n\n// Import the schemaArray using VM.require()\n// Make sure the path is correctly specified according to your project structure\nconst { schemaArray } = VM.require(\"path/to/schema.array\");\n\nconsole.log(\"Imported schemaArray:\", schemaArray); // Debug output to check the imported array\n\nconst schemaObject = Social.keys(schemaPattern, \"final\");\n\nif (schemaObject === null) {\n  return \"Loading\";\n}\n\nconst normalizeProf = (prof) =>\n  prof\n    .replaceAll(/[- \\.]/g, \"_\")\n    .replaceAll(/[^\\w]+/g, \"\")\n    .replaceAll(/_+/g, \"-\")\n    .replace(/^-+/, \"\")\n    .replace(/-+$/, \"\")\n    .toLowerCase()\n    .trim(\"-\");\n\nconst schemaCount = {};\n\nconst processSchemaObject = (obj) => {\n  Object.entries(obj).forEach(([key, value]) => {\n    if (typeof value === \"object\") {\n      processSchemaObject(value);\n    } else {\n      const prof = normalizeProf(key);\n      schemaCount[prof] = (schemaCount[prof] || 0) + 1;\n    }\n  });\n};\n\nconst getSchema = () => {\n  processSchemaObject(schemaObject);\n  const schema = Object.entries(schemaCount);\n  schema.sort((a, b) => b[1] - a[1]);\n  return schema.map((t) => ({ name: t[0], count: t[1] }));\n};\n\nif (!state.allSchema) {\n  initState({\n    allSchema: getSchema().length > 0 ? getSchema() : schemaArray || [], // Fallback to empty array if schemaArray is undefined\n    schema: Object.keys(initialSchemaObject).map((prof) => ({\n      name: normalizeProf(prof),\n    })),\n    originalSchema: Object.fromEntries(\n      Object.keys(initialSchemaObject).map((prof) => [prof, null])\n    ),\n    id: `schema-selector-${Date.now()}`,\n  });\n}\n\nconst setSchema = (schema) => {\n  schema = schema.map((o) => ({ name: normalizeProf(o.name) }));\n  State.update({ schema });\n  if (props.setSchemaObject) {\n    props.setSchemaObject(\n      Object.assign(\n        {},\n        state.originalSchema,\n        Object.fromEntries(schema.map((prof) => [prof.name, \"\"]))\n      )\n    );\n  }\n};\n\nreturn (\n  <>\n    <Typeahead\n      id={state.id}\n      labelKey=\"name\"\n      onChange={setSchema}\n      options={state.allSchema}\n      placeholder={placeholder}\n      selected={state.schema}\n      positionFixed\n      allowNew\n    />\n    {props.debug && (\n      <div>\n        Debugging schema:\n        <pre>{JSON.stringify(state.schema)}</pre>\n      </div>\n    )}\n  </>\n);\n", "metadata": {"fork_of": "hyperfiles.near/widget/schema.edit@116718201"}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hyperfiles.near/widget/schema.edit", "fact_widget_deployments_id": "7f5de0d75207ff9b6e894262393fa227", "inserted_timestamp": "2024-04-28T02:45:10.322Z", "modified_timestamp": "2024-04-28T02:45:10.322Z", "__row_index": 1}