{"tx_hash": "6oSg2Jxn2Lp48kD9Nr987PR2EfCa6koSEnZrqxadFPj8", "action_id_social": "BnWKkHjPjggUxeCGt2supcmLVeaxgf4Y3HGo9U62xS3R-0-widget", "block_id": 116718258, "block_timestamp": "2024-04-12T23:40:59.228Z", "signer_id": "hyperfiles.near", "widget_name": "source.edit", "source_code": "const sourcePattern = props.sourcePattern ?? \"*/profile/source/*\";\nconst placeholder = props.placeholder ?? \"Source\";\nconst initialSourceObject = props.initialSourceObject || {};\n\nconst sourceObject = Social.keys(sourcePattern, \"final\");\n\nif (sourceObject === null) {\n  return \"Loading\";\n}\n\nconst normalizeProf = (prof) =>\n  prof\n    .replaceAll(/[- \\.]/g, \"_\")\n    .replaceAll(/[^\\w]+/g, \"\")\n    .replaceAll(/_+/g, \"-\")\n    .replace(/^-+/, \"\")\n    .replace(/-+$/, \"\")\n    .toLowerCase()\n    .trim(\"-\");\n\nconst sourceCount = {};\n\nconst processSourceObject = (obj) => {\n  Object.entries(obj).forEach((kv) => {\n    if (typeof kv[1] === \"object\") {\n      processSourceObject(kv[1]);\n    } else {\n      const prof = normalizeProf(kv[0]);\n      sourceCount[prof] = (sourceCount[prof] || 0) + 1;\n    }\n  });\n};\n\nconst getSource = () => {\n  processSourceObject(sourceObject);\n  const source = Object.entries(sourceCount);\n  source.sort((a, b) => b[1] - a[1]);\n  return source.map((t) => ({\n    name: t[0],\n    count: t[1],\n  }));\n};\n\nif (!state.allSource) {\n  initState({\n    allSource: getSource(),\n    source: Object.keys(initialSourceObject).map((prof) => ({\n      name: normalizeProf(prof),\n    })),\n    originalSource: Object.fromEntries(\n      Object.keys(initialSourceObject).map((prof) => [prof, null])\n    ),\n    id: `source-selector-${Date.now()}`,\n  });\n}\n\nconst setSource = (source) => {\n  source = source.map((o) => {\n    o.name = normalizeProf(o.name);\n    return o;\n  });\n  State.update({ source });\n  if (props.setSourceObject) {\n    props.setSourceObject(\n      Object.assign(\n        {},\n        state.originalSource,\n        Object.fromEntries(source.map((prof) => [prof.name, \"\"]))\n      )\n    );\n  }\n};\n\nreturn (\n  <>\n    <Typeahead\n      id={state.id}\n      labelKey=\"name\"\n      onChange={setSource}\n      options={state.allSource}\n      placeholder={placeholder}\n      selected={state.source}\n      positionFixed\n      allowNew\n    />\n    {props.debug && (\n      <div>\n        Debugging source:\n        <pre>{JSON.stringify(state.source)}</pre>\n      </div>\n    )}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hyperfiles.near/widget/source.edit", "fact_widget_deployments_id": "dcfc101f93dbd054f0bf98c0d7ee9828", "inserted_timestamp": "2024-04-13T01:48:44.908Z", "modified_timestamp": "2024-04-13T01:48:44.908Z", "__row_index": 0}