{"tx_hash": "h1bmsUgwbeGzoEiGZb5LmgsVjCRETDkzxExABbpgmzM", "action_id_social": "8rMkN1LSmmw2PsjjfMiVp6WZE47jx7NEJygxsQkQxy34-0-widget", "block_id": 116718944, "block_timestamp": "2024-04-12T23:53:32.293Z", "signer_id": "hyperfiles.near", "widget_name": "index-dev", "source_code": "const TabContent = styled.div`\n  margin-top: 1rem;\n`;\n\nconst Form = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n  width: 100%;\n`;\n\nconst Label = styled.label`\n  font-weight: bold;\n`;\n\nconst Input = styled.input`\n  padding: 5px;\n`;\n\nconst Select = styled.select`\n  padding: 8px;\n`;\n\nconst FormGroup = styled.div`\n  display: flex;\n  flex-direction: column;\n`;\n\nconst Button = styled.button``;\n\nconst adapters = [\n  // these can come from the user (or app) settings\n  // {\n  //   title: \"Local Storage\",\n  //   value: \"everycanvas.near/widget/adapter.local_storage\",\n  //   saveRef: false\n  // },\n  // {\n  //   title: \"SocialDB\",\n  //   value: \"everycanvas.near/widget/adapter.social\",\n  // },\n  {\n    title: \"\",\n    value: \"\",\n  },\n  {\n    title: \"IPFS\",\n    value: \"everycanvas.near/widget/adapter.ipfs\",\n    refType: { cid: \"string\" },\n  },\n  // {\n  //   title: \"Custom\",\n  //   value: \"custom\",\n  // },\n  {\n    title: \"GitHub\",\n    value: \"hyperfiles.near/widget/adapter.github\",\n  },\n  // {\n  //   title: \"Obsidian\",\n  //   value: \"hack.near/widget/adapter.obsidian\",\n  // },\n  // {\n  //   title: \"Tldraw\",\n  //   value: \"hack.near/widget/adapter.tldraw\",\n  // },\n];\n\n//const { GitHubAPIExample } = VM.require(  \"create.near/widget/GitHub.API.Example\");\n\nconst [rawData, setRawData] = useState(\"\");\nconst [source, setSource] = useState(\"\");\nconst [schema, setSchema] = useState(\"\");\nconst [adapter, setAdapter] = useState(\"\");\nconst [reference, setReference] = useState(undefined);\nconst [activeTab, setActiveTab] = useState(\"data\");\nconst [name, setName] = useState(props.name ?? \"\");\nconst [description, setDescription] = useState(props.description ?? \"\");\nconst [hyperfile, setHyperfile] = useState(\"\");\nconst [type, setType] = useState(\"\");\nconst [filePath, setFilePath] = useState(null);\n\nconst handleSelectRepository = (selectedFilePath) => {\n  console.log(\"Selected repository:\", selectedFilePath);\n  // Assuming you need the repository's file path or some specific identifier\n  setFilePath(selectedFilePath); // or any specific attribute you need\n};\n\nconst rawAdapter =\n  (adapter !== \"\" || adapter !== \"custom\") && Social.get(adapter, \"final\");\nconst { create } =\n  ((adapter !== \"\" || adapter !== \"custom\") && VM.require(adapter)) ||\n  (() => {});\n\nconst functionRegex = /function\\s+(\\w+)\\s*\\(([^)]*)\\)\\s*{([\\s\\S]*?)\\n}/g;\n\nfunction parseAdapter(code) {\n  let match;\n  const functions = [];\n\n  while ((match = functionRegex.exec(code)) !== null) {\n    const [_, functionName, params, content] = match;\n    functions.push({ functionName, params, content });\n  }\n\n  return functions.map((func, index) => (\n    <FormGroup key={index}>\n      <Label>{func.functionName}</Label>\n      <textarea\n        className=\"form-control\"\n        style={{ width: \"100%\", height: \"100%\" }}\n        value={func.content.trim()}\n        disabled\n      />\n    </FormGroup>\n  ));\n}\n\nfunction generateUID() {\n  const maxHex = 0xffffffff;\n  const randomNumber = Math.floor(Math.random() * maxHex);\n  return randomNumber.toString(16).padStart(8, \"0\");\n}\n\nconst handleCreate = () => {\n  if (create) {\n    console.log(\"it's something\", rawData);\n    // store the data somewhere, based on the adapter\n    create(rawData).then((reference) => {\n      // now we have a reference to the data\n      const thingId = generateUID();\n\n      const hyperfile = {\n        thing: {\n          // which we store in the social contract\n          [thingId]: {\n            \"\": JSON.stringify({\n              source: source,\n              adapter: adapter,\n              reference: reference,\n            }),\n            metadata: {\n              name: name,\n              description: description,\n              schema: schema,\n            },\n          },\n        },\n      };\n\n      setHyperfile(JSON.stringify(hyperfile, null, 2));\n    });\n  } else {\n    console.log(\"invalid adapter\");\n  }\n};\n\nconsole.log(\"source: \", source);\nconsole.log(\"schema: \", schema);\n//console.log(\"data: \", rawData);\n//console.log(\"adapter: \", adapter);\n\nreturn (\n  <div className=\"container mt-3\">\n    <div className=\"row p-3\">\n      <h1>Hyperfile Creator</h1>\n    </div>\n    <ul className=\"nav nav-tabs\">\n      <li className=\"nav-item\">\n        <a\n          className={`nav-link ${activeTab === \"data\" ? \"active\" : \"\"}`}\n          onClick={() => setActiveTab(\"data\")}\n        >\n          Data\n        </a>\n      </li>\n      <li className=\"nav-item\">\n        <a\n          className={`nav-link ${activeTab === \"metadata\" ? \"active\" : \"\"}`}\n          onClick={() => setActiveTab(\"metadata\")}\n        >\n          Metadata\n        </a>\n      </li>\n    </ul>\n    <div className=\"row\">\n      <TabContent>\n        {activeTab === \"data\" && (\n          <div className=\"row\">\n            <div className=\"col\">\n              <div className=\"p-3 border bg-light\">\n                <Form>\n                  <h3>Content</h3>\n                  <FormGroup>\n                    <Label>Source</Label>\n                    <Widget\n                      src=\"hyperfiles.near/widget/MetadataEditor\"\n                      props={{\n                        initialMetadata: profile,\n                        onChange: (newValue) => {\n                          console.log(\"New Source:\", newValue);\n                          setSource(newValue); // Update local state\n                          State.update({\n                            profile: { ...profile, source: newValue }, // Update external state\n                          });\n                        },\n                        value: source,\n                        options: {\n                          source: {\n                            sourcePattern: \"*/profile/source/*\",\n                            placeholder: \"Select a source\",\n                          },\n                        },\n                      }}\n                    />\n                  </FormGroup>\n                  <FormGroup>\n                    <Label>Schema</Label>\n                    <Widget\n                      src=\"hyperfiles.near/widget/MetadataEditor\"\n                      props={{\n                        initialMetadata: profile,\n                        onChange: (newValue) => {\n                          console.log(\"New Schema:\", newValue);\n                          setSchema(newValue); // Update local state\n                          State.update({\n                            profile: { ...profile, schema: newValue }, // Update external state\n                          });\n                        },\n                        value: schema,\n                        options: {\n                          source: {\n                            schemaPattern: \"*/profile/schema/*\",\n                            placeholder: \"Select a schema\",\n                          },\n                        },\n                      }}\n                    />\n                  </FormGroup>\n                  <FormGroup>\n                    <Label>Raw Data</Label>\n                    <textarea\n                      className=\"form-control\"\n                      style={{ width: \"100%\", height: \"400px\" }}\n                      value={rawData}\n                      onChange={(e) => setRawData(e.target.value)}\n                    />\n                  </FormGroup>\n                </Form>\n              </div>\n            </div>\n            <div className=\"col\">\n              <div className=\"p-3 border bg-light\">\n                <Form>\n                  <h3>Storage</h3>\n                  <FormGroup>\n                    <Label>Adapter</Label>\n                    <Select\n                      value={adapter}\n                      onChange={(e) => setAdapter(e.target.value)}\n                    >\n                      {adapters.map((o) => (\n                        <option value={o.value}>{o.title}</option>\n                      ))}\n                    </Select>\n                  </FormGroup>\n                  {rawAdapter && <>{parseAdapter(rawAdapter)}</>}\n                  {adapter === \"hyperfiles.near/widget/adapter.github\" && (\n                    <Widget\n                      src=\"flowscience.near/widget/GitHubSearchSelect\"\n                      onSelectRepository={handleSelectRepository}\n                    ></Widget>\n                  )}\n                </Form>\n              </div>\n            </div>\n            <div className=\"col\">\n              <div className=\"p-3 border bg-light\">\n                <Form>\n                  <Button\n                    onClick={handleCreate}\n                    disabled={!adapter || !schema || !source || !rawData}\n                  >\n                    create reference\n                  </Button>\n                  {hyperfile !== \"\" && (\n                    <>\n                      <FormGroup>\n                        <textarea\n                          className=\"form-control\"\n                          value={hyperfile}\n                          disabled\n                          style={{ width: \"100%\", height: \"400px\" }}\n                        />\n                      </FormGroup>\n                      <Button\n                        onClick={() =>\n                          Social.set(JSON.parse(hyperfile), { force: true })\n                        }\n                      >\n                        save\n                      </Button>\n                    </>\n                  )}\n                </Form>\n              </div>\n            </div>\n          </div>\n        )}\n      </TabContent>\n      <TabContent>\n        {activeTab === \"metadata\" && (\n          <Form>\n            <h3>metadata</h3>\n            <FormGroup>\n              <Label>name</Label>\n              <Input\n                type=\"text\"\n                value={name}\n                onChange={(e) => setName(e.target.value)}\n              />\n            </FormGroup>\n            <FormGroup>\n              <Label>description</Label>\n              <textarea\n                className=\"form-control mb-3\"\n                rows={5}\n                value={description}\n                onChange={(e) => setDescription(e.target.value)}\n              />\n            </FormGroup>\n          </Form>\n        )}\n      </TabContent>\n    </div>\n  </div>\n);\n", "metadata": {"fork_of": "hyperfiles.near/widget/index@106842904"}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hyperfiles.near/widget/index-dev", "fact_widget_deployments_id": "9b9eec58e42b6b49edcc40ac73b325ea", "inserted_timestamp": "2024-04-13T01:48:44.908Z", "modified_timestamp": "2024-04-13T01:48:44.908Z", "__row_index": 13}