{"tx_hash": "Ax1icpLW61TH2SAebE6TRNAo8HgwWcbJF2Yk45Tz9cSh", "action_id_social": "AkiCC4HHX85u9KaLqrEdNa1wsjLEy84LGWNYHie5KtPL-0-widget", "block_id": 113193859, "block_timestamp": "2024-02-20T02:50:09.705Z", "signer_id": "rodrigos.near", "widget_name": "NDC.ArticleHistory.Handler", "source_code": "//NDC.ArticleHistory.Handler\n\nconst addressForArticles = \"wikiTest2Article\";\nconst {\n  articleId,\n  sbtWhiteList,\n  isTest,\n  sbts,\n  baseActions,\n  kanbanColumns,\n  callLibs,\n  widgets,\n} = props;\n\nconst initLibsCalls = {\n  article: [\n    {\n      functionName: \"getArticleVersions\",\n      key: \"versions\",\n      props: {\n        env: isTest ? \"test\" : \"prod\",\n        sbtsNames: sbtWhiteList,\n        articleIdToFilter: articleId,\n      },\n    },\n  ],\n};\n\nState.init({\n  selectedTab: \"code\",\n  selectedBlockHeight: null,\n  functionsToCallByLibrary: initLibsCalls,\n});\n\nlet newLibsCalls = state.functionsToCallByLibrary;\n\nState.update({ libsCalls: newLibsCalls });\n\nconst libSrcArray = [widgets.libs.libArticle];\n\nconst versions = state.versions ?? [];\n\nif (props.count) props.count(versions.length);\n\nif (!state.selectedBlockHeight)\n  state.selectedBlockHeight = versions[0].blockHeight;\n\nconst renderBlockChangesLink = (version) => {\n  if (!version) return <>Loading...</>;\n\n  const timeLastEdit = new Date(version.timeLastEdit);\n\n  return (\n    <div>\n      <button\n        className={`list-group-item list-group-item-action ${\n          state.selectedBlockHeight != version.blockHeight\n            ? \"\"\n            : \"list-group-item-info\"\n        }`}\n        onClick={() => {\n          State.update({ selectedBlockHeight: version.blockHeight });\n        }}\n      >\n        #{version.blockHeight} *{\" \"}\n        {timeLastEdit.toDateString() + \" \" + timeLastEdit.toLocaleTimeString()}\n      </button>\n    </div>\n  );\n};\n\nfunction renderWidgetCode(blockHeight) {\n  const currentVersionDisplayed = versions.find(\n    (version) => version.blockHeight == blockHeight\n  );\n  const index = versions.findIndex((el) => el.blockHeight == blockHeight);\n  const prevBlockHeightObject = versions[index + 1];\n  return (\n    <Widget\n      style={{ minHeight: \"200px\" }}\n      key={blockHeight}\n      src={`f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/NDC.ArticleHistory.Container`}\n      props={{\n        pathToCurrentArticle: `${blockHeight.lastEditor}/${addressForArticles}/main`,\n        currentBlockHeight: blockHeight,\n        currentVersionData: currentVersionDisplayed,\n        allVersionsData: versions,\n        pathToPrevArticle: `${prevBlockHeightObject.lastEditor}/${addressForArticles}/main`,\n        prevBlockHeight: prevBlockHeightObject.blockHeight,\n      }}\n    />\n  );\n}\n\nfunction blockHeightToWidgetRender(blockHeight, allArticles) {\n  const index = versions.findIndex((el) => el.blockHeight == blockHeight);\n  return <Markdown text={allArticles[index].body} />;\n}\n\nfunction articleHistoryHasndlerStateUpdate(obj) {\n  State.update(obj);\n}\n\n//styles forked from calebjacob.near/widget/Activity\nconst Tabs = styled.div`\n  display: flex;\n  padding: 0 12px;\n  height: 48px;\n  border-bottom: 1px solid #ECEEF0;\n`;\n\nconst TabsButton = styled.button`\n  font-weight: 400;\n  font-size: 14px;\n  line-height: 17px;\n  padding: 0 12px;\n  position: relative;\n  color: ${(p) => (p.selected ? \"#11181C\" : \"#687076\")};\n  background: none;\n  border: none;\n  outline: none;\n\n  &:hover {\n    color: #11181C;\n  }\n\n  &::after {\n    content: '';\n    display: ${(p) => (p.selected ? \"block\" : \"none\")};\n    position: absolute;\n    bottom: 0;\n    left: 12px;\n    right: 12px;\n    height: 3px;\n    background: #0091FF;\n  }\n`;\n\nconst CallLibrary = styled.div`\n  display: block;\n`;\n\nreturn (\n  <>\n    <div className=\"mt-2\">\n      <h3 className=\"text-center\">Article History</h3>\n      {!versions ? (\n        <div>incorrent widget path</div>\n      ) : (\n        <div>\n          <div div className=\"card mb-3\">\n            <h3 className=\"card-header\">{versions.length} Commits</h3>\n            <div className=\"list-group\">\n              {versions\n                .slice(0, 5)\n                .map((height) => renderBlockChangesLink(height))}\n              <div className=\"collapse\" id=\"collapseExample\">\n                {versions\n                  .slice(5)\n                  .map((height) => renderBlockChangesLink(height))}\n              </div>\n              {versions.length > 5 && (\n                <button\n                  className=\"list-group-item active\"\n                  type=\"button\"\n                  data-bs-toggle=\"collapse\"\n                  data-bs-target=\"#collapseExample\"\n                  aria-expanded=\"false\"\n                  aria-controls=\"collapseExample\"\n                >\n                  Show all\n                </button>\n              )}\n            </div>\n          </div>\n\n          <Tabs>\n            <TabsButton\n              type=\"button\"\n              onClick={() =>\n                State.update({\n                  selectedTab: \"code\",\n                })\n              }\n              selected={state.selectedTab == \"code\"}\n            >\n              Code\n            </TabsButton>\n\n            <TabsButton\n              type=\"button\"\n              onClick={() =>\n                State.update({\n                  selectedTab: \"render\",\n                })\n              }\n              selected={state.selectedTab == \"render\"}\n            >\n              Render\n            </TabsButton>\n          </Tabs>\n\n          {state.selectedTab == \"code\" && (\n            <div>{renderWidgetCode(state.selectedBlockHeight)}</div>\n          )}\n\n          {state.selectedTab == \"render\" && (\n            <div>\n              {blockHeightToWidgetRender(state.selectedBlockHeight, versions)}\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n    <CallLibrary>\n      {libSrcArray.map((src) => {\n        return callLibs(\n          src,\n          articleHistoryHasndlerStateUpdate,\n          state.functionsToCallByLibrary,\n          { baseAction: baseActions.articlesBaseAction, kanbanColumns },\n          \"NDC.ArticleHistory.Handler\"\n        );\n      })}\n    </CallLibrary>\n  </>\n);\n", "metadata": {"platform": "jutsu.ai"}, "branch": {"draft": null}, "widget_modules_used": null, "widget_url": "https://near.social/#/rodrigos.near/widget/NDC.ArticleHistory.Handler", "fact_widget_deployments_id": "db3ef92bdd2b8613ec1853a87855013e", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 4}