{"tx_hash": "5eMQ5ck6tygTnCvCfJgoAgJhW3BLKtSpXDcoR2wL4NMB", "action_id_social": "3JKxu9NMbZGsrGxSqDLrd9SW995xorvEt79MwiwZ6Dx2-0-widget", "block_id": 97853295, "block_timestamp": "2023-08-01T16:58:16.203Z", "signer_id": "rodrigos.near", "widget_name": "MetaPoolStakeEth.Counter", "source_code": "State.init({\n  mpEthPriceIntervalStarted: false,\n});\n\nconst stakingData = props.stakingData || undefined;\nconst stakedBalance = props.stakedBalance || undefined;\nconst ethUsdPrice = props.ethUsdPrice || undefined;\nconst tokenDecimals = props.tokenDecimals || undefined;\n\nconst getMpETHPrice = () => {\n  if (\n    !stakingData ||\n    Big(stakingData.totalSupply).eq(0) ||\n    Big(stakingData.totalUnderlying).eq(0)\n  ) {\n    return Big(\"1000000000000000000\").toString();\n  }\n\n  const rewardsSinceUpdate = Big(stakingData.estimatedRewardsPerSecond)\n    .mul(\n      Math.floor(Date.now()) -\n        (Big(stakingData.submitReportUnlockTime).toNumber() -\n          Big(stakingData.submitReportTimelock).toNumber()) *\n          1000\n    )\n    .div(1000);\n\n  const assets = Big(stakingData.totalUnderlying).add(rewardsSinceUpdate);\n\n  return assets\n    .mul(Big(\"1000000000000000000\"))\n    .div(Big(stakingData.totalSupply))\n    .toString()\n    .split(\".\")[0];\n};\n\nif (!state.mpEthPriceIntervalStarted && stakedBalance && ethUsdPrice) {\n  State.update({ mpEthPriceIntervalStarted: true });\n\n  setInterval(() => {\n    const bigMpEthPrice = Big(getMpETHPrice());\n\n    const mpEthPrice = bigMpEthPrice\n      .div(Big(10).pow(tokenDecimals))\n      .toFixed(11)\n      .replace(/\\d(?=(\\d{3})+\\.)/g, \"$&,\");\n\n    const userMpEthInEth = bigMpEthPrice\n      .mul(parseFloat(stakedBalance))\n      .div(Big(10).pow(tokenDecimals))\n      .toFixed(11)\n      .replace(/\\d(?=(\\d{3})+\\.)/g, \"$&,\");\n\n    const userMpEthUsd = bigMpEthPrice\n      .mul(ethUsdPrice)\n      .div(Big(10).pow(tokenDecimals))\n      .toFixed(2)\n      .replace(/\\d(?=(\\d{3})+\\.)/g, \"$&,\");\n\n    State.update({ mpEthPrice, userMpEthInEth, userMpEthUsd });\n  }, 500);\n}\n\nreturn (\n  <div\n    style={{\n      display: \"flex\",\n      justifyContent: \"center\",\n      padding: \"0 16px\",\n      width: \"100%\",\n      border: \"#D7E0E4 1px solid\",\n      borderRadius: \"16px\",\n    }}\n  >\n    <div\n      style={{\n        width: \"300px\",\n      }}\n    >\n      <div\n        style={{\n          display: \"flex\",\n          justifyContent: \"space-between\",\n          textAlign: \"center\",\n          fontVariantNumeric: \"tabular-nums\",\n        }}\n      >\n        <div style={{ fontWeight: 600 }}>mpETH/ETH Price:</div>\n        <div>{state.mpEthPrice}</div>\n      </div>\n      <div\n        style={{\n          display: \"flex\",\n          justifyContent: \"space-between\",\n          textAlign: \"center\",\n          fontVariantNumeric: \"tabular-nums\",\n        }}\n      >\n        <div style={{ fontWeight: 600 }}>Your mpETH/ETH:</div>\n        <div>{state.userMpEthInEth}</div>\n      </div>\n      <div\n        style={{\n          display: \"flex\",\n          justifyContent: \"space-between\",\n          textAlign: \"center\",\n          fontVariantNumeric: \"tabular-nums\",\n        }}\n      >\n        <div style={{ fontWeight: 600 }}>Your mpETH/USD:</div>\n        <div>{state.userMpEthUsd} $</div>\n      </div>\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/rodrigos.near/widget/MetaPoolStakeEth.Counter", "fact_widget_deployments_id": "770b5916da40b3a25f20baff744249ba", "inserted_timestamp": "2023-08-01T18:47:25.703Z", "modified_timestamp": "2023-08-01T18:47:25.703Z", "__row_index": 1}