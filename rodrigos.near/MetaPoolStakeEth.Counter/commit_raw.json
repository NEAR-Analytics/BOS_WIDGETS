{"tx_hash": "9Y26FKNFZt3G8VKeXL4VfrxwXD7NNjt6JZ8cTDvSCaqN", "action_id_social": "589ANzQzY9qprFB1CsuVhhaY4sawXRXB4t3s7BrDjKbg-0-widget", "block_id": 97858226, "block_timestamp": "2023-08-01T18:33:40.779Z", "signer_id": "rodrigos.near", "widget_name": "MetaPoolStakeEth.Counter", "source_code": "State.init({\n  mpEthPriceIntervalStarted: false,\n});\n\nconst stakingData = props.stakingData || undefined;\nconst stakedBalance = props.stakedBalance || undefined;\nconst ethUsdPrice = props.ethUsdPrice || undefined;\nconst tokenDecimals = props.tokenDecimals || undefined;\n\nconst getMpETHPrice = () => {\n  if (\n    !stakingData ||\n    Big(stakingData.totalSupply).eq(0) ||\n    Big(stakingData.totalUnderlying).eq(0)\n  ) {\n    return Big(\"1000000000000000000\").toString();\n  }\n\n  const rewardsSinceUpdate = Big(stakingData.estimatedRewardsPerSecond)\n    .mul(\n      Math.floor(Date.now()) -\n        (Big(stakingData.submitReportUnlockTime).toNumber() -\n          Big(stakingData.submitReportTimelock).toNumber()) *\n          1000\n    )\n    .div(1000);\n\n  const assets = Big(stakingData.totalUnderlying).add(rewardsSinceUpdate);\n\n  return assets\n    .mul(Big(\"1000000000000000000\"))\n    .div(Big(stakingData.totalSupply))\n    .toString()\n    .split(\".\")[0];\n};\n\nif (!state.mpEthPriceIntervalStarted && stakedBalance && ethUsdPrice) {\n  State.update({ mpEthPriceIntervalStarted: true });\n\n  setInterval(() => {\n    const bigMpEthPrice = Big(getMpETHPrice());\n\n    const mpEthPrice = bigMpEthPrice\n      .div(Big(10).pow(tokenDecimals))\n      .toFixed(11)\n      .replace(/\\d(?=(\\d{3})+\\.)/g, \"$&,\");\n\n    const userMpEthInEth = bigMpEthPrice\n      .mul(parseFloat(stakedBalance))\n      .div(Big(10).pow(tokenDecimals))\n      .toFixed(11)\n      .replace(/\\d(?=(\\d{3})+\\.)/g, \"$&,\");\n\n    const userMpEthUsd = bigMpEthPrice\n      .mul(stakedBalance)\n      .div(Big(10).pow(tokenDecimals))\n      .toFixed(2)\n      .replace(/\\d(?=(\\d{3})+\\.)/g, \"$&,\");\n\n    State.update({ mpEthPrice, userMpEthInEth, userMpEthUsd });\n  }, 500);\n}\n\nreturn (\n  <div\n    style={{\n      display: \"flex\",\n      justifyContent: \"center\",\n      padding: \"0 16px\",\n      width: \"100%\",\n      border: \"#D7E0E4 1px solid\",\n      borderRadius: \"16px\",\n    }}\n  >\n    <div\n      style={{\n        minWidth: \"300px\",\n        width: \"100%\",\n        fontVariantNumeric: \"tabular-nums\",\n        fontWeight: 600,\n      }}\n    >\n      <div\n        style={{\n          display: \"flex\",\n          justifyContent: \"space-between\",\n          textAlign: \"center\",\n        }}\n      >\n        <div>mpETH/ETH Price:</div>\n        <div>{state.mpEthPrice}</div>\n      </div>\n      <div\n        style={{\n          display: \"flex\",\n          justifyContent: \"space-between\",\n          textAlign: \"center\",\n        }}\n      >\n        <div>Your mpETH/ETH:</div>\n        <div>{state.userMpEthInEth}</div>\n      </div>\n      <div\n        style={{\n          display: \"flex\",\n          justifyContent: \"space-between\",\n          textAlign: \"center\",\n        }}\n      >\n        <div>Your mpETH/USD:</div>\n        <div>{state.userMpEthUsd ? `${state.userMpEthUsd} $` : \"\"}</div>\n      </div>\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/rodrigos.near/widget/MetaPoolStakeEth.Counter", "fact_widget_deployments_id": "307ef82ef39f6c6e383922d00ea3b29f", "inserted_timestamp": "2023-08-01T20:32:45.683Z", "modified_timestamp": "2023-08-01T20:32:45.683Z", "__row_index": 0}