{"tx_hash": "3CyqkfK92JVJ3SJGdeNVvYkQxQBFpq5rfBYBYgPDSrAt", "action_id_social": "AX8ZLdkapiofjVicfqqDzgWoEGLc86fd77epZqEfpdyT-0-widget", "block_id": 97852138, "block_timestamp": "2023-08-01T16:36:07.291Z", "signer_id": "rodrigos.near", "widget_name": "MetaPoolStakeEth.Counter", "source_code": "State.init({\n  mpEthPriceIntervalStarted: false,\n});\n\nconst stakingData = props.stakingData || undefined;\nconst stakedBalance = props.stakedBalance || undefined;\nconst ethUsdPrice = props.ethUsdPrice || undefined;\n\nconst getMpETHPrice = () => {\n  if (\n    !stakingData ||\n    Big(stakingData.totalSupply).eq(0) ||\n    Big(stakingData.totalUnderlying).eq(0)\n  ) {\n    return Big(\"1000000000000000000\").toString();\n  }\n\n  const rewardsSinceUpdate = Big(stakingData.estimatedRewardsPerSecond)\n    .mul(\n      Math.floor(Date.now()) -\n        (Big(stakingData.submitReportUnlockTime).toNumber() -\n          Big(stakingData.submitReportTimelock).toNumber()) *\n          1000\n    )\n    .div(1000);\n\n  const assets = Big(stakingData.totalUnderlying).add(rewardsSinceUpdate);\n\n  return assets\n    .mul(Big(\"1000000000000000000\"))\n    .div(Big(stakingData.totalSupply))\n    .toString()\n    .split(\".\")[0];\n};\n\nif (!state.mpEthPriceIntervalStarted && stakedBalance && ethUsdPrice) {\n  State.update({ mpEthPriceIntervalStarted: true });\n\n  setInterval(() => {\n    const bigMpEthPrice = Big(getMpETHPrice());\n\n    const mpEthPrice = bigMpEthPrice\n      .div(Big(10).pow(tokenDecimals))\n      .toFixed(11)\n      .replace(/\\d(?=(\\d{3})+\\.)/g, \"$&,\");\n\n    const userMpEthInEth = bigMpEthPrice\n      .mul(parseFloat(stakedBalance))\n      .div(Big(10).pow(tokenDecimals))\n      .toFixed(11)\n      .replace(/\\d(?=(\\d{3})+\\.)/g, \"$&,\");\n\n    const userMpEthUsd = bigMpEthPrice\n      .mul(ethUsdPrice)\n      .div(Big(10).pow(tokenDecimals))\n      .toFixed(2)\n      .replace(/\\d(?=(\\d{3})+\\.)/g, \"$&,\");\n\n    State.update({ mpEthPrice, userMpEthInEth, userMpEthUsd });\n  }, 500);\n}\n\n{\n  false && (\n    <div\n      style={{\n        display: \"flex\",\n        justifyContent: \"center\",\n        padding: \"0 16px\",\n        width: \"100%\",\n        border: \"#D7E0E4 1px solid\",\n        borderRadius: \"16px\",\n      }}\n    >\n      <div\n        style={{\n          width: \"300px\",\n        }}\n      >\n        <div\n          style={{\n            display: \"flex\",\n            justifyContent: \"space-between\",\n            textAlign: \"center\",\n            fontVariantNumeric: \"tabular-nums\",\n          }}\n        >\n          <div>mpETH/ETH Price:</div>\n          <div>{state.mpEthPrice}</div>\n        </div>\n        <div\n          style={{\n            display: \"flex\",\n            justifyContent: \"space-between\",\n            textAlign: \"center\",\n            fontVariantNumeric: \"tabular-nums\",\n          }}\n        >\n          <div>Your mpETH/ETH:</div>\n          <div>{state.userMpEthInEth}</div>\n        </div>\n        {false && (\n          <div\n            style={{\n              display: \"flex\",\n              justifyContent: \"space-between\",\n              textAlign: \"center\",\n              fontVariantNumeric: \"tabular-nums\",\n            }}\n          >\n            <div>Your mpETH/USD:</div>\n            <div>{state.userMpEthUsd} $</div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/rodrigos.near/widget/MetaPoolStakeEth.Counter", "fact_widget_deployments_id": "39dade43314fa30e89b1e79df1cc2f06", "inserted_timestamp": "2023-08-01T18:34:55.725Z", "modified_timestamp": "2023-08-01T18:34:55.725Z", "__row_index": 7}