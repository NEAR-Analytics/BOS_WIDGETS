{"tx_hash": "9AiVv71fuNd5vPKEr4BEwzPeHgXw1VYGZWxcY8RxuyVo", "action_id_social": "2snm7SGfyB2JDQWYgfSHSJTsvKX2LM6DcnfQcKSS2eB3-0-widget", "block_id": 113194036, "block_timestamp": "2024-02-20T02:53:27.274Z", "signer_id": "rodrigos.near", "widget_name": "NDC.CompactPost", "source_code": "// NDC.CompactPost\n\nconst {\n  widgets,\n  article,\n  kanbanColumns,\n  handleOpenArticle,\n  handleFilterArticles,\n  handleShareButton,\n  colLabel,\n  baseActions,\n  callLibs,\n} = props;\n\nconst libSrcArray = [widgets.libs.libArticle];\n\nState.init({\n  showModal: false,\n  functionsToCallByLibrary: {\n    article: [],\n  },\n});\n\nfunction compactPostStateUpdate(obj) {\n  State.update(obj);\n}\n\nfunction onCommit() {\n  State.update({ showModal: false });\n}\n\nfunction onCancel() {\n  State.update({ showModal: false });\n}\n\nfunction moveArticleListener() {\n  if (!state.newLabel) {\n    return;\n  }\n  //To test without commiting use the next line and comment the rest\n  // onCommit();\n  // State.update({ saving: true });\n  const article = getArticleData();\n  const newLibsCalls = Object.assign({}, state.functionsToCallByLibrary);\n  newLibsCalls.article.push({\n    functionName: \"createArticle\",\n    key: \"createdArticle\",\n    props: {\n      article,\n      onCommit,\n      onCancel,\n    },\n  });\n\n  State.update({ functionsToCallByLibrary: newLibsCalls });\n}\n\nfunction getArticleData() {\n  let newTags = article.tags.filter((tag) => {\n    let lowerCaseTag = tag.toLowerCase().replace(` `, \"-\");\n\n    const lowercaseLabels = [];\n    kanbanColumns.forEach((col) =>\n      lowercaseLabels.push(col.toLowerCase().replace(` `, \"-\"))\n    );\n\n    return !lowercaseLabels.includes(lowerCaseTag);\n  });\n\n  newTags.push(state.newLabel.toLowerCase().replace(` `, \"-\"));\n\n  let newArticleData = article;\n  newArticleData.tags = newTags;\n\n  return newArticleData;\n}\n\nconst Spinner = () => {\n  return (\n    <SpinnerContainer className=\"spinner-border text-secondary\" role=\"status\">\n      <span className=\"sr-only\" title=\"Loading...\"></span>\n    </SpinnerContainer>\n  );\n};\n\nconst ModalContainer = styled.div`\n    position: fixed;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    top: 0;\n    left: 0;\n    height: 100%;\n    width: 100%;\n    backdrop-filter: blur(10px);\n    z-index: 1;\n  `;\n\nconst ChangeLabelMainContainer = styled.div`\n    display: flex;\n    flex-direction: column;\n    background: white;\n    padding: 1rem;\n    border-radius: 12px;\n    border: 1px solid black;\n  `;\n\nconst ClosePopUpContainer = styled.div`\n    display: flex;  \n    flex-direction: row-reverse;\n  `;\n\nconst CloseIcon = styled.div`\n    cursor: pointer;\n  `;\n\nfunction handleLabelSelection(selectedLabel) {\n  State.update({\n    newLabel: selectedLabel.replace(` `, \"-\"),\n  });\n}\n\nfunction closeModal() {\n  State.update({ showModal: false });\n}\n\nconst modal = (\n  <ModalContainer>\n    <ChangeLabelMainContainer>\n      <ClosePopUpContainer>\n        <CloseIcon className=\"bi bi-x\" onClick={closeModal}></CloseIcon>\n      </ClosePopUpContainer>\n      <Widget\n        src={widgets.views.standardWidgets.newStyledComponents.Input.Select}\n        props={{\n          label: \"Select new label\",\n          placeholder: kanbanColumns[0],\n          value: state.newLabel ?? colLabel,\n          options: kanbanColumns.map((label) => {\n            return { title: label, value: col };\n          }),\n          onChange: handleLabelSelection,\n        }}\n      />\n      <Widget\n        src={widgets.views.standardWidgets.newStyledComponents.Input.Button}\n        props={{\n          className: \"info my-3\",\n          onClick: moveArticleListener,\n          disabled: !state.newLabel,\n          children: (\n            <div className=\"d-flex justify-conten-center align-items-center\">\n              {state.saving ? (\n                <Spinner />\n              ) : (\n                <>\n                  <span>Move</span>\n                  <i className=\"bi bi-check2\"></i>\n                </>\n              )}\n            </div>\n          ),\n        }}\n      />\n    </ChangeLabelMainContainer>\n  </ModalContainer>\n);\n\nconst header = (\n  <div className=\"card-header\">\n    <small className=\"text-muted\">\n      <div className=\"row justify-content-between\">\n        <div className=\"w-75 text-truncate\">\n          <a\n            href={`#/mob.near/widget/ProfilePage?accountId=${article.author}`}\n            target=\"_blank\"\n            className=\"link-dark text-truncate w-100\"\n          >\n            <Widget\n              src={widgets.views.standardWidgets.profileImage}\n              props={{\n                metadata,\n                accountId: article.author,\n                widgetName,\n                style: { height: \"1.5em\", width: \"1.5em\", minWidth: \"1.5em\" },\n              }}\n            />\n            <span className=\"text-muted\">@{article.author}</span>\n          </a>\n        </div>\n        <div className=\"w-25\">\n          <div className=\"d-flex justify-content-end\">\n            <Widget\n              src={\n                widgets.views.standardWidgets.newStyledComponents.Input.Button\n              }\n              props={{\n                size: \"sm\",\n                className: \"info outline icon\",\n                children: <i className=\"bi bi-share\"></i>,\n                onClick: () =>\n                  handleShareButton(true, {\n                    type: \"sharedBlockHeight\",\n                    value: article.blockHeight,\n                  }),\n              }}\n            />\n          </div>\n        </div>\n      </div>\n    </small>\n  </div>\n);\n\nconst borders = {\n  Idea: \"border-secondary\",\n  Comment: \"border-secondary\",\n  Submission: \"border-secondary\",\n  Attestation: \"border-secondary\",\n  Sponsorship: \"border-secondary\",\n};\n\nconst CursorPointer = styled.p`\n    cursor: pointer;\n  `;\n\nfunction toggleShowModal() {\n  State.update({ showModal: !state.showModal });\n}\n\nconst articleTags = article.tags ? (\n  <div className=\"card-title\">\n    {article.tags.map((tag) => {\n      const filter = { filterBy: \"tag\", value: tag };\n      return (\n        <CursorPointer onClick={() => handleFilterArticles(filter)}>\n          <Widget\n            src={\n              widgets.views.standardWidgets.newStyledComponents.Element.Badge\n            }\n            props={{\n              children: tag,\n              variant: \"round info\",\n              size: \"sm\",\n            }}\n          />\n        </CursorPointer>\n      );\n    })}\n  </div>\n) : null;\n\nconst articleTitle = (\n  <div className=\"card-text\">\n    <div className=\"row justify-content-between\">\n      <h6 className=\"col-9\">{article.title}</h6>\n    </div>\n  </div>\n);\n\nconst footerActionButtons = (\n  <div className=\"d-flex justify-content-start w-100\">\n    <Widget\n      src={widgets.views.standardWidgets.newStyledComponents.Input.Button}\n      props={{\n        children: (\n          <div className=\"d-flex align-items-center justify-content-center\">\n            <span className=\"mx-1\">Move</span>\n            <i className=\"bi bi-arrows\"></i>\n          </div>\n        ),\n        disabled: context.accountId !== article.author,\n        size: \"sm\",\n        className: \"info outline w-25\",\n        onClick: toggleShowModal,\n      }}\n    />\n    <Widget\n      src={widgets.views.standardWidgets.newStyledComponents.Input.Button}\n      props={{\n        children: (\n          <div className=\"d-flex align-items-center justify-content-center\">\n            <span className=\"mx-1\">View</span>\n            <i className=\"bi bi-eye fs-6\"></i>\n          </div>\n        ),\n        size: \"sm\",\n        className: \"info mx-1 w-25\",\n        onClick: () => {\n          handleOpenArticle(article);\n        },\n      }}\n    />\n  </div>\n);\n\nconst CallLibrary = styled.div`\n    display: block;\n  `;\n\nconst Card = styled.div`\n    user-select: none;\n    &:hover {\n      box-shadow: rgba(3, 102, 214, 0.3) 0px 0px 0px 3px;\n    }\n  \n  `;\n\nconst LimitedMarkdown = styled.div`\n        max-height: 6em;\n  `;\n\n// Should make sure the posts under the currently top viewed post are limited in size.\nconst descriptionArea = (\n  <LimitedMarkdown className=\"overflow-auto\">\n    <Markdown className=\"card-text\" text={article.body}></Markdown>\n  </LimitedMarkdown>\n);\n\nreturn (\n  <>\n    {state.showModal && modal}\n    <Card className={`card my-2 ${borders[\"Submission\"]}`}>\n      {header}\n      <div className=\"card-body\">\n        {articleTitle}\n        {descriptionArea}\n        {articleTags}\n        {footerActionButtons}\n      </div>\n    </Card>\n    <CallLibrary>\n      {libSrcArray.map((src) => {\n        return callLibs(\n          src,\n          compactPostStateUpdate,\n          state.functionsToCallByLibrary,\n          { baseAction: baseActions.articlesBaseAction },\n          \"CompactPost\"\n        );\n      })}\n    </CallLibrary>\n  </>\n);\n", "metadata": {"platform": "jutsu.ai"}, "branch": {"draft": null}, "widget_modules_used": null, "widget_url": "https://near.social/#/rodrigos.near/widget/NDC.CompactPost", "fact_widget_deployments_id": "46f0238d426d3aaf866011111f4acdf1", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 4}