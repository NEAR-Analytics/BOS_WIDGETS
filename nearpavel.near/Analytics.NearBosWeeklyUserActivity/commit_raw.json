{"tx_hash": "K5BECp25GooTQu5phGP5aYwrztQy6Jb5J7sZAckrYte", "action_id_social": "23Ei8awJQNAGim2ePc2UqhHKbFyqmizRrzeoLTvrLZkE-0-widget", "block_id": 98007059, "block_timestamp": "2023-08-03T20:57:51.671Z", "signer_id": "nearpavel.near", "widget_name": "Analytics.NearBosWeeklyUserActivity", "source_code": "const fetchResult = fetch(\n  \"https://storage.googleapis.com/databricks-near-query-runner/output/near_bos_user_activity_weekly.json\"\n);\nif (!fetchResult.ok) {\n  return \"failed to fetch data\";\n}\nconst parsed = JSON.parse(fetchResult.body);\n//const data = parsed.data.sort((a, b) => a._week - b._week);\nconst groupedByWeek = parsed.data.reduce(\n  (result, row) => ({\n    ...result,\n    [row._week]: {\n      n_posts: result[row._week].n_posts + row.n_posts,\n      n_likes: result[row._week].n_likes + row.n_likes,\n      n_comments: result[row._week].n_comments + row.n_comments,\n      n_follows: result[row._week].n_follows + row.n_follows,\n      n_widget_writes: result[row._week].n_widget_writes + row.n_widget_writes,\n    },\n  }),\n  {}\n);\nconst dataset = Object.keys(groupedByWeek)\n  .map((_week) => ({\n    _week: Number(_week),\n    weekOf: new Date(Number(_week)).toISOString().substring(0, 10),\n    ...groupedByWeek[_week],\n  }))\n  .sort((a, b) => a._week - b._week);\n\nconst colsToShow = [\n  \"n_posts\",\n  \"n_likes\",\n  \"n_comments\",\n  \"n_follows\",\n  \"n_widget_writes\",\n];\n\n//return <div>{JSON.stringify(dataset)}</div>;\n\nconst option = {\n  title: {\n    text: \"NEAR BOS Weekly User Activity\",\n    subtext: `Executed by ${parsed.executed_by} at ${new Date(\n      parsed.executed_at\n    ).toLocaleString()}`,\n  },\n  tooltip: {\n    trigger: \"axis\",\n  },\n  legend: {\n    data: colsToShow,\n    top: \"50\",\n  },\n  grid: {\n    left: \"5%\",\n    right: \"4%\",\n    bottom: \"5%\",\n    top: \"100\",\n    containLabel: true,\n  },\n  toolbox: {\n    feature: {\n      saveAsImage: {},\n    },\n  },\n  xAxis: {\n    type: \"category\",\n    boundaryGap: false,\n    data: dataset.map((r) => r.weekOf),\n    name: \"Week Of\",\n    nameLocation: \"center\",\n    nameGap: 25,\n  },\n  yAxis: {\n    type: \"value\",\n    name: \"Number of Users\",\n    nameLocation: \"center\",\n    nameGap: 45,\n  },\n  series: colsToShow.map((col) => ({\n    name: col,\n    type: \"line\",\n    data: dataset.map((r) => r[col]),\n  })),\n};\n\nreturn (\n  <div>\n    <Widget\n      src={`nearpavel.near/widget/EChart`}\n      props={{ definition: option }}\n    />\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/nearpavel.near/widget/Analytics.NearBosWeeklyUserActivity", "fact_widget_deployments_id": "bb5c20e720d100600e99c9a80a13ee84", "inserted_timestamp": "2023-08-03T22:26:25.285Z", "modified_timestamp": "2023-08-03T22:26:25.285Z", "__row_index": 0}