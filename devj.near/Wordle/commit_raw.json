{"tx_hash": "5qPJFqsGr58KcYMSrskxu2Z9GNF6AB2VBaSfMeknpeHB", "action_id_social": "Fgzc37qFGK9AYj6h2Bhd9wzCn5EbdBxounpVJZ3UHiwB-0-widget", "block_id": 111027751, "block_timestamp": "2024-01-22T09:46:44.974Z", "signer_id": "devj.near", "widget_name": "Wordle", "source_code": "const CONTRACT = \"w0rdle.near\";\n\nif (context.accountId === null) return \"Please sign in using your Near account\";\n\nState.init({\n  loading: true,\n  page: \"GAME\",\n});\n\nconst [toast, setToast] = useState({\n  open: false,\n  variant: \"\",\n  title: \"\",\n  description: \"\",\n});\n\nconst handleToast = (variant, title, description) => {\n  setToast({ open: true, variant, title, description });\n};\n\nconst keyHash = Near.view(\n  CONTRACT,\n  \"get_key_hash\",\n  { accountId: context.accountId },\n  \"final\",\n  {\n    subscribe: true,\n  }\n);\n\nconst checkKey = () => {\n  const key = Storage.privateGet(\"key\");\n  console.log(key);\n  if (key === null) {\n    setTimeout(checkKey, 200);\n    return;\n  }\n  if (key === undefined) return State.update({ loading: false, isAuth: false });\n\n  const keyHash = ethers.utils.keccak256(ethers.utils.toUtf8Bytes(key));\n  Near.asyncView(CONTRACT, \"get_key_hash\", {\n    accountId: context.accountId,\n  }).then((res) => {\n    console.log(res);\n    State.update({ loading: false, isAuth: keyHash === res, key });\n  });\n};\n\nconst auth = () => {\n  const key = ethers.utils.id(Math.random().toString());\n  const keyHash = ethers.utils.keccak256(ethers.utils.toUtf8Bytes(key));\n  Storage.privateSet(\"key\", key);\n  Near.call(CONTRACT, \"set_key_hash\", { keyHash });\n};\n\nconst setPage = (page) => State.update({ page });\n\nconst Auth = () => (\n  <div class=\"center\">\n    <div>\n      <div\n        class=\"authBtn btn fs-5 text-white px-4 rounded\"\n        onClick={() => auth()}\n      >\n        SIGN IN\n      </div>\n    </div>\n  </div>\n);\n\nconst App = () => (\n  <div>\n    <Widget\n      src=\"devj.near/widget/Wordle.Header\"\n      props={{\n        page: state.page,\n        setPage,\n      }}\n    />\n    <div class=\"py-4\">\n      {state.page === \"GAME\" && (\n        <Widget\n          src=\"devj.near/widget/Wordle.Game\"\n          props={{\n            key: state.key,\n            handleToast,\n          }}\n        />\n      )}\n\n      {state.page === \"PROFILE\" && (\n        <Widget\n          src=\"devj.near/widget/Wordle.Profile\"\n          props={{\n            key: state.key,\n            handleToast,\n          }}\n        />\n      )}\n\n      {state.page === \"LEADERBOARD\" && (\n        <Widget src=\"devj.near/widget/Wordle.Leaderboard\" />\n      )}\n    </div>\n  </div>\n);\n\nconst Styles = styled.div`\n.main {\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    min-height: 97vh;\n    background: linear-gradient(to top right, #048C5B, #074A5F);\n}\n\n.center {\n    width: 100%;\n    flex-grow: 1;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n}\n.authBtn {\n    background: linear-gradient(to top right, #76CB30, #41A828);\n}\n`;\n\nuseEffect(() => {\n  checkKey();\n}, [keyHash]);\n\nreturn (\n  <Styles>\n    <div class=\"main\">\n      {state.loading ? (\n        <p class=\"text-center text-white py-4\">Loading ...</p>\n      ) : (\n        <>\n          {!state.isAuth && <Auth />}\n          {state.isAuth && <App />}\n        </>\n      )}\n    </div>\n    <Widget\n      src=\"devj.near/widget/Toast\"\n      props={{\n        ...toast,\n        onOpenChange: () => setToast({ ...toast, open: false }),\n      }}\n    />\n  </Styles>\n);\n", "metadata": {"platform": "jutsu.ai"}, "branch": {"draft": null}, "widget_modules_used": null, "widget_url": "https://near.social/#/devj.near/widget/Wordle", "fact_widget_deployments_id": "d24e491943307c07bd77831f78135892", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}