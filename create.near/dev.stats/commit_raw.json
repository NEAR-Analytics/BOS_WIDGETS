{"tx_hash": "GPX5v75VVgGfDrbt9jaqxfWNQ6TYSKfAzGwDbFZX6JkK", "action_id_social": "8hxow9Yr6xRCtUh4ovDNdfZipcvqv2rfnZWLVWYWPSzY-0-widget", "block_id": 110534533, "block_timestamp": "2024-01-16T08:51:41.968Z", "signer_id": "create.near", "widget_name": "dev.stats", "source_code": "const accountId = props.accountId ?? \"hack.near\";\nconst widgetName = props.widgetName ?? \"DAO.Members\";\n\nconst GRAPHQL_ENDPOINT = \"https://near-queryapi.api.pagoda.co\";\nconst STORE = \"storage.googleapis.com\";\nconst BUCKET = \"databricks-near-query-runner\";\nconst BASE_URL = `https://${STORE}/${BUCKET}/output/near_bos_component_details/component_rpc_loads`;\nconst dataset = `${BASE_URL}/${accountId}/widget/${widgetName}`;\n\nconst [developerSince, setDeveloperSince] = useState(undefined);\nconst [numberOfComponentsPublished, setNumberOfComponentsPublished] =\n  useState(0);\n\nconst indexerQueries = `\n  query GetWidgetCount {\n   eduohe_near_nearcon_2023_widget_activity_feed_widget_activity_aggregate(\n      where: {account_id: {_eq: \"${accountId}\"}}\n    ) {\n      aggregate {\n        count(distinct: true, columns: widget_name)\n      }\n    }\n  }\n  query GetDeveloperSince {\n  eduohe_near_nearcon_2023_widget_activity_feed_widget_activity_aggregate(\n      where: {account_id: {_eq: \"${accountId}\"}}\n    ) {\n      aggregate {\n        min {\n          block_timestamp\n        }\n      }\n    }\n  }\n`;\n\nfunction fetchGraphQL(operationsDoc, operationName, variables) {\n  return asyncFetch(`${GRAPHQL_ENDPOINT}/v1/graphql`, {\n    method: \"POST\",\n    headers: { \"x-hasura-role\": \"eduohe_near\" },\n    body: JSON.stringify({\n      query: operationsDoc,\n      variables: variables,\n      operationName: operationName,\n    }),\n  });\n}\n\nconst Wrapper = styled.div`\n  > div {\n    padding-bottom: 32px;\n    border-bottom: 1px solid #eceef0;\n    margin-bottom: 32px;\n\n    &:last-child {\n      padding-bottom: 0;\n      border-bottom: none;\n      margin-bottom: 0;\n    }\n  }\n\n  @media (max-width: 995px) {\n    grid-row: 1;\n  }\n`;\n\nconst StatsContainer = styled.div`\n  @media (max-width: 995px) {\n    margin-top: 10px;\n  }\n`;\n\nconst Container = styled.div`\n  display: flex;\n  flex-direction: column;\n  margin-top: 25px;\n  padding-bottom: 25px;\n`;\n\nconst Stats = styled.div`\n  display: flex;\n  flex-direction: row;\n`;\n\nconst StatsBadge = styled.div`\n  display: flex;\n  align-items: center;\n  margin-right: 20px;\n`;\n\nconst Icon = styled.i`\n  font-size: 15px;\n  fill: currentColor;\n  padding-right: 5px;\n`;\n\nuseEffect(() => {\n  fetchGraphQL(indexerQueries, \"GetWidgetCount\", {}).then((result) => {\n    if (result.status === 200 && result.body) {\n      if (result.body.errors) {\n        console.log(\"GetWidgetCount error:\", result.body.errors);\n        return;\n      }\n      let data = result.body.data;\n      if (data) {\n        const noComponents =\n          data\n            .eduohe_near_nearcon_2023_widget_activity_feed_widget_activity_aggregate\n            .aggregate.count;\n        setNumberOfComponentsPublished(noComponents);\n      }\n    }\n  });\n}, []);\n\nuseEffect(() => {\n  fetchGraphQL(indexerQueries, \"GetDeveloperSince\", {}).then((result) => {\n    if (result.status === 200 && result.body) {\n      if (result.body.errors) {\n        console.log(\"GetDeveloperSince error:\", result.body.errors);\n        return;\n      }\n      let data = result.body.data;\n      if (\n        data &&\n        data.eduohe_near_nearcon_2023_widget_activity_feed_widget_activity_aggregate\n      ) {\n        const developerSince =\n          data\n            .eduohe_near_nearcon_2023_widget_activity_feed_widget_activity_aggregate\n            .aggregate.min.block_timestamp;\n        setDeveloperSince(developerSince);\n      }\n    }\n  });\n}, []);\n\nreturn (\n  <Wrapper>\n    <StatsContainer>\n      <Container>\n        <Stats>\n          <StatsBadge>\n            <Icon className=\"ph ph-code\" />\n            <span className=\"badge rounded-pill bg-secondary\">\n              {numberOfComponentsPublished\n                ? numberOfComponentsPublished + \" published\"\n                : \"...\"}\n            </span>\n          </StatsBadge>\n          <StatsBadge>\n            <Icon className=\"bi bi-calendar\" />\n            <span className=\"badge rounded-pill bg-secondary\">\n              {developerSince ? (\n                <Widget\n                  key=\"foo\"\n                  src=\"near/widget/TimeAgo\"\n                  props={{\n                    alwaysRelative: true,\n                    blockTimestamp: developerSince,\n                  }}\n                />\n              ) : (\n                <span>...</span>\n              )}\n            </span>\n          </StatsBadge>\n        </Stats>\n      </Container>\n    </StatsContainer>\n  </Wrapper>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/create.near/widget/dev.stats", "fact_widget_deployments_id": "6311dacd28c4793cb2ff5029cafea941", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}