{"tx_hash": "6Tsg2kXZ9XG6vBC1psEi8DpueV93ggKJynt2q949bFws", "action_id_social": "64RL6QsdS5TXuChLfeseGSPJ8MdbVZpiqU1Fg3hqTLAK-0-widget", "block_id": 81302287, "block_timestamp": "2022-12-23T18:26:23.586Z", "signer_id": "create.near", "widget_name": "Connect", "source_code": "const userId = context.accountId;\nconst ownerId = \"create.near\";\n\nif (!userId) {\n  return \"Please log in with NEAR :)\";\n}\n\nconst accounts = Social.keys(`*/graph/join/*`, \"final\", {\n  return_type: \"BlockHeight\",\n  values_only: true,\n});\n\nif (accounts === null) {\n  return \"Loading\";\n}\n\nconst leadersData = Social.keys(`${userId}/graph/join/*`, \"final\");\nif (leadersData === null) {\n  return \"Loading\";\n}\n\nconst leaders = leadersData[userId][\"graph\"][\"follow\"] ?? {};\n\nlet followDev = prop.followDev ?? false;\n\nif (followDev) {\n  leaders[ownerId] = true;\n}\n\nState.init({\n  leaders,\n  followDev,\n});\n\nlet leadersAll = [];\nObject.keys(accounts).forEach((accountId) => {\n  Object.keys(accounts[accountId].graph.follow).forEach((leadersAccountId) => {\n    leadersAll[leadersAccountId] = (leadersAll[leadersAccountId] ?? 0) + 1;\n  });\n});\n\nlet leadersTop = Object.keys(leadersAll).sort(\n  (a, b) => leadersAll[b] - leadersAll[a]\n);\n\nlet handleChange = (accountId) => {\n  let leaders = state.leaders;\n  leaders[accountId] = !leaders[accountId];\n  State.update({ leaders });\n};\n\nlet followDevChange = () => {\n  handleChange(ownerId);\n  State.update({ followDev: !state.followDev });\n};\n\nlet leadersBlocks = leadersTop.map((accountId) => (\n  <li\n    className={`list-group-item ${\n      state.leaders[accountId] ? \"list-group-item-success\" : \"\"\n    }`}\n  >\n    <div className=\"form-check\">\n      <input\n        className=\"form-check-input\"\n        type=\"checkbox\"\n        value={accountId}\n        disabled={accountId == userId}\n        id={`follow-${accountId}`}\n        name={`follow-${accountId}`}\n        onChange={() => handleChange(accountId)}\n        checked={state.leaders[accountId] ?? false}\n      />\n      <label className=\"form-check-label\" for={`follow-${accountId}`}>\n        <Widget\n          src=\"zavodil.near/widget/ProfileLine\"\n          props={{\n            accountId,\n            link: \"\",\n          }}\n        />{\" \"}\n        <span\n          className=\"badge rounded-pill bg-primary\"\n          title={`${leadersAll[accountId]} followers`}\n        >\n          {leadersAll[accountId]}\n        </span>\n        <a\n          className=\"btn btn-sm btn-outline-secondary border-0\"\n          href={`#/mob.near/widget/ProfilePage?accountId=${accountId}`}\n          target=\"_blank\"\n        >\n          <i className=\"bi bi-window-plus me-1\" title=\"Open in new tab\"></i>\n        </a>\n      </label>\n    </div>\n  </li>\n));\n\nlet dataFollow = {};\nObject.keys(state.leaders).map((accountId) => {\n  if (accountId !== userId) {\n    let follow = !!state.leaders[accountId];\n    dataFollow[accountId] = follow ? \"\" : null;\n  }\n});\n\nlet dataGraph = [];\nlet dataNotify = [];\n\nObject.keys(state.leaders).map((accountId) => {\n  if (leaders[accountId] != state.leaders[accountId]) {\n    let follow = !!state.leaders[accountId];\n    dataGraph.push({\n      key: \"follow\",\n      value: {\n        type: follow ? \"follow\" : \"unfollow\",\n        accountId,\n      },\n    });\n\n    dataNotify.push({\n      key: accountId,\n      value: {\n        type: follow ? \"follow\" : \"unfollow\",\n      },\n    });\n  }\n});\n\nconst data = {\n  graph: {\n    follow: dataFollow,\n  },\n  index: {\n    graph: JSON.stringify(dataGraph),\n    notify: JSON.stringify(dataNotify),\n  },\n};\n\nreturn (\n  <>\n    <h1>Group Leaders</h1>\n    <p>Chooese from the list of accounts below.</p>\n\n    <div className=\"mb-3\">\n      <CommitButton\n        disabled={context.loading}\n        className={`btn ${\n          context.loading ? \"btn-outline-dark\" : \"btn-primary\"\n        }`}\n        data={data}\n      >\n        {context.loading ? \"Loading\" : \"Connect\"}\n      </CommitButton>\n    </div>\n    <h4>Near Social Community</h4>\n    <ul className=\"list-group\">{leadersBlocks}</ul>\n\n    <div className=\"mt-2 mb-3\">\n      <CommitButton\n        disabled={context.loading}\n        className={`btn ${\n          context.loading ? \"btn-outline-dark\" : \"btn-primary\"\n        }`}\n        data={data}\n      >\n        {context.loading ? \"Loading\" : \"Connect\"}\n      </CommitButton>\n    </div>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/create.near/widget/Connect", "fact_widget_deployments_id": "ac72af252fc6733ff8d0e61231592669", "inserted_timestamp": "2000-01-01T00:00:00.000Z", "modified_timestamp": "2000-01-01T00:00:00.000Z", "__row_index": 4}