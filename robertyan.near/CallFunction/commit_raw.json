{"tx_hash": "CQf5eNyqmFEkrVVYVbSZK6nhQPTpmQzJmtZehXpYRVHd", "action_id_social": "EkQSJa4H8UW8bzXo2ShWcVD8AmU2hyj8mVDS9gRSoXUn-0-widget", "block_id": 110031746, "block_timestamp": "2024-01-10T03:30:15.892Z", "signer_id": "robertyan.near", "widget_name": "CallFunction", "source_code": "State.init({\n  contractId: \"\",\n  methodName: \"\",\n  args: \"{}\",\n  deposit: \"\",\n  gas: \"\",\n  output: \"\",\n  error: \"\",\n  message: \"\",\n});\n\nconst TGas = Big(10).pow(12);\nconst ONE_NEAR = Big(10).pow(24);\n\nfunction callFunction() {\n  State.update({\n    message: \"Calling...\",\n    output: \"\",\n    error: \"\",\n  });\n  const { contractId, methodName, args, gas, deposit } = state;\n  if (contractId && methodName) {\n    console.log(\"call function\", contractId, methodName, args, gas, deposit);\n    Near.call(\n      contractId,\n      methodName,\n      JSON.parse(args),\n      TGas.mul(gas).toString(),\n      ONE_NEAR.mul(deposit).toString()\n    );\n  }\n}\n\nconst FUNCTION_CALL_CACHE = \"function_call_cache\";\n\nfunction saveFunctionCallCache() {\n  const { contractId, methodName, args, deposit, gas } = state;\n  Storage.privateSet(FUNCTION_CALL_CACHE, {\n    contractId,\n    methodName,\n    args,\n    deposit,\n    gas,\n  });\n}\n\nfunction handleContractId(event) {\n  const contractId = event.target.value;\n  State.update({ contractId });\n  saveFunctionCallCache();\n}\n\nfunction handleMethod(event) {\n  const methodName = event.target.value;\n  State.update({ methodName });\n  saveFunctionCallCache();\n}\n\nfunction handleArgs(event) {\n  const args = event.target.value;\n  State.update({ args });\n  saveFunctionCallCache();\n}\n\nfunction handleDeposit(event) {\n  const deposit = event.target.value;\n  State.update({ deposit });\n  saveFunctionCallCache();\n}\n\nfunction handleGas(event) {\n  const gas = event.target.value;\n  State.update({ gas });\n  saveFunctionCallCache();\n}\n\nfunction init() {\n  if (!state.contractId) {\n    const cache = Storage.privateGet(FUNCTION_CALL_CACHE);\n    if (cache && cache.contractId) {\n      const { contractId, methodName, args, deposit, gas } = cache;\n      State.update({ contractId, methodName, args, deposit, gas });\n    }\n  }\n}\n\ninit();\n\nconst { contractId, methodName, args, deposit, gas, output, message, error } =\n  state;\n\nreturn (\n  <div class=\"container\">\n    <h1>Call Function</h1>\n    <div class=\"container\" style={{ width: \"100%\" }}>\n      <input\n        type=\"text\"\n        placeholder=\"Contract ID\"\n        onChange={handleContractId}\n        value={contractId}\n      />\n      <input\n        type=\"text\"\n        placeholder=\"Method\"\n        onChange={handleMethod}\n        value={methodName}\n      />\n      <textarea\n        class=\"form-control\"\n        rows=\"8\"\n        placeholder=\"Arguments in JSON Format\"\n        onChange={handleArgs}\n        value={args}\n      />\n      <input\n        type=\"text\"\n        placeholder=\"Deposit (Unit: NEAR)\"\n        onChange={handleDeposit}\n        value={deposit}\n      />\n      <input\n        type=\"text\"\n        placeholder=\"Gas (Unit: Tgas)\"\n        onChange={handleGas}\n        value={gas}\n      />\n      <button\n        type=\"button\"\n        class=\"btn btn-primary mt-2\"\n        onClick={callFunction}\n        disabled={!contractId || !methodName}\n      >\n        Call\n      </button>\n    </div>\n    <div class=\"container\">\n      {output && (\n        <div class=\"mt-3\">\n          <p>Result:</p>\n          {JSON.stringify(output, null, 2)}\n        </div>\n      )}\n      {error && <p class=\"text-danger\">Error: {error}</p>}\n      {message && <p class=\"text-success\">{message}</p>}\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/robertyan.near/widget/CallFunction", "fact_widget_deployments_id": "5d3fdea73dbcff5bccbb98dde7697fd1", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}