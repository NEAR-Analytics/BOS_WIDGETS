{"tx_hash": "ANx1GuNyznui2TVUFVRReXcsJ3NvaoPWEYCbWEikoNEG", "action_id_social": "Eqd93s6YccM25LShRHQQh6JiG6nCoyxVdMp64Kt983iU-0-widget", "block_id": 100264253, "block_timestamp": "2023-09-03T00:06:43.913Z", "signer_id": "opencann.near", "widget_name": "user.data.input", "source_code": "const accountId = props.accountId ?? context.accountId;\r\nconst onChange = props.onChange;\r\nconst options = props.options;\r\nlet optInInfo = {};\r\nlet changeLog = [];\r\n\r\nconst initialState = {\r\n  accountId,\r\n  birthday: \"\",\r\n  astrological_sign: \"\",\r\n  age: \"\",\r\n  gender: \"\",\r\n  profession: \"\",\r\n  income: \"\",\r\n  preferred_wallet: \"\",\r\n  preferred_nft_marketplace: \"\",\r\n  preferred_crypto: \"\",\r\n  saveState: \"Started\",\r\n};\r\n\r\nState.init(initialState);\r\n\r\nfunction fetchDataFromAPI() {\r\n  const data = fetch(``, {\r\n    method: \"GET\",\r\n    headers: {\r\n      Accept: \"application/json\",\r\n      \"Content-Type\": \"application/json\",\r\n    },\r\n  });\r\n}\r\n\r\nfunction reportEventToAPI() {\r\n  const data = fetch(`https://dev.kitwallet.app/producer/${accountId}/event`, {\r\n    method: \"POST\",\r\n    headers: {\r\n      Accept: \"application/json\",\r\n      \"Content-Type\": \"application/json\",\r\n    },\r\n    body: JSON.stringify({\r\n      accountId,\r\n      events: [{ type: \"updateProfile\", data: \"coolwhip\" }],\r\n    }),\r\n  });\r\n}\r\n\r\nfunction registerProfileToAPI() {\r\n  const data = fetch(`https://dev.kitwallet.app/producer`, {\r\n    method: \"POST\",\r\n    headers: {\r\n      Accept: \"application/json\",\r\n      \"Content-Type\": \"application/json\",\r\n    },\r\n    body: JSON.stringify({\r\n      accountId,\r\n      profile: state,\r\n    }),\r\n  });\r\n}\r\n\r\nfunction setFormStatusOnAccount() {\r\n  State.update({ optInInfoFormStatus: \"completed\" });\r\n}\r\n\r\nfunction addChangeLogEntry() {\r\n  const dateTime = Date.now();\r\n  // const timestampUTC = dateTime.toUTCString();\r\n  const changeEvent = { thisEvent: \"form submitted\", timestamp: dateTime };\r\n  changeLog.push(changeEvent);\r\n  return changeLog;\r\n}\r\n\r\nfunction handleOnClick() {\r\n  reportEventToAPI();\r\n  registerProfileToAPI();\r\n}\r\n\r\nfunction handleOnCommit() {\r\n  setFormStatusOnAccount();\r\n}\r\n\r\nfunction handleChangeOnInput(event) {\r\n  State.update({\r\n    [event.target.id]: event.target.value,\r\n    saveState: \"in progress...\",\r\n  });\r\n}\r\n\r\nreturn (\r\n  <div id=\"optInDataForm\">\r\n    {options.birthday.label ?? \"Birthday\"}\r\n    <input\r\n      id=\"birthday\"\r\n      type=\"date\"\r\n      value={state.birthday}\r\n      onChange={(event) => handleChangeOnInput(event)}\r\n    />\r\n    {options.astrological_sign.label ?? \"Astrological Sign\"}\r\n    <input\r\n      id=\"astrological_sign\"\r\n      type=\"text\"\r\n      value={state.astrological_sign}\r\n      onChange={(event) => handleChangeOnInput(event)}\r\n    />\r\n    {options.age.label ?? \"Age\"}\r\n    <input\r\n      id=\"age\"\r\n      type=\"text\"\r\n      value={state.age}\r\n      onChange={(event) => handleChangeOnInput(event)}\r\n    />\r\n    {options.gender.label ?? \"Gender\"}\r\n    <input\r\n      id=\"gender\"\r\n      type=\"text\"\r\n      value={state.gender}\r\n      onChange={(event) => handleChangeOnInput(event)}\r\n    />\r\n    {options.profession.label ?? \"Profession\"}\r\n    <input\r\n      id=\"profession\"\r\n      type=\"text\"\r\n      value={state.profession}\r\n      onChange={(event) => handleChangeOnInput(event)}\r\n    />\r\n    {options.income.label ?? \"Income\"}\r\n    <input\r\n      id=\"income\"\r\n      type=\"text\"\r\n      value={state.income}\r\n      onChange={(event) => handleChangeOnInput(event)}\r\n    />\r\n    {options.preferred_wallet.label ?? \"Preferred Wallet\"}\r\n    <input\r\n      id=\"preferred_wallet\"\r\n      type=\"text\"\r\n      value={state.preferred_wallet}\r\n      onChange={(event) => handleChangeOnInput(event)}\r\n    />\r\n    {options.preferred_nft_marketplace.label ?? \"Preferred NFT Marketplace\"}\r\n    <input\r\n      id=\"preferred_nft_marketplace\"\r\n      type=\"text\"\r\n      value={state.preferred_nft_marketplace}\r\n      onChange={(event) => handleChangeOnInput(event)}\r\n    />\r\n    {options.preferred_crypto.label ?? \"Preferred Crypto\"}\r\n    <input\r\n      id=\"preferred_crypto\"\r\n      type=\"text\"\r\n      value={state.preferred_crypto}\r\n      onChange={(event) => handleChangeOnInput(event)}\r\n    />\r\n    <p></p>\r\n    <CommitButton\r\n      data={{ optInInfoFormStatus: state.saveState }}\r\n      onClick={handleOnClick}\r\n      onCommit={handleOnCommit}\r\n    >\r\n      Save Opt-In Info\r\n    </CommitButton>\r\n    <button onClick={() => State.update(initialState)}>Reset Form</button>\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/opencann.near/widget/user.data.input", "fact_widget_deployments_id": "4368c05ac9a5bd105797abc45db1c6a7", "inserted_timestamp": "2023-09-03T01:47:27.756Z", "modified_timestamp": "2023-09-03T01:47:27.756Z", "__row_index": 0}