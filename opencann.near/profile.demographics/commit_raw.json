{"tx_hash": "7hYEe9BG4P7mhhy7C9jAb11yxA5a3ce2sUU38NFk1wNu", "action_id_social": "32sCuZ9kr4NmNvAaFuJMajwVG2vo3UJUyeqE9q4aJbKX-0-widget", "block_id": 101240319, "block_timestamp": "2023-09-16T08:21:06.460Z", "signer_id": "opencann.near", "widget_name": "profile.demographics", "source_code": "const accountId = props.accountId ?? context.accountId;\nconst onChange = props.onChange;\nconst options = props.options;\n\n//const medications = VM.require(\"opencann.near/widget/pharm.array\"};\n//const conditions = VM.require(\"opencann.near/widget/conditions.array\"};\n\nconst astrology = [\n  { text: \"Aries\", value: \"Aries\" },\n  { text: \"Taurus\", value: \"Taurus\" },\n  { text: \"Gemini\", value: \"Gemini\" },\n  { text: \"Cancer\", value: \"Cancer\" },\n  { text: \"Leo\", value: \"Leo\" },\n  { text: \"Virgo\", value: \"Virgo\" },\n  { text: \"Libra\", value: \"Libra\" },\n  { text: \"Scorpio\", value: \"Scorpio\" },\n  { text: \"Sagittarius\", value: \"Sagittarius\" },\n  { text: \"Capricorn\", value: \"Capricorn\" },\n  { text: \"Aquarius\", value: \"Aquarius\" },\n  { text: \"Pisces\", value: \"Pisces\" },\n];\n\nconst sexOptions = [\n  { text: \"Male\", value: \"Male\" },\n  { text: \"Female\", value: \"Female\" },\n  { text: \"Intersex\", value: \"Intersex\" },\n  { text: \"Other\", value: \"Other\" },\n];\n\nconst cannabisHistory = [\n  { text: \"First time\", value: \"First time\" },\n  { text: \"A few times\", value: \"A few times\" },\n  { text: \"Tried a range of doses\", value: \"Tried a range of doses\" },\n  { text: \"Very experienced\", value: \"Very experienced\" },\n  { text: \"Expert/Professional\", value: \"Expert/Professional\" },\n];\n\nconst cannabisLevel = [\n  { text: \"None\", value: \"None\" },\n  { text: \"Low\", value: \"Low\" },\n  { text: \"Medium\", value: \"Medium\" },\n  { text: \"High\", value: \"High\" },\n];\n\nconst psychonautLevel = [\n  { text: \"Only food & water.\", value: \"Newbie\" },\n  { text: \"Very light substance use.\", value: \"Conservative\" },\n  { text: \"Familiar with altered states.\", value: \"Moderate\" },\n  { text: \"Pursuer of altered states.\", value: \"Liberal\" },\n  { text: \"I've studied substances extensively.\", value: \"Psychonaut\" },\n];\n\nif (context.loading) {\n  return (\n    <>\n      <h2>)\"Loading...\"</h2>\n    </>\n  );\n}\n\nif (!accountId) {\n  return (\n    <>\n      <h2>\"Please sign in with a NEAR ecosystem wallet to use this widget\"</h2>\n    </>\n  );\n}\n\nlet optInInfo = {};\nlet changeLog = [];\n\nconst initialState = {\n  accountId,\n  birthday: \"\",\n  astrological_sign: \"\",\n  age: \"\",\n  sex: \"\",\n  gender: \"\",\n  profession: [],\n  income: \"\",\n  preferred_wallet: [],\n  preferred_nft_marketplace: [],\n  preferred_crypto: [],\n  saveState: \"Started\",\n  height: \"\",\n  weight: \"\",\n  cannabisUse: \"\",\n  cannabisTolerance: \"\",\n  psychonautStatus: \"\",\n  medications: [],\n  conditions: [],\n  celebrity: \"\",\n  email: \"\",\n};\n\nState.init(initialState);\n\nfunction fetchDataFromAPI() {\n  const data = fetch(``, {\n    method: \"GET\",\n    headers: {\n      Accept: \"application/json\",\n      \"Content-Type\": \"application/json\",\n    },\n  });\n}\n\nfunction reportEventToAPI() {\n  const data = fetch(`https://dev.kitwallet.app/producer/${accountId}/event`, {\n    method: \"POST\",\n    headers: {\n      Accept: \"application/json\",\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify({\n      accountId,\n      events: [{ type: \"updateProfile\", data: \"coolwhip\" }],\n    }),\n  });\n}\n\nfunction registerProfileToAPI() {\n  const data = fetch(`https://dev.kitwallet.app/producer`, {\n    method: \"POST\",\n    headers: {\n      Accept: \"application/json\",\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify({\n      accountId,\n      profile: state,\n    }),\n  });\n}\n\nfunction setFormStatusOnAccount() {\n  State.update({ optInInfoFormStatus: \"completed\" });\n}\n\nfunction addChangeLogEntry() {\n  const dateTime = Date.now();\n  // const timestampUTC = dateTime.toUTCString();\n  const changeEvent = { thisEvent: \"form submitted\", timestamp: dateTime };\n  changeLog.push(changeEvent);\n  return changeLog;\n}\n\nfunction handleOnClick() {\n  reportEventToAPI();\n  registerProfileToAPI();\n}\n\nfunction handleOnCommit() {\n  setFormStatusOnAccount();\n}\n\nfunction handleChangeOnInput(event) {\n  State.update({\n    [event.target.id]: event.target.value,\n    saveState: \"in progress...\",\n  });\n}\nconst Form = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: flex-start;\n  width: 60%;\n  gap: 1em;\n`;\n\nlet page = (\n  <div>\n    <h2>{`Hello, ${accountId}!`}</h2>\n    <hr></hr>\n    <div>\n      <h5>Demographic Data</h5>\n    </div>\n    Disclaimer: all parts of this component below this message are in open-beta\n    and still under active development. DO NOT publish any sensitive or\n    proprietary information. We will not be liable for data shared through this\n    platform.\n    <div>\n      <ul>\n        <li>All items below are optional</li>\n        <li>Your account retains exclusive control over this data</li>\n        <li>\n          You can opt-in to enable decryption of this data for additional\n          rewards by adjusting your{\" \"}\n          <a href=\"#/sking.near/widget/DAO.Permissions\">Permissions Settings</a>\n          .\n        </li>\n      </ul>\n    </div>\n    <p>\n      {`Instructions: Please fill out the following information. This data is private!\n      Only include the data you are willing to share with analytics queries. \n      Everytime your data is accessed in a query, you will earn NEAR!`}\n    </p>\n    <p></p>\n    <div id=\"optInDataForm\">\n      <b>{options.birthday.label ?? \"Birthday\"}</b>\n      <input\n        id=\"birthday\"\n        type=\"date\"\n        value={state.birthday}\n        onChange={(event) => handleChangeOnInput(event)}\n      />\n      <Widget\n        src={`opencann.near/widget/profile.demographics.astrology`}\n        props={{\n          label: \"Astrological Sign\",\n          placeholder: \"Aries\",\n          astrology,\n          value: state.astrological_sign,\n          onChange: (astrological_sign) => State.update({ astrological_sign }),\n        }}\n      />\n      <Widget\n        src={`crowdtestify.near/widget/Inputs.Number`}\n        props={{\n          label: \"Age\",\n          placeholder: \"Example: 21\",\n          onChange: (event) => State.update({ age }),\n          validate: () => {\n            // add age verification???\n            return;\n          },\n        }}\n      />\n      <Widget\n        src={`crowdtestify.near/widget/Inputs.Number`}\n        props={{\n          label: \"Height\",\n          placeholder: \"Example: 175cm\",\n          onChange: (height) => State.update({ height }),\n          validate: () => {\n            return;\n          },\n        }}\n      />\n      <Widget\n        src={`crowdtestify.near/widget/Inputs.Number`}\n        props={{\n          label: \"Weight\",\n          placeholder: \"Example: 150lbs\",\n          onChange: (weight) => State.update({ weight }),\n          validate: () => {\n            return;\n          },\n        }}\n      />\n      <Widget\n        src={`opencann.near/widget/profile.demographics.sex`}\n        props={{\n          label: \"Sex\",\n          placeholder: \"Choose your sex\",\n          sexOptions,\n          value: state.sex,\n          onChange: (sex) =>\n            State.update({\n              sex: sex.map(({ name }) => ({\n                name: name.trim().replaceAll(/\\s+/g, \"-\"),\n              })),\n            }),\n        }}\n      />\n      <Widget\n        src={`crowdtestify.near/widget/Inputs.Text`}\n        props={{\n          label: \"Gender\",\n          value: state.gender,\n          onChange: (gender) => State.update({ gender }),\n          validate: () => {\n            return;\n          },\n        }}\n      />\n      <Widget\n        src={`opencann.near/widget/profile.profession`}\n        props={{\n          label: \"Profession\",\n          placeholder: \"Pro Wrestler\",\n          value: state.profession,\n          onChange: (profession) =>\n            State.update({\n              profession: profession.map(({ name }) => ({\n                name: name.trim().replaceAll(/\\s+/g, \"-\"),\n              })),\n            }),\n        }}\n      />\n      <Widget\n        src={`crowdtestify.near/widget/Inputs.Number`}\n        props={{\n          label: \"Income\",\n          placeholder: \"12,345\",\n          onChange: (income) => State.update({ income }),\n          hasDollar: true,\n          validate: () => {\n            return;\n          },\n        }}\n      />\n      <Widget\n        src={`opencann.near/widget/profile.walletArray`}\n        props={{\n          label: \"Preferred Wallet\",\n          placeholder: \"What is your wallet of choice?\",\n          value: state.preferred_wallet,\n          onChange: (preferred_wallet) =>\n            State.update({\n              preferred_wallet: preferred_wallet.map(({ name }) => ({\n                name: name.trim().replaceAll(/\\s+/g, \"-\"),\n              })),\n            }),\n        }}\n      />\n      <Widget\n        src={`opencann.near/widget/profile.marketArray`}\n        props={{\n          label: \"Preferred NFT Marketplace\",\n          placeholder: \"Where do you like to buy and list NFTs?\",\n          value: state.preferred_nft_marketplace,\n          onChange: (preferred_nft_marketplace) =>\n            State.update({\n              preferred_nft_marketplace: preferred_nft_marketplace.map(\n                ({ name }) => ({\n                  name: name.trim().replaceAll(/\\s+/g, \"-\"),\n                })\n              ),\n            }),\n        }}\n      />\n      <Widget\n        src={`opencann.near/widget/profile.tokenArray`}\n        props={{\n          label: \"Preferred Payment Token\",\n          placeholder: \"How do you want people to pay you?\",\n          value: state.preferred_crypto,\n          onChange: (preferred_crypto) =>\n            State.update({\n              preferred_crypto: preferred_crypto.map(({ name }) => ({\n                name: name.trim().replaceAll(/\\s+/g, \"-\"),\n              })),\n            }),\n        }}\n      />\n      <Widget\n        src={`opencann.near/widget/profile.demographics.cannabisHistory`}\n        props={{\n          label: \"Have you ever used cannabis before?\",\n          placeholder: \"Have you ever used cannabis before?\",\n          cannabisHistory,\n          value: state.cannabisUse,\n          onChange: (cannabisUse) => State.update({ cannabisUse }),\n        }}\n      />\n      <Widget\n        src={`opencann.near/widget/profile.demographics.cannabisLevel`}\n        props={{\n          label: \"What is your cannabis tolerance level?\",\n          placeholder: \"What is your cannabis tolerance level?\",\n          cannabisLevel,\n          value: state.cannabisTolerance,\n          onChange: (cannabisTolerance) => State.update({ cannabisTolerance }),\n        }}\n      />\n      <Widget\n        src={`opencann.near/widget/profile.demographics.psychonautLevel`}\n        props={{\n          label: \"What's your experience level with other substances?\",\n          placeholder: \"Have you ever tried other substances?\",\n          psychonautLevel,\n          value: state.psychonautStatus,\n          onChange: (psychonautStatus) => State.update({ psychonautStatus }),\n        }}\n      />\n      {options.medications.label ?? \"Currently prescribed medication(s)\"}\n      <input\n        id=\"medications\"\n        type=\"text\"\n        value={state.medications}\n        onChange={(event) => handleChangeOnInput(event)}\n      />\n      {options.conditions.label ??\n        \"Current health conditions (including mental health conditions)\"}\n      <input\n        id=\"conditions\"\n        type=\"text\"\n        value={state.conditions}\n        onChange={(event) => handleChangeOnInput(event)}\n      />\n      {options.celebrity.label ??\n        \"What famous person (or character) would you like to hang out with while consuming cannabis together?\"}\n      <input\n        id=\"celebrity\"\n        type=\"text\"\n        value={state.celebrity}\n        onChange={(event) => handleChangeOnInput(event)}\n      />\n      {options.email.label ?? \"Email Address\"}\n      <input\n        id=\"email\"\n        type=\"text\"\n        value={state.email}\n        onChange={(event) => handleChangeOnInput(event)}\n      />\n      <p></p>\n      <CommitButton\n        data={{ optInInfoFormStatus: state.saveState }}\n        onClick={handleOnClick}\n        onCommit={handleOnCommit}\n      >\n        Save Opt-In Info\n      </CommitButton>\n      <button onClick={() => State.update(initialState)}>Reset Form</button>\n    </div>\n    <p></p>\n  </div>\n);\n\nreturn page;\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/opencann.near/widget/profile.demographics", "fact_widget_deployments_id": "d5b859a6c968949160f23290ca952558", "inserted_timestamp": "2023-09-16T10:25:08.477Z", "modified_timestamp": "2023-09-16T10:25:08.477Z", "__row_index": 3}