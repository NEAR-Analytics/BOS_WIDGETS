{"tx_hash": "2j26DjosmXb3zsxxY5gTLaKrMpJxWQZXhjKzhjq26VKg", "action_id_social": "HesHMVpgN4xixRyy2nu5c8oMPW4e8wxrfh782Bkja5wm-0-widget", "block_id": 101414307, "block_timestamp": "2023-09-18T17:07:16.706Z", "signer_id": "opencann.near", "widget_name": "profile.demographics", "source_code": "const accountId = props.accountId ?? context.accountId;\r\nconst onChange = props.onChange;\r\nconst options = props.options;\r\n\r\n//const medications = VM.require(\"opencann.near/widget/pharm.array\"};\r\n//const conditions = VM.require(\"opencann.near/widget/conditions.array\"};\r\n\r\nconst astrology = [\r\n  { text: \"Aries\", value: \"Aries\" },\r\n  { text: \"Taurus\", value: \"Taurus\" },\r\n  { text: \"Gemini\", value: \"Gemini\" },\r\n  { text: \"Cancer\", value: \"Cancer\" },\r\n  { text: \"Leo\", value: \"Leo\" },\r\n  { text: \"Virgo\", value: \"Virgo\" },\r\n  { text: \"Libra\", value: \"Libra\" },\r\n  { text: \"Scorpio\", value: \"Scorpio\" },\r\n  { text: \"Sagittarius\", value: \"Sagittarius\" },\r\n  { text: \"Capricorn\", value: \"Capricorn\" },\r\n  { text: \"Aquarius\", value: \"Aquarius\" },\r\n  { text: \"Pisces\", value: \"Pisces\" },\r\n];\r\n\r\nconst sexOptions = [\r\n  { text: \"Male\", value: \"Male\" },\r\n  { text: \"Female\", value: \"Female\" },\r\n  { text: \"Intersex\", value: \"Intersex\" },\r\n  { text: \"Other\", value: \"Other\" },\r\n];\r\n\r\nconst cannabisHistory = [\r\n  { text: \"First time\", value: \"First time\" },\r\n  { text: \"A few times\", value: \"A few times\" },\r\n  { text: \"Tried a range of doses\", value: \"Tried a range of doses\" },\r\n  { text: \"Very experienced\", value: \"Very experienced\" },\r\n  { text: \"Expert/Professional\", value: \"Expert/Professional\" },\r\n];\r\n\r\nconst cannabisLevel = [\r\n  { text: \"None\", value: \"None\" },\r\n  { text: \"Low\", value: \"Low\" },\r\n  { text: \"Medium\", value: \"Medium\" },\r\n  { text: \"High\", value: \"High\" },\r\n];\r\n\r\nconst psychonautLevel = [\r\n  { text: \"Only food & water.\", value: \"Newbie\" },\r\n  { text: \"Very light substance use.\", value: \"Conservative\" },\r\n  { text: \"Familiar with altered states.\", value: \"Moderate\" },\r\n  { text: \"Pursuer of altered states.\", value: \"Liberal\" },\r\n  { text: \"I've studied substances extensively.\", value: \"Psychonaut\" },\r\n];\r\n\r\nif (context.loading) {\r\n  return (\r\n    <>\r\n      <h2>)\"Loading...\"</h2>\r\n    </>\r\n  );\r\n}\r\n\r\nif (!accountId) {\r\n  return (\r\n    <>\r\n      <h2>\"Please sign in with a NEAR ecosystem wallet to use this widget\"</h2>\r\n    </>\r\n  );\r\n}\r\n\r\nlet optInInfo = {};\r\nlet changeLog = [];\r\n\r\nconst initialState = {\r\n  accountId,\r\n  birthday: \"\",\r\n  astrological_sign: \"\",\r\n  age: \"\",\r\n  sex: \"\",\r\n  gender: \"\",\r\n  profession: [],\r\n  income: \"\",\r\n  preferred_wallet: [],\r\n  preferred_nft_marketplace: [],\r\n  preferred_crypto: [],\r\n  saveState: \"Started\",\r\n  height: \"\",\r\n  weight: \"\",\r\n  cannabisUse: \"\",\r\n  cannabisTolerance: \"\",\r\n  psychonautStatus: \"\",\r\n  medications: [],\r\n  condition: [],\r\n  celebrity: \"\",\r\n  email: \"\",\r\n};\r\n\r\nconst validateForm = () => {\r\n  return state.ageRequired && state.ageRequiredError === \"\";\r\n};\r\nState.init(initialState);\r\n\r\nfunction fetchDataFromAPI() {\r\n  const data = fetch(``, {\r\n    method: \"GET\",\r\n    headers: {\r\n      Accept: \"application/json\",\r\n      \"Content-Type\": \"application/json\",\r\n    },\r\n  });\r\n}\r\n\r\nfunction reportEventToAPI() {\r\n  const data = fetch(`https://dev.kitwallet.app/producer/${accountId}/event`, {\r\n    method: \"POST\",\r\n    headers: {\r\n      Accept: \"application/json\",\r\n      \"Content-Type\": \"application/json\",\r\n    },\r\n    body: JSON.stringify({\r\n      accountId,\r\n      events: [{ type: \"updateProfile\", data: \"coolwhip\" }],\r\n    }),\r\n  });\r\n}\r\n\r\nfunction registerProfileToAPI() {\r\n  const data = fetch(`https://dev.kitwallet.app/producer`, {\r\n    method: \"POST\",\r\n    headers: {\r\n      Accept: \"application/json\",\r\n      \"Content-Type\": \"application/json\",\r\n    },\r\n    body: JSON.stringify({\r\n      accountId,\r\n      profile: state,\r\n    }),\r\n  });\r\n}\r\n\r\nfunction setFormStatusOnAccount() {\r\n  State.update({ optInInfoFormStatus: \"completed\" });\r\n}\r\n\r\nfunction addChangeLogEntry() {\r\n  const dateTime = Date.now();\r\n  // const timestampUTC = dateTime.toUTCString();\r\n  const changeEvent = { thisEvent: \"form submitted\", timestamp: dateTime };\r\n  changeLog.push(changeEvent);\r\n  return changeLog;\r\n}\r\n\r\nfunction handleOnClick() {\r\n  reportEventToAPI();\r\n  registerProfileToAPI();\r\n}\r\n\r\nfunction handleOnCommit() {\r\n  setFormStatusOnAccount();\r\n}\r\n\r\nfunction handleChangeOnInput(event) {\r\n  State.update({\r\n    [event.target.id]: event.target.value,\r\n    saveState: \"in progress...\",\r\n  });\r\n}\r\nconst Form = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: flex-start;\r\n  width: 60%;\r\n  gap: 1em;\r\n`;\r\n\r\nconst FormFooter = styled.div`\r\n  display: flex;\r\n  flex-direction: row-reverse;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  width: 100%;\r\n`;\r\n\r\nlet page = (\r\n  <div>\r\n    <h2>{`Hello, ${accountId}!`}</h2>\r\n    <hr></hr>\r\n    <div>\r\n      <h5>Demographic Data</h5>\r\n    </div>\r\n    <div>\r\n      <ul>\r\n        <li>All items below are optional and encrypted by default.</li>\r\n        <li>Your account retains exclusive control over this data</li>\r\n        <li>\r\n          You can opt-in to enable decryption of this data for additional\r\n          rewards by adjusting your{\" \"}\r\n          <a href=\"#/sking.near/widget/DAO.Permissions\">Permissions Settings</a>\r\n          .\r\n        </li>\r\n      </ul>\r\n    </div>\r\n    <p>\r\n      {`Instructions: Please fill out the following information. This data is private!\r\n      Only include the data you are willing to share with analytics queries. \r\n      Everytime your data is accessed in a query, you will earn NEAR!`}\r\n    </p>\r\n    <p></p>\r\n    <div id=\"optInDataForm\">\r\n      <b>{options.birthday.label ?? \"Birthday\"}</b>\r\n      <input\r\n        id=\"birthday\"\r\n        type=\"date\"\r\n        value={state.birthday}\r\n        onChange={(event) => handleChangeOnInput(event)}\r\n      />\r\n      <Widget\r\n        src={`opencann.near/widget/profile.demographics.astrology`}\r\n        props={{\r\n          label: \"Astrological Sign\",\r\n          placeholder: \"Aries\",\r\n          astrology,\r\n          value: state.astrological_sign,\r\n          onChange: (astrological_sign) => State.update({ astrological_sign }),\r\n        }}\r\n      />\r\n      <Widget\r\n        src={`crowdtestify.near/widget/Inputs.Number`}\r\n        props={{\r\n          label: \"Age\",\r\n          placeholder: 21,\r\n          value: state.age,\r\n          onChange: (age) => State.update({ age }),\r\n          validate: () => {\r\n            if (state.ageRequired < 18) {\r\n              State.update({\r\n                ageRequiredError: \"Age must be at least 18\",\r\n              });\r\n              return;\r\n            }\r\n            State.update({ ageRequiredError: \"\" });\r\n          },\r\n        }}\r\n      />\r\n      <Widget\r\n        src={`crowdtestify.near/widget/Inputs.Number`}\r\n        props={{\r\n          label: \"Height (in)\",\r\n          placeholder: 70,\r\n          value: state.height,\r\n          onChange: (height) => State.update({ height }),\r\n          validate: () => {\r\n            if (state.heightRequired < 60) {\r\n              State.update({\r\n                heightRequiredError: \"Age must be at least 60\",\r\n              });\r\n              return;\r\n            }\r\n            State.update({ heightRequiredError: \"\" });\r\n          },\r\n        }}\r\n      />\r\n      <Widget\r\n        src={`crowdtestify.near/widget/Inputs.Number`}\r\n        props={{\r\n          label: \"Weight (lbs)\",\r\n          value: state.weight,\r\n          placeholder: 150,\r\n          onChange: (weight) => State.update({ weight }),\r\n          validate: () => {\r\n            return;\r\n          },\r\n        }}\r\n      />\r\n      <Widget\r\n        src={`opencann.near/widget/profile.demographics.sex`}\r\n        props={{\r\n          label: \"Sex\",\r\n          placeholder: \"Choose your sex\",\r\n          sexOptions,\r\n          value: state.sex,\r\n          onChange: (sex) =>\r\n            State.update({\r\n              sex: sex.map(({ name }) => ({\r\n                name: name.trim().replaceAll(/\\s+/g, \"-\"),\r\n              })),\r\n            }),\r\n        }}\r\n      />\r\n      <Widget\r\n        src={`crowdtestify.near/widget/Inputs.Text`}\r\n        props={{\r\n          label: \"Gender\",\r\n          value: state.gender,\r\n          onChange: (gender) => State.update({ gender }),\r\n          validate: () => {\r\n            return;\r\n          },\r\n        }}\r\n      />\r\n      <Widget\r\n        src={`opencann.near/widget/profile.profession`}\r\n        props={{\r\n          label: \"Profession\",\r\n          placeholder: \"Pro Wrestler\",\r\n          value: state.profession,\r\n          onChange: (profession) =>\r\n            State.update({\r\n              profession: profession.map(({ name }) => ({\r\n                name: name.trim().replaceAll(/\\s+/g, \"-\"),\r\n              })),\r\n            }),\r\n        }}\r\n      />\r\n      <Widget\r\n        src={`crowdtestify.near/widget/Inputs.Number`}\r\n        props={{\r\n          label: \"Income\",\r\n          value: state.income,\r\n          placeholder: \"12,345\",\r\n          onChange: (income) => State.update({ income }),\r\n          hasDollar: true,\r\n          validate: () => {\r\n            return;\r\n          },\r\n        }}\r\n      />\r\n      <Widget\r\n        src={`opencann.near/widget/profile.walletArray`}\r\n        props={{\r\n          label: \"Preferred Wallet\",\r\n          placeholder: \"What is your wallet of choice?\",\r\n          value: state.preferred_wallet,\r\n          onChange: (preferred_wallet) =>\r\n            State.update({\r\n              preferred_wallet: preferred_wallet.map(({ name }) => ({\r\n                name: name.trim().replaceAll(/\\s+/g, \"-\"),\r\n              })),\r\n            }),\r\n        }}\r\n      />\r\n      <Widget\r\n        src={`opencann.near/widget/profile.marketArray`}\r\n        props={{\r\n          label: \"Preferred NFT Marketplace\",\r\n          placeholder: \"Where do you like to buy and list NFTs?\",\r\n          value: state.preferred_nft_marketplace,\r\n          onChange: (preferred_nft_marketplace) =>\r\n            State.update({\r\n              preferred_nft_marketplace: preferred_nft_marketplace.map(\r\n                ({ name }) => ({\r\n                  name: name.trim().replaceAll(/\\s+/g, \"-\"),\r\n                })\r\n              ),\r\n            }),\r\n        }}\r\n      />\r\n      <Widget\r\n        src={`opencann.near/widget/profile.tokenArray`}\r\n        props={{\r\n          label: \"Preferred Payment Token\",\r\n          placeholder: \"How do you want people to pay you?\",\r\n          value: state.preferred_crypto,\r\n          onChange: (preferred_crypto) =>\r\n            State.update({\r\n              preferred_crypto: preferred_crypto.map(({ name }) => ({\r\n                name: name.trim().replaceAll(/\\s+/g, \"-\"),\r\n              })),\r\n            }),\r\n        }}\r\n      />\r\n      <Widget\r\n        src={`opencann.near/widget/profile.demographics.cannabisHistory`}\r\n        props={{\r\n          label: \"Have you ever used cannabis before?\",\r\n          placeholder: \"Have you ever used cannabis before?\",\r\n          cannabisHistory,\r\n          value: state.cannabisUse,\r\n          onChange: (cannabisUse) => State.update({ cannabisUse }),\r\n        }}\r\n      />\r\n      <Widget\r\n        src={`opencann.near/widget/profile.demographics.cannabisLevel`}\r\n        props={{\r\n          label: \"What is your cannabis tolerance level?\",\r\n          placeholder: \"What is your cannabis tolerance level?\",\r\n          cannabisLevel,\r\n          value: state.cannabisTolerance,\r\n          onChange: (cannabisTolerance) => State.update({ cannabisTolerance }),\r\n        }}\r\n      />\r\n      <Widget\r\n        src={`opencann.near/widget/profile.demographics.psychonautLevel`}\r\n        props={{\r\n          label: \"What's your experience level with other substances?\",\r\n          placeholder: \"Have you ever tried other substances?\",\r\n          psychonautLevel,\r\n          value: state.psychonautStatus,\r\n          onChange: (psychonautStatus) => State.update({ psychonautStatus }),\r\n        }}\r\n      />\r\n      <Widget\r\n        src={`opencann.near/widget/profile.pharmArray`}\r\n        props={{\r\n          label: \"Currently prescribed medication(s)\",\r\n          placeholder: \"Type to search pharmaceuticals.\",\r\n          value: state.medications,\r\n          onChange: (medications) =>\r\n            State.update({\r\n              medications: medications.map(({ name }) => ({\r\n                name: name.trim().replaceAll(/\\s+/g, \"-\"),\r\n              })),\r\n            }),\r\n        }}\r\n      />\r\n      <Widget\r\n        src={`opencann.near/widget/profile.conditionArray`}\r\n        props={{\r\n          label:\r\n            \"Current health conditions (including mental health conditions)\",\r\n          placeholder: \"This question is optional.\",\r\n          value: state.condition,\r\n          onChange: (condition) =>\r\n            State.update({\r\n              condition: condition.map(({ name }) => ({\r\n                name: name.trim().replaceAll(/\\s+/g, \"-\"),\r\n              })),\r\n            }),\r\n        }}\r\n      />\r\n      <Widget\r\n        src={`opencann.near/widget/profile.celebrityArray`}\r\n        props={{\r\n          label: \"Favorite Celebrity or Character\",\r\n          placeholder:\r\n            \"What famous person or character would you like to get stoned with?\",\r\n          value: state.celebrity,\r\n          onChange: (celebrity) =>\r\n            State.update({\r\n              celebrity: celebrity.map(({ name }) => ({\r\n                name: name.trim().replaceAll(/\\s+/g, \"-\"),\r\n              })),\r\n            }),\r\n        }}\r\n      />\r\n      {options.email.label ?? \"Email Address\"}\r\n      <input\r\n        id=\"email\"\r\n        type=\"text\"\r\n        value={state.email}\r\n        onChange={(event) => handleChangeOnInput(event)}\r\n      />\r\n      <p></p>\r\n      <CommitButton\r\n        data={{ optInInfoFormStatus: state.saveState }}\r\n        onClick={handleOnClick}\r\n        onCommit={handleOnCommit}\r\n      >\r\n        Save Opt-In Info\r\n      </CommitButton>\r\n      <button onClick={() => State.update(initialState)}>Reset Form</button>\r\n    </div>\r\n    <p></p>\r\n  </div>\r\n);\r\n\r\nreturn page;\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/opencann.near/widget/profile.demographics", "fact_widget_deployments_id": "5a122ecfb61a206ae428809233ccbf9d", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}