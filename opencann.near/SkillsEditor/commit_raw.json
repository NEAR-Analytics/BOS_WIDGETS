{"tx_hash": "8G4Gb6thahVS8qPBUBDxb5AexnANCexbwy6GkFpsJinJ", "action_id_social": "B2p7VKC8dd7Dj1itoxVu5bnDF17SA7dWSY9ryabSFjc4-0-widget", "block_id": 101081732, "block_timestamp": "2023-09-14T03:56:38.741Z", "signer_id": "opencann.near", "widget_name": "SkillsEditor", "source_code": "const skillsPattern = props.skillsPattern ?? \"*/profile/skills/*\";\nconst placeholder = props.placeholder ?? \"Skills\";\nconst initialSkillsObject = props.initialSkillsObject || {};\n\nconst skillsObject = Social.keys(skillsPattern, \"final\");\n\nif (skillsObject === null) {\n  return \"Loading\";\n}\n\nconst normalizeSkill = (skill) =>\n  skill\n    .replaceAll(/[- \\.]/g, \"_\")\n    .replaceAll(/[^\\w]+/g, \"\")\n    .replaceAll(/_+/g, \"-\")\n    .replace(/^-+/, \"\")\n    .replace(/-+$/, \"\")\n    .toLowerCase()\n    .trim(\"-\");\n\nconst skillsCount = {};\n\nconst processSkillsObject = (obj) => {\n  Object.entries(obj).forEach((kv) => {\n    if (typeof kv[1] === \"object\") {\n      processSkillsObject(kv[1]);\n    } else {\n      const skill = normalizeSkill(kv[0]);\n      skillsCount[skill] = (skillsCount[skill] || 0) + 1;\n    }\n  });\n};\n\nconst getSkills = () => {\n  processSkillsObject(skillsObject);\n  const skills = Object.entries(skillsCount);\n  skills.sort((a, b) => b[1] - a[1]);\n  return skills.map((t) => ({\n    name: t[0],\n    count: t[1],\n  }));\n};\n\nif (!state.allSkills) {\n  initState({\n    allSkills: getSkills(),\n    skills: Object.keys(initialSkillsObject).map((skill) => ({\n      name: normalizeSkill(skill),\n    })),\n    originalSkills: Object.fromEntries(\n      Object.keys(initialSkillsObject).map((skill) => [skill, null])\n    ),\n    id: `skills-selector-${Date.now()}`,\n  });\n}\n\nconst setSkills = (skills) => {\n  skills = skills.map((o) => {\n    o.name = normalizeSkill(o.name);\n    return o;\n  });\n  State.update({ skills });\n  if (props.setSkillsObject) {\n    props.setSkillsObject(\n      Object.assign(\n        {},\n        state.originalSkills,\n        Object.fromEntries(skills.map((skill) => [skill.name, \"\"]))\n      )\n    );\n  }\n};\n\nreturn (\n  <>\n    <Typeahead\n      id={state.id}\n      multiple\n      labelKey=\"name\"\n      onChange={setSkills}\n      options={state.allSkills}\n      placeholder={placeholder}\n      selected={state.skills}\n      positionFixed\n      allowNew\n    />\n    {props.debug && (\n      <div>\n        Debugging skills:\n        <pre>{JSON.stringify(state.skills)}</pre>\n      </div>\n    )}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/opencann.near/widget/SkillsEditor", "fact_widget_deployments_id": "d595fb4eb575f9e1d8c129bcfac65aa8", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}