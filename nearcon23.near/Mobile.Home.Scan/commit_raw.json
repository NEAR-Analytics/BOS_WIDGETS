{"tx_hash": "3ALmaKmQb78cy4sJNU55eLmHneo3bNQREoAAm48Wiowc", "action_id_social": "4hcuevfTasCPY4MCje8dubpiQfFdBHAX7zFhXgDADX42-0-widget", "block_id": 105217905, "block_timestamp": "2023-11-08T11:27:56.277Z", "signer_id": "nearcon23.near", "widget_name": "Mobile.Home.Scan", "source_code": "const ownerId = \"nearcon23.near\";\nconst prefix = props.prefix || \"/mobile\";\n\nconst [facingMode, setFacingMode] = useState(\"environment\");\n\nconst [cameraError, setCameraError] = useState(false);\n\nconst [responce, setResponce] = useState(\"\");\nconst [validScan, setValidScan] = useState({\n  privateKey: null,\n  contract: null,\n  receiverId: null,\n  campaignId: null,\n});\n\nconst toggleFacingMode = () => {\n  setFacingMode((prevMode) =>\n    prevMode === \"environment\" ? \"user\" : \"environment\"\n  );\n};\n\nfunction extractReceiverId(url) {\n  const regex = /receiverId=([^&]+)/;\n  const match = url.match(regex);\n\n  if (match && match[1]) {\n    return match[1];\n  } else {\n    return null; // Return null if receiverId is not found in the URL\n  }\n}\n\nconst Button = styled.button`\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n  align-items: center;\n  padding: 10px 20px;\n  gap: 0.5em;\n  border: 1px solid #00ec97;\n  border-radius: 50px;\n  background: #00ec97;\n  color: #11181c;\n  font-style: normal;\n  font-weight: 600;\n  font-size: 18px;\n  text-align: center;\n  white-space: nowrap;\n  transition: all 0.3s ease-in-out;\n\n  width:100%;\n\n  &:hover,\n  &:focus,\n  &:active {\n    text-decoration: none;\n    background: #11181c;\n    border: 1px solid #11181c;\n    color: #fff;\n  }\n`;\n\nconst Button2 = styled.button`\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n  align-items: center;\n  padding: 10px 20px;\n  gap: 0.5em;\n  border: 1px solid #00ec97;\n  border-radius: 50px;\n  background: #FFFFFF;\n  color: #000000;\n  font-style: normal;\n  font-weight: 600;\n  font-size: 18px;\n  text-align: center;\n  white-space: nowrap;\n  transition: all 0.3s ease-in-out;\n\n  width:100%;\n  flex: 2;\n  border: none;\n\n  &:hover,\n  &:focus,\n  &:active {\n    text-decoration: none;\n    background: #11181c;\n    border: 1px solid #11181c;\n    color: #FFFFFF;\n  }\n`;\n\n// console.log(validScan);\n\nif (validScan?.campaignId !== null) {\n  return <Redirect to={`/campaigns?campaignId=${validScan?.campaignId}`} />;\n}\n\nif (validScan.receiverId) {\n  return (\n    <Widget\n      src={`${ownerId}/widget/Mobile.Home.Send`}\n      props={{ receiverId: validScan.receiverId }}\n    />\n  );\n}\n\nreturn validScan?.privateKey !== null ? (\n  <>\n    <Widget\n      props={{\n        privateKey: validScan.privateKey,\n        contract: validScan.contract,\n        backToHome: () => {\n          setValidScan({\n            privateKey: null,\n            contract: null,\n            receiverId: null,\n            campaignId: null,\n          });\n        },\n      }}\n      src={`${ownerId}/widget/Admin.ScanPage`}\n    />\n  </>\n) : cameraError ? (\n  <Widget\n    props={{\n      error: cameraError,\n    }}\n    src={`${ownerId}/widget/Admin.ScannedTicket`}\n  />\n) : (\n  <div\n    style={{\n      backgroundColor: \"#22FFFF\",\n      display: \"flex\",\n      flexDirection: \"column\",\n      justifyContent: \"flex-start\",\n      alignItems: \"center\",\n      flex: 1,\n      width: \"100%\",\n      height: \"100dvh\",\n      position: \"relative\",\n    }}\n  >\n    <div\n      style={{\n        position: \"absolute\",\n        bottom: 50,\n        zIndex: 100,\n        display: \"flex\",\n        gap: \"10px\",\n      }}\n    >\n      <a\n        style={{\n          borderRadius: 20,\n          height: 40,\n          // width: 40,\n          color: props.theme.textColor3,\n          backgroundColor: props.theme.textColor,\n          border: \"none\",\n\n          display: \"flex\",\n          alignItems: \"center\",\n          justifyContent: \"center\",\n          gap: 8,\n          padding: \"0 16px\",\n        }}\n        href={`/mobile`}\n      >\n        Back\n      </a>\n      <button\n        style={{\n          borderRadius: 20,\n          height: 40,\n          // width: 40,\n          color: props.theme.textColor3,\n          backgroundColor: props.theme.textColor,\n          border: \"none\",\n\n          display: \"flex\",\n          alignItems: \"center\",\n          justifyContent: \"center\",\n          gap: 8,\n          padding: \"0 16px\",\n        }}\n        onClick={() => toggleFacingMode()}\n      >\n        <i class=\"bi bi-arrow-repeat\"></i>\n        <p style={{ margin: 0 }}>Change Camera</p>\n      </button>\n    </div>\n\n    {responce && (\n      <div\n        style={{\n          position: \"absolute\",\n          top: \"50%\",\n          left: \"50%\",\n          transform: \"translate(-50%, -50%)\",\n          zIndex: 102,\n\n          backgroundColor: \"#fff\",\n          padding: 16,\n          borderRadius: 8,\n\n          width: \"100%\",\n          maxWidth: 450,\n        }}\n      >\n        <h5 style={{ color: theme.textColor3 }}>Send to</h5>\n        <h2 style={{ wordWrap: \"break-word\" }}>{responce}</h2>\n\n        <div\n          style={{\n            display: \"flex\",\n            flexDirection: \"row\",\n            justifyContent: \"space-between\",\n            gap: 16,\n            marginTop: 24,\n          }}\n        >\n          <Button2 onClick={() => setResponce(\"\")}>Scan again</Button2>\n\n          <Link\n            style={{ flex: 3, width: \"100%\" }}\n            to={`/nearcon23/home/${ownerId}/widget/Mobile.Home.Send?receiverId=${responce}`}\n          >\n            <Button>Continue</Button>\n          </Link>\n        </div>\n      </div>\n    )}\n\n    <div\n      key={facingMode}\n      style={{\n        width: \"100%\",\n        height: \"100%\",\n        flex: 1,\n        backgroundColor: \"#0b111d\",\n      }}\n    >\n      <QRCodeReader2\n        scanDelay={750}\n        constraints={{\n          facingMode: facingMode,\n        }}\n        onResult={(result, error) => {\n          console.log(result, error);\n          if (result) {\n            if (result?.text?.includes(\"receiverId\")) {\n              const receiverId = result?.text?.split(\"=\")?.[1];\n              setValidScan({ ...validScan, receiverId });\n            } else if (result?.text?.includes(\"campaignId\")) {\n              const campaignId = result?.text?.split(\"=\")?.[1];\n              setValidScan({ ...validScan, campaignId });\n            } else if (result?.text?.includes(\"privateKey\")) {\n              const url = result.text;\n\n              const privateKey = url.split(\"privateKey=\")[1];\n\n              // console.log(\"privateKey : \", privateKey);\n              setValidScan({ ...validScan, contract: \"\", privateKey });\n\n              // const parameterIndex = url.indexOf(\"secretKey\" + \"=\");\n\n              // if (parameterIndex === -1) {\n              //   return null; // Parameter not found\n              // }\n              // var value = url.slice(parameterIndex + \"secretKey\".length + 1);\n\n              // console.log(\"result.text : \", value);\n\n              // function splitAtFirstColon(str) {\n              //   const index = str.indexOf(\":\");\n              //   if (index === -1) return [str];\n\n              //   return [str.slice(0, index), str.slice(index + 1)];\n              // }\n\n              // const apiURL = result.text;\n              // if (!!result) {\n              //   const replaceLink = apiURL.replace(\n              //     \"https://keypom.xyz/nearcon/\",\n              //     \"\"\n              //   );\n              //   const [contract, privateKey] = splitAtFirstColon(replaceLink);\n              //   setValidScan({ contract, privateKey });\n              // }\n            }\n          }\n\n          if (\n            error?.name === \"NotAllowedError\" ||\n            error?.cameraError?.name === \"NotAllowedError\"\n          ) {\n            setCameraError(error);\n          }\n        }}\n        containerStyle={{\n          width: \"100%\",\n          height: \"100%\",\n        }}\n        videoContainerStyle={{\n          width: \"100%\",\n          height: \"100%\",\n        }}\n        videoStyle={{\n          width: \"100%\",\n          height: \"100%\",\n          objectFit: \"cover\",\n        }}\n      />\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/nearcon23.near/widget/Mobile.Home.Scan", "fact_widget_deployments_id": "b4c69c66523e199756e7d241981e404f", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}