{"tx_hash": "7SCx4jjjwKkBQ9FYo4C8yHSu4m8K22Z5BsSgu4umHYQD", "action_id_social": "ATdnFgd8hUoN97TY3sHzixrmHen2nUT3ecsCS7vQnroH-0-widget", "block_id": 104810764, "block_timestamp": "2023-11-03T03:27:39.106Z", "signer_id": "nearcon23.near", "widget_name": "Mobile.Home", "source_code": "const theme = props.theme;\nconst accountId = props.accountId || context.accountId;\nconst ownerId = \"nearcon23.near\";\nconst apiUrl =\n  \"https://gqqkd7l7mk.execute-api.us-east-1.amazonaws.com/mainnet/api/v1\";\n\nconst [selectedButton, setSelectedButton] = useState(\"profile\");\n\nuseEffect(() => {\n  if (props.deepLink) {\n    setSelectedButton(props.deepLink || \"schedule\");\n  }\n}, [props.deepLink]);\n\nconsole.log({ selectedButton, deepLink: props.deepLink });\n\n// initState({});\nState.init({\n  redirectToHome: \"loading\",\n});\n\nconst Container = styled.div`  \n  max-height: 100svh;\n  height: 100%;\n`;\nconst Content = styled.div`\n  height: calc(100% - 105px);\n  flex: 1;\n  flex-direction: column;\n  overflow: auto;\n  position: relative;\n`;\n\n///////////////\nconst { secretkey } = props;\n\nconst storedSecretKey = Storage.get(\n  \"newPrivateKey\",\n  `${ownerId}/widget/Ticket.Page`\n)\n  ? Storage.get(\"newPrivateKey\", `${ownerId}/widget/Ticket.Page`)\n  : Storage.get(\"newPrivateKey\", `${ownerId}/widget/RegisterMobile.Index`);\n\nconst fetchData = async () => {\n  const key = secretkey ? secretkey : storedSecretKey;\n\n  asyncFetch(`${apiUrl}/accounts/auth/${key}`).then(({ body }) => {\n    if (body?._id) {\n      State.update({\n        userData: body,\n        redirectToHome: \"\",\n      });\n    } else {\n      if (![\"map\", \"alerts\", \"schedule\", \"help\"].includes(props.deepLink)) {\n        State.update({\n          redirectToHome: \"redirect\",\n        });\n      }\n    }\n  });\n};\n\nif (state.redirectToHome === \"redirect\") {\n  return <Redirect to=\"/\" />;\n}\n\nconst fetchTransaction = () => {\n  if (state?.userData?.nearconId) {\n    const apiURL = `${apiUrl}/v1/transactions/${state.userData.nearconId}`;\n    asyncFetch(apiURL).then(({ body }) => {\n      State.update({ transactions: body });\n    });\n  }\n};\n\nuseEffect(() => {\n  fetchData();\n  fetchTransaction();\n}, [secretkey, storedSecretKey, state.userData]);\n\nfunction capitalizeFirstLetter(str) {\n  if (!str) return str;\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\nreturn (\n  <Container>\n    <Content>\n      <Widget\n        props={{\n          nearconId: state.userData.nearconId,\n          cid: state.userData.cid,\n        }}\n        src={`${ownerId}/widget/Navbar`}\n      />\n      {selectedButton !== \"map\" && (\n        <Widget\n          src={`${ownerId}/widget/Mobile.TitleBar`}\n          props={{\n            label:\n              selectedButton !== \"profile\" &&\n              capitalizeFirstLetter(selectedButton),\n            ...state.userData,\n          }}\n        />\n      )}\n      {selectedButton === \"schedule\" && (\n        <>\n          <Widget src={`${ownerId}/widget/Schedule.Content`} />\n        </>\n      )}\n      {selectedButton === \"alerts\" && (\n        <>\n          <Widget\n            src={`${ownerId}/widget/Mobile.Home.Alerts`}\n            props={{\n              isAdmin: state?.userData?.isSuper,\n            }}\n          />\n        </>\n      )}\n      {selectedButton === \"profile\" && (\n        <Widget\n          src={`${ownerId}/widget/Mobile.Home.Profile`}\n          props={{ theme, state }}\n        />\n      )}\n      {selectedButton === \"map\" && (\n        <Widget src={`${ownerId}/widget/Map.Page`} props={{ theme }} />\n      )}\n      {selectedButton === \"help\" && (\n        <Widget src={`${ownerId}/widget/Help`} props={{ theme }} />\n      )}\n    </Content>\n\n    <Widget\n      src={`${ownerId}/widget/Mobile.Navbar`}\n      props={{\n        selectedButton: selectedButton,\n        setSelectedButton: setSelectedButton,\n      }}\n    />\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/nearcon23.near/widget/Mobile.Home", "fact_widget_deployments_id": "5e7c5080391fbf0b9e30e8ada54b12ca", "inserted_timestamp": "2023-11-03T05:32:43.985Z", "modified_timestamp": "2023-11-03T05:32:43.985Z", "__row_index": 13}