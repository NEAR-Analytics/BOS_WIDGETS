{"tx_hash": "E4SQFcYYzG9NkaUqdEDCg72CBf7zib2UYy9Z4CB2L1Qz", "action_id_social": "Fc9G7Q3D4ZEn9gET3PWFgmiJjLNqo7evPq1QdVbb7tLX-0-widget", "block_id": 104706151, "block_timestamp": "2023-11-01T18:34:31.585Z", "signer_id": "nearcon23.near", "widget_name": "Mobile.Home", "source_code": "const theme = props.theme;\nconst accountId = props.accountId || context.accountId;\nconst ownerId = \"nearcon23.near\";\nconst apiUrl =\n  \"https://gqqkd7l7mk.execute-api.us-east-1.amazonaws.com/mainnet/api/v1\";\n\nconst [selectedButton, setSelectedButton] = useState(\"profile\");\n\n// initState({});\nState.init({\n  redirectToHome: \"loading\",\n});\n\nconst Container = styled.div`  \n  max-height: 100svh;\n  height: 100%;\n`;\nconst Content = styled.div`\n  height: calc(100% - 105px);\n  flex: 1;\n  flex-direction: column;\n  overflow: auto;\n  position: relative;\n`;\n\nconst { secretkey } = props;\n\nconst storedSecretKey = Storage.get(\n  \"newPrivateKey\",\n  `${ownerId}/widget/Ticket.Page`\n)\n  ? Storage.get(\"newPrivateKey\", `${ownerId}/widget/Ticket.Page`)\n  : Storage.get(\"newPrivateKey\", `${ownerId}/widget/RegisterMobile.Index`);\nconst fetchData = () => {\n  const key = secretkey ? secretkey : storedSecretKey;\n\n  asyncFetch(`${apiUrl}/accounts/auth/${key}`).then(({ body }) => {\n    if (body?._id) {\n      // if (!!storedSecretKey === false) { }\n      State.update({\n        userData: body,\n        redirectToHome: \"\",\n      });\n    } else {\n      State.update({\n        redirectToHome: \"redirect\",\n      });\n    }\n  });\n};\n\nconst fetchTransaction = () => {\n  if (state?.userData?.nearconId) {\n    const apiURL = `${apiUrl}/transactions/${state.userData.nearconId}`;\n    asyncFetch(apiURL).then(({ body }) => {\n      State.update({ transactions: body });\n    });\n  }\n};\n\nuseEffect(() => {\n  fetchData();\n  fetchTransaction();\n}, [secretkey, storedSecretKey, state.userData]);\n\nif (state.redirectToHome === \"loading\") {\n  return <Widget src={`${ownerId}/widget/Components.LoadingOverlay`} />;\n}\n\nif (state.redirectToHome === \"redirect\") {\n  return <Redirect to=\"/\" />;\n}\n\nfunction capitalizeFirstLetter(str) {\n  if (!str) return str;\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\nreturn (\n  <Container>\n    <Content>\n      <Widget\n        props={{\n          nearconId: state.userData.nearconId,\n          cid: state.userData.cid,\n        }}\n        src={`${ownerId}/widget/Navbar`}\n      />\n      {selectedButton !== \"map\" && (\n        <Widget\n          src={`${ownerId}/widget/Mobile.TitleBar`}\n          props={{\n            label:\n              selectedButton !== \"profile\" &&\n              capitalizeFirstLetter(selectedButton),\n            ...state.userData,\n          }}\n        />\n      )}\n      {selectedButton === \"schedule\" && (\n        <>\n          <Widget src={`${ownerId}/widget/Schedule.Content`} />\n        </>\n      )}\n      {selectedButton === \"alerts\" && (\n        <>\n          <Widget src={`${ownerId}/widget/Mobile.Home.Alerts`} />\n        </>\n      )}\n      {selectedButton === \"profile\" && (\n        <Widget\n          src={`${ownerId}/widget/Mobile.Home.Profile`}\n          props={{ theme, state }}\n        />\n      )}\n      {selectedButton === \"map\" && (\n        <Widget src={`${ownerId}/widget/Map.Page`} props={{ theme }} />\n      )}\n      {selectedButton === \"help\" && (\n        <Widget src={`${ownerId}/widget/Help`} props={{ theme }} />\n      )}\n    </Content>\n\n    <Widget\n      src={`${ownerId}/widget/Mobile.Navbar`}\n      props={{\n        selectedButton: selectedButton,\n        setSelectedButton: setSelectedButton,\n      }}\n    />\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/nearcon23.near/widget/Mobile.Home", "fact_widget_deployments_id": "383b2e777379c62d1701d55710abd016", "inserted_timestamp": "2023-11-01T20:32:34.602Z", "modified_timestamp": "2023-11-01T20:32:34.602Z", "__row_index": 7}