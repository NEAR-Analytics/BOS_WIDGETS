{"tx_hash": "FJKpHRUFFxWCTE9xr7QgGS5hA2Vu7CCk44FwohSVkEgi", "action_id_social": "f8fWTke3njT3MoVsx31ZsfLJDwqLArFYGhCbH1pnJpY-0-widget", "block_id": 104706353, "block_timestamp": "2023-11-01T18:38:20.990Z", "signer_id": "nearcon23.near", "widget_name": "Admin.ScanPage", "source_code": "const ownerId = \"nearcon23.near\";\nconst baseUrl =\n  \"https://gqqkd7l7mk.execute-api.us-east-1.amazonaws.com/mainnet/api/v1\";\n\nconst HeaderStyle = styled.div`\n   background: url(\"https://ipfs.near.social/ipfs/bafkreigmwev6i2ivgz5ampkihov2ub7yenn7hohs34erheclixz2dopwru\");\n  background-repeat: no-repeat;\n  background-size: cover;\n  height: 64px;\n  min-height: 64px;\n  display: flex;\n  // margin-top:-12px;\n  align-items: flex-end;\n  padding:15px;\n  p {\n    margin-bottom: 0px;\n    font-size:22px;\n    font-weight: 700;\n    color: black;\n  }\n`;\n\nconst Body = styled.div`\n  min-height: 100vh;\n  text-align: center;\n  justify-content: center;\n  padding-top:20px;\n  p {\n    text-align:center;\n  }\n`;\nconst Container = styled.div`\n  background:url(\"https://ipfs.near.social/ipfs/bafkreiadf32sz4riwsk6gwxrts7qqldhjae7jkgvl5gbhzngj4ekur2iuq\");\n   background-repeat: no-repeat;\n  background-attachment: fixed;\n  background-size: cover;\n  padding-bottom:60px;\n`;\nconst NavLink = styled.div`\n  * {\n      color: #000000;\n  }\n`;\n\nconst [tikcetData, setTicketData] = useState(null);\nconst { privateKey } = props;\n\nconst fetchTicketData = () => {\n  const apiURL = `${baseUrl}/accounts/${privateKey}/validate`;\n  const { body } = fetch(apiURL);\n  setTicketData(body.user);\n};\n\nif (privateKey) {\n  fetchTicketData();\n}\n\nconst [showAlert, setShowAlert] = useState(true);\n\nuseEffect(() => {\n  const timer = setTimeout(() => {\n    setShowAlert(false);\n  }, duration);\n\n  return () => {\n    clearTimeout(timer);\n  };\n}, [duration]);\n\nconst confirmId = () => {\n  State.update({ loading: true });\n  asyncFetch(\n    `${baseUrl}/accounts/claim`,\n    {\n      body: JSON.stringify({\n        secretKey: privateKey,\n      }),\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      method: \"POST\",\n    }\n  )\n    .then((res) => {\n      console.log(\"SCAN PAGE RES : \", res);\n\n      if (res.status === 200) {\n        State.update({ loading: false, success: true });\n\n        setTimeout(() => {\n          props?.backToHome?.();\n        }, 2500);\n      } else {\n        State.update({ loading: false, success: false });\n        setShowAlert(true);\n      }\n    })\n    .catch((err) => {\n      State.update({ loading: false, success: false });\n      console.log(\"SCAN PAGE ERROR : \", err);\n    });\n};\n\nconst { secretkey } = props;\n\nconst storedSecretKey = Storage.get(\n  \"newPrivateKey\",\n  `${ownerId}/widget/Ticket.Page`\n)\n  ? Storage.get(\"newPrivateKey\", `${ownerId}/widget/Ticket.Page`)\n  : Storage.get(\"newPrivateKey\", `${ownerId}/widget/RegisterMobile.Index`);\n\nconst fetchData = () => {\n  const key = secretkey ? secretkey : storedSecretKey;\n  asyncFetch(\n    `${baseUrl}/accounts/auth/${key}`\n  ).then(({ body }) => {\n    if (!!storedSecretKey === false) {\n      State.update({\n        redirectToHome: \"redirect\",\n      });\n    }\n    State.update({\n      userData: body,\n    });\n  });\n};\n\nuseEffect(() => {\n  fetchData();\n}, [secretkey, storedSecretKey]);\n\nreturn (\n  <Container>\n    <Widget\n      props={{\n        nearconId: state.userData.nearconId,\n        cid: state.userData.cid,\n      }}\n      src={`${ownerId}/widget/Navbar`}\n    />\n    <HeaderStyle>\n      <div\n        style={{\n          display: \"flex\",\n          alignItems: \"center\",\n          width: \"100%\",\n          justifyContent: \"space-between\",\n        }}\n      >\n        <p>Admin</p>\n\n        <NavLink>\n          <Link to=\"/mobile\">\n            <Widget\n              src={`${ownerId}/widget/Inputs.Toggle2`}\n              props={{ rightLabel: \"Home\", value: true }}\n            />\n          </Link>\n        </NavLink>\n      </div>\n    </HeaderStyle>\n    <Body>\n      {showAlert && (\n        <div\n          className=\"alert alert-danger auto-dismiss-alert\"\n          role=\"alert\"\n          style={{\n            position: \"absolute\",\n            width: \"100%\",\n          }}\n        >\n          Failed to claim ticket\n        </div>\n      )}\n\n      <div\n        style={{\n          textAlign: \"center\",\n          display: \"flex\",\n          margin: \"auto\",\n          width: \"fit-content\",\n        }}\n      >\n        <svg\n          xmlns=\"http://www.w3.org/2000/svg\"\n          width=\"40\"\n          height=\"35\"\n          viewBox=\"0 0 40 35\"\n          fill=\"none\"\n        >\n          <path\n            d=\"M37.7671 1.08347L15.4366 24.4116C14.592 25.2939 13.1957 25.3357 12.2998 24.5055L2.55461 15.4743C2.06219 15.018 1.3181 14.9672 0.768182 15.3522C0.106375 15.8157 -0.0382998 16.736 0.44939 17.3801L12.5154 33.3171C13.2234 34.2522 14.6238 34.2664 15.3506 33.3459L39.5785 2.65917C39.9752 2.15663 39.9083 1.43127 39.4263 1.0098C38.9425 0.586766 38.2115 0.619226 37.7671 1.08347Z\"\n            fill=\"white\"\n          />\n        </svg>\n        <p style={{ color: \"#DCDCF9\", fontSize: 30 }}>Check their ID</p>\n      </div>\n      <p\n        style={{\n          color: \"#9797FF\",\n          fontWeight: \"400\",\n          fontFamily: \"Mona Sans\",\n          marginTop: -10,\n        }}\n      >\n        You should see the following.\n      </p>\n      <div\n        style={{\n          marginTop: 100,\n          minHeight: 250,\n          color: \"white\",\n          justifyContent: \"center\",\n          display: \"flex\",\n          flexDirection: \"column\",\n          alignItems: \"center\",\n\n          position: \"relative\",\n        }}\n      >\n        <img\n          style={{ width: \"min(90%, 350px)\", position: \"absolute\" }}\n          src=\"https://ipfs.near.social/ipfs/bafkreihqgi6mrfuje32swbbmhxlybwtguo4oyjjeher6jcw25m6pwxxqji\"\n        />\n        <div\n          style={{\n            zIndex: 10,\n            // marginTop: -275,\n\n            display: \"flex\",\n            justifyContent: \"center\",\n            alignItems: \"center\",\n            flexDirection: \"column\",\n          }}\n        >\n          <p style={{ color: \"black\", fontWeight: \"500\", marginBottom: -5 }}>\n            Name\n          </p>\n          <p\n            style={{\n              color: \"black\",\n              fontWeight: \"700\",\n              fontSize: 25,\n              textAlign: \"center\",\n              width: \"15ch\",\n              wordWrap: \"break-word\",\n            }}\n          >\n            {tikcetData.name}\n          </p>\n          <div\n            style={{\n              display: \"flex\",\n              justifyContent: \"center\",\n              alignItems: \"center\",\n              flexDirection: \"column\",\n            }}\n          >\n            <p style={{ color: \"black\", fontWeight: \"500\", marginBottom: -5 }}>\n              Email\n            </p>\n            <p\n              style={{\n                color: \"black\",\n                fontWeight: \"700\",\n                fontSize: 25,\n                width: \"15ch\",\n                wordWrap: \"break-word\",\n              }}\n            >\n              {tikcetData.email}\n            </p>\n          </div>\n        </div>\n      </div>\n      {!state.success && (\n        <div\n          style={{\n            position: \"fixed\",\n            bottom: 0,\n            width: \"100%\",\n            backgroundColor: \"#ffffffFFf\",\n            padding: 10,\n          }}\n        >\n          <button\n            style={{\n              backgroundColor: \"#000\",\n              borderWidth: 0,\n              borderRadius: 50,\n              width: \"90%\",\n              padding: 12,\n              fontWeight: \"600\",\n            }}\n            onClick={() => {\n              props?.backToHome?.();\n            }}\n          >\n            Cancel\n          </button>\n          <button\n            style={{\n              marginTop: 20,\n              backgroundColor: \"#00EC97\",\n              borderWidth: 0,\n              padding: 10,\n              fontWeight: \"600\",\n              color: \"black\",\n              borderRadius: 100,\n              width: \"90%\",\n            }}\n            onClick={() => confirmId()}\n          >\n            {state.loading ? \"Processing\" : \"Confirm & Scan Next Ticket\"}\n          </button>\n        </div>\n      )}\n      {state.success && (\n        <p\n          style={{\n            color: \"white\",\n            fontSize: 20,\n            fontWeight: \"600\",\n            marginTop: 140,\n          }}\n        >\n          Successfully Verified\n        </p>\n      )}\n    </Body>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/nearcon23.near/widget/Admin.ScanPage", "fact_widget_deployments_id": "f4d0af6a8527b1afc95bfb998761b8c2", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}