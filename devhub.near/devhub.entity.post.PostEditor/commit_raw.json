{"tx_hash": "GrYZDkZXk1YxKG4ZTM5sJskSFDotBdQxPJzzD3ydYdbY", "action_id_social": "H8rtkqpMWjWMLCgCgi9U7LknKfEHVTYQ2FLw6UXbYHZZ-0-widget", "block_id": 114525676, "block_timestamp": "2024-03-11T15:02:43.808Z", "signer_id": "devhub.near", "widget_name": "devhub.entity.post.PostEditor", "source_code": "const { normalize } = VM.require(\"devhub.near/widget/core.lib.stringUtils\");\nconst { getDepositAmountForWriteAccess } = VM.require(\n  \"devhub.near/widget/core.lib.common\"\n);\n\ngetDepositAmountForWriteAccess || (getDepositAmountForWriteAccess = () => {});\nnormalize || (normalize = () => {});\n\nconst CenteredMessage = styled.div`\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  width: 100%;\n  height: 384px;\n`;\n\nconst LoadingButtonSpinner = (\n  <span\n    class=\"submit-post-loading-indicator spinner-border spinner-border-sm\"\n    role=\"status\"\n    aria-hidden=\"true\"\n  ></span>\n);\n\nfunction initLabels() {\n  const labels = [];\n  if (typeof props.labels === \"string\") {\n    labels.push(...props.labels.split(\",\"));\n  }\n  if (Array.isArray(props.labels)) {\n    labels.push(...props.labels);\n  }\n  if (props.referral) {\n    labels.push(`referral:${props.referral}`);\n  }\n  return labels;\n}\n\nif (!context.accountId) {\n  return (\n    <CenteredMessage height={\"384px\"}>\n      <h2>Please sign in to create a post.</h2>\n    </CenteredMessage>\n  );\n}\n\nconst userStorageDeposit = Near.view(\n  \"social.near\",\n  \"storage_balance_of\",\n  {\n    account_id: context.accountId,\n  }\n);\n\nconst cleanDescription = (description) => {\n  return description\n    ? description.replace(\n        /###### Requested amount: .+?\\n###### Requested sponsor: @[^\\s]+\\n/g,\n        \"\"\n      )\n    : description;\n};\n\nconst postTypeOptions = {\n  Idea: {\n    name: \"Idea\",\n    icon: \"bi-lightbulb\",\n    description:\n      \"Get feedback from the community about a problem, opportunity, or need.\",\n  },\n\n  Solution: {\n    name: \"Solution\",\n    icon: \"bi-rocket\",\n    description:\n      \"Provide a specific proposal or implementation to an idea, optionally requesting funding. If your solution relates to an existing idea, please reply to the original post with a solution.\",\n  },\n};\n\nlet fields = {\n  Comment: [\"description\"],\n  Idea: [\"name\", \"description\"],\n  Solution: [\"name\", \"description\", \"fund_raising\"],\n  Attestation: [\"name\", \"description\"],\n  Sponsorship: [\n    \"name\",\n    \"description\",\n    \"amount\",\n    \"sponsorship_token\",\n    \"supervisor\",\n  ],\n  Github: [\"githubLink\", \"name\", \"description\"],\n};\n\nconst isCreatePostPage = props.isCreatePostPage ?? false;\nconst postType = props.postType ?? \"Idea\";\nconst parentId = props.parentId ?? null;\nconst mode = props.mode ?? \"Create\";\nconst labelStrings = initLabels();\nconst [postIdList, setPostIdList] = useState(null); // to show updated post after approve txn\nconst [showPostPage, setShowPostPage] = useState(false); // show newly created post\nconst [postId, setPostId] = useState(props.postId ?? null);\nconst [postData, setPostData] = useState(null); // for capturing edit post change\nconst [isTxnCreated, setCreateTxn] = useState(false);\nconst [isSubmittingTransaction, setIsSubmittingTransaction] = useState(false);\n\nuseEffect(() => {\n  if (mode == \"Edit\") {\n    const data = Near.view(\"devgovgigs.near\", \"get_post\", {\n      post_id: postId,\n    });\n    if (!postData) {\n      setPostData(data);\n    }\n    if (postData && data && JSON.stringify(postData) !== JSON.stringify(data)) {\n      props.setEditorState(false);\n      props.setExpandReplies(true);\n      setPostData(data);\n    }\n  } else {\n    const postIds = Near.view(\"devgovgigs.near\", \"get_all_post_ids\");\n    if (!postIdList) {\n      setPostIdList(postIds);\n    }\n    if (\n      isTxnCreated &&\n      postIdList?.length > 0 &&\n      postIds.length > 0 &&\n      postIdList.length !== postIds.length\n    ) {\n      props.onDraftStateChange(null);\n      if (isCreatePostPage) {\n        setShowPostPage(true);\n        setPostId(postIds[postIds?.length - 1]);\n      } else {\n        // close editor and expand replies\n        props.setEditorState(false);\n        props.setExpandReplies(true);\n      }\n      setPostIdList(postIds);\n    }\n  }\n});\n\nconst labels = labelStrings.map((s) => {\n  return { name: s };\n});\n\ninitState({\n  seekingFunding: props.seekingFunding ?? false,\n  author_id: context.accountId,\n  // Should be a list of objects with field \"name\".\n  labels,\n  // Should be a list of labels as strings.\n  // Both of the label structures should be modified together.\n  labelStrings: [],\n  postType,\n  name: props.name ?? \"\",\n  description:\n    (props.postType === \"Solution\"\n      ? cleanDescription(props.description)\n      : props.description) ?? \"\",\n  amount: props.amount ?? \"0\",\n  token: props.token ?? \"USDT\",\n  supervisor: props.supervisor ?? \"neardevdao.near\",\n  githubLink: props.githubLink ?? \"\",\n  warning: \"\",\n  draftStateApplied: false,\n  mentionInput: \"\", // text next to @ tag\n  mentionsArray: [], // all the mentions in the description\n  displayFields: fields[postType],\n});\n\n/* INCLUDE: \"core/lib/autocomplete\" */\nconst autocompleteEnabled = true;\n\nconst AutoComplete = styled.div`\n  z-index: 5;\n\n  > div > div {\n    padding: calc(var(--padding) / 2);\n  }\n`;\n\nif (props.transactionHashes) {\n  const transaction = useCache(\n    () =>\n      asyncFetch(\"https://rpc.mainnet.near.org\", {\n        method: \"POST\",\n        headers: {\n          \"content-type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          jsonrpc: \"2.0\",\n          id: \"dontcare\",\n          method: \"tx\",\n          params: [props.transactionHashes, context.accountId],\n        }),\n      }).then((res) => res),\n    props.transactionHashes + context.accountId,\n    { subscribe: false }\n  );\n\n  if (transaction !== null) {\n    const transaction_method_name =\n      transaction?.body?.result?.transaction?.actions[0].FunctionCall\n        .method_name;\n\n    const is_edit_or_add_post_transaction =\n      transaction_method_name == \"add_post\" ||\n      transaction_method_name == \"edit_post\";\n\n    if (is_edit_or_add_post_transaction) {\n      props.onDraftStateChange(null);\n    }\n\n    // show the latest created post to user\n    if (transaction_method_name == \"add_post\" && isCreatePostPage) {\n      setShowPostPage(true);\n      setPostId(postIdList?.[postIdList?.length - 1]);\n    }\n  }\n}\n\nfunction textareaInputHandler(value) {\n  const words = value.split(/\\s+/);\n  const allMentiones = words\n    .filter((word) => word.startsWith(\"@\"))\n    .map((mention) => mention.slice(1));\n  const newMentiones = allMentiones.filter(\n    (item) => !state.mentionsArray.includes(item)\n  );\n\n  State.update((lastKnownState) => ({\n    ...lastKnownState,\n    text: value,\n    showAccountAutocomplete: newMentiones?.length > 0,\n    mentionsArray: allMentiones,\n    mentionInput: newMentiones?.[0] ?? \"\",\n  }));\n}\n\nfunction autoCompleteAccountId(id) {\n  // to make sure we update the @ at correct index\n  let currentIndex = 0;\n  const updatedDescription = state.description.replace(\n    /(?:^|\\s)(@[^\\s]*)/g,\n    (match) => {\n      if (currentIndex === state.mentionsArray.indexOf(state.mentionInput)) {\n        currentIndex++;\n        return ` @${id}`;\n      } else {\n        currentIndex++;\n        return match;\n      }\n    }\n  );\n  State.update((lastKnownState) => ({\n    ...lastKnownState,\n    handler: \"autocompleteSelected\",\n    description: updatedDescription,\n    showAccountAutocomplete: false,\n  }));\n}\n\n/* END_INCLUDE: \"core/lib/autocomplete\" */\n\nif (!state.draftStateApplied && props.draftState) {\n  State.update({ ...props.draftState, draftStateApplied: true });\n}\n\nconst typeSwitch = (optionName) => {\n  State.update({\n    postType: optionName,\n    displayFields: fields[optionName],\n  });\n};\n\n// This must be outside onClick, because Near.view returns null at first, and when the view call finished, it returns true/false.\n// If checking this inside onClick, it will give `null` and we cannot tell the result is true or false.\nlet grantNotify = Near.view(\n  \"social.near\",\n  \"is_write_permission_granted\",\n  {\n    predecessor_id: \"devgovgigs.near\",\n    key: context.accountId + \"/index/notify\",\n  }\n);\nif (grantNotify === null || userStorageDeposit === null) {\n  return;\n}\n\nconst tokenMapping = {\n  NEAR: \"NEAR\",\n  USDT: {\n    NEP141: {\n      address: \"usdt.tether-token.near\",\n    },\n  },\n  USDC: {\n    NEP141: {\n      address:\n        \"17208628f84f5d6ad33f0da3bbbeb27ffcb398eac501a31bd6ad2011e36133a1\",\n    },\n  },\n};\n\nconst onSubmit = () => {\n  setIsSubmittingTransaction(true);\n  let labels = state.labelStrings;\n  var body = {\n    Comment: { description: state.description, comment_version: \"V2\" },\n    Idea: {\n      name: state.name,\n      description: state.description,\n      idea_version: \"V1\",\n    },\n    Solution: {\n      name: state.name,\n      description: generateDescription(\n        state.description,\n        state.amount,\n        state.token,\n        state.supervisor,\n        state.seekingFunding\n      ),\n      solution_version: \"V1\",\n    },\n    Attestation: {\n      name: state.name,\n      description: state.description,\n      attestation_version: \"V1\",\n    },\n    Sponsorship: {\n      name: state.name,\n      description: state.description,\n      amount: state.amount,\n      sponsorship_token: tokenMapping[state.token],\n      supervisor: state.supervisor,\n      sponsorship_version: \"V1\",\n    },\n    Github: {\n      name: state.name,\n      description: state.description,\n      github_version: \"V0\",\n      github_link: state.githubLink,\n    },\n  }[state.postType];\n  body[\"post_type\"] = state.postType;\n  if (!context.accountId) {\n    return;\n  }\n  let txn = [];\n  if (mode == \"Create\") {\n    props.onDraftStateChange(\n      Object.assign({}, state, { parent_post_id: parentId })\n    );\n    txn.push({\n      contractName: \"devgovgigs.near\",\n      methodName: \"add_post\",\n      args: {\n        parent_id: parentId,\n        labels,\n        body,\n      },\n      gas: Big(10).pow(14),\n    });\n  } else if (mode == \"Edit\") {\n    props.onDraftStateChange(\n      Object.assign({}, state, { edit_post_id: postId })\n    );\n    txn.push({\n      contractName: \"devgovgigs.near\",\n      methodName: \"edit_post\",\n      args: {\n        id: postId,\n        labels,\n        body,\n      },\n      gas: Big(10).pow(14),\n    });\n  }\n  if (mode == \"Create\" || mode == \"Edit\") {\n    if (grantNotify === false) {\n      txn.unshift({\n        contractName: \"social.near\",\n        methodName: \"grant_write_permission\",\n        args: {\n          predecessor_id: \"devgovgigs.near\",\n          keys: [context.accountId + \"/index/notify\"],\n        },\n        gas: Big(10).pow(14),\n        deposit: getDepositAmountForWriteAccess(userStorageDeposit),\n      });\n    }\n    setCreateTxn(true);\n    Near.call(txn);\n  }\n};\n\nconst checkLabel = (label) => {\n  Near.asyncView(\"devgovgigs.near\", \"is_allowed_to_use_labels\", {\n    editor: context.accountId,\n    labels: [label],\n  }).then((allowed) => {\n    if (allowed) {\n      State.update({ warning: \"\" });\n    } else {\n      State.update({\n        warning:\n          'The label \"' +\n          label +\n          '\" is protected and can only be added by moderators',\n      });\n      return;\n    }\n  });\n};\n\nconst setLabels = (labels) => {\n  labels = labels.map((o) => {\n    o.name = normalize(o.name);\n    return o;\n  });\n  if (labels.length < state.labels.length) {\n    let oldLabels = new Set(state.labels.map((label) => label.name));\n    for (let label of labels) {\n      oldLabels.delete(label.name);\n    }\n    let removed = oldLabels.values().next().value;\n    Near.asyncView(\"devgovgigs.near\", \"is_allowed_to_use_labels\", {\n      editor: context.accountId,\n      labels: [removed],\n    }).then((allowed) => {\n      if (allowed) {\n        let labelStrings = labels.map(({ name }) => name);\n        State.update({ labels, labelStrings });\n      } else {\n        State.update({\n          warning:\n            'The label \"' +\n            removed +\n            '\" is protected and can only be updated by moderators',\n        });\n        return;\n      }\n    });\n  } else {\n    let labelStrings = labels.map((o) => {\n      return o.name;\n    });\n    State.update({ labels, labelStrings });\n  }\n};\nconst existingLabelStrings =\n  Near.view(\"devgovgigs.near\", \"get_all_allowed_labels\", {\n    editor: context.accountId,\n  }) ?? [];\nconst existingLabelSet = new Set(existingLabelStrings);\nconst existingLabels = existingLabelStrings\n  .filter((it) => it !== \"blog\") // remove blog label so users cannot publish blogs from feed\n  .map((s) => {\n    return { name: s };\n  });\n\nconst labelEditor = (\n  <div className=\"col-lg-12  mb-2\">\n    <label htmlFor=\"labels\" className=\"fs-6 fw-bold mb-1\">\n      Labels\n    </label>\n    <Typeahead\n      multiple\n      labelKey=\"name\"\n      onInputChange={checkLabel}\n      onChange={setLabels}\n      options={existingLabels}\n      placeholder=\"near.social, widget, NEP, standard, protocol, tool\"\n      selected={state.labels}\n      positionFixed\n      allowNew={(results, props) => {\n        return (\n          !existingLabelSet.has(props.text) &&\n          props.text.toLowerCase() !== \"blog\" && // dont allow adding \"Blog\"\n          props.selected.filter((selected) => selected.name === props.text)\n            .length == 0 &&\n          Near.view(\"devgovgigs.near\", \"is_allowed_to_use_labels\", {\n            editor: context.accountId,\n            labels: [props.text],\n          })\n        );\n      }}\n    />\n  </div>\n);\n\nconst githubLinkDiv = (\n  <div className=\"col-lg-12  mb-2\">\n    Github Issue URL:\n    <input\n      type=\"text\"\n      value={state.githubLink}\n      onChange={(event) => State.update({ githubLink: event.target.value })}\n    />\n  </div>\n);\n\nconst nameDiv = (\n  <div className=\"col-lg-12  mb-2\">\n    <label htmlFor=\"title\" className=\"fs-6 fw-bold mb-1\">\n      Title\n    </label>\n    <input\n      name=\"title\"\n      id=\"title\"\n      data-testid=\"name-editor\"\n      type=\"text\"\n      value={state.name}\n      onChange={(event) => State.update({ name: event.target.value })}\n    />\n  </div>\n);\n\nconst amountDiv = (\n  <div className=\"col-lg-6  mb-2\">\n    Amount:\n    <input\n      type=\"text\"\n      value={state.amount}\n      onChange={(event) => State.update({ amount: event.target.value })}\n    />\n  </div>\n);\n\nconst tokenDiv = (\n  <div className=\"col-lg-6 mb-2\">\n    Currency\n    <select\n      onChange={(event) => State.update({ token: event.target.value })}\n      class=\"form-select\"\n      aria-label=\"Select currency\"\n      value={state.token}\n    >\n      <option value=\"USDT\">USDT</option>\n      <option value=\"NEAR\">NEAR</option>\n      <option value=\"USDC\">USDC</option>\n    </select>\n  </div>\n);\n\nconst supervisorDiv = (\n  <div className=\"col-lg-6 mb-2\">\n    Supervisor:\n    <input\n      type=\"text\"\n      value={state.supervisor}\n      onChange={(event) => State.update({ supervisor: event.target.value })}\n    />\n  </div>\n);\n\nconst callDescriptionDiv = () => {\n  return (\n    <div className=\"col-lg-12  mb-2\">\n      <label htmlFor=\"description\" className=\"fs-6 fw-bold mb-1\">\n        Description\n      </label>\n      <Widget\n        src={\"devhub.near/widget/devhub.components.molecule.MarkdownEditor\"}\n        props={{\n          data: { handler: state.handler, content: state.description },\n          onChange: (content) => {\n            State.update({ description: content, handler: \"update\" });\n            textareaInputHandler(content);\n          },\n        }}\n      />\n      {autocompleteEnabled && state.showAccountAutocomplete && (\n        <AutoComplete>\n          <Widget\n            src=\"devhub.near/widget/devhub.components.molecule.AccountAutocomplete\"\n            props={{\n              term: state.mentionInput,\n              onSelect: autoCompleteAccountId,\n              onClose: () => State.update({ showAccountAutocomplete: false }),\n            }}\n          />\n        </AutoComplete>\n      )}\n    </div>\n  );\n};\n\nconst disclaimer = (\n  <p>\n    <i>\n      * Note, all projects that were granted sponsorships are required to pass\n      KYC to receive the funding.\n    </i>\n  </p>\n);\n\nconst isFundraisingDiv = (\n  // This is jank with just btns and not radios. But the radios were glitchy af\n  <>\n    <div class=\"mb-2\">\n      <p class=\"fs-6 fw-bold mb-1\">\n        Are you seeking funding for your solution?\n        <span class=\"text-muted fw-normal\">(Optional)</span>\n      </p>\n      <div class=\"form-check form-check-inline\">\n        <label class=\"form-check-label\">\n          <button\n            className=\"btn btn-light p-0\"\n            style={{\n              backgroundColor: state.seekingFunding ? \"#0C7283\" : \"inherit\",\n              color: \"#f3f3f3\",\n              border: \"solid #D9D9D9\",\n              borderRadius: \"100%\",\n              height: \"20px\",\n              width: \"20px\",\n            }}\n            onClick={() => State.update({ seekingFunding: true })}\n          />\n          Yes\n        </label>\n      </div>\n      <div class=\"form-check form-check-inline\">\n        <label class=\"form-check-label\">\n          <button\n            className=\"btn btn-light p-0\"\n            style={{\n              backgroundColor: !state.seekingFunding ? \"#0C7283\" : \"inherit\",\n              color: \"#f3f3f3\",\n              border: \"solid #D9D9D9\",\n              borderRadius: \"100%\",\n              height: \"20px\",\n              width: \"20px\",\n            }}\n            onClick={() => State.update({ seekingFunding: false })}\n          />\n          No\n        </label>\n      </div>\n    </div>\n  </>\n);\n\nconst fundraisingDiv = (\n  <div class=\"d-flex flex-column mb-2\">\n    <div className=\"col-lg-6 mb-2\">\n      Currency\n      <select\n        onChange={(event) => State.update({ token: event.target.value })}\n        class=\"form-select\"\n        aria-label=\"Default select example\"\n        value={state.token}\n      >\n        <option value=\"USDT\">USDT</option>\n        <option value=\"NEAR\">NEAR</option>\n        <option value=\"USDC\">USDC</option>\n      </select>\n    </div>\n    <div className=\"col-lg-6 mb-2\">\n      Requested amount\n      <span class=\"text-muted fw-normal\">(Numbers Only)</span>\n      <input\n        data-testid=\"requested-amount-editor\"\n        type=\"number\"\n        value={parseInt(state.amount) > 0 ? state.amount : \"\"}\n        min={0}\n        onChange={(event) => {\n          State.update({\n            amount: Number(\n              event.target.value.toString().replace(/e/g, \"\")\n            ).toString(),\n          });\n        }}\n      />\n    </div>\n    <div className=\"col-lg-6 mb-2\">\n      <p class=\"mb-1\">\n        Requested sponsor\n        <span class=\"text-muted fw-normal\">(Optional)</span>\n      </p>\n      <p style={{ fontSize: \"13px\" }} class=\"m-0 text-muted fw-light\">\n        If you are requesting funding from a specific sponsor, please enter\n        their username.\n      </p>\n      <div class=\"input-group flex-nowrap\">\n        <span class=\"input-group-text\" id=\"addon-wrapping\">\n          @\n        </span>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          placeholder=\"Enter username\"\n          value={state.supervisor}\n          onChange={(event) => State.update({ supervisor: event.target.value })}\n        />\n      </div>\n    </div>\n  </div>\n);\n\nfunction generateDescription(text, amount, token, supervisor, seekingFunding) {\n  const fundingText =\n    amount > 0 && token ? `###### Requested amount: ${amount} ${token}\\n` : \"\";\n  const supervisorText = supervisor\n    ? `###### Requested sponsor: @${supervisor}\\n`\n    : \"\";\n  return seekingFunding ? `${fundingText}${supervisorText}${text}` : text;\n}\n\nconst [tab, setTab] = useState(\"editor\");\n\nconst renamedPostType =\n  state.postType == \"Submission\" ? \"Solution\" : state.postType;\n// Below there is a weird code with fields.includes(\"githubLink\") ternary operator.\n// This is to hack around rendering bug of near.social.\n\nreturn (\n  <div className=\"d-flex flex-column flex-grow-1 w-100\">\n    <div className=\"mx-2 mx-md-5 mb-5\">\n      {showPostPage ? (\n        <Widget\n          src={\"devhub.near/widget/devhub.entity.post.Post\"}\n          props={{\n            id: postId,\n            expandable: true,\n            defaultExpanded: false,\n            isInList: true,\n            isPreview: false,\n            onDraftStateChange: props.onDraftStateChange,\n            referral: postId,\n            transactionHashes: props.transactionHashes,\n          }}\n        />\n      ) : (\n        <div className=\"card\">\n          <div className=\"card-header\">\n            <div>\n              <ul class=\"nav nav-tabs\">\n                <li class=\"nav-item\">\n                  <button\n                    class={`nav-link ${tab === \"editor\" ? \"active\" : \"\"}`}\n                    onClick={() => setTab(\"editor\")}\n                  >\n                    Editor\n                  </button>\n                </li>\n                <li class=\"nav-item\">\n                  <button\n                    class={`nav-link ${tab === \"preview\" ? \"active\" : \"\"}`}\n                    onClick={() => setTab(\"preview\")}\n                  >\n                    Preview\n                  </button>\n                </li>\n              </ul>\n            </div>\n            {!isCreatePostPage && tab === \"editor\" && (\n              <div className=\"my-3\">\n                {mode} {renamedPostType}\n              </div>\n            )}\n            {tab === \"preview\" && <div className=\"my-3\">Post Preview</div>}\n          </div>\n          <div class=\"card-body\">\n            {tab === \"editor\" && (\n              <>\n                {state.warning && (\n                  <div\n                    class=\"alert alert-warning alert-dismissible fade show\"\n                    role=\"alert\"\n                  >\n                    {state.warning}\n                    <button\n                      type=\"button\"\n                      class=\"btn-close\"\n                      data-bs-dismiss=\"alert\"\n                      aria-label=\"Close\"\n                      onClick={() => State.update({ warning: \"\" })}\n                    ></button>\n                  </div>\n                )}\n                {isCreatePostPage && (\n                  <div>\n                    <p class=\"card-title fw-bold fs-6\">\n                      What do you want to create?\n                    </p>\n                    <div class=\"d-flex flex-row gap-2\">\n                      {Object.values(postTypeOptions).map((option) => (\n                        <button\n                          className={`btn btn-${\n                            state.postType === option.name\n                              ? \"primary\"\n                              : \"outline-secondary\"\n                          }`}\n                          data-testid={`btn-${option.name.toLowerCase()}`}\n                          key={option.name}\n                          onClick={() => typeSwitch(option.name)}\n                          style={\n                            state.postType === option.name\n                              ? {\n                                  backgroundColor: \"#0C7283\",\n                                  color: \"#f3f3f3\",\n                                }\n                              : null\n                          }\n                          type=\"button\"\n                        >\n                          <i className={`bi ${option.icon}`} />\n                          <span>{option.name}</span>\n                        </button>\n                      ))}\n                    </div>\n                    <p class=\"text-muted w-75 my-1\">\n                      {postTypeOptions[state.postType].description}\n                    </p>\n                  </div>\n                )}\n                {/* This statement around the githubLinkDiv creates a weird render bug\n      where the title renders extra on state change. */}\n                {state.displayFields.includes(\"githubLink\") ? (\n                  <div className=\"row\">\n                    {state.displayFields.includes(\"githubLink\") &&\n                      githubLinkDiv}\n                    {labelEditor}\n                    {state.displayFields.includes(\"name\") && nameDiv}\n                    {state.displayFields.includes(\"description\") &&\n                      callDescriptionDiv()}\n                  </div>\n                ) : (\n                  <div className=\"row\">\n                    {labelEditor}\n                    {state.displayFields.includes(\"name\") && nameDiv}\n                    {state.displayFields.includes(\"amount\") && amountDiv}\n                    {state.displayFields.includes(\"sponsorship_token\") &&\n                      tokenDiv}\n                    {state.displayFields.includes(\"supervisor\") &&\n                      supervisorDiv}\n                    {state.displayFields.includes(\"description\") &&\n                      callDescriptionDiv()}\n                    {state.displayFields.includes(\"fund_raising\") &&\n                      isFundraisingDiv}\n                    {state.seekingFunding &&\n                      state.displayFields.includes(\"fund_raising\") &&\n                      fundraisingDiv}\n                  </div>\n                )}\n\n                {disclaimer}\n              </>\n            )}\n            {tab === \"preview\" && (\n              <div className=\"mb-2\">\n                <Widget\n                  src=\"devhub.near/widget/devhub.entity.post.Post\"\n                  props={{\n                    isPreview: true,\n                    id: 0, // irrelevant\n                    post: {\n                      author_id: state.author_id,\n                      likes: [],\n                      snapshot: {\n                        editor_id: state.editor_id,\n                        labels: state.labelStrings,\n                        post_type: postType,\n                        name: state.name,\n                        description:\n                          state.postType == \"Solution\"\n                            ? generateDescription(\n                                state.description,\n                                state.amount,\n                                state.token,\n                                state.supervisor,\n                                state.seekingFunding\n                              )\n                            : state.description,\n                        amount: state.amount,\n                        sponsorship_token: state.token,\n                        supervisor: state.supervisor,\n                        github_link: state.githubLink,\n                      },\n                    },\n                  }}\n                />\n              </div>\n            )}\n\n            <>\n              <button\n                data-testid=\"submit-create-post\"\n                style={{\n                  width: \"7rem\",\n                  backgroundColor: \"#0C7283\",\n                  color: \"#f3f3f3\",\n                }}\n                disabled={\n                  (state.seekingFunding &&\n                    (!state.amount || state.amount < 1)) ||\n                  (isCreatePostPage &&\n                    (state.name === \"\" || state.description === \"\"))\n                }\n                className=\"btn btn-light mb-2 p-3\"\n                onClick={onSubmit}\n                disabled={isSubmittingTransaction}\n              >\n                {isSubmittingTransaction ? LoadingButtonSpinner : <></>}\n                Submit\n              </button>\n              {!isCreatePostPage && (\n                <button\n                  style={{\n                    width: \"7rem\",\n                    backgroundColor: \"#fff\",\n                    color: \"#000\",\n                  }}\n                  className=\"btn btn-light mb-2 p-3\"\n                  onClick={() => props.setEditorState(false)}\n                >\n                  Cancel\n                </button>\n              )}\n            </>\n          </div>\n        </div>\n      )}\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/devhub.near/widget/devhub.entity.post.PostEditor", "fact_widget_deployments_id": "a21643748157aa7bd16297514a51b780", "inserted_timestamp": "2024-03-11T16:26:58.389Z", "modified_timestamp": "2024-03-11T16:26:58.389Z", "__row_index": 46}