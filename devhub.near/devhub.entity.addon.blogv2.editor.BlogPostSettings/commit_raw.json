{"tx_hash": "65pRnmRzeRC53myqM7NmGn2rPKq3YC6HyA3NQQZ3YiM5", "action_id_social": "E7CRhGsGdHh91ChV45LmyoABz3gQjeX2sTZdNQnt8YQA-0-widget", "block_id": 122114121, "block_timestamp": "2024-06-27T15:36:57.421Z", "signer_id": "devhub.near", "widget_name": "devhub.entity.addon.blogv2.editor.BlogPostSettings", "source_code": "const { normalize } = VM.require(\"devhub.near/widget/core.lib.stringUtils\");\nnormalize || (normalize = () => {});\n\nconst { data, onHideSettings, onSubmit } = props;\n\nconst [isConfirmModalOpen, setModalVisible] = useState(false);\n\nconst [title, setTitle] = useState(data.title || \"\");\nconst [subtitle, setSubtitle] = useState(data.subtitle || \"\");\nconst [authorEnabled, setAuthorEnabled] = useState(\n  data.authorEnabled || \"disabled\"\n);\nconst [searchEnabled, setSearchEnabled] = useState(\n  data.searchEnabled || \"disabled\" // 'enabled', 'disabled'\n);\nconst [orderBy, setOrderBy] = useState(data.orderBy || \"timedesc\"); // timedesc, timeasc, alpha\nconst [postPerPage, setPostPerPage] = useState(data.postPerPage || 10);\n\nconst [categoriesEnabled, setCategoriesEnabled] = useState(\n  data.categoriesEnabled || \"disabled\" // 'enabled', 'disabled'\n);\nconst switchCategoryEnabled = (value) => {\n  if (value === \"disabled\") {\n    setSelected([]);\n    setCategoryRequired(\"not_required\");\n  }\n  setCategoriesEnabled(value);\n};\nconst filteredCategories =\n  (data.categories || []).filter((categories) => categories !== null) || [];\n\nconst [selected, setSelected] = useState(filteredCategories);\nconst [categoryRequired, setCategoryRequired] = useState(\n  data.categoryRequired || \"not_required\" // required | not_required\n);\n\nconst [loadingSaveSettings, setLoadingSaveSettings] = useState(false);\n\nconst InputContainer = ({ heading, description, children }) => {\n  return (\n    <div className=\"d-flex flex-column gap-1 gap-sm-2 w-2/3\">\n      <b className=\"h6 mb-0\">{heading}</b>\n      {description && (\n        <div className=\"text-muted w-100 text-sm\">{description}</div>\n      )}\n      {children}\n    </div>\n  );\n};\n\nconst TitleComponent = useMemo(() => {\n  return (\n    <Widget\n      src=\"devhub.near/widget/devhub.components.molecule.Input\"\n      props={{\n        className: \"flex-grow-1\",\n        value: title,\n        placeholder: \"Title\",\n        onChange: (e) => setTitle(e.target.value),\n        skipPaddingGap: true,\n        inputProps: {\n          max: 40,\n          required: true,\n          name: \"title\",\n          className:\n            \"block w-full rounded-md border-0 px-1 py-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6\",\n        },\n      }}\n    />\n  );\n}, []);\n\nconst SubtitleComponent = useMemo(() => {\n  return (\n    <Widget\n      src=\"devhub.near/widget/devhub.components.molecule.Input\"\n      props={{\n        className: \"flex-grow-1\",\n        value: subtitle,\n        placeholder: \"Subtitle\",\n        onChange: (e) => setSubtitle(e.target.value),\n        skipPaddingGap: true,\n        inputProps: {\n          required: false,\n          max: 80,\n          name: \"subtitle\",\n          className:\n            \"block w-full rounded-md border-0 px-1 py-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6\",\n        },\n      }}\n    />\n  );\n}, []);\n\nconst AuthorEnabledSwitchComponent = useMemo(() => {\n  return (\n    <Widget\n      src=\"devhub.near/widget/devhub.components.molecule.Switch\"\n      props={{\n        className: \"w-32 shadow-none\",\n        currentValue: authorEnabled,\n        key: \"authorEnabled\",\n        onChange: (e) => setAuthorEnabled(e.target.value),\n        options: [\n          { label: \"Enabled\", value: \"enabled\" },\n          { label: \"Disabled\", value: \"disabled\" },\n        ],\n        title: \"Author Enabled\",\n      }}\n    />\n  );\n}, [authorEnabled]);\n\nconst SearchSwitchComponent = useMemo(() => {\n  return (\n    <Widget\n      src=\"devhub.near/widget/devhub.components.molecule.Switch\"\n      props={{\n        className: \"w-32 shadow-none\",\n\n        currentValue: searchEnabled,\n        key: \"search\",\n        onChange: (e) => setSearchEnabled(e.target.value),\n        options: [\n          { label: \"Enabled\", value: \"enabled\" },\n          { label: \"Disabled\", value: \"disabled\" },\n        ],\n        title: \"Search\",\n      }}\n    />\n  );\n}, [searchEnabled]);\n\nconst OrderBySwitchComponent = useMemo(() => {\n  return (\n    <Widget\n      src=\"devhub.near/widget/devhub.components.molecule.Switch\"\n      props={{\n        className: \"shadow-none\",\n        style: { width: \"24rem\" },\n        currentValue: orderBy,\n        key: \"orderBy\",\n        onChange: (e) => setOrderBy(e.target.value),\n        options: [\n          { label: \"Newest to oldest\", value: \"timedesc\" },\n          { label: \"Oldest to newest\", value: \"timeasc\" },\n          { label: \"Alphabetical\", value: \"alpha\" },\n        ],\n        title: \"Order by\",\n      }}\n    />\n  );\n}, [orderBy]);\n\nconst PostsPerPageComponent = (\n  <div className=\"col-lg-6 mb-2\">\n    <input\n      className=\"block w-full rounded-md border-0 px-1 py-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6\"\n      data-testid=\"post-per-page-input\"\n      type=\"number\"\n      value={parseInt(postPerPage) > 0 ? postPerPage : \"\"}\n      min={0}\n      onChange={(event) => {\n        console.log(\"onChange\", event.target.value.toString());\n        setPostPerPage(event.target.value.toString().replace(/[a-zA-Z]/g, \"\"));\n      }}\n    />\n  </div>\n);\n\nconst CategoriesEnabledComponent = useMemo(() => {\n  return (\n    <Widget\n      src=\"devhub.near/widget/devhub.components.molecule.Switch\"\n      props={{\n        className: \"w-32 shadow-none\",\n        currentValue: categoriesEnabled,\n        key: \"categories\",\n        onChange: (e) => switchCategoryEnabled(e.target.value),\n        options: [\n          { label: \"Enabled\", value: \"enabled\" },\n          { label: \"Disabled\", value: \"disabled\" },\n        ],\n\n        title: \"Categories\",\n      }}\n    />\n  );\n}, [categoriesEnabled]);\n\nconst CategoryRequiredSwitchComponent = useMemo(() => {\n  return (\n    <Widget\n      src=\"devhub.near/widget/devhub.components.molecule.Switch\"\n      props={{\n        className: \"shadow-none\",\n        style: { width: \"12rem\" },\n        currentValue: categoryRequired,\n        key: \"categoryRequired\",\n        onChange: (e) => setCategoryRequired(e.target.value),\n        options: [\n          { label: \"Required\", value: \"required\" },\n          { label: \"Not Required\", value: \"not_required\" },\n        ],\n        title: \"Category Required\",\n      }}\n    />\n  );\n}, [categoryRequired]);\n\nconst onChangeCategories = (_labels) => {\n  _labels = _labels.map((o) => ({\n    category: o.category, // labelKey == category\n    value: normalize(o.category),\n  }));\n  // This is for the Typeahead\n  setSelected(_labels);\n};\n\nconst CategoriesEditor = useMemo(() => {\n  const examples = [\"News\", \"Guide\", \"Reference\"];\n  const options = examples\n    .map((category) => {\n      return { category };\n    })\n    .filter((o) => !selected.includes(o.category));\n\n  return (\n    <Typeahead\n      multiple\n      labelKey=\"category\"\n      onChange={onChangeCategories}\n      options={options}\n      placeholder=\"News, Guide, Reference, etc.\"\n      selected={selected}\n      positionFixed\n      caseSensitive={true}\n      allowNew={(results, props) => {\n        // Don't allow more than 10 categories\n        return props.selected.length < 10;\n      }}\n    />\n  );\n}, [selected]);\n\nconst FormContainer = styled.div`\n  & > *:not(:last-child) {\n    margin-bottom: 2rem;\n  }\n`;\n\nconst handleUpdate = () => {\n  if (\n    filteredCategories.some(\n      (category) => !selected.map((e) => e.value).includes(category.value)\n    )\n  ) {\n    setModalVisible(true);\n    return;\n  }\n  handleOnSubmit();\n};\n\n/**\n * If the settings are empty we use default values for blog settings\n * These default values should reflect in the configurator / viewer and settings page\n */\nconst handleOnSubmit = () => {\n  setLoadingSaveSettings(true);\n  if (categoriesEnabled === \"enabled\" && categories.length === 0) {\n    return setLoadingSaveSettings(false);\n  }\n\n  const cEnabled = categoriesEnabled || \"disabled\";\n  // If categories are enabled there must be at least 1 category\n  const cats =\n    cEnabled == \"enabled\" && selected && selected.length > 0 ? selected : [];\n  // If categories are empty they can not be required\n  const req = cats.length ? categoryRequired : \"not_required\";\n\n  onSubmit({\n    title: title || \"\",\n    subtitle: subtitle || \"\",\n    authorEnabled: authorEnabled || \"disabled\", // 'enabled', 'disabled'\n    searchEnabled: searchEnabled || \"disabled\", // 'enabled', 'disabled'\n    orderBy: orderBy || \"timedesc\", // timedesc, timeasc, alpha\n    categoriesEnabled: cEnabled, // 'enabled', 'disabled'\n    categories: cats,\n    categoryRequired: req,\n    // minimum of 5 posts per page\n    postPerPage: postPerPage < 5 ? 5 : postPerPage,\n  });\n  setTimeout(() => {\n    setLoadingSaveSettings(false);\n  }, 2000);\n};\n\nconst categoriesIsInvalid = () =>\n  categoriesEnabled === \"enabled\" && categories.length === 0;\n\nconst submitDisabled = () => {\n  return categoriesIsInvalid() || !title || !subtitle || loadingSaveSettings;\n};\n\nreturn (\n  <div>\n    <FormContainer>\n      <div>\n        <div className=\"d-flex justify-content-between\">\n          <div>\n            <h2 className=\"text-xl leading-7 text-gray-600\">Blog List Page</h2>\n            <p className=\"mt-1 text-sm leading-6 text-gray-500\">\n              This information will be displayed publicly.\n            </p>\n          </div>\n          <div className=\"d-flex gap-1 align-items-center justify-content-end\">\n            <Widget\n              src={`devhub.near/widget/devhub.components.molecule.Button`}\n              props={{\n                classNames: {\n                  root: \"d-flex text-muted fw-bold btn-outline shadow-none border-0 btn-sm\",\n                },\n                label: \"Cancel\",\n                onClick: onHideSettings,\n              }}\n            />\n            <Widget\n              src={\n                \"devhub.near/widget/devhub.components.molecule.BlogControl\"\n              }\n              props={{\n                title: \"Save Settings\",\n                onClick: handleUpdate,\n                testId: \"save-settings-button\",\n                disabled: submitDisabled(),\n                loading: loadingSaveSettings,\n                icon: \"bi-plus-circle-fill\",\n              }}\n            />\n          </div>\n        </div>\n        <div className=\"w-100 border-b\"></div>\n      </div>\n\n      <InputContainer\n        heading=\"Title\"\n        description=\"Highlight the essence of your blog in a few words. This will appear on the top of your blog page.\"\n      >\n        {TitleComponent}\n      </InputContainer>\n      <InputContainer\n        heading=\"Subtitle\"\n        description=\"Provide a brief subtitle for the blog.\"\n      >\n        {SubtitleComponent}\n      </InputContainer>\n      <InputContainer\n        heading=\"Author visible\"\n        description=\"Show the author of each blog post.\"\n      >\n        {AuthorEnabledSwitchComponent}\n      </InputContainer>\n      <InputContainer\n        heading=\"Search\"\n        description=\"Enable or disable the user to search for blog posts.\"\n      >\n        {SearchSwitchComponent}\n      </InputContainer>\n      <InputContainer\n        heading=\"Order by\"\n        description=\"Blog post sorting order (e.g. Newest to oldest, Oldest to newest,\n          Alphabetical). Note: Time sorting is based on the visible publish date.\"\n      >\n        {OrderBySwitchComponent}\n      </InputContainer>\n      <InputContainer\n        heading=\"Number of blogs per page (Numbers Only)\"\n        description=\"Number of visible blog cards displayed per blog tab. Minimum of 5 posts per page. It is recommended to be a multiple of 3.\"\n      >\n        {PostsPerPageComponent}\n      </InputContainer>\n      <div>\n        <h2 className=\"text-xl leading-7 text-gray-600\">Blog Post Fields</h2>\n        <p className=\"mt-1 text-sm leading-6 text-gray-500\">\n          The blog and preview card, both display the category when it is\n          enabled.\n        </p>\n        <div className=\"w-100 border-b\"></div>\n      </div>\n      <InputContainer\n        heading=\"Enable categories\"\n        description=\"Enable or disable categories on blogs. You must have 1 category to enable this field.\"\n      >\n        {CategoriesEnabledComponent}\n      </InputContainer>\n      {categoriesEnabled === \"disabled\" ? (\n        <></>\n      ) : (\n        <>\n          <InputContainer\n            heading=\"Manage categories\"\n            description=\"Add/edit/delete up to 10 custom category options.\"\n          >\n            {CategoriesEditor}\n          </InputContainer>\n          <InputContainer\n            heading=\"Category Required\"\n            description=\"Decide if to make this field required for every blog post. You must have 1 category to require this field.\"\n          >\n            {CategoryRequiredSwitchComponent}\n          </InputContainer>\n        </>\n      )}\n    </FormContainer>\n    <Widget\n      src={\n        \"devhub.near/widget/devhub.entity.addon.blogv2.editor.ConfirmModal\"\n      }\n      props={{\n        isOpen: isConfirmModalOpen,\n        onCancelClick: () => setModalVisible(false),\n        onConfirmClick: () => {\n          setModalVisible(false);\n          handleOnSubmit();\n        },\n        title: \"Are you sure you want to make changes to categories?\",\n        content: \"All previous blogs with removed categories will be effected.\",\n        confirmLabel: \"I understand\",\n        cancelLabel: \"Cancel\",\n      }}\n    />\n    <div className=\"d-flex gap-1 align-items-center justify-content-end mt-3\">\n      <Widget\n        src={`devhub.near/widget/devhub.components.molecule.Button`}\n        props={{\n          classNames: {\n            root: \"d-flex text-muted fw-bold btn-outline shadow-none border-0 btn-sm\",\n          },\n          label: \"Cancel\",\n          onClick: onHideSettings,\n        }}\n      />\n      <Widget\n        src={\"devhub.near/widget/devhub.components.molecule.BlogControl\"}\n        props={{\n          title: \"Save Settings\",\n          onClick: handleUpdate,\n          testId: \"save-settings-button\",\n          disabled: submitDisabled(),\n          icon: \"bi-plus-circle-fill\",\n          loading: loadingSaveSettings,\n        }}\n      />\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/devhub.near/widget/devhub.entity.addon.blogv2.editor.BlogPostSettings", "fact_widget_deployments_id": "4dff11a6b10ea6b272928be04d1a5458", "inserted_timestamp": "2024-06-27T16:54:28.525Z", "modified_timestamp": "2024-06-27T16:54:28.525Z", "__row_index": 1}