{"tx_hash": "8YXXURA43BirXbRxkLJLpLWnmmshKKPJbSY8bViZJuFk", "action_id_social": "6GkDN6KqGcRfznoB8ypsm8reixqjyWm24hNgUqSXG8xs-0-widget", "block_id": 95842897, "block_timestamp": "2023-07-06T14:11:18.176Z", "signer_id": "sking.near", "widget_name": "EasyPoll.Polls", "source_code": "const indexVersion = props.indexVersion ?? \"3.2.0\";\nconst filterByUser = props.filterByUser;\nconst skipHumanVericationFor = props.skipHumanVericationFor;\nconst onlyVerifiedHumans = props.onlyVerifiedHumans ?? true;\nconst blackList = props.blackList;\nconst tabs = props.tabs;\n\nState.init({\n  polls: {},\n});\n\nconst widgetOwner = \"sking.near\";\n\nconst getFirstSBTToken = (accountId) => {\n  const view = Near.view(\"registry.i-am-human.near\", \"sbt_tokens_by_owner\", {\n    account: accountId,\n    issuer: \"fractal.i-am-human.near\",\n  });\n  return view?.[0]?.[1]?.[0];\n};\n\nconst shouldDisplayUserQuestions = (accountId) => {\n  if (blackList) {\n    return !blackList.includes(accountId);\n  }\n  if (onlyVerifiedHumans) {\n    return (\n      getFirstSBTToken(accountId) !== undefined ||\n      skipHumanVericationFor.includes(accountId)\n    );\n  }\n  return true;\n};\n\nlet keys = `*/easypoll-${indexVersion}/poll/*`;\n\nif (filterByUser) {\n  keys = filterByUser.map((v) => {\n    return `${v}/easypoll-${indexVersion}/poll/*`;\n  });\n}\n\nlet results = Social.keys(keys, \"final\", {\n  return_type: \"BlockHeight\",\n});\nif (!results) {\n  return \"Loading...\";\n}\n\nconst polls_keys = [];\n\n// TODO: should cache the logic bellow in state, polls_keys can be huge\nObject.keys(results).forEach((accountId) => {\n  return Object.keys(\n    results[accountId][`easypoll-${indexVersion}`][\"poll\"]\n  ).forEach((pollId) => {\n    polls_keys.push({\n      accountId,\n      pollId,\n      blockHeight:\n        results[accountId][`easypoll-${indexVersion}`][\"poll\"][pollId],\n    });\n  });\n});\npolls_keys = polls_keys.sort((a, b) => b.blockHeight - a.blockHeight); // desc\npolls_keys = polls_keys.filter((p) => shouldDisplayUserQuestions(p.accountId));\n\nreturn (\n  <>\n    <div className=\"d-flex flex-column gap-4 mb-3\">\n      {polls_keys.map((p) => {\n        const src = `${p.accountId}/easypoll-${indexVersion}/poll/${p.pollId}`;\n        return (\n          <Widget\n            src={`${widgetOwner}/widget/EasyPoll.PollCard`}\n            props={{\n              src: src,\n              blockHeight: p.blockHeight,\n              href: tabs.VIEW_POLL.href(src, p.blockHeight),\n              editHref: tabs.EDIT_POLL.href(src, p.blockHeight),\n              deleteHref: tabs.DELETE_POLL.href(src, p.blockHeight),\n              indexVersion,\n            }}\n          />\n        );\n      })}\n    </div>\n    {polls_keys.length < 1 && <div>Looks like there are no polls to show.</div>}\n    {/* TODO: NEED PAGINATION */}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/sking.near/widget/EasyPoll.Polls", "fact_widget_deployments_id": "4c1ce3f6365761b977e1d2b642ea0327", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 3}