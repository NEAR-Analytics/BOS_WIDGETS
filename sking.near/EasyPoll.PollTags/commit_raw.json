{"tx_hash": "5grcCLfb4xJpcNKWBTUQJQsBRF2RT2XSj5FS18R8xuH4", "action_id_social": "5P49idHsiQnY5kBCQCSDdjDUFDBtv4xnTUp7DUtVxtta-0-widget", "block_id": 95656093, "block_timestamp": "2023-07-04T03:54:53.949Z", "signer_id": "sking.near", "widget_name": "EasyPoll.PollTags", "source_code": "const indexVersion = props.indexVersion ?? \"3.2.0\";\nconst poll = props.poll;\nconst showVoteButton = props.showVoteButton ?? true;\n\nState.init({\n  answers: {},\n  alreadyVoted: undefined,\n});\n\nfunction isActive(poll) {\n  return (\n    poll.value.startTimestamp < Date.now() &&\n    Date.now() < poll.value.endTimestamp\n  );\n}\n\nfunction isUpcoming(poll) {\n  return poll.value.startTimestamp > Date.now();\n}\n\nfunction getValidAnswersQtyFromQuestion(questionBlockHeight) {\n  const answers = Social.index(\"poll_question\", `answer-v${indexVersion}`);\n  console.log(answers, indexVersion);\n\n  if (JSON.stringify(answers) != JSON.stringify(state.answers)) {\n    State.update({ answers: answers });\n  }\n\n  if (!answers) {\n    return \"Loading\";\n  }\n  const answersFromThisQuestion = answers.filter(\n    (a) => a.value.pollBlockHeight == questionBlockHeight\n  );\n  const usersWithAnswers = answersFromThisQuestion.map((a) => a.accountId);\n\n  State.update({\n    alreadyVoted:\n      context.accountId && usersWithAnswers.includes(context.accountId),\n  });\n\n  console.log(answersFromThisQuestion, questionBlockHeight);\n\n  return answersFromThisQuestion.length;\n}\n\nconst Label = styled.div`\n  font-size: 13px;\n  font-weight: 500;\n  color: #000;\n  background-color: #ebedee;\n  padding: 4px 10px;\n  border-radius: 6px;\n  margin-top: auto;\n  margin-bottom: auto;\n`;\n\nconst VoteButton = styled.button`\n  font-size: 15px;\n  font-weight: 600;\n  padding: 6px 18px;\n  border-radius: 6px;\n  border: none;\n  transition: 200ms ease;\n  width: 100%;\n\n  @media screen and (min-width: 769px) {\n    width: auto;\n  }\n\n  i {\n    margin-right: 4px;\n  }\n\n  ${({ voted, view }) => {\n    if (voted) {\n      return `\n        color: #239F28;\n        background-color: #ddefeb;\n        `;\n    }\n    if (view) {\n      return `\n        color: #000;\n        background-color: #ffd50d;\n        `;\n    }\n    return `\n    color: #fff;\n    background-color: #4f46e5;\n    background: linear-gradient(90deg, #9333ea 0%, #4f46e5 100%);\n    :hover {\n        background: linear-gradient(90deg, #792ac0 0%, #423abd 100%);\n    }\n    :active {\n        background: linear-gradient(90deg, #5d2193 0%, #2f2a87 100%);\n    }\n    `;\n  }}\n`;\n\nreturn (\n  <div className=\"d-flex gap-3 flex-wrap\">\n    <Label>{getValidAnswersQtyFromQuestion(poll.blockHeight)} votes</Label>\n    <Label>\n      {Date.now() < poll.value.startTimestamp ||\n      (Date.now() > poll.value.startTimestamp &&\n        Date.now() < poll.value.endTimestamp) ? (\n        <span>Ends in</span>\n      ) : (\n        <span>Ended</span>\n      )}\n      <Widget\n        src={`silkking.near/widget/timeAgo`}\n        props={{\n          reduced: true,\n          timeInFuture: poll.value.endTimestamp,\n        }}\n      />\n    </Label>\n    <Label\n      style={{\n        backgroundColor: isUpcoming(poll)\n          ? \"#FFF3B4\"\n          : isActive(poll)\n          ? \"#D9FCEF\"\n          : \"#FFE5E5\",\n        color: isUpcoming(poll)\n          ? \"#FFC905\"\n          : isActive(poll)\n          ? \"#00B37D\"\n          : \"#FF4747\",\n      }}\n    >\n      {isUpcoming(poll) ? \"Upcoming\" : isActive(poll) ? \"Active\" : \"Closed\"}\n    </Label>\n\n    {!showVoteButton ? null : isUpcoming(poll) || !isActive(poll) ? (\n      <VoteButton className=\"ms-auto\" view={true}>\n        <i className=\"bi bi-eye-fill\"></i>\n        View\n      </VoteButton>\n    ) : state.alreadyVoted === true ? (\n      <VoteButton className=\"ms-auto\" voted={true}>\n        <i className=\"bi bi-check-lg\"></i>\n        Voted\n      </VoteButton>\n    ) : state.alreadyVoted === false ? (\n      <VoteButton className=\"ms-auto\">\n        <i className=\"bi bi-ui-checks-grid\"></i>\n        Vote\n      </VoteButton>\n    ) : null}\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/sking.near/widget/EasyPoll.PollTags", "fact_widget_deployments_id": "0c085a3263f769b7c5fe198eb67670d2", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}