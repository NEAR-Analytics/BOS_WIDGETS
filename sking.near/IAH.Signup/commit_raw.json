{"tx_hash": "2n5yDQXpWX3pmNR7fgEAMry7CDVhPcdmvHeLkGhQRz9y", "action_id_social": "EuFR9j3xScXRSPMbpcBow6pSKjrTa7ub7vRwS6PmAh8S-0-widget", "block_id": 92124573, "block_timestamp": "2023-05-18T06:34:34.897Z", "signer_id": "sking.near", "widget_name": "IAH.Signup", "source_code": "const referrer = props.referrer ?? Storage.privateGet(\"IAH.Signup.Referrer\");\nconst accountId = props.accountId ?? context.accountId;\nconst NFT_CONTRACT = \"dev-1684341574557-24038853630501\";\nconst IAH_CONTRACT = \"registry-1.i-am-human.testnet\";\nconst GD_CONTRACT = \"gooddollar-v1.i-am-human.testnet\";\nconst WIDGET_AUTHOR = \"sking.near\";\n\nif (!accountId) {\n  // not logged in\n  return <Widget src={`${WIDGET_AUTHOR}/widget/IAH.Signup.Guest`} />;\n}\n\nState.init({\n  tokens: undefined,\n});\n\nStorage.privateSet(\"IAH.Signup.Referrer\", referrer);\n\nconst hasBadge = Near.view(\n  NFT_CONTRACT,\n  \"already_verified\",\n  {\n    account_id: accountId,\n  },\n  undefined,\n  false\n);\nif (hasBadge === null) return \"Loading...\";\n\nconsole.log(\"hasBadge\", hasBadge);\n\nif (hasBadge) {\n  // already claimed his nft badge\n  return <Widget src={`${WIDGET_AUTHOR}/widget/IAH.Signup.Complete`} />;\n}\n\nconst tokens = Near.view(\n  IAH_CONTRACT,\n  \"sbt_tokens_by_owner\",\n  {\n    account: accountId,\n  },\n  undefined,\n  false\n);\nif (tokens === null) return \"Loading...\";\n\n\nif (isVerified) {\n  // is verified on IAH but didn't claim his nft badge yet\n  return (\n    <Widget\n      src={`${WIDGET_AUTHOR}/widget/IAH.Signup.Verified`}\n      props={{\n        accountId,\n        referrerId: referrer ?? \"sking.near\",\n        NFT_CONTRACT,\n      }}\n    />\n  );\n}\n\nreturn (\n  <Widget\n    src={`${WIDGET_AUTHOR}/widget/IAH.Signup.Invited`}\n    props={{\n      accountId,\n      referrerId: referrer ?? \"sking.near\",\n      NFT_CONTRACT,\n      tokens,\n      GD_CONTRACT,\n    }}\n  />\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/sking.near/widget/IAH.Signup", "fact_widget_deployments_id": "f2e34413d76959caa1e697621c950c7e", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 3}