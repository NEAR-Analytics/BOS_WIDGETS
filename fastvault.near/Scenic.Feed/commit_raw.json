{"tx_hash": "7AnNCuQydJg5Y3t9VZhuSHkUQBvLjMEo498HrJ1vZsBA", "action_id_social": "Gm1LHfCRg9U5qYrWoVHWxkt5MpznrQ6JtZX1an6p45Y-0-widget", "block_id": 107462851, "block_timestamp": "2023-12-08T20:30:37.608Z", "signer_id": "fastvault.near", "widget_name": "Scenic.Feed", "source_code": "const { newSecretKey, decryptObject } = VM.require(\n  \"fastvault.near/widget/module.crypto\"\n);\n\nconst supportedFileTypes = props.supportedFileTypes ?? [\n  \"image/png\",\n  \"image/jpg\",\n  \"image/jpeg\",\n  \"image/gif\",\n  \"image/bmp\",\n];\n\nconst index = {\n  action: \"fastvault_experimental\",\n  key: \"add\",\n  options: {\n    limit: 10,\n    order: \"desc\",\n    accountId: context.accountId,\n  },\n};\n\nconst password = props.password;\n\nconst [storageSk, _] = useState(() => {\n  if (decryptSk) {\n    // decryptSk is available. use it instead of recovering\n    if (password) {\n      console.log(\"Utilizing decryptSk over password\");\n    }\n    return decryptSk;\n  }\n  const localSk = Storage.privateGet(\"storage_secret\");\n  if (localSk && !password) {\n    return localSk;\n  }\n  const sk = newSecretKey(context.accountId, password);\n  console.log(\"recovered decryption key from local storage\");\n  Storage.privateSet(\"storage_secret\", sk);\n  return sk;\n});\n\nconst renderItem = (a) => {\n  if (!a.value.nonce || !a.value.ciphertext) {\n    console.log(\"invalid file metadata to be decrypted\", a);\n    return acc;\n  }\n\n  const metadata = decryptObject(\n    new Uint8Array(a.value.nonce),\n    new Uint8Array(a.value.ciphertext),\n    storageSk\n  );\n  if (!metadata) {\n    if (props.debug) {\n      console.log(\"Feed: could not decrypt metadata\", a);\n    }\n    return false;\n  }\n\n  if (supportedFileTypes.indexOf(metadata.filetype) === -1) {\n    if (props.debug) {\n      console.log(\"Feed: unsupported file type\", metadata.filetype);\n    }\n    return false;\n  }\n\n  return (\n    <Widget\n      key={JSON.stringify(a)}\n      src=\"fastvault.near/widget/Scenic.Post\"\n      props={{\n        password,\n        image: {\n          ipfs_cid: metadata.cid,\n        },\n      }}\n    />\n  );\n};\n\nconst LoadMore = styled.div`\n  @media (min-width: 576px) {\n    max-width: 288px;\n  }\n  display: flex;\n  justify-content: center;\n  align-items: center;\n`;\n\nreturn (\n  <Widget\n    src=\"mob.near/widget/FilteredIndexFeed\"\n    props={{\n      index,\n      renderItem,\n      loadMoreText: (\n        <LoadMore className=\"text-bg-light ratio ratio-1x1\">Load More</LoadMore>\n      ),\n      ...{\n        headerElement: props.headerElement,\n        footerElement: props.footerElement,\n      },\n    }}\n  />\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/fastvault.near/widget/Scenic.Feed", "fact_widget_deployments_id": "4b536e50987b9d113c6e55abacd63a7a", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}