{"tx_hash": "EPfV6HSTse4paLUCHj4tEjnyg1bZXvSML4Re5LgqFEjE", "action_id_social": "4wi3y3udU87erPXZetbgdrTEPvGhPA5LvpfeaipPUddZ-0-widget", "block_id": 101751166, "block_timestamp": "2023-09-23T05:00:21.244Z", "signer_id": "7649ed19fe15dead3bb479bbbf3acd3a2b337eead0999673d20b9935e4d60d8e", "widget_name": "WeatherDNFT", "source_code": "let accountId = context.accountId;\nconst size = \"3em\";\n\nconst contractId = \"nft.genadrop.near\";\n\nif (!contractId) {\n  return `Missing prop \"contractId\"`;\n}\n\nif (!accountId) {\n  return `Missing prop \"accountId\"`;\n}\n\nconst nfts =\n  props.nfts ||\n  Near.view(contractId, \"nft_tokens_for_owner\", {\n    account_id: accountId,\n    from_index: \"0\",\n    limit: 200,\n  });\n\nif (!nfts) {\n  return \"\";\n}\n\nconst Card = styled.div`\n  padding: 1em;\n  border: 1px solid #ccc;\n  gap: 2em;\n  margin: 10px auto;\n  border-radius: 0.7em;\n`;\n\nconst SmallContainer = styled.div`\n  display: grid;\n  grid-template-columns: 1fr 1fr 1fr;\n`;\n\nconst CenteredDiv = styled.div`\n  display: flex;\n  flex-direction: column;\n  border: 1px solid #828282;\n\n  border-radius: 10px;\n  padding: 10px;\n  margin: 10px;\n  text-align: center;\n  & > *:not(:last-child) {\n    margin-bottom: 10px;\n  }\n\n  transition: background-color 0.3s ease;\n  &:hover {\n    background-color: #6ce89f; /* Change background color to gray on hover */\n  }\n`;\n\nconst StyledImage = styled.img`\n  object-fit: cover;\n  max-width: 240px;\n  max-height: 240px;\n  overflow-wrap: break-word;\n  border-radius: 10px; /* Rounded corners, you can adjust the value */\n`;\n\nconst FlexColumnContainer = styled.div`\n  display: flex;\n  border-bottom: 1px solid #c5c5c5;\n  flex-direction: column;\n  align-items: center;\n  text-align: center;\n`;\n\nreturn (\n  <Card>\n    <h4>\ud83c\udf08 Weather dNFT</h4>\n\n    <SmallContainer>\n      {nfts\n        .filter((nft) => {\n          const metadata = nft.metadata;\n          if (metadata && metadata.description) {\n            const words = metadata.description.split(\" \");\n            return (\n              words[0] === \"dnft:\" &&\n              words[1] === \"Weather:\" &&\n              words[2] &&\n              words[2] !== \"New\" // New York error => fix => stopgap!\n            );\n          }\n          return false;\n        })\n        .map((nft) => {\n          const metadata = nft.metadata;\n\n          const description = metadata.description;\n          const words = metadata.description.split(\" \");\n          const weatherIndex = words.indexOf(\"Weather:\");\n          const title = metadata.title;\n\n          const locationName =\n            weatherIndex !== -1\n              ? words[weatherIndex + 1].replace(/([a-z])([A-Z])/g, \"$1 $2\")\n              : \"\";\n\n          const resWeather = fetch(\n            `https://api.openweathermap.org/data/2.5/weather?q=${locationName}&appid=0d898a9e30a80a233ce8882b12be2031`\n          );\n          const weatherInfo = resWeather.body;\n          const locationId = weatherInfo.id;\n\n          const weatherState = weatherInfo.weather[0].main;\n          const weatherDesc = weatherInfo.main;\n\n          const metadataStart = description.indexOf(\"{\");\n          const metadataString = description.slice(metadataStart);\n\n          const showMetadata = JSON.parse(metadataString);\n\n          const cid1 = showMetadata.img1.cid;\n          const cid2 = showMetadata.img2.cid;\n          const cid3 = showMetadata.img3.cid;\n\n          const text1 = showMetadata.text1;\n          const text2 = showMetadata.text2;\n          const text3 = showMetadata.text3;\n\n          const num1 = showMetadata.num1;\n          const num2 = showMetadata.num2;\n          const num3 = showMetadata.num3;\n\n          return (\n            <a\n              className=\"text-decoration-none text-black\"\n              href={`https://openweathermap.org/city/${locationId}`}\n            >\n              <CenteredDiv key={nft.token_id}>\n                {weatherState === \"Clear\" ? (\n                  <FlexColumnContainer>\n                    <StyledImage\n                      src={`https://ipfs.near.social/ipfs/${cid1}`}\n                      alt=\"uploaded\"\n                    />\n                    <div className=\"mt-2\">{locationName}</div>\n                    <h3>{text1}</h3>\n                    <div className=\"mb-2\">{showMetadata.description}</div>\n                  </FlexColumnContainer>\n                ) : weatherState === \"Rain\" ? (\n                  <FlexColumnContainer>\n                    <StyledImage\n                      src={`https://ipfs.near.social/ipfs/${cid2}`}\n                      alt=\"uploaded\"\n                    />\n                    <div className=\"mt-2\">{locationName}</div>\n                    <h3>{text2}</h3>\n                    <div>{showMetadata.description}</div>\n                  </FlexColumnContainer>\n                ) : weatherState === \"Clouds\" ? (\n                  <FlexColumnContainer>\n                    <StyledImage\n                      src={`https://ipfs.near.social/ipfs/${cid3}`}\n                      alt=\"uploaded\"\n                    />\n                    <div className=\"mt-2\">{locationName}</div>\n                    <h3>{text3}</h3>\n                    <div className=\"mb-2\">{showMetadata.description}</div>\n                  </FlexColumnContainer>\n                ) : (\n                  <FlexColumnContainer>\n                    <Widget\n                      src=\"mob.near/widget/NftImage\"\n                      props={{\n                        nft: {\n                          tokenId: nft.token_id,\n                          contractId,\n                        },\n                        style: {\n                          width: size,\n                          height: size,\n                          objectFit: \"cover\",\n                          minWidth: 270,\n                          minHeight: 250,\n                          maxWidth: size,\n                          maxHeight: size,\n                          overflowWrap: \"break-word\",\n                        },\n                        thumbnail: \"thumbnail\",\n                        className: \"rounded\",\n                        fallbackUrl:\n                          \"https://ipfs.near.social/ipfs/bafkreihdiy3ec4epkkx7wc4wevssruen6b7f3oep5ylicnpnyyqzayvcry\",\n                        alt: `NFT ${contractId} ${nft.token_id}`,\n                      }}\n                    />\n                    <div className=\"mt-2\">{locationName}</div>\n                    <h3>{title}</h3>\n                    <div className=\"mb-2\">{showMetadata.description}</div>\n                  </FlexColumnContainer>\n                )}\n\n                <h3>\n                  {weatherState === \"Clear\"\n                    ? \"\u2600\ufe0f\"\n                    : weatherState === \"Rain\"\n                    ? \"\ud83c\udf27\ufe0f\"\n                    : weatherState === \"Clouds\"\n                    ? \"\u2601\ufe0f\"\n                    : \"\"}\n                </h3>\n\n                <span>{(weatherDesc.temp - 273.15).toFixed(2)}\u00b0 C</span>\n                <span>Humidity : {weatherDesc.humidity}%</span>\n                <span>Pressure : {weatherDesc.pressure}hPa</span>\n              </CenteredDiv>\n            </a>\n          );\n        })}\n    </SmallContainer>\n  </Card>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/7649ed19fe15dead3bb479bbbf3acd3a2b337eead0999673d20b9935e4d60d8e/widget/WeatherDNFT", "fact_widget_deployments_id": "232e70865131162f9cf8e249bc05ac00", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}