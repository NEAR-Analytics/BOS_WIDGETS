{"tx_hash": "9DXRkVf4cqqSanFXDLFGwuwaA1WEjYJb1hiYrvB1EpSy", "action_id_social": "CehoPKCpnJ1VJVf8g6wwbtJoSdWNot4EXDGJZyk4JY5h-0-widget", "block_id": 101307560, "block_timestamp": "2023-09-17T06:01:49.417Z", "signer_id": "7649ed19fe15dead3bb479bbbf3acd3a2b337eead0999673d20b9935e4d60d8e", "widget_name": "TSocialPosts", "source_code": "const account_id = context.accountId ?? props.accountId;\n\nState.init({\n  isInit: false,\n  posts: [],\n});\n\nconst getMyPosts = () => {\n  asyncFetch(\n    \"https://queryapi-hasura-graphql-24ktefolwq-ew.a.run.app/v1/graphql\",\n    {\n      method: \"POST\",\n      headers: { \"x-hasura-role\": \"nearpavel_near\" },\n      body: JSON.stringify({\n        query: `query MyPosts {\n          nearpavel_near_social_posts_posts(where: {account_id: {_eq: \"${account_id}\"}}, order_by: {block_timestamp: desc}) {\n          account_id\n          block_height\n          block_timestamp\n          content\n          receipt_id\n        }\n      }`,\n      }),\n    }\n  ).then((postRes) => {\n    if (postRes.body.errors === undefined) {\n      State.update({\n        isInit: true,\n        posts: postRes.body.data.nearpavel_near_social_posts_posts,\n      });\n    }\n  });\n};\n\nif (state.isInit === false) {\n  getMyPosts();\n}\n\nconst Post = state.posts.map((post, index) => {\n  const content = JSON.parse(post.content);\n  const block_timestamp = new Date(post.block_timestamp / 1000000);\n  const { year, month, day, hours, minutes, seconds } = {\n    year: block_timestamp.getFullYear(),\n    month: (block_timestamp.getMonth() + 1).toString().padStart(2, \"0\"),\n    day: block_timestamp.getDate().toString().padStart(2, \"0\"),\n    hours: block_timestamp.getHours().toString().padStart(2, \"0\"),\n    minutes: block_timestamp.getMinutes().toString().padStart(2, \"0\"),\n  };\n\n  return (\n    <>\n      <div style={{ padding: \"15px 20px\" }}>\n        <div style={{ display: \"flex\", justifyContent: \"space-between\" }}>\n          <h2>No.{state.posts.length - index}</h2>\n          <h3>\n            {year}-{month}-{day} {hours}:{minutes}\n          </h3>\n        </div>\n        <div\n          style={{\n            padding: \"15px 15px 0 15px\",\n            border: \"solid 1px #bbb\",\n            borderRadius: \"3px\",\n            borderWidth: \"0 0 0 4px\",\n          }}\n        >\n          <Markdown text={content.text} />\n        </div>\n      </div>\n      <hr />\n    </>\n  );\n});\n\nreturn (\n  <div>\n    {state.isInit === false ? (\n      <h1>Load Your Posts...</h1>\n    ) : (\n      <div>\n        <div style={{ display: \"flex\", justifyContent: \"space-between\" }}>\n          <h1>Posts: {Post.length}</h1>\n          <button onClick={getMyPosts}>Load Posts</button>\n        </div>\n        <hr />\n        {Post.length === 0 ? <h2>Can not found your post</h2> : Post}\n      </div>\n    )}\n  </div>\n);\n", "metadata": {}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/7649ed19fe15dead3bb479bbbf3acd3a2b337eead0999673d20b9935e4d60d8e/widget/TSocialPosts", "fact_widget_deployments_id": "05e1e80bcbdc58f1785c530c00b9034f", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}