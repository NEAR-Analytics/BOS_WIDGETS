{"tx_hash": "D7zkR97JFBrVmdccQvTefxy5KWw94bDbq8b7mMR7zvU8", "action_id_social": "2Guw2gu78Q7Cg7SWf7Ww7GuYNYLN5Uubyn9JYCWZCTYD-0-widget", "block_id": 96706387, "block_timestamp": "2023-07-17T19:49:31.811Z", "signer_id": "manzanal.near", "widget_name": "Governance.Proposal.Index", "source_code": "const contractId = \"v003.mpip.near\";\nconst accountId = props.accountId ?? context.accountId;\nconst authorId = \"manzanal.near\";\nconst META_VOTE_CONTRACT_ID = \"meta-vote.near\";\nconst mpip_id = props.mpip_id ? parseInt(props.mpip_id) : null;\nif (mpip_id == null) return \"Proposal Id not defined\";\n\nconst commentItemIndex = { contractId, mpip: `MPIP-${mpip_id}` };\n\nState.init({\n  proposal: {},\n  proposalIsFetched: false,\n  status: null,\n  statusIsFetched: false,\n  proposalVotes: {},\n  proposalVotesAreFetched: false,\n  proposalIsEditable: false,\n  proposalIsEditableIsFetched: false,\n  isQuorumReached: false,\n  isQuorumReachedIsFetched: false,\n  isProposalSucceeded: false,\n  isProposalSucceededIsFetched: false,\n  isProposalActiveOrDraft: false,\n  isProposalActiveOrDraftIsFetched: false,\n  showReply: false,\n  totalVotingPower: null,\n  totalVotingPowerIsFetched: false,\n});\n\nif (!state.proposalIsFetched) {\n  Near.asyncView(contractId, \"get_proposal\", { mpip_id }, \"final\", false).then(\n    (proposal) => State.update({ proposal, proposalIsFetched: true })\n  );\n}\n\nif (!state.statusIsFetched) {\n  Near.asyncView(\n    contractId,\n    \"get_proposal_state\",\n    { mpip_id },\n    \"final\",\n    false\n  ).then((status) => State.update({ status, statusIsFetched: true }));\n}\n\nif (!state.proposalVotesAreFetched) {\n  Near.asyncView(\n    contractId,\n    \"get_proposal_votes\",\n    { mpip_id },\n    \"final\",\n    false\n  ).then((proposalVotes) =>\n    State.update({ proposalVotes, proposalVotesAreFetched: true })\n  );\n}\n\nif (!state.proposalIsEditableIsFetched) {\n  Near.asyncView(\n    contractId,\n    \"get_proposal_is_active_or_draft\",\n    { mpip_id },\n    \"final\",\n    false\n  ).then((proposalIsEditable) =>\n    State.update({ proposalIsEditable, proposalIsEditableIsFetched: true })\n  );\n}\n\nif (!state.isQuorumReachedIsFetched) {\n  Near.asyncView(\n    contractId,\n    \"get_quorum_reached\",\n    { mpip_id },\n    \"final\",\n    false\n  ).then((isQuorumReached) =>\n    State.update({ isQuorumReached, isQuorumReachedIsFetched: true })\n  );\n}\n\nif (!state.isProposalSucceededIsFetched) {\n  Near.asyncView(\n    contractId,\n    \"get_proposal_vote_succeeded\",\n    { mpip_id },\n    \"final\",\n    false\n  ).then((isProposalSucceeded) =>\n    State.update({ isProposalSucceeded, isProposalSucceededIsFetched: true })\n  );\n}\n\nif (!state.totalVotingPowerIsFetched) {\n  Near.asyncView(\n    META_VOTE_CONTRACT_ID,\n    \"get_total_voting_power\",\n    {},\n    \"final\",\n    false\n  ).then((totalVotingPower) =>\n    State.update({ totalVotingPower, totalVotingPowerIsFetched: true })\n  );\n}\n\nif (!state.isProposalActiveOrDraftIsFetched) {\n  Near.asyncView(\n    contractId,\n    \"get_proposal_is_active_or_draft\",\n    { mpip_id },\n    \"final\",\n    false\n  ).then((isProposalActiveOrDraft) =>\n    State.update({\n      isProposalActiveOrDraft,\n      isProposalActiveOrDraftIsFetched: true,\n    })\n  );\n}\n\nconst onVotingPeriod = () => state.status == \"VotingProcess\";\n\nconst formatStatus = (status) => {\n  switch (status) {\n    case \"VotingProcess\":\n      return \"IN PROGRESS\";\n    case \"Draft\":\n      return \"DRAFT\";\n    case \"Active\":\n      return \"ACTIVE\";\n    case \"Accepted\":\n      return \"SUCCEEDED\";\n    case \"Rejected\":\n      return \"REJECTED\";\n    case \"Canceled\":\n      return \"CANCELED\";\n  }\n};\n\n// ==============================\n// Styled Components\n// ==============================\n\nconst statusColor =\n  state.status === \"Accepted\" || state.status == \"Executed\"\n    ? \"#28a930\"\n    : state.status === \"VotingProcess\"\n    ? \"#58a1ff\"\n    : state.status === \"Rejected\" || state.status == \"Canceled\"\n    ? \"#dc3545\"\n    : \"#6c757d\";\n\nconst Container = styled.div`\n  margin: 16px auto; \n  width:100%;\n  display: flex;\n  flex-direction: column;\n  min-height: 500px;\n  justify-content: start;\n`;\n\nconst ContentContainer = styled.div`\n  width:100%;\n  display: flex;\n  flex-direction: row;\n  gap: 24px;\n  min-height: 500px;\n\n  p {\n    line-height: 1.4;\n    font-weight: 400;\n    font-size: 15px;\n    color: #868682;\n    margin: 0;\n  }\n\n  h3 {\n    font-weight: 600;\n    font-size: 24px;\n    color: #1b1b18;\n  }\n\n  h5 {\n    font-size: 14px;\n    font-weight: 500;\n    line-height: 1.2;\n    color: #6c757d;\n  }\n\n  .status {\n    font-size: 14px;\n    font-weight: 600;\n    line-height: 1.2;\n    color: ${statusColor};\n  }\n`;\nconst WrapperLeft = styled.div`\n  margin: 16px auto;\n  width:100%;\n  background-color: #fff;\n  padding: 24px;\n  box-shadow: rgba(0, 0, 0, 0.18) 0px 2px 4px;\n  border-radius: 16px;\n  display: flex;\n  flex-direction: column;\n  gap: 24px;\n  min-height: 500px;\n\n  p {\n    line-height: 1.4;\n    font-weight: 400;\n    font-size: 15px;\n    color: #868682;\n    margin: 0;\n  }\n\n  h3 {\n    font-weight: 600;\n    font-size: 24px;\n    color: #1b1b18;\n  }\n\n  h5 {\n    font-size: 14px;\n    font-weight: 500;\n    line-height: 1.2;\n    color: #6c757d;\n  }\n\n  .status {\n    font-size: 14px;\n    font-weight: 600;\n    line-height: 1.2;\n    color: ${statusColor};\n  }\n`;\n\nconst WrapperRight = styled.div`\n  margin: 16px auto;\n  width:100%;\n  display: flex;\n  flex-direction: column;\n  gap: 24px;\n  min-height: 500px;\n\n  p {\n    line-height: 1.4;\n    font-weight: 400;\n    font-size: 15px;\n    color: #868682;\n    margin: 0;\n  }\n\n  h3 {\n    font-weight: 600;\n    font-size: 24px;\n    color: #1b1b18;\n  }\n\n  h5 {\n    font-size: 14px;\n    font-weight: 500;\n    line-height: 1.2;\n    color: #6c757d;\n  }\n\n  .status {\n    font-size: 14px;\n    font-weight: 600;\n    line-height: 1.2;\n    color: ${statusColor};\n  }\n`;\n\nconst MarkdownContainer = styled.div`\n  position: relative;\n  width: 100%;\n  padding: 24px;\n  background-color: #f8f9fa;\n  color: #1b1b18;\n  border-radius: 16px;\n  max-height: 700px;\n  overflow-y: auto;\n  color: #333;\n  line-height: 1.6;\n  box-shadow: rgba(0, 0, 0, 0.05) 0px 0px 0px 1px;\n\n  h1 {\n    font-size: 2em;\n    color: #111;\n    border-bottom: 1px solid #ccc;\n    padding-bottom: 0.3em;\n    margin-bottom: 1em;\n  }\n\n  h2 {\n    font-size: 1.5em;\n    color: #222;\n    margin-bottom: 0.75em;\n  }\n\n  h3 {\n    font-size: 1.3em;\n    color: #333;\n    margin-bottom: 0.6em;\n  }\n\n  h4 {\n    font-size: 1.2em;\n    color: #444;\n    margin-bottom: 0.5em;\n  }\n\n  h5 {\n    font-size: 1.1em;\n    color: #555;\n    margin-bottom: 0.4em;\n  }\n\n  p {\n    font-size: 1em;\n    margin-bottom: 1em;\n  }\n\n  a {\n    color: #0645ad;\n    text-decoration: none;\n  }\n\n  a:hover {\n    text-decoration: underline;\n  }\n`;\n\nconst BackButton = styled.button`\n  border: none;\n  background: none;\n  color: #7e868c;\n  transform: translate(1em, -1em);\n`;\n\nconst onStartVotingButtonClick = () => {\n  Near.call([\n    {\n      contractName: contractId,\n      methodName: \"start_voting_period\",\n      args: {\n        mpip_id,\n      },\n      gas: 300000000000000,\n    },\n  ]);\n};\n\nconst onCancelButtonClick = () => {\n  Near.call([\n    {\n      contractName: contractId,\n      methodName: \"cancel_proposal\",\n      args: {\n        mpip_id,\n      },\n      gas: 300000000000000,\n    },\n  ]);\n};\n\nconst isProposalCreator = () => {\n  return state.proposal.creator_id == accountId;\n};\n\nif (\n  !state.proposalIsFetched ||\n  !state.statusIsFetched ||\n  !state.proposalVotesAreFetched ||\n  !state.proposalIsEditableIsFetched\n)\n  return <>Loading...</>;\n\nreturn (\n  <Container>\n    <div>\n      <Widget\n        src={`${authorId}/widget/Common.ButtonRound`}\n        props={{\n          children: (\n            <>\n              <i class=\"bi bi-arrow-left\" />\n            </>\n          ),\n          onClick: () => State.update({ mpip_id }),\n          variant: \"primary\",\n          href: `/${authorId}/widget/Governance.Index?tab=home`,\n        }}\n      />\n    </div>\n    <ContentContainer>\n      <WrapperLeft>\n        {state.proposalIsEditable && isProposalCreator() && (\n          <div className=\"ms-auto\">\n            <Widget\n              src={`${authorId}/widget/Common.Button`}\n              props={{\n                children: (\n                  <>\n                    <i class=\"bi bi-pencil-square\" />\n                    Edit\n                  </>\n                ),\n                onClick: () => State.update({ mpip_id }),\n                className: \"mt-2\",\n                variant: \"primary\",\n                href: `/${authorId}/widget/Governance.Proposal.Create.Index?edit=true&mpip_id=${mpip_id}`,\n              }}\n            />\n            <Widget\n              src={`${authorId}/widget/Common.Button`}\n              props={{\n                children: (\n                  <>\n                    <i class=\"bi bi-trash\" />\n                    Cancel\n                  </>\n                ),\n                onClick: () => () => onCancelButtonClick(),\n                className: \"mt-2\",\n                variant: \"primary\",\n              }}\n            />\n            <Widget\n              src={`${authorId}/widget/Common.Button`}\n              props={{\n                children: (\n                  <>\n                    <i class=\"bi bi-envelope-open\" />\n                    Start Voting\n                  </>\n                ),\n                onClick: () => onStartVotingButtonClick(),\n                className: \"mt-2\",\n                variant: \"primary\",\n              }}\n            />\n          </div>\n        )}\n\n        <div className=\"d-flex justify-content-end align-items-center\">\n          <div className=\"d-flex justify-content-between align-items-center\">\n            <span className=\"status\">{formatStatus(state.status)}</span>\n          </div>\n        </div>\n\n        <div className=\"d-flex flex-row gap-1 justify-content-between\">\n          <h3>\n            Prop {state.proposal.mpip_id} - {state.proposal.title}\n          </h3>\n        </div>\n        <div>\n          <h4>{state.proposal.short_description}</h4>\n        </div>\n        <div className=\"d-flex flex-row gap-1 align-items-center\">\n          <h5>by </h5>\n          <Widget\n            src=\"mob.near/widget/Profile.ShortInlineBlock\"\n            props={{ accountId: state.proposal.creator_id, tooltip: true }}\n          />\n        </div>\n        <div>\n          <h5>Description</h5>\n          <p>{state.proposal.body}</p>\n        </div>\n        <div\n          className=\"d-flex flex-wrap align-items-start\"\n          style={{\n            rowGap: \"16px\",\n            columnGap: \"48px\",\n          }}\n        ></div>\n        <Widget\n          src={`${authorId}/widget/Governance.Proposal.DiscussionCard`}\n          props={{\n            commentsOpen: state.isProposalActiveOrDraft,\n            blockHeight: blockHeight,\n            onCommentButtonClick: () =>\n              State.update({ showReply: !state.showReply }),\n            onComment: () => State.update({ showReply: false }),\n            showReply: state.showReply,\n            commentItemIndex: commentItemIndex,\n            highlightComment: props.highlightComment,\n            commentsLimit: props.commentsLimit,\n          }}\n        />\n      </WrapperLeft>\n      <WrapperRight>\n        {accountId && (\n          <div className=\"w-100\">\n            <Widget\n              src={`${authorId}/widget/Governance.Proposal.VoteCard`}\n              props={{\n                proposal: { ...state.proposal, status: state.status },\n              }}\n            />\n          </div>\n        )}\n\n        <div className=\"w-100\">\n          <Widget\n            src={`${authorId}/widget/Governance.Proposal.VotingPeriodCard`}\n            props={{\n              startDate: state.proposal.vote_start_timestamp,\n              endDate: state.proposal.vote_end_timestamp,\n            }}\n          />\n        </div>\n        <div className=\"w-100\">\n          <Widget\n            src={`${authorId}/widget/Governance.Proposal.VotingResultsCard`}\n            props={{\n              yesVotes: state.proposalVotes.for_votes,\n              noVotes: state.proposalVotes.against_votes,\n              abstainVotes: state.proposalVotes.abstain_votes,\n              quorum: state.proposal.v_power_quorum_to_reach,\n              isQuorumReached: state.isQuorumReached,\n              isProposalSucceeded: state.isProposalSucceeded,\n              onVotingPeriod,\n            }}\n          />\n        </div>\n        <div className=\"w-100\">\n          <Widget\n            src={`${authorId}/widget/Governance.Proposal.VotesCard`}\n            props={{\n              accountVotes: state.proposalVotes.has_voted,\n            }}\n          />\n        </div>\n      </WrapperRight>\n    </ContentContainer>\n  </Container>\n);\n", "metadata": {"platform": "nearpad"}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/manzanal.near/widget/Governance.Proposal.Index", "fact_widget_deployments_id": "973f20898b59a0d25cfbf3504974e292", "inserted_timestamp": "2000-01-01T00:00:00.000Z", "modified_timestamp": "2000-01-01T00:00:00.000Z", "__row_index": 11}