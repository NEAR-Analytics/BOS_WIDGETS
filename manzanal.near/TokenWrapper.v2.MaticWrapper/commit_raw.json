{"tx_hash": "DeGft2oEDWzrJXoMEpG7uxT9iX7wj8TPYd5xQZsf11io", "action_id_social": "Do4CRuydJDPX7EnTVmUiPDj8vaKyLtqY4vrB3itcWZ6k-0-widget", "block_id": 96942681, "block_timestamp": "2023-07-20T21:26:42.613Z", "signer_id": "manzanal.near", "widget_name": "TokenWrapper.v2.MaticWrapper", "source_code": "const ownerId = \"manzanal.near\";\nconst tokenName = \"MATIC\";\nconst wrapTokenName = \"WMATIC\";\nconst wmaticAddress =\n  props.wmaticAddress || \"0x0d500b1d8e8ef31e21c99d1db9a6444d3adf1270\";\nconst tokenDecimals = 18;\nconst wmaticAbiUrl =\n  props.wmaticAbiUrl ||\n  \"https://raw.githubusercontent.com/leomanza/chain-agnostic-bos-workshop/main/ABIs/WMATIC.abi.json\";\nconst wmaticAbi = fetch(wmaticAbiUrl);\n\nif (!wmaticAbi.ok) {\n  return \"Loading\";\n}\nconst wmaticAbiBody = wmaticAbi.body;\nconsole.log(\"ABI\", wmaticAbiBody);\nconst signer = Ethers.provider() ? Ethers.provider().getSigner() : null;\nconst wmaticContract = new ethers.Contract(\n  wmaticAddress,\n  wmaticAbiBody,\n  signer\n);\n\nState.init({\n  signerAddress: null,\n});\n\nconst getSignerAddress = () => {\n  signer.getAddress().then((signerAddress) => {\n    State.update({ signerAddress });\n  });\n};\ngetSignerAddress();\n\nconst imgWrapTokenSvg = (\n  <svg\n    width=\"32\"\n    height=\"25.204\"\n    viewBox=\"0 0 32 25.204\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"m12.388 10.481 3.573 7.923 5.317 -3.065 0.004 -0.002v-6.135l-8.894 1.279Z\"\n      fill=\"#2BBDF7\"\n    />\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"m28.162 4.602 -3.319 -1.25 -3.547 -0.286v19.066l5.321 3.067 4.2 -8.595 -2.649 -8.311 -0.006 -3.689Z\"\n      fill=\"#2891F9\"\n    />\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"m27.828 3.072 -1.232 3.066h-0.002v19.063l5.322 -3.066V3.072h-4.088Z\"\n      fill=\"#2BBDF7\"\n    />\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"m26.618 0 -5.322 3.068L26.618 6.136l5.322 -3.068L26.618 0Z\"\n      fill=\"#2B6DEF\"\n    />\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M15.965 12.267v-0.002l-5.321 -5.954L0 3.065v19.063l5.321 3.068 1.521 -10.55 3.802 0.691v-0.003l5.322 3.067v-6.134h-0.001Z\"\n      fill=\"#2891F9\"\n    />\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M5.324 0 0 3.068 15.963 12.273l2.412 -1.39 2.909 -1.678L5.324 0Z\"\n      fill=\"#2B6DEF\"\n    />\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M5.325 12.267h-0.001v12.928l5.322 -3.067v-6.794l-5.321 -3.068Z\"\n      fill=\"#2BBDF7\"\n    />\n  </svg>\n);\nconst imgTokenSvg = (\n  <svg\n    width=\"32\"\n    height=\"32\"\n    viewBox=\"0 0 32 32\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <g fill=\"none\">\n      <circle fill=\"#6F41D8\" cx=\"16\" cy=\"16\" r=\"16\" />\n      <path\n        d=\"M21.092 12.693c-.369-.215-.848-.215-1.254 0l-2.879 1.654-1.955 1.078-2.879 1.653c-.369.216-.848.216-1.254 0l-2.288-1.294c-.369-.215-.627-.61-.627-1.042V12.19c0-.431.221-.826.627-1.042l2.25-1.258c.37-.216.85-.216 1.256 0l2.25 1.258c.37.216.628.611.628 1.042v1.654l1.955-1.115v-1.653a1.16 1.16 0 00-.627-1.042l-4.17-2.372c-.369-.216-.848-.216-1.254 0l-4.244 2.372A1.16 1.16 0 006 11.076v4.78c0 .432.221.827.627 1.043l4.244 2.372c.369.215.849.215 1.254 0l2.879-1.618 1.955-1.114 2.879-1.617c.369-.216.848-.216 1.254 0l2.251 1.258c.37.215.627.61.627 1.042v2.552c0 .431-.22.826-.627 1.042l-2.25 1.294c-.37.216-.85.216-1.255 0l-2.251-1.258c-.37-.216-.628-.611-.628-1.042v-1.654l-1.955 1.115v1.653c0 .431.221.827.627 1.042l4.244 2.372c.369.216.848.216 1.254 0l4.244-2.372c.369-.215.627-.61.627-1.042v-4.78a1.16 1.16 0 00-.627-1.042l-4.28-2.409z\"\n        fill=\"#FFF\"\n      />\n    </g>\n  </svg>\n);\n\nconst parseToUnitsFn = (amount) => {\n  const tokenDecimals = 18;\n  return ethers.utils.parseUnits(amount, tokenDecimals);\n};\n\nconst formatUnitsFn = (amount) => {\n  const tokenDecimals = 18;\n  return ethers.utils.formatUnits(amount, tokenDecimals);\n};\nconst isValidAmountFn = (amount) => {\n  if (!amount) return false;\n  if (isNaN(Number(amount))) return false;\n  if (amount === \"\") return false;\n  if (amount < 0) return false;\n  return true;\n};\nconst isSignedIn = () => !!state.signerAddress;\n\nconst getMaticBalance = (signerAddress, updateStateCb) => {\n  Ethers.provider()\n    .getBalance(signerAddress)\n    .then((balance) => updateStateCb(formatUnitsFn(balance)));\n};\n\nconst getWMaticBalance = (signerAddress, updateStateCb) => {\n  wmaticContract\n    .balanceOf(signerAddress)\n    .then((balance) => updateStateCb(formatUnitsFn(balance)));\n};\n\nconst wrapFn = (amountIn) => {\n  const amount = parseToUnitsFn(amountIn);\n\n  wmaticContract.deposit({ value: amount });\n};\nconst unwrapFn = (amountIn) => {\n  const amount = parseToUnitsFn(amountIn);\n\n  wmaticContract.withdraw(amount);\n};\nif (!state.signerAddress) return \"Loading...\";\nreturn (\n  <Widget\n    src={`${ownerId}/widget/TokenWrapper.v2.AbstractWrapper`}\n    props={{\n      tokenName,\n      wrapTokenName,\n      imgTokenSvg,\n      imgWrapTokenSvg,\n      getTokenBalanceFn: getMaticBalance,\n      getWrapTokenBalanceFn: getWMaticBalance,\n      parseToUnitsFn,\n      formatUnitsFn,\n      isValidAmountFn,\n      wrapFn,\n      unwrapFn,\n      isSignedIn,\n      signerAddress: state.signerAddress,\n    }}\n  />\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/manzanal.near/widget/TokenWrapper.v2.MaticWrapper", "fact_widget_deployments_id": "791945d492ccdd39fb49c573799a756c", "inserted_timestamp": "2000-01-01T00:00:00.000Z", "modified_timestamp": "2000-01-01T00:00:00.000Z", "__row_index": 5}