{"tx_hash": "29W3eEdFXLQQa8wBkZFEdwiyaPTtUhGyGPcFruFB8S5a", "action_id_social": "2wxJBvaFHXCtkvR9vnZuPauDZCwp7eUnt4koCJGpb7fF-0-widget", "block_id": 99348373, "block_timestamp": "2023-08-21T21:50:46.129Z", "signer_id": "ihyshan.near", "widget_name": "DAO.Layout.Header", "source_code": "const daoId = props.daoId;\r\nconst profile = daoId ? Social.get(`${daoId}/profile/**`, \"final\") : {};\r\nconst currentLink = `#/astraplusplus.ndctools.near/widget/index?page=dao&daoId=${daoId}`;\r\n\r\nState.init({\r\n  joinRole: \"council\",\r\n});\r\n\r\n// Follower Count:\r\nconst following = Social.keys(`${daoId}/graph/follow/*`, \"final\", {\r\n  return_type: \"BlockHeight\",\r\n  values_only: true,\r\n});\r\nconst followers = Social.keys(`*/graph/follow/${daoId}`, \"final\", {\r\n  return_type: \"BlockHeight\",\r\n  values_only: true,\r\n});\r\nconst followingCount = following\r\n  ? Object.keys(following[daoId].graph.follow || {}).length\r\n  : null;\r\n\r\nconst followersCount = followers ? Object.keys(followers || {}).length : null;\r\n\r\nconst policy = useCache(\r\n  () =>\r\n    Near.asyncView(daoId, \"get_policy\").then((policy) => {\r\n      return {\r\n        policy,\r\n      };\r\n    }),\r\n  daoId + \"-policy\",\r\n  { subscribe: false }\r\n);\r\n\r\nconst config = useCache(\r\n  () =>\r\n    Near.asyncView(daoId, \"get_config\").then((config) => ({\r\n      ...config,\r\n      metadata: config.metadata\r\n        ? JSON.parse(Buffer.from(config.metadata, \"base64\").toString())\r\n        : null,\r\n    })),\r\n  daoId + \"-config\",\r\n  { subscribe: false }\r\n);\r\n\r\nif (policy === null) return \"\";\r\nif (config === null) return \"\";\r\n\r\nconsole.log(config);\r\n\r\nconsole.log(profile);\r\n\r\nprofile = {\r\n  ...profile,\r\n  name: profile.name || config.metadata?.displayName || daoId,\r\n  description: profile.description || config.purpose,\r\n  backgroundImage:\r\n    profile.backgroundImage ||\r\n    `https://astro-prod-ui.s3.us-east-1.amazonaws.com/${config.metadata?.flagCover}`,\r\n  image:\r\n    profile.image ||\r\n    `https://astro-prod-ui.s3.us-east-1.amazonaws.com/${config.metadata?.flagLogo}`,\r\n};\r\n\r\nconst roles = policy.policy.roles\r\n  .filter((r) => r.kind !== \"Everyone\")\r\n  .map((r) => r.name);\r\n\r\nconst onAddUserProposal = (memberId, roleId) => {\r\n  Near.call([\r\n    {\r\n      contractName: daoId,\r\n      methodName: \"add_proposal\",\r\n      args: {\r\n        proposal: {\r\n          description: \"Potential member\",\r\n          kind: {\r\n            AddMemberToRole: {\r\n              member_id: memberId,\r\n              role: roleId ?? \"council\",\r\n            },\r\n          },\r\n        },\r\n      },\r\n      gas: 219000000000000,\r\n      deposit: policy.policy.proposal_bond || 100000000000000000000000,\r\n    },\r\n  ]);\r\n};\r\n\r\nconst BG = styled.div`\r\n  --bs-aspect-ratio: 16%;\r\n  background-color: #eee;\r\n  background-size: cover;\r\n  background-position: center;\r\n  min-height: 120px;\r\n`;\r\n\r\nconst Avatar = styled.div`\r\n  background-color: #eee;\r\n  background-size: cover;\r\n  background-position: center;\r\n  height: 140px;\r\n  width: 140px;\r\n`;\r\n\r\nconst Root = styled.div`\r\n  font-size: 14px;\r\n\r\n  .short-description {\r\n    max-height: 100px;\r\n    overflow-y: auto;\r\n\r\n    p {\r\n      color: #999;\r\n    }\r\n  }\r\n\r\n  .profile__metadata {\r\n    display: grid;\r\n    grid-template-columns: 140px 1fr 240px;\r\n    grid-gap: 2rem;\r\n  }\r\n`;\r\n\r\nconst DropdownMenu = styled(\"Popover.Content\")`\r\n  background: #fff;\r\n  border-radius: 6px;\r\n  box-shadow: 0 0 40px rgba(0, 0, 0, 0.15);\r\n  z-index: 10000;\r\n  padding: 0.5rem;\r\n  outline: none;\r\n\r\n  ul {\r\n    list-style: none;\r\n    display: block;\r\n    margin: 0;\r\n    padding: 0;\r\n  }\r\n\r\n  li {\r\n    display: block;\r\n  }\r\n\r\n  a {\r\n    display: flex;\r\n    gap: 0.75rem;\r\n    align-items: center;\r\n    padding: 0.5rem;\r\n    font: var(--text-base);\r\n    color: var(--sand12);\r\n    outline: none;\r\n    text-decoration: none;\r\n\r\n    &:hover,\r\n    &:focus {\r\n      text-decoration: underline;\r\n    }\r\n  }\r\n\r\n  i {\r\n    color: var(--violet8);\r\n  }\r\n`;\r\n\r\nconst clickbaitPrompt = `\r\nJoin the ${profile.name || daoId} DAO on the BOS\r\n\\n#NEAR #BOS #DAO\\n\r\nhttps://near.org/${currentLink}\r\n`;\r\n\r\nconst twitterUrl = new URL(\"https://twitter.com/intent/tweet\");\r\ntwitterUrl.searchParams.set(\"text\", clickbaitPrompt);\r\n\r\nconst mailtoUrl = new URL(\"mailto:\");\r\nmailtoUrl.searchParams.set(\r\n  \"subject\",\r\n  `Join the ${profile.name || daoId} DAO on the BOS`\r\n);\r\nmailtoUrl.searchParams.set(\r\n  \"body\",\r\n  `Take a look at this DAO. \\n https://near.org/${currentLink}`\r\n);\r\n\r\nreturn (\r\n  <Root>\r\n    <BG\r\n      className=\"ratio rounded-4 mb-3\"\r\n      style={{\r\n        backgroundImage: profile?.backgroundImage.ipfs_cid\r\n          ? `url(https://ipfs.near.social/ipfs/${profile?.backgroundImage.ipfs_cid})`\r\n          : `url(${profile?.backgroundImage})`,\r\n      }}\r\n      aria-label=\"DAO Cover Image\"\r\n      role=\"img\"\r\n    ></BG>\r\n\r\n    <div className=\"profile__metadata\">\r\n      <Avatar\r\n        className=\"avatar rounded-4 border border-2 border-white ratio ratio-1x1 position-relative z-1\"\r\n        style={{\r\n          backgroundImage: profile?.image.ipfs_cid\r\n            ? `url(https://ipfs.near.social/ipfs/${profile?.image.ipfs_cid})`\r\n            : `url(${profile?.image})`,\r\n        }}\r\n      ></Avatar>\r\n      <div>\r\n        <h2 className=\"fw-bolder mb-0\">{profile.name || daoId}</h2>\r\n        <p\r\n          className=\"mb-1\"\r\n          style={{\r\n            color: \"#4498E0\",\r\n          }}\r\n        >\r\n          @{daoId}\r\n        </p>\r\n        <div className=\"short-description mb-2\">\r\n          <Markdown text={profile.description} />\r\n        </div>\r\n        <div className=\"d-flex gap-3 flex-wrap mb-3\">\r\n          <a href={`/${currentLink}&tab=following`}>\r\n            <b>{followingCount === null ? \"--\" : followingCount}</b> following\r\n          </a>\r\n          <span>|</span>\r\n          <a href={`/${currentLink}&tab=followers`}>\r\n            <b>{followersCount === null ? \"--\" : followersCount}</b> followers\r\n          </a>\r\n        </div>\r\n        {profile.linktree && (\r\n          <ul className=\"d-flex list-unstyled gap-3 flex-wrap\">\r\n            {profile.linktree.website && (\r\n              <a href={`https://${profile.linktree.website}`} target=\"_blank\">\r\n                <i className=\"bi bi-globe\"></i> {profile.linktree.website}\r\n              </a>\r\n            )}\r\n\r\n            {profile.linktree.github && (\r\n              <a\r\n                href={`https://github.com/${profile.linktree.github}`}\r\n                target=\"_blank\"\r\n              >\r\n                <i className=\"bi bi-github\"></i> {profile.linktree.github}\r\n              </a>\r\n            )}\r\n\r\n            {profile.linktree.twitter && (\r\n              <a\r\n                href={`https://twitter.com/${profile.linktree.twitter}`}\r\n                target=\"_blank\"\r\n              >\r\n                <i className=\"bi bi-twitter\"></i> {profile.linktree.twitter}\r\n              </a>\r\n            )}\r\n\r\n            {profile.linktree.telegram && (\r\n              <a\r\n                href={`https://t.me/${profile.linktree.telegram}`}\r\n                target=\"_blank\"\r\n              >\r\n                <i className=\"bi bi-telegram\"></i> {profile.linktree.telegram}\r\n              </a>\r\n            )}\r\n          </ul>\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"profile__buttons w-100 d-flex flex-column gap-2\">\r\n        <Widget\r\n          src=\"nearui.near/widget/Social.FollowButton\"\r\n          props={{\r\n            accountId: daoId,\r\n            variant: \"info\",\r\n            className: \"w-100\",\r\n          }}\r\n        />\r\n        <Widget\r\n          src=\"nearui.near/widget/Input.Button\"\r\n          props={{\r\n            variant: \"info outline\",\r\n            className: \"w-100\",\r\n            children: \"See more details\",\r\n          }}\r\n        />\r\n        <div className=\"d-flex gap-2\">\r\n          <Widget\r\n            src=\"nearui.near/widget/Layout.Modal\"\r\n            props={{\r\n              toggle: (\r\n                <Widget\r\n                  src=\"nearui.near/widget/Input.Button\"\r\n                  props={{\r\n                    variant: \"info outline\",\r\n                    className: \"w-100\",\r\n                    children: \"Ask to join\",\r\n                  }}\r\n                />\r\n              ),\r\n              content: (\r\n                <div className=\"ndc-card p-4\">\r\n                  <Widget\r\n                    src=\"nearui.near/widget/Input.Select\"\r\n                    props={{\r\n                      label: \"Role you want to join as\",\r\n                      options: roles.map((r) => {\r\n                        return {\r\n                          title: r,\r\n                          value: r,\r\n                        };\r\n                      }),\r\n                      onChange: (v) => State.update({ joinRole: v }),\r\n                      value: state.joinRole,\r\n                    }}\r\n                  />\r\n                  <Widget\r\n                    src=\"nearui.near/widget/Input.Button\"\r\n                    props={{\r\n                      children: \"Propose to Join\",\r\n                      size: \"sm\",\r\n                      variant: [\"info\"],\r\n                      className: \"w-100 mt-3\",\r\n                      onClick: () =>\r\n                        onAddUserProposal(accountId, state.joinRole),\r\n                    }}\r\n                  />\r\n                </div>\r\n              ),\r\n            }}\r\n          />\r\n          <Popover.Root>\r\n            <Popover.Trigger asChild>\r\n              <div className=\"w-100\">\r\n                <Widget\r\n                  src=\"nearui.near/widget/Input.Button\"\r\n                  props={{\r\n                    variant: \"info outline\",\r\n                    className: \"w-100\",\r\n                    children: \"Share\",\r\n                  }}\r\n                />\r\n              </div>\r\n            </Popover.Trigger>\r\n\r\n            <DropdownMenu sideOffset={5}>\r\n              <ul>\r\n                <li>\r\n                  <Popover.Close asChild>\r\n                    <a href={mailtoUrl.toString()} target=\"_blank\">\r\n                      <i\r\n                        className=\"bi bi-envelope\"\r\n                        style={{ color: \"#4498E0\" }}\r\n                      />{\" \"}\r\n                      Share by email\r\n                    </a>\r\n                  </Popover.Close>\r\n                </li>\r\n                <li>\r\n                  <Popover.Close asChild>\r\n                    <a href={twitterUrl.toString()} target=\"_blank\">\r\n                      <i\r\n                        className=\"bi bi-twitter\"\r\n                        style={{ color: \"#4498E0\" }}\r\n                      />\r\n                      Share on Twitter\r\n                    </a>\r\n                  </Popover.Close>\r\n                </li>\r\n              </ul>\r\n\r\n              <Popover.Arrow style={{ fill: \"#fff\" }} />\r\n            </DropdownMenu>\r\n          </Popover.Root>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </Root>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/ihyshan.near/widget/DAO.Layout.Header", "fact_widget_deployments_id": "afc66ad2ebfa4a80c09afec6b5d9206c", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 16}