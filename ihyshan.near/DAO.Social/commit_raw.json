{"tx_hash": "2CaDNgUEvHpGoHhViC9Jd8SqMpUK3mjxJ1VnD4KyMdc5", "action_id_social": "8HXRPbPWdquuYstAzxnjU1G8jRJ3aQ87WucsZirKNcqk-0-widget", "block_id": 99563887, "block_timestamp": "2023-08-24T17:14:45.610Z", "signer_id": "ihyshan.near", "widget_name": "DAO.Social", "source_code": "const daoId = props.daoId;\r\n\r\nconst index = [\r\n  {\r\n    action: \"post\",\r\n    key: \"main\",\r\n    options: {\r\n      limit: 10,\r\n      order: \"desc\",\r\n      accountId: daoId,\r\n    },\r\n  },\r\n  {\r\n    action: \"repost\",\r\n    key: \"main\",\r\n    options: {\r\n      limit: 10,\r\n      order: \"desc\",\r\n      accountId: daoId,\r\n    },\r\n  },\r\n];\r\n\r\nconst renderedPosts = {};\r\n\r\nconst makePostItem = (a) => ({\r\n  type: \"social\",\r\n  path: `${a.accountId}/post/main`,\r\n  blockHeight: a.blockHeight,\r\n});\r\n\r\nconst renderPost = (a) => {\r\n  if (a.value.type !== \"md\") {\r\n    return false;\r\n  }\r\n  const item = JSON.stringify(makePostItem(a));\r\n  if (item in renderedPosts) {\r\n    return false;\r\n  }\r\n  renderedPosts[item] = true;\r\n\r\n  return (\r\n    <div key={JSON.stringify(a)} className=\"mb-3\">\r\n      <Widget\r\n        src=\"hack.near/widget/News.Post\"\r\n        props={{ accountId: a.accountId, blockHeight: a.blockHeight }}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nconst repostSvg = (\r\n  <svg\r\n    xmlns=\"http://www.w3.org/2000/svg\"\r\n    width=\"24\"\r\n    height=\"24\"\r\n    fill=\"currentColor\"\r\n    viewBox=\"0 0 24 24\"\r\n  >\r\n    <path\r\n      fill-rule=\"evenodd\"\r\n      d=\"M4.854 1.146a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L4 2.707V12.5A2.5 2.5 0 0 0 6.5 15h8a.5.5 0 0 0 0-1h-8A1.5 1.5 0 0 1 5 12.5V2.707l3.146 3.147a.5.5 0 1 0 .708-.708l-4-4z\"\r\n      transform=\"rotate(180, 12, 12), translate(0, 4)\"\r\n    />\r\n    <path\r\n      fill-rule=\"evenodd\"\r\n      d=\"M4.854 1.146a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L4 2.707V12.5A2.5 2.5 0 0 0 6.5 15h8a.5.5 0 0 0 0-1h-8A1.5 1.5 0 0 1 5 12.5V2.707l3.146 3.147a.5.5 0 1 0 .708-.708l-4-4z\"\r\n      transform=\"translate(0, 4)\"\r\n    />\r\n  </svg>\r\n);\r\n\r\nconst extractParentPost = (item) => {\r\n  if (!item || item.type !== \"social\" || !item.path || !item.blockHeight) {\r\n    return undefined;\r\n  }\r\n  const accountId = item.path.split(\"/\")[0];\r\n  return `${accountId}/post/main` === item.path\r\n    ? { accountId, blockHeight: item.blockHeight }\r\n    : undefined;\r\n};\r\n\r\nconst renderRepost = (a) => {\r\n  if (a.value.type !== \"repost\") {\r\n    return false;\r\n  }\r\n  const post = extractParentPost(a.value.item);\r\n  if (!post) {\r\n    return false;\r\n  }\r\n  const item = JSON.stringify(makePostItem(post));\r\n  if (item in renderedPosts) {\r\n    return false;\r\n  }\r\n  renderedPosts[item] = true;\r\n\r\n  return (\r\n    <div key={JSON.stringify(a)} className=\"mb-3\">\r\n      <div className=\"text-muted\">\r\n        {repostSvg} Reposted by{\" \"}\r\n        <Widget\r\n          src=\"mob.near/widget/ProfileLine\"\r\n          props={{\r\n            accountId: a.accountId,\r\n            hideImage: true,\r\n            hideAccountId: true,\r\n            tooltip: true,\r\n          }}\r\n        />\r\n      </div>\r\n      <Widget\r\n        src=\"hack.near/widget/DAO.Social.Post\"\r\n        props={{ accountId: post.accountId, blockHeight: post.blockHeight }}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nconst renderItem = (item) =>\r\n  item.action === \"post\" ? renderPost(item) : renderRepost(item);\r\n\r\nreturn (\r\n  <div>\r\n    <Widget\r\n      src=\"mob.near/widget/MergedIndexFeed\"\r\n      props={{ index, renderItem }}\r\n    />\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/ihyshan.near/widget/DAO.Social", "fact_widget_deployments_id": "618480e7a2529b1d36fccff17b1a4193", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}