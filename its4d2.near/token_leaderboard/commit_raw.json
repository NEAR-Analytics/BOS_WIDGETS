{"tx_hash": "4rn69TBi7vqG6453nA2qcSpv8JnEEer7DdNjxVJkEPdP", "action_id_social": "4MKv7V4MpBsCMW3ivN7hYxRkbYFWSLrYb1fksRTyAn3E-0-widget", "block_id": 115938435, "block_timestamp": "2024-04-01T20:20:52.013Z", "signer_id": "its4d2.near", "widget_name": "token_leaderboard", "source_code": "const accountId = context.accountId;\n\nState.init({\n  tokenName: \"\",\n  holders: {},\n  loading: false,\n});\n\nconst onTokenNameChange = ({ target: { value } }) => {\n  State.update({ tokenName: value });\n};\n\nconst fetchHolders = () => {\n  State.update({ loading: true });\n\n  asyncFetch(`https://api.fastnear.com/v1/ft/${state.tokenName}/top`)\n    .then((res) => {\n      if (!res.ok) {\n        console.error(\"Failed to fetch token holders\", res);\n        return;\n      }\n\n      State.update({\n        holders: Object.fromEntries(\n          (res.body.accounts || [])\n            .filter(({ balance }) => !!balance)\n            .map(({ account_id, balance }) => [account_id, balance])\n        ),\n      });\n    })\n    .finally(() => State.update({ loading: false }));\n};\n\nconst onSearchClick = () => {\n  fetchHolders();\n};\n\nconst searchForm = (\n  <>\n    <div class=\"input-group mb-3\">\n      <input\n        type=\"text\"\n        class=\"form-control form-control-lg\"\n        placeholder=\"Enter token contract account\"\n        onChange={onTokenNameChange}\n        data-bs-toggle=\"tooltip\"\n        title=\"Enter the contract account of the token you want to check the holder rankings for.\"\n      />\n      <button\n        class=\"btn btn-primary btn-lg\"\n        type=\"button\"\n        onClick={onSearchClick}\n        data-bs-toggle=\"tooltip\"\n        title=\"Click to fetch the token holder rankings.\"\n      >\n        \ud83d\udd0e\n      </button>\n    </div>\n  </>\n);\n\nconst Wrapper = styled.div`\n  .table {\n    table-layout: fixed;\n    word-wrap: break-word;\n  }\n\n  .table th,\n  .table td {\n    vertical-align: middle;\n  }\n\n  .table .rank {\n    width: 1px;\n    white-space: nowrap;\n  }\n\n  .table .account {\n    width: 60%;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n\n  .table .balance {\n    width: 30%;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    text-align: right;\n  }\n`;\n\n// Render\nreturn (\n  <Wrapper>\n    <div class=\"container py-5\">\n      <div class=\"row justify-content-center\">\n        <div class=\"col-md-8\">\n          <h1 class=\"text-center mb-4\">Token Leaderboard</h1>\n          <div class=\"card shadow\">\n            <div class=\"card-body\">\n              <p class=\"text-muted\">\n                Here you can check the top 100 holders for a given token. Simply\n                enter the token contract account and click the search button.\n              </p>\n              {searchForm}\n              {state.loading ? (\n                <div class=\"text-center\">\n                  <div class=\"spinner-border text-primary\" role=\"status\">\n                    <span class=\"visually-hidden\">Loading...</span>\n                  </div>\n                </div>\n              ) : (\n                <div class=\"table-responsive\">\n                  <table class=\"table table-striped mb-0\">\n                    <thead>\n                      <tr>\n                        <th class=\"rank\">Rank</th>\n                        <th class=\"account\">Account</th>\n                        <th class=\"balance\">Balance</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      {Object.entries(state.holders).map(\n                        ([account_id, balance], index) => (\n                          <tr key={account_id}>\n                            <td class=\"rank\">{index + 1}</td>\n                            <td\n                              class=\"account\"\n                              title={account_id}\n                              data-bs-toggle=\"tooltip\"\n                            >\n                              {account_id}\n                            </td>\n                            <td\n                              class=\"balance\"\n                              title={balance}\n                              data-bs-toggle=\"tooltip\"\n                            >\n                              {balance}\n                            </td>\n                          </tr>\n                        )\n                      )}\n                      {Object.keys(state.holders).length === 0 && (\n                        <tr>\n                          <td colspan=\"3\" class=\"text-center\">\n                            No holder data found for this token.\n                          </td>\n                        </tr>\n                      )}\n                    </tbody>\n                  </table>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </Wrapper>\n);\n", "metadata": {"platform": "jutsu.ai"}, "branch": {"draft": null}, "widget_modules_used": null, "widget_url": "https://near.social/#/its4d2.near/widget/token_leaderboard", "fact_widget_deployments_id": "4c106db1180349d27f874bc463799911", "inserted_timestamp": "2024-04-01T22:42:44.712Z", "modified_timestamp": "2024-04-01T22:42:44.712Z", "__row_index": 0}