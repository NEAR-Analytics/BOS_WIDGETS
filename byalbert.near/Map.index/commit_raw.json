{"tx_hash": "CPmpPLgYT4URngstmo1UdKopL8jXZmj3wCBJKBWHbNLx", "action_id_social": "EjgQ6k7igCJA62j5ZoTQ7uPUpQ8CUEa8g5L3iyMe4k6d-0-widget", "block_id": 104403438, "block_timestamp": "2023-10-28T17:51:56.589Z", "signer_id": "byalbert.near", "widget_name": "Map.index", "source_code": "const MAP_STYLE = props.MAP_STYLE || \"mapbox://styles/mapbox/outdoors-v12\";\nconst MAP_TOKEN =\n  props.MAP_TOKEN ||\n  \"pk.eyJ1IjoidGVqMDEiLCJhIjoiY2xqcHZ2dGpkMDB5azNsbzQ0bmMwNjRjaCJ9.FVv2zRPaLwzZMgagbI2YZw\";\n\nconst center = props.center || [-74.00597, 40.71427];\nconst zoom = props.zoom || 10;\nconst onSave = props.handleSave || (() => {});\nconst formWidget = props.formWidget;\nconst inspectWidget = props.inspectWidget;\n\nconst Container = styled.div`\n  display: flex;\n  width: 100%;\n  margin-top: var(--header-height);\n  height: calc(100vh - 70px);\n  align-items: stretch;\n  flex-direction: column;\n  overflow: auto;\n  position: relative;\n  z-index: 100;\n`;\n\nconst Button = styled.button`\n  background: #191a1a;\n  border-radius: 6px;\n  color: white;\n  z-index: 1;\n  padding: 10px 22px;\n`;\n\nconst Profile = styled.div`\n  position: absolute;\n  right: 50px;\n  top: 30px;\n  @media (max-width: 510px) {\n    padding: 6px 15px;\n    right: 15px;\n    top: 15px;\n  }\n`;\n\nconst Inspect = styled.div`\n  position: absolute;\n  left: 50px;\n  top: 30px;\n  @media (max-width: 510px) {\n    padding: 6px 15px;\n    right: 15px;\n    top: 15px;\n  }\n`;\n\nconst Location = styled.div`\n  position: absolute;\n  bottom: 50px;\n  @media (max-width: 510px) {\n    padding: 6px 15px;\n    bottom: 15px;\n  }\n`;\n\nState.init({\n  locations: [],\n  edit: false,\n});\n\nconst handleSave = (data) => {\n  onSave && onSave(data);\n  State.update({ edit: false, showForm: false, showInspect: false });\n};\n\nfunction DownIcon() {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"20\"\n      height=\"20\"\n      viewBox=\"0 0 48 48\"\n    >\n      <mask id=\"ipSDownOne0\">\n        <path\n          fill=\"#fff\"\n          stroke=\"#fff\"\n          strokeLinejoin=\"round\"\n          strokeWidth=\"4\"\n          d=\"M36 19L24 31L12 19h24Z\"\n        />\n      </mask>\n      <path fill=\"currentColor\" d=\"M0 0h48v48H0z\" mask=\"url(#ipSDownOne0)\" />\n    </svg>\n  );\n}\n\nfunction LocationIcon() {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n    >\n      <g\n        fill=\"none\"\n        stroke=\"currentColor\"\n        strokeLinejoin=\"round\"\n        strokeWidth=\"2\"\n      >\n        <path d=\"M13 9a1 1 0 1 1-2 0a1 1 0 0 1 2 0Z\" />\n        <path d=\"M17.5 9.5c0 3.038-2 6.5-5.5 10.5c-3.5-4-5.5-7.462-5.5-10.5a5.5 5.5 0 1 1 11 0Z\" />\n      </g>\n    </svg>\n  );\n}\n\nreturn (\n  <Container>\n    {/* Absolute Positioning */}\n    {\n      <Profile>\n        <Button\n          onClick={() => {\n            State.update({ showForm: !state.showForm });\n          }}\n        >\n          {`${state.showForm ? \"Hide\" : \"Submit a rat sighting report.\"} `}\n          <DownIcon />\n        </Button>\n      </Profile>\n    }\n    {state.showForm && (\n      <Widget\n        src={\"efiz.near/widget/Map.Form\"}\n        props={{\n          data: state.focusedMarker || {},\n          children: props.form,\n          handleSave,\n        }}\n      />\n    )}\n\n    {state.showInspect && (\n      <Widget\n        src={\"byalbert.near/widget/Map.Inspect\"}\n        props={{\n          focusedMarker: state.focusedMarker,\n          children: props.inspect,\n        }}\n      />\n    )}\n\n    {/* Absolute Positioning */}\n    {accountId && (\n      <div\n        style={{\n          display: \"flex\",\n          justifyContent: \"center\",\n          alignItems: \"center\",\n        }}\n      >\n        <Location>\n          <Button\n            onClick={\n              state.edit\n                ? () => handleSave()\n                : () => State.update({ edit: !state.edit })\n            }\n          >\n            {`${!state.edit ? \"Edit\" : \"Save\"}`}\n            <LocationIcon />\n          </Button>\n          {state.edit && (\n            <Button\n              onClick={() => State.update({ edit: false, showForm: false })}\n            >\n              Cancel\n            </Button>\n          )}\n        </Location>\n      </div>\n    )}\n\n    <Widget\n      src={\"efiz.near/widget/Map.Mapbox\"}\n      props={{\n        API_URL,\n        accessToken: MAP_TOKEN,\n        styleUrl: MAP_STYLE,\n        center,\n        zoom,\n        markerAsset: props.markerAsset,\n        myMarkerAsset: props.myMarkerAsset,\n        markers: props.markers, // array of long, lat, id\n        myMarkers: props.myMarkers,\n        edit: state.edit,\n        onMapClick: (e) => {\n          State.update({ currentLocation: e.coordinates, showInspect: false });\n          props.onMapClick && props.onMapClick(e);\n        },\n        onMarkerClick: (e) => {\n          State.update({ focusedMarker: e, showInspect: true });\n          props.onMarkerClick && props.onMarkerClick(e);\n        },\n      }}\n    />\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/byalbert.near/widget/Map.index", "fact_widget_deployments_id": "c292c9e956e39511060b21f89f3ad847", "inserted_timestamp": "2023-10-28T19:43:42.565Z", "modified_timestamp": "2023-10-28T19:43:42.565Z", "__row_index": 2}