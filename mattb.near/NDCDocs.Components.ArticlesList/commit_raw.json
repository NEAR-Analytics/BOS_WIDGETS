{"tx_hash": "M25xxG4GSWyTrWJNWWYa32M3K1PwEC8gK4mrUpd4DE3", "action_id_social": "C8GVmgsWMwPMTSPpUR5HquNqr1YgwcrqRfiECwb9aTVA-0-widget", "block_id": 95595944, "block_timestamp": "2023-07-03T08:59:58.515Z", "signer_id": "mattb.near", "widget_name": "NDCDocs.Components.ArticlesList", "source_code": "const { allowedAuthors } = props;\n\nconst ARTICLES_ADDRESS = \"ndcWikiArticle\";\nconst ALLOWED_AUTHORS = allowedAuthors || [\n  \"neardigitalcollective.near\",\n  \"blaze.near\",\n  \"jlw.near\",\n  \"kazanderdad.near\",\n  \"joep.near\",\n  \"sarahkornfeld.near\",\n  \"yuensid.near\",\n  \"shubham007.near\",\n  \"psalm.near\",\n  \"fiftycent.near\",\n];\nconst ARTICLES_NOT_ALLOWED = [91092435, 91092174, 91051228, 91092223, 91051203];\nconst WIDGET_AUTHOR = \"neardigitalcollective.near\";\n\nState.init({\n  loaded: false,\n});\n\nconst postsIndex =\n  Social.index(ARTICLES_ADDRESS, \"main\", {\n    order: \"desc\",\n    accountId: undefined,\n  }) || [];\n\nconst ARTICLES = postsIndex\n  .reduce((acc, { accountId, blockHeight }) => {\n    const postData = Social.get(\n      `${accountId}/${ARTICLES_ADDRESS}/main`,\n      blockHeight\n    );\n\n    return [...acc, { ...JSON.parse(postData), blockHeight }];\n  }, [])\n  .filter((article) =>\n    ALLOWED_AUTHORS.some(\n      (address) =>\n        address === article.author &&\n        !ARTICLES_NOT_ALLOWED.includes(article.blockHeight)\n    )\n  );\n\nconst FILTERED_ARTICLES = ARTICLES.reduce((acc, article) => {\n  State.update({ loaded: true });\n\n  if (!acc.some(({ articleId }) => articleId === article.articleId)) {\n    return [...acc, article];\n  } else {\n    return acc;\n  }\n}, []);\n\nconst getDateLastEdit = (timestamp) => {\n  const date = new Date(Number(timestamp));\n  const dateString = {\n    date: date.toLocaleDateString(),\n    time: date.toLocaleTimeString(),\n  };\n  return dateString;\n};\n\nfunction getName(accountId) {\n  return Social.getr(`${accountId}/profile`).name || \"-\";\n}\n\nfunction getProfileImage(accountId) {\n  let image = Social.getr(`${accountId}/profile`).image || {\n    ipfs_cid: \"\",\n  };\n\n  return `https://ipfs.near.social/ipfs/${image.ipfs_cid}`;\n}\n\nconst Main = styled.div`\n    width:100%;\n    height:100vh;\n`;\n\nconst ArticlePill = styled.a`\n    display:block;\n    cursor:pointer;\n    width:100%;\n    max-width:300px;\n    height:200px;\n    background-color:rgba(0,0,0,.05);\n    border-radius:20px;\n    box-sizing:border-box;\n    padding:10px;\n    border: 2px solid transparent;\n    transition: all .2s;\n    margin:0 auto 20px;\n    text-decoration:none!important;\n    color:#000;\n\n    &:hover {\n        transition: all .2s;\n        border: 2px solid rgb(0,0,0,.02);\n    }\n`;\n\nconst ArticleTitle = styled.div`\n    display:flex;\n    align-items:center;\n    justify-content:space-between;\n    width:100%;\n    max-width:300px;\n    height:70%;\n    background-color:#fff;\n    border-radius:15px;\n    box-sizing:border-box;\n    padding:20px;\n\n    &:hover {\n      & > div ~ div {\n        opacity:1;\n        transition: all .2s;\n      }\n    }\n\n    h1 {\n        max-width:200px;\n        overflow:hidden;\n        text-overflow:ellipsis;\n        font-size:1.5rem;\n        font-weight:bold;\n        margin:0;\n        padding:0;\n\n        & ~ p {\n          opacity:.4;\n          padding:0;\n          margin:0;\n          font-size:.7rem;\n        }\n    }\n\n    & > div ~ div {\n      opacity:.4;\n      transition: all .2s;\n    }\n`;\n\nconst ArticleDetails = styled.div`\n    margin-top:5px;\n    display:flex;\n    align-items:center;\n    width:100%;\n    max-width:300px;\n    height:30%;\n`;\n\nconst Wrapper = styled.div`\n    h2 {\n        font-size:.8rem;\n        letter-spacing:-.5px;\n        padding:0;\n        margin:0;\n        margin-left:5px;\n\n        & ~ p {\n          opacity:.4;\n          padding:0;\n          margin:0;\n          font-size:.7rem;\n          margin-left:5px;\n        }\n    }\n`;\n\nconst Avatar = styled.div`\n    border-radius:100%;\n    width:40px;\n    height:40px;\n    background-color:rgba(0,0,0,.05);\n    background-position:center;\n    background-size:cover;\n    background-repeat:no-repeat;\n`;\n\nconst arrowImg = (\n  <img\n    src=\"https://ipfs.near.social/ipfs/bafkreigygnp234eyi5ljtxf7czp5emmhihjxitbl6e4zzuol3wgxsvkhcu\"\n    style={{\n      maxWidth: \"20px\",\n    }}\n  />\n);\n\nreturn (\n  <>\n    {state.loaded &&\n      FILTERED_ARTICLES.map((article) => (\n        <>\n          <ArticlePill\n            href={`#/neardigitalcollective.near/widget/NDCDocs_OneArticle?articleId=${article.articleId}&blockHeight=${article.blockHeight}&lastEditor=${article.lastEditor}\n            `}\n          >\n            <ArticleTitle>\n              <div>\n                <h1>{article.articleId}</h1>\n                <p>Published on {getDateLastEdit(article.timeCreate).date}</p>\n                <p>Last edit by {article.lastEditor}</p>\n              </div>\n              <div>{arrowImg}</div>\n            </ArticleTitle>\n            <ArticleDetails>\n              <Wrapper>\n                <Avatar\n                  style={{\n                    \"background-image\": `url(\"${getProfileImage(\n                      article.author\n                    )}\")`,\n                  }}\n                />\n              </Wrapper>\n              <Wrapper>\n                <h2>{getName(article.author)}</h2>\n                <p>@{article.author}</p>\n              </Wrapper>\n            </ArticleDetails>\n          </ArticlePill>\n        </>\n      ))}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/mattb.near/widget/NDCDocs.Components.ArticlesList", "fact_widget_deployments_id": "bac970f08eb4fac8d69de82ffc38eb92", "inserted_timestamp": "2000-01-01T00:00:00.000Z", "modified_timestamp": "2000-01-01T00:00:00.000Z", "__row_index": 5}