{"tx_hash": "6TSN6TR9jfiWQrJHAqsZxwSth5LYkMCNTzhVx2n4Y7HD", "action_id_social": "Fxe1cszjPcfv8Rk7DzX8h2i6xnPUsEeDRtfkgtKv3PUc-0-widget", "block_id": 98445830, "block_timestamp": "2023-08-09T20:50:21.367Z", "signer_id": "mattb.near", "widget_name": "NDCDocs.Components.ArticlesList", "source_code": "const { allowedAuthors, author } = props;\n\nconst ARTICLES_ADDRESS = \"ndcWikiArticle\";\nconst ALLOWED_AUTHORS = allowedAuthors || [\n  \"neardigitalcollective.near\",\n  \"blaze.near\",\n  \"jlw.near\",\n  \"kazanderdad.near\",\n  \"joep.near\",\n  \"sarahkornfeld.near\",\n  \"yuensid.near\",\n  \"shubham007.near\",\n  \"psalm.near\",\n  \"fiftycent.near\",\n];\nconst ARTICLES_NOT_ALLOWED = [91092435, 91092174, 91051228, 91092223, 91051203];\nconst WIDGET_AUTHOR = \"neardigitalcollective.near\";\n\nState.init({\n  loaded: false,\n  posts: [],\n});\n\nfunction getPosts() {\n  setTimeout(() => {\n    const postsIndex =\n      Social.index(ARTICLES_ADDRESS, \"main\", {\n        order: \"desc\",\n        accountId: undefined,\n      }) || [];\n\n    let articles = postsIndex\n      .reduce((acc, { accountId, blockHeight }) => {\n        const postData = Social.get(\n          `${accountId}/${ARTICLES_ADDRESS}/main`,\n          blockHeight\n        );\n\n        return [...acc, { ...JSON.parse(postData), blockHeight }];\n      }, [])\n      .filter((article) =>\n        ALLOWED_AUTHORS.some(\n          (address) =>\n            address === article.author &&\n            !ARTICLES_NOT_ALLOWED.includes(article.blockHeight)\n        )\n      );\n\n    let filteredArticles = articles.reduce((acc, article) => {\n      if (!acc.some(({ articleId }) => articleId === article.articleId)) {\n        return [...acc, article];\n      } else {\n        return acc;\n      }\n    }, []);\n\n    State.update({\n      posts: filteredArticles,\n    });\n  }, 200);\n}\n\nconst getDateLastEdit = (timestamp) => {\n  const date = new Date(Number(timestamp));\n  const dateString = {\n    date: date.toLocaleDateString(),\n    time: date.toLocaleTimeString(),\n  };\n  return dateString;\n};\n\nfunction getName(accountId) {\n  return Social.getr(`${accountId}/profile`).name || \"-\";\n}\n\nfunction getProfileImage(accountId) {\n  let image = Social.getr(`${accountId}/profile`).image || {\n    ipfs_cid: \"\",\n  };\n\n  return `https://ipfs.near.social/ipfs/${image.ipfs_cid}`;\n}\n\nconst Main = styled.div`\n    display:flex;\n    flex-wrap:wrap;\n    justify-content:space-evenly;\n    width:100%;\n    min-height:100vh;\n`;\n\nconst ArticlePill = styled.a`\n    display:block;\n    cursor:pointer;\n    width:100%;\n    max-width:300px;\n    height:200px;\n    background-color:rgba(0,0,0,.05);\n    border-radius:20px;\n    box-sizing:border-box;\n    padding:10px;\n    border: 2px solid transparent;\n    transition: all .2s;\n    margin:0 auto 20px;\n    text-decoration:none!important;\n    color:#000;\n\n    &:hover {\n        transition: all .2s;\n        border: 2px solid rgb(0,0,0,.02);\n    }\n\n    @keyframes loading {\n      0% {\n        opacity: 0.5;\n      }\n\n      100% { \n        opacity: 1;\n      }\n    }\n\n    &.loading {\n      animation-name:loading;\n      animation-duration:.5s;\n      animation-iteration-count:infinite;\n      animation-fill-mode:both;\n      animation-direction: alternate;\n    }\n\n`;\n\nconst ArticleTitle = styled.div`\n    display:flex;\n    align-items:center;\n    justify-content:space-between;\n    width:100%;\n    max-width:300px;\n    height:70%;\n    background-color:#fff;\n    border-radius:15px;\n    box-sizing:border-box;\n    padding:20px;\n\n    &:hover {\n      & > div ~ div {\n        opacity:1;\n        transition: all .2s;\n      }\n    }\n\n    h1 {\n        max-width:200px;\n        overflow:hidden;\n        text-overflow:ellipsis;\n        font-size:1.2rem;\n        font-weight:bold;\n        margin:0;\n        padding:0;\n\n        & ~ p {\n          opacity:.4;\n          padding:0;\n          margin:0;\n          font-size:.7rem;\n        }\n    }\n\n    & > div ~ div {\n      opacity:.4;\n      transition: all .2s;\n    }\n\n    &.skeleton {\n      h1 {\n        color:transparent;\n        background-color:rgba(0,0,0,.02);\n        border-radius:5px;\n      }\n      p {\n        color:transparent;\n        background-color:rgba(0,0,0,.05);\n        border-radius:3px;\n        margin-top:5px;\n      }\n    }\n`;\n\nconst ArticleDetails = styled.div`\n    margin-top:5px;\n    display:flex;\n    align-items:center;\n    width:100%;\n    max-width:300px;\n    height:30%;\n    color:#000;\n\n    &.skeleton {\n      h2 {\n        color:transparent;\n        background-color:rgba(0,0,0,.02);\n        border-radius:5px;\n      }\n      p {\n        color:transparent;\n        background-color:rgba(0,0,0,.05);\n        border-radius:3px;\n        margin-top:5px;\n      }\n    }\n`;\n\nconst Wrapper = styled.div`\n    h2 {\n        font-size:.8rem;\n        letter-spacing:-.5px;\n        padding:0;\n        margin:0;\n        margin-left:5px;\n\n        & ~ p {\n          opacity:.4;\n          padding:0;\n          margin:0;\n          font-size:.7rem;\n          margin-left:5px;\n        }\n    }\n`;\n\nconst Avatar = styled.div`\n    border-radius:100%;\n    width:40px;\n    height:40px;\n    background-color:rgba(0,0,0,.05);\n    background-position:center;\n    background-size:cover;\n    background-repeat:no-repeat;\n`;\n\nconst arrowImg = (\n  <img\n    src=\"https://ipfs.near.social/ipfs/bafkreigygnp234eyi5ljtxf7czp5emmhihjxitbl6e4zzuol3wgxsvkhcu\"\n    style={{\n      maxWidth: \"20px\",\n    }}\n  />\n);\n\nfunction getSkeleton() {\n  return (\n    <>\n      {Array.from(Array(15).keys()).map(() => (\n        <ArticlePill className=\"loading\">\n          <ArticleTitle className=\"skeleton\">\n            <div>\n              <h1>TheNDC</h1>\n              <p>Published on 03/07/2023</p>\n              <p>Last edit by blaze.near</p>\n            </div>\n            <div></div>\n          </ArticleTitle>\n          <ArticleDetails className=\"skeleton\">\n            <Wrapper>\n              <Avatar />\n            </Wrapper>\n            <Wrapper>\n              <h2>NEAR Digital Collective</h2>\n              <p>@neardigitalcollective.near</p>\n            </Wrapper>\n          </ArticleDetails>\n        </ArticlePill>\n      ))}\n    </>\n  );\n}\n\nconst getArticleLink = (idx) => {\n  let article = state.posts[idx];\n  return article\n    ? `#/mattb.near/widget/NDCDocs.Components.Article?articleId=${article.articleId}&blockHeight=${article.blockHeight}&lastEditor=${article.lastEditor}`\n    : \"\";\n};\n\nconst getControls = (idx) => {\n  let nextArticleLink = getArticleLink(idx + 1);\n  let previousArticleLink = getArticleLink(idx - 1);\n\n  let nextArticleLinkParams = nextArticleLink\n    ? `&nextArticleLink=${nextArticleLink}&nextArticleName=${\n        state.posts[idx + 1].articleId\n      }`\n    : \"\";\n\n  let previousArticleLinkParams = previousArticleLink\n    ? `&previousArticleLink=${previousArticleLink}&previousArticleName=${\n        state.posts[idx - 1].articleId\n      }`\n    : \"\";\n\n  return nextArticleLinkParams + previousArticleLinkParams;\n};\n\nconst getFullArticleLink = (idx) => {\n  let currentLink = getArticleLink(idx);\n  let controls = getControls(idx);\n\n  return `${currentLink}${controls}`;\n};\n\nreturn (\n  <Main>\n    {!state.posts.length && getSkeleton()}\n    {getPosts()}\n    {!!state.posts.length &&\n      state.posts\n        .filter((post) => (author ? post.author == author : true))\n        .map((article, idx) => (\n          <>\n            <ArticlePill href={getArticleLink(idx)}>\n              <ArticleTitle>\n                <div>\n                  <h1>{article.articleId}</h1>\n                  <p>Published on {getDateLastEdit(article.timeCreate).date}</p>\n                  <p>Last edit by {article.lastEditor}</p>\n                </div>\n                <div>{arrowImg}</div>\n              </ArticleTitle>\n              <ArticleDetails>\n                <Wrapper>\n                  <Avatar\n                    style={{\n                      \"background-image\": `url(\"${getProfileImage(\n                        article.author\n                      )}\")`,\n                    }}\n                  />\n                </Wrapper>\n                <Wrapper>\n                  <h2>{getName(article.author)}</h2>\n                  <p>@{article.author}</p>\n                </Wrapper>\n              </ArticleDetails>\n            </ArticlePill>\n          </>\n        ))}\n  </Main>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/mattb.near/widget/NDCDocs.Components.ArticlesList", "fact_widget_deployments_id": "615a623f25f4bf4894416476c5cd7a64", "inserted_timestamp": "2023-08-09T22:25:49.420Z", "modified_timestamp": "2023-08-09T22:25:49.420Z", "__row_index": 0}