{"tx_hash": "FJHnVpVwYkgdnx5SgwyxTS75STPA7iXcdTXJcE5ejEEz", "action_id_social": "RoKqHUXJrJ9AxyHFoT1khxxcugGJ9L61CiaAaBJFj2V-0-widget", "block_id": 100916449, "block_timestamp": "2023-09-11T22:55:28.182Z", "signer_id": "mattb.near", "widget_name": "NearBox.Components.WriteMessage", "source_code": "const { MailChain, onRefresh, onMessageSent } = props;\nconst DEFAULT_TITLE = \"New message\";\n\nState.init({\n  message: {\n    from: MailChain.user.address,\n    to: \"\",\n    subject: \"\",\n    body: \"\",\n  },\n  userReachable: null,\n  timeout: null\n});\n\nconst checkAddress = () => {\n  clearTimeout(state.timeout);\n\n  State.update({\n    timeout: setTimeout(() => {\n    MailChain.addressIsReachable(state.message.to).then((reachable) => State.update({ userReachable: reachable }) );\n  }, 1500)\n  });\n};\n\nconst WriteMessage = styled.div`\n  width:100%;\n  min-width:500px;\n  background-color:#fff;\n  overflow:hidden;\n`;\n\nconst Header = styled.div`\n    display:flex;\n    justify-content:space-between;\n    width:100%;\n    padding:.8rem;\n    box-sizing:border-box;\n    background-color:#000;\n    border: 1px solid rgba(255,255,255,.1);\n    border-bottom:0;\n    border-top-left-radius:10px;\n    border-top-right-radius:10px;\n\n    p {\n        margin:0;\n        padding:0;\n        font-weight:bold;\n        max-width:200px;\n        overflow:hidden;\n        text-overflow:ellipsis;\n        white-space:nowrap;\n        color:#fff;\n        font-size:.9rem;\n\n        + p {\n          font-weight:normal;\n          cursor:pointer;\n        }\n    }\n`;\n\nconst Body = styled.div`\n    box-sizing:border-box;\n    padding:1rem;\n    border:2px solid rgba(0,0,0,.05);\n    border-top:0;\n    border-bottom-left-radius:7px;\n    border-bottom-right-radius:7px;\n\n    input {\n        margin-bottom:1.5rem;\n    }\n\n    span {\n      padding:0 1rem;\n      border-radius:20px;\n      position:absolute;\n      right:0;\n      font-size:.8rem;\n      color:#fff;\n    }\n\n    .reachable {\n      background-color:#4ab54a;\n    }\n\n    .unreachable {\n      background-color:#d12323;\n    }\n\n    textarea {\n        width:100%;\n        height:300px;\n        border:0;\n        border-radius:10px;\n        resize:none;\n        box-sizing:border-box;\n        font-size:1.2rem;\n        outline-style:none;\n        margin-top:.5rem;\n    }\n`;\n\nconst Input = styled.input`\n    width:100%;\n    border:0;\n    border-bottom: 1px solid rgba(0,0,0,.1);\n    padding:.2rem 0;\n    font-size:.8rem;\n    outline-style:none;\n    transition: all .2s;\n\n    :placeholder {\n        font-size:.8rem;\n    }\n\n    :hover {\n        border-color: rgba(0,0,0,.2);\n        transition: all .2s;\n    }\n\n    :focus {\n        border-color: #0178D4;\n        transition: all .2s;\n    }\n`;\n\nconst ToolBox = styled.div`\n  border-top:2px solid rgba(0,0,0,.05);\n  padding-top:.3rem;\n`;\n\nconst SendButton = styled.button`\n    max-width:100px;\n    margin-top:10px;\n    display:flex;\n    justify-content:center;\n    align-items:center;\n    width:100%;\n    height:30px;\n    background-color: #000;\n    border:0;\n    color:#fff;\n    border-radius:30px;\n    font-size:.9rem;\n\n    :disabled {\n      opacity:.5;\n    }\n`;\n\nreturn (\n  <WriteMessage>\n    <Header>\n      <p>{state.message.subject || DEFAULT_TITLE}</p>\n      <p onClick={() => onRefresh({ writeMessage: false })}>Cancel</p>\n    </Header>\n    <Body>\n      <div style={{\n        position: \"relative\"\n      }}>\n      {state.userReachable !== null && state.message.to && <span className={`${state.userReachable ? \"reachable\" : \"unreachable\"}`}>{state.userReachable ? \"Available\" : \"Unavailable\"}</span>}\n      <Input\n        type=\"text\"\n        placeholder=\"To (user.near)\"\n        value={state.message.to}\n        onChange={(e) => {\n          State.update({\n            message: {\n              ...state.message,\n              to: e.target.value,\n            }\n          });\n          checkAddress();\n        }}\n      />\n      </div>\n      <Input\n        type=\"text\"\n        placeholder=\"Subject\"\n        value={state.message.subject}\n        onChange={(e) => {\n          State.update({\n            message: {\n              ...state.message,\n              subject: e.target.value,\n            },\n          });\n        }}\n      />\n      <textarea\n        placeholder=\"Type your message here...\"\n        value={state.message.body}\n        onChange={(e) => {\n          State.update({\n            message: {\n              ...state.message,\n              body: e.target.value,\n            },\n          });\n        }}\n      />\n      <ToolBox>\n        <SendButton\n          disabled={!state.message.body || !state.userReachable}\n          onClick={() => {\n            MailChain.send(\n              state.message.to,\n              state.message.subject,\n              state.message.body\n            ).then((response) => {\n              if (response) {\n                onRefresh({ writeMessage: false });\n                onMessageSent(state.message);\n              }\n            });\n          }}\n        >\n          Send\n        </SendButton>\n      </ToolBox>\n    </Body>\n  </WriteMessage>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/mattb.near/widget/NearBox.Components.WriteMessage", "fact_widget_deployments_id": "efe79b66545c0e00b8a565afc424bf4e", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}