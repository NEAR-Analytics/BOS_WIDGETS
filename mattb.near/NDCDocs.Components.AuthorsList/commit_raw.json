{"tx_hash": "ASX6SUpQq4oSHuhNwRKw6hAALmwoVtcRpUv3448JgXKB", "action_id_social": "CYVKHuAN7kk9gjbBsBWRRU9yhSdMuRuqTJGaau8tjDbK-0-widget", "block_id": 98446571, "block_timestamp": "2023-08-09T21:06:10.028Z", "signer_id": "mattb.near", "widget_name": "NDCDocs.Components.AuthorsList", "source_code": "State.init({\n  selectedAuthor: null,\n});\n\nconst WIDGET_OWNER = \"mattb.near\";\nconst addressForArticles = \"ndcWikiArticle\";\nconst writersWhiteList = [\n  \"neardigitalcollective.near\",\n  \"blaze.near\",\n  \"jlw.near\",\n  \"kazanderdad.near\",\n  \"joep.near\",\n  \"sarahkornfeld.near\",\n  \"yuensid.near\",\n  \"shubham007.near\",\n  \"psalm.near\",\n  \"fiftycent.near\",\n];\n\nconst articleBlackList = [\n  91092435, 91092174, 91051228, 91092223, 91051203, 91051228,\n];\n\n// ========== GET INDEX ARRAY FOR ARTICLES ==========\nconst postsIndex = Social.index(addressForArticles, \"main\", {\n  order: \"desc\",\n  accountId: undefined,\n}).filter((article) => !articleBlackList.includes(article.blockHeight));\n// ========== GET ALL ARTICLES ==========\nconst resultArticles =\n  postsIndex &&\n  postsIndex\n    .reduce((acc, { accountId, blockHeight }) => {\n      const postData = Social.get(\n        `${accountId}/${addressForArticles}/main`,\n        blockHeight\n      );\n      return [...acc, JSON.parse(postData)];\n    }, [])\n    .filter((article) =>\n      writersWhiteList.some((addr) => addr === article.author)\n    );\n// ========== FILTER DUBLICATES ==========\nconst filteredArticles =\n  resultArticles.length &&\n  resultArticles.reduce((acc, article) => {\n    if (!acc.some(({ articleId }) => articleId === article.articleId)) {\n      return [...acc, article];\n    } else {\n      return acc;\n    }\n  }, []);\n\nconst authors =\n  filteredArticles.length &&\n  Array.from(filteredArticles, ({ author }) => author);\n\nconst getAuthorsStats = (acc, author) => {\n  if (!acc.hasOwnProperty(author)) {\n    acc[author] = 0;\n  }\n  acc[author] += 1;\n  return acc;\n};\n\nconst countAuthors = (arr) => arr.reduce(getAuthorsStats, {});\n\nconst authorsCountObject = filteredArticles.length && countAuthors(authors);\n\nconst authorsCountArray =\n  filteredArticles.length && Object.entries(authorsCountObject);\n\nfunction getName(accountId) {\n  return Social.getr(`${accountId}/profile`).name || \"-\";\n}\n\nfunction getProfileImage(accountId) {\n  let image = Social.getr(`${accountId}/profile`).image || {\n    ipfs_cid: \"\",\n  };\n\n  return `https://ipfs.near.social/ipfs/${image.ipfs_cid}`;\n}\n\nconst Main = styled.div`\n    display:flex;\n    flex-wrap:wrap;\n    justify-content:space-evenly;\n    width:100%;\n    min-height:100vh;\n`;\n\nconst AuthorPill = styled.a`\n    display:flex;\n    flex-direction:column-reverse;\n    cursor:pointer;\n    width:100%;\n    max-width:300px;\n    max-height:130px;\n    background-color:rgba(0,0,0,.05);\n    border-radius:20px;\n    box-sizing:border-box;\n    padding:0 10px 10px;\n    border: 2px solid transparent;\n    transition: all .2s;\n    margin:0 auto 20px;\n    text-decoration:none!important;\n    color:#000;\n\n    &:hover {\n        transition: all .2s;\n        border: 2px solid rgb(0,0,0,.02);\n    }\n\n    @keyframes loading {\n      0% {\n        opacity: 0.5;\n      }\n\n      100% { \n        opacity: 1;\n      }\n    }\n\n    &.loading {\n      animation-name:loading;\n      animation-duration:.5s;\n      animation-iteration-count:infinite;\n      animation-fill-mode:both;\n      animation-direction: alternate;\n    }\n\n`;\n\nconst AuthorTitle = styled.div`\n    display:flex;\n    align-items:center;\n    justify-content:space-between;\n    width:100%;\n    max-width:300px;\n    height:40%;\n    background-color:#fff;\n    border-radius:15px;\n    box-sizing:border-box;\n    padding:20px;\n\n    &:hover {\n      & > div ~ div {\n        opacity:1;\n        transition: all .2s;\n      }\n    }\n\n    h1 {\n        max-width:200px;\n        overflow:hidden;\n        text-overflow:ellipsis;\n        font-size:1.2rem;\n        font-weight:bold;\n        margin:0;\n        padding:0;\n\n        & ~ p {\n          opacity:.4;\n          padding:0;\n          margin:0;\n          font-size:.7rem;\n        }\n    }\n\n    & > div ~ div {\n      opacity:.4;\n      transition: all .2s;\n    }\n\n    &.skeleton {\n      h1 {\n        color:transparent;\n        background-color:rgba(0,0,0,.02);\n        border-radius:5px;\n      }\n      p {\n        color:transparent;\n        background-color:rgba(0,0,0,.05);\n        border-radius:3px;\n        margin-top:5px;\n      }\n    }\n`;\n\nconst AuthorDetails = styled.div`\n    margin-bottom:15px;\n    display:flex;\n    align-items:center;\n    width:100%;\n    max-width:300px;\n    color:#000;\n\n    &.skeleton {\n      h2 {\n        color:transparent;\n        background-color:rgba(0,0,0,.02);\n        border-radius:5px;\n      }\n      p {\n        color:transparent;\n        background-color:rgba(0,0,0,.05);\n        border-radius:3px;\n        margin-bottom:5px;\n      }\n    }\n`;\n\nconst Wrapper = styled.div`\n    h2 {\n        font-size:.8rem;\n        letter-spacing:-.5px;\n        padding:0;\n        margin:0;\n        margin-left:5px;\n\n        & ~ p {\n          opacity:.4;\n          padding:0;\n          margin:0;\n          font-size:.7rem;\n          margin-left:5px;\n        }\n    }\n`;\n\nconst Avatar = styled.div`\n    border-radius:100%;\n    width:40px;\n    height:40px;\n    background-color:rgba(0,0,0,.05);\n    background-position:center;\n    background-size:cover;\n    background-repeat:no-repeat;\n`;\n\nreturn (\n  <Main>\n    {!state.selectedAuthor &&\n      authorsCountArray.map(([author, totalArticles]) => (\n        <AuthorPill onClick={() => State.update({ selectedAuthor: author })}>\n          <AuthorTitle>\n            <div>\n              <h1>\n                {totalArticles} article{totalArticles > 1 ? \"s\" : \"\"}\n              </h1>\n            </div>\n            <div></div>\n          </AuthorTitle>\n          <AuthorDetails>\n            <Wrapper>\n              <Avatar\n                style={{\n                  \"background-image\": `url(\"${getProfileImage(author)}\")`,\n                }}\n              />\n            </Wrapper>\n            <Wrapper>\n              <h2>{getName(author)}</h2>\n              <p>@{author}</p>\n            </Wrapper>\n          </AuthorDetails>\n        </AuthorPill>\n      ))}\n    {state.selectedAuthor && (\n      <Widget\n        src={`${WIDGET_OWNER}/widget/NDCDocs.Components.ArticlesList`}\n        props={{\n          author: state.selectedAuthor,\n        }}\n      />\n    )}\n  </Main>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/mattb.near/widget/NDCDocs.Components.AuthorsList", "fact_widget_deployments_id": "960292592bb7d76fcbffa288f3ac583c", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}