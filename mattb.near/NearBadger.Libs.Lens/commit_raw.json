{"tx_hash": "3HA7TkYBicg9ZChaRDt3CAMdm1UgdCPwXnGR9hWCRwbJ", "action_id_social": "2JFfXLqvD9SnuAHKCUjjdC3xVM7HuZTdHh6xoebxp1gA-0-widget", "block_id": 110004916, "block_timestamp": "2024-01-09T19:30:13.336Z", "signer_id": "mattb.near", "widget_name": "NearBadger.Libs.Lens", "source_code": "const LensVerifier = VM.require(\"mattb.near/widget/SDKs.Verifiers.Lens\");\nconst LensSDK = VM.require(\"mattb.near/widget/LensSDKRequire\");\n\nconst LensLib = {\n  createProof: (address, nearAccount, onCommit, onCancel) => {\n    LensVerifier.createProof(address, nearAccount)\n      .then(({ handle, signature }) => {\n        let identity = {\n          lens: {\n            name: handle,\n            signature,\n          },\n        };\n\n        Social.set(\n          {\n            identity,\n            index: {\n              identity: JSON.stringify({\n                key: \"lens\",\n                value: {\n                  ...identity.lens,\n                },\n              }),\n            },\n          },\n          {\n            onCommit: () => {\n              if (typeof onCommit === \"function\") {\n                onCommit(handle);\n              }\n            },\n            onCancel,\n          }\n        );\n      })\n      .catch((error) => {\n        console.error(error);\n        if (typeof onCancel === \"function\") {\n          onCancel();\n        }\n      });\n  },\n  verify: (handle, nearAccount, signature) =>\n    LensVerifier.verify(handle, nearAccount, signature),\n  listRecentlyVerifiedProfiles: (options) => {\n    return LensLib.getIdentity({\n      limit: 5,\n      ...options,\n    });\n  },\n  getVerifiedProfiles: (nearAccounts) => {\n    return LensLib.getIdentity({\n      accountId: nearAccounts,\n    });\n  },\n  getVerifiedProfile: (nearAccount) => {\n    return LensLib.getIdentity({\n      accountId: nearAccount,\n      limit: 1,\n    });\n  },\n  getIdentity: (options) => {\n    return Social.index(\"identity\", \"lens\", {\n      order: \"desc\",\n      ...options,\n    });\n  },\n  getAddressHandle: () => {\n    return LensSDK.getProfileByEthereumAddress(address).then((payload) => {\n          let [profile] = payload.body.data.profiles.items;\n          return profile.handle;\n    });\n  },\n};\n\nreturn LensLib;\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/mattb.near/widget/NearBadger.Libs.Lens", "fact_widget_deployments_id": "8bc0bae60b7fa339daf90aebccb9766c", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 7}