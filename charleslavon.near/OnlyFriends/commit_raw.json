{"tx_hash": "9XXzahTvqsXStbMMbA2HUZj8M5vn7Xq4fEwGD9Hq3As8", "action_id_social": "3hVgaX1wKbPjA7CsbwaeKjmvsRkMEX54TQT1AYdzVjC8-0-widget", "block_id": 115181071, "block_timestamp": "2024-03-21T20:58:27.065Z", "signer_id": "charleslavon.near", "widget_name": "OnlyFriends", "source_code": "const { tokenId } = props;\nif (!tokenId) return \"missing required props\";\n\nState.init({\n  token: undefined,\n  message: \"Loading...\",\n});\n\nconst data = fetch(\"https://graph.mintbase.xyz\", {\n  method: \"POST\",\n  headers: {\n    \"mb-api-key\": \"anon\",\n    \"Content-Type\": \"application/json\",\n    \"x-hasura-role\": \"anonymous\",\n  },\n  body: JSON.stringify({\n    query: `\nquery Owners {\n  mb_views_nft_tokens(\n    where: {\n      nft_contract_id: {_eq: \"${tokenId}\"},\n      burned_timestamp: {_is_null: true}\n    }\n    distinct_on: owner\n  ) {\n    owner\n  }\n}\n`,\n  }),\n});\n\nconst nftMetadata = Near.view(tokenId, \"nft_metadata\");\n\nif (!data.ok || !nftMetadata) {\n  return \"\";\n}\n\nconst owners = data.body.data.mb_views_nft_tokens.map((o) => o.owner);\nconst isMember = owners.includes(context.accountId);\nconsole.log(\"owners are \", owners);\nconsole.log(\"is viewer a member? \", isMember);\n\nif (!isMember) {\n  return (\n    <div>\n      <p>\n        You are not allowed to view this content unless you own one of\n        <Link href={`https://www.mintbase.xyz/contract/${tokenId}/nfts/all/0`}>\n          {\" \"}\n          these tokens.\n        </Link>\n      </p>\n    </div>\n  );\n}\nconst p = asyncFetch(\n  `https://www.charleslavon.xyz/api/video?videoId=${tokenId}`\n);\np.then((res) => {\n  const { token } = res.body;\n  if (token) {\n    State.update({ token });\n  } else {\n    State.update({ message: \"This content is no longer available.\" });\n  }\n});\n\nconst LoaderContainer = styled.div`\n  display: flex;\n  justify-content: center;\n  align-tems: center;\n`;\n\nconst Loader = () => {\n  return (\n    <LoaderContainer className=\"loader\">\n      <span\n        className=\"spinner-grow spinner-grow-sm me-1\"\n        role=\"status\"\n        aria-hidden=\"true\"\n      />\n      {state.message}\n    </LoaderContainer>\n  );\n};\n\nconst Styled = styled.div`\n  height: 700px;\n`;\n\nreturn (\n  <>\n    {!state.token && <Loader />}\n    {state.token && (\n      <Styled id=\"styled\">\n        <iframe\n          src={`https://customer-puoqzyr3sphcaxhx.cloudflarestream.com/${state.token}/iframe`}\n          iframeResizer\n          border=\"none\"\n          style={{ height: \"100%\", width: \"100%\" }}\n          allow=\"accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;\"\n          allowfullscreen=\"true\"\n        ></iframe>\n      </Styled>\n    )}\n  </>\n);\n", "metadata": {"fork_of": "charleslavon.near/widget/OnlyFriends@112112755"}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/charleslavon.near/widget/OnlyFriends", "fact_widget_deployments_id": "72311b28fa125eb13d03c803368d6a36", "inserted_timestamp": "2024-03-21T22:28:26.777Z", "modified_timestamp": "2024-03-21T22:28:26.777Z", "__row_index": 0}