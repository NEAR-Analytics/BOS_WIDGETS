{"tx_hash": "FhQ6Fqa9uVLjGtmy3ckQ4d6k8wiC8kCvVW8MN8MVLcqN", "action_id_social": "Em4NZqvPW3f76SPCkHbkkZZBSBYrpE8FfFQyAQZvSrjK-0-widget", "block_id": 101408611, "block_timestamp": "2023-09-18T15:03:46.184Z", "signer_id": "nearhorizon.near", "widget_name": "Profile.Tech", "source_code": "const ownerId = \"nearhorizon.near\";\n\nState.init({\n  // Profile data\n  userbase: \"\",\n  userbaseError: \"\",\n  tam: \"\",\n  tamError: \"\",\n  dev: \"\",\n  devError: \"\",\n  distribution: \"\",\n  distributionError: \"\",\n  stage: \"\",\n  stageError: \"\",\n  profileIsFetched: false,\n\n  // Project data\n  integration: \"\",\n  integrationError: \"\",\n  contracts: [],\n  contractsError: \"\",\n  projectIsFetched: false,\n});\n\nif (!state.profileIsFetched) {\n  Near.asyncView(\n    \"social.near\",\n    \"get\",\n    { keys: [`${context.accountId}/profile/**`] },\n    \"final\",\n    false,\n  ).then((data) => {\n    const profile = data[`${context.accountId}`]?.profile || {};\n    State.update({\n      userbase: profile.userbase,\n      tam: profile.tam,\n      dev: profile.dev,\n      distribution: profile.distribution,\n      stage: profile.stage,\n      profileIsFetched: true,\n    });\n  });\n}\n\nif (!state.projectIsFetched) {\n  Near.asyncView(\n    ownerId,\n    \"get_project\",\n    { account_id: context.accountId },\n    \"final\",\n    false,\n  ).then((project) => {\n    State.update({\n      integration: project.integration,\n      contracts: project.contracts,\n      projectIsFetched: true,\n    });\n  });\n}\n\nlet completed = 0;\nconst total = 6;\nif (state.userbase) completed++;\nif (state.tam) completed++;\nif (state.dev) completed++;\nif (state.distribution) completed++;\nif (state.integration) completed++;\nif (state.contracts) completed++;\n\nif (!state.profileIsFetched || !state.projectIsFetched) {\n  return <>Loading...</>;\n}\n\nconst Container = styled.div`\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  gap: 1rem;\n`;\n\nconst Header = styled.div`\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  width: 100%;\n\n  @media screen and (max-width: 768px) {\n    flex-direction: column;\n    justify-content: flex-start;\n    align-items: flex-start;\n    gap: 1rem;\n  }\n\n  & > div {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n\n    & > h2 {\n      color: #000;\n      font-family: Inter;\n      font-size: 1.1875rem;\n      font-style: normal;\n      font-weight: 700;\n      line-height: normal;\n    }\n\n    & > small {\n      color: var(--ui-elements-gray, #7e868c);\n      font-family: Inter;\n      font-size: 0.875rem;\n      font-style: normal;\n      font-weight: 400;\n      line-height: 1.25rem; /* 142.857% */\n      letter-spacing: 0.00875rem;\n    }\n  }\n`;\n\nconst EditButton = styled.button`\n  display: flex;\n  height: 2.5rem;\n  padding: 0.5rem 1rem;\n  justify-content: center;\n  align-items: center;\n  gap: 0.5rem;\n  border-radius: 3.125rem;\n  border: 1px solid var(--ui-elements-light, #eceef0);\n  background: var(--background-light, #fafafa);\n  color: var(--text-text-link, #006adc);\n  text-align: center;\n  font-family: Inter;\n  font-size: 0.875rem;\n  font-style: normal;\n  font-weight: 600;\n  line-height: 142%; /* 1.2425rem */\n  letter-spacing: 0.00875rem;\n`;\n\nconst data = (\n  <>\n    <Widget\n      src={`${ownerId}/widget/Inputs.LabeledData`}\n      props={{\n        label: \"Userbase\",\n        content: state.userbase,\n      }}\n    />\n    <Widget\n      src={`${ownerId}/widget/Inputs.LabeledData`}\n      props={{\n        label: \"Total Addressable Market\",\n        content: state.tam,\n      }}\n    />\n    <Widget\n      src={`${ownerId}/widget/Inputs.LabeledData`}\n      props={{\n        label: \"Integration with NEAR\",\n        content: state.integration,\n      }}\n    />\n    <Widget\n      src={`${ownerId}/widget/Inputs.LabeledData`}\n      props={{\n        label: \"Development phase\",\n        content: state.dev,\n      }}\n    />\n    <Widget\n      src={`${ownerId}/widget/Inputs.LabeledData`}\n      props={{\n        label: \"Are you Open Source?\",\n        content: state.distribution,\n      }}\n    />\n    <Widget\n      src={`${ownerId}/widget/Inputs.LabeledData`}\n      props={{\n        label: \"What are your contracts?\",\n        content:\n          state.contracts && state.contracts.length > 0 ? (\n            <Widget\n              src={`${ownerId}/widget/Tags`}\n              props={{\n                tags: Object.fromEntries(state.contracts.map((c) => [c, \"\"])),\n              }}\n            />\n          ) : null,\n      }}\n    />\n  </>\n);\n\nconst { edit: _, ...editData } = state;\n\nconst edit = (\n  <Widget\n    src={`${ownerId}/widget/Profile.TechForm`}\n    props={{\n      data: editData,\n      save: state.save,\n      onSave: (data) => {\n        State.update({ save: false });\n\n        const profileKeys = [\"userbase\", \"tam\", \"dev\", \"distribution\"];\n        const projectKeys = [\"integration\", \"contracts\"];\n\n        const profileData = {};\n\n        for (const key of profileKeys) {\n          if (Array.isArray(data[key])) {\n            if (\n              data[key].every((v) => state[key].includes(v)) &&\n              state[key].every((v) => data[key].includes(v)) &&\n              data[key].length === state[key].length\n            ) {\n              continue;\n            }\n          }\n\n          if (typeof data[key] === \"object\") {\n            if (\n              Object.keys(data[key]).every(\n                (k) => data[key][k] === state[key][k],\n              ) &&\n              Object.keys(state[key]).every(\n                (k) => data[key][k] === state[key][k],\n              )\n            ) {\n              continue;\n            }\n          }\n\n          if (data[key] !== state[key]) {\n            profileData[key] = data[key];\n          }\n        }\n\n        const projectData = {};\n\n        for (const key of projectKeys) {\n          if (Array.isArray(data[key])) {\n            if (\n              data[key].every((v) => state[key].includes(v)) &&\n              state[key].every((v) => data[key].includes(v)) &&\n              data[key].length === state[key].length &&\n              data[key].length > 0\n            ) {\n              continue;\n            }\n          }\n\n          if (typeof data[key] === \"object\") {\n            if (\n              Object.keys(data[key]).every(\n                (k) => data[key][k] === state[key][k],\n              ) &&\n              Object.keys(state[key]).every(\n                (k) => data[key][k] === state[key][k],\n              )\n            ) {\n              continue;\n            }\n          }\n\n          if (data[key] !== state[key]) {\n            projectData[key] = data[key];\n          }\n        }\n\n        if (\n          Object.keys(profileData).length > 0 &&\n          Object.keys(projectData).length === 0\n        ) {\n          Social.set(\n            { profile: profileData },\n            {\n              onCommit: () => {\n                State.update({ ...profileData, edit: false });\n              },\n            },\n          );\n          return;\n        }\n\n        if (\n          Object.keys(profileData).length === 0 &&\n          Object.keys(projectData).length > 0\n        ) {\n          Near.call(ownerId, \"edit_project\", {\n            project: projectData,\n            account_id: context.accountId,\n          });\n          return;\n        }\n\n        if (\n          Object.keys(profileData).length > 0 &&\n          Object.keys(projectData).length > 0\n        ) {\n          Near.call([\n            {\n              contractName: ownerId,\n              methodName: \"edit_project\",\n              args: { project: projectData, account_id: context.accountId },\n            },\n            {\n              contractName: \"social.near\",\n              methodName: \"set\",\n              args: {\n                data: {\n                  [context.accountId]: { profile: profileData },\n                },\n              },\n            },\n          ]);\n          return;\n        }\n      },\n    }}\n  />\n);\n\nconst EditButtons = styled.div`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  gap: 1rem;\n  width: 100%;\n`;\n\nconst CancelButton = styled.button`\n  display: flex;\n  height: 2.5rem;\n  padding: 0.5rem 1rem;\n  justify-content: center;\n  align-items: center;\n  gap: 0.5rem;\n  border-radius: 3.125rem;\n  border: 1px solid var(--ui-elements-light, #eceef0);\n  background: var(--background-light, #fafafa);\n  color: var(--text-text-primary, #101828);\n  text-align: center;\n  font-family: Inter;\n  font-size: 0.875rem;\n  font-style: normal;\n  font-weight: 600;\n  line-height: 142%; /* 1.2425rem */\n  letter-spacing: 0.00875rem;\n`;\n\nconst SaveButton = styled.button`\n  display: flex;\n  height: 2.5rem;\n  padding: 0.5rem 1rem;\n  justify-content: center;\n  align-items: center;\n  gap: 0.5rem;\n  border-radius: 3.125rem;\n  background: var(--primary-primary-default, #00ec97);\n  border: 1px solid var(--primary-primary-default, #00ec97);\n  color: var(--text-text-dark, #11181c);\n  text-align: center;\n  font-family: \"Mona Sans\";\n  font-size: 0.875rem;\n  font-style: normal;\n  font-weight: 600;\n  line-height: 142%; /* 1.2425rem */\n  letter-spacing: 0.00875rem;\n`;\n\nconst editButtons = (\n  <>\n    <CancelButton onClick={() => State.update({ edit: false })}>\n      Cancel\n    </CancelButton>\n    <SaveButton onClick={() => State.update({ save: true })}>\n      <svg\n        width=\"18\"\n        height=\"18\"\n        viewBox=\"0 0 18 18\"\n        fill=\"none\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n      >\n        <path\n          d=\"M15 4.5L6.75 12.75L3 9\"\n          stroke=\"currentColor\"\n          stroke-width=\"1.66667\"\n          stroke-linecap=\"round\"\n          stroke-linejoin=\"round\"\n        />\n      </svg>\n      Update section\n    </SaveButton>\n  </>\n);\n\nreturn (\n  <Container>\n    <Header>\n      <div>\n        <h2>Marketing & techical info</h2>\n        <small>\n          Completed:{\" \"}\n          {(completed / total).toLocaleString(\"en-GB\", { style: \"percent\" })}\n        </small>\n      </div>\n      {state.edit ? (\n        <div>{editButtons}</div>\n      ) : (\n        <EditButton onClick={() => State.update({ edit: !state.edit })}>\n          <svg\n            width=\"18\"\n            height=\"18\"\n            viewBox=\"0 0 18 18\"\n            fill=\"none\"\n            xmlns=\"http://www.w3.org/2000/svg\"\n          >\n            <path\n              d=\"M8.99998 15.0002H15.75M2.25 15.0002H3.50591C3.87279 15.0002 4.05624 15.0002 4.22887 14.9587C4.38192 14.922 4.52824 14.8614 4.66245 14.7791C4.81382 14.6864 4.94354 14.5567 5.20296 14.2972L14.625 4.87517C15.2463 4.25385 15.2463 3.24649 14.625 2.62517C14.0037 2.00385 12.9963 2.00385 12.375 2.62517L2.95295 12.0472C2.69352 12.3067 2.5638 12.4364 2.47104 12.5877C2.3888 12.722 2.32819 12.8683 2.29145 13.0213C2.25 13.194 2.25 13.3774 2.25 13.7443V15.0002Z\"\n              stroke=\"currentColor\"\n              stroke-width=\"1.66667\"\n              stroke-linecap=\"round\"\n              stroke-linejoin=\"round\"\n            />\n          </svg>\n          Edit section\n        </EditButton>\n      )}\n    </Header>\n    {state.edit ? (\n      <>\n        {edit}\n        <EditButtons>{editButtons}</EditButtons>\n      </>\n    ) : (\n      data\n    )}\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/nearhorizon.near/widget/Profile.Tech", "fact_widget_deployments_id": "b3af4989233c2a0df32846e3fe002e36", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 2}