{"tx_hash": "HreEUDqVMFNBAn6R5X8zjgJWfMZ4Rktd7jNmpXjRzqPq", "action_id_social": "8pZRn8jMimY1W4Axgt1PG6zTcvp9kPFGGhPfHRWcBwLk-0-widget", "block_id": 117559504, "block_timestamp": "2024-04-25T01:33:54.086Z", "signer_id": "flowscience.near", "widget_name": "getSchema", "source_code": "// Example schema UID: 0x6ab5d34260fca0cfcf0e76e96d439cace6aa7c3c019d7c4580ed52c6845e9c89\n\nconst user = Ethers.send(\"eth_requestAccounts\", [])[0];\n\nif (!user) return <Web3Connect connectLabel=\"Connect\" />;\n\n// Move this to function components??\nconst provider = new ethers.providers.JsonRpcProvider(\n  \"https://optimism.drpc.org\"\n);\n\nconst signer = provider.getSigner(user);\n// console.log(\"chain:\", chain);\n// console.log(\"signer:\", signer);\n\nconst abi = fetch(\n  \"https://raw.githubusercontent.com/ethereum-attestation-service/eas-contracts/939c0fb110ea35e601e4476e81a4f83a6029f7ad/deployments/optimism/SchemaRegistry.json\"\n);\nconst contractAddress = \"0x4200000000000000000000000000000000000020\";\nconst parsedAbi = JSON.parse(abi.body);\nconst contract = new ethers.Contract(contractAddress, parsedAbi.abi, signer);\nconsole.log(parsedAbi);\nconsole.log(contract);\n\nconst [schemaRecord, setSchemaRecord] = useState(null);\nconst [error, setError] = useState(\"\");\nconst [uid, setUid] = useState(\"\");\n\nfunction getSchema() {\n  if (typeof uid !== \"string\" || uid.trim() === \"\") {\n    console.error(\"UID must be a non-empty string.\");\n    setError(\"UID must be provided.\");\n    return;\n  }\n\n  contract\n    .getSchema(uid)\n    .then((result) => {\n      const [uid, resolver, revocable, schema] = result;\n      const mappedSchema = {\n        uid,\n        resolver,\n        revocable,\n        schema,\n      };\n      setSchemaRecord(mappedSchema);\n      setError(\"\");\n    })\n    .catch((error) => {\n      console.error(\"error fetching schema:\", error);\n      setError(\"Failed to retrieve data. Please try with a verified uid.\");\n    });\n}\n\nreturn (\n  <>\n    <div className=\"m-2\">\n      <h3>Get Schema</h3>\n      <input\n        type=\"text\"\n        placeholder=\"input UID\"\n        value={uid}\n        onChange={(e) => setUid(e.target.value)}\n      />\n    </div>\n    <div className=\"m-2\">\n      <button className=\"btn btn-primary m-1\" onClick={getSchema}>\n        Get Schema\n      </button>\n      <p className=\"m-1\">{error}</p>\n    </div>\n    <div>\n      {schemaRecord && (\n        <div className=\"App\">\n          <pre>{JSON.stringify(schemaRecord, null, 2)}</pre>\n        </div>\n      )}\n    </div>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/flowscience.near/widget/getSchema", "fact_widget_deployments_id": "ab4e0127c5ed47fc6d504f8d4be59776", "inserted_timestamp": "2024-04-25T03:11:56.362Z", "modified_timestamp": "2024-04-25T03:11:56.362Z", "__row_index": 2}