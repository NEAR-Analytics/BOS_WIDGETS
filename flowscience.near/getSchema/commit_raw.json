{"tx_hash": "A6qFo3nLNpWuiVYAvJ6ThZh9mrhSYcg97zL2dMHGHnDY", "action_id_social": "nFq8zCMMAyJzawnzpa4sAkHFsAu6aDHTyuqpEhjWUh1-0-widget", "block_id": 116519743, "block_timestamp": "2024-04-10T05:56:20.213Z", "signer_id": "flowscience.near", "widget_name": "getSchema", "source_code": "// Example attestation UID: 0xff5dc0cdc3de27dfe6a4352c596c0f97b1f99c51a67bbae142ce315e34969dcd\r\n\r\n// Need to finish getAttestation refactor to imported component\r\n//const { getAttestation } = VM.require(\"flowscience.near/widget/generateUID\");\r\nconst { easRenderAttestation } = VM.require(\r\n  \"flowscience.near/widget/easRenderAttestation\"\r\n);\r\n\r\nconst user = Ethers.send(\"eth_requestAccounts\", [])[0];\r\n\r\nif (!user) return <Web3Connect connectLabel=\"Connect\" />;\r\n\r\n{\r\n  /*\r\nconst chain = Ethers.provider()\r\n  .getNetwork()\r\n  .{then}((chainIdData) => {\r\n    console.log(chainIdData.chainId);\r\n  });\r\n\r\nconst abi = fetch(\r\n  \"https://raw.githubusercontent.com/ethereum-attestation-service/eas-contracts/master/deployments/optimism/EAS.json\"\r\n);\r\n\r\nconst provider = new ethers.providers.JsonRpcProvider(\r\n  \"https://optimism.drpc.org\"\r\n);\r\nconst contractAddress = \"0x4200000000000000000000000000000000000021\";\r\nconst schemaContract = \"0x4200000000000000000000000000000000000020\";\r\nconst parsedAbi = JSON.parse(abi.body);\r\nconst contract = new ethers.Contract(contractAddress, parsedAbi.abi, signer);\r\nconsole.log(contract);\r\nconst [attestation, setAttestation] = useState(null);\r\n\r\nfunction getAttestation() {\r\n  if (typeof uid !== \"string\" || uid.trim() === \"\") {\r\n    console.error(\"UID must be a non-empty string.\");\r\n    setError(\"UID must be provided.\");\r\n    return;\r\n  }\r\n\r\n  contract\r\n    .getAttestation(uid)\r\n    .then((result) => {\r\n      const [\r\n        uid,\r\n        schema,\r\n        time,\r\n        expirationTime,\r\n        revocationTime,\r\n        refUID,\r\n        recipient,\r\n        attester,\r\n        revocable,\r\n        data,\r\n      ] = result;\r\n      const mappedAttestation = {\r\n        uid,\r\n        schema,\r\n        time: time.toNumber(),\r\n        expirationTime: expirationTime.toNumber(),\r\n        revocationTime: revocationTime.toNumber(),\r\n        refUID,\r\n        recipient,\r\n        attester,\r\n        revocable,\r\n        data,\r\n      };\r\n      setAttestation(mappedAttestation);\r\n      setError(\"\");\r\n    })\r\n    .catch((error) => {\r\n      console.error(\"error fetching attestation:\", error);\r\n      setError(\"Failed to retrieve data. Please try with a verified uid.\");\r\n    });\r\n}\r\n\r\n*/\r\n}\r\n\r\n// Move this to function components??\r\nconst provider = new ethers.providers.JsonRpcProvider(\r\n  \"https://optimism.drpc.org\"\r\n);\r\n\r\nconst signer = provider.getSigner(user);\r\n// console.log(\"chain:\", chain);\r\n// console.log(\"signer:\", signer);\r\n\r\nconst abi = fetch(\r\n  \"https://raw.githubusercontent.com/ethereum-attestation-service/eas-contracts/939c0fb110ea35e601e4476e81a4f83a6029f7ad/deployments/optimism/SchemaRegistry.json\"\r\n);\r\nconst contractAddress = \"0x4200000000000000000000000000000000000020\";\r\nconst parsedAbi = JSON.parse(abi.body);\r\nconst contract = new ethers.Contract(contractAddress, parsedAbi.abi, signer);\r\nconsole.log(contract);\r\nconst [schemaRecord, setSchemaRecord] = useState(null);\r\nconst [error, setError] = useState(\"\");\r\nconst [uid, setUid] = useState(\"\");\r\n\r\nfunction getSchema() {\r\n  if (typeof uid !== \"string\" || uid.trim() === \"\") {\r\n    console.error(\"UID must be a non-empty string.\");\r\n    setError(\"UID must be provided.\");\r\n    return;\r\n  }\r\n\r\n  contract\r\n    .register(uid)\r\n    .then((result) => {\r\n      const [\r\n        uid,\r\n        schema,\r\n        time,\r\n        expirationTime,\r\n        revocationTime,\r\n        refUID,\r\n        recipient,\r\n        attester,\r\n        revocable,\r\n        data,\r\n      ] = result;\r\n      const mappedSchema = {\r\n        uid,\r\n        schema,\r\n        time: time.toNumber(),\r\n        expirationTime: expirationTime.toNumber(),\r\n        revocationTime: revocationTime.toNumber(),\r\n        refUID,\r\n        recipient,\r\n        attester,\r\n        revocable,\r\n        data,\r\n      };\r\n      setSchemaRecord(mappedSchema);\r\n      setError(\"\");\r\n    })\r\n    .catch((error) => {\r\n      console.error(\"error fetching schema:\", error);\r\n      setError(\"Failed to retrieve data. Please try with a verified uid.\");\r\n    });\r\n}\r\n\r\nreturn (\r\n  <>\r\n    <div className=\"m-2\">\r\n      <h3>Get Schema</h3>\r\n      <input\r\n        type=\"text\"\r\n        placeholder=\"input UID\"\r\n        value={uid}\r\n        onChange={(e) => setUid(e.target.value)}\r\n      />\r\n    </div>\r\n    <div className=\"m-2\">\r\n      <button className=\"btn btn-primary m-1\" onClick={getAttestation}>\r\n        Get Schema\r\n      </button>\r\n      <p className=\"m-1\">{error}</p>\r\n    </div>\r\n    <div>\r\n      {attestation && (\r\n        <div className=\"App\">\r\n          <easRenderAttestation attestation={attestation} />\r\n        </div>\r\n      )}\r\n    </div>\r\n  </>\r\n);\r\n", "metadata": {"fork_of": "hack.near/widget/passport@114479597"}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/flowscience.near/widget/getSchema", "fact_widget_deployments_id": "39ba8817eb26e8f56492f66e7c238404", "inserted_timestamp": "2024-04-10T07:34:07.118Z", "modified_timestamp": "2024-04-10T07:34:07.118Z", "__row_index": 4}