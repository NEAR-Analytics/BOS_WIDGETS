{"tx_hash": "4A8hMQYMhSYKfZi9c5yrrnPfwZJ886jNsQsoHw7B54pR", "action_id_social": "GEvhwvuzcYKaVcfSGnVUnpPexKYSCpG5fmCmF3DqgSs5-0-widget", "block_id": 112941151, "block_timestamp": "2024-02-16T09:21:26.226Z", "signer_id": "flowscience.near", "widget_name": "SchemaSelector", "source_code": "const initialSchemaSrc = props.schemaSrc || \"attestations.near\";\r\nconst [newSchemaSrc, setNewSchemaSrc] = useState(initialSchemaSrc);\r\nconst [schemaSrc, setSchemaSrc] = useState(initialSchemaSrc);\r\nconst [availableSchemas, setAvailableSchemas] = useState([]);\r\nconst [isLoading, setIsLoading] = useState(true);\r\nconst [selectedSchema, setSelectedSchema] = useState(\r\n  props.selectedSchema || \"attestations.near/type/isTrue\"\r\n);\r\n\r\nconst Row = styled.div`\r\n  display: flex;\r\n  flex-direction: row;\r\n`;\r\nconst Button = styled.button`\r\n  `;\r\nconst FormContainer = styled.div`\r\n  border: 1px solid #ccc;\r\n  padding: 20px;\r\n`;\r\nconst Select = styled.select`\r\n  `;\r\nconst Label = styled.label`\r\n`;\r\nconst Input = styled.input`\r\n  `;\r\n\r\nuseEffect(() => {\r\n  const fetchSchemasList = async () => {\r\n    setIsLoading(true);\r\n    // Ensure dynamic accountId is correctly included in the query\r\n    const schemas = Social.get(`${schemaSrc}/type/**`, \"final\");\r\n    if (schemas) {\r\n      const schemasList = Object.keys(schemas).map(\r\n        (key) => `${schemaSrc}/type/${key}`\r\n      );\r\n      setAvailableSchemas(schemasList);\r\n    } else {\r\n      setAvailableSchemas([]);\r\n    }\r\n    setIsLoading(false);\r\n  };\r\n\r\n  fetchSchemasList();\r\n}, [schemaSrc]); // Depend on schemaSrc to refetch when it changes\r\n\r\nif (!schemas) {\r\n  console.error(`Failed to fetch schemas for ${schemaSrc}`);\r\n  // Handle the error appropriately in the UI\r\n}\r\n\r\nuseEffect(() => {\r\n  // Sync state with prop when it changes\r\n  setSelectedSchema(props.selectedSchema);\r\n}, [props.selectedSchema]); // Re-run effect if props.selectedSchema changes\r\n\r\nconst handleSchemaChange = (e) => {\r\n  setSelectedSchema(e.target.value);\r\n  console.log(`New schema selected: ${newSchema}`); // Log the new schema selection\r\n\r\n  if (props.onSelectedSchemaChange) {\r\n    props.onSelectedSchemaChange(e.target.value);\r\n  }\r\n};\r\n\r\nconst handleSchemaOwnerChange = (e) => {\r\n  setNewSchemaSrc(e.target.value);\r\n};\r\n\r\nconst handleApplySchemaSrc = () => {\r\n  setSchemaSrc(newSchemaSrc); // Apply the new schema source\r\n  console.log(`Applying new Schema Owner: ${newSchemaSrc}`); // Log the action\r\n};\r\n\r\nreturn (\r\n  <FormContainer>\r\n    <Label>Schema Owner:</Label>\r\n    <Row>\r\n      <Input\r\n        type=\"text\"\r\n        onChange={handleSchemaOwnerChange} // Corrected to use the handleSchemaOwnerChange function\r\n        value={newSchemaSrc}\r\n        placeholder=\"accountId\"\r\n      />\r\n      <Button onClick={handleApplySchemaSrc}>apply</Button>\r\n    </Row>\r\n    <Label>Schema:</Label>\r\n    <Row>\r\n      {isLoading ? (\r\n        <div>Loading...</div>\r\n      ) : (\r\n        <Select value={selectedSchema} onChange={handleSchemaChange}>\r\n          <option value=\"\">Choose a schema</option>\r\n          {availableSchemas.map((schema) => (\r\n            <option key={schema} value={schema}>\r\n              {schema}\r\n            </option>\r\n          ))}\r\n        </Select>\r\n      )}\r\n    </Row>\r\n  </FormContainer>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/flowscience.near/widget/SchemaSelector", "fact_widget_deployments_id": "0b61ec1bb122ac7c311ddef29587a252", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}