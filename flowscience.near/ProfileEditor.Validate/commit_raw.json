{"tx_hash": "BFaFoBy3SCkh1kssHm89eWUajxuj7gpJVk2UmwUL9Pxr", "action_id_social": "BhuyQt4CCBbLwvJuvvQNf4zcnzasLM41tGSH89nA53cq-0-widget", "block_id": 111320578, "block_timestamp": "2024-01-26T00:41:32.874Z", "signer_id": "flowscience.near", "widget_name": "ProfileEditor.Validate", "source_code": "const accountId = context.accountId;\r\n\r\nif (!accountId) {\r\n  return \"Please sign in with NEAR wallet to edit your profile\";\r\n}\r\n\r\n//let profile = Social.getr(`${accountId}/profile`);\r\nconst initialProfile = Social.getr(`${accountId}/profile`);\r\n\r\nif (initialProfile === null) {\r\n  return \"Loading\";\r\n}\r\n\r\nState.init({ profile: initialProfile });\r\n\r\n// useState to manage profile state\r\nconst [profile, setProfile] = useState(initialProfile);\r\n\r\n// Define the validation function\r\nfunction isProfileValid(profile) {\r\n  const requiredFields = [\r\n    \"name\",\r\n    \"image\",\r\n    \"backgroundImage\",\r\n    \"description\",\r\n    \"tags\",\r\n  ];\r\n\r\n  let invalidFields = requiredFields.filter(\r\n    (field) =>\r\n      typeof profile[field] !== \"string\" || profile[field].trim() === \"\"\r\n  );\r\n\r\n  const linktreeFilled =\r\n    profile.linktree &&\r\n    Array.isArray(profile.linktree.links) &&\r\n    profile.linktree.links.some(\r\n      (link) => typeof link.name === \"string\" && link.name.trim() !== \"\"\r\n    );\r\n\r\n  if (!linktreeFilled) {\r\n    invalidFields.push(\"linktree\");\r\n  }\r\n\r\n  return {\r\n    isValid: invalidFields.length === 0,\r\n    invalidFields: invalidFields,\r\n  };\r\n}\r\n\r\nconst [isValidProfile, setIsValidProfile] = useState(\r\n  isProfileValid(initialProfile)\r\n);\r\n\r\n// Independent handler for profile change\r\nfunction handleProfileChange(\r\n  updatedProfile,\r\n  setProfileFn,\r\n  setIsValidProfileFn,\r\n  State\r\n) {\r\n  setProfileFn(updatedProfile);\r\n  setIsValidProfileFn(isProfileValid(updatedProfile));\r\n  State.update({ profile: updatedProfile });\r\n}\r\n\r\nreturn (\r\n  <div className=\"row\">\r\n    <div className=\"col-lg-6\">\r\n      <div>\r\n        <h4>Edit profile of @{accountId}</h4>\r\n      </div>\r\n      <div className=\"mb-2\">\r\n        <Widget\r\n          src=\"near/widget/MetadataEditor\"\r\n          props={{\r\n            initialMetadata: profile,\r\n            onChange: (updatedProfile) =>\r\n              handleProfileChange(\r\n                updatedProfile,\r\n                setProfile,\r\n                setIsValidProfile,\r\n                State\r\n              ),\r\n            options: {\r\n              name: { label: \"Name\" },\r\n              image: { label: \"Profile picture\" },\r\n              backgroundImage: { label: \"Background image\" },\r\n              description: { label: \"About\" },\r\n              tags: {\r\n                label: \"Tags\",\r\n                tagsPattern: \"*/profile/tags/*\",\r\n                placeholder:\r\n                  \"rust, engineer, artist, humanguild, nft, learner, founder\",\r\n              },\r\n              linktree: {\r\n                links: [\r\n                  {\r\n                    label: \"Twitter\",\r\n                    prefix: \"https://twitter.com/\",\r\n                    name: \"twitter\",\r\n                  },\r\n                  {\r\n                    label: \"Github\",\r\n                    prefix: \"https://github.com/\",\r\n                    name: \"github\",\r\n                  },\r\n                  {\r\n                    label: \"Telegram\",\r\n                    prefix: \"https://t.me/\",\r\n                    name: \"telegram\",\r\n                  },\r\n                  {\r\n                    label: \"Website\",\r\n                    prefix: \"https://\",\r\n                    name: \"website\",\r\n                  },\r\n                ],\r\n              },\r\n            },\r\n          }}\r\n        />\r\n      </div>\r\n      <div className=\"mb-2\">\r\n        <CommitButton data={{ profile: profile }} disabled={!isValidProfile}>\r\n          Save profile\r\n        </CommitButton>\r\n        <a\r\n          className=\"btn btn-outline-primary ms-2\"\r\n          href={`#/mob.near/widget/ProfilePage?accountId=${accountId}`}\r\n        >\r\n          View profile\r\n        </a>\r\n      </div>\r\n    </div>\r\n    <div className=\"col-lg-6\">\r\n      <div>\r\n        <Widget\r\n          src=\"mob.near/widget/ProfilePage\"\r\n          props={{ accountId, profile: profile }}\r\n        />\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/flowscience.near/widget/ProfileEditor.Validate", "fact_widget_deployments_id": "d46030ae726b93478a084f24974b7a89", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 14}