{"tx_hash": "un42Wuv1bno5RM86UivVcXPb5Htw18Q9YcTnHVdN4eu", "action_id_social": "4578bUpAfE1maoxjdmoCCXQLU7jfrYfLSkuWT9vMDfQ5-0-widget", "block_id": 111311843, "block_timestamp": "2024-01-25T22:01:37.404Z", "signer_id": "flowscience.near", "widget_name": "ProfileEditor.Validate", "source_code": "const accountId = context.accountId;\r\n\r\nif (!accountId) {\r\n  return \"Please sign in with NEAR wallet to edit your profile\";\r\n}\r\n\r\n//let profile = Social.getr(`${accountId}/profile`);\r\nconst initialProfile = Social.getr(`${accountId}/profile`);\r\n\r\nif (profile === null) {\r\n  return \"Loading\";\r\n}\r\n\r\nState.init({\r\n  profile,\r\n});\r\n\r\nconst [profile, setProfile] = useState(initialProfile);\r\n\r\n// Define the validation function\r\nfunction isProfileValid(profile) {\r\n  const requiredFields = [\r\n    \"name\",\r\n    \"image\",\r\n    \"backgroundImage\",\r\n    \"description\",\r\n    \"tags\",\r\n  ];\r\n  const linktreeFilled =\r\n    profile.linktree &&\r\n    Array.isArray(profile.linktree.links) &&\r\n    profile.linktree.links.some(\r\n      (link) => typeof link.name === \"string\" && link.name.trim() !== \"\"\r\n    );\r\n\r\n  return (\r\n    requiredFields.every(\r\n      (field) =>\r\n        typeof profile[field] === \"string\" && profile[field].trim() !== \"\"\r\n    ) && linktreeFilled\r\n  );\r\n}\r\n\r\n// Handler for profile change\r\n\r\nfunction handleProfileChange(updatedProfile) {\r\n  setProfile(updatedProfile);\r\n  setIsValidProfile(isProfileValid(updatedProfile)); // Update the validity state\r\n  State.update({ profile: updatedProfile });\r\n}\r\n\r\n// Check if the profile is valid\r\n//let isValidProfile = isProfileValid(profile);\r\nconst [isValidProfile, setIsValidProfile] = useState(\r\n  isProfileValid(initialProfile)\r\n);\r\n\r\nreturn (\r\n  <div className=\"row\">\r\n    <div className=\"col-lg-6\">\r\n      <div>\r\n        <h4>Edit profile of @{accountId}</h4>\r\n      </div>\r\n      <div className=\"mb-2\">\r\n        <Widget\r\n          src=\"near/widget/MetadataEditor\"\r\n          props={{\r\n            initialMetadata: profile,\r\n            onChange: handleProfileChange,\r\n            options: {\r\n              name: { label: \"Name\" },\r\n              image: { label: \"Profile picture\" },\r\n              backgroundImage: { label: \"Background image\" },\r\n              description: { label: \"About\" },\r\n              tags: {\r\n                label: \"Tags\",\r\n                tagsPattern: \"*/profile/tags/*\",\r\n                placeholder:\r\n                  \"rust, engineer, artist, humanguild, nft, learner, founder\",\r\n              },\r\n              linktree: {\r\n                links: [\r\n                  {\r\n                    label: \"Twitter\",\r\n                    prefix: \"https://twitter.com/\",\r\n                    name: \"twitter\",\r\n                  },\r\n                  {\r\n                    label: \"Github\",\r\n                    prefix: \"https://github.com/\",\r\n                    name: \"github\",\r\n                  },\r\n                  {\r\n                    label: \"Telegram\",\r\n                    prefix: \"https://t.me/\",\r\n                    name: \"telegram\",\r\n                  },\r\n                  {\r\n                    label: \"Website\",\r\n                    prefix: \"https://\",\r\n                    name: \"website\",\r\n                  },\r\n                ],\r\n              },\r\n            },\r\n          }}\r\n        />\r\n      </div>\r\n      <div className=\"mb-2\">\r\n        <CommitButton data={{ profile: profile }} disabled={!isValidProfile}>\r\n          Save profile\r\n        </CommitButton>\r\n        <a\r\n          className=\"btn btn-outline-primary ms-2\"\r\n          href={`#/mob.near/widget/ProfilePage?accountId=${accountId}`}\r\n        >\r\n          View profile\r\n        </a>\r\n      </div>\r\n    </div>\r\n    <div className=\"col-lg-6\">\r\n      <div>\r\n        <Widget\r\n          src=\"mob.near/widget/ProfilePage\"\r\n          props={{ accountId, profile: profile }}\r\n        />\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/flowscience.near/widget/ProfileEditor.Validate", "fact_widget_deployments_id": "944445a74cd395b4fa7a07aa3854b082", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 4}