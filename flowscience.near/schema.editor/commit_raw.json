{"tx_hash": "FFQkAsN81NLoYeTeJke1qVgshCj9pGCR7AvoEdFJjZ2k", "action_id_social": "7QVRRV2qULEZkxXqn8ywceBoxjkrYbn3JJez7SLC19dt-0-widget", "block_id": 111344845, "block_timestamp": "2024-01-26T08:00:49.637Z", "signer_id": "flowscience.near", "widget_name": "schema.editor", "source_code": "const typeSrc = props.typeSrc || \"\";\r\nconst blockHeight = props.blockHeight || \"final\";\r\nlet type = {\r\n  name: \"\",\r\n  properties: [],\r\n  widgets: {},\r\n};\r\n\r\nState.init({\r\n  newType: typeSrc,\r\n  typeName: type.name || \"\",\r\n  properties: type.properties || [],\r\n  widgets: type.widgets || {},\r\n  newPropertyName: \"\",\r\n  newPropertyType: \"string\",\r\n  newWidgetKey: \"\",\r\n  newWidgetSrc: \"\",\r\n  newTypeSrc: \"hyperfiles.near\",\r\n  typeSrc: \"hyperfiles.near\",\r\n  expanded: false,\r\n});\r\n\r\nlet importedTypes = [];\r\nif (state.typeSrc !== \"\") {\r\n  const types = Social.get(`${state.typeSrc}/type/**`, \"final\");\r\n  if (!types) {\r\n    return <></>;\r\n  }\r\n  importedTypes =\r\n    Object.keys(types)?.map((it) => `${state.typeSrc}/type/${it}`) || [];\r\n}\r\n\r\nconst availableTypes = JSON.parse(props.availableTypes) || [\r\n  \"string\",\r\n  \"boolean\",\r\n  \"number\",\r\n  \"date\",\r\n  \"time\",\r\n  \"tags\",\r\n  ...importedTypes,\r\n];\r\n\r\nconst Container = styled.div`\r\n  margin: 20px 0;\r\n`;\r\n\r\nconst FormContainer = styled.div`\r\n  border: 1px solid #ccc;\r\n  padding: 20px;\r\n`;\r\n\r\nconst Row = styled.div`\r\n  display: flex;\r\n  gap: 10px;\r\n`;\r\n\r\nconst Input = styled.input`\r\n  flex: 1;\r\n  max-width: 200px;\r\n  margin-bottom: 10px;\r\n  height: 30px;\r\n`;\r\n\r\nconst Select = styled.select`\r\n  height: 30px;\r\n`;\r\n\r\nconst Button = styled.button`\r\n  height: 30px;\r\n`;\r\n\r\nconst Text = styled.p`\r\n  display: inline-block;\r\n  margin-right: 10px;\r\n`;\r\n\r\nconst loadType = () => {\r\n  const parts = state.newType.split(\"/\");\r\n  type = JSON.parse(Social.get(state.newType, blockHeight) || null);\r\n  if (type) {\r\n    type.name = parts[2];\r\n    State.update({\r\n      typeName: type.name,\r\n      properties: type.properties,\r\n      widgets: type.widgets,\r\n    });\r\n  }\r\n};\r\n\r\nif (prop.typeSrc !== \"\" && state.typeName === \"\") {\r\n  loadType();\r\n}\r\n\r\nconst handleAddProperty = () => {\r\n  if (state.newPropertyName.trim() === \"\") return;\r\n\r\n  const newProperty = {\r\n    name: state.newPropertyName,\r\n    type: state.newPropertyType,\r\n    required: state.newPropertyRequired,\r\n    isMulti: state.newPropertyIsMulti,\r\n  };\r\n\r\n  State.update({\r\n    properties: [...state.properties, newProperty],\r\n    newPropertyName: \"\",\r\n    newPropertyType: \"string\",\r\n    newPropertyIsMulti: false,\r\n  });\r\n};\r\n\r\nconst handleRemoveProperty = (index) => {\r\n  const updatedProperties = [...state.properties];\r\n  updatedProperties.splice(index, 1);\r\n  State.update({ properties: updatedProperties });\r\n};\r\n\r\nconst handlePropertyChange = (e, index) => {\r\n  const updatedProperties = [...state.properties];\r\n  updatedProperties[index].name = e.target.value;\r\n  State.update({ properties: updatedProperties });\r\n};\r\n\r\nconst handleTypeChange = (e, index) => {\r\n  const updatedProperties = [...state.properties];\r\n  updatedProperties[index].type = e.target.value;\r\n  State.update({ properties: updatedProperties });\r\n};\r\n\r\nconst handleMultiChange = (e, index) => {\r\n  const updatedProperties = [...state.properties];\r\n  updatedProperties[index].isMulti = e.target.value;\r\n  State.update({ properties: updatedProperties });\r\n};\r\n\r\nconst handleTypeNameChange = (e) => {\r\n  State.update({ typeName: e.target.value.toLowerCase() });\r\n};\r\n\r\nconst handleWidgetKeyChange = (e) => {\r\n  State.update({ newWidgetKey: e.target.value.toLowerCase() });\r\n};\r\n\r\nconst handleWidgetSrcChange = (e) => {\r\n  State.update({ newWidgetSrc: e.target.value });\r\n};\r\n\r\nconst handleAddWidget = () => {\r\n  if (state.newWidgetKey.trim() === \"\" || state.newWidgetSrc.trim() === \"\")\r\n    return;\r\n\r\n  const newWidget = {\r\n    [state.newWidgetKey]: state.newWidgetSrc,\r\n  };\r\n\r\n  State.update({\r\n    widgets: { ...state.widgets, ...newWidget },\r\n    newWidgetKey: \"\",\r\n    newWidgetSrc: \"\",\r\n  });\r\n};\r\n\r\nconst handleRemoveWidget = (key) => {\r\n  const updatedWidgets = { ...state.widgets };\r\n  delete updatedWidgets[key];\r\n  State.update({ widgets: updatedWidgets });\r\n};\r\n\r\nconst composeData = () => {\r\n  const data = {\r\n    type: {\r\n      [state.typeName]: JSON.stringify({\r\n        properties: state.properties,\r\n        widgets: state.widgets,\r\n      }),\r\n    },\r\n  };\r\n  return data;\r\n};\r\n\r\nfunction TypeSelect({ value, onChange }) {\r\n  return (\r\n    <Select value={value} onChange={onChange}>\r\n      {availableTypes.map((it) => (\r\n        <option value={it} key={it}>\r\n          {it}\r\n        </option>\r\n      ))}\r\n    </Select>\r\n  );\r\n}\r\n\r\nfunction MultiSelect({ value, onChange }) {\r\n  return (\r\n    <Select value={value} onChange={onChange}>\r\n      <option value={false}>single</option>\r\n      <option value={true}>multi</option>\r\n    </Select>\r\n  );\r\n}\r\n\r\nreturn (\r\n  <Container>\r\n    <Row>\r\n      <Text>\r\n        <b>Import Schema:</b>\r\n      </Text>\r\n      <Input\r\n        type=\"text\"\r\n        value={state.newType}\r\n        onChange={(e) => State.update({ newType: e.target.value })}\r\n        placeholder={\"accountId/type/schemaId\"}\r\n      />\r\n      <Button onClick={loadType}>load</Button>\r\n    </Row>\r\n    <Row>\r\n      <Text>\r\n        <b>Import Types:</b>\r\n      </Text>\r\n      <Input\r\n        type=\"text\"\r\n        value={state.newTypeSrc}\r\n        onChange={(e) => State.update({ newTypeSrc: e.target.value })}\r\n        placeholder={\"hyperfiles.near\"}\r\n      />\r\n      <Button onClick={() => State.update({ typeSrc: state.newTypeSrc })}>\r\n        apply\r\n      </Button>\r\n    </Row>\r\n    <FormContainer>\r\n      <Row>\r\n        <Text>\r\n          <b>Schema Id:</b>\r\n        </Text>\r\n        <Input\r\n          type=\"text\"\r\n          placeholder=\"schemaId\"\r\n          value={state.typeName}\r\n          onChange={handleTypeNameChange}\r\n        />\r\n        <i>*overwrites existing path</i>\r\n      </Row>\r\n      <hr></hr>\r\n      <Text>\r\n        <h4>Schema Fields</h4>\r\n        <i>*Add fields below that are relevant to your use case.</i>\r\n        <br></br>\r\n        <b>1.</b> [Field Name]: give a meaningful name to the data<br></br>\r\n        <b>2.</b> [Field Type]: select an appropriate primitive for the data.{\" \"}\r\n        <a href=\"\">\r\n          <i>[Create field types]</i>\r\n        </a>\r\n        <br></br>\r\n        <b>3.</b> [Single/Multi]: will the data contain multiple objects of the\r\n        selected type?\r\n      </Text>\r\n      {state.properties?.map((property, index) => (\r\n        <Row key={index}>\r\n          <Input\r\n            type=\"text\"\r\n            value={property.name}\r\n            onChange={(e) => handlePropertyChange(e, index)}\r\n          />\r\n          <TypeSelect\r\n            value={property.type}\r\n            onChange={(e) => handleTypeChange(e, index)}\r\n          />\r\n          <MultiSelect\r\n            value={property.isMulti}\r\n            onChange={(e) => handleMultiChange(e, index)}\r\n          />\r\n          <Button onClick={() => handleRemoveProperty(index)}>Remove</Button>\r\n        </Row>\r\n      ))}\r\n      <Row>\r\n        <Input\r\n          type=\"text\"\r\n          placeholder=\"Field Name\"\r\n          value={state.newPropertyName}\r\n          onChange={(e) => State.update({ newPropertyName: e.target.value })}\r\n        />\r\n        <TypeSelect\r\n          value={state.newPropertyType}\r\n          onChange={(e) => State.update({ newPropertyType: e.target.value })}\r\n        />\r\n        <MultiSelect\r\n          value={state.newPropertyIsMulti}\r\n          onChange={(e) => State.update({ newPropertyIsMulti: e.target.value })}\r\n        />\r\n        <Button\r\n          onClick={handleAddProperty}\r\n          disabled={state.newPropertyName.trim() === \"\"}\r\n        >\r\n          +\r\n        </Button>\r\n      </Row>\r\n      <hr></hr>\r\n      <Text>\r\n        <b>Widgets (optional):</b>\r\n      </Text>\r\n      {Object.entries(state.widgets)?.map(([key, src]) => (\r\n        <Row key={key}>\r\n          <Text>{key}:</Text>\r\n          <Input type=\"text\" value={src} onChange={() => {}} />\r\n          <Button onClick={() => handleRemoveWidget(key)}>Remove</Button>\r\n        </Row>\r\n      ))}\r\n      <Row>\r\n        <Input\r\n          type=\"text\"\r\n          placeholder=\"Widget Name\"\r\n          value={state.newWidgetKey}\r\n          onChange={handleWidgetKeyChange}\r\n        />\r\n        {\":\"}\r\n        <Input\r\n          type=\"text\"\r\n          placeholder=\"accountId/widget/name\"\r\n          value={state.newWidgetSrc}\r\n          onChange={handleWidgetSrcChange}\r\n        />\r\n        <Button\r\n          onClick={handleAddWidget}\r\n          disabled={\r\n            state.newWidgetKey.trim() === \"\" || state.newWidgetSrc.trim() === \"\"\r\n          }\r\n        >\r\n          +\r\n        </Button>\r\n      </Row>\r\n      <hr></hr>\r\n      <Row>\r\n        <Text>\r\n          <b>Resolver Address:</b>\r\n        </Text>\r\n        <Input\r\n          type=\"text\"\r\n          placeholder=\"(e.g. resolver.near)\"\r\n          value={state.resolverId}\r\n          onChange={handleResolverIdChange}\r\n        />\r\n      </Row>\r\n      <i>\r\n        *Optional smart contract that gets executed with every attestation of\r\n        this type. (Can be used to verify, limit, act upon any attestation)\r\n      </i>\r\n      <hr></hr>\r\n      <Row>\r\n        <Text>\r\n          <b>Is Revocable?</b>\r\n        </Text>\r\n        <Input\r\n          type=\"checkbox\"\r\n          defaultChecked=\"true\"\r\n          onChange={(e) => State.update({ isRevocable: e.target.checked })}\r\n        />\r\n      </Row>\r\n      <i>*Determine if attestations of this schema can be revocable.</i>\r\n      <hr></hr>\r\n      <Row>\r\n        <CommitButton\r\n          force\r\n          data={composeData()}\r\n          disabled={state.properties.length === 0}\r\n          className=\"styless\"\r\n        >\r\n          Publish/Update Schema\r\n        </CommitButton>\r\n      </Row>\r\n    </FormContainer>\r\n  </Container>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/flowscience.near/widget/schema.editor", "fact_widget_deployments_id": "5f2c788dcd2ae2272b0c4bd7dd78bebb", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 1}