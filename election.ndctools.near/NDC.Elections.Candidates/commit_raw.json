{"tx_hash": "E9deFDMh6iH5UfVSX6fiwSkqN3hFAwWhkgYcT7tbwM2p", "action_id_social": "HGTR6BcZAjL1AKdBadVBRxtG1LoLU3RLbiASskYs1hdK-0-widget", "block_id": 100148812, "block_timestamp": "2023-09-01T10:43:39.707Z", "signer_id": "election.ndctools.near", "widget_name": "NDC.Elections.Candidates", "source_code": "const {\n  electionContract,\n  registryContract,\n  ndcOrganization,\n  myVotes,\n  id,\n  typ,\n  ref_link,\n  quorum,\n  seats,\n  voters_num,\n  result,\n  isIAmHuman,\n  candidateId,\n  blacklisted,\n  greylisted,\n  alreadyBonded,\n} = props;\n\nconst widgets = {\n  voters: \"election.ndctools.near/widget/NDC.Elections.Voters\",\n  styledComponents: \"nomination.ndctools.near/widget/NDC.StyledComponents\",\n  modal: \"nomination.ndctools.near/widget/NDC.Modal\",\n  verifyHuman: \"nomination.ndctools.near/widget/NDC.VerifyHuman\",\n  budget: \"election.ndctools.near/widget/NDC.Elections.BudgetPackage\",\n};\n\nconst apiKey = \"36f2b87a-7ee6-40d8-80b9-5e68e587a5b5\";\nconst QUERY_API_ENDPOINT = \"https://graph.mintbase.xyz/mainnet\";\nconst POLICY_HASH =\n  \"99c19c7a4ea920bb2ae2c5a214b35f6c0393e518e7637b2d6dccf365dd62a047\";\nconst FAIR_POLICY_DOC =\n  \"https://bafkreidwdxocdkfsv6srynw7ipnogfuw76fzncmxd5jv7furbsn5cp4bz4.ipfs.nftstorage.link\";\nconst FAIR_POLICY_NFT =\n  \"https://ipfs.near.social/ipfs/bafkreiabsu7xhumhim4gxj5h7umopc3b5ekppeofwwizsf5loqs2vcntpm\";\nconst I_VOTED_NFT =\n  \"https://ipfs.near.social/ipfs/bafkreiewiq4puwmcu7ciztsfqvmpl3gsumfgsm5r22g24abiynoeghsyey\";\nconst MINT_VOTING_POLICY_NFT = \"https://shard.dog/fairvoting/\";\nconst MINT_I_VOTED_NFT = \"https://shard.dog/ivoted\";\nconst BLACKLIST_VERIFY_LINK = \"\";\nconst GREYLIST_VERIFY_LINK = \"\";\nconst MIN_BOND = 0.01; //3\nconst MAX_BOND = 0.02; //300;\nconst NFT_SERIES = [190, 191];\n\nconst H4 = styled.h4`\n  margin-bottom: 0;\n`;\n\nconst H3 = styled.h3`\n  margin-bottom: 0;\n`;\n\nconst Container = styled.div`\n  position: relative:\n  font-family: Avenir;\n  font-size: 16px;\n`;\n\nconst StyledLink = styled.a`\n  color: inherit !important;\n  width: 90px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  font-size: 14px;\n  padding-top: 2px;\n\n  @media (max-width: 400px) {\n    width: 60px;\n  }\n`;\n\nconst CandidateItemRow = styled.div`\n  padding: 0 20px;\n  height: 48px;\n  border-radius: 12px;\n  margin-bottom: 8px;\n  border: 1px solid;\n  background: ${(props) =>\n    props.winnerId\n      ? \"rgb(206 233 207)\"\n      : props.selected\n      ? \"#4aa6ee\"\n      : \"#F8F8F9\"};\n  border-color: ${(props) =>\n    props.winnerId\n      ? \"rgb(137 201 139)\"\n      : props.selected\n      ? \"#4aa6ee\"\n      : \"#F8F8F9\"};\n\n  &:hover {\n    background: ${(props) =>\n      props.winnerId\n        ? \"rgb(206 233 207)\"\n        : props.selected\n        ? \"#4aa6ee\"\n        : \"#d4e4f461\"};\n  \n  @media (max-width: 400px) {\n    padding: 0 10px;\n  }\n`;\n\nconst Candidates = styled.div`\n  cursor: pointer;\n`;\n\nconst Bookmark = styled.div`\n  width: 90px;\n  cursor: pointer;\n\n  #bookmark.bi-bookmark-fill {\n    color: ${(props) =>\n      props.winnerId || props.selected ? \"#fff\" : \"#4498E0\"};\n  }\n\n  @media (max-width: 400px) {\n    width: auto;\n    margin-right: 15px;\n  }\n`;\n\nconst Expand = styled.div`\n  width: 35px;\n  cursor: pointer;\n\n  @media (max-width: 400px) {\n    width: 20px;\n    margin-right: 10px;\n  }\n`;\n\nconst Votes = styled.div``;\n\nconst Action = styled.div``;\n\nconst Nomination = styled.div``;\n\nconst NominationLink = styled.div`\n  display: block;\n\n  @media (max-width: 768px) {\n    display: none;\n  }\n`;\n\nconst NominationLinkMobile = styled.div`\n  display: none;\n\n  @media (max-width: 768px) {\n    display: block;\n  }\n`;\n\nconst FilterRow = styled.div`\n  padding: 15px 20px;\n  font-size: 13px;\n`;\n\nconst Info = styled.i`\n  font-size: 12px;\n  margin: 0 !important;\n`;\n\nconst CandidatesContainer = styled.div`\n  overflow-y: scroll;\n  max-height: 490px;\n  width: 100%;\n`;\n\nconst StickyContainer = styled.div`\n  position: \"fixed\",\n  left: 0;\n  bottom: 0;\n  height: 60px;\n  width: 100%;\n`;\n\nconst Icon = styled.i`\n  font-size: 14px;\n`;\n\nconst CastVotesSection = styled.div`\n  background: #fdfeff;\n  box-shadow: 0px 0px 30px rgba(0, 0, 0, 0.2);\n  border-radius: 8px;\n  padding: 16px;\n\n  @media (max-width: 400px) {\n    flex-direction: column;\n  }\n\n  .wrapper {\n    @media (max-width: 400px) {\n      width: 100%;\n    }\n  }\n\n  button {\n    @media (max-width: 400px) {\n      width: 100%;\n    }\n  }\n\n  h3,\n  h4 {\n    margin: 0 3px;\n  }\n\n  h3 {\n    font-weight: 900;\n  }\n\n  .text-secondary {\n    margin: 0 10px;\n  }\n\n  &.not-verified {\n    h4 {\n      font-size: 16px;\n      margin: 0 0 5px 0;\n      font-weight: 600;\n    }\n\n    h5 {\n      margin: 0;\n      font-size: 12px;\n    }\n  }\n`;\n\nconst Winner = styled.i`\n  margin-left: 10px;\n  font-size: 14px;\n`;\n\nconst Section = styled.div`\n  gap: 8px;\n  margin-bottom: 10px;\n`;\n\nconst GraylistedAlert = styled.div`\n  background: rgb(236 236 236);\n`;\n\nconst ActionSection = styled.div`\n  @media (max-width: 400px) {\n    width: 100%;\n  }\n`;\n\nconst Rule = styled.div`\n  color: #f29bc0;\n`;\n\nconst currentUser = context.accountId;\n\nconst housesMapping = {\n  CouncilOfAdvisors: \"Council Of Advisors\",\n  HouseOfMerit: \"House of Merit\",\n  TransparencyCommission: \"Transparency Commission\",\n  SetupPackage: \"Budget Package\",\n};\n\nconst alreadyVoted = (candidateId) =>\n  myVotes.some((voter) => voter.candidate === candidateId);\n\nconst alreadyVotedForHouse = () => myVotes.some((voter) => voter.house === typ);\n\nconst filteredCandidates = () => {\n  let candidates = result;\n\n  if (state.filterOption === \"bookmark\")\n    candidates = state.filter.bookmark\n      ? state.candidates.filter(([candidateId, _votes], _index) =>\n          state.bookmarked.includes(candidateId)\n        )\n      : result;\n  if (state.filterOption === \"candidates\")\n    candidates = candidates.sort((a, b) =>\n      state.filter.candidates\n        ? a[0].localeCompare(b[0])\n        : b[0].localeCompare(a[0])\n    );\n  if (state.filterOption === \"votes\")\n    candidates = candidates.sort((a, b) =>\n      state.filter.votes ? a[1] - b[1] : b[1] - a[1]\n    );\n  if (state.filterOption === \"my_votes\")\n    candidates = state.filter.my_votes\n      ? state.candidates.filter(([candidateId, _votes], _index) =>\n          alreadyVoted(candidateId)\n        )\n      : result;\n\n  if (candidateId)\n    candidates = result.filter(([candidate, _vote], _index) =>\n      candidate.toLowerCase().includes(candidateId.toLowerCase())\n    );\n\n  return candidates;\n};\n\nconst handleSelectCandidate = (candidateId) => {\n  if (!state.acceptedPolicy) {\n    State.update({ showToSModal: true });\n    return;\n  }\n  if (!!state.acceptedPolicy && state.hasPolicyNFT === false) {\n    State.update({ showMintPolicyModal: true });\n    return;\n  }\n\n  const selectedItems = state.selectedCandidates.includes(candidateId)\n    ? state.selectedCandidates.filter((el) => el !== candidateId)\n    : [...state.selectedCandidates, candidateId];\n\n  const currentVotes = seats - myVotesForHouse().length - selectedItems.length;\n  if (currentVotes < 0) return;\n\n  State.update({\n    selectedCandidates: selectedItems,\n    availableVotes: currentVotes,\n    reload: false,\n  });\n\n  return true;\n};\n\nconst selectedBookmarks = (candidateId) => {\n  let selectedItems = state.bookmarked.includes(candidateId)\n    ? state.bookmarked.filter((el) => el !== candidateId)\n    : [...state.bookmarked, candidateId];\n\n  return [...new Set(selectedItems)];\n};\n\nconst handleBookmarkCandidate = (candidateId) => {\n  let selectedItems = selectedBookmarks(candidateId);\n  State.update({ loading: candidateId });\n\n  Social.set(\n    {\n      index: {\n        [currentUser]: JSON.stringify({\n          key: `${ndcOrganization}/${typ}`,\n          value: selectedBookmarks(candidateId),\n        }),\n      },\n    },\n    {\n      force: true,\n      onCommit: () => {\n        if (selectedItems.length === 0)\n          State.update({ selectedCandidates: result });\n\n        State.update({\n          bookmarked: selectedItems,\n          loading: false,\n          reload: true,\n        });\n      },\n      onCancel: () => State.update({ loading: false }),\n    }\n  );\n};\n\nconst handleVote = () => {\n  const voteFunc = {\n    contractName: electionContract,\n    methodName: \"vote\",\n    args: { prop_id: props.id, vote: state.selectedCandidates },\n    gas: \"110000000000000\",\n  };\n\n  const bondFunc = {\n    contractName: registryContract,\n    methodName: \"is_human_call\",\n    args: { ctr: electionContract, function: \"bond\", payload: \"{}\" },\n    gas: \"110000000000000\",\n    deposit: (greylisted ? MAX_BOND : MIN_BOND) * 1000000000000000000000000,\n  };\n\n  const arr = alreadyBonded ? [voteFunc] : [bondFunc, voteFunc];\n\n  Near.call(arr).then((data) => State.update({ bountyProgramModal: false }));\n};\n\nconst handleAcceptToS = () => {\n  State.update({ loading: true });\n\n  Near.call(\n    electionContract,\n    \"accept_fair_voting_policy\",\n    { policy: POLICY_HASH },\n    70000000000000,\n    1000000000000000000000\n  ).then((data) =>\n    State.update({\n      showToSModal: false,\n      tosAgreement: true,\n      showMintPolicyModal: true,\n      loading: false,\n    })\n  );\n};\n\nconst handleFilter = (option) => {\n  let filterOption = \"\";\n  let filter = {};\n\n  if (option.bookmark) {\n    filterOption = \"bookmark\";\n    filter = { bookmark: !state.filter.bookmark };\n  }\n  if (option.candidates) {\n    filterOption = \"candidates\";\n    filter = { candidates: !state.filter.candidates };\n  }\n  if (option.votes) {\n    filterOption = \"votes\";\n    filter = { votes: !state.filter.votes };\n  }\n  if (option.my_votes) {\n    filterOption = \"my_votes\";\n    filter = { my_votes: !state.filter.my_votes };\n  }\n\n  State.update({ filterOption, filter, reload: true });\n};\n\nconst handleStateTransition = () => {\n  if (state.filterOption !== \"\") return;\n\n  switch (state.electionStatus) {\n    case \"ONGOING\":\n      if (!!state.acceptedPolicy)\n        State.update({\n          showMintPolicyModal: state.hasPolicyNFT === false,\n          showMintIVotedModal:\n            state.hasVotedOnAllProposals &&\n            state.hasIVotedNFT === false &&\n            state.hasPolicyNFT === true,\n        });\n      break;\n    case \"COOLDOWN\":\n      State.update({\n        showReviewModal: true,\n      });\n      break;\n    case \"ENDED\":\n      console.log(winnerIds);\n      State.update({ winnerIds });\n      break;\n    default:\n      0;\n  }\n};\n\nconst loadSocialDBData = () => {\n  let _bookmarked = Social.index(currentUser, `${ndcOrganization}/${typ}`);\n\n  return _bookmarked && _bookmarked[_bookmarked.length - 1]\n    ? _bookmarked[_bookmarked.length - 1].value\n    : [];\n};\n\nfunction fetchGraphQL(series) {\n  return asyncFetch(QUERY_API_ENDPOINT, {\n    method: \"POST\",\n    headers: { \"mb-api-key\": \"anon\", \"x-hasura-role\": electionContract },\n    body: JSON.stringify({\n      query: `\n        query MyQuery {\n          nft_tokens(\n            where: {\n              nft_contract_id: {\n                _eq: \"mint.sharddog.near\"\n              },\n              token_id: {_regex: \"^${series}:\"},\n              owner: {_eq: \"${currentUser}\"}}\n            order_by: {minted_timestamp: asc}\n          ) {\n            last_transfer_timestamp\n          }\n        }\n      `,\n      variables: {},\n      operationName: \"MyQuery\",\n    }),\n  });\n}\n\nconst processNFTAvailability = (result, key) => {\n  if (result.status === 200) {\n    let data = result.body.data;\n    if (data) {\n      const tokens = data.nft_tokens;\n\n      State.update({\n        [key]: tokens.length > 0 && tokens[0].last_transfer_timestamp === null,\n      });\n    }\n  }\n};\n\nconst myVotesForHouse = () => myVotes.filter((vote) => vote.house === typ);\nconst isVisible = () =>\n  myVotesForHouse().length > 0 || state.winnerIds.length > 0;\n\nState.init({\n  reload: true,\n  loading: false,\n  electionStatus: \"NOT_STARTED\",\n  acceptedPolicy: false,\n  hasVotedOnAllProposals: false,\n  availableVotes: seats - myVotesForHouse().length,\n  selected: null,\n  bookmarked: [],\n  tosAgreementInput: false,\n  tosAgreement: false,\n  selectedCandidates: [],\n  voters: [],\n  candidates: result,\n  filter: {\n    bookmark: false,\n    candidates: false,\n    votes: false,\n    my_votes: false,\n  },\n  filterOption: \"\",\n  showToSModal: false,\n  bountyProgramModal: false,\n  showReviewModal: false,\n  blacklistedModal: true,\n\n  showMintPolicyModal: false,\n  showMintIVotedModal: false,\n  hasPolicyNFT: null,\n  hasIVotedNFT: null,\n  winnerIds: [],\n});\n\nconst winnerIds = Near.view(electionContract, \"winners_by_house\", {\n  prop_id: id,\n});\n\nif (state.reload) {\n  fetchGraphQL(NFT_SERIES[0]).then((result) =>\n    processNFTAvailability(result, \"hasPolicyNFT\")\n  );\n\n  fetchGraphQL(NFT_SERIES[1]).then((result) =>\n    processNFTAvailability(result, \"hasIVotedNFT\")\n  );\n\n  const electionStatus = Near.view(electionContract, \"proposal_status\", {\n    prop_id: props.id,\n  });\n\n  const hasVotedOnAllProposals = Near.view(\n    electionContract,\n    \"has_voted_on_all_proposals\",\n    { user: currentUser }\n  );\n\n  const acceptedPolicy = Near.view(electionContract, \"accepted_policy\", {\n    user: currentUser,\n  });\n\n  const bookmarked = loadSocialDBData();\n\n  State.update({\n    electionStatus: electionStatus ?? state.electionStatus,\n    acceptedPolicy: acceptedPolicy === POLICY_HASH ?? state.acceptedPolicy,\n    winnerIds: winnerIds ?? state.winnerIds,\n    bookmarked: bookmarked ?? state.bookmarked,\n    candidates: filteredCandidates(),\n    hasVotedOnAllProposals,\n  });\n\n  handleStateTransition();\n}\n\nconst UserLink = ({ title, src }) => (\n  <div className=\"d-flex mr-3\">\n    <StyledLink href={src} target=\"_blank\">\n      {title}\n    </StyledLink>\n    <div>\n      <Icon className=\"bi bi-arrow-up-right\" />\n    </div>\n  </div>\n);\n\nconst Loader = () => (\n  <span\n    className=\"spinner-grow spinner-grow-sm me-1\"\n    role=\"status\"\n    aria-hidden=\"true\"\n  />\n);\n\nconst CandidateItem = ({ candidateId, votes }) => (\n  <div>\n    <CandidateItemRow\n      className=\"d-flex align-items-center justify-content-between\"\n      selected={state.selected === candidateId}\n      winnerId={state.winnerIds.includes(candidateId)}\n    >\n      <div className=\"d-flex w-100 align-items-center\">\n        {isVisible() && (\n          <Expand>\n            <i\n              className={`${\n                state.selected === candidateId\n                  ? \"bi bi-chevron-down\"\n                  : \"bi bi-chevron-right\"\n              }`}\n              onClick={(e) =>\n                State.update({\n                  selected: state.selected === candidateId ? null : candidateId,\n                })\n              }\n            />\n          </Expand>\n        )}\n\n        {isIAmHuman && (\n          <Bookmark\n            selected={state.selected === candidateId}\n            winnerId={state.winnerIds.includes(candidateId)}\n          >\n            {state.loading === candidateId ? (\n              <Loader />\n            ) : (\n              <i\n                id=\"bookmark\"\n                onClick={() => handleBookmarkCandidate(candidateId)}\n                className={`bi ${\n                  state.bookmarked.includes(candidateId)\n                    ? \"bi-bookmark-fill\"\n                    : \"bi-bookmark\"\n                }`}\n              />\n            )}\n          </Bookmark>\n        )}\n        <div className=\"d-flex align-items-center\">\n          <Widget\n            src=\"near/widget/AccountProfileOverlay\"\n            props={{\n              accountId: candidateId,\n              children: (\n                <div className=\"d-flex justify-items-center\">\n                  <Widget\n                    src=\"mob.near/widget/ProfileImage\"\n                    props={{\n                      accountId: candidateId,\n                      imageClassName: \"rounded-circle w-100 h-100\",\n                      style: { width: \"24px\", height: \"24px\", marginRight: 5 },\n                    }}\n                  />\n                  <UserLink\n                    src={`https://near.org/near/widget/ProfilePage?accountId=${candidateId}`}\n                    title={candidateId}\n                  />\n                </div>\n              ),\n            }}\n          />\n\n          {state.winnerIds.includes(candidateId) && (\n            <Winner className=\"bi bi-trophy p-1\" />\n          )}\n        </div>\n      </div>\n      <div className=\"d-flex w-100 align-items-center justify-content-around\">\n        <NominationLink>\n          <Widget\n            src={widgets.styledComponents}\n            props={{\n              Link: {\n                size: \"sm\",\n                className: state.winnerIds.includes(candidateId)\n                  ? \"secondary success\"\n                  : \"secondary dark\",\n                text: \"Nomination\",\n                icon: <i className=\"bi bi-box-arrow-up-right\" />,\n                href: `https://near.org/nomination.ndctools.near/widget/NDC.Nomination.Candidate.Page?house=HouseOfMerit&accountId=${candidateId}`,\n              },\n            }}\n          />\n        </NominationLink>\n        <NominationLinkMobile>\n          <Widget\n            src={widgets.styledComponents}\n            props={{\n              Link: {\n                size: \"sm\",\n                className: \"secondary dark\",\n                text: \"\",\n                icon: <i className=\"bi bi-box-arrow-up-right\" />,\n                href: `https://near.org/nomination.ndctools.near/widget/NDC.Nomination.Candidate.Page?house=HouseOfMerit&accountId=${candidateId}`,\n                inverse:\n                  state.selected === candidateId ||\n                  state.winnerIds.includes(candidateId),\n              },\n            }}\n          />\n        </NominationLinkMobile>\n        {isVisible() && <Votes>{votes}</Votes>}\n        {isIAmHuman && (\n          <Votes>\n            <input\n              id=\"input\"\n              disabled={alreadyVotedForHouse() || blacklisted}\n              onClick={() => handleSelectCandidate(candidateId)}\n              className=\"form-check-input\"\n              type=\"checkbox\"\n              checked={\n                state.selectedCandidates.includes(candidateId) ||\n                alreadyVoted(candidateId)\n              }\n            />\n          </Votes>\n        )}\n      </div>\n    </CandidateItemRow>\n    {state.selected === candidateId && isVisible() && (\n      <Widget src={widgets.voters} props={{ candidateId, isIAmHuman }} />\n    )}\n  </div>\n);\n\nconst Filters = () => (\n  <FilterRow className=\"d-flex align-items-center justify-content-between\">\n    <div className=\"d-flex align-items-center w-100\">\n      {isVisible() && <Expand />}\n      {isIAmHuman && (\n        <Bookmark\n          role=\"button\"\n          className=\"text-secondary\"\n          onClick={() => handleFilter({ bookmark: true })}\n        >\n          <small>Bookmark</small>\n          <i\n            className={`bi ${\n              state.filter.bookmark ? \"bi-funnel-fill\" : \"bi-funnel\"\n            }`}\n          />\n        </Bookmark>\n      )}\n      <Candidates\n        className=\"text-secondary\"\n        onClick={() => handleFilter({ candidates: true })}\n      >\n        <small>Candidate</small>\n        <i\n          className={`bi ${\n            state.filter.candidates ? \"bi-arrow-down\" : \"bi-arrow-up\"\n          }`}\n        />\n      </Candidates>\n    </div>\n    <div className=\"d-flex w-100 align-items-center justify-content-end gap-4\">\n      <Nomination className=\"text-secondary text-end text-md-end\">\n        <small>Nomination</small>\n      </Nomination>\n      {isVisible() && (\n        <Votes\n          role=\"button\"\n          className=\"text-secondary\"\n          onClick={() => handleFilter({ votes: true })}\n        >\n          <small>Total votes</small>\n          <i\n            className={`bi ${\n              state.filter.votes ? \"bi-arrow-down\" : \"bi-arrow-up\"\n            }`}\n          />\n        </Votes>\n      )}\n      {isIAmHuman && (\n        <Action\n          role=\"button\"\n          className=\"text-secondary\"\n          onClick={() => handleFilter({ my_votes: true })}\n        >\n          <small>My votes</small>\n          <i\n            className={`bi ${\n              state.filter.my_votes ? \"bi-funnel-fill\" : \"bi-funnel\"\n            }`}\n          />\n        </Action>\n      )}\n    </div>\n  </FilterRow>\n);\n\nconst CastVotes = () => (\n  <CastVotesSection className=\"d-flex align-items-center justify-content-between gap-3\">\n    <div className=\"wrapper\">\n      <div className=\"d-flex align-items-end\">\n        <H3>\n          {alreadyVotedForHouse()\n            ? 0\n            : seats -\n              myVotesForHouse().length -\n              state.selectedCandidates.length}\n        </H3>\n        <span>/</span>\n        <H4>{seats}</H4>\n        <span className=\"text-secondary\">votes left</span>\n      </div>\n      <Info className=\"text-secondary\">\n        <i class=\"bi bi-info-circle\"></i>\n        {alreadyVotedForHouse() ? (\n          <span>You're already voted for {housesMapping[typ]}</span>\n        ) : blacklisted ? (\n          <span>Your account is blacklisted</span>\n        ) : (\n          <span>Make sure you selected {seats} candidates</span>\n        )}\n      </Info>\n    </div>\n    <ActionSection className=\"d-flex gap-2\">\n      {state.selectedCandidates.length > 0 && (\n        <Widget\n          src={widgets.styledComponents}\n          props={{\n            Button: {\n              className: \"secondary dark justify-content-center text-nowrap\",\n              text: \"Reset Selection\",\n              onClick: () => {\n                Storage.privateSet(\"election_user_selection\", \"[]\");\n                State.update({\n                  selectedCandidates: [],\n                  availableVotes: seats - myVotesForHouse().length,\n                });\n              },\n            },\n          }}\n        />\n      )}\n      <Widget\n        src={widgets.styledComponents}\n        props={{\n          Button: {\n            className: \"primary justify-content-center\",\n            disabled: state.selectedCandidates.length === 0 || blacklisted,\n            text: `Cast ${state.selectedCandidates.length || \"\"} Vote${\n              state.selectedCandidates.length === 1 ? \"\" : \"s\"\n            }`,\n            onClick: () =>\n              !!state.acceptedPolicy && state.hasPolicyNFT\n                ? State.update({ bountyProgramModal: true })\n                : State.update({ showToSModal: true }),\n          },\n        }}\n      />\n    </ActionSection>\n  </CastVotesSection>\n);\n\nconst CastBudgetVote = () => (\n  <CastVotesSection className=\"d-flex align-items-center justify-content-between gap-3\">\n    <div className=\"wrapper\">\n      <div className=\"d-flex align-items-end\">\n        <H3>{alreadyVotedForHouse() ? 0 : state.availableVotes}</H3>\n        <span>/</span>\n        <H4>{seats}</H4>\n        <span className=\"text-secondary\">votes left</span>\n      </div>\n      <Info className=\"text-secondary\">\n        <i class=\"bi bi-info-circle\"></i>\n        {alreadyVotedForHouse() && (\n          <span>You're already voted for budget package</span>\n        )}\n      </Info>\n    </div>\n    <ActionSection className=\"d-flex gap-2\">\n      <Widget\n        src={widgets.styledComponents}\n        props={{\n          Button: {\n            text: \"Yes\",\n            className: \"primary success justify-content-center\",\n            icon: <i className=\"bi bi-hand-thumbs-up\" />,\n            disabled: alreadyVotedForHouse() || blacklisted,\n            onClick: () => {\n              const res = handleSelectCandidate(\"yes\");\n              if (res) handleVote();\n            },\n          },\n        }}\n      />\n      <Widget\n        src={widgets.styledComponents}\n        props={{\n          Button: {\n            text: \"No\",\n            className: \"primary danger justify-content-center\",\n            icon: <i className=\"bi bi-hand-thumbs-down\" />,\n            disabled: alreadyVotedForHouse() || blacklisted,\n            onClick: () => {\n              const res = handleSelectCandidate(\"no\");\n              if (res) handleVote();\n            },\n          },\n        }}\n      />\n      <Widget\n        src={widgets.styledComponents}\n        props={{\n          Button: {\n            text: \"Abstain\",\n            className: \"primary justify-content-center\",\n            icon: <i className=\"bi bi-x-lg\" />,\n            disabled: alreadyVotedForHouse() || blacklisted,\n            onClick: () => {\n              const res = handleSelectCandidate(\"abstain\");\n              if (res) handleVote();\n            },\n          },\n        }}\n      />\n    </ActionSection>\n  </CastVotesSection>\n);\n\nconst ALink = ({ title, href }) => (\n  <a href={href} target={\"_blank\"} rel={\"noopener\"}>\n    {title}\n  </a>\n);\n\nreturn (\n  <>\n    {state.showReviewModal && (\n      <Widget\n        src={widgets.modal}\n        props={{\n          title: (\n            <div>\n              <img src=\"https://bafkreidmuyeawyqduaotd27jozw5czdrm7t7w5hlcx5nfjzjjxxzvyhkyi.ipfs.nftstorage.link/\" />\n              <div className=\"mt-4\">Election results are under review</div>\n            </div>\n          ),\n          description:\n            \"Election results are under review by Election integrity Councils. Please wait it may takes a few days\",\n          Button: {\n            title: \"I understand\",\n            onCancel: () =>\n              State.update({ showReviewModal: false, reload: false }),\n            onSubmit: () =>\n              State.update({ showReviewModal: false, reload: false }),\n          },\n        }}\n      />\n    )}\n    {blacklisted && blacklistedModal && (\n      <Widget\n        src={widgets.modal}\n        props={{\n          title: (\n            <div>\n              <img src=\"https://bafkreignre4f27jsdgxt25pgnenjyqfw55pkhtnu5gkv7vhex3ttv45pbe.ipfs.nftstorage.link\" />\n              <div className=\"mt-4\">You are on the election blacklist. </div>\n            </div>\n          ),\n          description: (\n            <>\n              The community has voted to block backlisted accounts from voting\n              in the NDC general election. You have been blacklisted due\n              previously violating the\n              <ALink title=\"Fair Voting Policy.\" href={FAIR_POLICY_DOC} />.\n            </>\n          ),\n          Button: {\n            title: \"I understand\",\n            onCancel: () => State.update({ blacklistedModal: false }),\n            onSubmit: () => State.update({ blacklistedModal: false }),\n          },\n          SecondaryButton: {\n            type: \"Link\",\n            title: \"Appeal the Decision\",\n            href: BLACKLIST_VERIFY_LINK,\n          },\n        }}\n      />\n    )}\n    {state.showToSModal && (\n      <Widget\n        src={widgets.modal}\n        props={{\n          title: (\n            <div>\n              <img src=\"https://bafkreidmuyeawyqduaotd27jozw5czdrm7t7w5hlcx5nfjzjjxxzvyhkyi.ipfs.nftstorage.link/\" />\n              <div className=\"mt-4\">\n                Before you vote, please review the Fair Voting Policy.\n              </div>\n            </div>\n          ),\n          description: (\n            <>\n              <div className=\"mt-4\">\n                Please make sure to read and understand the{\" \"}\n                <ALink title=\"Fair Voting Policy.\" href={FAIR_POLICY_DOC} />\n                which outlines the responsibilities of each voter.\n              </div>\n            </>\n          ),\n          content: (\n            <Section className=\"d-flex justify-content-center w-100 my-4\">\n              <input\n                type=\"checkbox\"\n                className=\"form-check-input\"\n                checked={state.tosAgreementInput}\n                onClick={() =>\n                  State.update({ tosAgreementInput: !state.tosAgreementInput })\n                }\n              />\n              I agree with{\" \"}\n              <ALink title=\"Fair Voting Policy.\" href={FAIR_POLICY_DOC} />\n            </Section>\n          ),\n          Button: {\n            title: state.loading ? (\n              <Loader />\n            ) : (\n              <>Agree to Fair Voting Policy</>\n            ),\n            disabled: !state.tosAgreementInput,\n            onCancel: () => State.update({ showToSModal: false }),\n            onSubmit: handleAcceptToS,\n          },\n        }}\n      />\n    )}\n    {state.showMintPolicyModal && (\n      <Widget\n        src={widgets.modal}\n        props={{\n          title: \"Before you vote, mint Fair Voting Policy NFT.\",\n          description: (\n            <>\n              <img width={300} src={FAIR_POLICY_NFT} />\n              <div className=\"mt-4 mb-4\">\n                Please make sure to read and understand the{\" \"}\n                <ALink title=\"Fair Voting Policy.\" href={FAIR_POLICY_DOC} />\n                which outlines the responsibilities of each voter.\n              </div>\n            </>\n          ),\n          Button: {\n            type: \"Link\",\n            title: \"Mint Fair Voting NFT\",\n            onCancel: () =>\n              State.update({ showMintPolicyModal: false, reload: false }),\n            href: MINT_VOTING_POLICY_NFT,\n            doNotOpenNew: true,\n          },\n        }}\n      />\n    )}\n    {state.bountyProgramModal && (\n      <Widget\n        src={widgets.modal}\n        props={{\n          title: (\n            <div>\n              <img src=\"https://bafkreidmuyeawyqduaotd27jozw5czdrm7t7w5hlcx5nfjzjjxxzvyhkyi.ipfs.nftstorage.link/\" />\n              <div className=\"mt-4\">\n                {greylisted ? (\n                  <>Additional Verification Required.</>\n                ) : (\n                  <>You are about to cast your votes.</>\n                )}\n              </div>\n            </div>\n          ),\n          description: (\n            <>\n              <Rule className=\"d-flex gap-2\">\n                <h3>1</h3>\n                <p className=\"text-secondary text-start\">\n                  Don't sell your vote and risk being banned from governance.\n                  Instead report bad actors and claim a bounty up to 2,500 NEAR.\n                  Learn more about{\" \"}\n                  <ALink\n                    title=\"Whistleblower Bounty Program\"\n                    href=\"https://medium.com/@neardigitalcollective/introducing-ndc-whistleblower-bounty-program-d4fe1b9fc5a0\"\n                  />\n                </p>\n              </Rule>\n              <Rule className=\"d-flex gap-2\">\n                <h3>2</h3>\n                <p className=\"text-secondary text-start\">\n                  A bond of <b>{greylisted ? MAX_BOND : MIN_BOND} NEAR</b> is\n                  required to vote. If you are a fair voter, this bond will\n                  returned to you after the election results are reviewed and\n                  rectified.\n                </p>\n              </Rule>\n              <Rule className=\"d-flex gap-2\">\n                <h3>3</h3>\n                <p className=\"text-secondary text-start\">\n                  You votes <b>cannot</b> be changed.\n                </p>\n              </Rule>\n\n              {greylisted && (\n                <GraylistedAlert className=\"p-3 mb-4 rounded\">\n                  <b>Voters without reputation need to be verified</b> by the\n                  Election Integrity Council or place a substantial bond to\n                  vote. If you are a fair voter, this bond will be returned to\n                  you once the election results are reviewed and ratified.\n                </GraylistedAlert>\n              )}\n            </>\n          ),\n          Button: {\n            title: `Cast ${state.selectedCandidates.length || \"\"} Vote${\n              state.selectedCandidates.length === 1 ? \"\" : \"s\"\n            }`,\n            disabled:\n              state.selectedCandidates.length === 0 || alreadyVotedForHouse(),\n            onCancel: () =>\n              State.update({ bountyProgramModal: false, reload: false }),\n            onSubmit: handleVote,\n          },\n          SecondaryButton: {\n            type: greylisted ? \"Link\" : \"Button\",\n            title: greylisted ? \"Apply to Verify\" : \"Cancel\",\n            href: GREYLIST_VERIFY_LINK,\n            onSubmit: () =>\n              State.update({ bountyProgramModal: false, reload: false }),\n          },\n        }}\n      />\n    )}\n    {state.showMintIVotedModal && (\n      <Widget\n        src={widgets.modal}\n        props={{\n          title: \"Congratulations! Mint \u201cI Voted\u201d NFT\",\n          description: (\n            <div>\n              <img width={300} src={I_VOTED_NFT} />\n              <div className=\"mt-4 mb-4\">\n                Celebrate for voting in the inaugural election of NEAR and mint\n                your \u201cI Voted\u201d NFT! \ud83c\udf89\n              </div>\n            </div>\n          ),\n          Button: {\n            type: \"Link\",\n            title: \"Mint I voted NFT\",\n            onCancel: () =>\n              State.update({ showMintIVotedModal: false, reload: false }),\n            href: MINT_I_VOTED_NFT,\n            doNotOpenNew: true,\n          },\n          SecondaryButton: {\n            type: \"Link\",\n            title: \"Tweet I Voted\",\n            href: SHARE_LINK,\n          },\n        }}\n      />\n    )}\n\n    <Container>\n      <h2>{housesMapping[typ]}</h2>\n      {typ === \"SetupPackage\" ? (\n        <Widget src={widgets.budget} />\n      ) : (\n        <>\n          <small className=\"text-secondary\">{result.length} Candidates</small>\n          {state.candidates.length > 0 ? (\n            <>\n              <Filters />\n              <CandidatesContainer>\n                {state.candidates.map(([candidateId, votes], index) => (\n                  <CandidateItem\n                    candidateId={candidateId}\n                    votes={votes}\n                    key={index}\n                  />\n                ))}\n              </CandidatesContainer>\n            </>\n          ) : (\n            <div className=\"d-flex p-5 justify-content-center\">\n              There are no candidates found\n            </div>\n          )}\n        </>\n      )}\n      <div>\n        {isIAmHuman ? (\n          <>{typ === \"SetupPackage\" ? <CastBudgetVote /> : <CastVotes />}</>\n        ) : (\n          <Widget\n            src={widgets.verifyHuman}\n            props={{\n              title: \"Want to vote?\",\n              description: \"Click on Verify as a Human to proceed.\",\n            }}\n          />\n        )}\n      </div>\n    </Container>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/election.ndctools.near/widget/NDC.Elections.Candidates", "fact_widget_deployments_id": "0c3cab38434fcc3f22838fc943b37aed", "inserted_timestamp": "2023-09-01T12:39:16.228Z", "modified_timestamp": "2023-09-01T12:39:16.228Z", "__row_index": 473}