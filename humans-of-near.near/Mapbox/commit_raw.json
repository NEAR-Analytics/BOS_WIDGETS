{"tx_hash": "AFke1HrFswTyAXEcyswsRgivSukVf9i5FZnM7pu4tXvE", "action_id_social": "ECKd82ZDKUTZZUN8kXEYqwpHePFg1CnRpTfzjd7PaA9u-0-widget", "block_id": 104775780, "block_timestamp": "2023-11-02T16:33:18.023Z", "signer_id": "humans-of-near.near", "widget_name": "Mapbox", "source_code": "const API_URL = props.API_URL || \"\";\nconst ACCESS_TOKEN =\n  props.accessToken ||\n  \"pk.eyJ1IjoiZWpsYnJhZW0iLCJhIjoiY2xrbmIwaW53MGE0NTNtbGsydWd2MmpyZSJ9.m1ZfEqv2fGet2zblGknT8A\";\nconst styleUrl = props.styleUrl || \"mapbox://styles/mapbox/streets-v12\"; // see https://docs.mapbox.com/api/maps/styles/#mapbox-styles\nconst center = props.center || [-87.6298, 41.8781]; // starting position [lng, lat]\nconst zoom = props.zoom || 9; // starting zoom\nconst accountId = context.accountId;\nconst edit = props.edit || false;\nconst markers = props.markers || [];\n\nstate = State.init({\n  opened: false,\n});\n\nconst code = `\n<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"initial-scale=1,maximum-scale=1,user-scalable=no\">\n    \n    <link href=\"https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css\" rel=\"stylesheet\">\n    \n    <script src=\"https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js\"></script>\n    \n    <style>\n      body { margin: 0; padding: 0; }\n      #map { position: absolute; top: 0; bottom: 0; width: 100%; }\n\n      .marker {\n        background-image: url('https://humans.nearverselabs.com/Human.png');\n        background-size: cover;\n        width: 27px;\n        height: 34px;\n        border-radius: 50%;\n        cursor: pointer;\n      }\n\n      #mymarker {\n        background-image: url('https://humans.nearverselabs.com/active.svg') !important;\n      }\n\n      h6 {\n        margin:0;\n        font-size: 18px;\n      }\n\n      .text-wrap{\n        word-wrap: break-word;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n      }\n\n      .mapboxgl-popup-content{\n        width: 250px;\n        color: white;\n        padding: 10px;\n        border: 1px solid;\n        border-radius: 9px;\n        background: #22272B;\n      }\n\n      .mapboxgl-popup-close-button{\n        color: white;\n      }\n\n      .popup{\n          padding: 10px; \n          display:flex; \n          flex-direction: column;\n          gap:12px;\n          @media (max-width: 510px) {\n            padding: 0;\n          }\n      }\n\n      .d-flex{\n        display: flex;\n      }\n\n      .logo{\n        width:48px; \n        height:60px;\n        border-radius: 5px;\n        @media (max-width: 510px) {\n          width:36px; \n          height:50px;\n        }        \n      }\n\n      .logo-container{\n        height: 60px;\n      }\n\n      .mapboxgl-ctrl-logo {\n          display: none !important;\n      }\n\n      .gap-16{\n        display:flex; \n        align-items:center;\n        gap: 16px;\n      }\n\n      .gap-14{\n        gap: 14px;\n        display:flex; \n        overflow: hidden;\n        flex-direction:column;\n        justify-content: space-between;\n        @media (max-width: 510px) {\n          gap: 3px;\n        } \n      }\n\n      a {\n        outline: 0;\n      }\n\n      .role{\n        color: #22272B;\n        font-size: 12px;\n        font-weight: 500;\n        padding: 2px 10px;\n        width: fit-content;\n        border-radius: 54px;\n        background: #E6E6E6;\n        text-transform: capitalize;\n      }\n    </style>\n  </head>\n  <body>\n\n    <div id=\"map\"></div>\n\n    <script>\n\n      const Commnuities = [\n        {\n          id: \"south_america\",\n          name: \"South America\",\n          color: \"#0040FF\",\n        },\n        {\n          id: \"asia\",\n          name: \"Asia\",\n          color: \"#E311C2\",\n        },\n        {\n          id: \"north_america\",\n          name: \"North America\",\n          color: \"#F33E01\",\n        },\n        {\n          id: \"africa\",\n          name: \"Africa\",\n          color: \"#00BBEA\",\n        },\n        {\n          id: \"europe\",\n          name: \"Europe\",\n          color: \"#008000\",\n        },\n        {\n          id: \"anz\",\n          name: \"ANZ\",\n          color: \"#FED52E\",\n        },\n      ];\n\n    mapboxgl.accessToken = \"${ACCESS_TOKEN}\";\n\n    const map = new mapboxgl.Map({\n        container: 'map', // container ID\n        style: '${styleUrl}',\n        center: [${center[0]}, ${center[1]}], \n        zoom: ${zoom}\n    });\n\n    function handleLink (link){\n      window.top.postMessage(link, \"*\");\n    }\n\n    function getDetail (row) {\n      \n\n      const user = row.user;\n      var title = \"\";\n      const near = row.user.accountId.indexOf(\".near\");\n      if(user.name){\n      title = user.name;\n      } else if(near !== -1){\n      title = user.accountId;\n      } else {\n        title = user.accountId.slice(0, 12);\n      }\n\n      var state = {\n        twitter: false,\n        social:false\n      }\n\n      if(user.twitter !== \"https://twitter.com/\"){\n        state.twitter = true\n      }\n      if(user.social !== \"https://social.near.page/u/\"){\n        state.social = true\n      }\n      const profileImageUrl = \"https://i.near.social/magic/large/https://near.social/magic/img/account/\"+ user.accountId;\n      \n      \n       const HTML = '<div class=\"popup\">'+\n          '<div class=\"d-flex\" style=\"gap:20px\">'+\n            '<div class=\"logo-container\">'+\n              '<img src=\"'+ profileImageUrl +'\" class=\"logo\" />'+\n            '</div>'+\n            '<div class=\"gap-14\">'+\n              '<div class=\"d-flex\" style=\"gap:16px; overflow:hidden\">'+\n                '<h6 class=\"text-wrap\">'+title+'</h6>'+\n                '<svg style=\"width:16px\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><g clip-path=\"url(#clip0_1_378)\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0 8C0 5.87827 0.842855 3.84344 2.34315 2.34315C3.84344 0.842855 5.87827 0 8 0C10.1217 0 12.1566 0.842855 13.6569 2.34315C15.1571 3.84344 16 5.87827 16 8C16 10.1217 15.1571 12.1566 13.6569 13.6569C12.1566 15.1571 10.1217 16 8 16C5.87827 16 3.84344 15.1571 2.34315 13.6569C0.842855 12.1566 0 10.1217 0 8ZM7.54347 11.424L12.1493 5.66613L11.3173 5.00053L7.38987 9.90827L4.608 7.5904L3.92533 8.4096L7.54347 11.4251V11.424Z\" fill=\"#E6E6E6\"/></g><defs><clipPath id=\"clip0_1_378\"><rect width=\"16\" height=\"16\" fill=\"white\"/></clipPath></defs></svg>'+\n              '</div>'+\n              '<div class=\"role\">'+\n                user.role+\n              '</div>'+\n            '</div>'+\n          '</div>'+\n          (user.bio ? '<div >'+user.bio.length>150?user.bio.slice(0, 150)+'...':user.bio+'</div>':'')+\n          '<div class=\"gap-16\">'+\n              (state.social? \"<a href='\"+user.social+\"' target='_blank' onclick='handleLink(\"+JSON.stringify(user.social)+\")'   >  \" : '') +\n              '<svg width=\"29\" height=\"12\" viewBox=\"0 0 29 12\" fill=\"'+(state.social?'white':'grey')+'\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M0.240133 7.38517V4.85885L10.3454 0.409091V3.31579L3.42674 6.0933L3.52004 5.94258V6.30144L3.42674 6.15072L10.3454 8.92823V11.8349L0.240133 7.38517ZM28.7599 7.38517L18.6546 11.8349V8.92823L25.5733 6.15072L25.48 6.30144V5.94258L25.5733 6.0933L18.6546 3.31579V0.409091L28.7599 4.85885V7.38517Z\"></path></svg>'+\n              (state.social? '</a>' : '') +\n              (state.twitter? \"<a href='\"+user.twitter+\"' target='_blank' onclick='handleLink(\"+JSON.stringify(user.twitter)+\")'   >  \" : '') +\n              '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"18\" viewBox=\"0 0 24 24\"><path fill=\"'+(state.twitter?'white':'grey')+'\" d=\"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z\"/></svg>'+\n              (state.twitter? '</a>' : '') +\n          '</div>'+\n        '</div>';\n        \n        return HTML;\n    };\n\n    // Function to populate markers to the map\n    function populateMarkers() {\n        const markersData = ${JSON.stringify(markers)};\n        markersData.forEach(marker => {\n          \n        const el = document.createElement('div');\n        el.className = 'marker';\n        if(marker.user.community){\n          const _com = Commnuities.find((row)=>row.id == marker.user.community);\n          el.style=\"color:\"+_com.color+\";\";\n        }\n        console.log(marker, \"/\", Commnuities, el);\n        ${\n          accountId\n            ? `if(marker.user.accountId === \"${accountId}\") el.id = 'mymarker';`\n            : ``\n        }\n        new mapboxgl.Marker(el)\n            .setLngLat([marker.longitude, marker.latitude])\n            .setPopup(\n                new mapboxgl.Popup({ offset: 25, closeButton: false }) // add popups\n                  .setHTML(\n                    getDetail(marker)\n              )\n            ).addTo(map);\n        });\n    }\n\n    populateMarkers();\n\n    ${\n      accountId && edit\n        ? `map.on('click', function(event) {\n            const { lngLat } = event;\n\n            const _el = document.getElementById(\"mymarker\");\n            const myel = _el ? _el : document.createElement('div');\n            myel.className = 'marker';\n            myel.id = 'mymarker';\n            \n            new mapboxgl.Marker(myel)\n                .setLngLat([lngLat.lng, lngLat.lat])\n                .addTo(map);\n\n            const data = {\n              lngLat,\n              accountId : \"${accountId}\"\n            };\n\n            fetch(\"${API_URL}/location/bos\", {\n              method: \"PUT\",\n              headers: {\n                \"Content-Type\": \"application/json\"\n              },\n              body: JSON.stringify(data),\n            });\n        \n      });     \n`\n        : ``\n    }\n    \n    </script>\n  </body>\n</html>\n  `;\n\nconst Container = styled.div`\nheight: 100%;\ndisplay: flex;\n\n/* reset */\nbutton,\nfieldset,\ninput {\n  all: unset;\n}\n\n.DialogOverlay {\n  background-color: var(--blackA9);\n  position: fixed;\n  inset: 0;\n  animation: overlayShow 150ms cubic-bezier(0.16, 1, 0.3, 1);\n}\n\n.DialogContent {\n  background-color: white;\n  border-radius: 6px;\n  box-shadow: hsl(206 22% 7% / 35%) 0px 10px 38px -10px, hsl(206 22% 7% / 20%) 0px 10px 20px -15px;\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  width: 90vw;\n  max-width: 450px;\n  max-height: 85vh;\n  padding: 25px;\n  animation: contentShow 150ms cubic-bezier(0.16, 1, 0.3, 1);\n}\n.DialogContent:focus {\n  outline: none;\n}\n\n.DialogTitle {\n  margin: 0;\n  font-weight: 500;\n  color: var(--mauve12);\n  font-size: 17px;\n}\n\n.DialogDescription {\n  margin: 10px 0 20px;\n  color: var(--mauve11);\n  font-size: 15px;\n  line-height: 1.5;\n}\n\n.Button {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 4px;\n  padding: 0 15px;\n  font-size: 15px;\n  line-height: 1;\n  font-weight: 500;\n  height: 35px;\n}\n.Button.violet {\n  background-color: white;\n  color: var(--violet11);\n  box-shadow: 0 2px 10px var(--blackA7);\n}\n.Button.violet:hover {\n  background-color: var(--mauve3);\n}\n.Button.violet:focus {\n  box-shadow: 0 0 0 2px black;\n}\n.Button.green {\n  background-color: var(--green4);\n  color: var(--green11);\n}\n.Button.green:hover {\n  background-color: var(--green5);\n}\n.Button.green:focus {\n  box-shadow: 0 0 0 2px var(--green7);\n}\n\n.IconButton {\n  font-family: inherit;\n  border-radius: 100%;\n  height: 25px;\n  width: 25px;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  color: var(--violet11);\n  position: absolute;\n  top: 10px;\n  right: 10px;\n}\n.IconButton:hover {\n  background-color: var(--violet4);\n}\n.IconButton:focus {\n  box-shadow: 0 0 0 2px var(--violet7);\n}\n\n.Fieldset {\n  display: flex;\n  gap: 20px;\n  align-items: center;\n  margin-bottom: 15px;\n}\n\n.Label {\n  font-size: 15px;\n  color: var(--violet11);\n  width: 90px;\n  text-align: right;\n}\n\n.Input {\n  width: 100%;\n  flex: 1;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 4px;\n  padding: 0 10px;\n  font-size: 15px;\n  line-height: 1;\n  color: var(--violet11);\n  box-shadow: 0 0 0 1px var(--violet7);\n  height: 35px;\n}\n.Input:focus {\n  box-shadow: 0 0 0 2px var(--violet8);\n}\n\n@keyframes overlayShow {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n@keyframes contentShow {\n  from {\n    opacity: 0;\n    transform: translate(-50%, -48%) scale(0.96);\n  }\n  to {\n    opacity: 1;\n    transform: translate(-50%, -50%) scale(1);\n  }\n}\n`;\n\nreturn (\n  <Container>\n    <Dialog.Root open={state.opened}>\n      <Dialog.Overlay className=\"DialogOverlay\" />\n      <Dialog.Content className=\"DialogContent\">\n        <Dialog.Title className=\"DialogTitle\">Redirect</Dialog.Title>\n        <Dialog.Description className=\"DialogDescription\">\n          Click{\" \"}\n          <a href={state.url} target=\"_blank\">\n            {\" \"}\n            here{\" \"}\n          </a>{\" \"}\n          to open the link in new tab.\n        </Dialog.Description>\n        <Dialog.Close asChild>\n          <button\n            className=\"IconButton\"\n            aria-label=\"Close\"\n            onClick={() => {\n              State.update({ opened: false });\n            }}\n          >\n            X\n          </button>\n        </Dialog.Close>\n      </Dialog.Content>\n    </Dialog.Root>\n    <iframe\n      id=\"myMap\"\n      className=\"w-100 h-100\"\n      srcDoc={code}\n      onMessage={(response) => {\n        State.update({ opened: true, url: response });\n      }}\n    />\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/humans-of-near.near/widget/Mapbox", "fact_widget_deployments_id": "cf7d575df0a36b4a767545af343469fd", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 36}