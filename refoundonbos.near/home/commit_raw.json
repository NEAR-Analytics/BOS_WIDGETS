{"tx_hash": "6Uk3MSXHAf2UgLyiAQCsu19cVQrYpGtHWLPyy88yBGB7", "action_id_social": "2Sei8tdczpkeUeVdN7g11vzpYVphegsvyoD5zHpFDgf3-0-widget", "block_id": 105316703, "block_timestamp": "2023-11-09T19:41:22.693Z", "signer_id": "refoundonbos.near", "widget_name": "home", "source_code": "const ownerId = \"refoundonbos.near\";\nconst contractId = \"refoundjournalism.near\";\nconst CREATE_POST_TAB = \"createpost\";\nconst EDIT_POST_TAB = \"editpost\";\nconst POSTS_LIST_TAB = \"posts\";\nconst POST_DETAIL_TAB = \"project\";\n\nconst Theme = styled.div`\n  * {\n    font-family: \"Mona-Sans\";\n    font-style: normal;\n    font-weight: 400;\n  }\n  @font-face {\n    font-family: mona-sans;\n    font-style: normal;\n    font-weight: 400;\n    src:\n      local(\"Mona-Sans\"),\n      url(https://fonts.cdnfonts.com/s/91271/Mona-Sans-Regular.woff)\n        format(\"woff\");\n  }\n  @font-face {\n    font-family: mona-sans;\n    font-style: normal;\n    font-weight: 500;\n    src:\n      local(\"Mona-Sans\"),\n      url(https://fonts.cdnfonts.com/s/91271/Mona-Sans-Medium.woff)\n        format(\"woff\");\n  }\n  @font-face {\n    font-family: mona-sans;\n    font-style: normal;\n    font-weight: 600;\n    src:\n      local(\"Mona-Sans\"),\n      url(https://fonts.cdnfonts.com/s/91271/Mona-Sans-SemiBold.woff)\n        format(\"woff\");\n  }\n  @font-face {\n    font-family: mona-sans;\n    font-style: normal;\n    font-weight: 700;\n    src:\n      local(\"Mona-Sans\"),\n      url(https://fonts.cdnfonts.com/s/91271/Mona-Sans-Bold.woff) format(\"woff\");\n  }\n`;\n\nState.init({\n  cart: null,\n  nearToUsd: null,\n  series: [],\n  seriesIsFetched: false,\n  nearToUsd: useCache(\n    () =>\n      asyncFetch(\n        \"https://api.coingecko.com/api/v3/simple/price?ids=near&vs_currencies=usd\"\n      ).then((res) => {\n        console.log(\"congecko res body: \", res.body);\n        return res.body.near.usd;\n      }),\n    \"nearToUsd\",\n    { subscribe: false }\n  ),\n  isCartModalOpen: false,\n  registryAdmins: null,\n});\n\nif (state.nearToUsd === null) {\n  const res = fetch(\n    \"https://api.coingecko.com/api/v3/simple/price?ids=near&vs_currencies=usd\"\n  );\n  console.log(\"coingecko res: \", res);\n  State.update({ nearToUsd: res.body.near.usd });\n}\n\nconsole.log(\"state: \", state);\n\nconst tabContentWidget = {\n  [CREATE_POST_TAB]: \"create\",\n  [EDIT_POST_TAB]: \"create\",\n  [POSTS_LIST_TAB]: \"discover\",\n  [POST_DETAIL_TAB]: \"detail\",\n};\n\nconst getWidget = (props) => {\n  if (props.tab in tabContentWidget) {\n    return tabContentWidget[props.tab];\n  }\n  // backup (TODO: review)\n  return tabContentWidget[POSTS_LIST_TAB];\n};\n\nconst getTabWidget = (tab) => {\n  if (tab in tabContentWidget) {\n    return tabContentWidget[tab];\n  }\n\n  return tabContentWidget[POSTS_LIST_TAB];\n};\n\nconst props = {\n  ...props,\n  ...state,\n  addProjectsToCart: (posts) => {\n    const cart = state.cart ?? {};\n    posts.forEach(({ id, amount, ft, referrerId }) => {\n      cart[id] = { amount, ft: ft ?? \"NEAR\", referrerId }; // default to NEAR\n    });\n    State.update({ cart });\n    Storage.set(CART_KEY, JSON.stringify(cart));\n  },\n  removeProjectsFromCart: (projectIds) => {\n    const cart = state.cart ?? {};\n    projectIds.forEach((projectId) => {\n      delete cart[projectId];\n    });\n    State.update({ cart });\n    Storage.set(CART_KEY, JSON.stringify(cart));\n  },\n  updateCartItem: (projectId, amount, ft, referrerId) => {\n    const cart = state.cart ?? {};\n    const updated = {};\n    // if (amount === \"\") updated.amount = \"0\";\n    if (amount || amount === \"\") updated.amount = amount;\n    if (ft) updated.ft = ft;\n    if (referrerId) updated.referrerId = referrerId;\n    cart[projectId] = updated;\n    State.update({ cart });\n    Storage.set(CART_KEY, JSON.stringify(cart));\n  },\n  checkoutSuccess: true,\n  checkoutSuccessTxHash: true,\n  setIsCartModalOpen: (isOpen) => {\n    State.update({ isCartModalOpen: isOpen });\n  },\n};\n\nconst CART_KEY = \"cart\";\nconst storageCart = Storage.get(CART_KEY);\nconst DEFAULT_CART = {};\n\nif (state.cart === null && storageCart !== null) {\n  // cart hasn't been set on state yet, and storageCart has been fetched\n  // if storageCart isn't undefined, set it on state\n  // otherwise, set default cart on state\n  let cart = DEFAULT_CART;\n  if (storageCart) {\n    cart = JSON.parse(storageCart);\n  }\n  State.update({ cart });\n}\n\nif (props.checkoutSuccess && state.cart && Object.keys(state.cart).length > 0) {\n  // if checkout was successful, clear cart\n  State.update({ cart: {} });\n  Storage.set(CART_KEY, JSON.stringify(DEFAULT_CART));\n}\n\nif (props.tab === EDIT_POST_TAB) {\n  props.edit = true;\n}\n\nconst tabContent = (\n  <Widget src={`${ownerId}/widget/${getTabWidget(props.tab)}`} props={props} />\n);\n\nconst Content = styled.div`\n  width: 100%;\n  height: 100%;\n  background: #ffffff;\n  // padding: 3em;\n  border-radius: 0rem 0rem 1.5rem 1.5rem;\n  border-top: 1px solid var(--ui-elements-light, #eceef0);\n  background: var(--base-white, #fff);\n\n  &.form {\n    border: none;\n    background: #fafafa;\n  }\n`;\n\nconst isForm = [CREATE_POST_TAB].includes(props.tab);\n\nif (!state.cart) {\n  return \"\";\n}\n\nreturn (\n  <Theme>\n    <Widget src={`${ownerId}/widget/nav`} props={props} />\n    <Content className={isForm ? \"form\" : \"\"}>{tabContent}</Content>\n  </Theme>\n);\n", "metadata": {"platform": "jutsu.ai"}, "branch": {"draft": null}, "widget_modules_used": null, "widget_url": "https://near.social/#/refoundonbos.near/widget/home", "fact_widget_deployments_id": "a004f66083d0bab2e7fec67450bf1055", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 14}