{"tx_hash": "CAxAUyAE7uYzPXKmD5J15KVv1KVYhdGLrEN81waDYzsQ", "action_id_social": "8SoRkzT2awf55RevMBEkjr5p8f8dXwwapD2e7kWVz6S1-0-widget", "block_id": 105320897, "block_timestamp": "2023-11-09T20:55:45.333Z", "signer_id": "refoundonbos.near", "widget_name": "discover", "source_code": "const ownerId = \"refoundonbos.near\";\nconst registryId = \"refoundjournalism.near\";\nconst mapImage =\n  \"https://bafybeibhpayxcnfjbq53jdx53yllvk6j7hlzifxnrs7cizrkcoc45qtps4.ipfs.w3s.link/map_transparent.png\";\nconst IPFS_BASE_URL = \"https://nftstorage.link/ipfs/\";\nconst DEFAULT_BANNER_IMAGE_URL =\n  IPFS_BASE_URL + \"bafkreih4i6kftb34wpdzcuvgafozxz6tk6u4f5kcr2gwvtvxikvwriteci\";\nconst DEFAULT_PROFILE_IMAGE_URL =\n  IPFS_BASE_URL + \"bafkreibwq2ucyui3wmkyowtzau6txgbsp6zizy4l2s5hkymsyv6tc75j3u\";\nconst HERO_BACKGROUND_IMAGE_URL =\n  IPFS_BASE_URL + \"bafkreiewg5afxbkvo6jbn6jgv7zm4mtoys22jut65fldqtt7wagar4wbga\";\n\nconst API_URL = \"https://humans.nearverselabs.com/api\";\nconst MAP_STYLE = \"mapbox://styles/mapbox/dark-v10\";\nconst MAP_TOKEN =\n  \"pk.eyJ1IjoidGVqMDEiLCJhIjoiY2xqcHZ2dGpkMDB5azNsbzQ0bmMwNjRjaCJ9.FVv2zRPaLwzZMgagbI2YZw\";\n\nconst center = [0, 30];\nconst zoom = 1.7;\nconst accountId = context.accountId;\n\nconst getImageUrlFromSocialImage = (image) => {\n  if (image.url) {\n    return image.url;\n  } else if (image.ipfs_cid) {\n    return IPFS_BASE_URL + image.ipfs_cid;\n  }\n};\n\nconst Container = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  width: 100%;\n  height: 100%;\n`;\n\nconst HeroOuter = styled.div`\n  padding: 136px 64px;\n`;\n\nconst HeroInner = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: space-between;\n`;\n\nconst SectionHeader = styled.div`\n  display: flex;\n  flex-direction: row;\n  width: 100%;\n  align-items: center;\n  margin-bottom: 24px;\n  padding: 96px 64px 24px 64px;\n`;\n\nconst SectionTitle = styled.div`\n  font-size: 24px;\n  font-weight: 600;\n  color: #2e2e2e;\n  font-family: Mona-Sans;\n`;\n\nconst ProjectsCount = styled.div`\n  color: #7b7b7b;\n  font-size: 24px;\n  font-weight: 400;\n  margin-left: 32px;\n`;\n\nconst ProjectsContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  // padding: 0px 64px 96px 64px;\n  // background: #fafafa;\n`;\n\nconst HeroContainer = styled.div`\n  width: 100%;\n  min-height: 700px;\n  position: relative;\n`;\nconst Wrapper = styled.div`\n  display: flex;\n  width: 100%;\n  height: calc(100vh - 300px);\n  align-items: stretch;\n  flex-direction: column;\n  background: black;\n  overflow: auto;\n  position: relative;\n`;\nconst Hero = styled.img`\n  width: 100%;\n  height: 100%;\n  display: block;\n`;\n\nState.init({\n  registeredPosts: null, // TODO: change this back to null\n});\n\nif (!state.registeredPosts) {\n  Near.asyncView(registryId, \"get_series\", {}).then((posts) => {\n    const formattedPosts = posts.map((series) => {\n      const formatted = {\n        seriesId: series.series_id,\n        ownerId: series.owner_id,\n        title: series.metadata.title ?? \"\",\n        description: series.metadata.description ?? \"\",\n        media: series.metadata.media,\n        dateTaken:\n          series.metadata.extra && JSON.parse(series.metadata.extra).dateTaken,\n        location:\n          series.metadata.extra &&\n          JSON.parse(series.metadata.extra).locationTaken,\n        tags: series.metadata.tags || [],\n        verified: series.verified,\n      };\n      console.log(\"series omn discover\", series);\n      return formatted;\n    });\n    State.update({\n      registeredPosts: formattedPosts.filter(\n        (p) => p.seriesId !== 0 && p.seriesId !== 1 && p.seriesId !== 4\n      ),\n    });\n  });\n}\n\nif (!state.registeredPosts) return \"\";\n\nconst userIsAdmin =\n  props.registryAdmins && props.registryAdmins.includes(context.accountId);\n\nconst projects = state.registeredPosts;\n\nreturn (\n  <>\n    <Wrapper style={{ backgroundColor: \"#3C4DF2\" }}>\n      <img src={mapImage} alt=\"Map\" />\n    </Wrapper>\n\n    <ProjectsContainer>\n      <SectionHeader>\n        <SectionTitle>All posts</SectionTitle>\n        <ProjectsCount>{projects.length}</ProjectsCount>\n      </SectionHeader>\n      <Widget\n        src={`${ownerId}/widget/list`}\n        props={{\n          projects,\n          renderItem: (post) => (\n            <Widget\n              src={`${ownerId}/widget/card`}\n              props={{\n                post,\n                ...props,\n              }}\n            />\n          ),\n        }}\n      />\n    </ProjectsContainer>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/refoundonbos.near/widget/discover", "fact_widget_deployments_id": "d456ff4895739e9e4ca43a8be26b4abb", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}