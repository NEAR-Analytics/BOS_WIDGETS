{"tx_hash": "5SdPeVFptEBbnUxdW9RzL7Rfi2sMAJEiKqNjpi6XgRCM", "action_id_social": "DbKd7rHDWFDnjNeYG63TuKmScjrcXVwYnVQbAptQ7zxF-0-widget", "block_id": 109656372, "block_timestamp": "2024-01-05T13:27:52.927Z", "signer_id": "cryptogarik.near", "widget_name": "RegistrationFT", "source_code": "const accountId = props.accountId || context.accountId;\nconst ftContract = \"token.v2.ref-finance.near\";\n\nState.init({\n  showRegistrationData: false,\n});\n\nif (!(state.accountId && state.ftContract)) {\n  State.update({\n    accountId,\n    ftContract,\n  });\n}\n\nconst updateStorageBalance = () => {\n  const accountStorageBalance = Near.view(\n    state.ftContract,\n    \"storage_balance_of\",\n    {\n      account_id: state.accountId,\n    }\n  );\n  console.log(\"accountStorageBalance: \", accountStorageBalance);\n  if (accountStorageBalance) {\n    State.update({\n      accountStorageBalance,\n    });\n  } else {\n    State.update({\n      accountStorageBalance: {\n        total: \"0\",\n        available: \"0\",\n      },\n    });\n  }\n};\n\nif (!state.showRegistrationData) {\n  updateStorageBalance();\n}\n\nconst onChangeAccount = (updatedAccountId) => {\n  State.update({\n    accountId: updatedAccountId,\n  });\n};\n\nconst onChangeFTContract = (ftContract) => {\n  State.update({\n    ftContract,\n  });\n};\n\nconst handleCheck = () => {\n  console.log(\"accountId: \", state.accountId);\n  console.log(\"ftContract: \", state.ftContract);\n\n  updateStorageBalance();\n\n  State.update({ showRegistrationData: true });\n};\n\nconst handleRegister = () => {\n  if (!(state.accountId && state.ftContract)) {\n    return;\n  }\n\n  Near.call({\n    contractName: state.ftContract,\n    methodName: \"storage_deposit\",\n    args: {\n      account_id: state.accountId,\n    },\n    deposit: 1250000000000000000000,\n  });\n};\n\nreturn (\n  <div>\n    <div>Check user registration in FT contract</div>\n    <div>\n      Account:\n      <input\n        type=\"text\"\n        value={state.accountId}\n        onChange={(e) => onChangeAccount(e.target.value)}\n      />\n    </div>\n    <div>\n      FT contract:\n      <input\n        type=\"text\"\n        value={state.ftContract}\n        onChange={(e) => onChangeFTContract(e.target.value)}\n      />\n    </div>\n    <div>\n      <button onClick={handleCheck}>Check</button>\n    </div>\n    {state.showRegistrationData && (\n      <div>\n        <div>\n          <h5>Registration data (Storage balance)</h5>\n        </div>\n        {(Number(state.accountStorageBalance.total) > 0 && (\n          <div>User is registered</div>\n        )) || (\n          <div>\n            <div>User is not registered</div>\n            <div>\n              <button onClick={handleRegister}>Register</button>\n            </div>\n          </div>\n        )}\n        <div>\n          <h6>Storage balance</h6>\n        </div>\n        <div>{\"Total: \" + state.accountStorageBalance.total}</div>\n        <div>{\"Available: \" + state.accountStorageBalance.available}</div>\n      </div>\n    )}\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/cryptogarik.near/widget/RegistrationFT", "fact_widget_deployments_id": "7d456cf7200b7a93ffcc175d05d8480d", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}