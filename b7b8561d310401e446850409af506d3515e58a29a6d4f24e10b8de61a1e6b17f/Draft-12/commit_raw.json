{"tx_hash": "4X2zUWnxwg1bRzyUqkh1s7E4NzXYS1sJkx1P5ZpC9tt9", "action_id_social": "CjbuRPLu4am66JS94o2bHL5aB5ubuxbf22EaTFWeSNHq-0-widget", "block_id": 106152279, "block_timestamp": "2023-11-20T20:18:58.605Z", "signer_id": "b7b8561d310401e446850409af506d3515e58a29a6d4f24e10b8de61a1e6b17f", "widget_name": "Draft-12", "source_code": "State.init({\n  // Assuming chainId is a numeric ID of the blockchain being used\n  chainId: 1, // For Ethereum Mainnet, for instance\n\n  // Base URL could be your API endpoint or a relevant URL for your app's backend\n  baseUrl: \"https://api.yourapp.com\",\n\n  // Mock a safe address, typically in Ethereum address format\n  safeAddress: \"0x1234567890abcdef1234567890abcdef12345678\",\n\n  // Mock a sender address, similar to safeAddress\n  sender: \"0xabcdef1234567890abcdef1234567890abcdef12\",\n\n  // Mock an array of transactions\n  transactions: [\n    {\n      safeTxHash:\n        \"0xabcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abc1\",\n      data: null,\n      to: \"0xabcdef1234567890abcdef1234567890abcdef34\",\n      value: \"1000000000000000000\", // 1 ETH in Wei\n    },\n    {\n      safeTxHash:\n        \"0xabcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abc2\",\n      data: {\n        method: \"transfer\",\n        dataDecoded: {\n          parameters: [\n            { value: \"0x1234567890abcdef1234567890abcdef12345678\" },\n            { value: \"500000000000000000\" }, // 0.5 ETH in Wei\n          ],\n        },\n      },\n      to: \"\",\n      value: \"0\",\n    },\n    // ... more mock transactions ...\n  ],\n\n  // Mock a selected transaction, could be null initially\n  selectedTransaction: null,\n});\n// connect account\nif (state.sender === null) {\n  const accounts = Ethers.send(\"eth_requestAccounts\", []);\n  const checksummedAddr = ethers.utils.getAddress(accounts[0]);\n  if (accounts.length) {\n    State.update({ sender: checksummedAddr });\n\n    Ethers.provider()\n      .getNetwork()\n      .then((chainIdData) => {\n        if (chainIdData?.chainId == 1) {\n          State.update({\n            chainId: \"mainnet\",\n          });\n        } else if (chainIdData?.chainId == 5) {\n          State.update({\n            chainId: \"goerli\",\n          });\n        } else if (chainIdData?.chainId == 100) {\n          State.update({\n            chainId: \"gnosis-chain\",\n          });\n        }\n      });\n  }\n}\n\n// choose relevant transaction to sign and confirm\nconst selectTransaction = (tx) => {\n  State.update({ selectedTransaction: tx });\n};\n\n// sign relevant transaction\nconst signTransaction = () => {\n  if (state.selectedTransaction) {\n    const selectedTxHash = state.selectedTransaction.safeTxHash;\n    const signer = Ethers.provider().getSigner();\n    signer.signMessage(ethers.utils.arrayify(selectedTxHash)).then((sig) => {\n      const setV = ethers.utils.hexDataSlice(sig, 0, 64) + \"1f\";\n\n      const url =\n        state.baseUrl +\n        `/v1/multisig-transactions/${selectedTxHash}/confirmations/`;\n      const params = JSON.stringify({ signature: setV });\n      const options = {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: params,\n      };\n\n      //   post confirmed sig with set V to gnosis API backend\n      asyncFetch(url, options).then((res) => {\n        console.log(res);\n      });\n    });\n  } else {\n    console.log(\"Please select a transaction to sign.\");\n  }\n};\n\n// I don't know any CSS so please forgive the following fuckery\nconst Selection = styled.button`\n    background: ${(tx) =>\n      state.selectedTransaction == tx ? \"palevioletred\" : \"white\"};\n    color: ${(props) => (props.primary ? \"white\" : \"palevioletred\")};\n  \n    font-size: 1em;\n    margin: 1em;\n    padding: 0.25em 1em;\n    border: 2px solid palevioletred;\n    border-radius: 10px;\n  `;\n\nreturn (\n  <div>\n    <input\n      value={state.safeAddress}\n      onChange={(e) => State.update({ safeAddress: e.target.value })}\n      placeholder=\"Enter Safe address to view txs\"\n      label=\"SafeAddressInput\"\n    />\n    <p>Queued transactions:</p>\n    <ul>\n      {state.transactions.map((tx, index) => (\n        <li key={index} onClick={() => selectTransaction(tx)}>\n          <Selection>\n            <span>\n              From Safe Address: {state.safeAddress}\n              <br />\n              Type:\n              {tx.data\n                ? `ERC20 ${tx.dataDecoded.method} \n                  To: ${tx.dataDecoded.parameters[0].value} \n                  Value: ${tx.dataDecoded.parameters[1].value}`\n                : `Native Currency Transfer \n                  To: ${tx.to} \n                  Value: ${tx.value} \n                  `}\n              <br />\n              {\n                state.selectedTransaction.safeTxHash == tx.safeTxHash\n                  ? \"!!!!!!THIS ONE IS SELECTED RIGHT NOW!!!!!!\"\n                  : \"\" /** Again I don't know css */\n              }\n            </span>\n          </Selection>\n        </li>\n      ))}\n    </ul>\n    <button onClick={() => signTransaction()} label=\"SignButton\">\n      <span>Sign Selected Transaction</span>\n    </button>\n    <Web3Connect className=\"web3-connect\" connectLabel=\"Connect Wallet\" />\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/b7b8561d310401e446850409af506d3515e58a29a6d4f24e10b8de61a1e6b17f/widget/Draft-12", "fact_widget_deployments_id": "e7febcac89d35acd6bb0acc8712cf79a", "inserted_timestamp": "2023-11-20T22:21:45.805Z", "modified_timestamp": "2023-11-20T22:21:45.805Z", "__row_index": 1}