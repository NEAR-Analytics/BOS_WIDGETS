{"tx_hash": "E9AczJswmHdNLMc15xRr6a9eT5FycNghrZXfi1B2W4kL", "action_id_social": "DxXq8iSDYP4sMSxVsEHq5AsWQBDALTcZdgw1Y8vWm5n1-0-widget", "block_id": 108390088, "block_timestamp": "2023-12-20T07:58:00.905Z", "signer_id": "guessme.near", "widget_name": "ZKEVMSwap.swap-quoter", "source_code": "const {\n  update,\n  routerAddress,\n  wethAddress,\n  inputCurrency,\n  outputCurrency,\n  inputCurrencyAmount,\n  outputCurrencyAmount,\n  tradeType,\n  onLoad,\n} = props;\n\nif (!update) return \"\";\n\nif (!inputCurrency.address || !outputCurrency.address || !inputCurrencyAmount) {\n  onLoad({});\n  return \"\";\n}\n\nconst wrapType =\n  inputCurrency.address === \"native\" && outputCurrency.address === wethAddress\n    ? 1\n    : inputCurrency.address === wethAddress &&\n      outputCurrency.address === \"native\"\n    ? 2\n    : 0;\nif (wrapType) {\n  onLoad(\n    tradeType === \"in\"\n      ? {\n          outputCurrencyAmount: inputCurrencyAmount,\n          loading: false,\n          noPair: false,\n        }\n      : {\n          inputCurrencyAmount: outputCurrencyAmount,\n          loading: false,\n          noPair: false,\n        }\n  );\n  return;\n}\nconst currentCurrency = tradeType === \"in\" ? inputCurrency : outputCurrency;\nconst currentAmount = Big(\n  tradeType === \"in\" ? inputCurrencyAmount : outputCurrencyAmount\n)\n  .mul(0.995)\n  .toFixed(5);\nconst outCurrency = tradeType === \"in\" ? outputCurrency : inputCurrency;\n\nconst path = [\n  currentCurrency.address === \"native\" ? wethAddress : currentCurrency.address,\n  outCurrency.address === \"native\" ? wethAddress : outCurrency.address,\n];\n\nconst QuoteContractAddress = \"0x55BeE1bD3Eb9986f6d2d963278de09eE92a3eF1D\";\n\nconst iface = new ethers.utils.Interface([\n  {\n    inputs: [\n      {\n        internalType: \"bytes\",\n        name: \"path\",\n        type: \"bytes\",\n      },\n      {\n        internalType: \"uint256\",\n        name: \"amountIn\",\n        type: \"uint256\",\n      },\n    ],\n    name: \"quoteExactInput\",\n    outputs: [\n      {\n        internalType: \"uint256\",\n        name: \"amountOut\",\n        type: \"uint256\",\n      },\n      {\n        internalType: \"uint16[]\",\n        name: \"fees\",\n        type: \"uint16[]\",\n      },\n    ],\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n]);\n\nconst pathBytes = \"0x\" + path.map((address) => address.substr(2)).join(\"\");\n\nconst inputs = [\n  pathBytes,\n  ethers.utils.parseUnits(currentAmount, currentCurrency.decimals),\n];\n\nconst encodedData = iface.encodeFunctionData(\"quoteExactInput\", inputs);\n\nEthers.provider()\n  .call({\n    to: QuoteContractAddress,\n    data: encodedData,\n  })\n  .then((data) => {\n    const decodedData = iface.decodeFunctionResult(\"quoteExactInput\", data);\n    // decodedData = [amountOut, fee]\n    const amountOut = decodedData[0];\n    // const fee = decodedData[1];\n    const estimate = Big(amountOut.toString())\n      .div(Big(10).pow(outCurrency.decimals))\n      .toFixed(18);\n    onLoad({\n      outputCurrencyAmount: Big(estimate).gt(0.01)\n        ? estimate\n        : Big(estimate).toFixed(10),\n      noPair: false,\n    });\n  })\n  .catch((err) => {\n    onLoad({\n      loading: false,\n      noPair: true,\n    });\n  });\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/guessme.near/widget/ZKEVMSwap.swap-quoter", "fact_widget_deployments_id": "987d0f2619ef1f61e2afeae595a5abc4", "inserted_timestamp": "2024-03-07T05:24:05.087Z", "modified_timestamp": "2024-03-07T05:24:05.087Z", "__row_index": 0}